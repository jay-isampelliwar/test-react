(function(){const me=document.createElement("link").relList;if(me&&me.supports&&me.supports("modulepreload"))return;for(const fe of document.querySelectorAll('link[rel="modulepreload"]'))de(fe);new MutationObserver(fe=>{for(const We of fe)if(We.type==="childList")for(const O of We.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&de(O)}).observe(document,{childList:!0,subtree:!0});function be(fe){const We={};return fe.integrity&&(We.integrity=fe.integrity),fe.referrerPolicy&&(We.referrerPolicy=fe.referrerPolicy),fe.crossOrigin==="use-credentials"?We.credentials="include":fe.crossOrigin==="anonymous"?We.credentials="omit":We.credentials="same-origin",We}function de(fe){if(fe.ep)return;fe.ep=!0;const We=be(fe);fetch(fe.href,We)}})();function pO(G){return G&&G.__esModule&&Object.prototype.hasOwnProperty.call(G,"default")?G.default:G}var tO={exports:{}},Lv={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xx;function z8(){if(Xx)return Lv;Xx=1;var G=Symbol.for("react.transitional.element"),me=Symbol.for("react.fragment");function be(de,fe,We){var O=null;if(We!==void 0&&(O=""+We),fe.key!==void 0&&(O=""+fe.key),"key"in fe){We={};for(var j in fe)j!=="key"&&(We[j]=fe[j])}else We=fe;return fe=We.ref,{$$typeof:G,type:de,key:O,ref:fe!==void 0?fe:null,props:We}}return Lv.Fragment=me,Lv.jsx=be,Lv.jsxs=be,Lv}var Jx;function q8(){return Jx||(Jx=1,tO.exports=z8()),tO.exports}var st=q8(),rO={exports:{}},Rn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zx;function Y8(){if(Zx)return Rn;Zx=1;var G=Symbol.for("react.transitional.element"),me=Symbol.for("react.portal"),be=Symbol.for("react.fragment"),de=Symbol.for("react.strict_mode"),fe=Symbol.for("react.profiler"),We=Symbol.for("react.consumer"),O=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),T=Symbol.iterator;function v(ge){return ge===null||typeof ge!="object"?null:(ge=T&&ge[T]||ge["@@iterator"],typeof ge=="function"?ge:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,E={};function N(ge,je,Ne){this.props=ge,this.context=je,this.refs=E,this.updater=Ne||S}N.prototype.isReactComponent={},N.prototype.setState=function(ge,je){if(typeof ge!="object"&&typeof ge!="function"&&ge!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ge,je,"setState")},N.prototype.forceUpdate=function(ge){this.updater.enqueueForceUpdate(this,ge,"forceUpdate")};function C(){}C.prototype=N.prototype;function U(ge,je,Ne){this.props=ge,this.context=je,this.refs=E,this.updater=Ne||S}var M=U.prototype=new C;M.constructor=U,y(M,N.prototype),M.isPureReactComponent=!0;var x=Array.isArray,P={H:null,A:null,T:null,S:null,V:null},z=Object.prototype.hasOwnProperty;function Z(ge,je,Ne,Be,Ye,pt){return Ne=pt.ref,{$$typeof:G,type:ge,key:je,ref:Ne!==void 0?Ne:null,props:pt}}function I(ge,je){return Z(ge.type,je,void 0,void 0,void 0,ge.props)}function Y(ge){return typeof ge=="object"&&ge!==null&&ge.$$typeof===G}function F(ge){var je={"=":"=0",":":"=2"};return"$"+ge.replace(/[=:]/g,function(Ne){return je[Ne]})}var oe=/\/+/g;function W(ge,je){return typeof ge=="object"&&ge!==null&&ge.key!=null?F(""+ge.key):je.toString(36)}function ne(){}function ee(ge){switch(ge.status){case"fulfilled":return ge.value;case"rejected":throw ge.reason;default:switch(typeof ge.status=="string"?ge.then(ne,ne):(ge.status="pending",ge.then(function(je){ge.status==="pending"&&(ge.status="fulfilled",ge.value=je)},function(je){ge.status==="pending"&&(ge.status="rejected",ge.reason=je)})),ge.status){case"fulfilled":return ge.value;case"rejected":throw ge.reason}}throw ge}function H(ge,je,Ne,Be,Ye){var pt=typeof ge;(pt==="undefined"||pt==="boolean")&&(ge=null);var dt=!1;if(ge===null)dt=!0;else switch(pt){case"bigint":case"string":case"number":dt=!0;break;case"object":switch(ge.$$typeof){case G:case me:dt=!0;break;case f:return dt=ge._init,H(dt(ge._payload),je,Ne,Be,Ye)}}if(dt)return Ye=Ye(ge),dt=Be===""?"."+W(ge,0):Be,x(Ye)?(Ne="",dt!=null&&(Ne=dt.replace(oe,"$&/")+"/"),H(Ye,je,Ne,"",function(ft){return ft})):Ye!=null&&(Y(Ye)&&(Ye=I(Ye,Ne+(Ye.key==null||ge&&ge.key===Ye.key?"":(""+Ye.key).replace(oe,"$&/")+"/")+dt)),je.push(Ye)),1;dt=0;var Ie=Be===""?".":Be+":";if(x(ge))for(var we=0;we<ge.length;we++)Be=ge[we],pt=Ie+W(Be,we),dt+=H(Be,je,Ne,pt,Ye);else if(we=v(ge),typeof we=="function")for(ge=we.call(ge),we=0;!(Be=ge.next()).done;)Be=Be.value,pt=Ie+W(Be,we++),dt+=H(Be,je,Ne,pt,Ye);else if(pt==="object"){if(typeof ge.then=="function")return H(ee(ge),je,Ne,Be,Ye);throw je=String(ge),Error("Objects are not valid as a React child (found: "+(je==="[object Object]"?"object with keys {"+Object.keys(ge).join(", ")+"}":je)+"). If you meant to render a collection of children, use an array instead.")}return dt}function q(ge,je,Ne){if(ge==null)return ge;var Be=[],Ye=0;return H(ge,Be,"","",function(pt){return je.call(Ne,pt,Ye++)}),Be}function ve(ge){if(ge._status===-1){var je=ge._result;je=je(),je.then(function(Ne){(ge._status===0||ge._status===-1)&&(ge._status=1,ge._result=Ne)},function(Ne){(ge._status===0||ge._status===-1)&&(ge._status=2,ge._result=Ne)}),ge._status===-1&&(ge._status=0,ge._result=je)}if(ge._status===1)return ge._result.default;throw ge._result}var Le=typeof reportError=="function"?reportError:function(ge){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var je=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ge=="object"&&ge!==null&&typeof ge.message=="string"?String(ge.message):String(ge),error:ge});if(!window.dispatchEvent(je))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ge);return}console.error(ge)};function Oe(){}return Rn.Children={map:q,forEach:function(ge,je,Ne){q(ge,function(){je.apply(this,arguments)},Ne)},count:function(ge){var je=0;return q(ge,function(){je++}),je},toArray:function(ge){return q(ge,function(je){return je})||[]},only:function(ge){if(!Y(ge))throw Error("React.Children.only expected to receive a single React element child.");return ge}},Rn.Component=N,Rn.Fragment=be,Rn.Profiler=fe,Rn.PureComponent=U,Rn.StrictMode=de,Rn.Suspense=c,Rn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,Rn.__COMPILER_RUNTIME={__proto__:null,c:function(ge){return P.H.useMemoCache(ge)}},Rn.cache=function(ge){return function(){return ge.apply(null,arguments)}},Rn.cloneElement=function(ge,je,Ne){if(ge==null)throw Error("The argument must be a React element, but you passed "+ge+".");var Be=y({},ge.props),Ye=ge.key,pt=void 0;if(je!=null)for(dt in je.ref!==void 0&&(pt=void 0),je.key!==void 0&&(Ye=""+je.key),je)!z.call(je,dt)||dt==="key"||dt==="__self"||dt==="__source"||dt==="ref"&&je.ref===void 0||(Be[dt]=je[dt]);var dt=arguments.length-2;if(dt===1)Be.children=Ne;else if(1<dt){for(var Ie=Array(dt),we=0;we<dt;we++)Ie[we]=arguments[we+2];Be.children=Ie}return Z(ge.type,Ye,void 0,void 0,pt,Be)},Rn.createContext=function(ge){return ge={$$typeof:O,_currentValue:ge,_currentValue2:ge,_threadCount:0,Provider:null,Consumer:null},ge.Provider=ge,ge.Consumer={$$typeof:We,_context:ge},ge},Rn.createElement=function(ge,je,Ne){var Be,Ye={},pt=null;if(je!=null)for(Be in je.key!==void 0&&(pt=""+je.key),je)z.call(je,Be)&&Be!=="key"&&Be!=="__self"&&Be!=="__source"&&(Ye[Be]=je[Be]);var dt=arguments.length-2;if(dt===1)Ye.children=Ne;else if(1<dt){for(var Ie=Array(dt),we=0;we<dt;we++)Ie[we]=arguments[we+2];Ye.children=Ie}if(ge&&ge.defaultProps)for(Be in dt=ge.defaultProps,dt)Ye[Be]===void 0&&(Ye[Be]=dt[Be]);return Z(ge,pt,void 0,void 0,null,Ye)},Rn.createRef=function(){return{current:null}},Rn.forwardRef=function(ge){return{$$typeof:j,render:ge}},Rn.isValidElement=Y,Rn.lazy=function(ge){return{$$typeof:f,_payload:{_status:-1,_result:ge},_init:ve}},Rn.memo=function(ge,je){return{$$typeof:p,type:ge,compare:je===void 0?null:je}},Rn.startTransition=function(ge){var je=P.T,Ne={};P.T=Ne;try{var Be=ge(),Ye=P.S;Ye!==null&&Ye(Ne,Be),typeof Be=="object"&&Be!==null&&typeof Be.then=="function"&&Be.then(Oe,Le)}catch(pt){Le(pt)}finally{P.T=je}},Rn.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},Rn.use=function(ge){return P.H.use(ge)},Rn.useActionState=function(ge,je,Ne){return P.H.useActionState(ge,je,Ne)},Rn.useCallback=function(ge,je){return P.H.useCallback(ge,je)},Rn.useContext=function(ge){return P.H.useContext(ge)},Rn.useDebugValue=function(){},Rn.useDeferredValue=function(ge,je){return P.H.useDeferredValue(ge,je)},Rn.useEffect=function(ge,je,Ne){var Be=P.H;if(typeof Ne=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Be.useEffect(ge,je)},Rn.useId=function(){return P.H.useId()},Rn.useImperativeHandle=function(ge,je,Ne){return P.H.useImperativeHandle(ge,je,Ne)},Rn.useInsertionEffect=function(ge,je){return P.H.useInsertionEffect(ge,je)},Rn.useLayoutEffect=function(ge,je){return P.H.useLayoutEffect(ge,je)},Rn.useMemo=function(ge,je){return P.H.useMemo(ge,je)},Rn.useOptimistic=function(ge,je){return P.H.useOptimistic(ge,je)},Rn.useReducer=function(ge,je,Ne){return P.H.useReducer(ge,je,Ne)},Rn.useRef=function(ge){return P.H.useRef(ge)},Rn.useState=function(ge){return P.H.useState(ge)},Rn.useSyncExternalStore=function(ge,je,Ne){return P.H.useSyncExternalStore(ge,je,Ne)},Rn.useTransition=function(){return P.H.useTransition()},Rn.version="19.1.0",Rn}var Qx;function fO(){return Qx||(Qx=1,rO.exports=Y8()),rO.exports}var ot=fO();const m3=pO(ot);var nO={exports:{}},kv={},iO={exports:{}},aO={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $x;function X8(){return $x||($x=1,function(G){function me(q,ve){var Le=q.length;q.push(ve);e:for(;0<Le;){var Oe=Le-1>>>1,ge=q[Oe];if(0<fe(ge,ve))q[Oe]=ve,q[Le]=ge,Le=Oe;else break e}}function be(q){return q.length===0?null:q[0]}function de(q){if(q.length===0)return null;var ve=q[0],Le=q.pop();if(Le!==ve){q[0]=Le;e:for(var Oe=0,ge=q.length,je=ge>>>1;Oe<je;){var Ne=2*(Oe+1)-1,Be=q[Ne],Ye=Ne+1,pt=q[Ye];if(0>fe(Be,Le))Ye<ge&&0>fe(pt,Be)?(q[Oe]=pt,q[Ye]=Le,Oe=Ye):(q[Oe]=Be,q[Ne]=Le,Oe=Ne);else if(Ye<ge&&0>fe(pt,Le))q[Oe]=pt,q[Ye]=Le,Oe=Ye;else break e}}return ve}function fe(q,ve){var Le=q.sortIndex-ve.sortIndex;return Le!==0?Le:q.id-ve.id}if(G.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var We=performance;G.unstable_now=function(){return We.now()}}else{var O=Date,j=O.now();G.unstable_now=function(){return O.now()-j}}var c=[],p=[],f=1,T=null,v=3,S=!1,y=!1,E=!1,N=!1,C=typeof setTimeout=="function"?setTimeout:null,U=typeof clearTimeout=="function"?clearTimeout:null,M=typeof setImmediate<"u"?setImmediate:null;function x(q){for(var ve=be(p);ve!==null;){if(ve.callback===null)de(p);else if(ve.startTime<=q)de(p),ve.sortIndex=ve.expirationTime,me(c,ve);else break;ve=be(p)}}function P(q){if(E=!1,x(q),!y)if(be(c)!==null)y=!0,z||(z=!0,W());else{var ve=be(p);ve!==null&&H(P,ve.startTime-q)}}var z=!1,Z=-1,I=5,Y=-1;function F(){return N?!0:!(G.unstable_now()-Y<I)}function oe(){if(N=!1,z){var q=G.unstable_now();Y=q;var ve=!0;try{e:{y=!1,E&&(E=!1,U(Z),Z=-1),S=!0;var Le=v;try{t:{for(x(q),T=be(c);T!==null&&!(T.expirationTime>q&&F());){var Oe=T.callback;if(typeof Oe=="function"){T.callback=null,v=T.priorityLevel;var ge=Oe(T.expirationTime<=q);if(q=G.unstable_now(),typeof ge=="function"){T.callback=ge,x(q),ve=!0;break t}T===be(c)&&de(c),x(q)}else de(c);T=be(c)}if(T!==null)ve=!0;else{var je=be(p);je!==null&&H(P,je.startTime-q),ve=!1}}break e}finally{T=null,v=Le,S=!1}ve=void 0}}finally{ve?W():z=!1}}}var W;if(typeof M=="function")W=function(){M(oe)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,ee=ne.port2;ne.port1.onmessage=oe,W=function(){ee.postMessage(null)}}else W=function(){C(oe,0)};function H(q,ve){Z=C(function(){q(G.unstable_now())},ve)}G.unstable_IdlePriority=5,G.unstable_ImmediatePriority=1,G.unstable_LowPriority=4,G.unstable_NormalPriority=3,G.unstable_Profiling=null,G.unstable_UserBlockingPriority=2,G.unstable_cancelCallback=function(q){q.callback=null},G.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<q?Math.floor(1e3/q):5},G.unstable_getCurrentPriorityLevel=function(){return v},G.unstable_next=function(q){switch(v){case 1:case 2:case 3:var ve=3;break;default:ve=v}var Le=v;v=ve;try{return q()}finally{v=Le}},G.unstable_requestPaint=function(){N=!0},G.unstable_runWithPriority=function(q,ve){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var Le=v;v=q;try{return ve()}finally{v=Le}},G.unstable_scheduleCallback=function(q,ve,Le){var Oe=G.unstable_now();switch(typeof Le=="object"&&Le!==null?(Le=Le.delay,Le=typeof Le=="number"&&0<Le?Oe+Le:Oe):Le=Oe,q){case 1:var ge=-1;break;case 2:ge=250;break;case 5:ge=1073741823;break;case 4:ge=1e4;break;default:ge=5e3}return ge=Le+ge,q={id:f++,callback:ve,priorityLevel:q,startTime:Le,expirationTime:ge,sortIndex:-1},Le>Oe?(q.sortIndex=Le,me(p,q),be(c)===null&&q===be(p)&&(E?(U(Z),Z=-1):E=!0,H(P,Le-Oe))):(q.sortIndex=ge,me(c,q),y||S||(y=!0,z||(z=!0,W()))),q},G.unstable_shouldYield=F,G.unstable_wrapCallback=function(q){var ve=v;return function(){var Le=v;v=ve;try{return q.apply(this,arguments)}finally{v=Le}}}}(aO)),aO}var e3;function J8(){return e3||(e3=1,iO.exports=X8()),iO.exports}var oO={exports:{}},ho={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var t3;function Z8(){if(t3)return ho;t3=1;var G=fO();function me(c){var p="https://react.dev/errors/"+c;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var f=2;f<arguments.length;f++)p+="&args[]="+encodeURIComponent(arguments[f])}return"Minified React error #"+c+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function be(){}var de={d:{f:be,r:function(){throw Error(me(522))},D:be,C:be,L:be,m:be,X:be,S:be,M:be},p:0,findDOMNode:null},fe=Symbol.for("react.portal");function We(c,p,f){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:fe,key:T==null?null:""+T,children:c,containerInfo:p,implementation:f}}var O=G.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function j(c,p){if(c==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return ho.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=de,ho.createPortal=function(c,p){var f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(me(299));return We(c,p,null,f)},ho.flushSync=function(c){var p=O.T,f=de.p;try{if(O.T=null,de.p=2,c)return c()}finally{O.T=p,de.p=f,de.d.f()}},ho.preconnect=function(c,p){typeof c=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,de.d.C(c,p))},ho.prefetchDNS=function(c){typeof c=="string"&&de.d.D(c)},ho.preinit=function(c,p){if(typeof c=="string"&&p&&typeof p.as=="string"){var f=p.as,T=j(f,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,S=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;f==="style"?de.d.S(c,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:T,integrity:v,fetchPriority:S}):f==="script"&&de.d.X(c,{crossOrigin:T,integrity:v,fetchPriority:S,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},ho.preinitModule=function(c,p){if(typeof c=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var f=j(p.as,p.crossOrigin);de.d.M(c,{crossOrigin:f,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&de.d.M(c)},ho.preload=function(c,p){if(typeof c=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var f=p.as,T=j(f,p.crossOrigin);de.d.L(c,f,{crossOrigin:T,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},ho.preloadModule=function(c,p){if(typeof c=="string")if(p){var f=j(p.as,p.crossOrigin);de.d.m(c,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:f,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else de.d.m(c)},ho.requestFormReset=function(c){de.d.r(c)},ho.unstable_batchedUpdates=function(c,p){return c(p)},ho.useFormState=function(c,p,f){return O.H.useFormState(c,p,f)},ho.useFormStatus=function(){return O.H.useHostTransitionStatus()},ho.version="19.1.0",ho}var r3;function Q8(){if(r3)return oO.exports;r3=1;function G(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(G)}catch(me){console.error(me)}}return G(),oO.exports=Z8(),oO.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n3;function $8(){if(n3)return kv;n3=1;var G=J8(),me=fO(),be=Q8();function de(a){var s="https://react.dev/errors/"+a;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+a+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function fe(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function We(a){var s=a,d=a;if(a.alternate)for(;s.return;)s=s.return;else{a=s;do s=a,(s.flags&4098)!==0&&(d=s.return),a=s.return;while(a)}return s.tag===3?d:null}function O(a){if(a.tag===13){var s=a.memoizedState;if(s===null&&(a=a.alternate,a!==null&&(s=a.memoizedState)),s!==null)return s.dehydrated}return null}function j(a){if(We(a)!==a)throw Error(de(188))}function c(a){var s=a.alternate;if(!s){if(s=We(a),s===null)throw Error(de(188));return s!==a?null:a}for(var d=a,g=s;;){var b=d.return;if(b===null)break;var k=b.alternate;if(k===null){if(g=b.return,g!==null){d=g;continue}break}if(b.child===k.child){for(k=b.child;k;){if(k===d)return j(b),a;if(k===g)return j(b),s;k=k.sibling}throw Error(de(188))}if(d.return!==g.return)d=b,g=k;else{for(var _e=!1,Pe=b.child;Pe;){if(Pe===d){_e=!0,d=b,g=k;break}if(Pe===g){_e=!0,g=b,d=k;break}Pe=Pe.sibling}if(!_e){for(Pe=k.child;Pe;){if(Pe===d){_e=!0,d=k,g=b;break}if(Pe===g){_e=!0,g=k,d=b;break}Pe=Pe.sibling}if(!_e)throw Error(de(189))}}if(d.alternate!==g)throw Error(de(190))}if(d.tag!==3)throw Error(de(188));return d.stateNode.current===d?a:s}function p(a){var s=a.tag;if(s===5||s===26||s===27||s===6)return a;for(a=a.child;a!==null;){if(s=p(a),s!==null)return s;a=a.sibling}return null}var f=Object.assign,T=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),N=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),U=Symbol.for("react.consumer"),M=Symbol.for("react.context"),x=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),z=Symbol.for("react.suspense_list"),Z=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),Y=Symbol.for("react.activity"),F=Symbol.for("react.memo_cache_sentinel"),oe=Symbol.iterator;function W(a){return a===null||typeof a!="object"?null:(a=oe&&a[oe]||a["@@iterator"],typeof a=="function"?a:null)}var ne=Symbol.for("react.client.reference");function ee(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===ne?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case y:return"Fragment";case N:return"Profiler";case E:return"StrictMode";case P:return"Suspense";case z:return"SuspenseList";case Y:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case S:return"Portal";case M:return(a.displayName||"Context")+".Provider";case U:return(a._context.displayName||"Context")+".Consumer";case x:var s=a.render;return a=a.displayName,a||(a=s.displayName||s.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case Z:return s=a.displayName||null,s!==null?s:ee(a.type)||"Memo";case I:s=a._payload,a=a._init;try{return ee(a(s))}catch{}}return null}var H=Array.isArray,q=me.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ve=be.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Le={pending:!1,data:null,method:null,action:null},Oe=[],ge=-1;function je(a){return{current:a}}function Ne(a){0>ge||(a.current=Oe[ge],Oe[ge]=null,ge--)}function Be(a,s){ge++,Oe[ge]=a.current,a.current=s}var Ye=je(null),pt=je(null),dt=je(null),Ie=je(null);function we(a,s){switch(Be(dt,s),Be(pt,a),Be(Ye,null),s.nodeType){case 9:case 11:a=(a=s.documentElement)&&(a=a.namespaceURI)?Oy(a):0;break;default:if(a=s.tagName,s=s.namespaceURI)s=Oy(s),a=Ny(s,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}Ne(Ye),Be(Ye,a)}function ft(){Ne(Ye),Ne(pt),Ne(dt)}function qe(a){a.memoizedState!==null&&Be(Ie,a);var s=Ye.current,d=Ny(s,a.type);s!==d&&(Be(pt,a),Be(Ye,d))}function it(a){pt.current===a&&(Ne(Ye),Ne(pt)),Ie.current===a&&(Ne(Ie),Ud._currentValue=Le)}var Tt=Object.prototype.hasOwnProperty,Pt=G.unstable_scheduleCallback,bt=G.unstable_cancelCallback,jt=G.unstable_shouldYield,Lt=G.unstable_requestPaint,Gt=G.unstable_now,pr=G.unstable_getCurrentPriorityLevel,ir=G.unstable_ImmediatePriority,Ar=G.unstable_UserBlockingPriority,er=G.unstable_NormalPriority,yt=G.unstable_LowPriority,Xt=G.unstable_IdlePriority,Ir=G.log,St=G.unstable_setDisableYieldValue,Wt=null,Zt=null;function Kt(a){if(typeof Ir=="function"&&St(a),Zt&&typeof Zt.setStrictMode=="function")try{Zt.setStrictMode(Wt,a)}catch{}}var At=Math.clz32?Math.clz32:vr,vt=Math.log,zt=Math.LN2;function vr(a){return a>>>=0,a===0?32:31-(vt(a)/zt|0)|0}var or=256,mr=4194304;function ae(a){var s=a&42;if(s!==0)return s;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Ae(a,s,d){var g=a.pendingLanes;if(g===0)return 0;var b=0,k=a.suspendedLanes,_e=a.pingedLanes;a=a.warmLanes;var Pe=g&134217727;return Pe!==0?(g=Pe&~k,g!==0?b=ae(g):(_e&=Pe,_e!==0?b=ae(_e):d||(d=Pe&~a,d!==0&&(b=ae(d))))):(Pe=g&~k,Pe!==0?b=ae(Pe):_e!==0?b=ae(_e):d||(d=g&~a,d!==0&&(b=ae(d)))),b===0?0:s!==0&&s!==b&&(s&k)===0&&(k=b&-b,d=s&-s,k>=d||k===32&&(d&4194048)!==0)?s:b}function le(a,s){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&s)===0}function Xe(a,s){switch(a){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function X(){var a=or;return or<<=1,(or&4194048)===0&&(or=256),a}function et(){var a=mr;return mr<<=1,(mr&62914560)===0&&(mr=4194304),a}function Me(a){for(var s=[],d=0;31>d;d++)s.push(a);return s}function He(a,s){a.pendingLanes|=s,s!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function Qe(a,s,d,g,b,k){var _e=a.pendingLanes;a.pendingLanes=d,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=d,a.entangledLanes&=d,a.errorRecoveryDisabledLanes&=d,a.shellSuspendCounter=0;var Pe=a.entanglements,ut=a.expirationTimes,Bt=a.hiddenUpdates;for(d=_e&~d;0<d;){var $t=31-At(d),Er=1<<$t;Pe[$t]=0,ut[$t]=-1;var Ht=Bt[$t];if(Ht!==null)for(Bt[$t]=null,$t=0;$t<Ht.length;$t++){var qt=Ht[$t];qt!==null&&(qt.lane&=-536870913)}d&=~Er}g!==0&&ht(a,g,0),k!==0&&b===0&&a.tag!==0&&(a.suspendedLanes|=k&~(_e&~s))}function ht(a,s,d){a.pendingLanes|=s,a.suspendedLanes&=~s;var g=31-At(s);a.entangledLanes|=s,a.entanglements[g]=a.entanglements[g]|1073741824|d&4194090}function rt(a,s){var d=a.entangledLanes|=s;for(a=a.entanglements;d;){var g=31-At(d),b=1<<g;b&s|a[g]&s&&(a[g]|=s),d&=~b}}function Ct(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function xt(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function Nt(){var a=ve.p;return a!==0?a:(a=window.event,a===void 0?32:Xy(a.type))}function yr(a,s){var d=ve.p;try{return ve.p=a,s()}finally{ve.p=d}}var w=Math.random().toString(36).slice(2),te="__reactFiber$"+w,Re="__reactProps$"+w,re="__reactContainer$"+w,Ee="__reactEvents$"+w,Ge="__reactListeners$"+w,he="__reactHandles$"+w,$e="__reactResources$"+w,ye="__reactMarker$"+w;function lt(a){delete a[te],delete a[Re],delete a[Ee],delete a[Ge],delete a[he]}function Ze(a){var s=a[te];if(s)return s;for(var d=a.parentNode;d;){if(s=d[re]||d[te]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(a=Py(a);a!==null;){if(d=a[te])return d;a=Py(a)}return s}a=d,d=a.parentNode}return null}function Dt(a){if(a=a[te]||a[re]){var s=a.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return a}return null}function Q(a){var s=a.tag;if(s===5||s===26||s===27||s===6)return a.stateNode;throw Error(de(33))}function Te(a){var s=a[$e];return s||(s=a[$e]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function pe(a){a[ye]=!0}var Ue=new Set,xe={};function Fe(a,s){Je(a,s),Je(a+"Capture",s)}function Je(a,s){for(xe[a]=s,a=0;a<s.length;a++)Ue.add(s[a])}var ct=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),kt={},mt={};function Jt(a){return Tt.call(mt,a)?!0:Tt.call(kt,a)?!1:ct.test(a)?mt[a]=!0:(kt[a]=!0,!1)}function Rr(a,s,d){if(Jt(s))if(d===null)a.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":a.removeAttribute(s);return;case"boolean":var g=s.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){a.removeAttribute(s);return}}a.setAttribute(s,""+d)}}function Or(a,s,d){if(d===null)a.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(s);return}a.setAttribute(s,""+d)}}function It(a,s,d,g){if(g===null)a.removeAttribute(d);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(d);return}a.setAttributeNS(s,d,""+g)}}var Sr,Yr;function xr(a){if(Sr===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);Sr=s&&s[1]||"",Yr=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Sr+a+Yr}var Tn=!1;function Cn(a,s){if(!a||Tn)return"";Tn=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(s){var Er=function(){throw Error()};if(Object.defineProperty(Er.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Er,[])}catch(qt){var Ht=qt}Reflect.construct(a,[],Er)}else{try{Er.call()}catch(qt){Ht=qt}a.call(Er.prototype)}}else{try{throw Error()}catch(qt){Ht=qt}(Er=a())&&typeof Er.catch=="function"&&Er.catch(function(){})}}catch(qt){if(qt&&Ht&&typeof qt.stack=="string")return[qt.stack,Ht.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var k=g.DetermineComponentFrameRoot(),_e=k[0],Pe=k[1];if(_e&&Pe){var ut=_e.split(`
`),Bt=Pe.split(`
`);for(b=g=0;g<ut.length&&!ut[g].includes("DetermineComponentFrameRoot");)g++;for(;b<Bt.length&&!Bt[b].includes("DetermineComponentFrameRoot");)b++;if(g===ut.length||b===Bt.length)for(g=ut.length-1,b=Bt.length-1;1<=g&&0<=b&&ut[g]!==Bt[b];)b--;for(;1<=g&&0<=b;g--,b--)if(ut[g]!==Bt[b]){if(g!==1||b!==1)do if(g--,b--,0>b||ut[g]!==Bt[b]){var $t=`
`+ut[g].replace(" at new "," at ");return a.displayName&&$t.includes("<anonymous>")&&($t=$t.replace("<anonymous>",a.displayName)),$t}while(1<=g&&0<=b);break}}}finally{Tn=!1,Error.prepareStackTrace=d}return(d=a?a.displayName||a.name:"")?xr(d):""}function Oi(a){switch(a.tag){case 26:case 27:case 5:return xr(a.type);case 16:return xr("Lazy");case 13:return xr("Suspense");case 19:return xr("SuspenseList");case 0:case 15:return Cn(a.type,!1);case 11:return Cn(a.type.render,!1);case 1:return Cn(a.type,!0);case 31:return xr("Activity");default:return""}}function li(a){try{var s="";do s+=Oi(a),a=a.return;while(a);return s}catch(d){return`
Error generating stack: `+d.message+`
`+d.stack}}function Zr(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function ma(a){var s=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Co(a){var s=ma(a)?"checked":"value",d=Object.getOwnPropertyDescriptor(a.constructor.prototype,s),g=""+a[s];if(!a.hasOwnProperty(s)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var b=d.get,k=d.set;return Object.defineProperty(a,s,{configurable:!0,get:function(){return b.call(this)},set:function(_e){g=""+_e,k.call(this,_e)}}),Object.defineProperty(a,s,{enumerable:d.enumerable}),{getValue:function(){return g},setValue:function(_e){g=""+_e},stopTracking:function(){a._valueTracker=null,delete a[s]}}}}function mn(a){a._valueTracker||(a._valueTracker=Co(a))}function ys(a){if(!a)return!1;var s=a._valueTracker;if(!s)return!0;var d=s.getValue(),g="";return a&&(g=ma(a)?a.checked?"true":"false":a.value),a=g,a!==d?(s.setValue(a),!0):!1}function Wo(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Ko=/[\n"\\]/g;function Wi(a){return a.replace(Ko,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function zo(a,s,d,g,b,k,_e,Pe){a.name="",_e!=null&&typeof _e!="function"&&typeof _e!="symbol"&&typeof _e!="boolean"?a.type=_e:a.removeAttribute("type"),s!=null?_e==="number"?(s===0&&a.value===""||a.value!=s)&&(a.value=""+Zr(s)):a.value!==""+Zr(s)&&(a.value=""+Zr(s)):_e!=="submit"&&_e!=="reset"||a.removeAttribute("value"),s!=null?Ss(a,_e,Zr(s)):d!=null?Ss(a,_e,Zr(d)):g!=null&&a.removeAttribute("value"),b==null&&k!=null&&(a.defaultChecked=!!k),b!=null&&(a.checked=b&&typeof b!="function"&&typeof b!="symbol"),Pe!=null&&typeof Pe!="function"&&typeof Pe!="symbol"&&typeof Pe!="boolean"?a.name=""+Zr(Pe):a.removeAttribute("name")}function qo(a,s,d,g,b,k,_e,Pe){if(k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(a.type=k),s!=null||d!=null){if(!(k!=="submit"&&k!=="reset"||s!=null))return;d=d!=null?""+Zr(d):"",s=s!=null?""+Zr(s):d,Pe||s===a.value||(a.value=s),a.defaultValue=s}g=g??b,g=typeof g!="function"&&typeof g!="symbol"&&!!g,a.checked=Pe?a.checked:!!g,a.defaultChecked=!!g,_e!=null&&typeof _e!="function"&&typeof _e!="symbol"&&typeof _e!="boolean"&&(a.name=_e)}function Ss(a,s,d){s==="number"&&Wo(a.ownerDocument)===a||a.defaultValue===""+d||(a.defaultValue=""+d)}function ja(a,s,d,g){if(a=a.options,s){s={};for(var b=0;b<d.length;b++)s["$"+d[b]]=!0;for(d=0;d<a.length;d++)b=s.hasOwnProperty("$"+a[d].value),a[d].selected!==b&&(a[d].selected=b),b&&g&&(a[d].defaultSelected=!0)}else{for(d=""+Zr(d),s=null,b=0;b<a.length;b++){if(a[b].value===d){a[b].selected=!0,g&&(a[b].defaultSelected=!0);return}s!==null||a[b].disabled||(s=a[b])}s!==null&&(s.selected=!0)}}function ic(a,s,d){if(s!=null&&(s=""+Zr(s),s!==a.value&&(a.value=s),d==null)){a.defaultValue!==s&&(a.defaultValue=s);return}a.defaultValue=d!=null?""+Zr(d):""}function Tr(a,s,d,g){if(s==null){if(g!=null){if(d!=null)throw Error(de(92));if(H(g)){if(1<g.length)throw Error(de(93));g=g[0]}d=g}d==null&&(d=""),s=d}d=Zr(s),a.defaultValue=d,g=a.textContent,g===d&&g!==""&&g!==null&&(a.value=g)}function yn(a,s){if(s){var d=a.firstChild;if(d&&d===a.lastChild&&d.nodeType===3){d.nodeValue=s;return}}a.textContent=s}var nr=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Jl(a,s,d){var g=s.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?g?a.setProperty(s,""):s==="float"?a.cssFloat="":a[s]="":g?a.setProperty(s,d):typeof d!="number"||d===0||nr.has(s)?s==="float"?a.cssFloat=d:a[s]=(""+d).trim():a[s]=d+"px"}function Rs(a,s,d){if(s!=null&&typeof s!="object")throw Error(de(62));if(a=a.style,d!=null){for(var g in d)!d.hasOwnProperty(g)||s!=null&&s.hasOwnProperty(g)||(g.indexOf("--")===0?a.setProperty(g,""):g==="float"?a.cssFloat="":a[g]="");for(var b in s)g=s[b],s.hasOwnProperty(b)&&d[b]!==g&&Jl(a,b,g)}else for(var k in s)s.hasOwnProperty(k)&&Jl(a,k,s[k])}function Zl(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Yu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ql=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Yc(a){return Ql.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}var $l=null;function Cs(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Yo=null,ac=null;function ph(a){var s=Dt(a);if(s&&(a=s.stateNode)){var d=a[Re]||null;e:switch(a=s.stateNode,s.type){case"input":if(zo(a,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),s=d.name,d.type==="radio"&&s!=null){for(d=a;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Wi(""+s)+'"][type="radio"]'),s=0;s<d.length;s++){var g=d[s];if(g!==a&&g.form===a.form){var b=g[Re]||null;if(!b)throw Error(de(90));zo(g,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(s=0;s<d.length;s++)g=d[s],g.form===a.form&&ys(g)}break e;case"textarea":ic(a,d.value,d.defaultValue);break e;case"select":s=d.value,s!=null&&ja(a,!!d.multiple,s,!1)}}}var Xu=!1;function Is(a,s,d){if(Xu)return a(s,d);Xu=!0;try{var g=a(s);return g}finally{if(Xu=!1,(Yo!==null||ac!==null)&&(lm(),Yo&&(s=Yo,a=ac,ac=Yo=null,ph(s),a)))for(s=0;s<a.length;s++)ph(a[s])}}function Xc(a,s){var d=a.stateNode;if(d===null)return null;var g=d[Re]||null;if(g===null)return null;d=g[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(a=a.type,g=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!g;break e;default:a=!1}if(a)return null;if(d&&typeof d!="function")throw Error(de(231,s,typeof d));return d}var Io=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ju=!1;if(Io)try{var Ao={};Object.defineProperty(Ao,"passive",{get:function(){Ju=!0}}),window.addEventListener("test",Ao,Ao),window.removeEventListener("test",Ao,Ao)}catch{Ju=!1}var Xo=null,Zu=null,oc=null;function As(){if(oc)return oc;var a,s=Zu,d=s.length,g,b="value"in Xo?Xo.value:Xo.textContent,k=b.length;for(a=0;a<d&&s[a]===b[a];a++);var _e=d-a;for(g=1;g<=_e&&s[d-g]===b[k-g];g++);return oc=b.slice(a,1<g?1-g:void 0)}function sc(a){var s=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&s===13&&(a=13)):a=s,a===10&&(a=13),32<=a||a===13?a:0}function eu(){return!0}function fh(){return!1}function Ta(a){function s(d,g,b,k,_e){this._reactName=d,this._targetInst=b,this.type=g,this.nativeEvent=k,this.target=_e,this.currentTarget=null;for(var Pe in a)a.hasOwnProperty(Pe)&&(d=a[Pe],this[Pe]=d?d(k):k[Pe]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?eu:fh,this.isPropagationStopped=fh,this}return f(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=eu)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=eu)},persist:function(){},isPersistent:eu}),s}var Ea={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ui=Ta(Ea),cc=f({},Ea,{view:0,detail:0}),Fn=Ta(cc),Jc,tu,ui,Jo=f({},cc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:UE,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==ui&&(ui&&a.type==="mousemove"?(Jc=a.screenX-ui.screenX,tu=a.screenY-ui.screenY):tu=Jc=0,ui=a),Jc)},movementY:function(a){return"movementY"in a?a.movementY:tu}}),Si=Ta(Jo),Qi=f({},Jo,{dataTransfer:0}),lc=Ta(Qi),Qu=f({},cc,{relatedTarget:0}),ru=Ta(Qu),nu=f({},Ea,{animationName:0,elapsedTime:0,pseudoElement:0}),bs=Ta(nu),mh=f({},Ea,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),xi=Ta(mh),ji=f({},Ea,{data:0}),Ja=Ta(ji),Eh={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Zc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},af={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function S0(a){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(a):(a=af[a])?!!s[a]:!1}function UE(){return S0}var R0=f({},cc,{key:function(a){if(a.key){var s=Eh[a.key]||a.key;if(s!=="Unidentified")return s}return a.type==="keypress"?(a=sc(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Zc[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:UE,charCode:function(a){return a.type==="keypress"?sc(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?sc(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),C0=Ta(R0),I0=f({},Jo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),iu=Ta(I0),A0=f({},cc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:UE}),$u=Ta(A0),Fv=f({},Ea,{propertyName:0,elapsedTime:0,pseudoElement:0}),b0=Ta(Fv),dn=f({},Jo,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),O0=Ta(dn),N0=f({},Ea,{newState:0,oldState:0}),w0=Ta(N0),D0=[9,13,27,32],_h=Io&&"CompositionEvent"in window,gh=null;Io&&"documentMode"in document&&(gh=document.documentMode);var P0=Io&&"TextEvent"in window&&!gh,Gv=Io&&(!_h||gh&&8<gh&&11>=gh),of=" ",Hv=!1;function Wv(a,s){switch(a){case"keyup":return D0.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xE(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var ed=!1;function uc(a,s){switch(a){case"compositionend":return xE(s);case"keypress":return s.which!==32?null:(Hv=!0,of);case"textInput":return a=s.data,a===of&&Hv?null:a;default:return null}}function L0(a,s){if(ed)return a==="compositionend"||!_h&&Wv(a,s)?(a=As(),oc=Zu=Xo=null,ed=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Gv&&s.locale!=="ko"?null:s.data;default:return null}}var k0={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Kv(a){var s=a&&a.nodeName&&a.nodeName.toLowerCase();return s==="input"?!!k0[a.type]:s==="textarea"}function jE(a,s,d,g){Yo?ac?ac.push(g):ac=[g]:Yo=g,s=Sm(s,"onChange"),0<s.length&&(d=new Ui("onChange","change",null,d,g),a.push({event:d,listeners:s}))}var au=null,vh=null;function M0(a){Cy(a,0)}function Ba(a){var s=Q(a);if(ys(s))return a}function zv(a,s){if(a==="change")return s}var qv=!1;if(Io){var BE;if(Io){var VE="oninput"in document;if(!VE){var FE=document.createElement("div");FE.setAttribute("oninput","return;"),VE=typeof FE.oninput=="function"}BE=VE}else BE=!1;qv=BE&&(!document.documentMode||9<document.documentMode)}function Yv(){au&&(au.detachEvent("onpropertychange",Xv),vh=au=null)}function Xv(a){if(a.propertyName==="value"&&Ba(vh)){var s=[];jE(s,vh,a,Cs(a)),Is(M0,s)}}function Jv(a,s,d){a==="focusin"?(Yv(),au=s,vh=d,au.attachEvent("onpropertychange",Xv)):a==="focusout"&&Yv()}function GE(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return Ba(vh)}function U0(a,s){if(a==="click")return Ba(s)}function x0(a,s){if(a==="input"||a==="change")return Ba(s)}function sf(a,s){return a===s&&(a!==0||1/a===1/s)||a!==a&&s!==s}var fo=typeof Object.is=="function"?Object.is:sf;function Th(a,s){if(fo(a,s))return!0;if(typeof a!="object"||a===null||typeof s!="object"||s===null)return!1;var d=Object.keys(a),g=Object.keys(s);if(d.length!==g.length)return!1;for(g=0;g<d.length;g++){var b=d[g];if(!Tt.call(s,b)||!fo(a[b],s[b]))return!1}return!0}function Zv(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function Zo(a,s){var d=Zv(a);a=0;for(var g;d;){if(d.nodeType===3){if(g=a+d.textContent.length,a<=s&&g>=s)return{node:d,offset:s-a};a=g}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Zv(d)}}function Qv(a,s){return a&&s?a===s?!0:a&&a.nodeType===3?!1:s&&s.nodeType===3?Qv(a,s.parentNode):"contains"in a?a.contains(s):a.compareDocumentPosition?!!(a.compareDocumentPosition(s)&16):!1:!1}function $v(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var s=Wo(a.document);s instanceof a.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)a=s.contentWindow;else break;s=Wo(a.document)}return s}function Va(a){var s=a&&a.nodeName&&a.nodeName.toLowerCase();return s&&(s==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||s==="textarea"||a.contentEditable==="true")}var j0=Io&&"documentMode"in document&&11>=document.documentMode,td=null,HE=null,yh=null,cf=!1;function eT(a,s,d){var g=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;cf||td==null||td!==Wo(g)||(g=td,"selectionStart"in g&&Va(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),yh&&Th(yh,g)||(yh=g,g=Sm(HE,"onSelect"),0<g.length&&(s=new Ui("onSelect","select",null,s,d),a.push({event:s,listeners:g}),s.target=td)))}function ou(a,s){var d={};return d[a.toLowerCase()]=s.toLowerCase(),d["Webkit"+a]="webkit"+s,d["Moz"+a]="moz"+s,d}var rd={animationend:ou("Animation","AnimationEnd"),animationiteration:ou("Animation","AnimationIteration"),animationstart:ou("Animation","AnimationStart"),transitionrun:ou("Transition","TransitionRun"),transitionstart:ou("Transition","TransitionStart"),transitioncancel:ou("Transition","TransitionCancel"),transitionend:ou("Transition","TransitionEnd")},lf={},tT={};Io&&(tT=document.createElement("div").style,"AnimationEvent"in window||(delete rd.animationend.animation,delete rd.animationiteration.animation,delete rd.animationstart.animation),"TransitionEvent"in window||delete rd.transitionend.transition);function su(a){if(lf[a])return lf[a];if(!rd[a])return a;var s=rd[a],d;for(d in s)if(s.hasOwnProperty(d)&&d in tT)return lf[a]=s[d];return a}var uf=su("animationend"),df=su("animationiteration"),rT=su("animationstart"),Qt=su("transitionrun"),B0=su("transitionstart"),V0=su("transitioncancel"),nT=su("transitionend"),iT=new Map,WE="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");WE.push("scrollEnd");function Qo(a,s){iT.set(a,s),Fe(s,[a])}var aT=new WeakMap;function bo(a,s){if(typeof a=="object"&&a!==null){var d=aT.get(a);return d!==void 0?d:(s={value:a,source:s,stack:li(s)},aT.set(a,s),s)}return{value:a,source:s,stack:li(s)}}var Fa=[],$o=0,KE=0;function hf(){for(var a=$o,s=KE=$o=0;s<a;){var d=Fa[s];Fa[s++]=null;var g=Fa[s];Fa[s++]=null;var b=Fa[s];Fa[s++]=null;var k=Fa[s];if(Fa[s++]=null,g!==null&&b!==null){var _e=g.pending;_e===null?b.next=b:(b.next=_e.next,_e.next=b),g.pending=b}k!==0&&oT(d,b,k)}}function pf(a,s,d,g){Fa[$o++]=a,Fa[$o++]=s,Fa[$o++]=d,Fa[$o++]=g,KE|=g,a.lanes|=g,a=a.alternate,a!==null&&(a.lanes|=g)}function zE(a,s,d,g){return pf(a,s,d,g),Sh(a)}function Qc(a,s){return pf(a,null,null,s),Sh(a)}function oT(a,s,d){a.lanes|=d;var g=a.alternate;g!==null&&(g.lanes|=d);for(var b=!1,k=a.return;k!==null;)k.childLanes|=d,g=k.alternate,g!==null&&(g.childLanes|=d),k.tag===22&&(a=k.stateNode,a===null||a._visibility&1||(b=!0)),a=k,k=k.return;return a.tag===3?(k=a.stateNode,b&&s!==null&&(b=31-At(d),a=k.hiddenUpdates,g=a[b],g===null?a[b]=[s]:g.push(s),s.lane=d|536870912),k):null}function Sh(a){if(50<xs)throw xs=0,Ac=null,Error(de(185));for(var s=a.return;s!==null;)a=s,s=a.return;return a.tag===3?a.stateNode:null}var wa={};function F0(a,s,d,g){this.tag=a,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ya(a,s,d,g){return new F0(a,s,d,g)}function qE(a){return a=a.prototype,!(!a||!a.isReactComponent)}function dc(a,s){var d=a.alternate;return d===null?(d=ya(a.tag,s,a.key,a.mode),d.elementType=a.elementType,d.type=a.type,d.stateNode=a.stateNode,d.alternate=a,a.alternate=d):(d.pendingProps=s,d.type=a.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=a.flags&65011712,d.childLanes=a.childLanes,d.lanes=a.lanes,d.child=a.child,d.memoizedProps=a.memoizedProps,d.memoizedState=a.memoizedState,d.updateQueue=a.updateQueue,s=a.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=a.sibling,d.index=a.index,d.ref=a.ref,d.refCleanup=a.refCleanup,d}function sT(a,s){a.flags&=65011714;var d=a.alternate;return d===null?(a.childLanes=0,a.lanes=s,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=d.childLanes,a.lanes=d.lanes,a.child=d.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=d.memoizedProps,a.memoizedState=d.memoizedState,a.updateQueue=d.updateQueue,a.type=d.type,s=d.dependencies,a.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),a}function Rh(a,s,d,g,b,k){var _e=0;if(g=a,typeof a=="function")qE(a)&&(_e=1);else if(typeof a=="string")_e=yC(a,d,Ye.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case Y:return a=ya(31,d,s,b),a.elementType=Y,a.lanes=k,a;case y:return cu(d.children,b,k,s);case E:_e=8,b|=24;break;case N:return a=ya(12,d,s,b|2),a.elementType=N,a.lanes=k,a;case P:return a=ya(13,d,s,b),a.elementType=P,a.lanes=k,a;case z:return a=ya(19,d,s,b),a.elementType=z,a.lanes=k,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case C:case M:_e=10;break e;case U:_e=9;break e;case x:_e=11;break e;case Z:_e=14;break e;case I:_e=16,g=null;break e}_e=29,d=Error(de(130,a===null?"null":typeof a,"")),g=null}return s=ya(_e,d,s,b),s.elementType=a,s.type=g,s.lanes=k,s}function cu(a,s,d,g){return a=ya(7,a,g,s),a.lanes=d,a}function YE(a,s,d){return a=ya(6,a,null,s),a.lanes=d,a}function XE(a,s,d){return s=ya(4,a.children!==null?a.children:[],a.key,s),s.lanes=d,s.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},s}var $c=[],nd=0,Ch=null,Ih=0,Oo=[],mo=0,Os=null,hc=1,pc="";function lu(a,s){$c[nd++]=Ih,$c[nd++]=Ch,Ch=a,Ih=s}function cT(a,s,d){Oo[mo++]=hc,Oo[mo++]=pc,Oo[mo++]=Os,Os=a;var g=hc;a=pc;var b=32-At(g)-1;g&=~(1<<b),d+=1;var k=32-At(s)+b;if(30<k){var _e=b-b%5;k=(g&(1<<_e)-1).toString(32),g>>=_e,b-=_e,hc=1<<32-At(s)+b|d<<b|g,pc=k+a}else hc=1<<k|d<<b|g,pc=a}function JE(a){a.return!==null&&(lu(a,1),cT(a,1,0))}function ff(a){for(;a===Ch;)Ch=$c[--nd],$c[nd]=null,Ih=$c[--nd],$c[nd]=null;for(;a===Os;)Os=Oo[--mo],Oo[mo]=null,pc=Oo[--mo],Oo[mo]=null,hc=Oo[--mo],Oo[mo]=null}var Sa=null,Bi=null,Gn=!1,uu=null,Ns=!1,ZE=Error(de(519));function du(a){var s=Error(de(418,""));throw el(bo(s,a)),ZE}function lT(a){var s=a.stateNode,d=a.type,g=a.memoizedProps;switch(s[te]=a,s[Re]=g,d){case"dialog":In("cancel",s),In("close",s);break;case"iframe":case"object":case"embed":In("load",s);break;case"video":case"audio":for(d=0;d<wd.length;d++)In(wd[d],s);break;case"source":In("error",s);break;case"img":case"image":case"link":In("error",s),In("load",s);break;case"details":In("toggle",s);break;case"input":In("invalid",s),qo(s,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0),mn(s);break;case"select":In("invalid",s);break;case"textarea":In("invalid",s),Tr(s,g.value,g.defaultValue,g.children),mn(s)}d=g.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||s.textContent===""+d||g.suppressHydrationWarning===!0||by(s.textContent,d)?(g.popover!=null&&(In("beforetoggle",s),In("toggle",s)),g.onScroll!=null&&In("scroll",s),g.onScrollEnd!=null&&In("scrollend",s),g.onClick!=null&&(s.onclick=Cm),s=!0):s=!1,s||du(a)}function uT(a){for(Sa=a.return;Sa;)switch(Sa.tag){case 5:case 13:Ns=!1;return;case 27:case 3:Ns=!0;return;default:Sa=Sa.return}}function Ah(a){if(a!==Sa)return!1;if(!Gn)return uT(a),Gn=!0,!1;var s=a.tag,d;if((d=s!==3&&s!==27)&&((d=s===5)&&(d=a.type,d=!(d!=="form"&&d!=="button")||og(a.type,a.memoizedProps)),d=!d),d&&Bi&&du(a),uT(a),s===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(de(317));e:{for(a=a.nextSibling,s=0;a;){if(a.nodeType===8)if(d=a.data,d==="/$"){if(s===0){Bi=cs(a.nextSibling);break e}s--}else d!=="$"&&d!=="$!"&&d!=="$?"||s++;a=a.nextSibling}Bi=null}}else s===27?(s=Bi,Rl(a.type)?(a=dg,dg=null,Bi=a):Bi=s):Bi=Sa?cs(a.stateNode.nextSibling):null;return!0}function bh(){Bi=Sa=null,Gn=!1}function dT(){var a=uu;return a!==null&&(eo===null?eo=a:eo.push.apply(eo,a),uu=null),a}function el(a){uu===null?uu=[a]:uu.push(a)}var id=je(null),fc=null,mc=null;function tl(a,s,d){Be(id,s._currentValue),s._currentValue=d}function Ec(a){a._currentValue=id.current,Ne(id)}function mf(a,s,d){for(;a!==null;){var g=a.alternate;if((a.childLanes&s)!==s?(a.childLanes|=s,g!==null&&(g.childLanes|=s)):g!==null&&(g.childLanes&s)!==s&&(g.childLanes|=s),a===d)break;a=a.return}}function Ef(a,s,d,g){var b=a.child;for(b!==null&&(b.return=a);b!==null;){var k=b.dependencies;if(k!==null){var _e=b.child;k=k.firstContext;e:for(;k!==null;){var Pe=k;k=b;for(var ut=0;ut<s.length;ut++)if(Pe.context===s[ut]){k.lanes|=d,Pe=k.alternate,Pe!==null&&(Pe.lanes|=d),mf(k.return,d,a),g||(_e=null);break e}k=Pe.next}}else if(b.tag===18){if(_e=b.return,_e===null)throw Error(de(341));_e.lanes|=d,k=_e.alternate,k!==null&&(k.lanes|=d),mf(_e,d,a),_e=null}else _e=b.child;if(_e!==null)_e.return=b;else for(_e=b;_e!==null;){if(_e===a){_e=null;break}if(b=_e.sibling,b!==null){b.return=_e.return,_e=b;break}_e=_e.return}b=_e}}function hu(a,s,d,g){a=null;for(var b=s,k=!1;b!==null;){if(!k){if((b.flags&524288)!==0)k=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var _e=b.alternate;if(_e===null)throw Error(de(387));if(_e=_e.memoizedProps,_e!==null){var Pe=b.type;fo(b.pendingProps.value,_e.value)||(a!==null?a.push(Pe):a=[Pe])}}else if(b===Ie.current){if(_e=b.alternate,_e===null)throw Error(de(387));_e.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(a!==null?a.push(Ud):a=[Ud])}b=b.return}a!==null&&Ef(s,a,d,g),s.flags|=262144}function _f(a){for(a=a.firstContext;a!==null;){if(!fo(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function pu(a){fc=a,mc=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function $i(a){return hT(fc,a)}function gf(a,s){return fc===null&&pu(a),hT(a,s)}function hT(a,s){var d=s._currentValue;if(s={context:s,memoizedValue:d,next:null},mc===null){if(a===null)throw Error(de(308));mc=s,a.dependencies={lanes:0,firstContext:s},a.flags|=524288}else mc=mc.next=s;return d}var G0=typeof AbortController<"u"?AbortController:function(){var a=[],s=this.signal={aborted:!1,addEventListener:function(d,g){a.push(g)}};this.abort=function(){s.aborted=!0,a.forEach(function(d){return d()})}},H0=G.unstable_scheduleCallback,W0=G.unstable_NormalPriority,sa={$$typeof:M,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function vf(){return{controller:new G0,data:new Map,refCount:0}}function Oh(a){a.refCount--,a.refCount===0&&H0(W0,function(){a.controller.abort()})}var Nh=null,QE=0,rl=0,ad=null;function K0(a,s){if(Nh===null){var d=Nh=[];QE=0,rl=ap(),ad={status:"pending",value:void 0,then:function(g){d.push(g)}}}return QE++,s.then(wh,wh),s}function wh(){if(--QE===0&&Nh!==null){ad!==null&&(ad.status="fulfilled");var a=Nh;Nh=null,rl=0,ad=null;for(var s=0;s<a.length;s++)(0,a[s])()}}function z0(a,s){var d=[],g={status:"pending",value:null,reason:null,then:function(b){d.push(b)}};return a.then(function(){g.status="fulfilled",g.value=s;for(var b=0;b<d.length;b++)(0,d[b])(s)},function(b){for(g.status="rejected",g.reason=b,b=0;b<d.length;b++)(0,d[b])(void 0)}),g}var pT=q.S;q.S=function(a,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&K0(a,s),pT!==null&&pT(a,s)};var fu=je(null);function $E(){var a=fu.current;return a!==null?a:di.pooledCache}function Tf(a,s){s===null?Be(fu,fu.current):Be(fu,s.pool)}function fT(){var a=$E();return a===null?null:{parent:sa._currentValue,pool:a}}var nl=Error(de(460)),e_=Error(de(474)),yf=Error(de(542)),t_={then:function(){}};function r_(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Sf(){}function mT(a,s,d){switch(d=a[d],d===void 0?a.push(s):d!==s&&(s.then(Sf,Sf),s=d),s.status){case"fulfilled":return s.value;case"rejected":throw a=s.reason,Cf(a),a;default:if(typeof s.status=="string")s.then(Sf,Sf);else{if(a=di,a!==null&&100<a.shellSuspendCounter)throw Error(de(482));a=s,a.status="pending",a.then(function(g){if(s.status==="pending"){var b=s;b.status="fulfilled",b.value=g}},function(g){if(s.status==="pending"){var b=s;b.status="rejected",b.reason=g}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw a=s.reason,Cf(a),a}throw Dh=s,nl}}var Dh=null;function Rf(){if(Dh===null)throw Error(de(459));var a=Dh;return Dh=null,a}function Cf(a){if(a===nl||a===yf)throw Error(de(483))}var _c=!1;function Ph(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function If(a,s){a=a.updateQueue,s.updateQueue===a&&(s.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function gc(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function es(a,s,d){var g=a.updateQueue;if(g===null)return null;if(g=g.shared,($n&2)!==0){var b=g.pending;return b===null?s.next=s:(s.next=b.next,b.next=s),g.pending=s,s=Sh(a),oT(a,null,d),s}return pf(a,g,s,d),Sh(a)}function vc(a,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194048)!==0)){var g=s.lanes;g&=a.pendingLanes,d|=g,s.lanes=d,rt(a,d)}}function n_(a,s){var d=a.updateQueue,g=a.alternate;if(g!==null&&(g=g.updateQueue,d===g)){var b=null,k=null;if(d=d.firstBaseUpdate,d!==null){do{var _e={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};k===null?b=k=_e:k=k.next=_e,d=d.next}while(d!==null);k===null?b=k=s:k=k.next=s}else b=k=s;d={baseState:g.baseState,firstBaseUpdate:b,lastBaseUpdate:k,shared:g.shared,callbacks:g.callbacks},a.updateQueue=d;return}a=d.lastBaseUpdate,a===null?d.firstBaseUpdate=s:a.next=s,d.lastBaseUpdate=s}var i_=!1;function od(){if(i_){var a=ad;if(a!==null)throw a}}function Lh(a,s,d,g){i_=!1;var b=a.updateQueue;_c=!1;var k=b.firstBaseUpdate,_e=b.lastBaseUpdate,Pe=b.shared.pending;if(Pe!==null){b.shared.pending=null;var ut=Pe,Bt=ut.next;ut.next=null,_e===null?k=Bt:_e.next=Bt,_e=ut;var $t=a.alternate;$t!==null&&($t=$t.updateQueue,Pe=$t.lastBaseUpdate,Pe!==_e&&(Pe===null?$t.firstBaseUpdate=Bt:Pe.next=Bt,$t.lastBaseUpdate=ut))}if(k!==null){var Er=b.baseState;_e=0,$t=Bt=ut=null,Pe=k;do{var Ht=Pe.lane&-536870913,qt=Ht!==Pe.lane;if(qt?(kn&Ht)===Ht:(g&Ht)===Ht){Ht!==0&&Ht===rl&&(i_=!0),$t!==null&&($t=$t.next={lane:0,tag:Pe.tag,payload:Pe.payload,callback:null,next:null});e:{var nn=a,Fr=Pe;Ht=s;var ii=d;switch(Fr.tag){case 1:if(nn=Fr.payload,typeof nn=="function"){Er=nn.call(ii,Er,Ht);break e}Er=nn;break e;case 3:nn.flags=nn.flags&-65537|128;case 0:if(nn=Fr.payload,Ht=typeof nn=="function"?nn.call(ii,Er,Ht):nn,Ht==null)break e;Er=f({},Er,Ht);break e;case 2:_c=!0}}Ht=Pe.callback,Ht!==null&&(a.flags|=64,qt&&(a.flags|=8192),qt=b.callbacks,qt===null?b.callbacks=[Ht]:qt.push(Ht))}else qt={lane:Ht,tag:Pe.tag,payload:Pe.payload,callback:Pe.callback,next:null},$t===null?(Bt=$t=qt,ut=Er):$t=$t.next=qt,_e|=Ht;if(Pe=Pe.next,Pe===null){if(Pe=b.shared.pending,Pe===null)break;qt=Pe,Pe=qt.next,qt.next=null,b.lastBaseUpdate=qt,b.shared.pending=null}}while(!0);$t===null&&(ut=Er),b.baseState=ut,b.firstBaseUpdate=Bt,b.lastBaseUpdate=$t,k===null&&(b.shared.lanes=0),_l|=_e,a.lanes=_e,a.memoizedState=Er}}function ET(a,s){if(typeof a!="function")throw Error(de(191,a));a.call(s)}function a_(a,s){var d=a.callbacks;if(d!==null)for(a.callbacks=null,a=0;a<d.length;a++)ET(d[a],s)}var sd=je(null),Af=je(0);function _T(a,s){a=Us,Be(Af,a),Be(sd,s),Us=a|s.baseLanes}function o_(){Be(Af,Us),Be(sd,sd.current)}function s_(){Us=Af.current,Ne(sd),Ne(Af)}var il=0,En=null,jn=null,ea=null,bf=!1,cd=!1,al=!1,Of=0,ld=0,ud=null,q0=0;function Ki(){throw Error(de(321))}function hd(a,s){if(s===null)return!1;for(var d=0;d<s.length&&d<a.length;d++)if(!fo(a[d],s[d]))return!1;return!0}function c_(a,s,d,g,b,k){return il=k,En=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,q.H=a===null||a.memoizedState===null?b_:LT,al=!1,k=d(g,b),al=!1,cd&&(k=vT(s,d,g,b)),gT(a),k}function gT(a){q.H=Vh;var s=jn!==null&&jn.next!==null;if(il=0,ea=jn=En=null,bf=!1,ld=0,ud=null,s)throw Error(de(300));a===null||la||(a=a.dependencies,a!==null&&_f(a)&&(la=!0))}function vT(a,s,d,g){En=a;var b=0;do{if(cd&&(ud=null),ld=0,cd=!1,25<=b)throw Error(de(301));if(b+=1,ea=jn=null,a.updateQueue!=null){var k=a.updateQueue;k.lastEffect=null,k.events=null,k.stores=null,k.memoCache!=null&&(k.memoCache.index=0)}q.H=ol,k=s(d,g)}while(cd);return k}function Y0(){var a=q.H,s=a.useState()[0];return s=typeof s.then=="function"?pd(s):s,a=a.useState()[0],(jn!==null?jn.memoizedState:null)!==a&&(En.flags|=1024),s}function l_(){var a=Of!==0;return Of=0,a}function u_(a,s,d){s.updateQueue=a.updateQueue,s.flags&=-2053,a.lanes&=~d}function kh(a){if(bf){for(a=a.memoizedState;a!==null;){var s=a.queue;s!==null&&(s.pending=null),a=a.next}bf=!1}il=0,ea=jn=En=null,cd=!1,ld=Of=0,ud=null}function Za(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ea===null?En.memoizedState=ea=a:ea=ea.next=a,ea}function zi(){if(jn===null){var a=En.alternate;a=a!==null?a.memoizedState:null}else a=jn.next;var s=ea===null?En.memoizedState:ea.next;if(s!==null)ea=s,jn=a;else{if(a===null)throw En.alternate===null?Error(de(467)):Error(de(310));jn=a,a={memoizedState:jn.memoizedState,baseState:jn.baseState,baseQueue:jn.baseQueue,queue:jn.queue,next:null},ea===null?En.memoizedState=ea=a:ea=ea.next=a}return ea}function d_(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function pd(a){var s=ld;return ld+=1,ud===null&&(ud=[]),a=mT(ud,a,s),s=En,(ea===null?s.memoizedState:ea.next)===null&&(s=s.alternate,q.H=s===null||s.memoizedState===null?b_:LT),a}function Nf(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return pd(a);if(a.$$typeof===M)return $i(a)}throw Error(de(438,String(a)))}function h_(a){var s=null,d=En.updateQueue;if(d!==null&&(s=d.memoCache),s==null){var g=En.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(s={data:g.data.map(function(b){return b.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),d===null&&(d=d_(),En.updateQueue=d),d.memoCache=s,d=s.data[s.index],d===void 0)for(d=s.data[s.index]=Array(a),g=0;g<a;g++)d[g]=F;return s.index++,d}function Tc(a,s){return typeof s=="function"?s(a):s}function wf(a){var s=zi();return p_(s,jn,a)}function p_(a,s,d){var g=a.queue;if(g===null)throw Error(de(311));g.lastRenderedReducer=d;var b=a.baseQueue,k=g.pending;if(k!==null){if(b!==null){var _e=b.next;b.next=k.next,k.next=_e}s.baseQueue=b=k,g.pending=null}if(k=a.baseState,b===null)a.memoizedState=k;else{s=b.next;var Pe=_e=null,ut=null,Bt=s,$t=!1;do{var Er=Bt.lane&-536870913;if(Er!==Bt.lane?(kn&Er)===Er:(il&Er)===Er){var Ht=Bt.revertLane;if(Ht===0)ut!==null&&(ut=ut.next={lane:0,revertLane:0,action:Bt.action,hasEagerState:Bt.hasEagerState,eagerState:Bt.eagerState,next:null}),Er===rl&&($t=!0);else if((il&Ht)===Ht){Bt=Bt.next,Ht===rl&&($t=!0);continue}else Er={lane:0,revertLane:Bt.revertLane,action:Bt.action,hasEagerState:Bt.hasEagerState,eagerState:Bt.eagerState,next:null},ut===null?(Pe=ut=Er,_e=k):ut=ut.next=Er,En.lanes|=Ht,_l|=Ht;Er=Bt.action,al&&d(k,Er),k=Bt.hasEagerState?Bt.eagerState:d(k,Er)}else Ht={lane:Er,revertLane:Bt.revertLane,action:Bt.action,hasEagerState:Bt.hasEagerState,eagerState:Bt.eagerState,next:null},ut===null?(Pe=ut=Ht,_e=k):ut=ut.next=Ht,En.lanes|=Er,_l|=Er;Bt=Bt.next}while(Bt!==null&&Bt!==s);if(ut===null?_e=k:ut.next=Pe,!fo(k,a.memoizedState)&&(la=!0,$t&&(d=ad,d!==null)))throw d;a.memoizedState=k,a.baseState=_e,a.baseQueue=ut,g.lastRenderedState=k}return b===null&&(g.lanes=0),[a.memoizedState,g.dispatch]}function f_(a){var s=zi(),d=s.queue;if(d===null)throw Error(de(311));d.lastRenderedReducer=a;var g=d.dispatch,b=d.pending,k=s.memoizedState;if(b!==null){d.pending=null;var _e=b=b.next;do k=a(k,_e.action),_e=_e.next;while(_e!==b);fo(k,s.memoizedState)||(la=!0),s.memoizedState=k,s.baseQueue===null&&(s.baseState=k),d.lastRenderedState=k}return[k,g]}function m_(a,s,d){var g=En,b=zi(),k=Gn;if(k){if(d===void 0)throw Error(de(407));d=d()}else d=s();var _e=!fo((jn||b).memoizedState,d);_e&&(b.memoizedState=d,la=!0),b=b.queue;var Pe=E_.bind(null,g,b,a);if(ws(2048,8,Pe,[a]),b.getSnapshot!==s||_e||ea!==null&&ea.memoizedState.tag&1){if(g.flags|=2048,Ed(9,kf(),yT.bind(null,g,b,d,s),null),di===null)throw Error(de(349));k||(il&124)!==0||TT(g,s,d)}return d}function TT(a,s,d){a.flags|=16384,a={getSnapshot:s,value:d},s=En.updateQueue,s===null?(s=d_(),En.updateQueue=s,s.stores=[a]):(d=s.stores,d===null?s.stores=[a]:d.push(a))}function yT(a,s,d,g){s.value=d,s.getSnapshot=g,ST(s)&&Mh(a)}function E_(a,s,d){return d(function(){ST(s)&&Mh(a)})}function ST(a){var s=a.getSnapshot;a=a.value;try{var d=s();return!fo(a,d)}catch{return!0}}function Mh(a){var s=Qc(a,2);s!==null&&go(s,a,2)}function Df(a){var s=Za();if(typeof a=="function"){var d=a;if(a=d(),al){Kt(!0);try{d()}finally{Kt(!1)}}}return s.memoizedState=s.baseState=a,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tc,lastRenderedState:a},s}function fd(a,s,d,g){return a.baseState=d,p_(a,jn,typeof g=="function"?g:Tc)}function X0(a,s,d,g,b){if(Vf(a))throw Error(de(485));if(a=s.action,a!==null){var k={payload:b,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(_e){k.listeners.push(_e)}};q.T!==null?d(!0):k.isTransition=!1,g(k),d=s.pending,d===null?(k.next=s.pending=k,RT(s,k)):(k.next=d.next,s.pending=d.next=k)}}function RT(a,s){var d=s.action,g=s.payload,b=a.state;if(s.isTransition){var k=q.T,_e={};q.T=_e;try{var Pe=d(b,g),ut=q.S;ut!==null&&ut(_e,Pe),CT(a,s,Pe)}catch(Bt){md(a,s,Bt)}finally{q.T=k}}else try{k=d(b,g),CT(a,s,k)}catch(Bt){md(a,s,Bt)}}function CT(a,s,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(g){IT(a,s,g)},function(g){return md(a,s,g)}):IT(a,s,d)}function IT(a,s,d){s.status="fulfilled",s.value=d,AT(s),a.state=d,s=a.pending,s!==null&&(d=s.next,d===s?a.pending=null:(d=d.next,s.next=d,RT(a,d)))}function md(a,s,d){var g=a.pending;if(a.pending=null,g!==null){g=g.next;do s.status="rejected",s.reason=d,AT(s),s=s.next;while(s!==g)}a.action=null}function AT(a){a=a.listeners;for(var s=0;s<a.length;s++)(0,a[s])()}function __(a,s){return s}function Pf(a,s){if(Gn){var d=di.formState;if(d!==null){e:{var g=En;if(Gn){if(Bi){t:{for(var b=Bi,k=Ns;b.nodeType!==8;){if(!k){b=null;break t}if(b=cs(b.nextSibling),b===null){b=null;break t}}k=b.data,b=k==="F!"||k==="F"?b:null}if(b){Bi=cs(b.nextSibling),g=b.data==="F!";break e}}du(g)}g=!1}g&&(s=d[0])}}return d=Za(),d.memoizedState=d.baseState=s,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:__,lastRenderedState:s},d.queue=g,d=I_.bind(null,En,g),g.dispatch=d,g=Df(!1),k=Bh.bind(null,En,!1,g.queue),g=Za(),b={state:s,dispatch:null,action:a,pending:null},g.queue=b,d=X0.bind(null,En,b,k,d),b.dispatch=d,g.memoizedState=a,[s,d,!1]}function Lf(a){var s=zi();return bT(s,jn,a)}function bT(a,s,d){if(s=p_(a,s,__)[0],a=wf(Tc)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var g=pd(s)}catch(_e){throw _e===nl?yf:_e}else g=s;s=zi();var b=s.queue,k=b.dispatch;return d!==s.memoizedState&&(En.flags|=2048,Ed(9,kf(),J0.bind(null,b,d),null)),[g,k,a]}function J0(a,s){a.action=s}function OT(a){var s=zi(),d=jn;if(d!==null)return bT(s,d,a);zi(),s=s.memoizedState,d=zi();var g=d.queue.dispatch;return d.memoizedState=a,[s,g,!1]}function Ed(a,s,d,g){return a={tag:a,create:d,deps:g,inst:s,next:null},s=En.updateQueue,s===null&&(s=d_(),En.updateQueue=s),d=s.lastEffect,d===null?s.lastEffect=a.next=a:(g=d.next,d.next=a,a.next=g,s.lastEffect=a),a}function kf(){return{destroy:void 0,resource:void 0}}function Uh(){return zi().memoizedState}function Mf(a,s,d,g){var b=Za();g=g===void 0?null:g,En.flags|=a,b.memoizedState=Ed(1|s,kf(),d,g)}function ws(a,s,d,g){var b=zi();g=g===void 0?null:g;var k=b.memoizedState.inst;jn!==null&&g!==null&&hd(g,jn.memoizedState.deps)?b.memoizedState=Ed(s,k,d,g):(En.flags|=a,b.memoizedState=Ed(1|s,k,d,g))}function Uf(a,s){Mf(8390656,8,a,s)}function xh(a,s){ws(2048,8,a,s)}function _d(a,s){return ws(4,2,a,s)}function jh(a,s){return ws(4,4,a,s)}function NT(a,s){if(typeof s=="function"){a=a();var d=s(a);return function(){typeof d=="function"?d():s(null)}}if(s!=null)return a=a(),s.current=a,function(){s.current=null}}function g_(a,s,d){d=d!=null?d.concat([a]):null,ws(4,4,NT.bind(null,s,a),d)}function v_(){}function T_(a,s){var d=zi();s=s===void 0?null:s;var g=d.memoizedState;return s!==null&&hd(s,g[1])?g[0]:(d.memoizedState=[a,s],a)}function wT(a,s){var d=zi();s=s===void 0?null:s;var g=d.memoizedState;if(s!==null&&hd(s,g[1]))return g[0];if(g=a(),al){Kt(!0);try{a()}finally{Kt(!1)}}return d.memoizedState=[g,s],g}function y_(a,s,d){return d===void 0||(il&1073741824)!==0?a.memoizedState=s:(a.memoizedState=d,a=sy(),En.lanes|=a,_l|=a,d)}function xf(a,s,d,g){return fo(d,s)?d:sd.current!==null?(a=y_(a,d,g),fo(a,s)||(la=!0),a):(il&42)===0?(la=!0,a.memoizedState=d):(a=sy(),En.lanes|=a,_l|=a,s)}function jf(a,s,d,g,b){var k=ve.p;ve.p=k!==0&&8>k?k:8;var _e=q.T,Pe={};q.T=Pe,Bh(a,!1,s,d);try{var ut=b(),Bt=q.S;if(Bt!==null&&Bt(Pe,ut),ut!==null&&typeof ut=="object"&&typeof ut.then=="function"){var $t=z0(ut,g);rs(a,s,$t,to(a))}else rs(a,s,g,to(a))}catch(Er){rs(a,s,{then:function(){},status:"rejected",reason:Er},to())}finally{ve.p=k,q.T=_e}}function Z0(){}function S_(a,s,d,g){if(a.tag!==5)throw Error(de(476));var b=R_(a).queue;jf(a,b,s,Le,d===null?Z0:function(){return Bf(a),d(g)})}function R_(a){var s=a.memoizedState;if(s!==null)return s;s={memoizedState:Le,baseState:Le,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tc,lastRenderedState:Le},next:null};var d={};return s.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Tc,lastRenderedState:d},next:null},a.memoizedState=s,a=a.alternate,a!==null&&(a.memoizedState=s),s}function Bf(a){var s=R_(a).next.queue;rs(a,s,{},to())}function C_(){return $i(Ud)}function ts(){return zi().memoizedState}function mu(){return zi().memoizedState}function Eu(a){for(var s=a.return;s!==null;){switch(s.tag){case 24:case 3:var d=to();a=gc(d);var g=es(s,a,d);g!==null&&(go(g,s,d),vc(g,s,d)),s={cache:vf()},a.payload=s;return}s=s.return}}function DT(a,s,d){var g=to();d={lane:g,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null},Vf(a)?A_(s,d):(d=zE(a,s,d,g),d!==null&&(go(d,a,g),PT(d,s,g)))}function I_(a,s,d){var g=to();rs(a,s,d,g)}function rs(a,s,d,g){var b={lane:g,revertLane:0,action:d,hasEagerState:!1,eagerState:null,next:null};if(Vf(a))A_(s,b);else{var k=a.alternate;if(a.lanes===0&&(k===null||k.lanes===0)&&(k=s.lastRenderedReducer,k!==null))try{var _e=s.lastRenderedState,Pe=k(_e,d);if(b.hasEagerState=!0,b.eagerState=Pe,fo(Pe,_e))return pf(a,s,b,0),di===null&&hf(),!1}catch{}finally{}if(d=zE(a,s,b,g),d!==null)return go(d,a,g),PT(d,s,g),!0}return!1}function Bh(a,s,d,g){if(g={lane:2,revertLane:ap(),action:g,hasEagerState:!1,eagerState:null,next:null},Vf(a)){if(s)throw Error(de(479))}else s=zE(a,d,g,2),s!==null&&go(s,a,2)}function Vf(a){var s=a.alternate;return a===En||s!==null&&s===En}function A_(a,s){cd=bf=!0;var d=a.pending;d===null?s.next=s:(s.next=d.next,d.next=s),a.pending=s}function PT(a,s,d){if((d&4194048)!==0){var g=s.lanes;g&=a.pendingLanes,d|=g,s.lanes=d,rt(a,d)}}var Vh={readContext:$i,use:Nf,useCallback:Ki,useContext:Ki,useEffect:Ki,useImperativeHandle:Ki,useLayoutEffect:Ki,useInsertionEffect:Ki,useMemo:Ki,useReducer:Ki,useRef:Ki,useState:Ki,useDebugValue:Ki,useDeferredValue:Ki,useTransition:Ki,useSyncExternalStore:Ki,useId:Ki,useHostTransitionStatus:Ki,useFormState:Ki,useActionState:Ki,useOptimistic:Ki,useMemoCache:Ki,useCacheRefresh:Ki},b_={readContext:$i,use:Nf,useCallback:function(a,s){return Za().memoizedState=[a,s===void 0?null:s],a},useContext:$i,useEffect:Uf,useImperativeHandle:function(a,s,d){d=d!=null?d.concat([a]):null,Mf(4194308,4,NT.bind(null,s,a),d)},useLayoutEffect:function(a,s){return Mf(4194308,4,a,s)},useInsertionEffect:function(a,s){Mf(4,2,a,s)},useMemo:function(a,s){var d=Za();s=s===void 0?null:s;var g=a();if(al){Kt(!0);try{a()}finally{Kt(!1)}}return d.memoizedState=[g,s],g},useReducer:function(a,s,d){var g=Za();if(d!==void 0){var b=d(s);if(al){Kt(!0);try{d(s)}finally{Kt(!1)}}}else b=s;return g.memoizedState=g.baseState=b,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:b},g.queue=a,a=a.dispatch=DT.bind(null,En,a),[g.memoizedState,a]},useRef:function(a){var s=Za();return a={current:a},s.memoizedState=a},useState:function(a){a=Df(a);var s=a.queue,d=I_.bind(null,En,s);return s.dispatch=d,[a.memoizedState,d]},useDebugValue:v_,useDeferredValue:function(a,s){var d=Za();return y_(d,a,s)},useTransition:function(){var a=Df(!1);return a=jf.bind(null,En,a.queue,!0,!1),Za().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,s,d){var g=En,b=Za();if(Gn){if(d===void 0)throw Error(de(407));d=d()}else{if(d=s(),di===null)throw Error(de(349));(kn&124)!==0||TT(g,s,d)}b.memoizedState=d;var k={value:d,getSnapshot:s};return b.queue=k,Uf(E_.bind(null,g,k,a),[a]),g.flags|=2048,Ed(9,kf(),yT.bind(null,g,k,d,s),null),d},useId:function(){var a=Za(),s=di.identifierPrefix;if(Gn){var d=pc,g=hc;d=(g&~(1<<32-At(g)-1)).toString(32)+d,s="«"+s+"R"+d,d=Of++,0<d&&(s+="H"+d.toString(32)),s+="»"}else d=q0++,s="«"+s+"r"+d.toString(32)+"»";return a.memoizedState=s},useHostTransitionStatus:C_,useFormState:Pf,useActionState:Pf,useOptimistic:function(a){var s=Za();s.memoizedState=s.baseState=a;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=d,s=Bh.bind(null,En,!0,d),d.dispatch=s,[a,s]},useMemoCache:h_,useCacheRefresh:function(){return Za().memoizedState=Eu.bind(null,En)}},LT={readContext:$i,use:Nf,useCallback:T_,useContext:$i,useEffect:xh,useImperativeHandle:g_,useInsertionEffect:_d,useLayoutEffect:jh,useMemo:wT,useReducer:wf,useRef:Uh,useState:function(){return wf(Tc)},useDebugValue:v_,useDeferredValue:function(a,s){var d=zi();return xf(d,jn.memoizedState,a,s)},useTransition:function(){var a=wf(Tc)[0],s=zi().memoizedState;return[typeof a=="boolean"?a:pd(a),s]},useSyncExternalStore:m_,useId:ts,useHostTransitionStatus:C_,useFormState:Lf,useActionState:Lf,useOptimistic:function(a,s){var d=zi();return fd(d,jn,a,s)},useMemoCache:h_,useCacheRefresh:mu},ol={readContext:$i,use:Nf,useCallback:T_,useContext:$i,useEffect:xh,useImperativeHandle:g_,useInsertionEffect:_d,useLayoutEffect:jh,useMemo:wT,useReducer:f_,useRef:Uh,useState:function(){return f_(Tc)},useDebugValue:v_,useDeferredValue:function(a,s){var d=zi();return jn===null?y_(d,a,s):xf(d,jn.memoizedState,a,s)},useTransition:function(){var a=f_(Tc)[0],s=zi().memoizedState;return[typeof a=="boolean"?a:pd(a),s]},useSyncExternalStore:m_,useId:ts,useHostTransitionStatus:C_,useFormState:OT,useActionState:OT,useOptimistic:function(a,s){var d=zi();return jn!==null?fd(d,jn,a,s):(d.baseState=a,[a,d.queue.dispatch])},useMemoCache:h_,useCacheRefresh:mu},gd=null,Fh=0;function Ff(a){var s=Fh;return Fh+=1,gd===null&&(gd=[]),mT(gd,a,s)}function Gh(a,s){s=s.props.ref,a.ref=s!==void 0?s:null}function Hh(a,s){throw s.$$typeof===T?Error(de(525)):(a=Object.prototype.toString.call(s),Error(de(31,a==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":a)))}function kT(a){var s=a._init;return s(a._payload)}function Gf(a){function s(Ot,gt){if(a){var Ut=Ot.deletions;Ut===null?(Ot.deletions=[gt],Ot.flags|=16):Ut.push(gt)}}function d(Ot,gt){if(!a)return null;for(;gt!==null;)s(Ot,gt),gt=gt.sibling;return null}function g(Ot){for(var gt=new Map;Ot!==null;)Ot.key!==null?gt.set(Ot.key,Ot):gt.set(Ot.index,Ot),Ot=Ot.sibling;return gt}function b(Ot,gt){return Ot=dc(Ot,gt),Ot.index=0,Ot.sibling=null,Ot}function k(Ot,gt,Ut){return Ot.index=Ut,a?(Ut=Ot.alternate,Ut!==null?(Ut=Ut.index,Ut<gt?(Ot.flags|=67108866,gt):Ut):(Ot.flags|=67108866,gt)):(Ot.flags|=1048576,gt)}function _e(Ot){return a&&Ot.alternate===null&&(Ot.flags|=67108866),Ot}function Pe(Ot,gt,Ut,dr){return gt===null||gt.tag!==6?(gt=YE(Ut,Ot.mode,dr),gt.return=Ot,gt):(gt=b(gt,Ut),gt.return=Ot,gt)}function ut(Ot,gt,Ut,dr){var Pr=Ut.type;return Pr===y?$t(Ot,gt,Ut.props.children,dr,Ut.key):gt!==null&&(gt.elementType===Pr||typeof Pr=="object"&&Pr!==null&&Pr.$$typeof===I&&kT(Pr)===gt.type)?(gt=b(gt,Ut.props),Gh(gt,Ut),gt.return=Ot,gt):(gt=Rh(Ut.type,Ut.key,Ut.props,null,Ot.mode,dr),Gh(gt,Ut),gt.return=Ot,gt)}function Bt(Ot,gt,Ut,dr){return gt===null||gt.tag!==4||gt.stateNode.containerInfo!==Ut.containerInfo||gt.stateNode.implementation!==Ut.implementation?(gt=XE(Ut,Ot.mode,dr),gt.return=Ot,gt):(gt=b(gt,Ut.children||[]),gt.return=Ot,gt)}function $t(Ot,gt,Ut,dr,Pr){return gt===null||gt.tag!==7?(gt=cu(Ut,Ot.mode,dr,Pr),gt.return=Ot,gt):(gt=b(gt,Ut),gt.return=Ot,gt)}function Er(Ot,gt,Ut){if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return gt=YE(""+gt,Ot.mode,Ut),gt.return=Ot,gt;if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case v:return Ut=Rh(gt.type,gt.key,gt.props,null,Ot.mode,Ut),Gh(Ut,gt),Ut.return=Ot,Ut;case S:return gt=XE(gt,Ot.mode,Ut),gt.return=Ot,gt;case I:var dr=gt._init;return gt=dr(gt._payload),Er(Ot,gt,Ut)}if(H(gt)||W(gt))return gt=cu(gt,Ot.mode,Ut,null),gt.return=Ot,gt;if(typeof gt.then=="function")return Er(Ot,Ff(gt),Ut);if(gt.$$typeof===M)return Er(Ot,gf(Ot,gt),Ut);Hh(Ot,gt)}return null}function Ht(Ot,gt,Ut,dr){var Pr=gt!==null?gt.key:null;if(typeof Ut=="string"&&Ut!==""||typeof Ut=="number"||typeof Ut=="bigint")return Pr!==null?null:Pe(Ot,gt,""+Ut,dr);if(typeof Ut=="object"&&Ut!==null){switch(Ut.$$typeof){case v:return Ut.key===Pr?ut(Ot,gt,Ut,dr):null;case S:return Ut.key===Pr?Bt(Ot,gt,Ut,dr):null;case I:return Pr=Ut._init,Ut=Pr(Ut._payload),Ht(Ot,gt,Ut,dr)}if(H(Ut)||W(Ut))return Pr!==null?null:$t(Ot,gt,Ut,dr,null);if(typeof Ut.then=="function")return Ht(Ot,gt,Ff(Ut),dr);if(Ut.$$typeof===M)return Ht(Ot,gt,gf(Ot,Ut),dr);Hh(Ot,Ut)}return null}function qt(Ot,gt,Ut,dr,Pr){if(typeof dr=="string"&&dr!==""||typeof dr=="number"||typeof dr=="bigint")return Ot=Ot.get(Ut)||null,Pe(gt,Ot,""+dr,Pr);if(typeof dr=="object"&&dr!==null){switch(dr.$$typeof){case v:return Ot=Ot.get(dr.key===null?Ut:dr.key)||null,ut(gt,Ot,dr,Pr);case S:return Ot=Ot.get(dr.key===null?Ut:dr.key)||null,Bt(gt,Ot,dr,Pr);case I:var An=dr._init;return dr=An(dr._payload),qt(Ot,gt,Ut,dr,Pr)}if(H(dr)||W(dr))return Ot=Ot.get(Ut)||null,$t(gt,Ot,dr,Pr,null);if(typeof dr.then=="function")return qt(Ot,gt,Ut,Ff(dr),Pr);if(dr.$$typeof===M)return qt(Ot,gt,Ut,gf(gt,dr),Pr);Hh(gt,dr)}return null}function nn(Ot,gt,Ut,dr){for(var Pr=null,An=null,Br=gt,qr=gt=0,ua=null;Br!==null&&qr<Ut.length;qr++){Br.index>qr?(ua=Br,Br=null):ua=Br.sibling;var Mn=Ht(Ot,Br,Ut[qr],dr);if(Mn===null){Br===null&&(Br=ua);break}a&&Br&&Mn.alternate===null&&s(Ot,Br),gt=k(Mn,gt,qr),An===null?Pr=Mn:An.sibling=Mn,An=Mn,Br=ua}if(qr===Ut.length)return d(Ot,Br),Gn&&lu(Ot,qr),Pr;if(Br===null){for(;qr<Ut.length;qr++)Br=Er(Ot,Ut[qr],dr),Br!==null&&(gt=k(Br,gt,qr),An===null?Pr=Br:An.sibling=Br,An=Br);return Gn&&lu(Ot,qr),Pr}for(Br=g(Br);qr<Ut.length;qr++)ua=qt(Br,Ot,qr,Ut[qr],dr),ua!==null&&(a&&ua.alternate!==null&&Br.delete(ua.key===null?qr:ua.key),gt=k(ua,gt,qr),An===null?Pr=ua:An.sibling=ua,An=ua);return a&&Br.forEach(function(Do){return s(Ot,Do)}),Gn&&lu(Ot,qr),Pr}function Fr(Ot,gt,Ut,dr){if(Ut==null)throw Error(de(151));for(var Pr=null,An=null,Br=gt,qr=gt=0,ua=null,Mn=Ut.next();Br!==null&&!Mn.done;qr++,Mn=Ut.next()){Br.index>qr?(ua=Br,Br=null):ua=Br.sibling;var Do=Ht(Ot,Br,Mn.value,dr);if(Do===null){Br===null&&(Br=ua);break}a&&Br&&Do.alternate===null&&s(Ot,Br),gt=k(Do,gt,qr),An===null?Pr=Do:An.sibling=Do,An=Do,Br=ua}if(Mn.done)return d(Ot,Br),Gn&&lu(Ot,qr),Pr;if(Br===null){for(;!Mn.done;qr++,Mn=Ut.next())Mn=Er(Ot,Mn.value,dr),Mn!==null&&(gt=k(Mn,gt,qr),An===null?Pr=Mn:An.sibling=Mn,An=Mn);return Gn&&lu(Ot,qr),Pr}for(Br=g(Br);!Mn.done;qr++,Mn=Ut.next())Mn=qt(Br,Ot,qr,Mn.value,dr),Mn!==null&&(a&&Mn.alternate!==null&&Br.delete(Mn.key===null?qr:Mn.key),gt=k(Mn,gt,qr),An===null?Pr=Mn:An.sibling=Mn,An=Mn);return a&&Br.forEach(function(Sg){return s(Ot,Sg)}),Gn&&lu(Ot,qr),Pr}function ii(Ot,gt,Ut,dr){if(typeof Ut=="object"&&Ut!==null&&Ut.type===y&&Ut.key===null&&(Ut=Ut.props.children),typeof Ut=="object"&&Ut!==null){switch(Ut.$$typeof){case v:e:{for(var Pr=Ut.key;gt!==null;){if(gt.key===Pr){if(Pr=Ut.type,Pr===y){if(gt.tag===7){d(Ot,gt.sibling),dr=b(gt,Ut.props.children),dr.return=Ot,Ot=dr;break e}}else if(gt.elementType===Pr||typeof Pr=="object"&&Pr!==null&&Pr.$$typeof===I&&kT(Pr)===gt.type){d(Ot,gt.sibling),dr=b(gt,Ut.props),Gh(dr,Ut),dr.return=Ot,Ot=dr;break e}d(Ot,gt);break}else s(Ot,gt);gt=gt.sibling}Ut.type===y?(dr=cu(Ut.props.children,Ot.mode,dr,Ut.key),dr.return=Ot,Ot=dr):(dr=Rh(Ut.type,Ut.key,Ut.props,null,Ot.mode,dr),Gh(dr,Ut),dr.return=Ot,Ot=dr)}return _e(Ot);case S:e:{for(Pr=Ut.key;gt!==null;){if(gt.key===Pr)if(gt.tag===4&&gt.stateNode.containerInfo===Ut.containerInfo&&gt.stateNode.implementation===Ut.implementation){d(Ot,gt.sibling),dr=b(gt,Ut.children||[]),dr.return=Ot,Ot=dr;break e}else{d(Ot,gt);break}else s(Ot,gt);gt=gt.sibling}dr=XE(Ut,Ot.mode,dr),dr.return=Ot,Ot=dr}return _e(Ot);case I:return Pr=Ut._init,Ut=Pr(Ut._payload),ii(Ot,gt,Ut,dr)}if(H(Ut))return nn(Ot,gt,Ut,dr);if(W(Ut)){if(Pr=W(Ut),typeof Pr!="function")throw Error(de(150));return Ut=Pr.call(Ut),Fr(Ot,gt,Ut,dr)}if(typeof Ut.then=="function")return ii(Ot,gt,Ff(Ut),dr);if(Ut.$$typeof===M)return ii(Ot,gt,gf(Ot,Ut),dr);Hh(Ot,Ut)}return typeof Ut=="string"&&Ut!==""||typeof Ut=="number"||typeof Ut=="bigint"?(Ut=""+Ut,gt!==null&&gt.tag===6?(d(Ot,gt.sibling),dr=b(gt,Ut),dr.return=Ot,Ot=dr):(d(Ot,gt),dr=YE(Ut,Ot.mode,dr),dr.return=Ot,Ot=dr),_e(Ot)):d(Ot,gt)}return function(Ot,gt,Ut,dr){try{Fh=0;var Pr=ii(Ot,gt,Ut,dr);return gd=null,Pr}catch(Br){if(Br===nl||Br===yf)throw Br;var An=ya(29,Br,null,Ot.mode);return An.lanes=dr,An.return=Ot,An}finally{}}}var _u=Gf(!0),MT=Gf(!1),Eo=je(null),Ds=null;function sl(a){var s=a.alternate;Be(ca,ca.current&1),Be(Eo,a),Ds===null&&(s===null||sd.current!==null||s.memoizedState!==null)&&(Ds=a)}function UT(a){if(a.tag===22){if(Be(ca,ca.current),Be(Eo,a),Ds===null){var s=a.alternate;s!==null&&s.memoizedState!==null&&(Ds=a)}}else cl()}function cl(){Be(ca,ca.current),Be(Eo,Eo.current)}function yc(a){Ne(Eo),Ds===a&&(Ds=null),Ne(ca)}var ca=je(0);function Hf(a){for(var s=a;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||ug(d)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break;for(;s.sibling===null;){if(s.return===null||s.return===a)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function Wf(a,s,d,g){s=a.memoizedState,d=d(g,s),d=d==null?s:f({},s,d),a.memoizedState=d,a.lanes===0&&(a.updateQueue.baseState=d)}var Ps={enqueueSetState:function(a,s,d){a=a._reactInternals;var g=to(),b=gc(g);b.payload=s,d!=null&&(b.callback=d),s=es(a,b,g),s!==null&&(go(s,a,g),vc(s,a,g))},enqueueReplaceState:function(a,s,d){a=a._reactInternals;var g=to(),b=gc(g);b.tag=1,b.payload=s,d!=null&&(b.callback=d),s=es(a,b,g),s!==null&&(go(s,a,g),vc(s,a,g))},enqueueForceUpdate:function(a,s){a=a._reactInternals;var d=to(),g=gc(d);g.tag=2,s!=null&&(g.callback=s),s=es(a,g,d),s!==null&&(go(s,a,d),vc(s,a,d))}};function xT(a,s,d,g,b,k,_e){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(g,k,_e):s.prototype&&s.prototype.isPureReactComponent?!Th(d,g)||!Th(b,k):!0}function jT(a,s,d,g){a=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,g),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,g),s.state!==a&&Ps.enqueueReplaceState(s,s.state,null)}function gu(a,s){var d=s;if("ref"in s){d={};for(var g in s)g!=="ref"&&(d[g]=s[g])}if(a=a.defaultProps){d===s&&(d=f({},d));for(var b in a)d[b]===void 0&&(d[b]=a[b])}return d}var Kf=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)};function BT(a){Kf(a)}function VT(a){console.error(a)}function zf(a){Kf(a)}function qf(a,s){try{var d=a.onUncaughtError;d(s.value,{componentStack:s.stack})}catch(g){setTimeout(function(){throw g})}}function FT(a,s,d){try{var g=a.onCaughtError;g(d.value,{componentStack:d.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function O_(a,s,d){return d=gc(d),d.tag=3,d.payload={element:null},d.callback=function(){qf(a,s)},d}function GT(a){return a=gc(a),a.tag=3,a}function HT(a,s,d,g){var b=d.type.getDerivedStateFromError;if(typeof b=="function"){var k=g.value;a.payload=function(){return b(k)},a.callback=function(){FT(s,d,g)}}var _e=d.stateNode;_e!==null&&typeof _e.componentDidCatch=="function"&&(a.callback=function(){FT(s,d,g),typeof b!="function"&&(Ic===null?Ic=new Set([this]):Ic.add(this));var Pe=g.stack;this.componentDidCatch(g.value,{componentStack:Pe!==null?Pe:""})})}function Q0(a,s,d,g,b){if(d.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(s=d.alternate,s!==null&&hu(s,d,b,!0),d=Eo.current,d!==null){switch(d.tag){case 13:return Ds===null?dm():d.alternate===null&&Vi===0&&(Vi=3),d.flags&=-257,d.flags|=65536,d.lanes=b,g===t_?d.flags|=16384:(s=d.updateQueue,s===null?d.updateQueue=new Set([g]):s.add(g),Z_(a,g,b)),!1;case 22:return d.flags|=65536,g===t_?d.flags|=16384:(s=d.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([g])},d.updateQueue=s):(d=s.retryQueue,d===null?s.retryQueue=new Set([g]):d.add(g)),Z_(a,g,b)),!1}throw Error(de(435,d.tag))}return Z_(a,g,b),dm(),!1}if(Gn)return s=Eo.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=b,g!==ZE&&(a=Error(de(422),{cause:g}),el(bo(a,d)))):(g!==ZE&&(s=Error(de(423),{cause:g}),el(bo(s,d))),a=a.current.alternate,a.flags|=65536,b&=-b,a.lanes|=b,g=bo(g,d),b=O_(a.stateNode,g,b),n_(a,b),Vi!==4&&(Vi=2)),!1;var k=Error(de(520),{cause:g});if(k=bo(k,d),Zh===null?Zh=[k]:Zh.push(k),Vi!==4&&(Vi=2),s===null)return!0;g=bo(g,d),d=s;do{switch(d.tag){case 3:return d.flags|=65536,a=b&-b,d.lanes|=a,a=O_(d.stateNode,g,a),n_(d,a),!1;case 1:if(s=d.type,k=d.stateNode,(d.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Ic===null||!Ic.has(k))))return d.flags|=65536,b&=-b,d.lanes|=b,b=GT(b),HT(b,a,d,g),n_(d,b),!1}d=d.return}while(d!==null);return!1}var N_=Error(de(461)),la=!1;function Ra(a,s,d,g){s.child=a===null?MT(s,null,d,g):_u(s,a.child,d,g)}function WT(a,s,d,g,b){d=d.render;var k=s.ref;if("ref"in g){var _e={};for(var Pe in g)Pe!=="ref"&&(_e[Pe]=g[Pe])}else _e=g;return pu(s),g=c_(a,s,d,_e,k,b),Pe=l_(),a!==null&&!la?(u_(a,s,b),Sc(a,s,b)):(Gn&&Pe&&JE(s),s.flags|=1,Ra(a,s,g,b),s.child)}function Wh(a,s,d,g,b){if(a===null){var k=d.type;return typeof k=="function"&&!qE(k)&&k.defaultProps===void 0&&d.compare===null?(s.tag=15,s.type=k,Yf(a,s,k,g,b)):(a=Rh(d.type,null,g,s,s.mode,b),a.ref=s.ref,a.return=s,s.child=a)}if(k=a.child,!U_(a,b)){var _e=k.memoizedProps;if(d=d.compare,d=d!==null?d:Th,d(_e,g)&&a.ref===s.ref)return Sc(a,s,b)}return s.flags|=1,a=dc(k,g),a.ref=s.ref,a.return=s,s.child=a}function Yf(a,s,d,g,b){if(a!==null){var k=a.memoizedProps;if(Th(k,g)&&a.ref===s.ref)if(la=!1,s.pendingProps=g=k,U_(a,b))(a.flags&131072)!==0&&(la=!0);else return s.lanes=a.lanes,Sc(a,s,b)}return D_(a,s,d,g,b)}function w_(a,s,d){var g=s.pendingProps,b=g.children,k=a!==null?a.memoizedState:null;if(g.mode==="hidden"){if((s.flags&128)!==0){if(g=k!==null?k.baseLanes|d:d,a!==null){for(b=s.child=a.child,k=0;b!==null;)k=k|b.lanes|b.childLanes,b=b.sibling;s.childLanes=k&~g}else s.childLanes=0,s.child=null;return Kh(a,s,g,d)}if((d&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},a!==null&&Tf(s,k!==null?k.cachePool:null),k!==null?_T(s,k):o_(),UT(s);else return s.lanes=s.childLanes=536870912,Kh(a,s,k!==null?k.baseLanes|d:d,d)}else k!==null?(Tf(s,k.cachePool),_T(s,k),cl(),s.memoizedState=null):(a!==null&&Tf(s,null),o_(),cl());return Ra(a,s,b,d),s.child}function Kh(a,s,d,g){var b=$E();return b=b===null?null:{parent:sa._currentValue,pool:b},s.memoizedState={baseLanes:d,cachePool:b},a!==null&&Tf(s,null),o_(),UT(s),a!==null&&hu(a,s,g,!0),null}function zh(a,s){var d=s.ref;if(d===null)a!==null&&a.ref!==null&&(s.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(de(284));(a===null||a.ref!==d)&&(s.flags|=4194816)}}function D_(a,s,d,g,b){return pu(s),d=c_(a,s,d,g,void 0,b),g=l_(),a!==null&&!la?(u_(a,s,b),Sc(a,s,b)):(Gn&&g&&JE(s),s.flags|=1,Ra(a,s,d,b),s.child)}function P_(a,s,d,g,b,k){return pu(s),s.updateQueue=null,d=vT(s,g,d,b),gT(a),g=l_(),a!==null&&!la?(u_(a,s,k),Sc(a,s,k)):(Gn&&g&&JE(s),s.flags|=1,Ra(a,s,d,k),s.child)}function Xf(a,s,d,g,b){if(pu(s),s.stateNode===null){var k=wa,_e=d.contextType;typeof _e=="object"&&_e!==null&&(k=$i(_e)),k=new d(g,k),s.memoizedState=k.state!==null&&k.state!==void 0?k.state:null,k.updater=Ps,s.stateNode=k,k._reactInternals=s,k=s.stateNode,k.props=g,k.state=s.memoizedState,k.refs={},Ph(s),_e=d.contextType,k.context=typeof _e=="object"&&_e!==null?$i(_e):wa,k.state=s.memoizedState,_e=d.getDerivedStateFromProps,typeof _e=="function"&&(Wf(s,d,_e,g),k.state=s.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof k.getSnapshotBeforeUpdate=="function"||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(_e=k.state,typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount(),_e!==k.state&&Ps.enqueueReplaceState(k,k.state,null),Lh(s,g,k,b),od(),k.state=s.memoizedState),typeof k.componentDidMount=="function"&&(s.flags|=4194308),g=!0}else if(a===null){k=s.stateNode;var Pe=s.memoizedProps,ut=gu(d,Pe);k.props=ut;var Bt=k.context,$t=d.contextType;_e=wa,typeof $t=="object"&&$t!==null&&(_e=$i($t));var Er=d.getDerivedStateFromProps;$t=typeof Er=="function"||typeof k.getSnapshotBeforeUpdate=="function",Pe=s.pendingProps!==Pe,$t||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(Pe||Bt!==_e)&&jT(s,k,g,_e),_c=!1;var Ht=s.memoizedState;k.state=Ht,Lh(s,g,k,b),od(),Bt=s.memoizedState,Pe||Ht!==Bt||_c?(typeof Er=="function"&&(Wf(s,d,Er,g),Bt=s.memoizedState),(ut=_c||xT(s,d,ut,g,Ht,Bt,_e))?($t||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount()),typeof k.componentDidMount=="function"&&(s.flags|=4194308)):(typeof k.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=g,s.memoizedState=Bt),k.props=g,k.state=Bt,k.context=_e,g=ut):(typeof k.componentDidMount=="function"&&(s.flags|=4194308),g=!1)}else{k=s.stateNode,If(a,s),_e=s.memoizedProps,$t=gu(d,_e),k.props=$t,Er=s.pendingProps,Ht=k.context,Bt=d.contextType,ut=wa,typeof Bt=="object"&&Bt!==null&&(ut=$i(Bt)),Pe=d.getDerivedStateFromProps,(Bt=typeof Pe=="function"||typeof k.getSnapshotBeforeUpdate=="function")||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(_e!==Er||Ht!==ut)&&jT(s,k,g,ut),_c=!1,Ht=s.memoizedState,k.state=Ht,Lh(s,g,k,b),od();var qt=s.memoizedState;_e!==Er||Ht!==qt||_c||a!==null&&a.dependencies!==null&&_f(a.dependencies)?(typeof Pe=="function"&&(Wf(s,d,Pe,g),qt=s.memoizedState),($t=_c||xT(s,d,$t,g,Ht,qt,ut)||a!==null&&a.dependencies!==null&&_f(a.dependencies))?(Bt||typeof k.UNSAFE_componentWillUpdate!="function"&&typeof k.componentWillUpdate!="function"||(typeof k.componentWillUpdate=="function"&&k.componentWillUpdate(g,qt,ut),typeof k.UNSAFE_componentWillUpdate=="function"&&k.UNSAFE_componentWillUpdate(g,qt,ut)),typeof k.componentDidUpdate=="function"&&(s.flags|=4),typeof k.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof k.componentDidUpdate!="function"||_e===a.memoizedProps&&Ht===a.memoizedState||(s.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||_e===a.memoizedProps&&Ht===a.memoizedState||(s.flags|=1024),s.memoizedProps=g,s.memoizedState=qt),k.props=g,k.state=qt,k.context=ut,g=$t):(typeof k.componentDidUpdate!="function"||_e===a.memoizedProps&&Ht===a.memoizedState||(s.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||_e===a.memoizedProps&&Ht===a.memoizedState||(s.flags|=1024),g=!1)}return k=g,zh(a,s),g=(s.flags&128)!==0,k||g?(k=s.stateNode,d=g&&typeof d.getDerivedStateFromError!="function"?null:k.render(),s.flags|=1,a!==null&&g?(s.child=_u(s,a.child,null,b),s.child=_u(s,null,d,b)):Ra(a,s,d,b),s.memoizedState=k.state,a=s.child):a=Sc(a,s,b),a}function KT(a,s,d,g){return bh(),s.flags|=256,Ra(a,s,d,g),s.child}var Jf={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Zf(a){return{baseLanes:a,cachePool:fT()}}function L_(a,s,d){return a=a!==null?a.childLanes&~d:0,s&&(a|=No),a}function k_(a,s,d){var g=s.pendingProps,b=!1,k=(s.flags&128)!==0,_e;if((_e=k)||(_e=a!==null&&a.memoizedState===null?!1:(ca.current&2)!==0),_e&&(b=!0,s.flags&=-129),_e=(s.flags&32)!==0,s.flags&=-33,a===null){if(Gn){if(b?sl(s):cl(),Gn){var Pe=Bi,ut;if(ut=Pe){e:{for(ut=Pe,Pe=Ns;ut.nodeType!==8;){if(!Pe){Pe=null;break e}if(ut=cs(ut.nextSibling),ut===null){Pe=null;break e}}Pe=ut}Pe!==null?(s.memoizedState={dehydrated:Pe,treeContext:Os!==null?{id:hc,overflow:pc}:null,retryLane:536870912,hydrationErrors:null},ut=ya(18,null,null,0),ut.stateNode=Pe,ut.return=s,s.child=ut,Sa=s,Bi=null,ut=!0):ut=!1}ut||du(s)}if(Pe=s.memoizedState,Pe!==null&&(Pe=Pe.dehydrated,Pe!==null))return ug(Pe)?s.lanes=32:s.lanes=536870912,null;yc(s)}return Pe=g.children,g=g.fallback,b?(cl(),b=s.mode,Pe=$f({mode:"hidden",children:Pe},b),g=cu(g,b,d,null),Pe.return=s,g.return=s,Pe.sibling=g,s.child=Pe,b=s.child,b.memoizedState=Zf(d),b.childLanes=L_(a,_e,d),s.memoizedState=Jf,g):(sl(s),Qf(s,Pe))}if(ut=a.memoizedState,ut!==null&&(Pe=ut.dehydrated,Pe!==null)){if(k)s.flags&256?(sl(s),s.flags&=-257,s=M_(a,s,d)):s.memoizedState!==null?(cl(),s.child=a.child,s.flags|=128,s=null):(cl(),b=g.fallback,Pe=s.mode,g=$f({mode:"visible",children:g.children},Pe),b=cu(b,Pe,d,null),b.flags|=2,g.return=s,b.return=s,g.sibling=b,s.child=g,_u(s,a.child,null,d),g=s.child,g.memoizedState=Zf(d),g.childLanes=L_(a,_e,d),s.memoizedState=Jf,s=b);else if(sl(s),ug(Pe)){if(_e=Pe.nextSibling&&Pe.nextSibling.dataset,_e)var Bt=_e.dgst;_e=Bt,g=Error(de(419)),g.stack="",g.digest=_e,el({value:g,source:null,stack:null}),s=M_(a,s,d)}else if(la||hu(a,s,d,!1),_e=(d&a.childLanes)!==0,la||_e){if(_e=di,_e!==null&&(g=d&-d,g=(g&42)!==0?1:Ct(g),g=(g&(_e.suspendedLanes|d))!==0?0:g,g!==0&&g!==ut.retryLane))throw ut.retryLane=g,Qc(a,g),go(_e,a,g),N_;Pe.data==="$?"||dm(),s=M_(a,s,d)}else Pe.data==="$?"?(s.flags|=192,s.child=a.child,s=null):(a=ut.treeContext,Bi=cs(Pe.nextSibling),Sa=s,Gn=!0,uu=null,Ns=!1,a!==null&&(Oo[mo++]=hc,Oo[mo++]=pc,Oo[mo++]=Os,hc=a.id,pc=a.overflow,Os=s),s=Qf(s,g.children),s.flags|=4096);return s}return b?(cl(),b=g.fallback,Pe=s.mode,ut=a.child,Bt=ut.sibling,g=dc(ut,{mode:"hidden",children:g.children}),g.subtreeFlags=ut.subtreeFlags&65011712,Bt!==null?b=dc(Bt,b):(b=cu(b,Pe,d,null),b.flags|=2),b.return=s,g.return=s,g.sibling=b,s.child=g,g=b,b=s.child,Pe=a.child.memoizedState,Pe===null?Pe=Zf(d):(ut=Pe.cachePool,ut!==null?(Bt=sa._currentValue,ut=ut.parent!==Bt?{parent:Bt,pool:Bt}:ut):ut=fT(),Pe={baseLanes:Pe.baseLanes|d,cachePool:ut}),b.memoizedState=Pe,b.childLanes=L_(a,_e,d),s.memoizedState=Jf,g):(sl(s),d=a.child,a=d.sibling,d=dc(d,{mode:"visible",children:g.children}),d.return=s,d.sibling=null,a!==null&&(_e=s.deletions,_e===null?(s.deletions=[a],s.flags|=16):_e.push(a)),s.child=d,s.memoizedState=null,d)}function Qf(a,s){return s=$f({mode:"visible",children:s},a.mode),s.return=a,a.child=s}function $f(a,s){return a=ya(22,a,null,s),a.lanes=0,a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},a}function M_(a,s,d){return _u(s,a.child,null,d),a=Qf(s,s.pendingProps.children),a.flags|=2,s.memoizedState=null,a}function zT(a,s,d){a.lanes|=s;var g=a.alternate;g!==null&&(g.lanes|=s),mf(a.return,s,d)}function vd(a,s,d,g,b){var k=a.memoizedState;k===null?a.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:g,tail:d,tailMode:b}:(k.isBackwards=s,k.rendering=null,k.renderingStartTime=0,k.last=g,k.tail=d,k.tailMode=b)}function qT(a,s,d){var g=s.pendingProps,b=g.revealOrder,k=g.tail;if(Ra(a,s,g.children,d),g=ca.current,(g&2)!==0)g=g&1|2,s.flags|=128;else{if(a!==null&&(a.flags&128)!==0)e:for(a=s.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&zT(a,d,s);else if(a.tag===19)zT(a,d,s);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===s)break e;for(;a.sibling===null;){if(a.return===null||a.return===s)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}g&=1}switch(Be(ca,g),b){case"forwards":for(d=s.child,b=null;d!==null;)a=d.alternate,a!==null&&Hf(a)===null&&(b=d),d=d.sibling;d=b,d===null?(b=s.child,s.child=null):(b=d.sibling,d.sibling=null),vd(s,!1,b,d,k);break;case"backwards":for(d=null,b=s.child,s.child=null;b!==null;){if(a=b.alternate,a!==null&&Hf(a)===null){s.child=b;break}a=b.sibling,b.sibling=d,d=b,b=a}vd(s,!0,d,null,k);break;case"together":vd(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Sc(a,s,d){if(a!==null&&(s.dependencies=a.dependencies),_l|=s.lanes,(d&s.childLanes)===0)if(a!==null){if(hu(a,s,d,!1),(d&s.childLanes)===0)return null}else return null;if(a!==null&&s.child!==a.child)throw Error(de(153));if(s.child!==null){for(a=s.child,d=dc(a,a.pendingProps),s.child=d,d.return=s;a.sibling!==null;)a=a.sibling,d=d.sibling=dc(a,a.pendingProps),d.return=s;d.sibling=null}return s.child}function U_(a,s){return(a.lanes&s)!==0?!0:(a=a.dependencies,!!(a!==null&&_f(a)))}function YT(a,s,d){switch(s.tag){case 3:we(s,s.stateNode.containerInfo),tl(s,sa,a.memoizedState.cache),bh();break;case 27:case 5:qe(s);break;case 4:we(s,s.stateNode.containerInfo);break;case 10:tl(s,s.type,s.memoizedProps.value);break;case 13:var g=s.memoizedState;if(g!==null)return g.dehydrated!==null?(sl(s),s.flags|=128,null):(d&s.child.childLanes)!==0?k_(a,s,d):(sl(s),a=Sc(a,s,d),a!==null?a.sibling:null);sl(s);break;case 19:var b=(a.flags&128)!==0;if(g=(d&s.childLanes)!==0,g||(hu(a,s,d,!1),g=(d&s.childLanes)!==0),b){if(g)return qT(a,s,d);s.flags|=128}if(b=s.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Be(ca,ca.current),g)break;return null;case 22:case 23:return s.lanes=0,w_(a,s,d);case 24:tl(s,sa,a.memoizedState.cache)}return Sc(a,s,d)}function XT(a,s,d){if(a!==null)if(a.memoizedProps!==s.pendingProps)la=!0;else{if(!U_(a,d)&&(s.flags&128)===0)return la=!1,YT(a,s,d);la=(a.flags&131072)!==0}else la=!1,Gn&&(s.flags&1048576)!==0&&cT(s,Ih,s.index);switch(s.lanes=0,s.tag){case 16:e:{a=s.pendingProps;var g=s.elementType,b=g._init;if(g=b(g._payload),s.type=g,typeof g=="function")qE(g)?(a=gu(g,a),s.tag=1,s=Xf(null,s,g,a,d)):(s.tag=0,s=D_(null,s,g,a,d));else{if(g!=null){if(b=g.$$typeof,b===x){s.tag=11,s=WT(null,s,g,a,d);break e}else if(b===Z){s.tag=14,s=Wh(null,s,g,a,d);break e}}throw s=ee(g)||g,Error(de(306,s,""))}}return s;case 0:return D_(a,s,s.type,s.pendingProps,d);case 1:return g=s.type,b=gu(g,s.pendingProps),Xf(a,s,g,b,d);case 3:e:{if(we(s,s.stateNode.containerInfo),a===null)throw Error(de(387));g=s.pendingProps;var k=s.memoizedState;b=k.element,If(a,s),Lh(s,g,null,d);var _e=s.memoizedState;if(g=_e.cache,tl(s,sa,g),g!==k.cache&&Ef(s,[sa],d,!0),od(),g=_e.element,k.isDehydrated)if(k={element:g,isDehydrated:!1,cache:_e.cache},s.updateQueue.baseState=k,s.memoizedState=k,s.flags&256){s=KT(a,s,g,d);break e}else if(g!==b){b=bo(Error(de(424)),s),el(b),s=KT(a,s,g,d);break e}else{switch(a=s.stateNode.containerInfo,a.nodeType){case 9:a=a.body;break;default:a=a.nodeName==="HTML"?a.ownerDocument.body:a}for(Bi=cs(a.firstChild),Sa=s,Gn=!0,uu=null,Ns=!0,d=MT(s,null,g,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(bh(),g===b){s=Sc(a,s,d);break e}Ra(a,s,g,d)}s=s.child}return s;case 26:return zh(a,s),a===null?(d=xy(s.type,null,s.pendingProps,null))?s.memoizedState=d:Gn||(d=s.type,a=s.pendingProps,g=Im(dt.current).createElement(d),g[te]=s,g[Re]=a,Ca(g,d,a),pe(g),s.stateNode=g):s.memoizedState=xy(s.type,a.memoizedProps,s.pendingProps,a.memoizedState),null;case 27:return qe(s),a===null&&Gn&&(g=s.stateNode=Ly(s.type,s.pendingProps,dt.current),Sa=s,Ns=!0,b=Bi,Rl(s.type)?(dg=b,Bi=cs(g.firstChild)):Bi=b),Ra(a,s,s.pendingProps.children,d),zh(a,s),a===null&&(s.flags|=4194304),s.child;case 5:return a===null&&Gn&&((b=g=Bi)&&(g=hC(g,s.type,s.pendingProps,Ns),g!==null?(s.stateNode=g,Sa=s,Bi=cs(g.firstChild),Ns=!1,b=!0):b=!1),b||du(s)),qe(s),b=s.type,k=s.pendingProps,_e=a!==null?a.memoizedProps:null,g=k.children,og(b,k)?g=null:_e!==null&&og(b,_e)&&(s.flags|=32),s.memoizedState!==null&&(b=c_(a,s,Y0,null,null,d),Ud._currentValue=b),zh(a,s),Ra(a,s,g,d),s.child;case 6:return a===null&&Gn&&((a=d=Bi)&&(d=pC(d,s.pendingProps,Ns),d!==null?(s.stateNode=d,Sa=s,Bi=null,a=!0):a=!1),a||du(s)),null;case 13:return k_(a,s,d);case 4:return we(s,s.stateNode.containerInfo),g=s.pendingProps,a===null?s.child=_u(s,null,g,d):Ra(a,s,g,d),s.child;case 11:return WT(a,s,s.type,s.pendingProps,d);case 7:return Ra(a,s,s.pendingProps,d),s.child;case 8:return Ra(a,s,s.pendingProps.children,d),s.child;case 12:return Ra(a,s,s.pendingProps.children,d),s.child;case 10:return g=s.pendingProps,tl(s,s.type,g.value),Ra(a,s,g.children,d),s.child;case 9:return b=s.type._context,g=s.pendingProps.children,pu(s),b=$i(b),g=g(b),s.flags|=1,Ra(a,s,g,d),s.child;case 14:return Wh(a,s,s.type,s.pendingProps,d);case 15:return Yf(a,s,s.type,s.pendingProps,d);case 19:return qT(a,s,d);case 31:return g=s.pendingProps,d=s.mode,g={mode:g.mode,children:g.children},a===null?(d=$f(g,d),d.ref=s.ref,s.child=d,d.return=s,s=d):(d=dc(a.child,g),d.ref=s.ref,s.child=d,d.return=s,s=d),s;case 22:return w_(a,s,d);case 24:return pu(s),g=$i(sa),a===null?(b=$E(),b===null&&(b=di,k=vf(),b.pooledCache=k,k.refCount++,k!==null&&(b.pooledCacheLanes|=d),b=k),s.memoizedState={parent:g,cache:b},Ph(s),tl(s,sa,b)):((a.lanes&d)!==0&&(If(a,s),Lh(s,null,null,d),od()),b=a.memoizedState,k=s.memoizedState,b.parent!==g?(b={parent:g,cache:g},s.memoizedState=b,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=b),tl(s,sa,g)):(g=k.cache,tl(s,sa,g),g!==b.cache&&Ef(s,[sa],d,!0))),Ra(a,s,s.pendingProps.children,d),s.child;case 29:throw s.pendingProps}throw Error(de(156,s.tag))}function Rc(a){a.flags|=4}function em(a,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!Hy(s)){if(s=Eo.current,s!==null&&((kn&4194048)===kn?Ds!==null:(kn&62914560)!==kn&&(kn&536870912)===0||s!==Ds))throw Dh=t_,e_;a.flags|=8192}}function tm(a,s){s!==null&&(a.flags|=4),a.flags&16384&&(s=a.tag!==22?et():536870912,a.lanes|=s,gl|=s)}function vu(a,s){if(!Gn)switch(a.tailMode){case"hidden":s=a.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?a.tail=null:d.sibling=null;break;case"collapsed":d=a.tail;for(var g=null;d!==null;)d.alternate!==null&&(g=d),d=d.sibling;g===null?s||a.tail===null?a.tail=null:a.tail.sibling=null:g.sibling=null}}function Ni(a){var s=a.alternate!==null&&a.alternate.child===a.child,d=0,g=0;if(s)for(var b=a.child;b!==null;)d|=b.lanes|b.childLanes,g|=b.subtreeFlags&65011712,g|=b.flags&65011712,b.return=a,b=b.sibling;else for(b=a.child;b!==null;)d|=b.lanes|b.childLanes,g|=b.subtreeFlags,g|=b.flags,b.return=a,b=b.sibling;return a.subtreeFlags|=g,a.childLanes=d,s}function JT(a,s,d){var g=s.pendingProps;switch(ff(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ni(s),null;case 1:return Ni(s),null;case 3:return d=s.stateNode,g=null,a!==null&&(g=a.memoizedState.cache),s.memoizedState.cache!==g&&(s.flags|=2048),Ec(sa),ft(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(a===null||a.child===null)&&(Ah(s)?Rc(s):a===null||a.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,dT())),Ni(s),null;case 26:return d=s.memoizedState,a===null?(Rc(s),d!==null?(Ni(s),em(s,d)):(Ni(s),s.flags&=-16777217)):d?d!==a.memoizedState?(Rc(s),Ni(s),em(s,d)):(Ni(s),s.flags&=-16777217):(a.memoizedProps!==g&&Rc(s),Ni(s),s.flags&=-16777217),null;case 27:it(s),d=dt.current;var b=s.type;if(a!==null&&s.stateNode!=null)a.memoizedProps!==g&&Rc(s);else{if(!g){if(s.stateNode===null)throw Error(de(166));return Ni(s),null}a=Ye.current,Ah(s)?lT(s):(a=Ly(b,g,d),s.stateNode=a,Rc(s))}return Ni(s),null;case 5:if(it(s),d=s.type,a!==null&&s.stateNode!=null)a.memoizedProps!==g&&Rc(s);else{if(!g){if(s.stateNode===null)throw Error(de(166));return Ni(s),null}if(a=Ye.current,Ah(s))lT(s);else{switch(b=Im(dt.current),a){case 1:a=b.createElementNS("http://www.w3.org/2000/svg",d);break;case 2:a=b.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;default:switch(d){case"svg":a=b.createElementNS("http://www.w3.org/2000/svg",d);break;case"math":a=b.createElementNS("http://www.w3.org/1998/Math/MathML",d);break;case"script":a=b.createElement("div"),a.innerHTML="<script><\/script>",a=a.removeChild(a.firstChild);break;case"select":a=typeof g.is=="string"?b.createElement("select",{is:g.is}):b.createElement("select"),g.multiple?a.multiple=!0:g.size&&(a.size=g.size);break;default:a=typeof g.is=="string"?b.createElement(d,{is:g.is}):b.createElement(d)}}a[te]=s,a[Re]=g;e:for(b=s.child;b!==null;){if(b.tag===5||b.tag===6)a.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===s)break e;for(;b.sibling===null;){if(b.return===null||b.return===s)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}s.stateNode=a;e:switch(Ca(a,d,g),d){case"button":case"input":case"select":case"textarea":a=!!g.autoFocus;break e;case"img":a=!0;break e;default:a=!1}a&&Rc(s)}}return Ni(s),s.flags&=-16777217,null;case 6:if(a&&s.stateNode!=null)a.memoizedProps!==g&&Rc(s);else{if(typeof g!="string"&&s.stateNode===null)throw Error(de(166));if(a=dt.current,Ah(s)){if(a=s.stateNode,d=s.memoizedProps,g=null,b=Sa,b!==null)switch(b.tag){case 27:case 5:g=b.memoizedProps}a[te]=s,a=!!(a.nodeValue===d||g!==null&&g.suppressHydrationWarning===!0||by(a.nodeValue,d)),a||du(s)}else a=Im(a).createTextNode(g),a[te]=s,s.stateNode=a}return Ni(s),null;case 13:if(g=s.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(b=Ah(s),g!==null&&g.dehydrated!==null){if(a===null){if(!b)throw Error(de(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(de(317));b[te]=s}else bh(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ni(s),b=!1}else b=dT(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=b),b=!0;if(!b)return s.flags&256?(yc(s),s):(yc(s),null)}if(yc(s),(s.flags&128)!==0)return s.lanes=d,s;if(d=g!==null,a=a!==null&&a.memoizedState!==null,d){g=s.child,b=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(b=g.alternate.memoizedState.cachePool.pool);var k=null;g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(k=g.memoizedState.cachePool.pool),k!==b&&(g.flags|=2048)}return d!==a&&d&&(s.child.flags|=8192),tm(s,s.updateQueue),Ni(s),null;case 4:return ft(),a===null&&Sl(s.stateNode.containerInfo),Ni(s),null;case 10:return Ec(s.type),Ni(s),null;case 19:if(Ne(ca),b=s.memoizedState,b===null)return Ni(s),null;if(g=(s.flags&128)!==0,k=b.rendering,k===null)if(g)vu(b,!1);else{if(Vi!==0||a!==null&&(a.flags&128)!==0)for(a=s.child;a!==null;){if(k=Hf(a),k!==null){for(s.flags|=128,vu(b,!1),a=k.updateQueue,s.updateQueue=a,tm(s,a),s.subtreeFlags=0,a=d,d=s.child;d!==null;)sT(d,a),d=d.sibling;return Be(ca,ca.current&1|2),s.child}a=a.sibling}b.tail!==null&&Gt()>Rd&&(s.flags|=128,g=!0,vu(b,!1),s.lanes=4194304)}else{if(!g)if(a=Hf(k),a!==null){if(s.flags|=128,g=!0,a=a.updateQueue,s.updateQueue=a,tm(s,a),vu(b,!0),b.tail===null&&b.tailMode==="hidden"&&!k.alternate&&!Gn)return Ni(s),null}else 2*Gt()-b.renderingStartTime>Rd&&d!==536870912&&(s.flags|=128,g=!0,vu(b,!1),s.lanes=4194304);b.isBackwards?(k.sibling=s.child,s.child=k):(a=b.last,a!==null?a.sibling=k:s.child=k,b.last=k)}return b.tail!==null?(s=b.tail,b.rendering=s,b.tail=s.sibling,b.renderingStartTime=Gt(),s.sibling=null,a=ca.current,Be(ca,g?a&1|2:a&1),s):(Ni(s),null);case 22:case 23:return yc(s),s_(),g=s.memoizedState!==null,a!==null?a.memoizedState!==null!==g&&(s.flags|=8192):g&&(s.flags|=8192),g?(d&536870912)!==0&&(s.flags&128)===0&&(Ni(s),s.subtreeFlags&6&&(s.flags|=8192)):Ni(s),d=s.updateQueue,d!==null&&tm(s,d.retryQueue),d=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),g=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(g=s.memoizedState.cachePool.pool),g!==d&&(s.flags|=2048),a!==null&&Ne(fu),null;case 24:return d=null,a!==null&&(d=a.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Ec(sa),Ni(s),null;case 25:return null;case 30:return null}throw Error(de(156,s.tag))}function $0(a,s){switch(ff(s),s.tag){case 1:return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 3:return Ec(sa),ft(),a=s.flags,(a&65536)!==0&&(a&128)===0?(s.flags=a&-65537|128,s):null;case 26:case 27:case 5:return it(s),null;case 13:if(yc(s),a=s.memoizedState,a!==null&&a.dehydrated!==null){if(s.alternate===null)throw Error(de(340));bh()}return a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 19:return Ne(ca),null;case 4:return ft(),null;case 10:return Ec(s.type),null;case 22:case 23:return yc(s),s_(),a!==null&&Ne(fu),a=s.flags,a&65536?(s.flags=a&-65537|128,s):null;case 24:return Ec(sa),null;case 25:return null;default:return null}}function ZT(a,s){switch(ff(s),s.tag){case 3:Ec(sa),ft();break;case 26:case 27:case 5:it(s);break;case 4:ft();break;case 13:yc(s);break;case 19:Ne(ca);break;case 10:Ec(s.type);break;case 22:case 23:yc(s),s_(),a!==null&&Ne(fu);break;case 24:Ec(sa)}}function Td(a,s){try{var d=s.updateQueue,g=d!==null?d.lastEffect:null;if(g!==null){var b=g.next;d=b;do{if((d.tag&a)===a){g=void 0;var k=d.create,_e=d.inst;g=k(),_e.destroy=g}d=d.next}while(d!==b)}}catch(Pe){hi(s,s.return,Pe)}}function ll(a,s,d){try{var g=s.updateQueue,b=g!==null?g.lastEffect:null;if(b!==null){var k=b.next;g=k;do{if((g.tag&a)===a){var _e=g.inst,Pe=_e.destroy;if(Pe!==void 0){_e.destroy=void 0,b=s;var ut=d,Bt=Pe;try{Bt()}catch($t){hi(b,ut,$t)}}}g=g.next}while(g!==k)}}catch($t){hi(s,s.return,$t)}}function QT(a){var s=a.updateQueue;if(s!==null){var d=a.stateNode;try{a_(s,d)}catch(g){hi(a,a.return,g)}}}function x_(a,s,d){d.props=gu(a.type,a.memoizedProps),d.state=a.memoizedState;try{d.componentWillUnmount()}catch(g){hi(a,s,g)}}function qh(a,s){try{var d=a.ref;if(d!==null){switch(a.tag){case 26:case 27:case 5:var g=a.stateNode;break;case 30:g=a.stateNode;break;default:g=a.stateNode}typeof d=="function"?a.refCleanup=d(g):d.current=g}}catch(b){hi(a,s,b)}}function ns(a,s){var d=a.ref,g=a.refCleanup;if(d!==null)if(typeof g=="function")try{g()}catch(b){hi(a,s,b)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(b){hi(a,s,b)}else d.current=null}function rm(a){var s=a.type,d=a.memoizedProps,g=a.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":d.autoFocus&&g.focus();break e;case"img":d.src?g.src=d.src:d.srcSet&&(g.srcset=d.srcSet)}}catch(b){hi(a,a.return,b)}}function j_(a,s,d){try{var g=a.stateNode;sC(g,a.type,d,s),g[Re]=s}catch(b){hi(a,a.return,b)}}function $T(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Rl(a.type)||a.tag===4}function Tu(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||$T(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Rl(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function nm(a,s,d){var g=a.tag;if(g===5||g===6)a=a.stateNode,s?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(a,s):(s=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,s.appendChild(a),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=Cm));else if(g!==4&&(g===27&&Rl(a.type)&&(d=a.stateNode,s=null),a=a.child,a!==null))for(nm(a,s,d),a=a.sibling;a!==null;)nm(a,s,d),a=a.sibling}function ul(a,s,d){var g=a.tag;if(g===5||g===6)a=a.stateNode,s?d.insertBefore(a,s):d.appendChild(a);else if(g!==4&&(g===27&&Rl(a.type)&&(d=a.stateNode),a=a.child,a!==null))for(ul(a,s,d),a=a.sibling;a!==null;)ul(a,s,d),a=a.sibling}function yu(a){var s=a.stateNode,d=a.memoizedProps;try{for(var g=a.type,b=s.attributes;b.length;)s.removeAttributeNode(b[0]);Ca(s,g,d),s[te]=a,s[Re]=d}catch(k){hi(a,a.return,k)}}var Ls=!1,wi=!1,yd=!1,ey=typeof WeakSet=="function"?WeakSet:Set,_a=null;function eC(a,s){if(a=a.containerInfo,ig=wm,a=$v(a),Va(a)){if("selectionStart"in a)var d={start:a.selectionStart,end:a.selectionEnd};else e:{d=(d=a.ownerDocument)&&d.defaultView||window;var g=d.getSelection&&d.getSelection();if(g&&g.rangeCount!==0){d=g.anchorNode;var b=g.anchorOffset,k=g.focusNode;g=g.focusOffset;try{d.nodeType,k.nodeType}catch{d=null;break e}var _e=0,Pe=-1,ut=-1,Bt=0,$t=0,Er=a,Ht=null;t:for(;;){for(var qt;Er!==d||b!==0&&Er.nodeType!==3||(Pe=_e+b),Er!==k||g!==0&&Er.nodeType!==3||(ut=_e+g),Er.nodeType===3&&(_e+=Er.nodeValue.length),(qt=Er.firstChild)!==null;)Ht=Er,Er=qt;for(;;){if(Er===a)break t;if(Ht===d&&++Bt===b&&(Pe=_e),Ht===k&&++$t===g&&(ut=_e),(qt=Er.nextSibling)!==null)break;Er=Ht,Ht=Er.parentNode}Er=qt}d=Pe===-1||ut===-1?null:{start:Pe,end:ut}}else d=null}d=d||{start:0,end:0}}else d=null;for(ag={focusedElem:a,selectionRange:d},wm=!1,_a=s;_a!==null;)if(s=_a,a=s.child,(s.subtreeFlags&1024)!==0&&a!==null)a.return=s,_a=a;else for(;_a!==null;){switch(s=_a,k=s.alternate,a=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((a&1024)!==0&&k!==null){a=void 0,d=s,b=k.memoizedProps,k=k.memoizedState,g=d.stateNode;try{var nn=gu(d.type,b,d.elementType===d.type);a=g.getSnapshotBeforeUpdate(nn,k),g.__reactInternalSnapshotBeforeUpdate=a}catch(Fr){hi(d,d.return,Fr)}}break;case 3:if((a&1024)!==0){if(a=s.stateNode.containerInfo,d=a.nodeType,d===9)lg(a);else if(d===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":lg(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(de(163))}if(a=s.sibling,a!==null){a.return=s.return,_a=a;break}_a=s.return}}function B_(a,s,d){var g=d.flags;switch(d.tag){case 0:case 11:case 15:Cc(a,d),g&4&&Td(5,d);break;case 1:if(Cc(a,d),g&4)if(a=d.stateNode,s===null)try{a.componentDidMount()}catch(_e){hi(d,d.return,_e)}else{var b=gu(d.type,s.memoizedProps);s=s.memoizedState;try{a.componentDidUpdate(b,s,a.__reactInternalSnapshotBeforeUpdate)}catch(_e){hi(d,d.return,_e)}}g&64&&QT(d),g&512&&qh(d,d.return);break;case 3:if(Cc(a,d),g&64&&(a=d.updateQueue,a!==null)){if(s=null,d.child!==null)switch(d.child.tag){case 27:case 5:s=d.child.stateNode;break;case 1:s=d.child.stateNode}try{a_(a,s)}catch(_e){hi(d,d.return,_e)}}break;case 27:s===null&&g&4&&yu(d);case 26:case 5:Cc(a,d),s===null&&g&4&&rm(d),g&512&&qh(d,d.return);break;case 12:Cc(a,d);break;case 13:Cc(a,d),g&4&&ry(a,d),g&64&&(a=d.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(d=$_.bind(null,d),fC(a,d))));break;case 22:if(g=d.memoizedState!==null||Ls,!g){s=s!==null&&s.memoizedState!==null||wi,b=Ls;var k=wi;Ls=g,(wi=s)&&!k?hl(a,d,(d.subtreeFlags&8772)!==0):Cc(a,d),Ls=b,wi=k}break;case 30:break;default:Cc(a,d)}}function ty(a){var s=a.alternate;s!==null&&(a.alternate=null,ty(s)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(s=a.stateNode,s!==null&&lt(s)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var Ai=null,Qa=!1;function is(a,s,d){for(d=d.child;d!==null;)Yh(a,s,d),d=d.sibling}function Yh(a,s,d){if(Zt&&typeof Zt.onCommitFiberUnmount=="function")try{Zt.onCommitFiberUnmount(Wt,d)}catch{}switch(d.tag){case 26:wi||ns(d,s),is(a,s,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:wi||ns(d,s);var g=Ai,b=Qa;Rl(d.type)&&(Ai=d.stateNode,Qa=!1),is(a,s,d),op(d.stateNode),Ai=g,Qa=b;break;case 5:wi||ns(d,s);case 6:if(g=Ai,b=Qa,Ai=null,is(a,s,d),Ai=g,Qa=b,Ai!==null)if(Qa)try{(Ai.nodeType===9?Ai.body:Ai.nodeName==="HTML"?Ai.ownerDocument.body:Ai).removeChild(d.stateNode)}catch(k){hi(d,s,k)}else try{Ai.removeChild(d.stateNode)}catch(k){hi(d,s,k)}break;case 18:Ai!==null&&(Qa?(a=Ai,Dy(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,d.stateNode),no(a)):Dy(Ai,d.stateNode));break;case 4:g=Ai,b=Qa,Ai=d.stateNode.containerInfo,Qa=!0,is(a,s,d),Ai=g,Qa=b;break;case 0:case 11:case 14:case 15:wi||ll(2,d,s),wi||ll(4,d,s),is(a,s,d);break;case 1:wi||(ns(d,s),g=d.stateNode,typeof g.componentWillUnmount=="function"&&x_(d,s,g)),is(a,s,d);break;case 21:is(a,s,d);break;case 22:wi=(g=wi)||d.memoizedState!==null,is(a,s,d),wi=g;break;default:is(a,s,d)}}function ry(a,s){if(s.memoizedState===null&&(a=s.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{no(a)}catch(d){hi(s,s.return,d)}}function Sd(a){switch(a.tag){case 13:case 19:var s=a.stateNode;return s===null&&(s=a.stateNode=new ey),s;case 22:return a=a.stateNode,s=a._retryCache,s===null&&(s=a._retryCache=new ey),s;default:throw Error(de(435,a.tag))}}function im(a,s){var d=Sd(a);s.forEach(function(g){var b=nC.bind(null,a,g);d.has(g)||(d.add(g),g.then(b,b))})}function Ri(a,s){var d=s.deletions;if(d!==null)for(var g=0;g<d.length;g++){var b=d[g],k=a,_e=s,Pe=_e;e:for(;Pe!==null;){switch(Pe.tag){case 27:if(Rl(Pe.type)){Ai=Pe.stateNode,Qa=!1;break e}break;case 5:Ai=Pe.stateNode,Qa=!1;break e;case 3:case 4:Ai=Pe.stateNode.containerInfo,Qa=!0;break e}Pe=Pe.return}if(Ai===null)throw Error(de(160));Yh(k,_e,b),Ai=null,Qa=!1,k=b.alternate,k!==null&&(k.return=null),b.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)ny(s,a),s=s.sibling}var as=null;function ny(a,s){var d=a.alternate,g=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Ri(s,a),$a(a),g&4&&(ll(3,a,a.return),Td(3,a),ll(5,a,a.return));break;case 1:Ri(s,a),$a(a),g&512&&(wi||d===null||ns(d,d.return)),g&64&&Ls&&(a=a.updateQueue,a!==null&&(g=a.callbacks,g!==null&&(d=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=d===null?g:d.concat(g))));break;case 26:var b=as;if(Ri(s,a),$a(a),g&512&&(wi||d===null||ns(d,d.return)),g&4){var k=d!==null?d.memoizedState:null;if(g=a.memoizedState,d===null)if(g===null)if(a.stateNode===null){e:{g=a.type,d=a.memoizedProps,b=b.ownerDocument||b;t:switch(g){case"title":k=b.getElementsByTagName("title")[0],(!k||k[ye]||k[te]||k.namespaceURI==="http://www.w3.org/2000/svg"||k.hasAttribute("itemprop"))&&(k=b.createElement(g),b.head.insertBefore(k,b.querySelector("head > title"))),Ca(k,g,d),k[te]=a,pe(k),g=k;break e;case"link":var _e=Fy("link","href",b).get(g+(d.href||""));if(_e){for(var Pe=0;Pe<_e.length;Pe++)if(k=_e[Pe],k.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&k.getAttribute("rel")===(d.rel==null?null:d.rel)&&k.getAttribute("title")===(d.title==null?null:d.title)&&k.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){_e.splice(Pe,1);break t}}k=b.createElement(g),Ca(k,g,d),b.head.appendChild(k);break;case"meta":if(_e=Fy("meta","content",b).get(g+(d.content||""))){for(Pe=0;Pe<_e.length;Pe++)if(k=_e[Pe],k.getAttribute("content")===(d.content==null?null:""+d.content)&&k.getAttribute("name")===(d.name==null?null:d.name)&&k.getAttribute("property")===(d.property==null?null:d.property)&&k.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&k.getAttribute("charset")===(d.charSet==null?null:d.charSet)){_e.splice(Pe,1);break t}}k=b.createElement(g),Ca(k,g,d),b.head.appendChild(k);break;default:throw Error(de(468,g))}k[te]=a,pe(k),g=k}a.stateNode=g}else Gy(b,a.type,a.stateNode);else a.stateNode=Vy(b,g,a.memoizedProps);else k!==g?(k===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):k.count--,g===null?Gy(b,a.type,a.stateNode):Vy(b,g,a.memoizedProps)):g===null&&a.stateNode!==null&&j_(a,a.memoizedProps,d.memoizedProps)}break;case 27:Ri(s,a),$a(a),g&512&&(wi||d===null||ns(d,d.return)),d!==null&&g&4&&j_(a,a.memoizedProps,d.memoizedProps);break;case 5:if(Ri(s,a),$a(a),g&512&&(wi||d===null||ns(d,d.return)),a.flags&32){b=a.stateNode;try{yn(b,"")}catch(qt){hi(a,a.return,qt)}}g&4&&a.stateNode!=null&&(b=a.memoizedProps,j_(a,b,d!==null?d.memoizedProps:b)),g&1024&&(yd=!0);break;case 6:if(Ri(s,a),$a(a),g&4){if(a.stateNode===null)throw Error(de(162));g=a.memoizedProps,d=a.stateNode;try{d.nodeValue=g}catch(qt){hi(a,a.return,qt)}}break;case 3:if(lp=null,b=as,as=Am(s.containerInfo),Ri(s,a),as=b,$a(a),g&4&&d!==null&&d.memoizedState.isDehydrated)try{no(s.containerInfo)}catch(qt){hi(a,a.return,qt)}yd&&(yd=!1,iy(a));break;case 4:g=as,as=Am(a.stateNode.containerInfo),Ri(s,a),$a(a),as=g;break;case 12:Ri(s,a),$a(a);break;case 13:Ri(s,a),$a(a),a.child.flags&8192&&a.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(z_=Gt()),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,im(a,g)));break;case 22:b=a.memoizedState!==null;var ut=d!==null&&d.memoizedState!==null,Bt=Ls,$t=wi;if(Ls=Bt||b,wi=$t||ut,Ri(s,a),wi=$t,Ls=Bt,$a(a),g&8192)e:for(s=a.stateNode,s._visibility=b?s._visibility&-2:s._visibility|1,b&&(d===null||ut||Ls||wi||dl(a)),d=null,s=a;;){if(s.tag===5||s.tag===26){if(d===null){ut=d=s;try{if(k=ut.stateNode,b)_e=k.style,typeof _e.setProperty=="function"?_e.setProperty("display","none","important"):_e.display="none";else{Pe=ut.stateNode;var Er=ut.memoizedProps.style,Ht=Er!=null&&Er.hasOwnProperty("display")?Er.display:null;Pe.style.display=Ht==null||typeof Ht=="boolean"?"":(""+Ht).trim()}}catch(qt){hi(ut,ut.return,qt)}}}else if(s.tag===6){if(d===null){ut=s;try{ut.stateNode.nodeValue=b?"":ut.memoizedProps}catch(qt){hi(ut,ut.return,qt)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===a)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===a)break e;for(;s.sibling===null;){if(s.return===null||s.return===a)break e;d===s&&(d=null),s=s.return}d===s&&(d=null),s.sibling.return=s.return,s=s.sibling}g&4&&(g=a.updateQueue,g!==null&&(d=g.retryQueue,d!==null&&(g.retryQueue=null,im(a,d))));break;case 19:Ri(s,a),$a(a),g&4&&(g=a.updateQueue,g!==null&&(a.updateQueue=null,im(a,g)));break;case 30:break;case 21:break;default:Ri(s,a),$a(a)}}function $a(a){var s=a.flags;if(s&2){try{for(var d,g=a.return;g!==null;){if($T(g)){d=g;break}g=g.return}if(d==null)throw Error(de(160));switch(d.tag){case 27:var b=d.stateNode,k=Tu(a);ul(a,k,b);break;case 5:var _e=d.stateNode;d.flags&32&&(yn(_e,""),d.flags&=-33);var Pe=Tu(a);ul(a,Pe,_e);break;case 3:case 4:var ut=d.stateNode.containerInfo,Bt=Tu(a);nm(a,Bt,ut);break;default:throw Error(de(161))}}catch($t){hi(a,a.return,$t)}a.flags&=-3}s&4096&&(a.flags&=-4097)}function iy(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var s=a;iy(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),a=a.sibling}}function Cc(a,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)B_(a,s.alternate,s),s=s.sibling}function dl(a){for(a=a.child;a!==null;){var s=a;switch(s.tag){case 0:case 11:case 14:case 15:ll(4,s,s.return),dl(s);break;case 1:ns(s,s.return);var d=s.stateNode;typeof d.componentWillUnmount=="function"&&x_(s,s.return,d),dl(s);break;case 27:op(s.stateNode);case 26:case 5:ns(s,s.return),dl(s);break;case 22:s.memoizedState===null&&dl(s);break;case 30:dl(s);break;default:dl(s)}a=a.sibling}}function hl(a,s,d){for(d=d&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var g=s.alternate,b=a,k=s,_e=k.flags;switch(k.tag){case 0:case 11:case 15:hl(b,k,d),Td(4,k);break;case 1:if(hl(b,k,d),g=k,b=g.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Bt){hi(g,g.return,Bt)}if(g=k,b=g.updateQueue,b!==null){var Pe=g.stateNode;try{var ut=b.shared.hiddenCallbacks;if(ut!==null)for(b.shared.hiddenCallbacks=null,b=0;b<ut.length;b++)ET(ut[b],Pe)}catch(Bt){hi(g,g.return,Bt)}}d&&_e&64&&QT(k),qh(k,k.return);break;case 27:yu(k);case 26:case 5:hl(b,k,d),d&&g===null&&_e&4&&rm(k),qh(k,k.return);break;case 12:hl(b,k,d);break;case 13:hl(b,k,d),d&&_e&4&&ry(b,k);break;case 22:k.memoizedState===null&&hl(b,k,d),qh(k,k.return);break;case 30:break;default:hl(b,k,d)}s=s.sibling}}function am(a,s){var d=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(d=a.memoizedState.cachePool.pool),a=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(a=s.memoizedState.cachePool.pool),a!==d&&(a!=null&&a.refCount++,d!=null&&Oh(d))}function V_(a,s){a=null,s.alternate!==null&&(a=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==a&&(s.refCount++,a!=null&&Oh(a))}function ks(a,s,d,g){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)ay(a,s,d,g),s=s.sibling}function ay(a,s,d,g){var b=s.flags;switch(s.tag){case 0:case 11:case 15:ks(a,s,d,g),b&2048&&Td(9,s);break;case 1:ks(a,s,d,g);break;case 3:ks(a,s,d,g),b&2048&&(a=null,s.alternate!==null&&(a=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==a&&(s.refCount++,a!=null&&Oh(a)));break;case 12:if(b&2048){ks(a,s,d,g),a=s.stateNode;try{var k=s.memoizedProps,_e=k.id,Pe=k.onPostCommit;typeof Pe=="function"&&Pe(_e,s.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(ut){hi(s,s.return,ut)}}else ks(a,s,d,g);break;case 13:ks(a,s,d,g);break;case 23:break;case 22:k=s.stateNode,_e=s.alternate,s.memoizedState!==null?k._visibility&2?ks(a,s,d,g):Su(a,s):k._visibility&2?ks(a,s,d,g):(k._visibility|=2,pl(a,s,d,g,(s.subtreeFlags&10256)!==0)),b&2048&&am(_e,s);break;case 24:ks(a,s,d,g),b&2048&&V_(s.alternate,s);break;default:ks(a,s,d,g)}}function pl(a,s,d,g,b){for(b=b&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var k=a,_e=s,Pe=d,ut=g,Bt=_e.flags;switch(_e.tag){case 0:case 11:case 15:pl(k,_e,Pe,ut,b),Td(8,_e);break;case 23:break;case 22:var $t=_e.stateNode;_e.memoizedState!==null?$t._visibility&2?pl(k,_e,Pe,ut,b):Su(k,_e):($t._visibility|=2,pl(k,_e,Pe,ut,b)),b&&Bt&2048&&am(_e.alternate,_e);break;case 24:pl(k,_e,Pe,ut,b),b&&Bt&2048&&V_(_e.alternate,_e);break;default:pl(k,_e,Pe,ut,b)}s=s.sibling}}function Su(a,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var d=a,g=s,b=g.flags;switch(g.tag){case 22:Su(d,g),b&2048&&am(g.alternate,g);break;case 24:Su(d,g),b&2048&&V_(g.alternate,g);break;default:Su(d,g)}s=s.sibling}}var Xh=8192;function fl(a){if(a.subtreeFlags&Xh)for(a=a.child;a!==null;)oy(a),a=a.sibling}function oy(a){switch(a.tag){case 26:fl(a),a.flags&Xh&&a.memoizedState!==null&&RC(as,a.memoizedState,a.memoizedProps);break;case 5:fl(a);break;case 3:case 4:var s=as;as=Am(a.stateNode.containerInfo),fl(a),as=s;break;case 22:a.memoizedState===null&&(s=a.alternate,s!==null&&s.memoizedState!==null?(s=Xh,Xh=16777216,fl(a),Xh=s):fl(a));break;default:fl(a)}}function F_(a){var s=a.alternate;if(s!==null&&(a=s.child,a!==null)){s.child=null;do s=a.sibling,a.sibling=null,a=s;while(a!==null)}}function Jh(a){var s=a.deletions;if((a.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var g=s[d];_a=g,G_(g,a)}F_(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)om(a),a=a.sibling}function om(a){switch(a.tag){case 0:case 11:case 15:Jh(a),a.flags&2048&&ll(9,a,a.return);break;case 3:Jh(a);break;case 12:Jh(a);break;case 22:var s=a.stateNode;a.memoizedState!==null&&s._visibility&2&&(a.return===null||a.return.tag!==13)?(s._visibility&=-3,ml(a)):Jh(a);break;default:Jh(a)}}function ml(a){var s=a.deletions;if((a.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var g=s[d];_a=g,G_(g,a)}F_(a)}for(a=a.child;a!==null;){switch(s=a,s.tag){case 0:case 11:case 15:ll(8,s,s.return),ml(s);break;case 22:d=s.stateNode,d._visibility&2&&(d._visibility&=-3,ml(s));break;default:ml(s)}a=a.sibling}}function G_(a,s){for(;_a!==null;){var d=_a;switch(d.tag){case 0:case 11:case 15:ll(8,d,s);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var g=d.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:Oh(d.memoizedState.cache)}if(g=d.child,g!==null)g.return=d,_a=g;else e:for(d=a;_a!==null;){g=_a;var b=g.sibling,k=g.return;if(ty(g),g===d){_a=null;break e}if(b!==null){b.return=k,_a=b;break e}_a=k}}}var H_={getCacheForType:function(a){var s=$i(sa),d=s.data.get(a);return d===void 0&&(d=a(),s.data.set(a,d)),d}},W_=typeof WeakMap=="function"?WeakMap:Map,$n=0,di=null,_n=null,kn=0,Bn=0,Ga=null,Ms=!1,El=!1,sm=!1,Us=0,Vi=0,_l=0,_o=0,cm=0,No=0,gl=0,Zh=null,eo=null,K_=!1,z_=0,Rd=1/0,Qh=null,Ic=null,ga=0,os=null,Ru=null,vl=0,Cd=0,Id=null,q_=null,xs=0,Ac=null;function to(){if(($n&2)!==0&&kn!==0)return kn&-kn;if(q.T!==null){var a=rl;return a!==0?a:ap()}return Nt()}function sy(){No===0&&(No=(kn&536870912)===0||Gn?X():536870912);var a=Eo.current;return a!==null&&(a.flags|=32),No}function go(a,s,d){(a===di&&(Bn===2||Bn===9)||a.cancelPendingCommit!==null)&&(bd(a,0),Tl(a,kn,No,!1)),He(a,d),(($n&2)===0||a!==di)&&(a===di&&(($n&2)===0&&(_o|=d),Vi===4&&Tl(a,kn,No,!1)),ss(a))}function Ad(a,s,d){if(($n&6)!==0)throw Error(de(327));var g=!d&&(s&124)===0&&(s&a.expiredLanes)===0||le(a,s),b=g?js(a,s):J_(a,s,!0),k=g;do{if(b===0){El&&!g&&Tl(a,s,0,!1);break}else{if(d=a.current.alternate,k&&!tC(d)){b=J_(a,s,!1),k=!1;continue}if(b===2){if(k=s,a.errorRecoveryDisabledLanes&k)var _e=0;else _e=a.pendingLanes&-536870913,_e=_e!==0?_e:_e&536870912?536870912:0;if(_e!==0){s=_e;e:{var Pe=a;b=Zh;var ut=Pe.current.memoizedState.isDehydrated;if(ut&&(bd(Pe,_e).flags|=256),_e=J_(Pe,_e,!1),_e!==2){if(sm&&!ut){Pe.errorRecoveryDisabledLanes|=k,_o|=k,b=4;break e}k=eo,eo=b,k!==null&&(eo===null?eo=k:eo.push.apply(eo,k))}b=_e}if(k=!1,b!==2)continue}}if(b===1){bd(a,0),Tl(a,s,0,!0);break}e:{switch(g=a,k=b,k){case 0:case 1:throw Error(de(345));case 4:if((s&4194048)!==s)break;case 6:Tl(g,s,No,!Ms);break e;case 2:eo=null;break;case 3:case 5:break;default:throw Error(de(329))}if((s&62914560)===s&&(b=z_+300-Gt(),10<b)){if(Tl(g,s,No,!Ms),Ae(g,0,!0)!==0)break e;g.timeoutHandle=wy(cy.bind(null,g,d,eo,Qh,K_,s,No,_o,gl,Ms,k,2,-0,0),b);break e}cy(g,d,eo,Qh,K_,s,No,_o,gl,Ms,k,0,-0,0)}}break}while(!0);ss(a)}function cy(a,s,d,g,b,k,_e,Pe,ut,Bt,$t,Er,Ht,qt){if(a.timeoutHandle=-1,Er=s.subtreeFlags,(Er&8192||(Er&16785408)===16785408)&&(up={stylesheets:null,count:0,unsuspend:SC},oy(s),Er=Wy(),Er!==null)){a.cancelPendingCommit=Er(tp.bind(null,a,s,k,d,g,b,_e,Pe,ut,$t,1,Ht,qt)),Tl(a,k,_e,!Bt);return}tp(a,s,k,d,g,b,_e,Pe,ut)}function tC(a){for(var s=a;;){var d=s.tag;if((d===0||d===11||d===15)&&s.flags&16384&&(d=s.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var g=0;g<d.length;g++){var b=d[g],k=b.getSnapshot;b=b.value;try{if(!fo(k(),b))return!1}catch{return!1}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===a)break;for(;s.sibling===null;){if(s.return===null||s.return===a)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Tl(a,s,d,g){s&=~cm,s&=~_o,a.suspendedLanes|=s,a.pingedLanes&=~s,g&&(a.warmLanes|=s),g=a.expirationTimes;for(var b=s;0<b;){var k=31-At(b),_e=1<<k;g[k]=-1,b&=~_e}d!==0&&ht(a,d,s)}function lm(){return($n&6)===0?(ip(0),!1):!0}function Y_(){if(_n!==null){if(Bn===0)var a=_n.return;else a=_n,mc=fc=null,kh(a),gd=null,Fh=0,a=_n;for(;a!==null;)ZT(a.alternate,a),a=a.return;_n=null}}function bd(a,s){var d=a.timeoutHandle;d!==-1&&(a.timeoutHandle=-1,lC(d)),d=a.cancelPendingCommit,d!==null&&(a.cancelPendingCommit=null,d()),Y_(),di=a,_n=d=dc(a.current,null),kn=s,Bn=0,Ga=null,Ms=!1,El=le(a,s),sm=!1,gl=No=cm=_o=_l=Vi=0,eo=Zh=null,K_=!1,(s&8)!==0&&(s|=s&32);var g=a.entangledLanes;if(g!==0)for(a=a.entanglements,g&=s;0<g;){var b=31-At(g),k=1<<b;s|=a[b],g&=~k}return Us=s,hf(),d}function um(a,s){En=null,q.H=Vh,s===nl||s===yf?(s=Rf(),Bn=3):s===e_?(s=Rf(),Bn=4):Bn=s===N_?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Ga=s,_n===null&&(Vi=1,qf(a,bo(s,a.current)))}function X_(){var a=q.H;return q.H=Vh,a===null?Vh:a}function ly(){var a=q.A;return q.A=H_,a}function dm(){Vi=4,Ms||(kn&4194048)!==kn&&Eo.current!==null||(El=!0),(_l&134217727)===0&&(_o&134217727)===0||di===null||Tl(di,kn,No,!1)}function J_(a,s,d){var g=$n;$n|=2;var b=X_(),k=ly();(di!==a||kn!==s)&&(Qh=null,bd(a,s)),s=!1;var _e=Vi;e:do try{if(Bn!==0&&_n!==null){var Pe=_n,ut=Ga;switch(Bn){case 8:Y_(),_e=6;break e;case 3:case 2:case 9:case 6:Eo.current===null&&(s=!0);var Bt=Bn;if(Bn=0,Ga=null,yl(a,Pe,ut,Bt),d&&El){_e=0;break e}break;default:Bt=Bn,Bn=0,Ga=null,yl(a,Pe,ut,Bt)}}$h(),_e=Vi;break}catch($t){um(a,$t)}while(!0);return s&&a.shellSuspendCounter++,mc=fc=null,$n=g,q.H=b,q.A=k,_n===null&&(di=null,kn=0,hf()),_e}function $h(){for(;_n!==null;)dy(_n)}function js(a,s){var d=$n;$n|=2;var g=X_(),b=ly();di!==a||kn!==s?(Qh=null,Rd=Gt()+500,bd(a,s)):El=le(a,s);e:do try{if(Bn!==0&&_n!==null){s=_n;var k=Ga;t:switch(Bn){case 1:Bn=0,Ga=null,yl(a,s,k,1);break;case 2:case 9:if(r_(k)){Bn=0,Ga=null,hy(s);break}s=function(){Bn!==2&&Bn!==9||di!==a||(Bn=7),ss(a)},k.then(s,s);break e;case 3:Bn=7;break e;case 4:Bn=5;break e;case 7:r_(k)?(Bn=0,Ga=null,hy(s)):(Bn=0,Ga=null,yl(a,s,k,7));break;case 5:var _e=null;switch(_n.tag){case 26:_e=_n.memoizedState;case 5:case 27:var Pe=_n;if(!_e||Hy(_e)){Bn=0,Ga=null;var ut=Pe.sibling;if(ut!==null)_n=ut;else{var Bt=Pe.return;Bt!==null?(_n=Bt,ep(Bt)):_n=null}break t}}Bn=0,Ga=null,yl(a,s,k,5);break;case 6:Bn=0,Ga=null,yl(a,s,k,6);break;case 8:Y_(),Vi=6;break e;default:throw Error(de(462))}}uy();break}catch($t){um(a,$t)}while(!0);return mc=fc=null,q.H=g,q.A=b,$n=d,_n!==null?0:(di=null,kn=0,hf(),Vi)}function uy(){for(;_n!==null&&!jt();)dy(_n)}function dy(a){var s=XT(a.alternate,a,Us);a.memoizedProps=a.pendingProps,s===null?ep(a):_n=s}function hy(a){var s=a,d=s.alternate;switch(s.tag){case 15:case 0:s=P_(d,s,s.pendingProps,s.type,void 0,kn);break;case 11:s=P_(d,s,s.pendingProps,s.type.render,s.ref,kn);break;case 5:kh(s);default:ZT(d,s),s=_n=sT(s,Us),s=XT(d,s,Us)}a.memoizedProps=a.pendingProps,s===null?ep(a):_n=s}function yl(a,s,d,g){mc=fc=null,kh(s),gd=null,Fh=0;var b=s.return;try{if(Q0(a,b,s,d,kn)){Vi=1,qf(a,bo(d,a.current)),_n=null;return}}catch(k){if(b!==null)throw _n=b,k;Vi=1,qf(a,bo(d,a.current)),_n=null;return}s.flags&32768?(Gn||g===1?a=!0:El||(kn&536870912)!==0?a=!1:(Ms=a=!0,(g===2||g===9||g===3||g===6)&&(g=Eo.current,g!==null&&g.tag===13&&(g.flags|=16384))),py(s,a)):ep(s)}function ep(a){var s=a;do{if((s.flags&32768)!==0){py(s,Ms);return}a=s.return;var d=JT(s.alternate,s,Us);if(d!==null){_n=d;return}if(s=s.sibling,s!==null){_n=s;return}_n=s=a}while(s!==null);Vi===0&&(Vi=5)}function py(a,s){do{var d=$0(a.alternate,a);if(d!==null){d.flags&=32767,_n=d;return}if(d=a.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!s&&(a=a.sibling,a!==null)){_n=a;return}_n=a=d}while(a!==null);Vi=6,_n=null}function tp(a,s,d,g,b,k,_e,Pe,ut){a.cancelPendingCommit=null;do hm();while(ga!==0);if(($n&6)!==0)throw Error(de(327));if(s!==null){if(s===a.current)throw Error(de(177));if(k=s.lanes|s.childLanes,k|=KE,Qe(a,d,k,_e,Pe,ut),a===di&&(_n=di=null,kn=0),Ru=s,os=a,vl=d,Cd=k,Id=b,q_=g,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,iC(er,function(){return _y(),null})):(a.callbackNode=null,a.callbackPriority=0),g=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||g){g=q.T,q.T=null,b=ve.p,ve.p=2,_e=$n,$n|=4;try{eC(a,s,d)}finally{$n=_e,ve.p=b,q.T=g}}ga=1,bc(),Od(),fy()}}function bc(){if(ga===1){ga=0;var a=os,s=Ru,d=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||d){d=q.T,q.T=null;var g=ve.p;ve.p=2;var b=$n;$n|=4;try{ny(s,a);var k=ag,_e=$v(a.containerInfo),Pe=k.focusedElem,ut=k.selectionRange;if(_e!==Pe&&Pe&&Pe.ownerDocument&&Qv(Pe.ownerDocument.documentElement,Pe)){if(ut!==null&&Va(Pe)){var Bt=ut.start,$t=ut.end;if($t===void 0&&($t=Bt),"selectionStart"in Pe)Pe.selectionStart=Bt,Pe.selectionEnd=Math.min($t,Pe.value.length);else{var Er=Pe.ownerDocument||document,Ht=Er&&Er.defaultView||window;if(Ht.getSelection){var qt=Ht.getSelection(),nn=Pe.textContent.length,Fr=Math.min(ut.start,nn),ii=ut.end===void 0?Fr:Math.min(ut.end,nn);!qt.extend&&Fr>ii&&(_e=ii,ii=Fr,Fr=_e);var Ot=Zo(Pe,Fr),gt=Zo(Pe,ii);if(Ot&&gt&&(qt.rangeCount!==1||qt.anchorNode!==Ot.node||qt.anchorOffset!==Ot.offset||qt.focusNode!==gt.node||qt.focusOffset!==gt.offset)){var Ut=Er.createRange();Ut.setStart(Ot.node,Ot.offset),qt.removeAllRanges(),Fr>ii?(qt.addRange(Ut),qt.extend(gt.node,gt.offset)):(Ut.setEnd(gt.node,gt.offset),qt.addRange(Ut))}}}}for(Er=[],qt=Pe;qt=qt.parentNode;)qt.nodeType===1&&Er.push({element:qt,left:qt.scrollLeft,top:qt.scrollTop});for(typeof Pe.focus=="function"&&Pe.focus(),Pe=0;Pe<Er.length;Pe++){var dr=Er[Pe];dr.element.scrollLeft=dr.left,dr.element.scrollTop=dr.top}}wm=!!ig,ag=ig=null}finally{$n=b,ve.p=g,q.T=d}}a.current=s,ga=2}}function Od(){if(ga===2){ga=0;var a=os,s=Ru,d=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||d){d=q.T,q.T=null;var g=ve.p;ve.p=2;var b=$n;$n|=4;try{B_(a,s.alternate,s)}finally{$n=b,ve.p=g,q.T=d}}ga=3}}function fy(){if(ga===4||ga===3){ga=0,Lt();var a=os,s=Ru,d=vl,g=q_;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?ga=5:(ga=0,Ru=os=null,Ey(a,a.pendingLanes));var b=a.pendingLanes;if(b===0&&(Ic=null),xt(d),s=s.stateNode,Zt&&typeof Zt.onCommitFiberRoot=="function")try{Zt.onCommitFiberRoot(Wt,s,void 0,(s.current.flags&128)===128)}catch{}if(g!==null){s=q.T,b=ve.p,ve.p=2,q.T=null;try{for(var k=a.onRecoverableError,_e=0;_e<g.length;_e++){var Pe=g[_e];k(Pe.value,{componentStack:Pe.stack})}}finally{q.T=s,ve.p=b}}(vl&3)!==0&&hm(),ss(a),b=a.pendingLanes,(d&4194090)!==0&&(b&42)!==0?a===Ac?xs++:(xs=0,Ac=a):xs=0,ip(0)}}function Ey(a,s){(a.pooledCacheLanes&=s)===0&&(s=a.pooledCache,s!=null&&(a.pooledCache=null,Oh(s)))}function hm(a){return bc(),Od(),fy(),_y()}function _y(){if(ga!==5)return!1;var a=os,s=Cd;Cd=0;var d=xt(vl),g=q.T,b=ve.p;try{ve.p=32>d?32:d,q.T=null,d=Id,Id=null;var k=os,_e=vl;if(ga=0,Ru=os=null,vl=0,($n&6)!==0)throw Error(de(331));var Pe=$n;if($n|=4,om(k.current),ay(k,k.current,_e,d),$n=Pe,ip(0,!1),Zt&&typeof Zt.onPostCommitFiberRoot=="function")try{Zt.onPostCommitFiberRoot(Wt,k)}catch{}return!0}finally{ve.p=b,q.T=g,Ey(a,s)}}function pm(a,s,d){s=bo(d,s),s=O_(a.stateNode,s,2),a=es(a,s,2),a!==null&&(He(a,2),ss(a))}function hi(a,s,d){if(a.tag===3)pm(a,a,d);else for(;s!==null;){if(s.tag===3){pm(s,a,d);break}else if(s.tag===1){var g=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(Ic===null||!Ic.has(g))){a=bo(d,a),d=GT(2),g=es(s,d,2),g!==null&&(HT(d,g,s,a),He(g,2),ss(g));break}}s=s.return}}function Z_(a,s,d){var g=a.pingCache;if(g===null){g=a.pingCache=new W_;var b=new Set;g.set(s,b)}else b=g.get(s),b===void 0&&(b=new Set,g.set(s,b));b.has(d)||(sm=!0,b.add(d),a=rC.bind(null,a,s,d),s.then(a,a))}function rC(a,s,d){var g=a.pingCache;g!==null&&g.delete(s),a.pingedLanes|=a.suspendedLanes&d,a.warmLanes&=~d,di===a&&(kn&d)===d&&(Vi===4||Vi===3&&(kn&62914560)===kn&&300>Gt()-z_?($n&2)===0&&bd(a,0):cm|=d,gl===kn&&(gl=0)),ss(a)}function Q_(a,s){s===0&&(s=et()),a=Qc(a,s),a!==null&&(He(a,s),ss(a))}function $_(a){var s=a.memoizedState,d=0;s!==null&&(d=s.retryLane),Q_(a,d)}function nC(a,s){var d=0;switch(a.tag){case 13:var g=a.stateNode,b=a.memoizedState;b!==null&&(d=b.retryLane);break;case 19:g=a.stateNode;break;case 22:g=a.stateNode._retryCache;break;default:throw Error(de(314))}g!==null&&g.delete(s),Q_(a,d)}function iC(a,s){return Pt(a,s)}var fm=null,Cu=null,rp=!1,np=!1,mm=!1,Bs=0;function ss(a){a!==Cu&&a.next===null&&(Cu===null?fm=Cu=a:Cu=Cu.next=a),np=!0,rp||(rp=!0,Ty())}function ip(a,s){if(!mm&&np){mm=!0;do for(var d=!1,g=fm;g!==null;){if(a!==0){var b=g.pendingLanes;if(b===0)var k=0;else{var _e=g.suspendedLanes,Pe=g.pingedLanes;k=(1<<31-At(42|a)+1)-1,k&=b&~(_e&~Pe),k=k&201326741?k&201326741|1:k?k|2:0}k!==0&&(d=!0,Em(g,k))}else k=kn,k=Ae(g,g===di?k:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(k&3)===0||le(g,k)||(d=!0,Em(g,k));g=g.next}while(d);mm=!1}}function eg(){gy()}function gy(){np=rp=!1;var a=0;Bs!==0&&(cC()&&(a=Bs),Bs=0);for(var s=Gt(),d=null,g=fm;g!==null;){var b=g.next,k=vy(g,s);k===0?(g.next=null,d===null?fm=b:d.next=b,b===null&&(Cu=d)):(d=g,(a!==0||(k&3)!==0)&&(np=!0)),g=b}ip(a)}function vy(a,s){for(var d=a.suspendedLanes,g=a.pingedLanes,b=a.expirationTimes,k=a.pendingLanes&-62914561;0<k;){var _e=31-At(k),Pe=1<<_e,ut=b[_e];ut===-1?((Pe&d)===0||(Pe&g)!==0)&&(b[_e]=Xe(Pe,s)):ut<=s&&(a.expiredLanes|=Pe),k&=~Pe}if(s=di,d=kn,d=Ae(a,a===s?d:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),g=a.callbackNode,d===0||a===s&&(Bn===2||Bn===9)||a.cancelPendingCommit!==null)return g!==null&&g!==null&&bt(g),a.callbackNode=null,a.callbackPriority=0;if((d&3)===0||le(a,d)){if(s=d&-d,s===a.callbackPriority)return s;switch(g!==null&&bt(g),xt(d)){case 2:case 8:d=Ar;break;case 32:d=er;break;case 268435456:d=Xt;break;default:d=er}return g=Nd.bind(null,a),d=Pt(d,g),a.callbackPriority=s,a.callbackNode=d,s}return g!==null&&g!==null&&bt(g),a.callbackPriority=2,a.callbackNode=null,2}function Nd(a,s){if(ga!==0&&ga!==5)return a.callbackNode=null,a.callbackPriority=0,null;var d=a.callbackNode;if(hm()&&a.callbackNode!==d)return null;var g=kn;return g=Ae(a,a===di?g:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),g===0?null:(Ad(a,g,s),vy(a,Gt()),a.callbackNode!=null&&a.callbackNode===d?Nd.bind(null,a):null)}function Em(a,s){if(hm())return null;Ad(a,s,!0)}function Ty(){uC(function(){($n&6)!==0?Pt(ir,eg):gy()})}function ap(){return Bs===0&&(Bs=X()),Bs}function _m(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Yc(""+a)}function gm(a,s){var d=s.ownerDocument.createElement("input");return d.name=s.name,d.value=s.value,a.id&&d.setAttribute("form",a.id),s.parentNode.insertBefore(d,s),a=new FormData(a),d.parentNode.removeChild(d),a}function aC(a,s,d,g,b){if(s==="submit"&&d&&d.stateNode===b){var k=_m((b[Re]||null).action),_e=g.submitter;_e&&(s=(s=_e[Re]||null)?_m(s.formAction):_e.getAttribute("formAction"),s!==null&&(k=s,_e=null));var Pe=new Ui("action","action",null,g,b);a.push({event:Pe,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(Bs!==0){var ut=_e?gm(b,_e):new FormData(b);S_(d,{pending:!0,data:ut,method:b.method,action:k},null,ut)}}else typeof k=="function"&&(Pe.preventDefault(),ut=_e?gm(b,_e):new FormData(b),S_(d,{pending:!0,data:ut,method:b.method,action:k},k,ut))},currentTarget:b}]})}}for(var tg=0;tg<WE.length;tg++){var vm=WE[tg],yy=vm.toLowerCase(),Sy=vm[0].toUpperCase()+vm.slice(1);Qo(yy,"on"+Sy)}Qo(uf,"onAnimationEnd"),Qo(df,"onAnimationIteration"),Qo(rT,"onAnimationStart"),Qo("dblclick","onDoubleClick"),Qo("focusin","onFocus"),Qo("focusout","onBlur"),Qo(Qt,"onTransitionRun"),Qo(B0,"onTransitionStart"),Qo(V0,"onTransitionCancel"),Qo(nT,"onTransitionEnd"),Je("onMouseEnter",["mouseout","mouseover"]),Je("onMouseLeave",["mouseout","mouseover"]),Je("onPointerEnter",["pointerout","pointerover"]),Je("onPointerLeave",["pointerout","pointerover"]),Fe("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Fe("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Fe("onBeforeInput",["compositionend","keypress","textInput","paste"]),Fe("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Fe("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Fe("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ry=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(wd));function Cy(a,s){s=(s&4)!==0;for(var d=0;d<a.length;d++){var g=a[d],b=g.event;g=g.listeners;e:{var k=void 0;if(s)for(var _e=g.length-1;0<=_e;_e--){var Pe=g[_e],ut=Pe.instance,Bt=Pe.currentTarget;if(Pe=Pe.listener,ut!==k&&b.isPropagationStopped())break e;k=Pe,b.currentTarget=Bt;try{k(b)}catch($t){Kf($t)}b.currentTarget=null,k=ut}else for(_e=0;_e<g.length;_e++){if(Pe=g[_e],ut=Pe.instance,Bt=Pe.currentTarget,Pe=Pe.listener,ut!==k&&b.isPropagationStopped())break e;k=Pe,b.currentTarget=Bt;try{k(b)}catch($t){Kf($t)}b.currentTarget=null,k=ut}}}}function In(a,s){var d=s[Ee];d===void 0&&(d=s[Ee]=new Set);var g=a+"__bubble";d.has(g)||(Tm(s,a,2,!1),d.add(g))}function rg(a,s,d){var g=0;s&&(g|=4),Tm(d,a,g,s)}var Oc="_reactListening"+Math.random().toString(36).slice(2);function Sl(a){if(!a[Oc]){a[Oc]=!0,Ue.forEach(function(d){d!=="selectionchange"&&(Ry.has(d)||rg(d,!1,a),rg(d,!0,a))});var s=a.nodeType===9?a:a.ownerDocument;s===null||s[Oc]||(s[Oc]=!0,rg("selectionchange",!1,s))}}function Tm(a,s,d,g){switch(Xy(s)){case 2:var b=CC;break;case 8:b=ro;break;default:b=_g}d=b.bind(null,s,d,a),b=void 0,!Ju||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(b=!0),g?b!==void 0?a.addEventListener(s,d,{capture:!0,passive:b}):a.addEventListener(s,d,!0):b!==void 0?a.addEventListener(s,d,{passive:b}):a.addEventListener(s,d,!1)}function ym(a,s,d,g,b){var k=g;if((s&1)===0&&(s&2)===0&&g!==null)e:for(;;){if(g===null)return;var _e=g.tag;if(_e===3||_e===4){var Pe=g.stateNode.containerInfo;if(Pe===b)break;if(_e===4)for(_e=g.return;_e!==null;){var ut=_e.tag;if((ut===3||ut===4)&&_e.stateNode.containerInfo===b)return;_e=_e.return}for(;Pe!==null;){if(_e=Ze(Pe),_e===null)return;if(ut=_e.tag,ut===5||ut===6||ut===26||ut===27){g=k=_e;continue e}Pe=Pe.parentNode}}g=g.return}Is(function(){var Bt=k,$t=Cs(d),Er=[];e:{var Ht=iT.get(a);if(Ht!==void 0){var qt=Ui,nn=a;switch(a){case"keypress":if(sc(d)===0)break e;case"keydown":case"keyup":qt=C0;break;case"focusin":nn="focus",qt=ru;break;case"focusout":nn="blur",qt=ru;break;case"beforeblur":case"afterblur":qt=ru;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":qt=Si;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":qt=lc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":qt=$u;break;case uf:case df:case rT:qt=bs;break;case nT:qt=b0;break;case"scroll":case"scrollend":qt=Fn;break;case"wheel":qt=O0;break;case"copy":case"cut":case"paste":qt=xi;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":qt=iu;break;case"toggle":case"beforetoggle":qt=w0}var Fr=(s&4)!==0,ii=!Fr&&(a==="scroll"||a==="scrollend"),Ot=Fr?Ht!==null?Ht+"Capture":null:Ht;Fr=[];for(var gt=Bt,Ut;gt!==null;){var dr=gt;if(Ut=dr.stateNode,dr=dr.tag,dr!==5&&dr!==26&&dr!==27||Ut===null||Ot===null||(dr=Xc(gt,Ot),dr!=null&&Fr.push(Dd(gt,dr,Ut))),ii)break;gt=gt.return}0<Fr.length&&(Ht=new qt(Ht,nn,null,d,$t),Er.push({event:Ht,listeners:Fr}))}}if((s&7)===0){e:{if(Ht=a==="mouseover"||a==="pointerover",qt=a==="mouseout"||a==="pointerout",Ht&&d!==$l&&(nn=d.relatedTarget||d.fromElement)&&(Ze(nn)||nn[re]))break e;if((qt||Ht)&&(Ht=$t.window===$t?$t:(Ht=$t.ownerDocument)?Ht.defaultView||Ht.parentWindow:window,qt?(nn=d.relatedTarget||d.toElement,qt=Bt,nn=nn?Ze(nn):null,nn!==null&&(ii=We(nn),Fr=nn.tag,nn!==ii||Fr!==5&&Fr!==27&&Fr!==6)&&(nn=null)):(qt=null,nn=Bt),qt!==nn)){if(Fr=Si,dr="onMouseLeave",Ot="onMouseEnter",gt="mouse",(a==="pointerout"||a==="pointerover")&&(Fr=iu,dr="onPointerLeave",Ot="onPointerEnter",gt="pointer"),ii=qt==null?Ht:Q(qt),Ut=nn==null?Ht:Q(nn),Ht=new Fr(dr,gt+"leave",qt,d,$t),Ht.target=ii,Ht.relatedTarget=Ut,dr=null,Ze($t)===Bt&&(Fr=new Fr(Ot,gt+"enter",nn,d,$t),Fr.target=Ut,Fr.relatedTarget=ii,dr=Fr),ii=dr,qt&&nn)t:{for(Fr=qt,Ot=nn,gt=0,Ut=Fr;Ut;Ut=Iu(Ut))gt++;for(Ut=0,dr=Ot;dr;dr=Iu(dr))Ut++;for(;0<gt-Ut;)Fr=Iu(Fr),gt--;for(;0<Ut-gt;)Ot=Iu(Ot),Ut--;for(;gt--;){if(Fr===Ot||Ot!==null&&Fr===Ot.alternate)break t;Fr=Iu(Fr),Ot=Iu(Ot)}Fr=null}else Fr=null;qt!==null&&Iy(Er,Ht,qt,Fr,!1),nn!==null&&ii!==null&&Iy(Er,ii,nn,Fr,!0)}}e:{if(Ht=Bt?Q(Bt):window,qt=Ht.nodeName&&Ht.nodeName.toLowerCase(),qt==="select"||qt==="input"&&Ht.type==="file")var Pr=zv;else if(Kv(Ht))if(qv)Pr=x0;else{Pr=GE;var An=Jv}else qt=Ht.nodeName,!qt||qt.toLowerCase()!=="input"||Ht.type!=="checkbox"&&Ht.type!=="radio"?Bt&&Zl(Bt.elementType)&&(Pr=zv):Pr=U0;if(Pr&&(Pr=Pr(a,Bt))){jE(Er,Pr,d,$t);break e}An&&An(a,Ht,Bt),a==="focusout"&&Bt&&Ht.type==="number"&&Bt.memoizedProps.value!=null&&Ss(Ht,"number",Ht.value)}switch(An=Bt?Q(Bt):window,a){case"focusin":(Kv(An)||An.contentEditable==="true")&&(td=An,HE=Bt,yh=null);break;case"focusout":yh=HE=td=null;break;case"mousedown":cf=!0;break;case"contextmenu":case"mouseup":case"dragend":cf=!1,eT(Er,d,$t);break;case"selectionchange":if(j0)break;case"keydown":case"keyup":eT(Er,d,$t)}var Br;if(_h)e:{switch(a){case"compositionstart":var qr="onCompositionStart";break e;case"compositionend":qr="onCompositionEnd";break e;case"compositionupdate":qr="onCompositionUpdate";break e}qr=void 0}else ed?Wv(a,d)&&(qr="onCompositionEnd"):a==="keydown"&&d.keyCode===229&&(qr="onCompositionStart");qr&&(Gv&&d.locale!=="ko"&&(ed||qr!=="onCompositionStart"?qr==="onCompositionEnd"&&ed&&(Br=As()):(Xo=$t,Zu="value"in Xo?Xo.value:Xo.textContent,ed=!0)),An=Sm(Bt,qr),0<An.length&&(qr=new Ja(qr,a,null,d,$t),Er.push({event:qr,listeners:An}),Br?qr.data=Br:(Br=xE(d),Br!==null&&(qr.data=Br)))),(Br=P0?uc(a,d):L0(a,d))&&(qr=Sm(Bt,"onBeforeInput"),0<qr.length&&(An=new Ja("onBeforeInput","beforeinput",null,d,$t),Er.push({event:An,listeners:qr}),An.data=Br)),aC(Er,a,Bt,d,$t)}Cy(Er,s)})}function Dd(a,s,d){return{instance:a,listener:s,currentTarget:d}}function Sm(a,s){for(var d=s+"Capture",g=[];a!==null;){var b=a,k=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||k===null||(b=Xc(a,d),b!=null&&g.unshift(Dd(a,b,k)),b=Xc(a,s),b!=null&&g.push(Dd(a,b,k))),a.tag===3)return g;a=a.return}return[]}function Iu(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Iy(a,s,d,g,b){for(var k=s._reactName,_e=[];d!==null&&d!==g;){var Pe=d,ut=Pe.alternate,Bt=Pe.stateNode;if(Pe=Pe.tag,ut!==null&&ut===g)break;Pe!==5&&Pe!==26&&Pe!==27||Bt===null||(ut=Bt,b?(Bt=Xc(d,k),Bt!=null&&_e.unshift(Dd(d,Bt,ut))):b||(Bt=Xc(d,k),Bt!=null&&_e.push(Dd(d,Bt,ut)))),d=d.return}_e.length!==0&&a.push({event:s,listeners:_e})}var oC=/\r\n?/g,Rm=/\u0000|\uFFFD/g;function Ay(a){return(typeof a=="string"?a:""+a).replace(oC,`
`).replace(Rm,"")}function by(a,s){return s=Ay(s),Ay(a)===s}function Cm(){}function ni(a,s,d,g,b,k){switch(d){case"children":typeof g=="string"?s==="body"||s==="textarea"&&g===""||yn(a,g):(typeof g=="number"||typeof g=="bigint")&&s!=="body"&&yn(a,""+g);break;case"className":Or(a,"class",g);break;case"tabIndex":Or(a,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":Or(a,d,g);break;case"style":Rs(a,g,k);break;case"data":if(s!=="object"){Or(a,"data",g);break}case"src":case"href":if(g===""&&(s!=="a"||d!=="href")){a.removeAttribute(d);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){a.removeAttribute(d);break}g=Yc(""+g),a.setAttribute(d,g);break;case"action":case"formAction":if(typeof g=="function"){a.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof k=="function"&&(d==="formAction"?(s!=="input"&&ni(a,s,"name",b.name,b,null),ni(a,s,"formEncType",b.formEncType,b,null),ni(a,s,"formMethod",b.formMethod,b,null),ni(a,s,"formTarget",b.formTarget,b,null)):(ni(a,s,"encType",b.encType,b,null),ni(a,s,"method",b.method,b,null),ni(a,s,"target",b.target,b,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){a.removeAttribute(d);break}g=Yc(""+g),a.setAttribute(d,g);break;case"onClick":g!=null&&(a.onclick=Cm);break;case"onScroll":g!=null&&In("scroll",a);break;case"onScrollEnd":g!=null&&In("scrollend",a);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(de(61));if(d=g.__html,d!=null){if(b.children!=null)throw Error(de(60));a.innerHTML=d}}break;case"multiple":a.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":a.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){a.removeAttribute("xlink:href");break}d=Yc(""+g),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(d,""+g):a.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(d,""):a.removeAttribute(d);break;case"capture":case"download":g===!0?a.setAttribute(d,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?a.setAttribute(d,g):a.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?a.setAttribute(d,g):a.removeAttribute(d);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?a.removeAttribute(d):a.setAttribute(d,g);break;case"popover":In("beforetoggle",a),In("toggle",a),Rr(a,"popover",g);break;case"xlinkActuate":It(a,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":It(a,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":It(a,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":It(a,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":It(a,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":It(a,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":It(a,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":It(a,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":It(a,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":Rr(a,"is",g);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=Yu.get(d)||d,Rr(a,d,g))}}function ng(a,s,d,g,b,k){switch(d){case"style":Rs(a,g,k);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(de(61));if(d=g.__html,d!=null){if(b.children!=null)throw Error(de(60));a.innerHTML=d}}break;case"children":typeof g=="string"?yn(a,g):(typeof g=="number"||typeof g=="bigint")&&yn(a,""+g);break;case"onScroll":g!=null&&In("scroll",a);break;case"onScrollEnd":g!=null&&In("scrollend",a);break;case"onClick":g!=null&&(a.onclick=Cm);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!xe.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(b=d.endsWith("Capture"),s=d.slice(2,b?d.length-7:void 0),k=a[Re]||null,k=k!=null?k[d]:null,typeof k=="function"&&a.removeEventListener(s,k,b),typeof g=="function")){typeof k!="function"&&k!==null&&(d in a?a[d]=null:a.hasAttribute(d)&&a.removeAttribute(d)),a.addEventListener(s,g,b);break e}d in a?a[d]=g:g===!0?a.setAttribute(d,""):Rr(a,d,g)}}}function Ca(a,s,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":In("error",a),In("load",a);var g=!1,b=!1,k;for(k in d)if(d.hasOwnProperty(k)){var _e=d[k];if(_e!=null)switch(k){case"src":g=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(de(137,s));default:ni(a,s,k,_e,d,null)}}b&&ni(a,s,"srcSet",d.srcSet,d,null),g&&ni(a,s,"src",d.src,d,null);return;case"input":In("invalid",a);var Pe=k=_e=b=null,ut=null,Bt=null;for(g in d)if(d.hasOwnProperty(g)){var $t=d[g];if($t!=null)switch(g){case"name":b=$t;break;case"type":_e=$t;break;case"checked":ut=$t;break;case"defaultChecked":Bt=$t;break;case"value":k=$t;break;case"defaultValue":Pe=$t;break;case"children":case"dangerouslySetInnerHTML":if($t!=null)throw Error(de(137,s));break;default:ni(a,s,g,$t,d,null)}}qo(a,k,Pe,ut,Bt,_e,b,!1),mn(a);return;case"select":In("invalid",a),g=_e=k=null;for(b in d)if(d.hasOwnProperty(b)&&(Pe=d[b],Pe!=null))switch(b){case"value":k=Pe;break;case"defaultValue":_e=Pe;break;case"multiple":g=Pe;default:ni(a,s,b,Pe,d,null)}s=k,d=_e,a.multiple=!!g,s!=null?ja(a,!!g,s,!1):d!=null&&ja(a,!!g,d,!0);return;case"textarea":In("invalid",a),k=b=g=null;for(_e in d)if(d.hasOwnProperty(_e)&&(Pe=d[_e],Pe!=null))switch(_e){case"value":g=Pe;break;case"defaultValue":b=Pe;break;case"children":k=Pe;break;case"dangerouslySetInnerHTML":if(Pe!=null)throw Error(de(91));break;default:ni(a,s,_e,Pe,d,null)}Tr(a,g,b,k),mn(a);return;case"option":for(ut in d)if(d.hasOwnProperty(ut)&&(g=d[ut],g!=null))switch(ut){case"selected":a.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:ni(a,s,ut,g,d,null)}return;case"dialog":In("beforetoggle",a),In("toggle",a),In("cancel",a),In("close",a);break;case"iframe":case"object":In("load",a);break;case"video":case"audio":for(g=0;g<wd.length;g++)In(wd[g],a);break;case"image":In("error",a),In("load",a);break;case"details":In("toggle",a);break;case"embed":case"source":case"link":In("error",a),In("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Bt in d)if(d.hasOwnProperty(Bt)&&(g=d[Bt],g!=null))switch(Bt){case"children":case"dangerouslySetInnerHTML":throw Error(de(137,s));default:ni(a,s,Bt,g,d,null)}return;default:if(Zl(s)){for($t in d)d.hasOwnProperty($t)&&(g=d[$t],g!==void 0&&ng(a,s,$t,g,d,void 0));return}}for(Pe in d)d.hasOwnProperty(Pe)&&(g=d[Pe],g!=null&&ni(a,s,Pe,g,d,null))}function sC(a,s,d,g){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,k=null,_e=null,Pe=null,ut=null,Bt=null,$t=null;for(qt in d){var Er=d[qt];if(d.hasOwnProperty(qt)&&Er!=null)switch(qt){case"checked":break;case"value":break;case"defaultValue":ut=Er;default:g.hasOwnProperty(qt)||ni(a,s,qt,null,g,Er)}}for(var Ht in g){var qt=g[Ht];if(Er=d[Ht],g.hasOwnProperty(Ht)&&(qt!=null||Er!=null))switch(Ht){case"type":k=qt;break;case"name":b=qt;break;case"checked":Bt=qt;break;case"defaultChecked":$t=qt;break;case"value":_e=qt;break;case"defaultValue":Pe=qt;break;case"children":case"dangerouslySetInnerHTML":if(qt!=null)throw Error(de(137,s));break;default:qt!==Er&&ni(a,s,Ht,qt,g,Er)}}zo(a,_e,Pe,ut,Bt,$t,k,b);return;case"select":qt=_e=Pe=Ht=null;for(k in d)if(ut=d[k],d.hasOwnProperty(k)&&ut!=null)switch(k){case"value":break;case"multiple":qt=ut;default:g.hasOwnProperty(k)||ni(a,s,k,null,g,ut)}for(b in g)if(k=g[b],ut=d[b],g.hasOwnProperty(b)&&(k!=null||ut!=null))switch(b){case"value":Ht=k;break;case"defaultValue":Pe=k;break;case"multiple":_e=k;default:k!==ut&&ni(a,s,b,k,g,ut)}s=Pe,d=_e,g=qt,Ht!=null?ja(a,!!d,Ht,!1):!!g!=!!d&&(s!=null?ja(a,!!d,s,!0):ja(a,!!d,d?[]:"",!1));return;case"textarea":qt=Ht=null;for(Pe in d)if(b=d[Pe],d.hasOwnProperty(Pe)&&b!=null&&!g.hasOwnProperty(Pe))switch(Pe){case"value":break;case"children":break;default:ni(a,s,Pe,null,g,b)}for(_e in g)if(b=g[_e],k=d[_e],g.hasOwnProperty(_e)&&(b!=null||k!=null))switch(_e){case"value":Ht=b;break;case"defaultValue":qt=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(de(91));break;default:b!==k&&ni(a,s,_e,b,g,k)}ic(a,Ht,qt);return;case"option":for(var nn in d)if(Ht=d[nn],d.hasOwnProperty(nn)&&Ht!=null&&!g.hasOwnProperty(nn))switch(nn){case"selected":a.selected=!1;break;default:ni(a,s,nn,null,g,Ht)}for(ut in g)if(Ht=g[ut],qt=d[ut],g.hasOwnProperty(ut)&&Ht!==qt&&(Ht!=null||qt!=null))switch(ut){case"selected":a.selected=Ht&&typeof Ht!="function"&&typeof Ht!="symbol";break;default:ni(a,s,ut,Ht,g,qt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Fr in d)Ht=d[Fr],d.hasOwnProperty(Fr)&&Ht!=null&&!g.hasOwnProperty(Fr)&&ni(a,s,Fr,null,g,Ht);for(Bt in g)if(Ht=g[Bt],qt=d[Bt],g.hasOwnProperty(Bt)&&Ht!==qt&&(Ht!=null||qt!=null))switch(Bt){case"children":case"dangerouslySetInnerHTML":if(Ht!=null)throw Error(de(137,s));break;default:ni(a,s,Bt,Ht,g,qt)}return;default:if(Zl(s)){for(var ii in d)Ht=d[ii],d.hasOwnProperty(ii)&&Ht!==void 0&&!g.hasOwnProperty(ii)&&ng(a,s,ii,void 0,g,Ht);for($t in g)Ht=g[$t],qt=d[$t],!g.hasOwnProperty($t)||Ht===qt||Ht===void 0&&qt===void 0||ng(a,s,$t,Ht,g,qt);return}}for(var Ot in d)Ht=d[Ot],d.hasOwnProperty(Ot)&&Ht!=null&&!g.hasOwnProperty(Ot)&&ni(a,s,Ot,null,g,Ht);for(Er in g)Ht=g[Er],qt=d[Er],!g.hasOwnProperty(Er)||Ht===qt||Ht==null&&qt==null||ni(a,s,Er,Ht,g,qt)}var ig=null,ag=null;function Im(a){return a.nodeType===9?a:a.ownerDocument}function Oy(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ny(a,s){if(a===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&s==="foreignObject"?0:a}function og(a,s){return a==="textarea"||a==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var sg=null;function cC(){var a=window.event;return a&&a.type==="popstate"?a===sg?!1:(sg=a,!0):(sg=null,!1)}var wy=typeof setTimeout=="function"?setTimeout:void 0,lC=typeof clearTimeout=="function"?clearTimeout:void 0,cg=typeof Promise=="function"?Promise:void 0,uC=typeof queueMicrotask=="function"?queueMicrotask:typeof cg<"u"?function(a){return cg.resolve(null).then(a).catch(dC)}:wy;function dC(a){setTimeout(function(){throw a})}function Rl(a){return a==="head"}function Dy(a,s){var d=s,g=0,b=0;do{var k=d.nextSibling;if(a.removeChild(d),k&&k.nodeType===8)if(d=k.data,d==="/$"){if(0<g&&8>g){d=g;var _e=a.ownerDocument;if(d&1&&op(_e.documentElement),d&2&&op(_e.body),d&4)for(d=_e.head,op(d),_e=d.firstChild;_e;){var Pe=_e.nextSibling,ut=_e.nodeName;_e[ye]||ut==="SCRIPT"||ut==="STYLE"||ut==="LINK"&&_e.rel.toLowerCase()==="stylesheet"||d.removeChild(_e),_e=Pe}}if(b===0){a.removeChild(k),no(s);return}b--}else d==="$"||d==="$?"||d==="$!"?b++:g=d.charCodeAt(0)-48;else g=0;d=k}while(d);no(s)}function lg(a){var s=a.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var d=s;switch(s=s.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":lg(d),lt(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}a.removeChild(d)}}function hC(a,s,d,g){for(;a.nodeType===1;){var b=d;if(a.nodeName.toLowerCase()!==s.toLowerCase()){if(!g&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(g){if(!a[ye])switch(s){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(k=a.getAttribute("rel"),k==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(k!==b.rel||a.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||a.getAttribute("title")!==(b.title==null?null:b.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(k=a.getAttribute("src"),(k!==(b.src==null?null:b.src)||a.getAttribute("type")!==(b.type==null?null:b.type)||a.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&k&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(s==="input"&&a.type==="hidden"){var k=b.name==null?null:""+b.name;if(b.type==="hidden"&&a.getAttribute("name")===k)return a}else return a;if(a=cs(a.nextSibling),a===null)break}return null}function pC(a,s,d){if(s==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!d||(a=cs(a.nextSibling),a===null))return null;return a}function ug(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState==="complete"}function fC(a,s){var d=a.ownerDocument;if(a.data!=="$?"||d.readyState==="complete")s();else{var g=function(){s(),d.removeEventListener("DOMContentLoaded",g)};d.addEventListener("DOMContentLoaded",g),a._reactRetry=g}}function cs(a){for(;a!=null;a=a.nextSibling){var s=a.nodeType;if(s===1||s===3)break;if(s===8){if(s=a.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return a}var dg=null;function Py(a){a=a.previousSibling;for(var s=0;a;){if(a.nodeType===8){var d=a.data;if(d==="$"||d==="$!"||d==="$?"){if(s===0)return a;s--}else d==="/$"&&s++}a=a.previousSibling}return null}function Ly(a,s,d){switch(s=Im(d),a){case"html":if(a=s.documentElement,!a)throw Error(de(452));return a;case"head":if(a=s.head,!a)throw Error(de(453));return a;case"body":if(a=s.body,!a)throw Error(de(454));return a;default:throw Error(de(451))}}function op(a){for(var s=a.attributes;s.length;)a.removeAttributeNode(s[0]);lt(a)}var wo=new Map,ky=new Set;function Am(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var Vs=ve.d;ve.d={f:mC,r:hg,D:EC,C:_C,L:Uy,m:gC,X:vC,S:pg,M:TC};function mC(){var a=Vs.f(),s=lm();return a||s}function hg(a){var s=Dt(a);s!==null&&s.tag===5&&s.type==="form"?Bf(s):Vs.r(a)}var Pd=typeof document>"u"?null:document;function My(a,s,d){var g=Pd;if(g&&typeof s=="string"&&s){var b=Wi(s);b='link[rel="'+a+'"][href="'+b+'"]',typeof d=="string"&&(b+='[crossorigin="'+d+'"]'),ky.has(b)||(ky.add(b),a={rel:a,crossOrigin:d,href:s},g.querySelector(b)===null&&(s=g.createElement("link"),Ca(s,"link",a),pe(s),g.head.appendChild(s)))}}function EC(a){Vs.D(a),My("dns-prefetch",a,null)}function _C(a,s){Vs.C(a,s),My("preconnect",a,s)}function Uy(a,s,d){Vs.L(a,s,d);var g=Pd;if(g&&a&&s){var b='link[rel="preload"][as="'+Wi(s)+'"]';s==="image"&&d&&d.imageSrcSet?(b+='[imagesrcset="'+Wi(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(b+='[imagesizes="'+Wi(d.imageSizes)+'"]')):b+='[href="'+Wi(a)+'"]';var k=b;switch(s){case"style":k=Ld(a);break;case"script":k=Cl(a)}wo.has(k)||(a=f({rel:"preload",href:s==="image"&&d&&d.imageSrcSet?void 0:a,as:s},d),wo.set(k,a),g.querySelector(b)!==null||s==="style"&&g.querySelector(kd(k))||s==="script"&&g.querySelector(sp(k))||(s=g.createElement("link"),Ca(s,"link",a),pe(s),g.head.appendChild(s)))}}function gC(a,s){Vs.m(a,s);var d=Pd;if(d&&a){var g=s&&typeof s.as=="string"?s.as:"script",b='link[rel="modulepreload"][as="'+Wi(g)+'"][href="'+Wi(a)+'"]',k=b;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":k=Cl(a)}if(!wo.has(k)&&(a=f({rel:"modulepreload",href:a},s),wo.set(k,a),d.querySelector(b)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(sp(k)))return}g=d.createElement("link"),Ca(g,"link",a),pe(g),d.head.appendChild(g)}}}function pg(a,s,d){Vs.S(a,s,d);var g=Pd;if(g&&a){var b=Te(g).hoistableStyles,k=Ld(a);s=s||"default";var _e=b.get(k);if(!_e){var Pe={loading:0,preload:null};if(_e=g.querySelector(kd(k)))Pe.loading=5;else{a=f({rel:"stylesheet",href:a,"data-precedence":s},d),(d=wo.get(k))&&fg(a,d);var ut=_e=g.createElement("link");pe(ut),Ca(ut,"link",a),ut._p=new Promise(function(Bt,$t){ut.onload=Bt,ut.onerror=$t}),ut.addEventListener("load",function(){Pe.loading|=1}),ut.addEventListener("error",function(){Pe.loading|=2}),Pe.loading|=4,cp(_e,s,g)}_e={type:"stylesheet",instance:_e,count:1,state:Pe},b.set(k,_e)}}}function vC(a,s){Vs.X(a,s);var d=Pd;if(d&&a){var g=Te(d).hoistableScripts,b=Cl(a),k=g.get(b);k||(k=d.querySelector(sp(b)),k||(a=f({src:a,async:!0},s),(s=wo.get(b))&&bm(a,s),k=d.createElement("script"),pe(k),Ca(k,"link",a),d.head.appendChild(k)),k={type:"script",instance:k,count:1,state:null},g.set(b,k))}}function TC(a,s){Vs.M(a,s);var d=Pd;if(d&&a){var g=Te(d).hoistableScripts,b=Cl(a),k=g.get(b);k||(k=d.querySelector(sp(b)),k||(a=f({src:a,async:!0,type:"module"},s),(s=wo.get(b))&&bm(a,s),k=d.createElement("script"),pe(k),Ca(k,"link",a),d.head.appendChild(k)),k={type:"script",instance:k,count:1,state:null},g.set(b,k))}}function xy(a,s,d,g){var b=(b=dt.current)?Am(b):null;if(!b)throw Error(de(446));switch(a){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(s=Ld(d.href),d=Te(b).hoistableStyles,g=d.get(s),g||(g={type:"style",instance:null,count:0,state:null},d.set(s,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){a=Ld(d.href);var k=Te(b).hoistableStyles,_e=k.get(a);if(_e||(b=b.ownerDocument||b,_e={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},k.set(a,_e),(k=b.querySelector(kd(a)))&&!k._p&&(_e.instance=k,_e.state.loading=5),wo.has(a)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},wo.set(a,d),k||By(b,a,d,_e.state))),s&&g===null)throw Error(de(528,""));return _e}if(s&&g!==null)throw Error(de(529,""));return null;case"script":return s=d.async,d=d.src,typeof d=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Cl(d),d=Te(b).hoistableScripts,g=d.get(s),g||(g={type:"script",instance:null,count:0,state:null},d.set(s,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(de(444,a))}}function Ld(a){return'href="'+Wi(a)+'"'}function kd(a){return'link[rel="stylesheet"]['+a+"]"}function jy(a){return f({},a,{"data-precedence":a.precedence,precedence:null})}function By(a,s,d,g){a.querySelector('link[rel="preload"][as="style"]['+s+"]")?g.loading=1:(s=a.createElement("link"),g.preload=s,s.addEventListener("load",function(){return g.loading|=1}),s.addEventListener("error",function(){return g.loading|=2}),Ca(s,"link",d),pe(s),a.head.appendChild(s))}function Cl(a){return'[src="'+Wi(a)+'"]'}function sp(a){return"script[async]"+a}function Vy(a,s,d){if(s.count++,s.instance===null)switch(s.type){case"style":var g=a.querySelector('style[data-href~="'+Wi(d.href)+'"]');if(g)return s.instance=g,pe(g),g;var b=f({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return g=(a.ownerDocument||a).createElement("style"),pe(g),Ca(g,"style",b),cp(g,d.precedence,a),s.instance=g;case"stylesheet":b=Ld(d.href);var k=a.querySelector(kd(b));if(k)return s.state.loading|=4,s.instance=k,pe(k),k;g=jy(d),(b=wo.get(b))&&fg(g,b),k=(a.ownerDocument||a).createElement("link"),pe(k);var _e=k;return _e._p=new Promise(function(Pe,ut){_e.onload=Pe,_e.onerror=ut}),Ca(k,"link",g),s.state.loading|=4,cp(k,d.precedence,a),s.instance=k;case"script":return k=Cl(d.src),(b=a.querySelector(sp(k)))?(s.instance=b,pe(b),b):(g=d,(b=wo.get(k))&&(g=f({},d),bm(g,b)),a=a.ownerDocument||a,b=a.createElement("script"),pe(b),Ca(b,"link",g),a.head.appendChild(b),s.instance=b);case"void":return null;default:throw Error(de(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(g=s.instance,s.state.loading|=4,cp(g,d.precedence,a));return s.instance}function cp(a,s,d){for(var g=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=g.length?g[g.length-1]:null,k=b,_e=0;_e<g.length;_e++){var Pe=g[_e];if(Pe.dataset.precedence===s)k=Pe;else if(k!==b)break}k?k.parentNode.insertBefore(a,k.nextSibling):(s=d.nodeType===9?d.head:d,s.insertBefore(a,s.firstChild))}function fg(a,s){a.crossOrigin==null&&(a.crossOrigin=s.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=s.referrerPolicy),a.title==null&&(a.title=s.title)}function bm(a,s){a.crossOrigin==null&&(a.crossOrigin=s.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=s.referrerPolicy),a.integrity==null&&(a.integrity=s.integrity)}var lp=null;function Fy(a,s,d){if(lp===null){var g=new Map,b=lp=new Map;b.set(d,g)}else b=lp,g=b.get(d),g||(g=new Map,b.set(d,g));if(g.has(a))return g;for(g.set(a,null),d=d.getElementsByTagName(a),b=0;b<d.length;b++){var k=d[b];if(!(k[ye]||k[te]||a==="link"&&k.getAttribute("rel")==="stylesheet")&&k.namespaceURI!=="http://www.w3.org/2000/svg"){var _e=k.getAttribute(s)||"";_e=a+_e;var Pe=g.get(_e);Pe?Pe.push(k):g.set(_e,[k])}}return g}function Gy(a,s,d){a=a.ownerDocument||a,a.head.insertBefore(d,s==="title"?a.querySelector("head > title"):null)}function yC(a,s,d){if(d===1||s.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return a=s.disabled,typeof s.precedence=="string"&&a==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Hy(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}var up=null;function SC(){}function RC(a,s,d){if(up===null)throw Error(de(475));var g=up;if(s.type==="stylesheet"&&(typeof d.media!="string"||matchMedia(d.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var b=Ld(d.href),k=a.querySelector(kd(b));if(k){a=k._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(g.count++,g=dp.bind(g),a.then(g,g)),s.state.loading|=4,s.instance=k,pe(k);return}k=a.ownerDocument||a,d=jy(d),(b=wo.get(b))&&fg(d,b),k=k.createElement("link"),pe(k);var _e=k;_e._p=new Promise(function(Pe,ut){_e.onload=Pe,_e.onerror=ut}),Ca(k,"link",d),s.instance=k}g.stylesheets===null&&(g.stylesheets=new Map),g.stylesheets.set(s,a),(a=s.state.preload)&&(s.state.loading&3)===0&&(g.count++,s=dp.bind(g),a.addEventListener("load",s),a.addEventListener("error",s))}}function Wy(){if(up===null)throw Error(de(475));var a=up;return a.stylesheets&&a.count===0&&Om(a,a.stylesheets),0<a.count?function(s){var d=setTimeout(function(){if(a.stylesheets&&Om(a,a.stylesheets),a.unsuspend){var g=a.unsuspend;a.unsuspend=null,g()}},6e4);return a.unsuspend=s,function(){a.unsuspend=null,clearTimeout(d)}}:null}function dp(){if(this.count--,this.count===0){if(this.stylesheets)Om(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var Md=null;function Om(a,s){a.stylesheets=null,a.unsuspend!==null&&(a.count++,Md=new Map,s.forEach(mg,a),Md=null,dp.call(a))}function mg(a,s){if(!(s.state.loading&4)){var d=Md.get(a);if(d)var g=d.get(null);else{d=new Map,Md.set(a,d);for(var b=a.querySelectorAll("link[data-precedence],style[data-precedence]"),k=0;k<b.length;k++){var _e=b[k];(_e.nodeName==="LINK"||_e.getAttribute("media")!=="not all")&&(d.set(_e.dataset.precedence,_e),g=_e)}g&&d.set(null,g)}b=s.instance,_e=b.getAttribute("data-precedence"),k=d.get(_e)||g,k===g&&d.set(null,b),d.set(_e,b),this.count++,g=dp.bind(this),b.addEventListener("load",g),b.addEventListener("error",g),k?k.parentNode.insertBefore(b,k.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(b,a.firstChild)),s.state.loading|=4}}var Ud={$$typeof:M,Provider:null,Consumer:null,_currentValue:Le,_currentValue2:Le,_threadCount:0};function tr(a,s,d,g,b,k,_e,Pe){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Me(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Me(0),this.hiddenUpdates=Me(null),this.identifierPrefix=g,this.onUncaughtError=b,this.onCaughtError=k,this.onRecoverableError=_e,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Pe,this.incompleteTransitions=new Map}function Ky(a,s,d,g,b,k,_e,Pe,ut,Bt,$t,Er){return a=new tr(a,s,d,_e,Pe,ut,Bt,Er),s=1,k===!0&&(s|=24),k=ya(3,null,null,s),a.current=k,k.stateNode=a,s=vf(),s.refCount++,a.pooledCache=s,s.refCount++,k.memoizedState={element:g,isDehydrated:d,cache:s},Ph(k),a}function zy(a){return a?(a=wa,a):wa}function qy(a,s,d,g,b,k){b=zy(b),g.context===null?g.context=b:g.pendingContext=b,g=gc(s),g.payload={element:d},k=k===void 0?null:k,k!==null&&(g.callback=k),d=es(a,g,s),d!==null&&(go(d,a,s),vc(d,a,s))}function Yy(a,s){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var d=a.retryLane;a.retryLane=d!==0&&d<s?d:s}}function Eg(a,s){Yy(a,s),(a=a.alternate)&&Yy(a,s)}function Nm(a){if(a.tag===13){var s=Qc(a,67108864);s!==null&&go(s,a,67108864),Eg(a,67108864)}}var wm=!0;function CC(a,s,d,g){var b=q.T;q.T=null;var k=ve.p;try{ve.p=2,_g(a,s,d,g)}finally{ve.p=k,q.T=b}}function ro(a,s,d,g){var b=q.T;q.T=null;var k=ve.p;try{ve.p=8,_g(a,s,d,g)}finally{ve.p=k,q.T=b}}function _g(a,s,d,g){if(wm){var b=gg(g);if(b===null)ym(a,s,g,xd,d),Dm(a,g);else if(AC(b,a,s,d,g))g.stopPropagation();else if(Dm(a,g),s&4&&-1<IC.indexOf(a)){for(;b!==null;){var k=Dt(b);if(k!==null)switch(k.tag){case 3:if(k=k.stateNode,k.current.memoizedState.isDehydrated){var _e=ae(k.pendingLanes);if(_e!==0){var Pe=k;for(Pe.pendingLanes|=2,Pe.entangledLanes|=2;_e;){var ut=1<<31-At(_e);Pe.entanglements[1]|=ut,_e&=~ut}ss(k),($n&6)===0&&(Rd=Gt()+500,ip(0))}}break;case 13:Pe=Qc(k,2),Pe!==null&&go(Pe,k,2),lm(),Eg(k,2)}if(k=gg(g),k===null&&ym(a,s,g,xd,d),k===b)break;b=k}b!==null&&g.stopPropagation()}else ym(a,s,g,null,d)}}function gg(a){return a=Cs(a),vg(a)}var xd=null;function vg(a){if(xd=null,a=Ze(a),a!==null){var s=We(a);if(s===null)a=null;else{var d=s.tag;if(d===13){if(a=O(s),a!==null)return a;a=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;a=null}else s!==a&&(a=null)}}return xd=a,null}function Xy(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(pr()){case ir:return 2;case Ar:return 8;case er:case yt:return 32;case Xt:return 268435456;default:return 32}default:return 32}}var Tg=!1,Il=null,ls=null,Nc=null,hp=new Map,pp=new Map,Al=[],IC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Dm(a,s){switch(a){case"focusin":case"focusout":Il=null;break;case"dragenter":case"dragleave":ls=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":hp.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":pp.delete(s.pointerId)}}function jd(a,s,d,g,b,k){return a===null||a.nativeEvent!==k?(a={blockedOn:s,domEventName:d,eventSystemFlags:g,nativeEvent:k,targetContainers:[b]},s!==null&&(s=Dt(s),s!==null&&Nm(s)),a):(a.eventSystemFlags|=g,s=a.targetContainers,b!==null&&s.indexOf(b)===-1&&s.push(b),a)}function AC(a,s,d,g,b){switch(s){case"focusin":return Il=jd(Il,a,s,d,g,b),!0;case"dragenter":return ls=jd(ls,a,s,d,g,b),!0;case"mouseover":return Nc=jd(Nc,a,s,d,g,b),!0;case"pointerover":var k=b.pointerId;return hp.set(k,jd(hp.get(k)||null,a,s,d,g,b)),!0;case"gotpointercapture":return k=b.pointerId,pp.set(k,jd(pp.get(k)||null,a,s,d,g,b)),!0}return!1}function Pm(a){var s=Ze(a.target);if(s!==null){var d=We(s);if(d!==null){if(s=d.tag,s===13){if(s=O(d),s!==null){a.blockedOn=s,yr(a.priority,function(){if(d.tag===13){var g=to();g=Ct(g);var b=Qc(d,g);b!==null&&go(b,d,g),Eg(d,g)}});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){a.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}a.blockedOn=null}function Lm(a){if(a.blockedOn!==null)return!1;for(var s=a.targetContainers;0<s.length;){var d=gg(a.nativeEvent);if(d===null){d=a.nativeEvent;var g=new d.constructor(d.type,d);$l=g,d.target.dispatchEvent(g),$l=null}else return s=Dt(d),s!==null&&Nm(s),a.blockedOn=d,!1;s.shift()}return!0}function Jy(a,s,d){Lm(a)&&d.delete(s)}function Zy(){Tg=!1,Il!==null&&Lm(Il)&&(Il=null),ls!==null&&Lm(ls)&&(ls=null),Nc!==null&&Lm(Nc)&&(Nc=null),hp.forEach(Jy),pp.forEach(Jy)}function Bd(a,s){a.blockedOn===s&&(a.blockedOn=null,Tg||(Tg=!0,G.unstable_scheduleCallback(G.unstable_NormalPriority,Zy)))}var wc=null;function fp(a){wc!==a&&(wc=a,G.unstable_scheduleCallback(G.unstable_NormalPriority,function(){wc===a&&(wc=null);for(var s=0;s<a.length;s+=3){var d=a[s],g=a[s+1],b=a[s+2];if(typeof g!="function"){if(vg(g||d)===null)continue;break}var k=Dt(d);k!==null&&(a.splice(s,3),s-=3,S_(k,{pending:!0,data:b,method:d.method,action:g},g,b))}}))}function no(a){function s(ut){return Bd(ut,a)}Il!==null&&Bd(Il,a),ls!==null&&Bd(ls,a),Nc!==null&&Bd(Nc,a),hp.forEach(s),pp.forEach(s);for(var d=0;d<Al.length;d++){var g=Al[d];g.blockedOn===a&&(g.blockedOn=null)}for(;0<Al.length&&(d=Al[0],d.blockedOn===null);)Pm(d),d.blockedOn===null&&Al.shift();if(d=(a.ownerDocument||a).$$reactFormReplay,d!=null)for(g=0;g<d.length;g+=3){var b=d[g],k=d[g+1],_e=b[Re]||null;if(typeof k=="function")_e||fp(d);else if(_e){var Pe=null;if(k&&k.hasAttribute("formAction")){if(b=k,_e=k[Re]||null)Pe=_e.formAction;else if(vg(b)!==null)continue}else Pe=_e.action;typeof Pe=="function"?d[g+1]=Pe:(d.splice(g,3),g-=3),fp(d)}}}function bl(a){this._internalRoot=a}mp.prototype.render=bl.prototype.render=function(a){var s=this._internalRoot;if(s===null)throw Error(de(409));var d=s.current,g=to();qy(d,g,a,s,null,null)},mp.prototype.unmount=bl.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var s=a.containerInfo;qy(a.current,2,null,a,null,null),lm(),s[re]=null}};function mp(a){this._internalRoot=a}mp.prototype.unstable_scheduleHydration=function(a){if(a){var s=Nt();a={blockedOn:null,target:a,priority:s};for(var d=0;d<Al.length&&s!==0&&s<Al[d].priority;d++);Al.splice(d,0,a),d===0&&Pm(a)}};var yg=me.version;if(yg!=="19.1.0")throw Error(de(527,yg,"19.1.0"));ve.findDOMNode=function(a){var s=a._reactInternals;if(s===void 0)throw typeof a.render=="function"?Error(de(188)):(a=Object.keys(a).join(","),Error(de(268,a)));return a=c(s),a=a!==null?p(a):null,a=a===null?null:a.stateNode,a};var bC={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:q,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var km=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!km.isDisabled&&km.supportsFiber)try{Wt=km.inject(bC),Zt=km}catch{}}return kv.createRoot=function(a,s){if(!fe(a))throw Error(de(299));var d=!1,g="",b=BT,k=VT,_e=zf,Pe=null;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(g=s.identifierPrefix),s.onUncaughtError!==void 0&&(b=s.onUncaughtError),s.onCaughtError!==void 0&&(k=s.onCaughtError),s.onRecoverableError!==void 0&&(_e=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(Pe=s.unstable_transitionCallbacks)),s=Ky(a,1,!1,null,null,d,g,b,k,_e,Pe,null),a[re]=s.current,Sl(a),new bl(s)},kv.hydrateRoot=function(a,s,d){if(!fe(a))throw Error(de(299));var g=!1,b="",k=BT,_e=VT,Pe=zf,ut=null,Bt=null;return d!=null&&(d.unstable_strictMode===!0&&(g=!0),d.identifierPrefix!==void 0&&(b=d.identifierPrefix),d.onUncaughtError!==void 0&&(k=d.onUncaughtError),d.onCaughtError!==void 0&&(_e=d.onCaughtError),d.onRecoverableError!==void 0&&(Pe=d.onRecoverableError),d.unstable_transitionCallbacks!==void 0&&(ut=d.unstable_transitionCallbacks),d.formState!==void 0&&(Bt=d.formState)),s=Ky(a,1,!0,s,d??null,g,b,k,_e,Pe,ut,Bt),s.context=zy(null),d=s.current,g=to(),g=Ct(g),b=gc(g),b.callback=null,es(d,b,g),d=g,s.current.lanes=d,He(s,d),ss(s),a[re]=s.current,Sl(a),new mp(s)},kv.version="19.1.0",kv}var i3;function e7(){if(i3)return nO.exports;i3=1;function G(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(G)}catch(me){console.error(me)}}return G(),nO.exports=$8(),nO.exports}var t7=e7();const r7=pO(t7);/**
 * react-router v7.7.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var a3="popstate";function n7(G={}){function me(de,fe){let{pathname:We,search:O,hash:j}=de.location;return uO("",{pathname:We,search:O,hash:j},fe.state&&fe.state.usr||null,fe.state&&fe.state.key||"default")}function be(de,fe){return typeof fe=="string"?fe:xv(fe)}return a7(me,be,null,G)}function Zi(G,me){if(G===!1||G===null||typeof G>"u")throw new Error(me)}function Yl(G,me){if(!G){typeof console<"u"&&console.warn(me);try{throw new Error(me)}catch{}}}function i7(){return Math.random().toString(36).substring(2,10)}function o3(G,me){return{usr:G.state,key:G.key,idx:me}}function uO(G,me,be=null,de){return{pathname:typeof G=="string"?G:G.pathname,search:"",hash:"",...typeof me=="string"?kE(me):me,state:be,key:me&&me.key||de||i7()}}function xv({pathname:G="/",search:me="",hash:be=""}){return me&&me!=="?"&&(G+=me.charAt(0)==="?"?me:"?"+me),be&&be!=="#"&&(G+=be.charAt(0)==="#"?be:"#"+be),G}function kE(G){let me={};if(G){let be=G.indexOf("#");be>=0&&(me.hash=G.substring(be),G=G.substring(0,be));let de=G.indexOf("?");de>=0&&(me.search=G.substring(de),G=G.substring(0,de)),G&&(me.pathname=G)}return me}function a7(G,me,be,de={}){let{window:fe=document.defaultView,v5Compat:We=!1}=de,O=fe.history,j="POP",c=null,p=f();p==null&&(p=0,O.replaceState({...O.state,idx:p},""));function f(){return(O.state||{idx:null}).idx}function T(){j="POP";let N=f(),C=N==null?null:N-p;p=N,c&&c({action:j,location:E.location,delta:C})}function v(N,C){j="PUSH";let U=uO(E.location,N,C);p=f()+1;let M=o3(U,p),x=E.createHref(U);try{O.pushState(M,"",x)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;fe.location.assign(x)}We&&c&&c({action:j,location:E.location,delta:1})}function S(N,C){j="REPLACE";let U=uO(E.location,N,C);p=f();let M=o3(U,p),x=E.createHref(U);O.replaceState(M,"",x),We&&c&&c({action:j,location:E.location,delta:0})}function y(N){return o7(N)}let E={get action(){return j},get location(){return G(fe,O)},listen(N){if(c)throw new Error("A history only accepts one active listener");return fe.addEventListener(a3,T),c=N,()=>{fe.removeEventListener(a3,T),c=null}},createHref(N){return me(fe,N)},createURL:y,encodeLocation(N){let C=y(N);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:v,replace:S,go(N){return O.go(N)}};return E}function o7(G,me=!1){let be="http://localhost";typeof window<"u"&&(be=window.location.origin!=="null"?window.location.origin:window.location.href),Zi(be,"No window.location.(origin|href) available to create URL");let de=typeof G=="string"?G:xv(G);return de=de.replace(/ $/,"%20"),!me&&de.startsWith("//")&&(de=be+de),new URL(de,be)}function E3(G,me,be="/"){return s7(G,me,be,!1)}function s7(G,me,be,de){let fe=typeof me=="string"?kE(me):me,We=zu(fe.pathname||"/",be);if(We==null)return null;let O=_3(G);c7(O);let j=null;for(let c=0;j==null&&c<O.length;++c){let p=v7(We);j=_7(O[c],p,de)}return j}function _3(G,me=[],be=[],de=""){let fe=(We,O,j)=>{let c={relativePath:j===void 0?We.path||"":j,caseSensitive:We.caseSensitive===!0,childrenIndex:O,route:We};c.relativePath.startsWith("/")&&(Zi(c.relativePath.startsWith(de),`Absolute route path "${c.relativePath}" nested under path "${de}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),c.relativePath=c.relativePath.slice(de.length));let p=Ku([de,c.relativePath]),f=be.concat(c);We.children&&We.children.length>0&&(Zi(We.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${p}".`),_3(We.children,me,f,p)),!(We.path==null&&!We.index)&&me.push({path:p,score:m7(p,We.index),routesMeta:f})};return G.forEach((We,O)=>{if(We.path===""||!We.path?.includes("?"))fe(We,O);else for(let j of g3(We.path))fe(We,O,j)}),me}function g3(G){let me=G.split("/");if(me.length===0)return[];let[be,...de]=me,fe=be.endsWith("?"),We=be.replace(/\?$/,"");if(de.length===0)return fe?[We,""]:[We];let O=g3(de.join("/")),j=[];return j.push(...O.map(c=>c===""?We:[We,c].join("/"))),fe&&j.push(...O),j.map(c=>G.startsWith("/")&&c===""?"/":c)}function c7(G){G.sort((me,be)=>me.score!==be.score?be.score-me.score:E7(me.routesMeta.map(de=>de.childrenIndex),be.routesMeta.map(de=>de.childrenIndex)))}var l7=/^:[\w-]+$/,u7=3,d7=2,h7=1,p7=10,f7=-2,s3=G=>G==="*";function m7(G,me){let be=G.split("/"),de=be.length;return be.some(s3)&&(de+=f7),me&&(de+=d7),be.filter(fe=>!s3(fe)).reduce((fe,We)=>fe+(l7.test(We)?u7:We===""?h7:p7),de)}function E7(G,me){return G.length===me.length&&G.slice(0,-1).every((de,fe)=>de===me[fe])?G[G.length-1]-me[me.length-1]:0}function _7(G,me,be=!1){let{routesMeta:de}=G,fe={},We="/",O=[];for(let j=0;j<de.length;++j){let c=de[j],p=j===de.length-1,f=We==="/"?me:me.slice(We.length)||"/",T=E0({path:c.relativePath,caseSensitive:c.caseSensitive,end:p},f),v=c.route;if(!T&&p&&be&&!de[de.length-1].route.index&&(T=E0({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},f)),!T)return null;Object.assign(fe,T.params),O.push({params:fe,pathname:Ku([We,T.pathname]),pathnameBase:R7(Ku([We,T.pathnameBase])),route:v}),T.pathnameBase!=="/"&&(We=Ku([We,T.pathnameBase]))}return O}function E0(G,me){typeof G=="string"&&(G={path:G,caseSensitive:!1,end:!0});let[be,de]=g7(G.path,G.caseSensitive,G.end),fe=me.match(be);if(!fe)return null;let We=fe[0],O=We.replace(/(.)\/+$/,"$1"),j=fe.slice(1);return{params:de.reduce((p,{paramName:f,isOptional:T},v)=>{if(f==="*"){let y=j[v]||"";O=We.slice(0,We.length-y.length).replace(/(.)\/+$/,"$1")}const S=j[v];return T&&!S?p[f]=void 0:p[f]=(S||"").replace(/%2F/g,"/"),p},{}),pathname:We,pathnameBase:O,pattern:G}}function g7(G,me=!1,be=!0){Yl(G==="*"||!G.endsWith("*")||G.endsWith("/*"),`Route path "${G}" will be treated as if it were "${G.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${G.replace(/\*$/,"/*")}".`);let de=[],fe="^"+G.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(O,j,c)=>(de.push({paramName:j,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return G.endsWith("*")?(de.push({paramName:"*"}),fe+=G==="*"||G==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):be?fe+="\\/*$":G!==""&&G!=="/"&&(fe+="(?:(?=\\/|$))"),[new RegExp(fe,me?void 0:"i"),de]}function v7(G){try{return G.split("/").map(me=>decodeURIComponent(me).replace(/\//g,"%2F")).join("/")}catch(me){return Yl(!1,`The URL path "${G}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${me}).`),G}}function zu(G,me){if(me==="/")return G;if(!G.toLowerCase().startsWith(me.toLowerCase()))return null;let be=me.endsWith("/")?me.length-1:me.length,de=G.charAt(be);return de&&de!=="/"?null:G.slice(be)||"/"}function T7(G,me="/"){let{pathname:be,search:de="",hash:fe=""}=typeof G=="string"?kE(G):G;return{pathname:be?be.startsWith("/")?be:y7(be,me):me,search:C7(de),hash:I7(fe)}}function y7(G,me){let be=me.replace(/\/+$/,"").split("/");return G.split("/").forEach(fe=>{fe===".."?be.length>1&&be.pop():fe!=="."&&be.push(fe)}),be.length>1?be.join("/"):"/"}function sO(G,me,be,de){return`Cannot include a '${G}' character in a manually specified \`to.${me}\` field [${JSON.stringify(de)}].  Please separate it out to the \`to.${be}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function S7(G){return G.filter((me,be)=>be===0||me.route.path&&me.route.path.length>0)}function v3(G){let me=S7(G);return me.map((be,de)=>de===me.length-1?be.pathname:be.pathnameBase)}function T3(G,me,be,de=!1){let fe;typeof G=="string"?fe=kE(G):(fe={...G},Zi(!fe.pathname||!fe.pathname.includes("?"),sO("?","pathname","search",fe)),Zi(!fe.pathname||!fe.pathname.includes("#"),sO("#","pathname","hash",fe)),Zi(!fe.search||!fe.search.includes("#"),sO("#","search","hash",fe)));let We=G===""||fe.pathname==="",O=We?"/":fe.pathname,j;if(O==null)j=be;else{let T=me.length-1;if(!de&&O.startsWith("..")){let v=O.split("/");for(;v[0]==="..";)v.shift(),T-=1;fe.pathname=v.join("/")}j=T>=0?me[T]:"/"}let c=T7(fe,j),p=O&&O!=="/"&&O.endsWith("/"),f=(We||O===".")&&be.endsWith("/");return!c.pathname.endsWith("/")&&(p||f)&&(c.pathname+="/"),c}var Ku=G=>G.join("/").replace(/\/\/+/g,"/"),R7=G=>G.replace(/\/+$/,"").replace(/^\/*/,"/"),C7=G=>!G||G==="?"?"":G.startsWith("?")?G:"?"+G,I7=G=>!G||G==="#"?"":G.startsWith("#")?G:"#"+G;function A7(G){return G!=null&&typeof G.status=="number"&&typeof G.statusText=="string"&&typeof G.internal=="boolean"&&"data"in G}var y3=["POST","PUT","PATCH","DELETE"];new Set(y3);var b7=["GET",...y3];new Set(b7);var ME=ot.createContext(null);ME.displayName="DataRouter";var _0=ot.createContext(null);_0.displayName="DataRouterState";ot.createContext(!1);var S3=ot.createContext({isTransitioning:!1});S3.displayName="ViewTransition";var O7=ot.createContext(new Map);O7.displayName="Fetchers";var N7=ot.createContext(null);N7.displayName="Await";var Xl=ot.createContext(null);Xl.displayName="Navigation";var jv=ot.createContext(null);jv.displayName="Location";var qu=ot.createContext({outlet:null,matches:[],isDataRoute:!1});qu.displayName="Route";var mO=ot.createContext(null);mO.displayName="RouteError";function w7(G,{relative:me}={}){Zi(Bv(),"useHref() may be used only in the context of a <Router> component.");let{basename:be,navigator:de}=ot.useContext(Xl),{hash:fe,pathname:We,search:O}=Vv(G,{relative:me}),j=We;return be!=="/"&&(j=We==="/"?be:Ku([be,We])),de.createHref({pathname:j,search:O,hash:fe})}function Bv(){return ot.useContext(jv)!=null}function $p(){return Zi(Bv(),"useLocation() may be used only in the context of a <Router> component."),ot.useContext(jv).location}var R3="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function C3(G){ot.useContext(Xl).static||ot.useLayoutEffect(G)}function I3(){let{isDataRoute:G}=ot.useContext(qu);return G?H7():D7()}function D7(){Zi(Bv(),"useNavigate() may be used only in the context of a <Router> component.");let G=ot.useContext(ME),{basename:me,navigator:be}=ot.useContext(Xl),{matches:de}=ot.useContext(qu),{pathname:fe}=$p(),We=JSON.stringify(v3(de)),O=ot.useRef(!1);return C3(()=>{O.current=!0}),ot.useCallback((c,p={})=>{if(Yl(O.current,R3),!O.current)return;if(typeof c=="number"){be.go(c);return}let f=T3(c,JSON.parse(We),fe,p.relative==="path");G==null&&me!=="/"&&(f.pathname=f.pathname==="/"?me:Ku([me,f.pathname])),(p.replace?be.replace:be.push)(f,p.state,p)},[me,be,We,fe,G])}ot.createContext(null);function Vv(G,{relative:me}={}){let{matches:be}=ot.useContext(qu),{pathname:de}=$p(),fe=JSON.stringify(v3(be));return ot.useMemo(()=>T3(G,JSON.parse(fe),de,me==="path"),[G,fe,de,me])}function P7(G,me){return A3(G,me)}function A3(G,me,be,de){Zi(Bv(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:fe}=ot.useContext(Xl),{matches:We}=ot.useContext(qu),O=We[We.length-1],j=O?O.params:{},c=O?O.pathname:"/",p=O?O.pathnameBase:"/",f=O&&O.route;{let C=f&&f.path||"";b3(c,!f||C.endsWith("*")||C.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${C}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${C}"> to <Route path="${C==="/"?"*":`${C}/*`}">.`)}let T=$p(),v;if(me){let C=typeof me=="string"?kE(me):me;Zi(p==="/"||C.pathname?.startsWith(p),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${p}" but pathname "${C.pathname}" was given in the \`location\` prop.`),v=C}else v=T;let S=v.pathname||"/",y=S;if(p!=="/"){let C=p.replace(/^\//,"").split("/");y="/"+S.replace(/^\//,"").split("/").slice(C.length).join("/")}let E=E3(G,{pathname:y});Yl(f||E!=null,`No routes matched location "${v.pathname}${v.search}${v.hash}" `),Yl(E==null||E[E.length-1].route.element!==void 0||E[E.length-1].route.Component!==void 0||E[E.length-1].route.lazy!==void 0,`Matched leaf route at location "${v.pathname}${v.search}${v.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let N=x7(E&&E.map(C=>Object.assign({},C,{params:Object.assign({},j,C.params),pathname:Ku([p,fe.encodeLocation?fe.encodeLocation(C.pathname).pathname:C.pathname]),pathnameBase:C.pathnameBase==="/"?p:Ku([p,fe.encodeLocation?fe.encodeLocation(C.pathnameBase).pathname:C.pathnameBase])})),We,be,de);return me&&N?ot.createElement(jv.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...v},navigationType:"POP"}},N):N}function L7(){let G=G7(),me=A7(G)?`${G.status} ${G.statusText}`:G instanceof Error?G.message:JSON.stringify(G),be=G instanceof Error?G.stack:null,de="rgba(200,200,200, 0.5)",fe={padding:"0.5rem",backgroundColor:de},We={padding:"2px 4px",backgroundColor:de},O=null;return console.error("Error handled by React Router default ErrorBoundary:",G),O=ot.createElement(ot.Fragment,null,ot.createElement("p",null,"💿 Hey developer 👋"),ot.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",ot.createElement("code",{style:We},"ErrorBoundary")," or"," ",ot.createElement("code",{style:We},"errorElement")," prop on your route.")),ot.createElement(ot.Fragment,null,ot.createElement("h2",null,"Unexpected Application Error!"),ot.createElement("h3",{style:{fontStyle:"italic"}},me),be?ot.createElement("pre",{style:fe},be):null,O)}var k7=ot.createElement(L7,null),M7=class extends ot.Component{constructor(G){super(G),this.state={location:G.location,revalidation:G.revalidation,error:G.error}}static getDerivedStateFromError(G){return{error:G}}static getDerivedStateFromProps(G,me){return me.location!==G.location||me.revalidation!=="idle"&&G.revalidation==="idle"?{error:G.error,location:G.location,revalidation:G.revalidation}:{error:G.error!==void 0?G.error:me.error,location:me.location,revalidation:G.revalidation||me.revalidation}}componentDidCatch(G,me){console.error("React Router caught the following error during render",G,me)}render(){return this.state.error!==void 0?ot.createElement(qu.Provider,{value:this.props.routeContext},ot.createElement(mO.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function U7({routeContext:G,match:me,children:be}){let de=ot.useContext(ME);return de&&de.static&&de.staticContext&&(me.route.errorElement||me.route.ErrorBoundary)&&(de.staticContext._deepestRenderedBoundaryId=me.route.id),ot.createElement(qu.Provider,{value:G},be)}function x7(G,me=[],be=null,de=null){if(G==null){if(!be)return null;if(be.errors)G=be.matches;else if(me.length===0&&!be.initialized&&be.matches.length>0)G=be.matches;else return null}let fe=G,We=be?.errors;if(We!=null){let c=fe.findIndex(p=>p.route.id&&We?.[p.route.id]!==void 0);Zi(c>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(We).join(",")}`),fe=fe.slice(0,Math.min(fe.length,c+1))}let O=!1,j=-1;if(be)for(let c=0;c<fe.length;c++){let p=fe[c];if((p.route.HydrateFallback||p.route.hydrateFallbackElement)&&(j=c),p.route.id){let{loaderData:f,errors:T}=be,v=p.route.loader&&!f.hasOwnProperty(p.route.id)&&(!T||T[p.route.id]===void 0);if(p.route.lazy||v){O=!0,j>=0?fe=fe.slice(0,j+1):fe=[fe[0]];break}}}return fe.reduceRight((c,p,f)=>{let T,v=!1,S=null,y=null;be&&(T=We&&p.route.id?We[p.route.id]:void 0,S=p.route.errorElement||k7,O&&(j<0&&f===0?(b3("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,y=null):j===f&&(v=!0,y=p.route.hydrateFallbackElement||null)));let E=me.concat(fe.slice(0,f+1)),N=()=>{let C;return T?C=S:v?C=y:p.route.Component?C=ot.createElement(p.route.Component,null):p.route.element?C=p.route.element:C=c,ot.createElement(U7,{match:p,routeContext:{outlet:c,matches:E,isDataRoute:be!=null},children:C})};return be&&(p.route.ErrorBoundary||p.route.errorElement||f===0)?ot.createElement(M7,{location:be.location,revalidation:be.revalidation,component:S,error:T,children:N(),routeContext:{outlet:null,matches:E,isDataRoute:!0}}):N()},null)}function EO(G){return`${G} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function j7(G){let me=ot.useContext(ME);return Zi(me,EO(G)),me}function B7(G){let me=ot.useContext(_0);return Zi(me,EO(G)),me}function V7(G){let me=ot.useContext(qu);return Zi(me,EO(G)),me}function _O(G){let me=V7(G),be=me.matches[me.matches.length-1];return Zi(be.route.id,`${G} can only be used on routes that contain a unique "id"`),be.route.id}function F7(){return _O("useRouteId")}function G7(){let G=ot.useContext(mO),me=B7("useRouteError"),be=_O("useRouteError");return G!==void 0?G:me.errors?.[be]}function H7(){let{router:G}=j7("useNavigate"),me=_O("useNavigate"),be=ot.useRef(!1);return C3(()=>{be.current=!0}),ot.useCallback(async(fe,We={})=>{Yl(be.current,R3),be.current&&(typeof fe=="number"?G.navigate(fe):await G.navigate(fe,{fromRouteId:me,...We}))},[G,me])}var c3={};function b3(G,me,be){!me&&!c3[G]&&(c3[G]=!0,Yl(!1,be))}ot.memo(W7);function W7({routes:G,future:me,state:be}){return A3(G,void 0,be,me)}function p0(G){Zi(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function K7({basename:G="/",children:me=null,location:be,navigationType:de="POP",navigator:fe,static:We=!1}){Zi(!Bv(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let O=G.replace(/^\/*/,"/"),j=ot.useMemo(()=>({basename:O,navigator:fe,static:We,future:{}}),[O,fe,We]);typeof be=="string"&&(be=kE(be));let{pathname:c="/",search:p="",hash:f="",state:T=null,key:v="default"}=be,S=ot.useMemo(()=>{let y=zu(c,O);return y==null?null:{location:{pathname:y,search:p,hash:f,state:T,key:v},navigationType:de}},[O,c,p,f,T,v,de]);return Yl(S!=null,`<Router basename="${O}"> is not able to match the URL "${c}${p}${f}" because it does not start with the basename, so the <Router> won't render anything.`),S==null?null:ot.createElement(Xl.Provider,{value:j},ot.createElement(jv.Provider,{children:me,value:S}))}function z7({children:G,location:me}){return P7(dO(G),me)}function dO(G,me=[]){let be=[];return ot.Children.forEach(G,(de,fe)=>{if(!ot.isValidElement(de))return;let We=[...me,fe];if(de.type===ot.Fragment){be.push.apply(be,dO(de.props.children,We));return}Zi(de.type===p0,`[${typeof de.type=="string"?de.type:de.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Zi(!de.props.index||!de.props.children,"An index route cannot have child routes.");let O={id:de.props.id||We.join("-"),caseSensitive:de.props.caseSensitive,element:de.props.element,Component:de.props.Component,index:de.props.index,path:de.props.path,loader:de.props.loader,action:de.props.action,hydrateFallbackElement:de.props.hydrateFallbackElement,HydrateFallback:de.props.HydrateFallback,errorElement:de.props.errorElement,ErrorBoundary:de.props.ErrorBoundary,hasErrorBoundary:de.props.hasErrorBoundary===!0||de.props.ErrorBoundary!=null||de.props.errorElement!=null,shouldRevalidate:de.props.shouldRevalidate,handle:de.props.handle,lazy:de.props.lazy};de.props.children&&(O.children=dO(de.props.children,We)),be.push(O)}),be}var f0="get",m0="application/x-www-form-urlencoded";function g0(G){return G!=null&&typeof G.tagName=="string"}function q7(G){return g0(G)&&G.tagName.toLowerCase()==="button"}function Y7(G){return g0(G)&&G.tagName.toLowerCase()==="form"}function X7(G){return g0(G)&&G.tagName.toLowerCase()==="input"}function J7(G){return!!(G.metaKey||G.altKey||G.ctrlKey||G.shiftKey)}function Z7(G,me){return G.button===0&&(!me||me==="_self")&&!J7(G)}var h0=null;function Q7(){if(h0===null)try{new FormData(document.createElement("form"),0),h0=!1}catch{h0=!0}return h0}var $7=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function cO(G){return G!=null&&!$7.has(G)?(Yl(!1,`"${G}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${m0}"`),null):G}function e9(G,me){let be,de,fe,We,O;if(Y7(G)){let j=G.getAttribute("action");de=j?zu(j,me):null,be=G.getAttribute("method")||f0,fe=cO(G.getAttribute("enctype"))||m0,We=new FormData(G)}else if(q7(G)||X7(G)&&(G.type==="submit"||G.type==="image")){let j=G.form;if(j==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=G.getAttribute("formaction")||j.getAttribute("action");if(de=c?zu(c,me):null,be=G.getAttribute("formmethod")||j.getAttribute("method")||f0,fe=cO(G.getAttribute("formenctype"))||cO(j.getAttribute("enctype"))||m0,We=new FormData(j,G),!Q7()){let{name:p,type:f,value:T}=G;if(f==="image"){let v=p?`${p}.`:"";We.append(`${v}x`,"0"),We.append(`${v}y`,"0")}else p&&We.append(p,T)}}else{if(g0(G))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');be=f0,de=null,fe=m0,O=G}return We&&fe==="text/plain"&&(O=We,We=void 0),{action:de,method:be.toLowerCase(),encType:fe,formData:We,body:O}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function gO(G,me){if(G===!1||G===null||typeof G>"u")throw new Error(me)}function t9(G,me,be){let de=typeof G=="string"?new URL(G,typeof window>"u"?"server://singlefetch/":window.location.origin):G;return de.pathname==="/"?de.pathname=`_root.${be}`:me&&zu(de.pathname,me)==="/"?de.pathname=`${me.replace(/\/$/,"")}/_root.${be}`:de.pathname=`${de.pathname.replace(/\/$/,"")}.${be}`,de}async function r9(G,me){if(G.id in me)return me[G.id];try{let be=await import(G.module);return me[G.id]=be,be}catch(be){return console.error(`Error loading route module \`${G.module}\`, reloading page...`),console.error(be),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function n9(G){return G==null?!1:G.href==null?G.rel==="preload"&&typeof G.imageSrcSet=="string"&&typeof G.imageSizes=="string":typeof G.rel=="string"&&typeof G.href=="string"}async function i9(G,me,be){let de=await Promise.all(G.map(async fe=>{let We=me.routes[fe.route.id];if(We){let O=await r9(We,be);return O.links?O.links():[]}return[]}));return c9(de.flat(1).filter(n9).filter(fe=>fe.rel==="stylesheet"||fe.rel==="preload").map(fe=>fe.rel==="stylesheet"?{...fe,rel:"prefetch",as:"style"}:{...fe,rel:"prefetch"}))}function l3(G,me,be,de,fe,We){let O=(c,p)=>be[p]?c.route.id!==be[p].route.id:!0,j=(c,p)=>be[p].pathname!==c.pathname||be[p].route.path?.endsWith("*")&&be[p].params["*"]!==c.params["*"];return We==="assets"?me.filter((c,p)=>O(c,p)||j(c,p)):We==="data"?me.filter((c,p)=>{let f=de.routes[c.route.id];if(!f||!f.hasLoader)return!1;if(O(c,p)||j(c,p))return!0;if(c.route.shouldRevalidate){let T=c.route.shouldRevalidate({currentUrl:new URL(fe.pathname+fe.search+fe.hash,window.origin),currentParams:be[0]?.params||{},nextUrl:new URL(G,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof T=="boolean")return T}return!0}):[]}function a9(G,me,{includeHydrateFallback:be}={}){return o9(G.map(de=>{let fe=me.routes[de.route.id];if(!fe)return[];let We=[fe.module];return fe.clientActionModule&&(We=We.concat(fe.clientActionModule)),fe.clientLoaderModule&&(We=We.concat(fe.clientLoaderModule)),be&&fe.hydrateFallbackModule&&(We=We.concat(fe.hydrateFallbackModule)),fe.imports&&(We=We.concat(fe.imports)),We}).flat(1))}function o9(G){return[...new Set(G)]}function s9(G){let me={},be=Object.keys(G).sort();for(let de of be)me[de]=G[de];return me}function c9(G,me){let be=new Set;return new Set(me),G.reduce((de,fe)=>{let We=JSON.stringify(s9(fe));return be.has(We)||(be.add(We),de.push({key:We,link:fe})),de},[])}function O3(){let G=ot.useContext(ME);return gO(G,"You must render this element inside a <DataRouterContext.Provider> element"),G}function l9(){let G=ot.useContext(_0);return gO(G,"You must render this element inside a <DataRouterStateContext.Provider> element"),G}var vO=ot.createContext(void 0);vO.displayName="FrameworkContext";function N3(){let G=ot.useContext(vO);return gO(G,"You must render this element inside a <HydratedRouter> element"),G}function u9(G,me){let be=ot.useContext(vO),[de,fe]=ot.useState(!1),[We,O]=ot.useState(!1),{onFocus:j,onBlur:c,onMouseEnter:p,onMouseLeave:f,onTouchStart:T}=me,v=ot.useRef(null);ot.useEffect(()=>{if(G==="render"&&O(!0),G==="viewport"){let E=C=>{C.forEach(U=>{O(U.isIntersecting)})},N=new IntersectionObserver(E,{threshold:.5});return v.current&&N.observe(v.current),()=>{N.disconnect()}}},[G]),ot.useEffect(()=>{if(de){let E=setTimeout(()=>{O(!0)},100);return()=>{clearTimeout(E)}}},[de]);let S=()=>{fe(!0)},y=()=>{fe(!1),O(!1)};return be?G!=="intent"?[We,v,{}]:[We,v,{onFocus:Mv(j,S),onBlur:Mv(c,y),onMouseEnter:Mv(p,S),onMouseLeave:Mv(f,y),onTouchStart:Mv(T,S)}]:[!1,v,{}]}function Mv(G,me){return be=>{G&&G(be),be.defaultPrevented||me(be)}}function d9({page:G,...me}){let{router:be}=O3(),de=ot.useMemo(()=>E3(be.routes,G,be.basename),[be.routes,G,be.basename]);return de?ot.createElement(p9,{page:G,matches:de,...me}):null}function h9(G){let{manifest:me,routeModules:be}=N3(),[de,fe]=ot.useState([]);return ot.useEffect(()=>{let We=!1;return i9(G,me,be).then(O=>{We||fe(O)}),()=>{We=!0}},[G,me,be]),de}function p9({page:G,matches:me,...be}){let de=$p(),{manifest:fe,routeModules:We}=N3(),{basename:O}=O3(),{loaderData:j,matches:c}=l9(),p=ot.useMemo(()=>l3(G,me,c,fe,de,"data"),[G,me,c,fe,de]),f=ot.useMemo(()=>l3(G,me,c,fe,de,"assets"),[G,me,c,fe,de]),T=ot.useMemo(()=>{if(G===de.pathname+de.search+de.hash)return[];let y=new Set,E=!1;if(me.forEach(C=>{let U=fe.routes[C.route.id];!U||!U.hasLoader||(!p.some(M=>M.route.id===C.route.id)&&C.route.id in j&&We[C.route.id]?.shouldRevalidate||U.hasClientLoader?E=!0:y.add(C.route.id))}),y.size===0)return[];let N=t9(G,O,"data");return E&&y.size>0&&N.searchParams.set("_routes",me.filter(C=>y.has(C.route.id)).map(C=>C.route.id).join(",")),[N.pathname+N.search]},[O,j,de,fe,p,me,G,We]),v=ot.useMemo(()=>a9(f,fe),[f,fe]),S=h9(f);return ot.createElement(ot.Fragment,null,T.map(y=>ot.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...be})),v.map(y=>ot.createElement("link",{key:y,rel:"modulepreload",href:y,...be})),S.map(({key:y,link:E})=>ot.createElement("link",{key:y,...E})))}function f9(...G){return me=>{G.forEach(be=>{typeof be=="function"?be(me):be!=null&&(be.current=me)})}}var w3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{w3&&(window.__reactRouterVersion="7.7.1")}catch{}function m9({basename:G,children:me,window:be}){let de=ot.useRef();de.current==null&&(de.current=n7({window:be,v5Compat:!0}));let fe=de.current,[We,O]=ot.useState({action:fe.action,location:fe.location}),j=ot.useCallback(c=>{ot.startTransition(()=>O(c))},[O]);return ot.useLayoutEffect(()=>fe.listen(j),[fe,j]),ot.createElement(K7,{basename:G,children:me,location:We.location,navigationType:We.action,navigator:fe})}var D3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,P3=ot.forwardRef(function({onClick:me,discover:be="render",prefetch:de="none",relative:fe,reloadDocument:We,replace:O,state:j,target:c,to:p,preventScrollReset:f,viewTransition:T,...v},S){let{basename:y}=ot.useContext(Xl),E=typeof p=="string"&&D3.test(p),N,C=!1;if(typeof p=="string"&&E&&(N=p,w3))try{let Y=new URL(window.location.href),F=p.startsWith("//")?new URL(Y.protocol+p):new URL(p),oe=zu(F.pathname,y);F.origin===Y.origin&&oe!=null?p=oe+F.search+F.hash:C=!0}catch{Yl(!1,`<Link to="${p}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let U=w7(p,{relative:fe}),[M,x,P]=u9(de,v),z=v9(p,{replace:O,state:j,target:c,preventScrollReset:f,relative:fe,viewTransition:T});function Z(Y){me&&me(Y),Y.defaultPrevented||z(Y)}let I=ot.createElement("a",{...v,...P,href:N||U,onClick:C||We?me:Z,ref:f9(S,x),target:c,"data-discover":!E&&be==="render"?"true":void 0});return M&&!E?ot.createElement(ot.Fragment,null,I,ot.createElement(d9,{page:U})):I});P3.displayName="Link";var E9=ot.forwardRef(function({"aria-current":me="page",caseSensitive:be=!1,className:de="",end:fe=!1,style:We,to:O,viewTransition:j,children:c,...p},f){let T=Vv(O,{relative:p.relative}),v=$p(),S=ot.useContext(_0),{navigator:y,basename:E}=ot.useContext(Xl),N=S!=null&&C9(T)&&j===!0,C=y.encodeLocation?y.encodeLocation(T).pathname:T.pathname,U=v.pathname,M=S&&S.navigation&&S.navigation.location?S.navigation.location.pathname:null;be||(U=U.toLowerCase(),M=M?M.toLowerCase():null,C=C.toLowerCase()),M&&E&&(M=zu(M,E)||M);const x=C!=="/"&&C.endsWith("/")?C.length-1:C.length;let P=U===C||!fe&&U.startsWith(C)&&U.charAt(x)==="/",z=M!=null&&(M===C||!fe&&M.startsWith(C)&&M.charAt(C.length)==="/"),Z={isActive:P,isPending:z,isTransitioning:N},I=P?me:void 0,Y;typeof de=="function"?Y=de(Z):Y=[de,P?"active":null,z?"pending":null,N?"transitioning":null].filter(Boolean).join(" ");let F=typeof We=="function"?We(Z):We;return ot.createElement(P3,{...p,"aria-current":I,className:Y,ref:f,style:F,to:O,viewTransition:j},typeof c=="function"?c(Z):c)});E9.displayName="NavLink";var _9=ot.forwardRef(({discover:G="render",fetcherKey:me,navigate:be,reloadDocument:de,replace:fe,state:We,method:O=f0,action:j,onSubmit:c,relative:p,preventScrollReset:f,viewTransition:T,...v},S)=>{let y=S9(),E=R9(j,{relative:p}),N=O.toLowerCase()==="get"?"get":"post",C=typeof j=="string"&&D3.test(j),U=M=>{if(c&&c(M),M.defaultPrevented)return;M.preventDefault();let x=M.nativeEvent.submitter,P=x?.getAttribute("formmethod")||O;y(x||M.currentTarget,{fetcherKey:me,method:P,navigate:be,replace:fe,state:We,relative:p,preventScrollReset:f,viewTransition:T})};return ot.createElement("form",{ref:S,method:N,action:E,onSubmit:de?c:U,...v,"data-discover":!C&&G==="render"?"true":void 0})});_9.displayName="Form";function g9(G){return`${G} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function L3(G){let me=ot.useContext(ME);return Zi(me,g9(G)),me}function v9(G,{target:me,replace:be,state:de,preventScrollReset:fe,relative:We,viewTransition:O}={}){let j=I3(),c=$p(),p=Vv(G,{relative:We});return ot.useCallback(f=>{if(Z7(f,me)){f.preventDefault();let T=be!==void 0?be:xv(c)===xv(p);j(G,{replace:T,state:de,preventScrollReset:fe,relative:We,viewTransition:O})}},[c,j,p,be,de,me,G,fe,We,O])}var T9=0,y9=()=>`__${String(++T9)}__`;function S9(){let{router:G}=L3("useSubmit"),{basename:me}=ot.useContext(Xl),be=F7();return ot.useCallback(async(de,fe={})=>{let{action:We,method:O,encType:j,formData:c,body:p}=e9(de,me);if(fe.navigate===!1){let f=fe.fetcherKey||y9();await G.fetch(f,be,fe.action||We,{preventScrollReset:fe.preventScrollReset,formData:c,body:p,formMethod:fe.method||O,formEncType:fe.encType||j,flushSync:fe.flushSync})}else await G.navigate(fe.action||We,{preventScrollReset:fe.preventScrollReset,formData:c,body:p,formMethod:fe.method||O,formEncType:fe.encType||j,replace:fe.replace,state:fe.state,fromRouteId:be,flushSync:fe.flushSync,viewTransition:fe.viewTransition})},[G,me,be])}function R9(G,{relative:me}={}){let{basename:be}=ot.useContext(Xl),de=ot.useContext(qu);Zi(de,"useFormAction must be used inside a RouteContext");let[fe]=de.matches.slice(-1),We={...Vv(G||".",{relative:me})},O=$p();if(G==null){We.search=O.search;let j=new URLSearchParams(We.search),c=j.getAll("index");if(c.some(f=>f==="")){j.delete("index"),c.filter(T=>T).forEach(T=>j.append("index",T));let f=j.toString();We.search=f?`?${f}`:""}}return(!G||G===".")&&fe.route.index&&(We.search=We.search?We.search.replace(/^\?/,"?index&"):"?index"),be!=="/"&&(We.pathname=We.pathname==="/"?be:Ku([be,We.pathname])),xv(We)}function C9(G,{relative:me}={}){let be=ot.useContext(S3);Zi(be!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:de}=L3("useViewTransitionState"),fe=Vv(G,{relative:me});if(!be.isTransitioning)return!1;let We=zu(be.currentLocation.pathname,de)||be.currentLocation.pathname,O=zu(be.nextLocation.pathname,de)||be.nextLocation.pathname;return E0(fe.pathname,O)!=null||E0(fe.pathname,We)!=null}/**
 * @license agora-rtc-react
 * @version 2.4.0
 *
 * Copyright (c) Agora, Inc.
 *
 * This source code is licensed under the MIT license.
 */var I9=Object.create,TO=Object.defineProperty,A9=Object.getOwnPropertyDescriptor,b9=Object.getOwnPropertyNames,O9=Object.getPrototypeOf,N9=Object.prototype.hasOwnProperty,w9=(G,me)=>()=>(me||G((me={exports:{}}).exports,me),me.exports),D9=(G,me)=>{for(var be in me)TO(G,be,{get:me[be],enumerable:!0})},k3=(G,me,be,de)=>{if(me&&typeof me=="object"||typeof me=="function")for(let fe of b9(me))!N9.call(G,fe)&&fe!==be&&TO(G,fe,{get:()=>me[fe],enumerable:!(de=A9(me,fe))||de.enumerable});return G},P9=(G,me,be)=>(k3(G,me,"default"),be),ef=(G,me,be)=>(be=G!=null?I9(O9(G)):{},k3(!G||!G.__esModule?TO(be,"default",{value:G,enumerable:!0}):be,G)),tf=w9((G,me)=>{(function(be,de){typeof G=="object"&&typeof me<"u"?me.exports=de():typeof define=="function"&&define.amd?define(de):(be=typeof globalThis<"u"?globalThis:be||self).AgoraRTC=de()})(G,function(){function be(e,t){return t.forEach(function(r){r&&typeof r!="string"&&!Array.isArray(r)&&Object.keys(r).forEach(function(n){if(n!=="default"&&!(n in e)){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}})}),Object.freeze(e)}var de=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var We=function(e){try{return!!e()}catch{return!0}},O=!We(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),j=O,c=Function.prototype,p=c.call,f=j&&c.bind.bind(p,p),T=j?f:function(e){return function(){return p.apply(e,arguments)}},v=T({}.isPrototypeOf),S=function(e){return e&&e.Math==Math&&e},y=S(typeof globalThis=="object"&&globalThis)||S(typeof window=="object"&&window)||S(typeof self=="object"&&self)||S(typeof de=="object"&&de)||function(){return this}()||de||Function("return this")(),E=O,N=Function.prototype,C=N.apply,U=N.call,M=typeof Reflect=="object"&&Reflect.apply||(E?U.bind(C):function(){return U.apply(C,arguments)}),x=T,P=x({}.toString),z=x("".slice),Z=function(e){return z(P(e),8,-1)},I=Z,Y=T,F=function(e){if(I(e)==="Function")return Y(e)},oe=typeof document=="object"&&document.all,W={all:oe,IS_HTMLDDA:oe===void 0&&oe!==void 0},ne=W.all,ee=W.IS_HTMLDDA?function(e){return typeof e=="function"||e===ne}:function(e){return typeof e=="function"},H={},q=!We(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),ve=O,Le=Function.prototype.call,Oe=ve?Le.bind(Le):function(){return Le.apply(Le,arguments)},ge={},je={}.propertyIsEnumerable,Ne=Object.getOwnPropertyDescriptor,Be=Ne&&!je.call({1:2},1);ge.f=Be?function(e){var t=Ne(this,e);return!!t&&t.enumerable}:je;var Ye,pt,dt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Ie=We,we=Z,ft=Object,qe=T("".split),it=Ie(function(){return!ft("z").propertyIsEnumerable(0)})?function(e){return we(e)=="String"?qe(e,""):ft(e)}:ft,Tt=function(e){return e==null},Pt=Tt,bt=TypeError,jt=function(e){if(Pt(e))throw bt("Can't call method on "+e);return e},Lt=it,Gt=jt,pr=function(e){return Lt(Gt(e))},ir=ee,Ar=W.all,er=W.IS_HTMLDDA?function(e){return typeof e=="object"?e!==null:ir(e)||e===Ar}:function(e){return typeof e=="object"?e!==null:ir(e)},yt={},Xt=yt,Ir=y,St=ee,Wt=function(e){return St(e)?e:void 0},Zt=function(e,t){return arguments.length<2?Wt(Xt[e])||Wt(Ir[e]):Xt[e]&&Xt[e][t]||Ir[e]&&Ir[e][t]},Kt=typeof navigator<"u"&&String(navigator.userAgent)||"",At=y,vt=Kt,zt=At.process,vr=At.Deno,or=zt&&zt.versions||vr&&vr.version,mr=or&&or.v8;mr&&(pt=(Ye=mr.split("."))[0]>0&&Ye[0]<4?1:+(Ye[0]+Ye[1])),!pt&&vt&&(!(Ye=vt.match(/Edge\/(\d+)/))||Ye[1]>=74)&&(Ye=vt.match(/Chrome\/(\d+)/))&&(pt=+Ye[1]);var ae=pt,Ae=ae,le=We,Xe=y.String,X=!!Object.getOwnPropertySymbols&&!le(function(){var e=Symbol();return!Xe(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ae&&Ae<41}),et=X&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Me=Zt,He=ee,Qe=v,ht=Object,rt=et?function(e){return typeof e=="symbol"}:function(e){var t=Me("Symbol");return He(t)&&Qe(t.prototype,ht(e))},Ct=String,xt=function(e){try{return Ct(e)}catch{return"Object"}},Nt=ee,yr=xt,w=TypeError,te=function(e){if(Nt(e))return e;throw w(yr(e)+" is not a function")},Re=te,re=Tt,Ee=function(e,t){var r=e[t];return re(r)?void 0:Re(r)},Ge=Oe,he=ee,$e=er,ye=TypeError,lt={exports:{}},Ze=y,Dt=Object.defineProperty,Q=function(e,t){try{Dt(Ze,e,{value:t,configurable:!0,writable:!0})}catch{Ze[e]=t}return t},Te="__core-js_shared__",pe=y[Te]||Q(Te,{}),Ue=pe;(lt.exports=function(e,t){return Ue[e]||(Ue[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var xe=lt.exports,Fe=jt,Je=Object,ct=function(e){return Je(Fe(e))},kt=ct,mt=T({}.hasOwnProperty),Jt=Object.hasOwn||function(e,t){return mt(kt(e),t)},Rr=T,Or=0,It=Math.random(),Sr=Rr(1 .toString),Yr=function(e){return"Symbol("+(e===void 0?"":e)+")_"+Sr(++Or+It,36)},xr=xe,Tn=Jt,Cn=Yr,Oi=X,li=et,Zr=y.Symbol,ma=xr("wks"),Co=li?Zr.for||Zr:Zr&&Zr.withoutSetter||Cn,mn=function(e){return Tn(ma,e)||(ma[e]=Oi&&Tn(Zr,e)?Zr[e]:Co("Symbol."+e)),ma[e]},ys=Oe,Wo=er,Ko=rt,Wi=Ee,zo=function(e,t){var r,n;if(he(r=e.toString)&&!$e(n=Ge(r,e))||he(r=e.valueOf)&&!$e(n=Ge(r,e))||t!=="string")return n;throw ye("Can't convert object to primitive value")},qo=TypeError,Ss=mn("toPrimitive"),ja=function(e,t){if(!Wo(e)||Ko(e))return e;var r,n=Wi(e,Ss);if(n){if(r=ys(n,e,t),!Wo(r)||Ko(r))return r;throw qo("Can't convert object to primitive value")}return zo(e,t)},ic=rt,Tr=function(e){var t=ja(e,"string");return ic(t)?t:t+""},yn=er,nr=y.document,Jl=yn(nr)&&yn(nr.createElement),Rs=function(e){return Jl?nr.createElement(e):{}},Zl=Rs,Yu=!q&&!We(function(){return Object.defineProperty(Zl("div"),"a",{get:function(){return 7}}).a!=7}),Ql=q,Yc=Oe,$l=ge,Cs=dt,Yo=pr,ac=Tr,ph=Jt,Xu=Yu,Is=Object.getOwnPropertyDescriptor;H.f=Ql?Is:function(e,t){if(e=Yo(e),t=ac(t),Xu)try{return Is(e,t)}catch{}if(ph(e,t))return Cs(!Yc($l.f,e,t),e[t])};var Xc=We,Io=ee,Ju=/#|\.prototype\./,Ao=function(e,t){var r=Zu[Xo(e)];return r==As||r!=oc&&(Io(t)?Xc(t):!!t)},Xo=Ao.normalize=function(e){return String(e).replace(Ju,".").toLowerCase()},Zu=Ao.data={},oc=Ao.NATIVE="N",As=Ao.POLYFILL="P",sc=Ao,eu=te,fh=O,Ta=F(F.bind),Ea=function(e,t){return eu(e),t===void 0?e:fh?Ta(e,t):function(){return e.apply(t,arguments)}},Ui={},cc=q&&We(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),Fn=er,Jc=String,tu=TypeError,ui=function(e){if(Fn(e))return e;throw tu(Jc(e)+" is not an object")},Jo=q,Si=Yu,Qi=cc,lc=ui,Qu=Tr,ru=TypeError,nu=Object.defineProperty,bs=Object.getOwnPropertyDescriptor,mh="enumerable",xi="configurable",ji="writable";Ui.f=Jo?Qi?function(e,t,r){if(lc(e),t=Qu(t),lc(r),typeof e=="function"&&t==="prototype"&&"value"in r&&ji in r&&!r[ji]){var n=bs(e,t);n&&n[ji]&&(e[t]=r.value,r={configurable:xi in r?r[xi]:n[xi],enumerable:mh in r?r[mh]:n[mh],writable:!1})}return nu(e,t,r)}:nu:function(e,t,r){if(lc(e),t=Qu(t),lc(r),Si)try{return nu(e,t,r)}catch{}if("get"in r||"set"in r)throw ru("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var Ja=Ui,Eh=dt,Zc=q?function(e,t,r){return Ja.f(e,t,Eh(1,r))}:function(e,t,r){return e[t]=r,e},af=y,S0=M,UE=F,R0=ee,C0=H.f,I0=sc,iu=yt,A0=Ea,$u=Zc,Fv=Jt,b0=function(e){var t=function(r,n,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(r);case 2:return new e(r,n)}return new e(r,n,i)}return S0(e,this,arguments)};return t.prototype=e.prototype,t},dn=function(e,t){var r,n,i,o,l,u,h,m,_,R=e.target,A=e.global,D=e.stat,J=e.proto,V=A?af:D?af[R]:(af[R]||{}).prototype,K=A?iu:iu[R]||$u(iu,R,{})[R],se=K.prototype;for(o in t)n=!(r=I0(A?o:R+(D?".":"#")+o,e.forced))&&V&&Fv(V,o),u=K[o],n&&(h=e.dontCallGetSet?(_=C0(V,o))&&_.value:V[o]),l=n&&h?h:t[o],n&&typeof u==typeof l||(m=e.bind&&n?A0(l,af):e.wrap&&n?b0(l):J&&R0(l)?UE(l):l,(e.sham||l&&l.sham||u&&u.sham)&&$u(m,"sham",!0),$u(K,o,m),J&&(Fv(iu,i=R+"Prototype")||$u(iu,i,{}),$u(iu[i],o,l),e.real&&se&&(r||!se[o])&&$u(se,o,l)))},O0=Math.ceil,N0=Math.floor,w0=Math.trunc||function(e){var t=+e;return(t>0?N0:O0)(t)},D0=w0,_h=function(e){var t=+e;return t!=t||t===0?0:D0(t)},gh=_h,P0=Math.max,Gv=Math.min,of=function(e,t){var r=gh(e);return r<0?P0(r+t,0):Gv(r,t)},Hv=_h,Wv=Math.min,xE=function(e){return e>0?Wv(Hv(e),9007199254740991):0},ed=xE,uc=function(e){return ed(e.length)},L0=pr,k0=of,Kv=uc,jE=function(e){return function(t,r,n){var i,o=L0(t),l=Kv(o),u=k0(n,l);if(e&&r!=r){for(;l>u;)if((i=o[u++])!=i)return!0}else for(;l>u;u++)if((e||u in o)&&o[u]===r)return e||u||0;return!e&&-1}},au={includes:jE(!0),indexOf:jE(!1)},vh=au.includes;dn({target:"Array",proto:!0,forced:We(function(){return!Array(1).includes()})},{includes:function(e){return vh(this,e,arguments.length>1?arguments[1]:void 0)}});var M0=yt,Ba=function(e){return M0[e+"Prototype"]},zv=Ba("Array").includes,qv=er,BE=Z,VE=mn("match"),FE=function(e){var t;return qv(e)&&((t=e[VE])!==void 0?!!t:BE(e)=="RegExp")},Yv=FE,Xv=TypeError,Jv={};Jv[mn("toStringTag")]="z";var GE=String(Jv)==="[object z]",U0=GE,x0=ee,sf=Z,fo=mn("toStringTag"),Th=Object,Zv=sf(function(){return arguments}())=="Arguments",Zo=U0?sf:function(e){var t,r,n;return e===void 0?"Undefined":e===null?"Null":typeof(r=function(i,o){try{return i[o]}catch{}}(t=Th(e),fo))=="string"?r:Zv?sf(t):(n=sf(t))=="Object"&&x0(t.callee)?"Arguments":n},Qv=Zo,$v=String,Va=function(e){if(Qv(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return $v(e)},j0=mn("match"),td=dn,HE=function(e){if(Yv(e))throw Xv("The method doesn't accept regular expressions");return e},yh=jt,cf=Va,eT=function(e){var t=/./;try{"/./"[e](t)}catch{try{return t[j0]=!1,"/./"[e](t)}catch{}}return!1},ou=T("".indexOf);td({target:"String",proto:!0,forced:!eT("includes")},{includes:function(e){return!!~ou(cf(yh(this)),cf(HE(e)),arguments.length>1?arguments[1]:void 0)}});var rd=Ba("String").includes,lf=v,tT=zv,su=rd,uf=Array.prototype,df=String.prototype,rT=function(e){var t=e.includes;return e===uf||lf(uf,e)&&t===uf.includes?tT:typeof e=="string"||e===df||lf(df,e)&&t===df.includes?su:t},Qt=fe(rT),B0=te,V0=ct,nT=it,iT=uc,WE=TypeError,Qo=function(e){return function(t,r,n,i){B0(r);var o=V0(t),l=nT(o),u=iT(o),h=0,m=1;if(n<2)for(;;){if(h in l){i=l[h],h+=m;break}if(h+=m,u<=h)throw WE("Reduce of empty array with no initial value")}for(;u>h;h+=m)h in l&&(i=r(i,l[h],h,o));return i}},aT={left:Qo()},bo=We,Fa=function(e,t){var r=[][e];return!!r&&bo(function(){r.call(null,t||function(){return 1},1)})},$o=typeof process<"u"&&Z(process)=="process",KE=aT.left;dn({target:"Array",proto:!0,forced:!$o&&ae>79&&ae<83||!Fa("reduce")},{reduce:function(e){var t=arguments.length;return KE(this,e,t,t>1?arguments[1]:void 0)}});var hf=Ba("Array").reduce,pf=v,zE=hf,Qc=Array.prototype,oT=function(e){var t=e.reduce;return e===Qc||pf(Qc,e)&&t===Qc.reduce?zE:t},Sh=oT,wa=fe(Sh),F0=Z,ya=Array.isArray||function(e){return F0(e)=="Array"},qE=dn,dc=ya,sT=T([].reverse),Rh=[1,2];qE({target:"Array",proto:!0,forced:String(Rh)===String(Rh.reverse())},{reverse:function(){return dc(this)&&(this.length=this.length),sT(this)}});var cu=Ba("Array").reverse,YE=v,XE=cu,$c=Array.prototype,nd=function(e){var t=e.reverse;return e===$c||YE($c,e)&&t===$c.reverse?XE:t},Ch=nd,Ih=fe(Ch),Oo=Yr,mo=xe("keys"),Os=function(e){return mo[e]||(mo[e]=Oo(e))},hc=!We(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),pc=Jt,lu=ee,cT=ct,JE=hc,ff=Os("IE_PROTO"),Sa=Object,Bi=Sa.prototype,Gn=JE?Sa.getPrototypeOf:function(e){var t=cT(e);if(pc(t,ff))return t[ff];var r=t.constructor;return lu(r)&&t instanceof r?r.prototype:t instanceof Sa?Bi:null},uu=T,Ns=te,ZE=ee,du=String,lT=TypeError,uT=function(e,t,r){try{return uu(Ns(Object.getOwnPropertyDescriptor(e,t)[r]))}catch{}},Ah=ui,bh=function(e){if(typeof e=="object"||ZE(e))return e;throw lT("Can't set "+du(e)+" as a prototype")},dT=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=uT(Object.prototype,"__proto__","set"))(r,[]),t=r instanceof Array}catch{}return function(n,i){return Ah(n),bh(i),t?e(n,i):n.__proto__=i,n}}():void 0),el={},id={},fc=Jt,mc=pr,tl=au.indexOf,Ec=id,mf=T([].push),Ef=function(e,t){var r,n=mc(e),i=0,o=[];for(r in n)!fc(Ec,r)&&fc(n,r)&&mf(o,r);for(;t.length>i;)fc(n,r=t[i++])&&(~tl(o,r)||mf(o,r));return o},hu=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_f=Ef,pu=hu.concat("length","prototype");el.f=Object.getOwnPropertyNames||function(e){return _f(e,pu)};var $i={};$i.f=Object.getOwnPropertySymbols;var gf=Zt,hT=el,G0=$i,H0=ui,W0=T([].concat),sa=gf("Reflect","ownKeys")||function(e){var t=hT.f(H0(e)),r=G0.f;return r?W0(t,r(e)):t},vf=Jt,Oh=sa,Nh=H,QE=Ui,rl={},ad=Ef,K0=hu,wh=Object.keys||function(e){return ad(e,K0)},z0=q,pT=cc,fu=Ui,$E=ui,Tf=pr,fT=wh;rl.f=z0&&!pT?Object.defineProperties:function(e,t){$E(e);for(var r,n=Tf(t),i=fT(t),o=i.length,l=0;o>l;)fu.f(e,r=i[l++],n[r]);return e};var nl,e_=Zt("document","documentElement"),yf=ui,t_=rl,r_=hu,Sf=id,mT=e_,Dh=Rs,Rf="prototype",Cf="script",_c=Os("IE_PROTO"),Ph=function(){},If=function(e){return"<"+Cf+">"+e+"</"+Cf+">"},gc=function(e){e.write(If("")),e.close();var t=e.parentWindow.Object;return e=null,t},es=function(){try{nl=new ActiveXObject("htmlfile")}catch{}var e,t,r;es=typeof document<"u"?document.domain&&nl?gc(nl):(t=Dh("iframe"),r="java"+Cf+":",t.style.display="none",mT.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(If("document.F=Object")),e.close(),e.F):gc(nl);for(var n=r_.length;n--;)delete es[Rf][r_[n]];return es()};Sf[_c]=!0;var vc=Object.create||function(e,t){var r;return e!==null?(Ph[Rf]=yf(e),r=new Ph,Ph[Rf]=null,r[_c]=e):r=es(),t===void 0?r:t_.f(r,t)},n_=er,i_=Zc,od=Error,Lh=T("".replace),ET=String(od("zxcasd").stack),a_=/\n\s*at [^:]*:[^\n]*/,sd=a_.test(ET),Af=dt,_T=!We(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Af(1,7)),e.stack!==7)}),o_=Zc,s_=function(e,t){if(sd&&typeof e=="string"&&!od.prepareStackTrace)for(;t--;)e=Lh(e,a_,"");return e},il=_T,En=Error.captureStackTrace,jn={},ea=jn,bf=mn("iterator"),cd=Array.prototype,al=function(e){return e!==void 0&&(ea.Array===e||cd[bf]===e)},Of=Zo,ld=Ee,ud=Tt,q0=jn,Ki=mn("iterator"),hd=function(e){if(!ud(e))return ld(e,Ki)||ld(e,"@@iterator")||q0[Of(e)]},c_=Oe,gT=te,vT=ui,Y0=xt,l_=hd,u_=TypeError,kh=function(e,t){var r=arguments.length<2?l_(e):t;if(gT(r))return vT(c_(r,e));throw u_(Y0(e)+" is not iterable")},Za=Oe,zi=ui,d_=Ee,pd=function(e,t,r){var n,i;zi(e);try{if(!(n=d_(e,"return"))){if(t==="throw")throw r;return r}n=Za(n,e)}catch(o){i=!0,n=o}if(t==="throw")throw r;if(i)throw n;return zi(n),r},Nf=Ea,h_=Oe,Tc=ui,wf=xt,p_=al,f_=uc,m_=v,TT=kh,yT=hd,E_=pd,ST=TypeError,Mh=function(e,t){this.stopped=e,this.result=t},Df=Mh.prototype,fd=function(e,t,r){var n,i,o,l,u,h,m,_=r&&r.that,R=!(!r||!r.AS_ENTRIES),A=!(!r||!r.IS_RECORD),D=!(!r||!r.IS_ITERATOR),J=!(!r||!r.INTERRUPTED),V=Nf(t,_),K=function(ue){return n&&E_(n,"normal",ue),new Mh(!0,ue)},se=function(ue){return R?(Tc(ue),J?V(ue[0],ue[1],K):V(ue[0],ue[1])):J?V(ue,K):V(ue)};if(A)n=e.iterator;else if(D)n=e;else{if(!(i=yT(e)))throw ST(wf(e)+" is not iterable");if(p_(i)){for(o=0,l=f_(e);l>o;o++)if((u=se(e[o]))&&m_(Df,u))return u;return new Mh(!1)}n=TT(e,i)}for(h=A?e.next:n.next;!(m=h_(h,n)).done;){try{u=se(m.value)}catch(ue){E_(n,"throw",ue)}if(typeof u=="object"&&u&&m_(Df,u))return u}return new Mh(!1)},X0=Va,RT=dn,CT=v,IT=Gn,md=dT,AT=function(e,t,r){for(var n=Oh(t),i=QE.f,o=Nh.f,l=0;l<n.length;l++){var u=n[l];vf(e,u)||r&&vf(r,u)||i(e,u,o(t,u))}},__=vc,Pf=Zc,Lf=dt,bT=function(e,t){n_(t)&&"cause"in t&&i_(e,"cause",t.cause)},J0=function(e,t,r,n){il&&(En?En(e,t):o_(e,"stack",s_(r,n)))},OT=fd,Ed=function(e,t){return e===void 0?arguments.length<2?"":t:X0(e)},kf=mn("toStringTag"),Uh=Error,Mf=[].push,ws=function(e,t){var r,n=CT(Uf,this);md?r=md(Uh(),n?IT(this):Uf):(r=n?this:__(Uf),Pf(r,kf,"Error")),t!==void 0&&Pf(r,"message",Ed(t)),J0(r,ws,r.stack,1),arguments.length>2&&bT(r,arguments[2]);var i=[];return OT(e,Mf,{that:i}),Pf(r,"errors",i),r};md?md(ws,Uh):AT(ws,Uh,{name:!0});var Uf=ws.prototype=__(Uh.prototype,{constructor:Lf(1,ws),message:Lf(1,""),name:Lf(1,"AggregateError")});RT({global:!0},{AggregateError:ws});var xh,_d,jh,NT=ee,g_=y.WeakMap,v_=NT(g_)&&/native code/.test(String(g_)),T_=y,wT=er,y_=Zc,xf=Jt,jf=pe,Z0=Os,S_=id,R_="Object already initialized",Bf=T_.TypeError,C_=T_.WeakMap;if(v_||jf.state){var ts=jf.state||(jf.state=new C_);ts.get=ts.get,ts.has=ts.has,ts.set=ts.set,xh=function(e,t){if(ts.has(e))throw Bf(R_);return t.facade=e,ts.set(e,t),t},_d=function(e){return ts.get(e)||{}},jh=function(e){return ts.has(e)}}else{var mu=Z0("state");S_[mu]=!0,xh=function(e,t){if(xf(e,mu))throw Bf(R_);return t.facade=e,y_(e,mu,t),t},_d=function(e){return xf(e,mu)?e[mu]:{}},jh=function(e){return xf(e,mu)}}var Eu,DT,I_,rs={set:xh,get:_d,has:jh,enforce:function(e){return jh(e)?_d(e):xh(e,{})},getterFor:function(e){return function(t){var r;if(!wT(t)||(r=_d(t)).type!==e)throw Bf("Incompatible receiver, "+e+" required");return r}}},Bh=q,Vf=Jt,A_=Function.prototype,PT=Bh&&Object.getOwnPropertyDescriptor,Vh=Vf(A_,"name"),b_={PROPER:Vh&&(function(){}).name==="something",CONFIGURABLE:Vh&&(!Bh||Bh&&PT(A_,"name").configurable)},LT=Zc,ol=function(e,t,r,n){return n&&n.enumerable?e[t]=r:LT(e,t,r),e},gd=We,Fh=ee,Ff=er,Gh=vc,Hh=Gn,kT=ol,Gf=mn("iterator"),_u=!1;[].keys&&("next"in(I_=[].keys())?(DT=Hh(Hh(I_)))!==Object.prototype&&(Eu=DT):_u=!0);var MT=!Ff(Eu)||gd(function(){var e={};return Eu[Gf].call(e)!==e});Fh((Eu=MT?{}:Gh(Eu))[Gf])||kT(Eu,Gf,function(){return this});var Eo={IteratorPrototype:Eu,BUGGY_SAFARI_ITERATORS:_u},Ds=Zo,sl=GE?{}.toString:function(){return"[object "+Ds(this)+"]"},UT=GE,cl=Ui.f,yc=Zc,ca=Jt,Hf=sl,Wf=mn("toStringTag"),Ps=function(e,t,r,n){if(e){var i=r?e:e.prototype;ca(i,Wf)||cl(i,Wf,{configurable:!0,value:t}),n&&!UT&&yc(i,"toString",Hf)}},xT=Eo.IteratorPrototype,jT=vc,gu=dt,Kf=Ps,BT=jn,VT=function(){return this},zf=function(e,t,r,n){var i=t+" Iterator";return e.prototype=jT(xT,{next:gu(+!n,r)}),Kf(e,i,!1,!0),BT[i]=VT,e},qf=dn,FT=Oe,O_=b_,GT=zf,HT=Gn,Q0=Ps,N_=ol,la=jn,Ra=Eo,WT=O_.PROPER,Wh=Ra.BUGGY_SAFARI_ITERATORS,Yf=mn("iterator"),w_="keys",Kh="values",zh="entries",D_=function(){return this},P_=function(e,t,r,n,i,o,l){GT(r,t,n);var u,h,m,_=function(se){if(se===i&&V)return V;if(!Wh&&se in D)return D[se];switch(se){case w_:case Kh:case zh:return function(){return new r(this,se)}}return function(){return new r(this)}},R=t+" Iterator",A=!1,D=e.prototype,J=D[Yf]||D["@@iterator"]||i&&D[i],V=!Wh&&J||_(i),K=t=="Array"&&D.entries||J;if(K&&(u=HT(K.call(new e)))!==Object.prototype&&u.next&&(Q0(u,R,!0,!0),la[R]=D_),WT&&i==Kh&&J&&J.name!==Kh&&(A=!0,V=function(){return FT(J,this)}),i)if(h={values:_(Kh),keys:o?V:_(w_),entries:_(zh)},l)for(m in h)(Wh||A||!(m in D))&&N_(D,m,h[m]);else qf({target:t,proto:!0,forced:Wh||A},h);return l&&D[Yf]!==V&&N_(D,Yf,V,{}),la[t]=V,h},Xf=function(e,t){return{value:e,done:t}},KT=pr,Jf=jn,Zf=rs;Ui.f;var L_=P_,k_=Xf,Qf="Array Iterator",$f=Zf.set,M_=Zf.getterFor(Qf);L_(Array,"Array",function(e,t){$f(this,{type:Qf,target:KT(e),index:0,kind:t})},function(){var e=M_(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,k_(void 0,!0)):k_(r=="keys"?n:r=="values"?t[n]:[n,t[n]],!1)},"values"),Jf.Arguments=Jf.Array;var zT=Ui,vd=function(e,t,r){return zT.f(e,t,r)},qT=Zt,Sc=vd,U_=q,YT=mn("species"),XT=v,Rc=TypeError,em=function(e,t){if(XT(t,e))return e;throw Rc("Incorrect invocation")},tm=ee,vu=pe,Ni=T(Function.toString);tm(vu.inspectSource)||(vu.inspectSource=function(e){return Ni(e)});var JT=vu.inspectSource,$0=T,ZT=We,Td=ee,ll=Zo,QT=JT,x_=function(){},qh=[],ns=Zt("Reflect","construct"),rm=/^\s*(?:class|function)\b/,j_=$0(rm.exec),$T=!rm.exec(x_),Tu=function(e){if(!Td(e))return!1;try{return ns(x_,qh,e),!0}catch{return!1}},nm=function(e){if(!Td(e))return!1;switch(ll(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return $T||!!j_(rm,QT(e))}catch{return!0}};nm.sham=!0;var ul,yu,Ls,wi,yd=!ns||ZT(function(){var e;return Tu(Tu.call)||!Tu(Object)||!Tu(function(){e=!0})||e})?nm:Tu,ey=yd,_a=xt,eC=TypeError,B_=ui,ty=function(e){if(ey(e))return e;throw eC(_a(e)+" is not a constructor")},Ai=Tt,Qa=mn("species"),is=function(e,t){var r,n=B_(e).constructor;return n===void 0||Ai(r=B_(n)[Qa])?t:ty(r)},Yh=T([].slice),ry=TypeError,Sd=function(e,t){if(e<t)throw ry("Not enough arguments");return e},im=/(?:ipad|iphone|ipod).*applewebkit/i.test(Kt),Ri=y,as=M,ny=Ea,$a=ee,iy=Jt,Cc=We,dl=e_,hl=Yh,am=Rs,V_=Sd,ks=im,ay=$o,pl=Ri.setImmediate,Su=Ri.clearImmediate,Xh=Ri.process,fl=Ri.Dispatch,oy=Ri.Function,F_=Ri.MessageChannel,Jh=Ri.String,om=0,ml={},G_="onreadystatechange";Cc(function(){ul=Ri.location});var H_=function(e){if(iy(ml,e)){var t=ml[e];delete ml[e],t()}},W_=function(e){return function(){H_(e)}},$n=function(e){H_(e.data)},di=function(e){Ri.postMessage(Jh(e),ul.protocol+"//"+ul.host)};pl&&Su||(pl=function(e){V_(arguments.length,1);var t=$a(e)?e:oy(e),r=hl(arguments,1);return ml[++om]=function(){as(t,void 0,r)},yu(om),om},Su=function(e){delete ml[e]},ay?yu=function(e){Xh.nextTick(W_(e))}:fl&&fl.now?yu=function(e){fl.now(W_(e))}:F_&&!ks?(wi=(Ls=new F_).port2,Ls.port1.onmessage=$n,yu=ny(wi.postMessage,wi)):Ri.addEventListener&&$a(Ri.postMessage)&&!Ri.importScripts&&ul&&ul.protocol!=="file:"&&!Cc(di)?(yu=di,Ri.addEventListener("message",$n,!1)):yu=G_ in am("script")?function(e){dl.appendChild(am("script"))[G_]=function(){dl.removeChild(this),H_(e)}}:function(e){setTimeout(W_(e),0)});var _n={set:pl,clear:Su},kn=function(){this.head=null,this.tail=null};kn.prototype={add:function(e){var t={item:e,next:null},r=this.tail;r?r.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var Bn,Ga,Ms,El,sm,Us=kn,Vi=/ipad|iphone|ipod/i.test(Kt)&&typeof Pebble<"u",_l=/web0s(?!.*chrome)/i.test(Kt),_o=y,cm=Ea,No=H.f,gl=_n.set,Zh=Us,eo=im,K_=Vi,z_=_l,Rd=$o,Qh=_o.MutationObserver||_o.WebKitMutationObserver,Ic=_o.document,ga=_o.process,os=_o.Promise,Ru=No(_o,"queueMicrotask"),vl=Ru&&Ru.value;if(!vl){var Cd=new Zh,Id=function(){var e,t;for(Rd&&(e=ga.domain)&&e.exit();t=Cd.get();)try{t()}catch(r){throw Cd.head&&Bn(),r}e&&e.enter()};eo||Rd||z_||!Qh||!Ic?!K_&&os&&os.resolve?((El=os.resolve(void 0)).constructor=os,sm=cm(El.then,El),Bn=function(){sm(Id)}):Rd?Bn=function(){ga.nextTick(Id)}:(gl=cm(gl,_o),Bn=function(){gl(Id)}):(Ga=!0,Ms=Ic.createTextNode(""),new Qh(Id).observe(Ms,{characterData:!0}),Bn=function(){Ms.data=Ga=!Ga}),vl=function(e){Cd.head||Bn(),Cd.add(e)}}var q_=vl,xs=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Ac=y.Promise,to=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",sy=!to&&!$o&&typeof window=="object"&&typeof document=="object",go=y,Ad=Ac,cy=ee,tC=sc,Tl=JT,lm=mn,Y_=sy,bd=to,um=ae,X_=Ad&&Ad.prototype,ly=lm("species"),dm=cy(go.PromiseRejectionEvent),J_=tC("Promise",function(){var e=Tl(Ad),t=e!==String(Ad);if(!t&&um===66||!X_.catch||!X_.finally)return!0;if(!um||um<51||!/native code/.test(e)){var r=new Ad(function(i){i(1)}),n=function(i){i(function(){},function(){})};if((r.constructor={})[ly]=n,!(r.then(function(){})instanceof n))return!0}return!t&&(Y_||bd)&&!dm}),$h={CONSTRUCTOR:J_,REJECTION_EVENT:dm},js={},uy=te,dy=TypeError,hy=function(e){var t,r;this.promise=new e(function(n,i){if(t!==void 0||r!==void 0)throw dy("Bad Promise constructor");t=n,r=i}),this.resolve=uy(t),this.reject=uy(r)};js.f=function(e){return new hy(e)};var yl,ep,py=dn,tp=$o,bc=y,Od=Oe,fy=ol,Ey=Ps,hm=function(e){var t=qT(e);U_&&t&&!t[YT]&&Sc(t,YT,{configurable:!0,get:function(){return this}})},_y=te,pm=ee,hi=er,Z_=em,rC=is,Q_=_n.set,$_=q_,nC=function(e,t){try{arguments.length==1?console.error(e):console.error(e,t)}catch{}},iC=xs,fm=Us,Cu=rs,rp=Ac,np=$h,mm=js,Bs="Promise",ss=np.CONSTRUCTOR,ip=np.REJECTION_EVENT,eg=Cu.getterFor(Bs),gy=Cu.set,vy=rp&&rp.prototype,Nd=rp,Em=vy,Ty=bc.TypeError,ap=bc.document,_m=bc.process,gm=mm.f,aC=gm,tg=!!(ap&&ap.createEvent&&bc.dispatchEvent),vm="unhandledrejection",yy=function(e){var t;return!(!hi(e)||!pm(t=e.then))&&t},Sy=function(e,t){var r,n,i,o=t.value,l=t.state==1,u=l?e.ok:e.fail,h=e.resolve,m=e.reject,_=e.domain;try{u?(l||(t.rejection===2&&rg(t),t.rejection=1),u===!0?r=o:(_&&_.enter(),r=u(o),_&&(_.exit(),i=!0)),r===e.promise?m(Ty("Promise-chain cycle")):(n=yy(r))?Od(n,r,h,m):h(r)):m(o)}catch(R){_&&!i&&_.exit(),m(R)}},wd=function(e,t){e.notified||(e.notified=!0,$_(function(){for(var r,n=e.reactions;r=n.get();)Sy(r,e);e.notified=!1,t&&!e.rejection&&Cy(e)}))},Ry=function(e,t,r){var n,i;tg?((n=ap.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),bc.dispatchEvent(n)):n={promise:t,reason:r},!ip&&(i=bc["on"+e])?i(n):e===vm&&nC("Unhandled promise rejection",r)},Cy=function(e){Od(Q_,bc,function(){var t,r=e.facade,n=e.value;if(In(e)&&(t=iC(function(){tp?_m.emit("unhandledRejection",n,r):Ry(vm,r,n)}),e.rejection=tp||In(e)?2:1,t.error))throw t.value})},In=function(e){return e.rejection!==1&&!e.parent},rg=function(e){Od(Q_,bc,function(){var t=e.facade;tp?_m.emit("rejectionHandled",t):Ry("rejectionhandled",t,e.value)})},Oc=function(e,t,r){return function(n){e(t,n,r)}},Sl=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,wd(e,!0))},Tm=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw Ty("Promise can't be resolved itself");var n=yy(t);n?$_(function(){var i={done:!1};try{Od(n,t,Oc(Tm,i,e),Oc(Sl,i,e))}catch(o){Sl(i,o,e)}}):(e.value=t,e.state=1,wd(e,!1))}catch(i){Sl({done:!1},i,e)}}};ss&&(Em=(Nd=function(e){Z_(this,Em),_y(e),Od(yl,this);var t=eg(this);try{e(Oc(Tm,t),Oc(Sl,t))}catch(r){Sl(t,r)}}).prototype,(yl=function(e){gy(this,{type:Bs,done:!1,notified:!1,parent:!1,reactions:new fm,rejection:!1,state:0,value:void 0})}).prototype=fy(Em,"then",function(e,t){var r=eg(this),n=gm(rC(this,Nd));return r.parent=!0,n.ok=!pm(e)||e,n.fail=pm(t)&&t,n.domain=tp?_m.domain:void 0,r.state==0?r.reactions.add(n):$_(function(){Sy(n,r)}),n.promise}),ep=function(){var e=new yl,t=eg(e);this.promise=e,this.resolve=Oc(Tm,t),this.reject=Oc(Sl,t)},mm.f=gm=function(e){return e===Nd||e===void 0?new ep(e):aC(e)}),py({global:!0,wrap:!0,forced:ss},{Promise:Nd}),Ey(Nd,Bs,!1,!0),hm(Bs);var ym=mn("iterator"),Dd=!1;try{var Sm=0,Iu={next:function(){return{done:!!Sm++}},return:function(){Dd=!0}};Iu[ym]=function(){return this},Array.from(Iu,function(){throw 2})}catch{}var Iy=Ac,oC=function(e,t){if(!Dd)return!1;var r=!1;try{var n={};n[ym]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch{}return r},Rm=$h.CONSTRUCTOR||!oC(function(e){Iy.all(e).then(void 0,function(){})}),Ay=Oe,by=te,Cm=js,ni=xs,ng=fd;dn({target:"Promise",stat:!0,forced:Rm},{all:function(e){var t=this,r=Cm.f(t),n=r.resolve,i=r.reject,o=ni(function(){var l=by(t.resolve),u=[],h=0,m=1;ng(e,function(_){var R=h++,A=!1;m++,Ay(l,t,_).then(function(D){A||(A=!0,u[R]=D,--m||n(u))},i)}),--m||n(u)});return o.error&&i(o.value),r.promise}});var Ca=dn,sC=$h.CONSTRUCTOR;Ac&&Ac.prototype,Ca({target:"Promise",proto:!0,forced:sC,real:!0},{catch:function(e){return this.then(void 0,e)}});var ig=Oe,ag=te,Im=js,Oy=xs,Ny=fd;dn({target:"Promise",stat:!0,forced:Rm},{race:function(e){var t=this,r=Im.f(t),n=r.reject,i=Oy(function(){var o=ag(t.resolve);Ny(e,function(l){ig(o,t,l).then(r.resolve,n)})});return i.error&&n(i.value),r.promise}});var og=Oe,sg=js;dn({target:"Promise",stat:!0,forced:$h.CONSTRUCTOR},{reject:function(e){var t=sg.f(this);return og(t.reject,void 0,e),t.promise}});var cC=ui,wy=er,lC=js,cg=function(e,t){if(cC(e),wy(t)&&t.constructor===e)return t;var r=lC.f(e);return(0,r.resolve)(t),r.promise},uC=dn,dC=Ac,Rl=$h.CONSTRUCTOR,Dy=cg,lg=Zt("Promise"),hC=!Rl;uC({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Dy(hC&&this===lg?dC:this,e)}});var pC=Oe,ug=te,fC=js,cs=xs,dg=fd;dn({target:"Promise",stat:!0,forced:Rm},{allSettled:function(e){var t=this,r=fC.f(t),n=r.resolve,i=r.reject,o=cs(function(){var l=ug(t.resolve),u=[],h=0,m=1;dg(e,function(_){var R=h++,A=!1;m++,pC(l,t,_).then(function(D){A||(A=!0,u[R]={status:"fulfilled",value:D},--m||n(u))},function(D){A||(A=!0,u[R]={status:"rejected",reason:D},--m||n(u))})}),--m||n(u)});return o.error&&i(o.value),r.promise}});var Py=Oe,Ly=te,op=Zt,wo=js,ky=xs,Am=fd,Vs="No one promise resolved";dn({target:"Promise",stat:!0,forced:Rm},{any:function(e){var t=this,r=op("AggregateError"),n=wo.f(t),i=n.resolve,o=n.reject,l=ky(function(){var u=Ly(t.resolve),h=[],m=0,_=1,R=!1;Am(e,function(A){var D=m++,J=!1;_++,Py(u,t,A).then(function(V){J||R||(R=!0,i(V))},function(V){J||R||(J=!0,h[D]=V,--_||o(new r(h,Vs)))})}),--_||o(new r(h,Vs))});return l.error&&o(l.value),n.promise}});var mC=dn,hg=Ac,Pd=We,My=Zt,EC=ee,_C=is,Uy=cg,gC=hg&&hg.prototype;mC({target:"Promise",proto:!0,real:!0,forced:!!hg&&Pd(function(){gC.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=_C(this,My("Promise")),r=EC(e);return this.then(r?function(n){return Uy(t,e()).then(function(){return n})}:e,r?function(n){return Uy(t,e()).then(function(){throw n})}:e)}});var pg=T,vC=_h,TC=Va,xy=jt,Ld=pg("".charAt),kd=pg("".charCodeAt),jy=pg("".slice),By=function(e){return function(t,r){var n,i,o=TC(xy(t)),l=vC(r),u=o.length;return l<0||l>=u?e?"":void 0:(n=kd(o,l))<55296||n>56319||l+1===u||(i=kd(o,l+1))<56320||i>57343?e?Ld(o,l):n:e?jy(o,l,l+2):i-56320+(n-55296<<10)+65536}},Cl={codeAt:By(!1),charAt:By(!0)},sp=Cl.charAt,Vy=Va,cp=rs,fg=P_,bm=Xf,lp="String Iterator",Fy=cp.set,Gy=cp.getterFor(lp);fg(String,"String",function(e){Fy(this,{type:lp,string:Vy(e),index:0})},function(){var e,t=Gy(this),r=t.string,n=t.index;return n>=r.length?bm(void 0,!0):(e=sp(r,n),t.index+=e.length,bm(e,!1))});var yC=yt.Promise,Hy={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},up=y,SC=Zo,RC=Zc,Wy=jn,dp=mn("toStringTag");for(var Md in Hy){var Om=up[Md],mg=Om&&Om.prototype;mg&&SC(mg)!==dp&&RC(mg,dp,Md),Wy[Md]=Wy.Array}var Ud=yC,tr=fe(Ud),Ky=Ba("Array").values,zy=Zo,qy=Jt,Yy=v,Eg=Ky,Nm=Array.prototype,wm={DOMTokenList:!0,NodeList:!0},CC=function(e){var t=e.values;return e===Nm||Yy(Nm,e)&&t===Nm.values||qy(wm,zy(e))?Eg:t},ro=fe(CC),_g=We,gg=mn("iterator"),xd=!_g(function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r=new URLSearchParams("a=1&a=2"),n="";return e.pathname="c%20d",t.forEach(function(i,o){t.delete("b"),n+=o+i}),r.delete("a",2),!e.toJSON||!r.has("a",1)||r.has("a",2)||!t.size&&!0||!t.sort||e.href!=="http://a/c%20d?a=1&c=3"||t.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!t[gg]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||n!=="a1c3"||new URL("http://x",void 0).host!=="x"}),vg=ol,Xy=Tr,Tg=Ui,Il=dt,ls=function(e,t,r){var n=Xy(t);n in e?Tg.f(e,n,Il(0,r)):e[n]=r},Nc=of,hp=uc,pp=ls,Al=Array,IC=Math.max,Dm=function(e,t,r){for(var n=hp(e),i=Nc(t,n),o=Nc(r===void 0?n:r,n),l=Al(IC(o-i,0)),u=0;i<o;i++,u++)pp(l,u,e[i]);return l.length=u,l},jd=Dm,AC=Math.floor,Pm=function(e,t){var r=e.length,n=AC(r/2);return r<8?Lm(e,t):Jy(e,Pm(jd(e,0,n),t),Pm(jd(e,n),t),t)},Lm=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},Jy=function(e,t,r,n){for(var i=t.length,o=r.length,l=0,u=0;l<i||u<o;)e[l+u]=l<i&&u<o?n(t[l],r[u])<=0?t[l++]:r[u++]:l<i?t[l++]:r[u++];return e},Zy=Pm,Bd=dn,wc=y,fp=Oe,no=T,bl=q,mp=xd,yg=ol,bC=vd,km=function(e,t,r){for(var n in t)r&&r.unsafe&&e[n]?e[n]=t[n]:vg(e,n,t[n],r);return e},a=Ps,s=zf,d=rs,g=em,b=ee,k=Jt,_e=Ea,Pe=Zo,ut=ui,Bt=er,$t=Va,Er=vc,Ht=dt,qt=kh,nn=hd,Fr=Sd,ii=Zy,Ot=mn("iterator"),gt="URLSearchParams",Ut=gt+"Iterator",dr=d.set,Pr=d.getterFor(gt),An=d.getterFor(Ut),Br=Object.getOwnPropertyDescriptor,qr=function(e){if(!bl)return wc[e];var t=Br(wc,e);return t&&t.value},ua=qr("fetch"),Mn=qr("Request"),Do=qr("Headers"),Sg=Mn&&Mn.prototype,kO=Do&&Do.prototype,ej=wc.RegExp,tj=wc.TypeError,MO=wc.decodeURIComponent,rj=wc.encodeURIComponent,nj=no("".charAt),UO=no([].join),Ep=no([].push),OC=no("".replace),ij=no([].shift),xO=no([].splice),jO=no("".split),aj=no("".slice),oj=/\+/g,BO=Array(4),sj=function(e){return BO[e-1]||(BO[e-1]=ej("((?:%[\\da-f]{2}){"+e+"})","gi"))},cj=function(e){try{return MO(e)}catch{return e}},VO=function(e){var t=OC(e,oj," "),r=4;try{return MO(t)}catch{for(;r;)t=OC(t,sj(r--),cj);return t}},lj=/[!'()~]|%20/g,uj={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},dj=function(e){return uj[e]},FO=function(e){return OC(rj(e),lj,dj)},NC=s(function(e,t){dr(this,{type:Ut,iterator:qt(Pr(e).entries),kind:t})},"Iterator",function(){var e=An(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value=t==="keys"?n.key:t==="values"?n.value:[n.key,n.value]),r},!0),GO=function(e){this.entries=[],this.url=null,e!==void 0&&(Bt(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?nj(e,0)==="?"?aj(e,1):e:$t(e)))};GO.prototype={type:gt,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,o,l,u,h=nn(e);if(h)for(r=(t=qt(e,h)).next;!(n=fp(r,t)).done;){if(o=(i=qt(ut(n.value))).next,(l=fp(o,i)).done||(u=fp(o,i)).done||!fp(o,i).done)throw tj("Expected sequence with length 2");Ep(this.entries,{key:$t(l.value),value:$t(u.value)})}else for(var m in e)k(e,m)&&Ep(this.entries,{key:m,value:$t(e[m])})},parseQuery:function(e){if(e)for(var t,r,n=jO(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=jO(t,"="),Ep(this.entries,{key:VO(ij(r)),value:VO(UO(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],Ep(r,FO(e.key)+"="+FO(e.value));return UO(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Qy=function(){g(this,Mm);var e=dr(this,new GO(arguments.length>0?arguments[0]:void 0));bl||(this.size=e.entries.length)},Mm=Qy.prototype;if(km(Mm,{append:function(e,t){var r=Pr(this);Fr(arguments.length,2),Ep(r.entries,{key:$t(e),value:$t(t)}),bl||this.length++,r.updateURL()},delete:function(e){for(var t=Pr(this),r=Fr(arguments.length,1),n=t.entries,i=$t(e),o=r<2?void 0:arguments[1],l=o===void 0?o:$t(o),u=0;u<n.length;){var h=n[u];if(h.key!==i||l!==void 0&&h.value!==l)u++;else if(xO(n,u,1),l!==void 0)break}bl||(this.size=n.length),t.updateURL()},get:function(e){var t=Pr(this).entries;Fr(arguments.length,1);for(var r=$t(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){var t=Pr(this).entries;Fr(arguments.length,1);for(var r=$t(e),n=[],i=0;i<t.length;i++)t[i].key===r&&Ep(n,t[i].value);return n},has:function(e){for(var t=Pr(this).entries,r=Fr(arguments.length,1),n=$t(e),i=r<2?void 0:arguments[1],o=i===void 0?i:$t(i),l=0;l<t.length;){var u=t[l++];if(u.key===n&&(o===void 0||u.value===o))return!0}return!1},set:function(e,t){var r=Pr(this);Fr(arguments.length,1);for(var n,i=r.entries,o=!1,l=$t(e),u=$t(t),h=0;h<i.length;h++)(n=i[h]).key===l&&(o?xO(i,h--,1):(o=!0,n.value=u));o||Ep(i,{key:l,value:u}),bl||(this.size=i.length),r.updateURL()},sort:function(){var e=Pr(this);ii(e.entries,function(t,r){return t.key>r.key?1:-1}),e.updateURL()},forEach:function(e){for(var t,r=Pr(this).entries,n=_e(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new NC(this,"keys")},values:function(){return new NC(this,"values")},entries:function(){return new NC(this,"entries")}},{enumerable:!0}),yg(Mm,Ot,Mm.entries,{}),yg(Mm,"toString",function(){return Pr(this).serialize()},{enumerable:!0}),bl&&bC(Mm,"size",{get:function(){return Pr(this).entries.length},configurable:!0,enumerable:!0}),a(Qy,gt),Bd({global:!0,forced:!mp},{URLSearchParams:Qy}),!mp&&b(Do)){var hj=no(kO.has),pj=no(kO.set),HO=function(e){if(Bt(e)){var t,r=e.body;if(Pe(r)===gt)return t=e.headers?new Do(e.headers):new Do,hj(t,"content-type")||pj(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Er(e,{body:Ht(0,$t(r)),headers:Ht(0,t)})}return e};if(b(ua)&&Bd({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return ua(e,arguments.length>1?HO(arguments[1]):{})}}),b(Mn)){var wC=function(e){return g(this,Sg),new Mn(e,arguments.length>1?HO(arguments[1]):{})};Sg.constructor=wC,wC.prototype=Sg,Bd({global:!0,dontCallGetSet:!0,forced:!0},{Request:wC})}}var Fs,fj={URLSearchParams:Qy,getState:Pr},mj=yt.URLSearchParams,WO=q,Ej=T,_j=Oe,gj=We,DC=wh,vj=$i,Tj=ge,yj=ct,Sj=it,Um=Object.assign,KO=Object.defineProperty,Rj=Ej([].concat),Cj=!Um||gj(function(){if(WO&&Um({b:1},Um(KO({},"a",{enumerable:!0,get:function(){KO(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach(function(i){t[i]=i}),Um({},e)[r]!=7||DC(Um({},t)).join("")!=n})?function(e,t){for(var r=yj(e),n=arguments.length,i=1,o=vj.f,l=Tj.f;n>i;)for(var u,h=Sj(arguments[i++]),m=o?Rj(DC(h),o(h)):DC(h),_=m.length,R=0;_>R;)u=m[R++],WO&&!_j(l,h,u)||(r[u]=h[u]);return r}:Um,Ij=ui,Aj=pd,bj=Ea,Oj=Oe,Nj=ct,wj=function(e,t,r,n){try{return n?t(Ij(r)[0],r[1]):t(r)}catch(i){Aj(e,"throw",i)}},Dj=al,Pj=yd,Lj=uc,zO=ls,kj=kh,Mj=hd,qO=Array,_p=T,PC=2147483647,Uj=/[^\0-\u007E]/,YO=/[.\u3002\uFF0E\uFF61]/g,XO="Overflow: input needs wider integers to process",JO=RangeError,xj=_p(YO.exec),xm=Math.floor,LC=String.fromCharCode,ZO=_p("".charCodeAt),QO=_p([].join),Vd=_p([].push),jj=_p("".replace),Bj=_p("".split),Vj=_p("".toLowerCase),$O=function(e){return e+22+75*(e<26)},Fj=function(e,t,r){var n=0;for(e=r?xm(e/700):e>>1,e+=xm(e/t);e>455;)e=xm(e/35),n+=36;return xm(n+36*e/(e+38))},Gj=function(e){var t=[];e=function(se){for(var ue=[],De=0,ze=se.length;De<ze;){var Ke=ZO(se,De++);if(Ke>=55296&&Ke<=56319&&De<ze){var Ve=ZO(se,De++);(64512&Ve)==56320?Vd(ue,((1023&Ke)<<10)+(1023&Ve)+65536):(Vd(ue,Ke),De--)}else Vd(ue,Ke)}return ue}(e);var r,n,i=e.length,o=128,l=0,u=72;for(r=0;r<e.length;r++)(n=e[r])<128&&Vd(t,LC(n));var h=t.length,m=h;for(h&&Vd(t,"-");m<i;){var _=PC;for(r=0;r<e.length;r++)(n=e[r])>=o&&n<_&&(_=n);var R=m+1;if(_-o>xm((PC-l)/R))throw JO(XO);for(l+=(_-o)*R,o=_,r=0;r<e.length;r++){if((n=e[r])<o&&++l>PC)throw JO(XO);if(n==o){for(var A=l,D=36;;){var J=D<=u?1:D>=u+26?26:D-u;if(A<J)break;var V=A-J,K=36-J;Vd(t,LC($O(J+V%K))),A=xm(V/K),D+=36}Vd(t,LC($O(A))),u=Fj(l,R,m==h),l=0,m++}}l++,o++}return QO(t,"")},Hj=dn,kC=q,Wj=xd,MC=y,eN=Ea,Gs=T,$y=ol,Hs=vd,Kj=em,UC=Jt,xC=Cj,jm=function(e){var t=Nj(e),r=Pj(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=i!==void 0;o&&(i=bj(i,n>2?arguments[2]:void 0));var l,u,h,m,_,R,A=Mj(t),D=0;if(!A||this===qO&&Dj(A))for(l=Lj(t),u=r?new this(l):qO(l);l>D;D++)R=o?i(t[D],D):t[D],zO(u,D,R);else for(_=(m=kj(t,A)).next,u=r?new this:[];!(h=Oj(_,m)).done;D++)R=o?wj(m,i,[h.value,D],!0):h.value,zO(u,D,R);return u.length=D,u},Dc=Dm,zj=Cl.codeAt,qj=function(e){var t,r,n=[],i=Bj(jj(Vj(e),YO,"."),".");for(t=0;t<i.length;t++)r=i[t],Vd(n,xj(Uj,r)?"xn--"+Gj(r):r);return QO(n,".")},Au=Va,Yj=Ps,Xj=Sd,tN=fj,rN=rs,Jj=rN.set,eS=rN.getterFor("URL"),Zj=tN.URLSearchParams,Qj=tN.getState,Rg=MC.URL,jC=MC.TypeError,tS=MC.parseInt,$j=Math.floor,nN=Math.pow,Ws=Gs("".charAt),Pc=Gs(/./.exec),Cg=Gs([].join),e4=Gs(1 .toString),t4=Gs([].pop),Bm=Gs([].push),BC=Gs("".replace),r4=Gs([].shift),n4=Gs("".split),Ig=Gs("".slice),rS=Gs("".toLowerCase),i4=Gs([].unshift),VC="Invalid scheme",Ag="Invalid host",iN="Invalid port",aN=/[a-z]/i,a4=/[\d+-.a-z]/i,FC=/\d/,o4=/^0x/i,s4=/^[0-7]+$/,c4=/^\d+$/,oN=/^[\da-f]+$/i,l4=/[\0\t\n\r #%/:<>?@[\\\]^|]/,u4=/[\0\t\n\r #/:<>?@[\\\]^|]/,d4=/^[\u0000-\u0020]+/,h4=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,p4=/[\t\n\r]/g,bg=function(e){var t,r,n,i;if(typeof e=="number"){for(t=[],r=0;r<4;r++)i4(t,e%256),e=$j(e/256);return Cg(t,".")}if(typeof e=="object"){for(t="",n=function(o){for(var l=null,u=1,h=null,m=0,_=0;_<8;_++)o[_]!==0?(m>u&&(l=h,u=m),h=null,m=0):(h===null&&(h=_),++m);return m>u&&(l=h,u=m),l}(e),r=0;r<8;r++)i&&e[r]===0||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=e4(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},nS={},sN=xC({},nS,{" ":1,'"':1,"<":1,">":1,"`":1}),cN=xC({},sN,{"#":1,"?":1,"{":1,"}":1}),GC=xC({},cN,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Fd=function(e,t){var r=zj(e,0);return r>32&&r<127&&!UC(t,e)?e:encodeURIComponent(e)},iS={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Og=function(e,t){var r;return e.length==2&&Pc(aN,Ws(e,0))&&((r=Ws(e,1))==":"||!t&&r=="|")},lN=function(e){var t;return e.length>1&&Og(Ig(e,0,2))&&(e.length==2||(t=Ws(e,2))==="/"||t==="\\"||t==="?"||t==="#")},f4=function(e){return e==="."||rS(e)==="%2e"},HC={},uN={},WC={},dN={},hN={},KC={},pN={},fN={},aS={},oS={},zC={},qC={},YC={},XC={},mN={},JC={},Vm={},Ol={},EN={},gp={},bu={},ZC=function(e,t,r){var n,i,o,l=Au(e);if(t){if(i=this.parse(l))throw jC(i);this.searchParams=null}else{if(r!==void 0&&(n=new ZC(r,!0)),i=this.parse(l,null,n))throw jC(i);(o=Qj(new Zj)).bindURL(this),this.searchParams=o}};ZC.prototype={type:"URL",parse:function(e,t,r){var n,i,o,l,u,h=this,m=t||HC,_=0,R="",A=!1,D=!1,J=!1;for(e=Au(e),t||(h.scheme="",h.username="",h.password="",h.host=null,h.port=null,h.path=[],h.query=null,h.fragment=null,h.cannotBeABaseURL=!1,e=BC(e,d4,""),e=BC(e,h4,"$1")),e=BC(e,p4,""),n=jm(e);_<=n.length;){switch(i=n[_],m){case HC:if(!i||!Pc(aN,i)){if(t)return VC;m=WC;continue}R+=rS(i),m=uN;break;case uN:if(i&&(Pc(a4,i)||i=="+"||i=="-"||i=="."))R+=rS(i);else{if(i!=":"){if(t)return VC;R="",m=WC,_=0;continue}if(t&&(h.isSpecial()!=UC(iS,R)||R=="file"&&(h.includesCredentials()||h.port!==null)||h.scheme=="file"&&!h.host))return;if(h.scheme=R,t)return void(h.isSpecial()&&iS[h.scheme]==h.port&&(h.port=null));R="",h.scheme=="file"?m=XC:h.isSpecial()&&r&&r.scheme==h.scheme?m=dN:h.isSpecial()?m=fN:n[_+1]=="/"?(m=hN,_++):(h.cannotBeABaseURL=!0,Bm(h.path,""),m=EN)}break;case WC:if(!r||r.cannotBeABaseURL&&i!="#")return VC;if(r.cannotBeABaseURL&&i=="#"){h.scheme=r.scheme,h.path=Dc(r.path),h.query=r.query,h.fragment="",h.cannotBeABaseURL=!0,m=bu;break}m=r.scheme=="file"?XC:KC;continue;case dN:if(i!="/"||n[_+1]!="/"){m=KC;continue}m=aS,_++;break;case hN:if(i=="/"){m=oS;break}m=Ol;continue;case KC:if(h.scheme=r.scheme,i==Fs)h.username=r.username,h.password=r.password,h.host=r.host,h.port=r.port,h.path=Dc(r.path),h.query=r.query;else if(i=="/"||i=="\\"&&h.isSpecial())m=pN;else if(i=="?")h.username=r.username,h.password=r.password,h.host=r.host,h.port=r.port,h.path=Dc(r.path),h.query="",m=gp;else{if(i!="#"){h.username=r.username,h.password=r.password,h.host=r.host,h.port=r.port,h.path=Dc(r.path),h.path.length--,m=Ol;continue}h.username=r.username,h.password=r.password,h.host=r.host,h.port=r.port,h.path=Dc(r.path),h.query=r.query,h.fragment="",m=bu}break;case pN:if(!h.isSpecial()||i!="/"&&i!="\\"){if(i!="/"){h.username=r.username,h.password=r.password,h.host=r.host,h.port=r.port,m=Ol;continue}m=oS}else m=aS;break;case fN:if(m=aS,i!="/"||Ws(R,_+1)!="/")continue;_++;break;case aS:if(i!="/"&&i!="\\"){m=oS;continue}break;case oS:if(i=="@"){A&&(R="%40"+R),A=!0,o=jm(R);for(var V=0;V<o.length;V++){var K=o[V];if(K!=":"||J){var se=Fd(K,GC);J?h.password+=se:h.username+=se}else J=!0}R=""}else if(i==Fs||i=="/"||i=="?"||i=="#"||i=="\\"&&h.isSpecial()){if(A&&R=="")return"Invalid authority";_-=jm(R).length+1,R="",m=zC}else R+=i;break;case zC:case qC:if(t&&h.scheme=="file"){m=JC;continue}if(i!=":"||D){if(i==Fs||i=="/"||i=="?"||i=="#"||i=="\\"&&h.isSpecial()){if(h.isSpecial()&&R=="")return Ag;if(t&&R==""&&(h.includesCredentials()||h.port!==null))return;if(l=h.parseHost(R))return l;if(R="",m=Vm,t)return;continue}i=="["?D=!0:i=="]"&&(D=!1),R+=i}else{if(R=="")return Ag;if(l=h.parseHost(R))return l;if(R="",m=YC,t==qC)return}break;case YC:if(!Pc(FC,i)){if(i==Fs||i=="/"||i=="?"||i=="#"||i=="\\"&&h.isSpecial()||t){if(R!=""){var ue=tS(R,10);if(ue>65535)return iN;h.port=h.isSpecial()&&ue===iS[h.scheme]?null:ue,R=""}if(t)return;m=Vm;continue}return iN}R+=i;break;case XC:if(h.scheme="file",i=="/"||i=="\\")m=mN;else{if(!r||r.scheme!="file"){m=Ol;continue}if(i==Fs)h.host=r.host,h.path=Dc(r.path),h.query=r.query;else if(i=="?")h.host=r.host,h.path=Dc(r.path),h.query="",m=gp;else{if(i!="#"){lN(Cg(Dc(n,_),""))||(h.host=r.host,h.path=Dc(r.path),h.shortenPath()),m=Ol;continue}h.host=r.host,h.path=Dc(r.path),h.query=r.query,h.fragment="",m=bu}}break;case mN:if(i=="/"||i=="\\"){m=JC;break}r&&r.scheme=="file"&&!lN(Cg(Dc(n,_),""))&&(Og(r.path[0],!0)?Bm(h.path,r.path[0]):h.host=r.host),m=Ol;continue;case JC:if(i==Fs||i=="/"||i=="\\"||i=="?"||i=="#"){if(!t&&Og(R))m=Ol;else if(R==""){if(h.host="",t)return;m=Vm}else{if(l=h.parseHost(R))return l;if(h.host=="localhost"&&(h.host=""),t)return;R="",m=Vm}continue}R+=i;break;case Vm:if(h.isSpecial()){if(m=Ol,i!="/"&&i!="\\")continue}else if(t||i!="?")if(t||i!="#"){if(i!=Fs&&(m=Ol,i!="/"))continue}else h.fragment="",m=bu;else h.query="",m=gp;break;case Ol:if(i==Fs||i=="/"||i=="\\"&&h.isSpecial()||!t&&(i=="?"||i=="#")){if((u=rS(u=R))===".."||u==="%2e."||u===".%2e"||u==="%2e%2e"?(h.shortenPath(),i=="/"||i=="\\"&&h.isSpecial()||Bm(h.path,"")):f4(R)?i=="/"||i=="\\"&&h.isSpecial()||Bm(h.path,""):(h.scheme=="file"&&!h.path.length&&Og(R)&&(h.host&&(h.host=""),R=Ws(R,0)+":"),Bm(h.path,R)),R="",h.scheme=="file"&&(i==Fs||i=="?"||i=="#"))for(;h.path.length>1&&h.path[0]==="";)r4(h.path);i=="?"?(h.query="",m=gp):i=="#"&&(h.fragment="",m=bu)}else R+=Fd(i,cN);break;case EN:i=="?"?(h.query="",m=gp):i=="#"?(h.fragment="",m=bu):i!=Fs&&(h.path[0]+=Fd(i,nS));break;case gp:t||i!="#"?i!=Fs&&(i=="'"&&h.isSpecial()?h.query+="%27":h.query+=i=="#"?"%23":Fd(i,nS)):(h.fragment="",m=bu);break;case bu:i!=Fs&&(h.fragment+=Fd(i,sN))}_++}},parseHost:function(e){var t,r,n;if(Ws(e,0)=="["){if(Ws(e,e.length-1)!="]"||(t=function(i){var o,l,u,h,m,_,R,A=[0,0,0,0,0,0,0,0],D=0,J=null,V=0,K=function(){return Ws(i,V)};if(K()==":"){if(Ws(i,1)!=":")return;V+=2,J=++D}for(;K();){if(D==8)return;if(K()!=":"){for(o=l=0;l<4&&Pc(oN,K());)o=16*o+tS(K(),16),V++,l++;if(K()=="."){if(l==0||(V-=l,D>6))return;for(u=0;K();){if(h=null,u>0){if(!(K()=="."&&u<4))return;V++}if(!Pc(FC,K()))return;for(;Pc(FC,K());){if(m=tS(K(),10),h===null)h=m;else{if(h==0)return;h=10*h+m}if(h>255)return;V++}A[D]=256*A[D]+h,++u!=2&&u!=4||D++}if(u!=4)return;break}if(K()==":"){if(V++,!K())return}else if(K())return;A[D++]=o}else{if(J!==null)return;V++,J=++D}}if(J!==null)for(_=D-J,D=7;D!=0&&_>0;)R=A[D],A[D--]=A[J+_-1],A[J+--_]=R;else if(D!=8)return;return A}(Ig(e,1,-1)),!t))return Ag;this.host=t}else if(this.isSpecial()){if(e=qj(e),Pc(l4,e)||(t=function(i){var o,l,u,h,m,_,R,A=n4(i,".");if(A.length&&A[A.length-1]==""&&A.length--,(o=A.length)>4)return i;for(l=[],u=0;u<o;u++){if((h=A[u])=="")return i;if(m=10,h.length>1&&Ws(h,0)=="0"&&(m=Pc(o4,h)?16:8,h=Ig(h,m==8?1:2)),h==="")_=0;else{if(!Pc(m==10?c4:m==8?s4:oN,h))return i;_=tS(h,m)}Bm(l,_)}for(u=0;u<o;u++)if(_=l[u],u==o-1){if(_>=nN(256,5-o))return null}else if(_>255)return null;for(R=t4(l),u=0;u<l.length;u++)R+=l[u]*nN(256,3-u);return R}(e),t===null))return Ag;this.host=t}else{if(Pc(u4,e))return Ag;for(t="",r=jm(e),n=0;n<r.length;n++)t+=Fd(r[n],nS);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return UC(iS,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||this.scheme=="file"&&t==1&&Og(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,o=e.port,l=e.path,u=e.query,h=e.fragment,m=t+":";return i!==null?(m+="//",e.includesCredentials()&&(m+=r+(n?":"+n:"")+"@"),m+=bg(i),o!==null&&(m+=":"+o)):t=="file"&&(m+="//"),m+=e.cannotBeABaseURL?l[0]:l.length?"/"+Cg(l,"/"):"",u!==null&&(m+="?"+u),h!==null&&(m+="#"+h),m},setHref:function(e){var t=this.parse(e);if(t)throw jC(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if(e=="blob")try{return new Fm(e.path[0]).origin}catch{return"null"}return e!="file"&&this.isSpecial()?e+"://"+bg(this.host)+(t!==null?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(Au(e)+":",HC)},getUsername:function(){return this.username},setUsername:function(e){var t=jm(Au(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=Fd(t[r],GC)}},getPassword:function(){return this.password},setPassword:function(e){var t=jm(Au(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=Fd(t[r],GC)}},getHost:function(){var e=this.host,t=this.port;return e===null?"":t===null?bg(e):bg(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,zC)},getHostname:function(){var e=this.host;return e===null?"":bg(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,qC)},getPort:function(){var e=this.port;return e===null?"":Au(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=Au(e))==""?this.port=null:this.parse(e,YC))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Cg(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,Vm))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=Au(e))==""?this.query=null:(Ws(e,0)=="?"&&(e=Ig(e,1)),this.query="",this.parse(e,gp)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=Au(e))!=""?(Ws(e,0)=="#"&&(e=Ig(e,1)),this.fragment="",this.parse(e,bu)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Fm=function(e){var t=Kj(this,vo),r=Xj(arguments.length,1)>1?arguments[1]:void 0,n=Jj(t,new ZC(e,!1,r));kC||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},vo=Fm.prototype,Ks=function(e,t){return{get:function(){return eS(this)[e]()},set:t&&function(r){return eS(this)[t](r)},configurable:!0,enumerable:!0}};if(kC&&(Hs(vo,"href",Ks("serialize","setHref")),Hs(vo,"origin",Ks("getOrigin")),Hs(vo,"protocol",Ks("getProtocol","setProtocol")),Hs(vo,"username",Ks("getUsername","setUsername")),Hs(vo,"password",Ks("getPassword","setPassword")),Hs(vo,"host",Ks("getHost","setHost")),Hs(vo,"hostname",Ks("getHostname","setHostname")),Hs(vo,"port",Ks("getPort","setPort")),Hs(vo,"pathname",Ks("getPathname","setPathname")),Hs(vo,"search",Ks("getSearch","setSearch")),Hs(vo,"searchParams",Ks("getSearchParams")),Hs(vo,"hash",Ks("getHash","setHash"))),$y(vo,"toJSON",function(){return eS(this).serialize()},{enumerable:!0}),$y(vo,"toString",function(){return eS(this).serialize()},{enumerable:!0}),Rg){var _N=Rg.createObjectURL,gN=Rg.revokeObjectURL;_N&&$y(Fm,"createObjectURL",eN(_N,Rg)),gN&&$y(Fm,"revokeObjectURL",eN(gN,Rg))}Yj(Fm,"URL"),Hj({global:!0,forced:!Wj,sham:!kC},{URL:Fm});var m4=dn,E4=We,_4=Sd,vN=Va,g4=xd,TN=Zt("URL");m4({target:"URL",stat:!0,forced:!(g4&&E4(function(){TN.canParse()}))},{canParse:function(e){var t=_4(arguments.length,1),r=vN(e),n=t<2||arguments[1]===void 0?void 0:vN(arguments[1]);try{return!!new TN(r,n)}catch{return!1}}});var sS=fe(yt.URL);let yN=!0,SN=!0;function cS(e,t,r){let n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function vp(e,t,r){if(!e.RTCPeerConnection)return;let n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(l,u){if(l!==t)return i.apply(this,arguments);let h=m=>{let _=r(m);_&&(u.handleEvent?u.handleEvent(_):u(_))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,h),i.apply(this,[l,h])};let o=n.removeEventListener;n.removeEventListener=function(l,u){if(l!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(u))return o.apply(this,arguments);let h=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[l,h])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(l){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),l&&this.addEventListener(t,this["_on"+t]=l)},enumerable:!0,configurable:!0})}function v4(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(yN=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function T4(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(SN=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function RN(){if(typeof window=="object"){if(yN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function QC(e,t){SN&&console.warn(e+" is deprecated, please use "+t+" instead.")}function CN(e){return Object.prototype.toString.call(e)==="[object Object]"}function IN(e){var t;return CN(e)?wa(t=Object.keys(e)).call(t,function(r,n){let i=CN(e[n]),o=i?IN(e[n]):e[n],l=i&&!Object.keys(o).length;return o===void 0||l?r:Object.assign(r,{[n]:o})},{}):e}function $C(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach(n=>{n.endsWith("Id")?$C(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach(i=>{$C(e,e.get(i),r)})}))}function AN(e,t,r){let n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(t===null)return i;let o=[];return e.forEach(l=>{l.type==="track"&&l.trackIdentifier===t.id&&o.push(l)}),o.forEach(l=>{e.forEach(u=>{u.type===n&&u.trackId===l.id&&$C(e,u,i)})}),i}let bN=RN;function ON(e,t){let r=e&&e.navigator;if(!r.mediaDevices)return;let n=function(l){if(typeof l!="object"||l.mandatory||l.optional)return l;let u={};return Object.keys(l).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;let m=typeof l[h]=="object"?l[h]:{ideal:l[h]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);let _=function(R,A){return R?R+A.charAt(0).toUpperCase()+A.slice(1):A==="deviceId"?"sourceId":A};if(m.ideal!==void 0){u.optional=u.optional||[];let R={};typeof m.ideal=="number"?(R[_("min",h)]=m.ideal,u.optional.push(R),R={},R[_("max",h)]=m.ideal,u.optional.push(R)):(R[_("",h)]=m.ideal,u.optional.push(R))}m.exact!==void 0&&typeof m.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[_("",h)]=m.exact):["min","max"].forEach(R=>{m[R]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[_(R,h)]=m[R])})}),l.advanced&&(u.optional=(u.optional||[]).concat(l.advanced)),u},i=function(l,u){if(t.version>=61)return u(l);if((l=JSON.parse(JSON.stringify(l)))&&typeof l.audio=="object"){let h=function(m,_,R){_ in m&&!(R in m)&&(m[R]=m[_],delete m[_])};h((l=JSON.parse(JSON.stringify(l))).audio,"autoGainControl","googAutoGainControl"),h(l.audio,"noiseSuppression","googNoiseSuppression"),l.audio=n(l.audio)}if(l&&typeof l.video=="object"){let h=l.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});let m=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||m)){let _;if(delete l.video.facingMode,h.exact==="environment"||h.ideal==="environment"?_=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(_=["front"]),_)return r.mediaDevices.enumerateDevices().then(R=>{let A=(R=R.filter(D=>D.kind==="videoinput")).find(D=>_.some(J=>{var V;return Qt(V=D.label.toLowerCase()).call(V,J)}));return!A&&R.length&&Qt(_).call(_,"back")&&(A=R[R.length-1]),A&&(l.video.deviceId=h.exact?{exact:A.deviceId}:{ideal:A.deviceId}),l.video=n(l.video),bN("chrome: "+JSON.stringify(l)),u(l)})}l.video=n(l.video)}return bN("chrome: "+JSON.stringify(l)),u(l)},o=function(l){return t.version>=64?l:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[l.name]||l.name,message:l.message,constraint:l.constraint||l.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=(function(l,u,h){i(l,m=>{r.webkitGetUserMedia(m,u,_=>{h&&h(o(_))})})}).bind(r),r.mediaDevices.getUserMedia){let l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(u){return i(u,h=>l(h).then(m=>{if(h.audio&&!m.getAudioTracks().length||h.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(_=>{_.stop()}),new DOMException("","NotFoundError");return m},m=>tr.reject(o(m))))}}}function NN(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function wN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=r)},enumerable:!0,configurable:!0});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=r=>{r.stream.addEventListener("addtrack",n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===n.track.id):{track:n.track};let o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)}),r.stream.getTracks().forEach(n=>{let i;i=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(l=>l.track&&l.track.id===n.id):{track:n};let o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[r.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else vp(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function DN(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){let t=function(i,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=i.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:i}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};let i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(l,u){let h=i.apply(this,arguments);return h||(h=t(this,l),this._senders.push(h)),h};let o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(l){o.apply(this,arguments);let u=this._senders.indexOf(l);u!==-1&&this._senders.splice(u,1)}}let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(i){this._senders=this._senders||[],r.apply(this,[i]),i.getTracks().forEach(o=>{this._senders.push(t(this,o))})};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(i){this._senders=this._senders||[],n.apply(this,[i]),i.getTracks().forEach(o=>{let l=this._senders.find(u=>u.track===o);l&&this._senders.splice(this._senders.indexOf(l),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){let t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){let r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function PN(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[r,n,i]=arguments;if(arguments.length>0&&typeof r=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof r!="function"))return t.apply(this,[]);let o=function(u){let h={};return u.result().forEach(m=>{let _={id:m.id,timestamp:m.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[m.type]||m.type};m.names().forEach(R=>{_[R]=m.stat(R)}),h[_.id]=_}),h},l=function(u){return new Map(Object.keys(u).map(h=>[h,u[h]]))};if(arguments.length>=2){let u=function(h){n(l(o(h)))};return t.apply(this,[u,r])}return new tr((u,h)=>{t.apply(this,[function(m){u(l(o(m)))},h])}).then(n,i)}}function LN(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){let r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){let i=r.apply(this,[]);return i.forEach(o=>o._pc=this),i});let n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){let i=n.apply(this,arguments);return i._pc=this,i}),e.RTCRtpSender.prototype.getStats=function(){let i=this;return this._pc.getStats().then(o=>AN(o,i.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){let r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){let n=r.apply(this,[]);return n.forEach(i=>i._pc=this),n}),vp(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){let n=this;return this._pc.getStats().then(i=>AN(i,n.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;let t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){let r=arguments[0],n,i,o;return this.getSenders().forEach(l=>{l.track===r&&(n?o=!0:n=l)}),this.getReceivers().forEach(l=>(l.track===r&&(i?o=!0:i=l),l.track===r)),o||n&&i?tr.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():i?i.getStats():tr.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function kN(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,l){if(!l)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};let u=t.apply(this,arguments);return this._shimmedLocalStreams[l.id]?this._shimmedLocalStreams[l.id].indexOf(u)===-1&&this._shimmedLocalStreams[l.id].push(u):this._shimmedLocalStreams[l.id]=[l,u],u};let r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});let l=this.getSenders();r.apply(this,arguments);let u=this.getSenders().filter(h=>l.indexOf(h)===-1);this._shimmedLocalStreams[o.id]=[o].concat(u)};let n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],n.apply(this,arguments)};let i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(l=>{let u=this._shimmedLocalStreams[l].indexOf(o);u!==-1&&this._shimmedLocalStreams[l].splice(u,1),this._shimmedLocalStreams[l].length===1&&delete this._shimmedLocalStreams[l]}),i.apply(this,arguments)}}function MN(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return kN(e);let r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){let h=r.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(m=>this._reverseStreams[m.id])};let n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(m=>{if(this.getSenders().find(_=>_.track===m))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){let m=new e.MediaStream(h.getTracks());this._streams[h.id]=m,this._reverseStreams[m.id]=h,h=m}n.apply(this,[h])};let i=e.RTCPeerConnection.prototype.removeStream;function o(h,m){let _=m.sdp;return Object.keys(h._reverseStreams||[]).forEach(R=>{let A=h._reverseStreams[R],D=h._streams[A.id];_=_.replace(new RegExp(D.id,"g"),A.id)}),new RTCSessionDescription({type:m.type,sdp:_})}e.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},e.RTCPeerConnection.prototype.addTrack=function(h,m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");let _=[].slice.call(arguments,1);if(_.length!==1||!_[0].getTracks().find(A=>A===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(A=>A.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};let R=this._streams[m.id];if(R)R.addTrack(h),tr.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{let A=new e.MediaStream([h]);this._streams[m.id]=A,this._reverseStreams[A.id]=m,this.addStream(A)}return this.getSenders().find(A=>A.track===h)},["createOffer","createAnswer"].forEach(function(h){let m=e.RTCPeerConnection.prototype[h],_={[h](){let R=arguments;return arguments.length&&typeof arguments[0]=="function"?m.apply(this,[A=>{let D=o(this,A);R[0].apply(null,[D])},A=>{R[1]&&R[1].apply(null,A)},arguments[2]]):m.apply(this,arguments).then(A=>o(this,A))}};e.RTCPeerConnection.prototype[h]=_[h]});let l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(h,m){let _=m.sdp;return Object.keys(h._reverseStreams||[]).forEach(R=>{let A=h._reverseStreams[R],D=h._streams[A.id];_=_.replace(new RegExp(A.id,"g"),D.id)}),new RTCSessionDescription({type:m.type,sdp:_})}(this,arguments[0]),l.apply(this,arguments)):l.apply(this,arguments)};let u=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){let h=u.get.apply(this);return h.type===""?h:o(this,h)}}),e.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(h._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let m;this._streams=this._streams||{},Object.keys(this._streams).forEach(_=>{this._streams[_].getTracks().find(R=>h.track===R)&&(m=this._streams[_])}),m&&(m.getTracks().length===1?this.removeStream(this._reverseStreams[m.id]):m.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function eI(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(r){let n=e.RTCPeerConnection.prototype[r],i={[r](){return arguments[0]=new(r==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[r]=i[r]})}function UN(e,t){vp(e,"negotiationneeded",r=>{let n=r.target;if(!(t.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")||n.signalingState==="stable")return r})}var xN=Object.freeze({__proto__:null,fixNegotiationNeeded:UN,shimAddTrackRemoveTrack:MN,shimAddTrackRemoveTrackWithNative:kN,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then(n=>{let i=r.video&&r.video.width,o=r.video&&r.video.height,l=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:n,maxFrameRate:l||3}},i&&(r.video.mandatory.maxWidth=i),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:DN,shimGetStats:PN,shimGetUserMedia:ON,shimMediaStream:NN,shimOnTrack:wN,shimPeerConnection:eI,shimSenderReceiverGetStats:LN});function jN(e,t){let r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(i,o,l){QC("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(i).then(o,l)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){let i=function(l,u,h){u in l&&!(h in l)&&(l[h]=l[u],delete l[u])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(l){return typeof l=="object"&&typeof l.audio=="object"&&(l=JSON.parse(JSON.stringify(l)),i(l.audio,"autoGainControl","mozAutoGainControl"),i(l.audio,"noiseSuppression","mozNoiseSuppression")),o(l)},n&&n.prototype.getSettings){let l=n.prototype.getSettings;n.prototype.getSettings=function(){let u=l.apply(this,arguments);return i(u,"mozAutoGainControl","autoGainControl"),i(u,"mozNoiseSuppression","noiseSuppression"),u}}if(n&&n.prototype.applyConstraints){let l=n.prototype.applyConstraints;n.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),i(u,"autoGainControl","mozAutoGainControl"),i(u,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[u])}}}}function BN(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function tI(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){let o=e.RTCPeerConnection.prototype[i],l={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=l[i]});let r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){let[i,o,l]=arguments;return n.apply(this,[i||null]).then(u=>{if(t.version<53&&!o)try{u.forEach(h=>{h.type=r[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;u.forEach((m,_)=>{u.set(_,Object.assign({},m,{type:r[m.type]||m.type}))})}return u}).then(o,l)}}function VN(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;let t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){let n=t.apply(this,[]);return n.forEach(i=>i._pc=this),n});let r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){let n=r.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):tr.resolve(new Map)}}function FN(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;let t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){let r=t.apply(this,[]);return r.forEach(n=>n._pc=this),r}),vp(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function GN(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){QC("removeStream","removeTrack"),this.getSenders().forEach(r=>{var n;r.track&&Qt(n=t.getTracks()).call(n,r.track)&&this.removeTrack(r)})})}function HN(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function WN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let r=arguments[1]&&arguments[1].sendEncodings;r===void 0&&(r=[]),r=[...r];let n=r.length>0;n&&r.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});let i=t.apply(this,arguments);if(n){let{sender:o}=i,l=o.getParameters();(!("encodings"in l)||l.encodings.length===1&&Object.keys(l.encodings[0]).length===0)&&(l.encodings=r,o.sendEncodings=r,this.setParametersPromises.push(o.setParameters(l).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return i})}function KN(e){if(typeof e!="object"||!e.RTCRtpSender)return;let t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){let r=t.apply(this,arguments);return"encodings"in r||(r.encodings=[].concat(this.sendEncodings||[{}])),r})}function zN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?tr.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function qN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?tr.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var YN=Object.freeze({__proto__:null,shimAddTransceiver:WN,shimCreateAnswer:qN,shimCreateOffer:zN,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){let n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,tr.reject(n)}return r.video===!0?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})},shimGetParameters:KN,shimGetUserMedia:jN,shimOnTrack:BN,shimPeerConnection:tI,shimRTCDataChannel:HN,shimReceiverGetStats:FN,shimRemoveStream:GN,shimSenderGetStats:VN});function XN(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){let t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(r){var n;this._localStreams||(this._localStreams=[]),Qt(n=this._localStreams).call(n,r)||this._localStreams.push(r),r.getAudioTracks().forEach(i=>t.call(this,i,r)),r.getVideoTracks().forEach(i=>t.call(this,i,r))},e.RTCPeerConnection.prototype.addTrack=function(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i&&i.forEach(l=>{var u;this._localStreams?Qt(u=this._localStreams).call(u,l)||this._localStreams.push(l):this._localStreams=[l]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);let r=this._localStreams.indexOf(t);if(r===-1)return;this._localStreams.splice(r,1);let n=t.getTracks();this.getSenders().forEach(i=>{Qt(n).call(n,i.track)&&this.removeTrack(i)})})}}function JN(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=r),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(i=>{var o;if(this._remoteStreams||(this._remoteStreams=[]),Qt(o=this._remoteStreams).call(o,i))return;this._remoteStreams.push(i);let l=new Event("addstream");l.stream=i,this.dispatchEvent(l)})})}});let t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){let r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(i=>{if(r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.indexOf(i)>=0)return;r._remoteStreams.push(i);let o=new Event("addstream");o.stream=i,r.dispatchEvent(o)})}),t.apply(r,arguments)}}}function ZN(e){if(typeof e!="object"||!e.RTCPeerConnection)return;let t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,l=t.addIceCandidate;t.createOffer=function(h,m){let _=arguments.length>=2?arguments[2]:arguments[0],R=r.apply(this,[_]);return m?(R.then(h,m),tr.resolve()):R},t.createAnswer=function(h,m){let _=arguments.length>=2?arguments[2]:arguments[0],R=n.apply(this,[_]);return m?(R.then(h,m),tr.resolve()):R};let u=function(h,m,_){let R=i.apply(this,[h]);return _?(R.then(m,_),tr.resolve()):R};t.setLocalDescription=u,u=function(h,m,_){let R=o.apply(this,[h]);return _?(R.then(m,_),tr.resolve()):R},t.setRemoteDescription=u,u=function(h,m,_){let R=l.apply(this,[h]);return _?(R.then(m,_),tr.resolve()):R},t.addIceCandidate=u}function QN(e){let t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){let r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=i=>n($N(i))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(r,n,i){t.mediaDevices.getUserMedia(r).then(n,i)}).bind(t))}function $N(e){return e&&e.video!==void 0?Object.assign({},e,{video:IN(e.video)}):e}function ew(e){if(!e.RTCPeerConnection)return;let t=e.RTCPeerConnection;e.RTCPeerConnection=function(r,n){if(r&&r.iceServers){let i=[];for(let o=0;o<r.iceServers.length;o++){let l=r.iceServers[o];!l.hasOwnProperty("urls")&&l.hasOwnProperty("url")?(QC("RTCIceServer.url","RTCIceServer.urls"),l=JSON.parse(JSON.stringify(l)),l.urls=l.url,delete l.url,i.push(l)):i.push(r.iceServers[o])}r.iceServers=i}return new t(r,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function tw(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function rw(e){let t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(r){if(r){r.offerToReceiveAudio!==void 0&&(r.offerToReceiveAudio=!!r.offerToReceiveAudio);let n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");r.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):r.offerToReceiveAudio!==!0||n||this.addTransceiver("audio",{direction:"recvonly"}),r.offerToReceiveVideo!==void 0&&(r.offerToReceiveVideo=!!r.offerToReceiveVideo);let i=this.getTransceivers().find(o=>o.receiver.track.kind==="video");r.offerToReceiveVideo===!1&&i?i.direction==="sendrecv"?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":i.direction==="recvonly"&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):r.offerToReceiveVideo!==!0||i||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function nw(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var iw=Object.freeze({__proto__:null,shimAudioContext:nw,shimCallbacksAPI:ZN,shimConstraints:$N,shimCreateOfferLegacy:rw,shimGetUserMedia:QN,shimLocalStreamsAPI:XN,shimRTCIceServerUrls:ew,shimRemoteStreamsAPI:JN,shimTrackEventTransceiver:tw}),aw=`	
\v\f\r                　\u2028\u2029\uFEFF`,y4=jt,S4=Va,rI=aw,ow=T("".replace),R4=RegExp("^["+rI+"]+"),C4=RegExp("(^|[^"+rI+"])["+rI+"]+$"),I4=function(e){return function(t){var r=S4(y4(t));return r=ow(r,R4,""),r=ow(r,C4,"$1"),r}},A4={trim:I4()},b4=b_.PROPER,O4=We,sw=aw,N4=A4.trim;dn({target:"String",proto:!0,forced:function(e){return O4(function(){return!!sw[e]()||"​᠎"[e]()!=="​᠎"||b4&&sw[e].name!==e})}("trim")},{trim:function(){return N4(this)}});var w4=Ba("String").trim,D4=v,P4=w4,nI=String.prototype,L4=function(e){var t=e.trim;return typeof e=="string"||e===nI||D4(nI,e)&&t===nI.trim?P4:t},Ia=fe(L4),cw={exports:{}};(function(e){let t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(r){return r.trim().split(`
`).map(n=>n.trim())},t.splitSections=function(r){return r.split(`
m=`).map((n,i)=>(i>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(r){let n=t.splitSections(r);return n&&n[0]},t.getMediaSections=function(r){let n=t.splitSections(r);return n.shift(),n},t.matchPrefix=function(r,n){return t.splitLines(r).filter(i=>i.indexOf(n)===0)},t.parseCandidate=function(r){let n;n=r.indexOf("a=candidate:")===0?r.substring(12).split(" "):r.substring(10).split(" ");let i={foundation:n[0],component:{1:"rtp",2:"rtcp"}[n[1]]||n[1],protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]};for(let o=8;o<n.length;o+=2)switch(n[o]){case"raddr":i.relatedAddress=n[o+1];break;case"rport":i.relatedPort=parseInt(n[o+1],10);break;case"tcptype":i.tcpType=n[o+1];break;case"ufrag":i.ufrag=n[o+1],i.usernameFragment=n[o+1];break;default:i[n[o]]===void 0&&(i[n[o]]=n[o+1])}return i},t.writeCandidate=function(r){let n=[];n.push(r.foundation);let i=r.component;i==="rtp"?n.push(1):i==="rtcp"?n.push(2):n.push(i),n.push(r.protocol.toUpperCase()),n.push(r.priority),n.push(r.address||r.ip),n.push(r.port);let o=r.type;return n.push("typ"),n.push(o),o!=="host"&&r.relatedAddress&&r.relatedPort&&(n.push("raddr"),n.push(r.relatedAddress),n.push("rport"),n.push(r.relatedPort)),r.tcpType&&r.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(r.tcpType)),(r.usernameFragment||r.ufrag)&&(n.push("ufrag"),n.push(r.usernameFragment||r.ufrag)),"candidate:"+n.join(" ")},t.parseIceOptions=function(r){return r.substring(14).split(" ")},t.parseRtpMap=function(r){let n=r.substring(9).split(" "),i={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),i.name=n[0],i.clockRate=parseInt(n[1],10),i.channels=n.length===3?parseInt(n[2],10):1,i.numChannels=i.channels,i},t.writeRtpMap=function(r){let n=r.payloadType;r.preferredPayloadType!==void 0&&(n=r.preferredPayloadType);let i=r.channels||r.numChannels||1;return"a=rtpmap:"+n+" "+r.name+"/"+r.clockRate+(i!==1?"/"+i:"")+`\r
`},t.parseExtmap=function(r){let n=r.substring(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1],attributes:n.slice(2).join(" ")}},t.writeExtmap=function(r){return"a=extmap:"+(r.id||r.preferredId)+(r.direction&&r.direction!=="sendrecv"?"/"+r.direction:"")+" "+r.uri+(r.attributes?" "+r.attributes:"")+`\r
`},t.parseFmtp=function(r){let n={},i,o=r.substring(r.indexOf(" ")+1).split(";");for(let l=0;l<o.length;l++)i=o[l].trim().split("="),n[i[0].trim()]=i[1];return n},t.writeFmtp=function(r){let n="",i=r.payloadType;if(r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.parameters&&Object.keys(r.parameters).length){let o=[];Object.keys(r.parameters).forEach(l=>{r.parameters[l]!==void 0?o.push(l+"="+r.parameters[l]):o.push(l)}),n+="a=fmtp:"+i+" "+o.join(";")+`\r
`}return n},t.parseRtcpFb=function(r){let n=r.substring(r.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},t.writeRtcpFb=function(r){let n="",i=r.payloadType;return r.preferredPayloadType!==void 0&&(i=r.preferredPayloadType),r.rtcpFeedback&&r.rtcpFeedback.length&&r.rtcpFeedback.forEach(o=>{n+="a=rtcp-fb:"+i+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),n},t.parseSsrcMedia=function(r){let n=r.indexOf(" "),i={ssrc:parseInt(r.substring(7,n),10)},o=r.indexOf(":",n);return o>-1?(i.attribute=r.substring(n+1,o),i.value=r.substring(o+1)):i.attribute=r.substring(n+1),i},t.parseSsrcGroup=function(r){let n=r.substring(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(i=>parseInt(i,10))}},t.getMid=function(r){let n=t.matchPrefix(r,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(r){let n=r.substring(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1].toUpperCase()}},t.getDtlsParameters=function(r,n){return{role:"auto",fingerprints:t.matchPrefix(r+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(r,n){let i="a=setup:"+n+`\r
`;return r.fingerprints.forEach(o=>{i+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),i},t.parseCryptoLine=function(r){let n=r.substring(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},t.writeCryptoLine=function(r){return"a=crypto:"+r.tag+" "+r.cryptoSuite+" "+(typeof r.keyParams=="object"?t.writeCryptoKeyParams(r.keyParams):r.keyParams)+(r.sessionParams?" "+r.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(r){if(r.indexOf("inline:")!==0)return null;let n=r.substring(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(r){return r.keyMethod+":"+r.keySalt+(r.lifeTime?"|"+r.lifeTime:"")+(r.mkiValue&&r.mkiLength?"|"+r.mkiValue+":"+r.mkiLength:"")},t.getCryptoParameters=function(r,n){return t.matchPrefix(r+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(r,n){let i=t.matchPrefix(r+n,"a=ice-ufrag:")[0],o=t.matchPrefix(r+n,"a=ice-pwd:")[0];return i&&o?{usernameFragment:i.substring(12),password:o.substring(10)}:null},t.writeIceParameters=function(r){let n="a=ice-ufrag:"+r.usernameFragment+`\r
a=ice-pwd:`+r.password+`\r
`;return r.iceLite&&(n+=`a=ice-lite\r
`),n},t.parseRtpParameters=function(r){let n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(r)[0].split(" ");n.profile=i[2];for(let l=3;l<i.length;l++){let u=i[l],h=t.matchPrefix(r,"a=rtpmap:"+u+" ")[0];if(h){let m=t.parseRtpMap(h),_=t.matchPrefix(r,"a=fmtp:"+u+" ");switch(m.parameters=_.length?t.parseFmtp(_[0]):{},m.rtcpFeedback=t.matchPrefix(r,"a=rtcp-fb:"+u+" ").map(t.parseRtcpFb),n.codecs.push(m),m.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(m.name.toUpperCase())}}}t.matchPrefix(r,"a=extmap:").forEach(l=>{n.headerExtensions.push(t.parseExtmap(l))});let o=t.matchPrefix(r,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach(l=>{o.forEach(u=>{l.rtcpFeedback.find(h=>h.type===u.type&&h.parameter===u.parameter)||l.rtcpFeedback.push(u)})}),n},t.writeRtpDescription=function(r,n){let i="";i+="m="+r+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map(l=>l.preferredPayloadType!==void 0?l.preferredPayloadType:l.payloadType).join(" ")+`\r
`,i+=`c=IN IP4 0.0.0.0\r
`,i+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(l=>{i+=t.writeRtpMap(l),i+=t.writeFmtp(l),i+=t.writeRtcpFb(l)});let o=0;return n.codecs.forEach(l=>{l.maxptime>o&&(o=l.maxptime)}),o>0&&(i+="a=maxptime:"+o+`\r
`),n.headerExtensions&&n.headerExtensions.forEach(l=>{i+=t.writeExtmap(l)}),i},t.parseRtpEncodingParameters=function(r){let n=[],i=t.parseRtpParameters(r),o=i.fecMechanisms.indexOf("RED")!==-1,l=i.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(r,"a=ssrc:").map(A=>t.parseSsrcMedia(A)).filter(A=>A.attribute==="cname"),h=u.length>0&&u[0].ssrc,m,_=t.matchPrefix(r,"a=ssrc-group:FID").map(A=>A.substring(17).split(" ").map(D=>parseInt(D,10)));_.length>0&&_[0].length>1&&_[0][0]===h&&(m=_[0][1]),i.codecs.forEach(A=>{if(A.name.toUpperCase()==="RTX"&&A.parameters.apt){let D={ssrc:h,codecPayloadType:parseInt(A.parameters.apt,10)};h&&m&&(D.rtx={ssrc:m}),n.push(D),o&&(D=JSON.parse(JSON.stringify(D)),D.fec={ssrc:h,mechanism:l?"red+ulpfec":"red"},n.push(D))}}),n.length===0&&h&&n.push({ssrc:h});let R=t.matchPrefix(r,"b=");return R.length&&(R=R[0].indexOf("b=TIAS:")===0?parseInt(R[0].substring(7),10):R[0].indexOf("b=AS:")===0?1e3*parseInt(R[0].substring(5),10)*.95-16e3:void 0,n.forEach(A=>{A.maxBitrate=R})),n},t.parseRtcpParameters=function(r){let n={},i=t.matchPrefix(r,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);let o=t.matchPrefix(r,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=o.length===0;let l=t.matchPrefix(r,"a=rtcp-mux");return n.mux=l.length>0,n},t.writeRtcpParameters=function(r){let n="";return r.reducedSize&&(n+=`a=rtcp-rsize\r
`),r.mux&&(n+=`a=rtcp-mux\r
`),r.ssrc!==void 0&&r.cname&&(n+="a=ssrc:"+r.ssrc+" cname:"+r.cname+`\r
`),n},t.parseMsid=function(r){let n,i=t.matchPrefix(r,"a=msid:");if(i.length===1)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};let o=t.matchPrefix(r,"a=ssrc:").map(l=>t.parseSsrcMedia(l)).filter(l=>l.attribute==="msid");return o.length>0?(n=o[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(r){let n=t.parseMLine(r),i=t.matchPrefix(r,"a=max-message-size:"),o;i.length>0&&(o=parseInt(i[0].substring(19),10)),isNaN(o)&&(o=65536);let l=t.matchPrefix(r,"a=sctp-port:");if(l.length>0)return{port:parseInt(l[0].substring(12),10),protocol:n.fmt,maxMessageSize:o};let u=t.matchPrefix(r,"a=sctpmap:");if(u.length>0){let h=u[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:o}}},t.writeSctpDescription=function(r,n){let i=[];return i=r.protocol!=="DTLS/SCTP"?["m="+r.kind+" 9 "+r.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:["m="+r.kind+" 9 "+r.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&i.push("a=max-message-size:"+n.maxMessageSize+`\r
`),i.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(r,n,i){let o,l=n!==void 0?n:2;return o=r||t.generateSessionId(),`v=0\r
o=`+(i||"thisisadapterortc")+" "+o+" "+l+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(r,n){let i=t.splitLines(r);for(let o=0;o<i.length;o++)switch(i[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[o].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(r){return t.splitLines(r)[0].split(" ")[0].substring(2)},t.isRejected=function(r){return r.split(" ",2)[1]==="0"},t.parseMLine=function(r){let n=t.splitLines(r)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(r){let n=t.matchPrefix(r,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(r){if(typeof r!="string"||r.length===0)return!1;let n=t.splitLines(r);for(let i=0;i<n.length;i++)if(n[i].length<2||n[i].charAt(1)!=="=")return!1;return!0},e.exports=t})(cw);var lw=cw.exports,Gm=fe(lw),k4=be({__proto__:null,default:Gm},[lw]);function lS(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;let t=e.RTCIceCandidate;e.RTCIceCandidate=function(r){if(typeof r=="object"&&r.candidate&&r.candidate.indexOf("a=")===0&&((r=JSON.parse(JSON.stringify(r))).candidate=r.candidate.substr(2)),r.candidate&&r.candidate.length){let n=new t(r),i=Gm.parseCandidate(r.candidate),o=Object.assign(n,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(r)},e.RTCIceCandidate.prototype=t.prototype,vp(e,"icecandidate",r=>(r.candidate&&Object.defineProperty(r,"candidate",{value:new e.RTCIceCandidate(r.candidate),writable:"false"}),r))}function iI(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||vp(e,"icecandidate",t=>{if(t.candidate){let r=Gm.parseCandidate(t.candidate.candidate);r.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[r.priority>>24])}return t})}function uS(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});let r=function(u){if(!u||!u.sdp)return!1;let h=Gm.splitSections(u.sdp);return h.shift(),h.some(m=>{let _=Gm.parseMLine(m);return _&&_.kind==="application"&&_.protocol.indexOf("SCTP")!==-1})},n=function(u){let h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;let m=parseInt(h[1],10);return m!=m?-1:m},i=function(u){let h=65536;return t.browser==="firefox"&&(h=t.version<57?u===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),h},o=function(u,h){let m=65536;t.browser==="firefox"&&t.version===57&&(m=65535);let _=Gm.matchPrefix(u.sdp,"a=max-message-size:");return _.length>0?m=parseInt(_[0].substr(19),10):t.browser==="firefox"&&h!==-1&&(m=2147483637),m},l=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){let{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){let u=n(arguments[0]),h=i(u),m=o(arguments[0],u),_;_=h===0&&m===0?Number.POSITIVE_INFINITY:h===0||m===0?Math.max(h,m):Math.min(h,m);let R={};Object.defineProperty(R,"maxMessageSize",{get:()=>_}),this._sctp=R}return l.apply(this,arguments)}}function dS(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(n,i){let o=n.send;n.send=function(){let l=arguments[0],u=l.length||l.size||l.byteLength;if(n.readyState==="open"&&i.sctp&&u>i.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+i.sctp.maxMessageSize+" bytes)");return o.apply(n,arguments)}}let r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){let n=r.apply(this,arguments);return t(n,this),n},vp(e,"datachannel",n=>(t(n.channel,n.target),n))}function aI(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;let t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(r=>{let n=t[r];t[r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=i=>{let o=i.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;let l=new Event("connectionstatechange",i);o.dispatchEvent(l)}return i},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function oI(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;let r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){let i=n.sdp.split(`
`).filter(o=>Ia(o).call(o)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&n instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:n.type,sdp:i}):n.sdp=i}return r.apply(this,arguments)}}function hS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.addIceCandidate;r&&r.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?tr.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),tr.resolve())})}function pS(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;let r=e.RTCPeerConnection.prototype.setLocalDescription;r&&r.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return r.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer"}return n.sdp||n.type!=="offer"&&n.type!=="answer"?r.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(i=>r.apply(this,[i]))})}var M4=Object.freeze({__proto__:null,removeExtmapAllowMixed:oI,shimAddIceCandidateNullOrEmpty:hS,shimConnectionState:aI,shimMaxMessageSize:uS,shimParameterlessSetLocalDescription:pS,shimRTCIceCandidate:lS,shimRTCIceCandidateRelayProtocol:iI,shimSendThrowTypeError:dS});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=RN,n=function(o){let l={browser:null,version:null};if(o===void 0||!o.navigator)return l.browser="Not a browser.",l;let{navigator:u}=o;if(u.mozGetUserMedia)l.browser="firefox",l.version=cS(u.userAgent,/Firefox\/(\d+)\./,1);else if(u.webkitGetUserMedia||o.isSecureContext===!1&&o.webkitRTCPeerConnection)l.browser="chrome",l.version=cS(u.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!o.RTCPeerConnection||!u.userAgent.match(/AppleWebKit\/(\d+)\./))return l.browser="Not a supported browser.",l;l.browser="safari",l.version=cS(u.userAgent,/AppleWebKit\/(\d+)\./,1),l.supportsUnifiedPlan=o.RTCRtpTransceiver&&"currentDirection"in o.RTCRtpTransceiver.prototype}return l}(e),i={browserDetails:n,commonShim:M4,extractVersion:cS,disableLog:v4,disableWarnings:T4,sdp:k4};switch(n.browser){case"chrome":if(!xN||!eI||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(n.version===null)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=xN,hS(e,n),pS(e),ON(e,n),NN(e),eI(e,n),wN(e),MN(e,n),DN(e),PN(e),LN(e),UN(e,n),lS(e),iI(e),aI(e),uS(e,n),dS(e),oI(e,n);break;case"firefox":if(!YN||!tI||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=YN,hS(e,n),pS(e),jN(e,n),tI(e,n),BN(e),GN(e),VN(e),FN(e),HN(e),WN(e),KN(e),zN(e),qN(e),lS(e),aI(e),uS(e,n),dS(e);break;case"safari":if(!iw||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=iw,hS(e,n),pS(e),ew(e),rw(e),ZN(e),XN(e),JN(e),tw(e),QN(e),nw(e),lS(e),iI(e),uS(e,n),dS(e),oI(e,n);break;default:r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var uw=xt,U4=TypeError,dw=Kt.match(/firefox\/(\d+)/i),x4=!!dw&&+dw[1],j4=/MSIE|Trident/.test(Kt),hw=Kt.match(/AppleWebKit\/(\d+)\./),B4=!!hw&&+hw[1],V4=dn,pw=T,F4=te,G4=ct,fw=uc,H4=function(e,t){if(!delete e[t])throw U4("Cannot delete property "+uw(t)+" of "+uw(e))},mw=Va,sI=We,W4=Zy,K4=Fa,Ew=x4,z4=j4,_w=ae,gw=B4,Gd=[],vw=pw(Gd.sort),q4=pw(Gd.push),Y4=sI(function(){Gd.sort(void 0)}),X4=sI(function(){Gd.sort(null)}),J4=K4("sort"),Tw=!sI(function(){if(_w)return _w<70;if(!(Ew&&Ew>3)){if(z4)return!0;if(gw)return gw<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)Gd.push({k:t+n,v:r})}for(Gd.sort(function(o,l){return l.v-o.v}),n=0;n<Gd.length;n++)t=Gd[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return i!=="DGBEFHACIJK"}});V4({target:"Array",proto:!0,forced:Y4||!X4||!J4||!Tw},{sort:function(e){e!==void 0&&F4(e);var t=G4(this);if(Tw)return e===void 0?vw(t):vw(t,e);var r,n,i=[],o=fw(t);for(n=0;n<o;n++)n in t&&q4(i,t[n]);for(W4(i,function(l){return function(u,h){return h===void 0?-1:u===void 0?1:l!==void 0?+l(u,h)||0:mw(u)>mw(h)?1:-1}}(e)),r=fw(i),n=0;n<r;)t[n]=i[n++];for(;n<o;)H4(t,n++);return t}});var Z4=Ba("Array").sort,Q4=v,$4=Z4,cI=Array.prototype,eB=function(e){var t=e.sort;return e===cI||Q4(cI,e)&&t===cI.sort?$4:t},Ng=fe(eB),lI=y;dn({global:!0,forced:lI.globalThis!==lI},{globalThis:lI});var yw=fe(y),uI={exports:{}};(function(e,t){(function(r,n){var i="function",o="undefined",l="object",u="string",h="major",m="model",_="name",R="type",A="vendor",D="version",J="architecture",V="console",K="mobile",se="tablet",ue="smarttv",De="wearable",ze="embedded",Ke="Amazon",Ve="Apple",_t="ASUS",Vt="BlackBerry",ar="Browser",ur="Chrome",Kr="Firefox",zr="Google",wn="Huawei",si="LG",ti="Microsoft",Xa="Motorola",Rt="Opera",Yt="Samsung",fr="Sharp",wt="Sony",B="Xiaomi",Ce="Zebra",ke="Facebook",Ft="Chromium OS",Mr="Mac OS",Dn=function(yi){for(var Mi={},Vn=0;Vn<yi.length;Vn++)Mi[yi[Vn].toUpperCase()]=yi[Vn];return Mi},ki=function(yi,Mi){return typeof yi===u&&lo(Mi).indexOf(lo(yi))!==-1},lo=function(yi){return yi.toLowerCase()},Wu=function(yi,Mi){if(typeof yi===u)return yi=yi.replace(/^\s\s*/,""),typeof Mi===o?yi:yi.substring(0,350)},Jp=function(yi,Mi){for(var Vn,So,ql,ci,sn,uo,uh=0;uh<Mi.length&&!sn;){var zc=Mi[uh],Yx=Mi[uh+1];for(Vn=So=0;Vn<zc.length&&!sn&&zc[Vn];)if(sn=zc[Vn++].exec(yi))for(ql=0;ql<Yx.length;ql++)uo=sn[++So],typeof(ci=Yx[ql])===l&&ci.length>0?ci.length===2?typeof ci[1]==i?this[ci[0]]=ci[1].call(this,uo):this[ci[0]]=ci[1]:ci.length===3?typeof ci[1]!==i||ci[1].exec&&ci[1].test?this[ci[0]]=uo?uo.replace(ci[1],ci[2]):n:this[ci[0]]=uo?ci[1].call(this,uo,ci[2]):n:ci.length===4&&(this[ci[0]]=uo?ci[3].call(this,uo.replace(ci[1],ci[2])):n):this[ci]=uo||n;uh+=2}},Pv=function(yi,Mi){for(var Vn in Mi)if(typeof Mi[Vn]===l&&Mi[Vn].length>0){for(var So=0;So<Mi[Vn].length;So++)if(ki(Mi[Vn][So],yi))return Vn==="?"?n:Vn}else if(ki(Mi[Vn],yi))return Vn==="?"?n:Vn;return yi},u0={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},d0={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[D,[_,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[D,[_,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[_,D],[/opios[\/ ]+([\w\.]+)/i],[D,[_,Rt+" Mini"]],[/\bopr\/([\w\.]+)/i],[D,[_,Rt]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[_,D],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[D,[_,"UC"+ar]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[D,[_,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[D,[_,"WeChat"]],[/konqueror\/([\w\.]+)/i],[D,[_,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[D,[_,"IE"]],[/yabrowser\/([\w\.]+)/i],[D,[_,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[_,/(.+)/,"$1 Secure "+ar],D],[/\bfocus\/([\w\.]+)/i],[D,[_,Kr+" Focus"]],[/\bopt\/([\w\.]+)/i],[D,[_,Rt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[D,[_,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[D,[_,"Dolphin"]],[/coast\/([\w\.]+)/i],[D,[_,Rt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[D,[_,"MIUI "+ar]],[/fxios\/([-\w\.]+)/i],[D,[_,Kr]],[/\bqihu|(qi?ho?o?|360)browser/i],[[_,"360 "+ar]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[_,/(.+)/,"$1 "+ar],D],[/(comodo_dragon)\/([\w\.]+)/i],[[_,/_/g," "],D],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[_,D],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[_],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[_,ke],D],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[_,D],[/\bgsa\/([\w\.]+) .*safari\//i],[D,[_,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[D,[_,ur+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[_,ur+" WebView"],D],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[D,[_,"Android "+ar]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[_,D],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[D,[_,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[D,_],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[_,[D,Pv,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[_,D],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[_,"Netscape"],D],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[D,[_,Kr+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[_,D],[/(cobalt)\/([\w\.]+)/i],[_,[D,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[J,"amd64"]],[/(ia32(?=;))/i],[[J,lo]],[/((?:i[346]|x)86)[;\)]/i],[[J,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[J,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[J,"armhf"]],[/windows (ce|mobile); ppc;/i],[[J,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[J,/ower/,"",lo]],[/(sun4\w)[;\)]/i],[[J,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[J,lo]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[m,[A,Yt],[R,se]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[m,[A,Yt],[R,K]],[/\((ip(?:hone|od)[\w ]*);/i],[m,[A,Ve],[R,K]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[m,[A,Ve],[R,se]],[/(macintosh);/i],[m,[A,Ve]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[m,[A,fr],[R,K]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[m,[A,wn],[R,se]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[m,[A,wn],[R,K]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[m,/_/g," "],[A,B],[R,K]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[m,/_/g," "],[A,B],[R,se]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[m,[A,"OPPO"],[R,K]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[m,[A,"Vivo"],[R,K]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[m,[A,"Realme"],[R,K]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[m,[A,Xa],[R,K]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[m,[A,Xa],[R,se]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[m,[A,si],[R,se]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[m,[A,si],[R,K]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[m,[A,"Lenovo"],[R,se]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[m,/_/g," "],[A,"Nokia"],[R,K]],[/(pixel c)\b/i],[m,[A,zr],[R,se]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[m,[A,zr],[R,K]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[m,[A,wt],[R,K]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[m,"Xperia Tablet"],[A,wt],[R,se]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[m,[A,"OnePlus"],[R,K]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[m,[A,Ke],[R,se]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[m,/(.+)/g,"Fire Phone $1"],[A,Ke],[R,K]],[/(playbook);[-\w\),; ]+(rim)/i],[m,A,[R,se]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[m,[A,Vt],[R,K]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[m,[A,_t],[R,se]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[m,[A,_t],[R,K]],[/(nexus 9)/i],[m,[A,"HTC"],[R,se]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[A,[m,/_/g," "],[R,K]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[m,[A,"Acer"],[R,se]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[m,[A,"Meizu"],[R,K]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[A,m,[R,K]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[A,m,[R,se]],[/(surface duo)/i],[m,[A,ti],[R,se]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[m,[A,"Fairphone"],[R,K]],[/(u304aa)/i],[m,[A,"AT&T"],[R,K]],[/\bsie-(\w*)/i],[m,[A,"Siemens"],[R,K]],[/\b(rct\w+) b/i],[m,[A,"RCA"],[R,se]],[/\b(venue[\d ]{2,7}) b/i],[m,[A,"Dell"],[R,se]],[/\b(q(?:mv|ta)\w+) b/i],[m,[A,"Verizon"],[R,se]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[m,[A,"Barnes & Noble"],[R,se]],[/\b(tm\d{3}\w+) b/i],[m,[A,"NuVision"],[R,se]],[/\b(k88) b/i],[m,[A,"ZTE"],[R,se]],[/\b(nx\d{3}j) b/i],[m,[A,"ZTE"],[R,K]],[/\b(gen\d{3}) b.+49h/i],[m,[A,"Swiss"],[R,K]],[/\b(zur\d{3}) b/i],[m,[A,"Swiss"],[R,se]],[/\b((zeki)?tb.*\b) b/i],[m,[A,"Zeki"],[R,se]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[A,"Dragon Touch"],m,[R,se]],[/\b(ns-?\w{0,9}) b/i],[m,[A,"Insignia"],[R,se]],[/\b((nxa|next)-?\w{0,9}) b/i],[m,[A,"NextBook"],[R,se]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[A,"Voice"],m,[R,K]],[/\b(lvtel\-)?(v1[12]) b/i],[[A,"LvTel"],m,[R,K]],[/\b(ph-1) /i],[m,[A,"Essential"],[R,K]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[m,[A,"Envizen"],[R,se]],[/\b(trio[-\w\. ]+) b/i],[m,[A,"MachSpeed"],[R,se]],[/\btu_(1491) b/i],[m,[A,"Rotor"],[R,se]],[/(shield[\w ]+) b/i],[m,[A,"Nvidia"],[R,se]],[/(sprint) (\w+)/i],[A,m,[R,K]],[/(kin\.[onetw]{3})/i],[[m,/\./g," "],[A,ti],[R,K]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[m,[A,Ce],[R,se]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[m,[A,Ce],[R,K]],[/smart-tv.+(samsung)/i],[A,[R,ue]],[/hbbtv.+maple;(\d+)/i],[[m,/^/,"SmartTV"],[A,Yt],[R,ue]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[A,si],[R,ue]],[/(apple) ?tv/i],[A,[m,Ve+" TV"],[R,ue]],[/crkey/i],[[m,ur+"cast"],[A,zr],[R,ue]],[/droid.+aft(\w)( bui|\))/i],[m,[A,Ke],[R,ue]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[m,[A,fr],[R,ue]],[/(bravia[\w ]+)( bui|\))/i],[m,[A,wt],[R,ue]],[/(mitv-\w{5}) bui/i],[m,[A,B],[R,ue]],[/Hbbtv.*(technisat) (.*);/i],[A,m,[R,ue]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[A,Wu],[m,Wu],[R,ue]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[R,ue]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[A,m,[R,V]],[/droid.+; (shield) bui/i],[m,[A,"Nvidia"],[R,V]],[/(playstation [345portablevi]+)/i],[m,[A,wt],[R,V]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[m,[A,ti],[R,V]],[/((pebble))app/i],[A,m,[R,De]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[m,[A,Ve],[R,De]],[/droid.+; (glass) \d/i],[m,[A,zr],[R,De]],[/droid.+; (wt63?0{2,3})\)/i],[m,[A,Ce],[R,De]],[/(quest( 2| pro)?)/i],[m,[A,ke],[R,De]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[A,[R,ze]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[m,[R,K]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[m,[R,se]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[R,se]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[R,K]],[/(android[-\w\. ]{0,9});.+buil/i],[m,[A,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[D,[_,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[D,[_,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[_,D],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[D,_]],os:[[/microsoft (windows) (vista|xp)/i],[_,D],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[_,[D,Pv,u0]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[_,"Windows"],[D,Pv,u0]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[D,/_/g,"."],[_,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[_,Mr],[D,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[D,_],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[_,D],[/\(bb(10);/i],[D,[_,Vt]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[D,[_,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[D,[_,Kr+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[D,[_,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[D,[_,"watchOS"]],[/crkey\/([\d\.]+)/i],[D,[_,ur+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[_,Ft],D],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[_,D],[/(sunos) ?([\w\.\d]*)/i],[[_,"Solaris"],D],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[_,D]]},Ts=function(yi,Mi){if(typeof yi===l&&(Mi=yi,yi=n),!(this instanceof Ts))return new Ts(yi,Mi).getResult();var Vn=typeof r!==o&&r.navigator?r.navigator:n,So=yi||(Vn&&Vn.userAgent?Vn.userAgent:""),ql=Vn&&Vn.userAgentData?Vn.userAgentData:n,ci=Mi?function(sn,uo){var uh={};for(var zc in sn)uo[zc]&&uo[zc].length%2==0?uh[zc]=uo[zc].concat(sn[zc]):uh[zc]=sn[zc];return uh}(d0,Mi):d0;return this.getBrowser=function(){var sn={};return sn[_]=n,sn[D]=n,Jp.call(sn,So,ci.browser),sn[h]=function(uo){return typeof uo===u?uo.replace(/[^\d\.]/g,"").split(".")[0]:n}(sn[D]),Vn&&Vn.brave&&typeof Vn.brave.isBrave==i&&(sn[_]="Brave"),sn},this.getCPU=function(){var sn={};return sn[J]=n,Jp.call(sn,So,ci.cpu),sn},this.getDevice=function(){var sn={};return sn[A]=n,sn[m]=n,sn[R]=n,Jp.call(sn,So,ci.device),!sn[R]&&ql&&ql.mobile&&(sn[R]=K),sn[m]=="Macintosh"&&Vn&&typeof Vn.standalone!==o&&Vn.maxTouchPoints&&Vn.maxTouchPoints>2&&(sn[m]="iPad",sn[R]=se),sn},this.getEngine=function(){var sn={};return sn[_]=n,sn[D]=n,Jp.call(sn,So,ci.engine),sn},this.getOS=function(){var sn={};return sn[_]=n,sn[D]=n,Jp.call(sn,So,ci.os),!sn[_]&&ql&&ql.platform!="Unknown"&&(sn[_]=ql.platform.replace(/chrome os/i,Ft).replace(/macos/i,Mr)),sn},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return So},this.setUA=function(sn){return So=typeof sn===u&&sn.length>350?Wu(sn,350):sn,this},this.setUA(So),this};Ts.VERSION="0.7.34",Ts.BROWSER=Dn([_,D,h]),Ts.CPU=Dn([J]),Ts.DEVICE=Dn([m,A,R,V,K,ue,se,De,ze]),Ts.ENGINE=Ts.OS=Dn([_,D]),e.exports&&(t=e.exports=Ts),t.UAParser=Ts;var lh=typeof r!==o&&(r.jQuery||r.Zepto);if(lh&&!lh.ua){var Zp=new Ts;lh.ua=Zp.getResult(),lh.ua.get=function(){return Zp.getUA()},lh.ua.set=function(yi){Zp.setUA(yi);var Mi=Zp.getResult();for(var Vn in Mi)lh.ua[Vn]=Mi[Vn]}}})(typeof window=="object"?window:de)})(uI,uI.exports);var tB=fe(uI.exports),rB=Zo,nB=Jt,iB=Tt,aB=jn,oB=mn("iterator"),sB=Object,cB=function(e){if(iB(e))return!1;var t=sB(e);return t[oB]!==void 0||"@@iterator"in t||nB(aB,rB(t))},lB=fe(cB),Sw=_n.clear;dn({global:!0,bind:!0,forced:y.clearImmediate!==Sw},{clearImmediate:Sw});var uB=typeof Bun=="function"&&Bun&&typeof Bun.version=="string",Rw=y,dB=M,hB=ee,pB=uB,fB=Kt,mB=Yh,EB=Sd,_B=Rw.Function,gB=/MSIE .\./.test(fB)||pB&&function(){var e=Rw.Bun.version.split(".");return e.length<3||e[0]==0&&(e[1]<3||e[1]==3&&e[2]==0)}(),vB=dn,Cw=y,Iw=_n.set,TB=function(e,t){var r=1;return gB?function(n,i){var o=EB(arguments.length,1)>r,l=hB(n)?n:_B(n),u=o?mB(arguments,r):[],h=o?function(){dB(l,this,u)}:l;return e(h)}:e},Aw=Cw.setImmediate?TB(Iw):Iw;vB({global:!0,bind:!0,forced:Cw.setImmediate!==Aw},{setImmediate:Aw});var bw=fe(yt.setImmediate),yB=dn,SB=q_,RB=te,CB=Sd,IB=$o,AB=y.process;yB({global:!0,dontCallGetSet:!0},{queueMicrotask:function(e){CB(arguments.length,1),RB(e);var t=IB&&AB.domain;SB(t?t.bind(e):e)}});var Ow=fe(yt.queueMicrotask);function Nw(e,t){return function(){return e.apply(t,arguments)}}let{toString:bB}=Object.prototype,{getPrototypeOf:dI}=Object,fS=(hI=Object.create(null),e=>{let t=bB.call(e);return hI[t]||(hI[t]=t.slice(8,-1).toLowerCase())});var hI;let Lc=e=>(e=e.toLowerCase(),t=>fS(t)===e),mS=e=>t=>typeof t===e,{isArray:Hm}=Array,wg=mS("undefined"),ww=Lc("ArrayBuffer"),OB=mS("string"),us=mS("function"),Dw=mS("number"),ES=e=>e!==null&&typeof e=="object",_S=e=>{if(fS(e)!=="object")return!1;let t=dI(e);return!(t!==null&&t!==Object.prototype&&Object.getPrototypeOf(t)!==null||Symbol.toStringTag in e||lB(e))},NB=Lc("Date"),wB=Lc("File"),DB=Lc("Blob"),PB=Lc("FileList"),LB=Lc("URLSearchParams"),[kB,MB,UB,xB]=["ReadableStream","Request","Response","Headers"].map(Lc);function Dg(e,t){let r,n,{allOwnKeys:i=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),Hm(e))for(r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else{let o=i?Object.getOwnPropertyNames(e):Object.keys(e),l=o.length,u;for(r=0;r<l;r++)u=o[r],t.call(null,e[u],u,e)}}function Pw(e,t){t=t.toLowerCase();let r=Object.keys(e),n,i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}let Tp=yw!==void 0?yw:typeof self<"u"?self:typeof window<"u"?window:global,Lw=e=>!wg(e)&&e!==Tp,jB=(pI=typeof Uint8Array<"u"&&dI(Uint8Array),e=>pI&&e instanceof pI);var pI;let BB=Lc("HTMLFormElement"),kw=(e=>{let{hasOwnProperty:t}=e;return(r,n)=>t.call(r,n)})(Object.prototype),VB=Lc("RegExp"),Mw=(e,t)=>{let r=Object.getOwnPropertyDescriptors(e),n={};Dg(r,(i,o)=>{let l;(l=t(i,o,e))!==!1&&(n[o]=l||i)}),Object.defineProperties(e,n)},fI="abcdefghijklmnopqrstuvwxyz",Uw="0123456789",xw={DIGIT:Uw,ALPHA:fI,ALPHA_DIGIT:fI+fI.toUpperCase()+Uw},FB=Lc("AsyncFunction"),jw=(Bw=typeof bw=="function",Vw=us(Tp.postMessage),Bw?bw:Vw?(mI="axios@".concat(Math.random()),gS=[],Tp.addEventListener("message",e=>{let{source:t,data:r}=e;t===Tp&&r===mI&&gS.length&&gS.shift()()},!1),e=>{gS.push(e),Tp.postMessage(mI,"*")}):e=>setTimeout(e));var Bw,Vw,mI,gS;let GB=Ow!==void 0?Ow.bind(Tp):typeof process<"u"&&process.nextTick||jw;var rr={isArray:Hm,isArrayBuffer:ww,isBuffer:function(e){return e!==null&&!wg(e)&&e.constructor!==null&&!wg(e.constructor)&&us(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let t;return e&&(typeof FormData=="function"&&e instanceof FormData||us(e.append)&&((t=fS(e))==="formdata"||t==="object"&&us(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let t;return t=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&ww(e.buffer),t},isString:OB,isNumber:Dw,isBoolean:e=>e===!0||e===!1,isObject:ES,isPlainObject:_S,isReadableStream:kB,isRequest:MB,isResponse:UB,isHeaders:xB,isUndefined:wg,isDate:NB,isFile:wB,isBlob:DB,isRegExp:VB,isFunction:us,isStream:e=>ES(e)&&us(e.pipe),isURLSearchParams:LB,isTypedArray:jB,isFileList:PB,forEach:Dg,merge:function e(){let{caseless:t}=Lw(this)&&this||{},r={},n=(i,o)=>{let l=t&&Pw(r,o)||o;_S(r[l])&&_S(i)?r[l]=e(r[l],i):_S(i)?r[l]=e({},i):Hm(i)?r[l]=i.slice():r[l]=i};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&Dg(arguments[i],n);return r},extend:function(e,t,r){let{allOwnKeys:n}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Dg(t,(i,o)=>{r&&us(i)?e[o]=Nw(i,r):e[o]=i},{allOwnKeys:n}),e},trim:e=>Ia(e)?Ia(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let i,o,l,u={};if(t=t||{},e==null)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)l=i[o],n&&!n(l,e,t)||u[l]||(t[l]=e[l],u[l]=!0);e=r!==!1&&dI(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:fS,kindOfTest:Lc,endsWith:(e,t,r)=>{e=String(e),(r===void 0||r>e.length)&&(r=e.length),r-=t.length;let n=e.indexOf(t,r);return n!==-1&&n===r},toArray:e=>{if(!e)return null;if(Hm(e))return e;let t=e.length;if(!Dw(t))return null;let r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{let r=(e&&e[Symbol.iterator]).call(e),n;for(;(n=r.next())&&!n.done;){let i=n.value;t.call(e,i[0],i[1])}},matchAll:(e,t)=>{let r,n=[];for(;(r=e.exec(t))!==null;)n.push(r);return n},isHTMLForm:BB,hasOwnProperty:kw,hasOwnProp:kw,reduceDescriptors:Mw,freezeMethods:e=>{Mw(e,(t,r)=>{if(us(e)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;let n=e[r];us(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{let r={},n=i=>{i.forEach(o=>{r[o]=!0})};return Hm(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,r,n){return r.toUpperCase()+n}),noop:()=>{},toFiniteNumber:(e,t)=>e!=null&&Number.isFinite(e=+e)?e:t,findKey:Pw,global:Tp,isContextDefined:Lw,ALPHABET:xw,generateString:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:xw.ALPHA_DIGIT,r="",{length:n}=t;for(;e--;)r+=t[Math.random()*n|0];return r},isSpecCompliantForm:function(e){return!!(e&&us(e.append)&&e[Symbol.toStringTag]==="FormData"&&e[Symbol.iterator])},toJSONObject:e=>{let t=new Array(10),r=(n,i)=>{if(ES(n)){if(t.indexOf(n)>=0)return;if(!("toJSON"in n)){t[i]=n;let o=Hm(n)?[]:{};return Dg(n,(l,u)=>{let h=r(l,i+1);!wg(h)&&(o[u]=h)}),t[i]=void 0,o}}return n};return r(e,0)},isAsyncFn:FB,isThenable:e=>e&&(ES(e)||us(e))&&us(e.then)&&us(e.catch),setImmediate:jw,asap:GB};function gn(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}rr.inherits(gn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:rr.toJSONObject(this.config),code:this.code,status:this.status}}});let Fw=gn.prototype,Gw={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Gw[e]={value:e}}),Object.defineProperties(gn,Gw),Object.defineProperty(Fw,"isAxiosError",{value:!0}),gn.from=(e,t,r,n,i,o)=>{let l=Object.create(Fw);return rr.toFlatObject(e,l,function(u){return u!==Error.prototype},u=>u!=="isAxiosError"),gn.call(l,e.message,t,r,n,i),l.cause=e,l.name=e.name,o&&Object.assign(l,o),l};function EI(e){return rr.isPlainObject(e)||rr.isArray(e)}function Hw(e){return rr.endsWith(e,"[]")?e.slice(0,-2):e}function Ww(e,t,r){return e?e.concat(t).map(function(n,i){return n=Hw(n),!r&&i?"["+n+"]":n}).join(r?".":""):t}let HB=rr.toFlatObject(rr,{},null,function(e){return/^is[A-Z]/.test(e)});function vS(e,t,r){if(!rr.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;let n=(r=rr.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(A,D){return!rr.isUndefined(D[A])})).metaTokens,i=r.visitor||m,o=r.dots,l=r.indexes,u=(r.Blob||typeof Blob<"u"&&Blob)&&rr.isSpecCompliantForm(t);if(!rr.isFunction(i))throw new TypeError("visitor must be a function");function h(A){if(A===null)return"";if(rr.isDate(A))return A.toISOString();if(!u&&rr.isBlob(A))throw new gn("Blob is not supported. Use a Buffer instead.");return rr.isArrayBuffer(A)||rr.isTypedArray(A)?u&&typeof Blob=="function"?new Blob([A]):Buffer.from(A):A}function m(A,D,J){let V=A;if(A&&!J&&typeof A=="object"){if(rr.endsWith(D,"{}"))D=n?D:D.slice(0,-2),A=JSON.stringify(A);else if(rr.isArray(A)&&function(K){return rr.isArray(K)&&!K.some(EI)}(A)||(rr.isFileList(A)||rr.endsWith(D,"[]"))&&(V=rr.toArray(A)))return D=Hw(D),V.forEach(function(K,se){!rr.isUndefined(K)&&K!==null&&t.append(l===!0?Ww([D],se,o):l===null?D:D+"[]",h(K))}),!1}return!!EI(A)||(t.append(Ww(J,D,o),h(A)),!1)}let _=[],R=Object.assign(HB,{defaultVisitor:m,convertValue:h,isVisitable:EI});if(!rr.isObject(e))throw new TypeError("data must be an object");return function A(D,J){if(!rr.isUndefined(D)){if(_.indexOf(D)!==-1)throw Error("Circular reference detected in "+J.join("."));_.push(D),rr.forEach(D,function(V,K){(!(rr.isUndefined(V)||V===null)&&i.call(t,V,rr.isString(K)?Ia(K).call(K):K,J,R))===!0&&A(V,J?J.concat(K):[K])}),_.pop()}}(e),t}function Kw(e){let t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(r){return t[r]})}function _I(e,t){this._pairs=[],e&&vS(e,this,t)}let zw=_I.prototype;function WB(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function qw(e,t,r){if(!t)return e;let n=r&&r.encode||WB;rr.isFunction(r)&&(r={serialize:r});let i=r&&r.serialize,o;if(o=i?i(t,r):rr.isURLSearchParams(t)?t.toString():new _I(t,r).toString(n),o){let l=e.indexOf("#");l!==-1&&(e=e.slice(0,l)),e+=(e.indexOf("?")===-1?"?":"&")+o}return e}zw.append=function(e,t){this._pairs.push([e,t])},zw.toString=function(e){let t=e?function(r){return e.call(this,r,Kw)}:Kw;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};var Yw=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){rr.forEach(this.handlers,function(t){t!==null&&e(t)})}},Xw={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Jw={exports:{}},KB=dn,zB=q,Zw=Ui.f;KB({target:"Object",stat:!0,forced:Object.defineProperty!==Zw,sham:!zB},{defineProperty:Zw});var Qw=yt.Object,qB=Jw.exports=function(e,t,r){return Qw.defineProperty(e,t,r)};Qw.defineProperty.sham&&(qB.sham=!0);var $w=fe(Jw.exports),YB=TypeError,eD=ya,XB=yd,JB=er,ZB=mn("species"),tD=Array,QB=function(e){var t;return eD(e)&&(t=e.constructor,(XB(t)&&(t===tD||eD(t.prototype))||JB(t)&&(t=t[ZB])===null)&&(t=void 0)),t===void 0?tD:t},rD=function(e,t){return new(QB(e))(t===0?0:t)},$B=We,eV=ae,tV=mn("species"),nD=function(e){return eV>=51||!$B(function(){var t=[];return(t.constructor={})[tV]=function(){return{foo:1}},t[e](Boolean).foo!==1})},rV=dn,nV=We,iV=ya,aV=er,oV=ct,sV=uc,iD=function(e){if(e>9007199254740991)throw YB("Maximum allowed index exceeded");return e},aD=ls,cV=rD,lV=nD,uV=ae,oD=mn("isConcatSpreadable"),dV=uV>=51||!nV(function(){var e=[];return e[oD]=!1,e.concat()[0]!==e}),hV=function(e){if(!aV(e))return!1;var t=e[oD];return t!==void 0?!!t:iV(e)};rV({target:"Array",proto:!0,forced:!dV||!lV("concat")},{concat:function(e){var t,r,n,i,o,l=oV(this),u=cV(l,0),h=0;for(t=-1,n=arguments.length;t<n;t++)if(hV(o=t===-1?l:arguments[t]))for(i=sV(o),iD(h+i),r=0;r<i;r++,h++)r in o&&aD(u,h,o[r]);else iD(h+1),aD(u,h++,o);return u.length=h,u}});var sD={},pV=Z,fV=pr,cD=el.f,mV=Dm,lD=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];sD.f=function(e){return lD&&pV(e)=="Window"?function(t){try{return cD(t)}catch{return mV(lD)}}(e):cD(fV(e))};var Wm={},EV=mn;Wm.f=EV;var uD=yt,_V=Jt,gV=Wm,vV=Ui.f,ta=function(e){var t=uD.Symbol||(uD.Symbol={});_V(t,e)||vV(t,e,{value:gV.f(e)})},TV=Oe,yV=Zt,SV=mn,RV=ol,dD=function(){var e=yV("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=SV("toPrimitive");t&&!t[n]&&RV(t,n,function(i){return TV(r,this)},{})},CV=Ea,IV=it,AV=ct,bV=uc,OV=rD;T([].push);var NV=function(e){return function(t,r,n,i){for(var o,l,u=AV(t),h=IV(u),m=CV(r,n),_=bV(h),R=0,A=i||OV,D=void 0;_>R;R++)R in h&&(l=m(o=h[R],R,u));return D}},hD={forEach:NV(0)},TS=dn,gI=y,vI=Oe,wV=T,Km=q,zm=X,DV=We,Da=Jt,PV=v,TI=ui,yS=pr,yI=Tr,LV=Va,SI=dt,Pg=vc,pD=wh,kV=el,fD=sD,MV=$i,mD=H,ED=Ui,UV=rl,_D=ge,gD=ol,xV=vd,RI=xe,vD=id,TD=Yr,jV=mn,BV=Wm,VV=ta,FV=dD,GV=Ps,yD=rs,SS=hD.forEach,Po=Os("hidden"),RS="Symbol",Lg="prototype",HV=yD.set,SD=yD.getterFor(RS),kc=Object[Lg],yp=gI.Symbol,CS=yp&&yp[Lg],WV=gI.TypeError,CI=gI.QObject,RD=mD.f,Sp=ED.f,CD=fD.f,KV=_D.f,ID=wV([].push),Ou=RI("symbols"),kg=RI("op-symbols"),zV=RI("wks"),II=!CI||!CI[Lg]||!CI[Lg].findChild,AI=Km&&DV(function(){return Pg(Sp({},"a",{get:function(){return Sp(this,"a",{value:7}).a}})).a!=7})?function(e,t,r){var n=RD(kc,t);n&&delete kc[t],Sp(e,t,r),n&&e!==kc&&Sp(kc,t,n)}:Sp,bI=function(e,t){var r=Ou[e]=Pg(CS);return HV(r,{type:RS,tag:e,description:t}),Km||(r.description=t),r},IS=function(e,t,r){e===kc&&IS(kg,t,r),TI(e);var n=yI(t);return TI(r),Da(Ou,n)?(r.enumerable?(Da(e,Po)&&e[Po][n]&&(e[Po][n]=!1),r=Pg(r,{enumerable:SI(0,!1)})):(Da(e,Po)||Sp(e,Po,SI(1,{})),e[Po][n]=!0),AI(e,n,r)):Sp(e,n,r)},OI=function(e,t){TI(e);var r=yS(t),n=pD(r).concat(ND(r));return SS(n,function(i){Km&&!vI(AD,r,i)||IS(e,i,r[i])}),e},AD=function(e){var t=yI(e),r=vI(KV,this,t);return!(this===kc&&Da(Ou,t)&&!Da(kg,t))&&(!(r||!Da(this,t)||!Da(Ou,t)||Da(this,Po)&&this[Po][t])||r)},bD=function(e,t){var r=yS(e),n=yI(t);if(r!==kc||!Da(Ou,n)||Da(kg,n)){var i=RD(r,n);return!i||!Da(Ou,n)||Da(r,Po)&&r[Po][n]||(i.enumerable=!0),i}},OD=function(e){var t=CD(yS(e)),r=[];return SS(t,function(n){Da(Ou,n)||Da(vD,n)||ID(r,n)}),r},ND=function(e){var t=e===kc,r=CD(t?kg:yS(e)),n=[];return SS(r,function(i){!Da(Ou,i)||t&&!Da(kc,i)||ID(n,Ou[i])}),n};zm||(yp=function(){if(PV(CS,this))throw WV("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?LV(arguments[0]):void 0,t=TD(e),r=function(n){this===kc&&vI(r,kg,n),Da(this,Po)&&Da(this[Po],t)&&(this[Po][t]=!1),AI(this,t,SI(1,n))};return Km&&II&&AI(kc,t,{configurable:!0,set:r}),bI(t,e)},gD(CS=yp[Lg],"toString",function(){return SD(this).tag}),gD(yp,"withoutSetter",function(e){return bI(TD(e),e)}),_D.f=AD,ED.f=IS,UV.f=OI,mD.f=bD,kV.f=fD.f=OD,MV.f=ND,BV.f=function(e){return bI(jV(e),e)},Km&&xV(CS,"description",{configurable:!0,get:function(){return SD(this).description}})),TS({global:!0,wrap:!0,forced:!zm,sham:!zm},{Symbol:yp}),SS(pD(zV),function(e){VV(e)}),TS({target:RS,stat:!0,forced:!zm},{useSetter:function(){II=!0},useSimple:function(){II=!1}}),TS({target:"Object",stat:!0,forced:!zm,sham:!Km},{create:function(e,t){return t===void 0?Pg(e):OI(Pg(e),t)},defineProperty:IS,defineProperties:OI,getOwnPropertyDescriptor:bD}),TS({target:"Object",stat:!0,forced:!zm},{getOwnPropertyNames:OD}),FV(),GV(yp,RS),vD[Po]=!0;var wD=X&&!!Symbol.for&&!!Symbol.keyFor,qV=dn,YV=Zt,XV=Jt,JV=Va,DD=xe,ZV=wD,NI=DD("string-to-symbol-registry"),QV=DD("symbol-to-string-registry");qV({target:"Symbol",stat:!0,forced:!ZV},{for:function(e){var t=JV(e);if(XV(NI,t))return NI[t];var r=YV("Symbol")(t);return NI[t]=r,QV[r]=t,r}});var $V=dn,e5=Jt,t5=rt,r5=xt,n5=wD,PD=xe("symbol-to-string-registry");$V({target:"Symbol",stat:!0,forced:!n5},{keyFor:function(e){if(!t5(e))throw TypeError(r5(e)+" is not a symbol");if(e5(PD,e))return PD[e]}});var LD=ya,i5=ee,kD=Z,a5=Va,MD=T([].push),o5=dn,UD=Zt,xD=M,s5=Oe,Mg=T,jD=We,BD=ee,VD=rt,FD=Yh,c5=function(e){if(i5(e))return e;if(LD(e)){for(var t=e.length,r=[],n=0;n<t;n++){var i=e[n];typeof i=="string"?MD(r,i):typeof i!="number"&&kD(i)!="Number"&&kD(i)!="String"||MD(r,a5(i))}var o=r.length,l=!0;return function(u,h){if(l)return l=!1,h;if(LD(this))return h;for(var m=0;m<o;m++)if(r[m]===u)return h}}},l5=X,u5=String,Hd=UD("JSON","stringify"),AS=Mg(/./.exec),GD=Mg("".charAt),d5=Mg("".charCodeAt),h5=Mg("".replace),p5=Mg(1 .toString),f5=/[\uD800-\uDFFF]/g,HD=/^[\uD800-\uDBFF]$/,WD=/^[\uDC00-\uDFFF]$/,KD=!l5||jD(function(){var e=UD("Symbol")();return Hd([e])!="[null]"||Hd({a:e})!="{}"||Hd(Object(e))!="{}"}),zD=jD(function(){return Hd("\uDF06\uD834")!=='"\\udf06\\ud834"'||Hd("\uDEAD")!=='"\\udead"'}),m5=function(e,t){var r=FD(arguments),n=c5(t);if(BD(n)||e!==void 0&&!VD(e))return r[1]=function(i,o){if(BD(n)&&(o=s5(n,this,u5(i),o)),!VD(o))return o},xD(Hd,null,r)},E5=function(e,t,r){var n=GD(r,t-1),i=GD(r,t+1);return AS(HD,e)&&!AS(WD,i)||AS(WD,e)&&!AS(HD,n)?"\\u"+p5(d5(e,0),16):e};Hd&&o5({target:"JSON",stat:!0,forced:KD||zD},{stringify:function(e,t,r){var n=FD(arguments),i=xD(KD?m5:Hd,null,n);return zD&&typeof i=="string"?h5(i,f5,E5):i}});var qD=$i,_5=ct;dn({target:"Object",stat:!0,forced:!X||We(function(){qD.f(1)})},{getOwnPropertySymbols:function(e){var t=qD.f;return t?t(_5(e)):[]}}),ta("asyncIterator"),ta("hasInstance"),ta("isConcatSpreadable"),ta("iterator"),ta("match"),ta("matchAll"),ta("replace"),ta("search"),ta("species"),ta("split");var g5=dD;ta("toPrimitive"),g5();var v5=Zt,T5=Ps;ta("toStringTag"),T5(v5("Symbol"),"Symbol"),ta("unscopables"),Ps(y.JSON,"JSON",!0);var y5=yt.Symbol,S5=mn,R5=Ui.f,YD=S5("metadata"),XD=Function.prototype;XD[YD]===void 0&&R5(XD,YD,{value:null}),ta("dispose"),ta("metadata");var C5=y5;ta("asyncDispose");var I5=T,wI=Zt("Symbol"),A5=wI.keyFor,b5=I5(wI.prototype.valueOf),JD=wI.isRegisteredSymbol||function(e){try{return A5(b5(e))!==void 0}catch{return!1}};dn({target:"Symbol",stat:!0},{isRegisteredSymbol:JD});for(var O5=xe,ZD=Zt,N5=T,w5=rt,D5=mn,bS=ZD("Symbol"),QD=bS.isWellKnownSymbol,$D=ZD("Object","getOwnPropertyNames"),P5=N5(bS.prototype.valueOf),e1=O5("wks"),DI=0,t1=$D(bS),L5=t1.length;DI<L5;DI++)try{var r1=t1[DI];w5(bS[r1])&&D5(r1)}catch{}var n1=function(e){if(QD&&QD(e))return!0;try{for(var t=P5(e),r=0,n=$D(e1),i=n.length;r<i;r++)if(e1[n[r]]==t)return!0}catch{}return!1};dn({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:n1}),ta("matcher"),ta("observable"),dn({target:"Symbol",stat:!0},{isRegistered:JD}),dn({target:"Symbol",stat:!0,forced:!0},{isWellKnown:n1}),ta("metadataKey"),ta("patternMatch"),ta("replaceAll");var qm=fe(C5),i1=fe(Wm.f("iterator"));function Ug(e){return Ug=typeof qm=="function"&&typeof i1=="symbol"?function(t){return typeof t}:function(t){return t&&typeof qm=="function"&&t.constructor===qm&&t!==qm.prototype?"symbol":typeof t},Ug(e)}var k5=fe(Wm.f("toPrimitive"));function M5(e){var t=function(r,n){if(Ug(r)!=="object"||r===null)return r;var i=r[k5];if(i!==void 0){var o=i.call(r,n);if(Ug(o)!=="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(r)}(e,"string");return Ug(t)==="symbol"?t:String(t)}function ie(e,t,r){return(t=M5(t))in e?$w(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var a1=fe(mj),U5={isBrowser:!0,classes:{URLSearchParams:a1!==void 0?a1:_I,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};let PI=typeof window<"u"&&typeof document<"u",LI=typeof navigator=="object"&&navigator||void 0,x5=PI&&(!LI||["ReactNative","NativeScript","NS"].indexOf(LI.product)<0),j5=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",B5=PI&&window.location.href||"http://localhost";function o1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function s1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?o1(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var io=s1(s1({},Object.freeze({__proto__:null,hasBrowserEnv:PI,hasStandardBrowserEnv:x5,hasStandardBrowserWebWorkerEnv:j5,navigator:LI,origin:B5})),U5),V5=ui,F5=Oe,G5=Jt,H5=v,W5=function(){var e=V5(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},c1=RegExp.prototype,l1=function(e){var t=e.flags;return t!==void 0||"flags"in c1||G5(e,"flags")||!H5(c1,e)?t:F5(W5,e)},K5=Cl.charAt,u1=Oe,z5=ui,q5=ee,Y5=Z,X5=/./.exec,J5=TypeError,Z5=dn,d1=Oe,h1=F,Q5=zf,OS=Xf,p1=jt,f1=xE,xg=Va,$5=ui,e6=Tt,t6=Z,r6=FE,m1=l1,n6=Ee,i6=We,a6=is,o6=function(e,t,r){return t+(r?K5(e,t).length:1)},s6=function(e,t){var r=e.exec;if(q5(r)){var n=u1(r,e,t);return n!==null&&z5(n),n}if(Y5(e)==="RegExp")return u1(X5,e,t);throw J5("RegExp#exec called on incompatible receiver")},E1=rs,c6=mn("matchAll"),_1="RegExp String",g1=_1+" Iterator",l6=E1.set,u6=E1.getterFor(g1),d6=TypeError,kI=h1("".indexOf),NS=h1("".matchAll),MI=!!NS&&!i6(function(){NS("a",/./)}),h6=Q5(function(e,t,r,n){l6(this,{type:g1,regexp:e,string:t,global:r,unicode:n,done:!1})},_1,function(){var e=u6(this);if(e.done)return OS(void 0,!0);var t=e.regexp,r=e.string,n=s6(t,r);return n===null?(e.done=!0,OS(void 0,!0)):e.global?(xg(n[0])===""&&(t.lastIndex=o6(r,f1(t.lastIndex),e.unicode)),OS(n,!1)):(e.done=!0,OS(n,!1))}),v1=function(e){var t,r,n,i=$5(this),o=xg(e),l=a6(i,RegExp),u=xg(m1(i));return t=new l(l===RegExp?i.source:i,u),r=!!~kI(u,"g"),n=!!~kI(u,"u"),t.lastIndex=f1(i.lastIndex),new h6(t,o,r,n)};Z5({target:"String",proto:!0,forced:MI},{matchAll:function(e){var t,r,n,i,o=p1(this);if(e6(e)){if(MI)return NS(o,e)}else{if(r6(e)&&(t=xg(p1(m1(e))),!~kI(t,"g")))throw d6("`.matchAll` does not allow non-global regexes");if(MI)return NS(o,e);if((n=n6(e,c6))===void 0&&t6(e)=="RegExp"&&(n=v1),n)return d1(n,e,o)}return r=xg(o),i=new RegExp(e,"g"),d1(v1,i,r)}});var p6=Ba("String").matchAll,f6=v,m6=p6,UI=String.prototype,E6=function(e){var t=e.matchAll;return typeof e=="string"||e===UI||f6(UI,e)&&t===UI.matchAll?m6:t},_6=fe(E6);function T1(e){function t(r,n,i,o){let l=r[o++];if(l==="__proto__")return!0;let u=Number.isFinite(+l),h=o>=r.length;return l=!l&&rr.isArray(i)?i.length:l,h?(rr.hasOwnProp(i,l)?i[l]=[i[l],n]:i[l]=n,!u):(i[l]&&rr.isObject(i[l])||(i[l]=[]),t(r,n,i[l],o)&&rr.isArray(i[l])&&(i[l]=function(m){let _={},R=Object.keys(m),A,D=R.length,J;for(A=0;A<D;A++)J=R[A],_[J]=m[J];return _}(i[l])),!u)}if(rr.isFormData(e)&&rr.isFunction(e.entries)){let r={};return rr.forEachEntry(e,(n,i)=>{t(function(o){return _6(rr).call(rr,/\w+|\[(\w*)]/g,o).map(l=>l[0]==="[]"?"":l[1]||l[0])}(n),i,r,0)}),r}return null}let xI={transitional:Xw,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){let r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=rr.isObject(e);if(i&&rr.isHTMLForm(e)&&(e=new FormData(e)),rr.isFormData(e))return n?JSON.stringify(T1(e)):e;if(rr.isArrayBuffer(e)||rr.isBuffer(e)||rr.isStream(e)||rr.isFile(e)||rr.isBlob(e)||rr.isReadableStream(e))return e;if(rr.isArrayBufferView(e))return e.buffer;if(rr.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(l,u){return vS(l,new io.classes.URLSearchParams,Object.assign({visitor:function(h,m,_,R){return io.isNode&&rr.isBuffer(h)?(this.append(m,h.toString("base64")),!1):R.defaultVisitor.apply(this,arguments)}},u))}(e,this.formSerializer).toString();if((o=rr.isFileList(e))||r.indexOf("multipart/form-data")>-1){let l=this.env&&this.env.FormData;return vS(o?{"files[]":e}:e,l&&new l,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(l,u,h){if(rr.isString(l))try{return(u||JSON.parse)(l),Ia(rr).call(rr,l)}catch(m){if(m.name!=="SyntaxError")throw m}return(h||JSON.stringify)(l)}(e)):e}],transformResponse:[function(e){let t=this.transitional||xI.transitional,r=t&&t.forcedJSONParsing,n=this.responseType==="json";if(rr.isResponse(e)||rr.isReadableStream(e))return e;if(e&&rr.isString(e)&&(r&&!this.responseType||n)){let i=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(o){if(i)throw o.name==="SyntaxError"?gn.from(o,gn.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:io.classes.FormData,Blob:io.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};rr.forEach(["delete","get","head","post","put","patch"],e=>{xI.headers[e]={}});var jI=xI;let g6=rr.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),y1=Symbol("internals");function jg(e){var t;return e&&Ia(t=String(e)).call(t).toLowerCase()}function wS(e){return e===!1||e==null?e:rr.isArray(e)?e.map(wS):String(e)}function BI(e,t,r,n,i){return rr.isFunction(n)?n.call(this,t,r):(i&&(t=r),rr.isString(t)?rr.isString(n)?t.indexOf(n)!==-1:rr.isRegExp(n)?n.test(t):void 0:void 0)}class DS{constructor(t){t&&this.set(t)}set(t,r,n){let i=this;function o(h,m,_){let R=jg(m);if(!R)throw new Error("header name must be a non-empty string");let A=rr.findKey(i,R);(!A||i[A]===void 0||_===!0||_===void 0&&i[A]!==!1)&&(i[A||m]=wS(h))}let l=(h,m)=>rr.forEach(h,(_,R)=>o(_,R,m));if(rr.isPlainObject(t)||t instanceof this.constructor)l(t,r);else if(rr.isString(t)&&(t=Ia(t).call(t))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(Ia(u=t).call(u)))l((h=>{let m={},_,R,A;return h&&h.split(`
`).forEach(function(D){var J,V;A=D.indexOf(":"),_=Ia(J=D.substring(0,A)).call(J).toLowerCase(),R=Ia(V=D.substring(A+1)).call(V),!_||m[_]&&g6[_]||(_==="set-cookie"?m[_]?m[_].push(R):m[_]=[R]:m[_]=m[_]?m[_]+", "+R:R)}),m})(t),r);else if(rr.isHeaders(t))for(let[h,m]of t.entries())o(m,h,n);else t!=null&&o(r,t,n);var u;return this}get(t,r){if(t=jg(t)){let n=rr.findKey(this,t);if(n){let i=this[n];if(!r)return i;if(r===!0)return function(o){let l=Object.create(null),u=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g,h;for(;h=u.exec(o);)l[h[1]]=h[2];return l}(i);if(rr.isFunction(r))return r.call(this,i,n);if(rr.isRegExp(r))return r.exec(i);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,r){if(t=jg(t)){let n=rr.findKey(this,t);return!(!n||this[n]===void 0||r&&!BI(0,this[n],n,r))}return!1}delete(t,r){let n=this,i=!1;function o(l){if(l=jg(l)){let u=rr.findKey(n,l);!u||r&&!BI(0,n[u],u,r)||(delete n[u],i=!0)}}return rr.isArray(t)?t.forEach(o):o(t),i}clear(t){let r=Object.keys(this),n=r.length,i=!1;for(;n--;){let o=r[n];t&&!BI(0,this[o],o,t,!0)||(delete this[o],i=!0)}return i}normalize(t){let r=this,n={};return rr.forEach(this,(i,o)=>{var l;let u=rr.findKey(n,o);if(u)return r[u]=wS(i),void delete r[o];let h=t?function(m){return Ia(m).call(m).toLowerCase().replace(/([a-z\d])(\w*)/g,(_,R,A)=>R.toUpperCase()+A)}(o):Ia(l=String(o)).call(l);h!==o&&delete r[o],r[h]=wS(i),n[h]=!0}),this}concat(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.constructor.concat(this,...r)}toJSON(t){let r=Object.create(null);return rr.forEach(this,(n,i)=>{n!=null&&n!==!1&&(r[i]=t&&rr.isArray(n)?n.join(", "):n)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(t=>{let[r,n]=t;return r+": "+n}).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t){let r=new this(t);for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i.forEach(l=>r.set(l)),r}static accessor(t){let r=(this[y1]=this[y1]={accessors:{}}).accessors,n=this.prototype;function i(o){let l=jg(o);r[l]||(function(u,h){let m=rr.toCamelCase(" "+h);["get","set","has"].forEach(_=>{Object.defineProperty(u,_+m,{value:function(R,A,D){return this[_].call(this,h,R,A,D)},configurable:!0})})}(n,o),r[l]=!0)}return rr.isArray(t)?t.forEach(i):i(t),this}}DS.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),rr.reduceDescriptors(DS.prototype,(e,t)=>{let{value:r}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(i){this[n]=i}}}),rr.freezeMethods(DS);var Mc=DS;function VI(e,t){let r=this||jI,n=t||r,i=Mc.from(n.headers),o=n.data;return rr.forEach(e,function(l){o=l.call(r,o,i.normalize(),t?t.status:void 0)}),i.normalize(),o}function S1(e){return!(!e||!e.__CANCEL__)}function Ym(e,t,r){gn.call(this,e??"canceled",gn.ERR_CANCELED,t,r),this.name="CanceledError"}function R1(e,t,r){let n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new gn("Request failed with status code "+r.status,[gn.ERR_BAD_REQUEST,gn.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}rr.inherits(Ym,gn,{__CANCEL__:!0});let PS=function(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=0,i=function(o,l){o=o||10;let u=new Array(o),h=new Array(o),m,_=0,R=0;return l=l!==void 0?l:1e3,function(A){let D=Date.now(),J=h[R];m||(m=D),u[_]=A,h[_]=D;let V=R,K=0;for(;V!==_;)K+=u[V++],V%=o;if(_=(_+1)%o,_===R&&(R=(R+1)%o),D-m<l)return;let se=J&&D-J;return se?Math.round(1e3*K/se):void 0}}(50,250);return function(o,l){let u,h,m=0,_=1e3/l,R=function(A){m=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),u=null,h&&(clearTimeout(h),h=null),o.apply(null,A)};return[function(){let A=Date.now(),D=A-m;for(var J=arguments.length,V=new Array(J),K=0;K<J;K++)V[K]=arguments[K];D>=_?R(V,A):(u=V,h||(h=setTimeout(()=>{h=null,R(u)},_-D)))},()=>u&&R(u)]}(o=>{let l=o.loaded,u=o.lengthComputable?o.total:void 0,h=l-n,m=i(h);n=l,e({loaded:l,total:u,progress:u?l/u:void 0,bytes:h,rate:m||void 0,estimated:m&&u&&l<=u?(u-l)/m:void 0,event:o,lengthComputable:u!=null,[t?"download":"upload"]:!0})},r)},C1=(e,t)=>{let r=e!=null;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},I1=e=>function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return rr.asap(()=>e(...r))};var v6=io.hasStandardBrowserEnv?((e,t)=>r=>(r=new sS(r,io.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new sS(io.origin),io.navigator&&/(msie|trident)/i.test(io.navigator.userAgent)):()=>!0,T6=io.hasStandardBrowserEnv?{write(e,t,r,n,i,o){let l=[e+"="+encodeURIComponent(t)];rr.isNumber(r)&&l.push("expires="+new Date(r).toGMTString()),rr.isString(n)&&l.push("path="+n),rr.isString(i)&&l.push("domain="+i),o===!0&&l.push("secure"),document.cookie=l.join("; ")},read(e){let t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function A1(e,t){return e&&!function(r){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(r)}(t)?function(r,n){return n?r.replace(/\/?\/$/,"")+"/"+n.replace(/^\/+/,""):r}(e,t):t}function b1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}let O1=e=>e instanceof Mc?function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?b1(Object(n),!0).forEach(function(i){ie(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b1(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}({},e):e;function Rp(e,t){t=t||{};let r={};function n(m,_,R,A){return rr.isPlainObject(m)&&rr.isPlainObject(_)?rr.merge.call({caseless:A},m,_):rr.isPlainObject(_)?rr.merge({},_):rr.isArray(_)?_.slice():_}function i(m,_,R,A){return rr.isUndefined(_)?rr.isUndefined(m)?void 0:n(void 0,m,0,A):n(m,_,0,A)}function o(m,_){if(!rr.isUndefined(_))return n(void 0,_)}function l(m,_){return rr.isUndefined(_)?rr.isUndefined(m)?void 0:n(void 0,m):n(void 0,_)}function u(m,_,R){return R in t?n(m,_):R in e?n(void 0,m):void 0}let h={url:o,method:o,data:o,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(m,_,R)=>i(O1(m),O1(_),0,!0)};return rr.forEach(Object.keys(Object.assign({},e,t)),function(m){let _=h[m]||i,R=_(e[m],t[m],m);rr.isUndefined(R)&&_!==u||(r[m]=R)}),r}var N1=e=>{let t=Rp({},e),r,{data:n,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:l,headers:u,auth:h}=t;if(t.headers=u=Mc.from(u),t.url=qw(A1(t.baseURL,t.url),e.params,e.paramsSerializer),h&&u.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):""))),rr.isFormData(n)){if(io.hasStandardBrowserEnv||io.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if((r=u.getContentType())!==!1){let[m,..._]=r?r.split(";").map(R=>Ia(R).call(R)).filter(Boolean):[];u.setContentType([m||"multipart/form-data",..._].join("; "))}}if(io.hasStandardBrowserEnv&&(i&&rr.isFunction(i)&&(i=i(t)),i||i!==!1&&v6(t.url))){let m=o&&l&&T6.read(l);m&&u.set(o,m)}return t},y6=typeof XMLHttpRequest<"u"&&function(e){return new tr(function(t,r){let n=N1(e),i=n.data,o=Mc.from(n.headers).normalize(),l,u,h,m,_,{responseType:R,onUploadProgress:A,onDownloadProgress:D}=n;function J(){m&&m(),_&&_(),n.cancelToken&&n.cancelToken.unsubscribe(l),n.signal&&n.signal.removeEventListener("abort",l)}let V=new XMLHttpRequest;function K(){if(!V)return;let ue=Mc.from("getAllResponseHeaders"in V&&V.getAllResponseHeaders());R1(function(De){t(De),J()},function(De){r(De),J()},{data:R&&R!=="text"&&R!=="json"?V.response:V.responseText,status:V.status,statusText:V.statusText,headers:ue,config:e,request:V}),V=null}V.open(n.method.toUpperCase(),n.url,!0),V.timeout=n.timeout,"onloadend"in V?V.onloadend=K:V.onreadystatechange=function(){V&&V.readyState===4&&(V.status!==0||V.responseURL&&V.responseURL.indexOf("file:")===0)&&setTimeout(K)},V.onabort=function(){V&&(r(new gn("Request aborted",gn.ECONNABORTED,e,V)),V=null)},V.onerror=function(){r(new gn("Network Error",gn.ERR_NETWORK,e,V)),V=null},V.ontimeout=function(){let ue=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded",De=n.transitional||Xw;n.timeoutErrorMessage&&(ue=n.timeoutErrorMessage),r(new gn(ue,De.clarifyTimeoutError?gn.ETIMEDOUT:gn.ECONNABORTED,e,V)),V=null},i===void 0&&o.setContentType(null),"setRequestHeader"in V&&rr.forEach(o.toJSON(),function(ue,De){V.setRequestHeader(De,ue)}),rr.isUndefined(n.withCredentials)||(V.withCredentials=!!n.withCredentials),R&&R!=="json"&&(V.responseType=n.responseType),D&&([h,_]=PS(D,!0),V.addEventListener("progress",h)),A&&V.upload&&([u,m]=PS(A),V.upload.addEventListener("progress",u),V.upload.addEventListener("loadend",m)),(n.cancelToken||n.signal)&&(l=ue=>{V&&(r(!ue||ue.type?new Ym(null,e,V):ue),V.abort(),V=null)},n.cancelToken&&n.cancelToken.subscribe(l),n.signal&&(n.signal.aborted?l():n.signal.addEventListener("abort",l)));let se=function(ue){let De=/^([-+\w]{1,25})(:?\/\/|:)/.exec(ue);return De&&De[1]||""}(n.url);se&&io.protocols.indexOf(se)===-1?r(new gn("Unsupported protocol "+se+":",gn.ERR_BAD_REQUEST,e)):V.send(i||null)})},S6=(e,t)=>{let{length:r}=e=e?e.filter(Boolean):[];if(t||r){let n,i=new AbortController,o=function(m){if(!n){n=!0,u();let _=m instanceof Error?m:this.reason;i.abort(_ instanceof gn?_:new Ym(_ instanceof Error?_.message:_))}},l=t&&setTimeout(()=>{l=null,o(new gn("timeout ".concat(t," of ms exceeded"),gn.ETIMEDOUT))},t),u=()=>{e&&(l&&clearTimeout(l),l=null,e.forEach(m=>{m.unsubscribe?m.unsubscribe(o):m.removeEventListener("abort",o)}),e=null)};e.forEach(m=>m.addEventListener("abort",o));let{signal:h}=i;return h.unsubscribe=()=>rr.asap(u),h}},R6=Ud,C6=js;dn({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var e=C6.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var I6=js,A6=xs;dn({target:"Promise",stat:!0,forced:!0},{try:function(e){var t=I6.f(this),r=A6(e);return(r.error?t.reject:t.resolve)(r.value),t.promise}});var FI=fe(R6),w1=Wm.f("asyncIterator"),b6=fe(w1);function GI(e,t){this.v=e,this.k=t}function Bg(e){var t,r;function n(o,l){try{var u=e[o](l),h=u.value,m=h instanceof GI;FI.resolve(m?h.v:h).then(function(_){if(m){var R=o==="return"?"return":"next";if(!h.k||_.done)return n(R,_);_=e[R](_).value}i(u.done?"return":"normal",_)},function(_){n("throw",_)})}catch(_){i("throw",_)}}function i(o,l){switch(o){case"return":t.resolve({value:l,done:!0});break;case"throw":t.reject(l);break;default:t.resolve({value:l,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(o,l){return new FI(function(u,h){var m={key:o,arg:l,resolve:u,reject:h,next:null};r?r=r.next=m:(t=r=m,n(o,l))})},typeof e.return!="function"&&(this.return=void 0)}function ds(e){return function(){return new Bg(e.apply(this,arguments))}}function Qr(e){return new GI(e,0)}function LS(e){var t={},r=!1;function n(i,o){return r=!0,{done:!1,value:new GI(o=new FI(function(l){l(e[i](o))}),1)}}return t[qm!==void 0&&i1||"@@iterator"]=function(){return this},t.next=function(i){return r?(r=!1,i):n("next",i)},typeof e.throw=="function"&&(t.throw=function(i){if(r)throw r=!1,i;return n("throw",i)}),typeof e.return=="function"&&(t.return=function(i){return r?(r=!1,i):n("return",i)}),t}Bg.prototype[typeof qm=="function"&&b6||"@@asyncIterator"]=function(){return this},Bg.prototype.next=function(e){return this._invoke("next",e)},Bg.prototype.throw=function(e){return this._invoke("throw",e)},Bg.prototype.return=function(e){return this._invoke("return",e)};var HI=fe(w1);function WI(e){var t,r,n,i=2;for(typeof Symbol<"u"&&(r=HI,n=Symbol.iterator);i--;){if(r&&(t=e[r])!=null)return t.call(e);if(n&&(t=e[n])!=null)return new kS(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function kS(e){function t(r){if(Object(r)!==r)return tr.reject(new TypeError(r+" is not an object."));var n=r.done;return tr.resolve(r.value).then(function(i){return{value:i,done:n}})}return kS=function(r){this.s=r,this.n=r.next},kS.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return n===void 0?tr.resolve({value:r,done:!0}):t(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return n===void 0?tr.reject(r):t(n.apply(this.s,arguments))}},new kS(e)}let O6=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let n,i=0;for(;i<r;)n=i+t,yield e.slice(i,n),i=n},N6=function(){var e=ds(function*(t,r){var n,i=!1,o=!1;try{for(var l,u=WI(w6(t));i=!(l=yield Qr(u.next())).done;i=!1){let h=l.value;yield*LS(WI(O6(h,r)))}}catch(h){o=!0,n=h}finally{try{i&&u.return!=null&&(yield Qr(u.return()))}finally{if(o)throw n}}});return function(t,r){return e.apply(this,arguments)}}(),w6=function(){var e=ds(function*(t){if(t[HI])return void(yield*LS(WI(t)));let r=t.getReader();try{for(;;){let{done:n,value:i}=yield Qr(r.read());if(n)break;yield i}}finally{yield Qr(r.cancel())}});return function(t){return e.apply(this,arguments)}}(),D1=(e,t,r,n)=>{let i=N6(e,t),o,l=0,u=h=>{o||(o=!0,n&&n(h))};return new ReadableStream({async pull(h){try{let{done:m,value:_}=await i.next();if(m)return u(),void h.close();let R=_.byteLength;if(r){let A=l+=R;r(A)}h.enqueue(new Uint8Array(_))}catch(m){throw u(m),m}},cancel:h=>(u(h),i.return())},{highWaterMark:2})};function P1(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function L1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?P1(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let MS=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",k1=MS&&typeof ReadableStream=="function",D6=MS&&(typeof TextEncoder=="function"?(M1=new TextEncoder,e=>M1.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var M1;let U1=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return!!e(...r)}catch{return!1}},P6=k1&&U1(()=>{let e=!1,t=new Request(io.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),KI=k1&&U1(()=>rr.isReadableStream(new Response("").body)),US={stream:KI&&(e=>e.body)};var x1;MS&&(x1=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!US[e]&&(US[e]=rr.isFunction(x1[e])?t=>t[e]():(t,r)=>{throw new gn("Response type '".concat(e,"' is not supported"),gn.ERR_NOT_SUPPORT,r)})}));let L6=async(e,t)=>rr.toFiniteNumber(e.getContentLength())??(async n=>n==null?0:rr.isBlob(n)?n.size:rr.isSpecCompliantForm(n)?(await new Request(io.origin,{method:"POST",body:n}).arrayBuffer()).byteLength:rr.isArrayBufferView(n)||rr.isArrayBuffer(n)?n.byteLength:(rr.isURLSearchParams(n)&&(n+=""),rr.isString(n)?(await D6(n)).byteLength:void 0))(t);var k6=MS&&(async e=>{let{url:t,method:r,data:n,signal:i,cancelToken:o,timeout:l,onDownloadProgress:u,onUploadProgress:h,responseType:m,headers:_,withCredentials:R="same-origin",fetchOptions:A}=N1(e);m=m?(m+"").toLowerCase():"text";let D,J=S6([i,o&&o.toAbortSignal()],l),V=J&&J.unsubscribe&&(()=>{J.unsubscribe()}),K;try{if(h&&P6&&r!=="get"&&r!=="head"&&(K=await L6(_,n))!==0){let Ke,Ve=new Request(t,{method:"POST",body:n,duplex:"half"});if(rr.isFormData(n)&&(Ke=Ve.headers.get("content-type"))&&_.setContentType(Ke),Ve.body){let[_t,Vt]=C1(K,PS(I1(h)));n=D1(Ve.body,65536,_t,Vt)}}rr.isString(R)||(R=R?"include":"omit");let se="credentials"in Request.prototype;D=new Request(t,L1(L1({},A),{},{signal:J,method:r.toUpperCase(),headers:_.normalize().toJSON(),body:n,duplex:"half",credentials:se?R:void 0}));let ue=await fetch(D),De=KI&&(m==="stream"||m==="response");if(KI&&(u||De&&V)){let Ke={};["status","statusText","headers"].forEach(ar=>{Ke[ar]=ue[ar]});let Ve=rr.toFiniteNumber(ue.headers.get("content-length")),[_t,Vt]=u&&C1(Ve,PS(I1(u),!0))||[];ue=new Response(D1(ue.body,65536,_t,()=>{Vt&&Vt(),V&&V()}),Ke)}m=m||"text";let ze=await US[rr.findKey(US,m)||"text"](ue,e);return!De&&V&&V(),await new tr((Ke,Ve)=>{R1(Ke,Ve,{data:ze,headers:Mc.from(ue.headers),status:ue.status,statusText:ue.statusText,config:e,request:D})})}catch(se){throw V&&V(),se&&se.name==="TypeError"&&/fetch/i.test(se.message)?Object.assign(new gn("Network Error",gn.ERR_NETWORK,e,D),{cause:se.cause||se}):gn.from(se,se&&se.code,e,D)}});let zI={http:null,xhr:y6,fetch:k6};rr.forEach(zI,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch{}Object.defineProperty(e,"adapterName",{value:t})}});let j1=e=>"- ".concat(e),M6=e=>rr.isFunction(e)||e===null||e===!1;var B1={getAdapter:e=>{e=rr.isArray(e)?e:[e];let{length:t}=e,r,n,i={};for(let o=0;o<t;o++){let l;if(r=e[o],n=r,!M6(r)&&(n=zI[(l=String(r)).toLowerCase()],n===void 0))throw new gn("Unknown adapter '".concat(l,"'"));if(n)break;i[l||"#"+o]=n}if(!n){let o=Object.entries(i).map(l=>{let[u,h]=l;return"adapter ".concat(u," ")+(h===!1?"is not supported by the environment":"is not available in the build")});throw new gn("There is no suitable adapter to dispatch the request "+(t?o.length>1?`since :
`+o.map(j1).join(`
`):" "+j1(o[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return n},adapters:zI};function qI(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Ym(null,e)}function V1(e){return qI(e),e.headers=Mc.from(e.headers),e.data=VI.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),B1.getAdapter(e.adapter||jI.adapter)(e).then(function(t){return qI(e),t.data=VI.call(e,e.transformResponse,t),t.headers=Mc.from(t.headers),t},function(t){return S1(t)||(qI(e),t&&t.response&&(t.response.data=VI.call(e,e.transformResponse,t.response),t.response.headers=Mc.from(t.response.headers))),tr.reject(t)})}let F1="1.7.9",xS={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{xS[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});let G1={};xS.transitional=function(e,t,r){function n(i,o){return"[Axios v"+F1+"] Transitional option '"+i+"'"+o+(r?". "+r:"")}return(i,o,l)=>{if(e===!1)throw new gn(n(o," has been removed"+(t?" in "+t:"")),gn.ERR_DEPRECATED);return t&&!G1[o]&&(G1[o]=!0,console.warn(n(o," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(i,o,l)}},xS.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};var jS={assertOptions:function(e,t,r){if(typeof e!="object")throw new gn("options must be an object",gn.ERR_BAD_OPTION_VALUE);let n=Object.keys(e),i=n.length;for(;i-- >0;){let o=n[i],l=t[o];if(l){let u=e[o],h=u===void 0||l(u,o,e);if(h!==!0)throw new gn("option "+o+" must be "+h,gn.ERR_BAD_OPTION_VALUE)}else if(r!==!0)throw new gn("Unknown option "+o,gn.ERR_BAD_OPTION)}},validators:xS};let Nl=jS.validators,BS=class{constructor(e){this.defaults=e,this.interceptors={request:new Yw,response:new Yw}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;let i=n.stack?n.stack.replace(/^.+\n/,""):"";try{r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}catch{}}throw r}}_request(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},t=Rp(this.defaults,t);let{transitional:r,paramsSerializer:n,headers:i}=t;r!==void 0&&jS.assertOptions(r,{silentJSONParsing:Nl.transitional(Nl.boolean),forcedJSONParsing:Nl.transitional(Nl.boolean),clarifyTimeoutError:Nl.transitional(Nl.boolean)},!1),n!=null&&(rr.isFunction(n)?t.paramsSerializer={serialize:n}:jS.assertOptions(n,{encode:Nl.function,serialize:Nl.function},!0)),jS.assertOptions(t,{baseUrl:Nl.spelling("baseURL"),withXsrfToken:Nl.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&rr.merge(i.common,i[t.method]);i&&rr.forEach(["delete","get","head","post","put","patch","common"],D=>{delete i[D]}),t.headers=Mc.concat(o,i);let l=[],u=!0;this.interceptors.request.forEach(function(D){typeof D.runWhen=="function"&&D.runWhen(t)===!1||(u=u&&D.synchronous,l.unshift(D.fulfilled,D.rejected))});let h=[],m;this.interceptors.response.forEach(function(D){h.push(D.fulfilled,D.rejected)});let _,R=0;if(!u){let D=[V1.bind(this),void 0];for(D.unshift.apply(D,l),D.push.apply(D,h),_=D.length,m=tr.resolve(t);R<_;)m=m.then(D[R++],D[R++]);return m}_=l.length;let A=t;for(R=0;R<_;){let D=l[R++],J=l[R++];try{A=D(A)}catch(V){J.call(this,V);break}}try{m=V1.call(this,A)}catch(D){return tr.reject(D)}for(R=0,_=h.length;R<_;)m=m.then(h[R++],h[R++]);return m}getUri(e){return qw(A1((e=Rp(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}};rr.forEach(["delete","get","head","options"],function(e){BS.prototype[e]=function(t,r){return this.request(Rp(r||{},{method:e,url:t,data:(r||{}).data}))}}),rr.forEach(["post","put","patch"],function(e){function t(r){return function(n,i,o){return this.request(Rp(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}BS.prototype[e]=t(),BS.prototype[e+"Form"]=t(!0)});var VS=BS;class YI{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let r;this.promise=new tr(function(i){r=i});let n=this;this.promise.then(i=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](i);n._listeners=null}),this.promise.then=i=>{let o,l=new tr(u=>{n.subscribe(u),o=u}).then(i);return l.cancel=function(){n.unsubscribe(o)},l},t(function(i,o,l){n.reason||(n.reason=new Ym(i,o,l),r(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;let r=this._listeners.indexOf(t);r!==-1&&this._listeners.splice(r,1)}toAbortSignal(){let t=new AbortController,r=n=>{t.abort(n)};return this.subscribe(r),t.signal.unsubscribe=()=>this.unsubscribe(r),t.signal}static source(){let t;return{token:new YI(function(r){t=r}),cancel:t}}}var U6=YI;let XI={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(XI).forEach(e=>{let[t,r]=e;XI[r]=t});var x6=XI;let va=function e(t){let r=new VS(t),n=Nw(VS.prototype.request,r);return rr.extend(n,VS.prototype,r,{allOwnKeys:!0}),rr.extend(n,r,null,{allOwnKeys:!0}),n.create=function(i){return e(Rp(t,i))},n}(jI);va.Axios=VS,va.CanceledError=Ym,va.CancelToken=U6,va.isCancel=S1,va.VERSION=F1,va.toFormData=vS,va.AxiosError=gn,va.Cancel=va.CanceledError,va.all=function(e){return tr.all(e)},va.spread=function(e){return function(t){return e.apply(null,t)}},va.isAxiosError=function(e){return rr.isObject(e)&&e.isAxiosError===!0},va.mergeConfig=Rp,va.AxiosHeaders=Mc,va.formToJSON=e=>T1(rr.isHTMLForm(e)?new FormData(e):e),va.getAdapter=B1.getAdapter,va.HttpStatusCode=x6,va.default=va;var Ha=va;let j6=()=>{};function Vg(){let e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:j6};return e.promise=new tr((t,r)=>{e.resolve=n=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,t(n),e.value=n)},e.reject=n=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,r(n))}}),e}let FS=new Map,GS=new Map,wl=new Map,Di=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),an=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({}),H1=new tB,Uc=H1.getResult(),JI=null;function $r(e){if(!JI){Uc=H1.getResult();let t=function(u){if(u.engine.name==="Blink"&&u.browser.name!=="WeChat")return an.CHROME;switch(u.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return an.CHROME;case"Safari":case"Mobile Safari":return an.SAFARI;case"Edge":return an.EDGE;case"Firefox":return an.FIREFOX;case"QQ":case"QQBrowser":return an.QQ;case"Opera":return an.OPERA;case"WeChat":return an.WECHAT;default:return u.browser.name||""}}(Uc),r=W1(Uc),n=function(u){return u.os.name==="Windows"?u.os.version?u.os.name+" "+u.os.version:u.os.name:u.os.name||""}(Uc),i=Uc.os.version,o=W1(Uc,!1),l=Uc.device.type;if(!(t&&r&&n&&i))return{name:t,version:r,os:n,osVersion:i,browserVersion:o,deviceType:l};JI={name:t,version:r,os:n,osVersion:i,browserVersion:o,deviceType:l}}return JI}function W1(e){let t,r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return t=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",r?t.split(".")[0]:t}function HS(){return $r().os}function K1(){let e=$r();return"".concat(e.os," ").concat(e.osVersion)}function WS(){let e=$r();return!!(Uc.engine.name==="WebKit"&&e.os===Di.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==an.SAFARI||Pa()&&e.name!==an.SAFARI)}function Nu(){return $r().name===an.CHROME}function ra(){return $r().name===an.SAFARI}function z1(){return $r().name===an.EDGE}function Yn(){return $r().name===an.FIREFOX}function Pa(){return $r().os===Di.IOS}function Fg(e){let t=$r();return!(t.name!==an.CHROME||!t.osVersion)&&Number(t.version)>=e}function q1(e){let t=$r();return!(t.name!==an.CHROME||!t.osVersion)&&Number(t.version)<e}function ZI(e,t,r){let n=$r();return!(n.name!==e||!n.osVersion)&&(r?Number(n.version)>=t&&Number(n.version)<=r:Number(n.version)===t)}function QI(e){let t=$r();return!(t.name!==an.EDGE||!t.osVersion)&&Number(t.version)>=e}function Y1(e){let t=$r();return!(t.name!==an.SAFARI||!t.osVersion)&&Number(t.version)>=e}function X1(e,t,r){let n=$r();if(n.os!==Di.IOS||!n.osVersion)return!1;let i=n.osVersion.split(".");return t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e}function J1(e,t,r){let n=$r();if(n.name!==an.SAFARI||!n.osVersion||!n.browserVersion)return!1;let i=n.browserVersion.split(".");return r?t&&Number(i[0])===e&&Number(i[1])<t||Number(i[0])<e:t?Number(i[0])===e&&Number(i[1])<=t||Number(i[0])<e:Number(i[0])<=e}function $I(e){let t=$r();return!(t.name!==an.OPERA||!t.osVersion)&&Number(t.version)>=e}function Z1(){let e=$r();if(e.os!==Di.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Xm(){let e=$r();if(e.os!==Di.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15}function eA(){let e=$r();if(e.os!==Di.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===16}function Q1(){let e=$r();if(e.os!==Di.IOS||!e.osVersion)return!1;let t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function zs(){return ra()&&navigator.maxTouchPoints>0}function $1(){return $r().name===an.WECHAT}function eP(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function tA(){let e=HS();return function(){let{deviceType:t}=$r();return t==="mobile"||t==="tablet"}()||e===Di.ANDROID||e===Di.IOS||e===Di.HARMONY_OS}function wu(){let e=$r();return e.name!==an.EDGE&&e.name!==an.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function KS(){return HS()===Di.ANDROID}function Gg(){let e=$r();return KS()&&(e.name===an.CHROME||e.name===an.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function tP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function cr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tP(Object(r),!0).forEach(function(n){kr(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kr(e,t,r){return(t=function(n){var i=function(o,l){if(typeof o!="object"||o===null)return o;var u=o[Symbol.toPrimitive];if(u!==void 0){var h=u.call(o,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(n);return typeof i=="symbol"?i:String(i)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let ce=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),Et=class extends Error{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(t),kr(this,"code",void 0),kr(this,"message",void 0),kr(this,"data",void 0),kr(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=r}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",t=arguments.length>1?arguments[1]:void 0;return e==="error"&&(t||console).error(this.toString()),e==="warning"&&(t||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function Du(e,t){if(typeof e!="boolean")throw new Et(ce.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function bi(e,t,r){if(!Qt(r).call(r,e))throw new Et(ce.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(r)))}function vn(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<r||e>n||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(i){return typeof i=="number"&&i%1==0}(e))throw new Et(ce.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(r,", ").concat(n,"]. integer only"))}function rA(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new Et(ce.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&vn(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&vn(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&vn(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&vn(e.ideal,"".concat(t,".ideal"),1,1/0)}else vn(e,t,1,1/0)}function qi(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,i=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new Et(ce.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!rP(e,r,n,i))throw new Et(ce.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(r,",").concat(n,"].").concat(i?" ASCII characters only.":""))}function Pu(e,t){if(!Array.isArray(e))throw new Et(ce.INVALID_PARAMS,"".concat(t," should be an array"))}function Xn(e){return e==null}function rP(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,n=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=r&&e.length>=t&&(!n||function(i){if(typeof i!="string")return!1;for(let o=0;o<i.length;o+=1){let l=i.charCodeAt(o);if(l<0||l>255)return!1}return!0}(e))}var Hg=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(Hg||{}),nA=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(nA||{});let nP=new class{constructor(){kr(this,"_clientSize",null),kr(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),kr(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),kr(this,"getStyle",e=>window.getComputedStyle(e,null)),kr(this,"checkCssVisibleProperty",e=>{var t;let r=!0,n=this.getStyle(e),{display:i,visibility:o,opacity:l,filter:u}=n;return(i==="none"||Qt(t=["hidden","collapse"]).call(t,o)||Number(l)<.1)&&(r=!1),!!r&&(u&&u.split(" ").filter(h=>{var m;let _=h.split("(")[0];return Qt(m=["brightness","blur","opacity"]).call(m,_)}).map(h=>{let[m,_]=h.split(/\(|\)/);return[m,Number(_.match(/^[0-9\.]+/))]}).forEach(h=>{let[m,_]=h;switch(m){case"brightness":(_<.1||_>3)&&(r=!1);break;case"blur":_>3&&(r=!1);break;case"opacity":_<.1&&(r=!1)}}),r)}),kr(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let r=!0,n=!0,i=l=>t(l),o=e;for(;o&&n;)i(o)||(r=!1,n=!1),o=o.parentElement,o||(n=!1);return r}),kr(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),kr(this,"getSizeAboutClient",e=>{let{width:t,height:r,left:n,right:i,top:o,bottom:l}=e.getBoundingClientRect(),u=this.getClientWidth(),h=this.getClientHeight();return{width:t,height:r,left:n,right:i,top:o,bottom:l,clientWidth:u,clientHeight:h,clientMin:Math.min(u,h)}}),kr(this,"checkActualSize",()=>{let{width:e,height:t,clientMin:r}=this._clientSize;return this.checkSizeIsVisible(e,t,r)}),kr(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),kr(this,"checkCoverForAPoint",(e,t,r)=>{let n=this.elementFromPoint(e,t);return n!==null&&n!==r}),kr(this,"getPointPositionList",()=>{let{width:e,height:t,left:r,top:n}=this._clientSize,i=e/6,o=t/6,l=[],u=10**6;for(let h=0;h<5;h++)for(let m=0;m<5;m++){let _=(r*u+(h===0?.1:h===4?(i*h*u-1e5)/u:i*h)*u)/u,R=(n*u+(m===0?.1:m===4?(o*m*u-1e5)/u:o*m)*u)/u;l.push({x:_,y:R})}return[...l]}),kr(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),kr(this,"checkSizeIsVisible",(e,t,r)=>(e>50||r/e<=10)&&(t>50||r/t<=10)),kr(this,"checkSizeOfPartInClient",()=>{let{left:e,right:t,top:r,bottom:n,clientHeight:i,clientWidth:o,clientMin:l}=this._clientSize,u,h,m,_;if(e<0)u=0;else{if(!(e<o))return!1;u=e}if(t<0)return!1;if(h=t<o?t:o,r<0)m=0;else{if(!(r<i))return!1;m=r}if(n<0)return!1;_=n<i?n:i;let R=h-u,A=_-m;return this.checkSizeIsVisible(R,A,l)}),kr(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),kr(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Hg.COVERED);{let t=this.checkActualSize(),r=this.checkSizeOfPartInClient();return t&&!r?this.returnHiddenResult(Hg.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Hg.SIZE)}}return this.returnHiddenResult(Hg.STYLE)}return this.returnHiddenResult(nA.UNMOUNTED)}return this.returnHiddenResult(nA.INVALID_HTML_ELEMENT)}),kr(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function iA(e){return new TextEncoder().encode(e)}let iP=function(e,t){let r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e),0),r.set(new Uint8Array(t),e.byteLength),r},aA=async e=>function(t,r){let n="";return new Uint8Array(t).forEach(i=>{n+=i.toString(r).padStart(2,"0")}),n}(await crypto.subtle.digest("SHA-256",iA(e)),16),zn=class{constructor(){kr(this,"_events",{}),kr(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map(t=>t.listener):[]}on(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);let r=this._events[e];this._indexOfListener(r,t)===-1&&r.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;let r=this._events[e],n=this._indexOfListener(r,t);n!==-1&&r.splice(n,1),this._events[e].length===0&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);let t=this._events[e].map(o=>o);for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(let o=0;o<t.length;o+=1){let l=t[o];l.once&&this.off(e,l.listener),l.listener.apply(this,n||[])}}safeEmit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];[...this._events[e]||[]].forEach(i=>{i.once&&this.off(e,i.listener);try{i.listener.apply(this,r)}catch(o){console.error("safeEmit event:".concat(e," error ").concat(o?.toString()))}})}_indexOfListener(e,t){let r=e.length;for(;r--;)if(e[r].listener===t)return r;return-1}},Wg=null;function aP(){if(Wg)return Wg;if(window.electron)return Wg=window.electron;if(!window.require)return null;try{return Wg=window.require("electron"),Wg}catch{return null}}let gi=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e}({}),Jn=function(e){return e.TRACER="tracer",e}({});function oP(e){return vn(e.timeout,"config.timeout",0,1e5),vn(e.timeoutFactor,"config.timeoutFactor",0,100,!1),vn(e.maxRetryCount,"config.maxRetryConfig",0,1/0),vn(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let B6=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),cn=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function Kg(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function sP(e){return qi(e.turnServerURL,"turnServerURL"),qi(e.username,"username"),qi(e.password,"password"),e.udpport&&vn(e.udpport,"udpport",1,99999,!0),e.forceturn&&Du(e.forceturn,"forceturn"),e.security&&Du(e.security,"security"),e.tcpport&&vn(e.tcpport,"tcpport",1,99999,!0),!0}function oA(e){return e.level!==void 0&&bi(e.level,"level",[1,2,3]),e.delay!==void 0&&vn(e.delay,"delay",0,3e3,!0),!0}let Gr=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),na=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),To=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),Jm=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function ia(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return e.getListeners(t).length===0?tr.reject(new Et(ce.UNEXPECTED_ERROR,"can not emit promise")):new tr((o,l)=>{e.emit(t,...n,o,l)})}function bn(e,t){if(e.getListeners(t).length===0)return tr.resolve();for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return ia(e,t,...n)}function Lo(e,t){if(e.getListeners(t).length===0)return null;for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];return zg(e,t,...n)}function zg(e,t){let r=null,n=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),l=2;l<i;l++)o[l-2]=arguments[l];if(e.emit(t,...o,u=>{r=u},u=>{n=u}),n!==null)throw n;if(r===null)throw new Et(ce.UNEXPECTED_ERROR,"handler is not sync");return r}let pi=new class extends zn{set networkState(e){this.emit(Jm.NETWORK_STATE_CHANGE,e,this._networkState),e===To.ONLINE?this.emit(Jm.ONLINE):e===To.OFFLINE&&(this.onlineWaiter=new tr(t=>{this.once(Jm.ONLINE,()=>{this.onlineWaiter=void 0,t(To.ONLINE)})}),this.emit(Jm.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===To.ONLINE}constructor(){super(),kr(this,"_moduleName","network-indicator"),kr(this,"_networkState",To.ONLINE),kr(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=To.ONLINE}),window.addEventListener("offline",()=>{this.networkState=To.OFFLINE})}};function zS(e,t){let r=e.indexOf(t);r!==-1&&e.splice(r,1)}function Zm(e){let t=[];return e.forEach(r=>{t.indexOf(r)===-1&&t.push(r)}),t}function qS(e){tr!==void 0?tr.resolve().then(e):setTimeout(e,0)}function Zn(e){return JSON.parse(JSON.stringify(e))}function Cp(e){try{return Zn(e)}catch{return e}}let cP={};function Wd(e,t){cP[t]||(cP[t]=!0,e())}function Ip(e){let t=window.atob(e),r=new Uint8Array(new ArrayBuffer(t.length));for(let n=0;n<t.length;n+=1)r[n]=t.charCodeAt(n);return r}function Kd(e){let t="";for(let r=0;r<e.length;r+=1)t+=String.fromCharCode(e[r]);return window.btoa(t)}function lP(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,r=new TextEncoder().encode(e);if(r.length>t)r=r.slice(0,t);else if(r.length<t){let n=new Uint8Array(t);n.set(r),r=n}return r}function uP(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=wa(t).call(t,(l,u)=>l+u.length,0),i=new Uint8Array(new ArrayBuffer(n)),o=0;return t.forEach(l=>{i.set(l,o),o+=l.length}),i}function Dl(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function dP(e){let t=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(r=>{t+=typeof r=="string"?Dl(r):r.size}),t+138}function V6(e){let t=new Et(ce.TIMEOUT,"timeout");return new tr((r,n)=>{window.setTimeout(()=>n(t),e)})}function Yi(e){return new tr(t=>{window.setTimeout(t,e)})}function On(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0,r=Math.random().toString(16).substr(2,e).toLowerCase();return r.length===e?"".concat(t).concat(r):"".concat(t).concat(r)+On(e-r.length,"")}function Ap(){return On(32,"").toUpperCase()}let YS=()=>{},hP=new class{constructor(){kr(this,"fnMap",new Map)}throttleByKey(e,t,r,n){for(var i=arguments.length,o=new Array(i>4?i-4:0),l=4;l<i;l++)o[l-4]=arguments[l];if(this.fnMap.has(t)){let u=this.fnMap.get(t);if(u.threshold!==r){u.fn(...u.args),clearTimeout(u.timer);let h=window.setTimeout(()=>{let m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:h,args:o,skipFn:n})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(t,cr(cr({},u),{},{fn:e,args:o,skipFn:n}))}else{let u=window.setTimeout(()=>{let h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},r);this.fnMap.set(t,{fn:e,threshold:r,timer:u,args:o,skipFn:n})}}},pP=hP.throttleByKey.bind(hP);function fP(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function sA(e,t){if(!fP(e)||!fP(t)||Array.isArray(e)&&!Array.isArray(t)||!Array.isArray(e)&&Array.isArray(t))return t;if(Array.isArray(t)&&Array.isArray(e)){let r=[...e];for(let n=0;n<t.length;n++)r[n]=sA(e[n],t[n]);return r}{let r=cr({},e);for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(Object.prototype.hasOwnProperty.call(e,n)?r[n]=sA(e[n],t[n]):r[n]=t[n]);return r}}function mP(e,t){let r=[0];if(r=new Array(t).fill(0),e===0)return r;let n=0;for(;e>0&&(r[n]=255&e,e>>=8,n++,n!==t););return r}function cA(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function EP(e){let t="0123456789abcdef";function r(De){let ze,Ke="";for(ze=0;ze<=3;ze++)Ke+=t.charAt(De>>8*ze+4&15)+t.charAt(De>>8*ze&15);return Ke}function n(De,ze){let Ke=(65535&De)+(65535&ze);return(De>>16)+(ze>>16)+(Ke>>16)<<16|65535&Ke}function i(De,ze,Ke,Ve,_t,Vt){return n(function(ar,ur){return ar<<ur|ar>>>32-ur}(n(n(ze,De),n(Ve,Vt)),_t),Ke)}function o(De,ze,Ke,Ve,_t,Vt,ar){return i(ze&Ke|~ze&Ve,De,ze,_t,Vt,ar)}function l(De,ze,Ke,Ve,_t,Vt,ar){return i(ze&Ve|Ke&~Ve,De,ze,_t,Vt,ar)}function u(De,ze,Ke,Ve,_t,Vt,ar){return i(ze^Ke^Ve,De,ze,_t,Vt,ar)}function h(De,ze,Ke,Ve,_t,Vt,ar){return i(Ke^(ze|~Ve),De,ze,_t,Vt,ar)}let m=function(De){let ze,Ke=1+(De.length+8>>6),Ve=new Array(16*Ke);for(ze=0;ze<16*Ke;ze++)Ve[ze]=0;for(ze=0;ze<De.length;ze++)Ve[ze>>2]|=De.charCodeAt(ze)<<ze%4*8;return Ve[ze>>2]|=128<<ze%4*8,Ve[16*Ke-2]=8*De.length,Ve}(e),_,R,A,D,J,V=1732584193,K=-271733879,se=-1732584194,ue=271733878;for(_=0;_<m.length;_+=16)R=V,A=K,D=se,J=ue,V=o(V,K,se,ue,m[_+0],7,-680876936),ue=o(ue,V,K,se,m[_+1],12,-389564586),se=o(se,ue,V,K,m[_+2],17,606105819),K=o(K,se,ue,V,m[_+3],22,-1044525330),V=o(V,K,se,ue,m[_+4],7,-176418897),ue=o(ue,V,K,se,m[_+5],12,1200080426),se=o(se,ue,V,K,m[_+6],17,-1473231341),K=o(K,se,ue,V,m[_+7],22,-45705983),V=o(V,K,se,ue,m[_+8],7,1770035416),ue=o(ue,V,K,se,m[_+9],12,-1958414417),se=o(se,ue,V,K,m[_+10],17,-42063),K=o(K,se,ue,V,m[_+11],22,-1990404162),V=o(V,K,se,ue,m[_+12],7,1804603682),ue=o(ue,V,K,se,m[_+13],12,-40341101),se=o(se,ue,V,K,m[_+14],17,-1502002290),K=o(K,se,ue,V,m[_+15],22,1236535329),V=l(V,K,se,ue,m[_+1],5,-165796510),ue=l(ue,V,K,se,m[_+6],9,-1069501632),se=l(se,ue,V,K,m[_+11],14,643717713),K=l(K,se,ue,V,m[_+0],20,-373897302),V=l(V,K,se,ue,m[_+5],5,-701558691),ue=l(ue,V,K,se,m[_+10],9,38016083),se=l(se,ue,V,K,m[_+15],14,-660478335),K=l(K,se,ue,V,m[_+4],20,-405537848),V=l(V,K,se,ue,m[_+9],5,568446438),ue=l(ue,V,K,se,m[_+14],9,-1019803690),se=l(se,ue,V,K,m[_+3],14,-187363961),K=l(K,se,ue,V,m[_+8],20,1163531501),V=l(V,K,se,ue,m[_+13],5,-1444681467),ue=l(ue,V,K,se,m[_+2],9,-51403784),se=l(se,ue,V,K,m[_+7],14,1735328473),K=l(K,se,ue,V,m[_+12],20,-1926607734),V=u(V,K,se,ue,m[_+5],4,-378558),ue=u(ue,V,K,se,m[_+8],11,-2022574463),se=u(se,ue,V,K,m[_+11],16,1839030562),K=u(K,se,ue,V,m[_+14],23,-35309556),V=u(V,K,se,ue,m[_+1],4,-1530992060),ue=u(ue,V,K,se,m[_+4],11,1272893353),se=u(se,ue,V,K,m[_+7],16,-155497632),K=u(K,se,ue,V,m[_+10],23,-1094730640),V=u(V,K,se,ue,m[_+13],4,681279174),ue=u(ue,V,K,se,m[_+0],11,-358537222),se=u(se,ue,V,K,m[_+3],16,-722521979),K=u(K,se,ue,V,m[_+6],23,76029189),V=u(V,K,se,ue,m[_+9],4,-640364487),ue=u(ue,V,K,se,m[_+12],11,-421815835),se=u(se,ue,V,K,m[_+15],16,530742520),K=u(K,se,ue,V,m[_+2],23,-995338651),V=h(V,K,se,ue,m[_+0],6,-198630844),ue=h(ue,V,K,se,m[_+7],10,1126891415),se=h(se,ue,V,K,m[_+14],15,-1416354905),K=h(K,se,ue,V,m[_+5],21,-57434055),V=h(V,K,se,ue,m[_+12],6,1700485571),ue=h(ue,V,K,se,m[_+3],10,-1894986606),se=h(se,ue,V,K,m[_+10],15,-1051523),K=h(K,se,ue,V,m[_+1],21,-2054922799),V=h(V,K,se,ue,m[_+8],6,1873313359),ue=h(ue,V,K,se,m[_+15],10,-30611744),se=h(se,ue,V,K,m[_+6],15,-1560198380),K=h(K,se,ue,V,m[_+13],21,1309151649),V=h(V,K,se,ue,m[_+4],6,-145523070),ue=h(ue,V,K,se,m[_+11],10,-1120210379),se=h(se,ue,V,K,m[_+2],15,718787259),K=h(K,se,ue,V,m[_+9],21,-343485551),V=n(V,R),K=n(K,A),se=n(se,D),ue=n(ue,J);return r(V)+r(K)+r(se)+r(ue)}let F6=1,_P=console,da=class{static setLogger(e){_P=e}constructor(e,t){kr(this,"id",void 0),kr(this,"lockingPromise",tr.resolve()),kr(this,"locks",0),kr(this,"name",""),kr(this,"lockId",void 0),this.lockId=F6++,e&&(this.name=e),t&&(this.id=t),this.logger("created")}logger(e,t){let r=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),n=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(t??"");_P.debug("".concat(r," ").concat(n))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,this.logger("locked",e);let r=new tr(i=>{t=()=>{this.locks-=1,this.logger("unlocked",e),i()}}),n=this.lockingPromise.then(()=>t);return this.lockingPromise=this.lockingPromise.then(()=>r),n}};function Qm(e,t){return function(r,n,i){let o=i.value;if(typeof o!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){let l=this[t];if(!l)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));let u=await l.lock("From ".concat(e,".").concat(n));try{for(var h=arguments.length,m=new Array(h),_=0;_<h;_++)m[_]=arguments[_];return await o.apply(this,m)}finally{u()}},i}}let vi={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function lA(e,t){let r=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,r)}function xc(e,t,r,n){let i=Object.assign({},vi,n),o=i.timeout,l=async()=>{await function(m){return new tr(_=>{window.setTimeout(_,m)})}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)},u=!1,h=new tr(async(m,_)=>{t=t||(()=>!1),r=r||(()=>!0);for(let R=0;R<i.maxRetryCount;R+=1){if(u)return _(new Et(ce.OPERATION_ABORTED));try{let A=await e();if(!t(A,R)||R+1===i.maxRetryCount)return m(A);await l()}catch(A){if(!r(A,R)||R+1===i.maxRetryCount)return _(A);await l()}}});return h.cancel=()=>u=!0,h}let XS,gP=class{constructor(e){kr(this,"input",[]),kr(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:wa(e=this.input).call(e,(t,r)=>t+r)/this.input.length}},JS=0,uA=0;function dA(e,t,r,n){return new tr((i,o)=>{t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),JS+=Dl(t.data)):r&&(t.data.size?JS+=t.data.size:t.data instanceof FormData?JS+=dP(t.data):JS+=Dl(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ha.request(t).then(l=>{typeof l.data=="string"?uA+=Dl(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?uA+=l.data.byteLength:uA+=Dl(JSON.stringify(l.data)),i(l.data)}).catch(l=>{Ha.isCancel(l)?o(new Et(ce.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?o(new Et(ce.NETWORK_TIMEOUT,l.message)):l.response?o(new Et(ce.NETWORK_RESPONSE_ERROR,l.response.status)):o(new Et(ce.NETWORK_ERROR,l.message))})})}async function G6(e,t){let r=new Blob([t.data],{type:"buffer"});return await dA(e,cr(cr({},t),{},{data:r,headers:{"Content-Type":"application/octet-stream"}}),!0)}let vP=()=>window.isSecureContext!==void 0;function qs(e){if(Array.isArray(e))return e.map(r=>r);if(!TP(e))return e;let t={};for(let r in e){let n=e[r];TP(n)||Array.isArray(n)?t[r]=qs(n):t[r]=n}return t}function TP(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let hA=class{constructor(e){kr(this,"input",[]),kr(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}},Pl={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},qg={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:Pl,remoteCandidate:Pl},updateInterval:0},yP={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},SP={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},RP={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},CP={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0},pA=class{constructor(e,t){kr(this,"onFirstVideoReceived",void 0),kr(this,"onFirstVideoDecoded",void 0),kr(this,"onFirstAudioReceived",void 0),kr(this,"onFirstVideoDecodedTimeout",void 0),kr(this,"onFirstAudioDecoded",void 0),kr(this,"onSelectedLocalCandidateChanged",void 0),kr(this,"onSelectedRemoteCandidateChanged",void 0),kr(this,"videoIsReady",!1),kr(this,"videoIsReady2",{}),kr(this,"pc",void 0),kr(this,"options",void 0),kr(this,"intervalTimer",void 0),kr(this,"stats",qs(qg)),kr(this,"isFirstVideoReceived",{}),kr(this,"isFirstVideoDecoded",{}),kr(this,"isFirstAudioReceived",{}),kr(this,"isFirstAudioDecoded",{}),kr(this,"isFirstVideoDecodedTimeout",{}),kr(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new tr(e=>{e({local:cr({},Pl),remote:cr({},Pl)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);let t=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"],n=0,i=0,o=0,l=0;for(let u of r)e[u].forEach((h,m)=>{if(!this.lossRateWindowStats[t-1][u][m]||!this.lossRateWindowStats[0][u][m])return;let _=this.lossRateWindowStats[t-1][u][m].packets-this.lossRateWindowStats[0][u][m].packets,R=this.lossRateWindowStats[t-1][u][m].packetsLost-this.lossRateWindowStats[0][u][m].packetsLost;u==="videoSend"||u==="audioSend"?(n+=_,o+=R):(i+=_,l+=R),Number.isNaN(_)||Number.isNaN(_)?h.packetLostRate=0:h.packetLostRate=_<=0||R<=0?0:R/(_+R)});e.sendPacketLossRate=n<=0||o<=0?0:o/(n+o),e.recvPacketLossRate=i<=0||l<=0?0:l/(i+l)}},H6=class extends pA{constructor(){super(...arguments),kr(this,"_stats",qg),kr(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){let e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=qs(qg);let r=t.filter(i=>i.type==="ssrc");this.processSSRCStats(r);let n=t.find(i=>i.type==="VideoBwe");n&&this.processBandwidthStats(n),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(t=>{var r;let n=Qt(r=t.id).call(r,"send");switch("".concat(t.mediaType,"_").concat(n?"send":"recv")){case"video_send":{let i=qs(SP);i.codec=t.googCodecName,i.adaptionChangeReason="none",t.googCpuLimitedResolution&&(i.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(i.adaptionChangeReason="bandwidth"),i.avgEncodeMs=Number(t.googAvgEncodeMs),i.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},i.firsCount=Number(t.googFirReceived),i.nacksCount=Number(t.googNacksReceived),i.plisCount=Number(t.googPlisReceived),i.frameCount=Number(t.framesEncoded),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(i),this._stats.rtt=i.rttMs;break}case"video_recv":{let i=qs(yP),o=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(i.codec=t.googCodecName,i.targetDelayMs=Number(t.googTargetDelayMs),i.renderDelayMs=Number(t.googRenderDelayMs),i.currentDelayMs=Number(t.googCurrentDelayMs),i.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),i.decodeMs=Number(t.googDecodeMs),i.maxDecodeMs=Number(t.googMaxDecodeMs),i.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},i.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},i.decodeFrameRate=Number(t.googFrameRateDecoded),i.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},i.jitterBufferMs=Number(t.googJitterBufferMs),i.firsCount=Number(t.googFirsSent),i.nacksCount=Number(t.googNacksSent),i.plisCount=Number(t.googPlisSent),i.framesDecodeCount=Number(t.framesDecoded),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.packets>0&&!this.isFirstVideoReceived[i.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(i.ssrc),this.isFirstVideoReceived[i.ssrc]=!0),i.framesDecodeCount>0&&!this.isFirstVideoDecoded[i.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(i.ssrc,i.decodedFrame.width,i.decodedFrame.height),this.isFirstVideoDecoded[i.ssrc]=!0),o){let l=o.stats,u=Date.now()-o.lts;i.framesDecodeFreezeTime=l.framesDecodeFreezeTime,i.framesDecodeInterval=l.framesDecodeInterval,i.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[i.ssrc]?(o.lts=Date.now(),i.framesDecodeInterval=u,i.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?i.framesDecodeFreezeTime+=i.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):i.framesDecodeCount<o.stats.framesDecodeCount&&(i.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(i.ssrc,{stats:cr({},i),lts:Date.now()}),this._stats.videoRecv.push(i);break}case"audio_recv":{let i=qs(CP);i.codec=t.googCodecName,i.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,i.decodingCNG=Number(t.googDecodingCNG),i.decodingCTN=Number(t.googDecodingCTN),i.decodingCTSG=Number(t.googDecodingCTSG),i.decodingNormal=Number(t.googDecodingNormal),i.decodingPLC=Number(t.googDecodingPLC),i.decodingPLCCNG=Number(t.googDecodingPLCCNG),i.expandRate=Number(t.googExpandRate),i.accelerateRate=Number(t.googAccelerateRate),i.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),i.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),i.speechExpandRate=Number(t.googSpeechExpandRate),i.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),i.jitterBufferMs=Number(t.googJitterBufferMs),i.jitterMs=Number(t.googJitterReceived),i.bytes=Number(t.bytesReceived),i.packets=Number(t.packetsReceived),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),i.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),i.receivedFrames>0&&!this.isFirstAudioReceived[i.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(i.ssrc),this.isFirstAudioReceived[i.ssrc]=!0),i.decodingNormal>0&&!this.isFirstAudioDecoded[i.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(i.ssrc),this.isFirstAudioDecoded[i.ssrc]=!0),this._stats.audioRecv.push(i);break}case"audio_send":{let i=qs(RP);i.codec=t.googCodecName,i.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,i.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),i.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),i.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),i.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),i.bytes=Number(t.bytesSent),i.packets=Number(t.packetsSent),i.packetsLost=Number(t.packetsLost),i.ssrc=Number(t.ssrc),i.rttMs=Number(t.googRtt||0),this._stats.rtt=i.rttMs,this._stats.audioSend.push(i);break}}})}_getStats(){return new tr((e,t)=>{this.pc.getStats(e,t)})}statsResponsesToObjects(e){let t=[];return e.result().forEach(r=>{let n={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(i=>{n[i]=r.stat(i)}),t.push(n)}),t}},Yg=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),ZS=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),fA=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),ko=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var $m=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}($m||{});function Xg(e,t,r,n){let i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:$m.kNone;if(!t)return;let o=Number(t[r]);if(typeof o!="number")return;let l=Number(t[n]);if(typeof l!="number")return;if(!e)return l?o/l*i:void 0;let u=Number(e[r]);if(typeof u!="number")return;let h=Number(e[n]);if(typeof h!="number")return;let m=l-h;return m?(o-u)/m*i:void 0}let IP=class extends pA{constructor(){super(...arguments),kr(this,"_stats",qg),kr(this,"report",void 0),kr(this,"lastDecodeVideoReceiverStats",new Map),kr(this,"lastVideoFramesRecv",new Map),kr(this,"lastVideoFramesSent",new Map),kr(this,"lastVideoFramesDecode",new Map),kr(this,"lastVideoFramesOutput",new Map),kr(this,"lastVideoJBDelay",new Map),kr(this,"lastAudioJBDelay",new Map),kr(this,"mediaBytesSent",new Map),kr(this,"mediaBytesRetransmit",new Map),kr(this,"mediaBytesTargetEncode",new Map),kr(this,"lastDecodeAudioReceiverStats",new Map),kr(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=qs(qg),this.report.forEach(e=>{switch(e.type){case ko.OUTBOUND:case ko.INBOUND:{let t=e.mediaType||e.kind,r=!t&&"frameWidth"in e,n=!t&&!("frameWidth"in e);e.type===ko.OUTBOUND?t==="audio"||n?this.processAudioOutboundStats(e):(t==="video"||r)&&this.processVideoOutboundStats(e):e.type===ko.INBOUND&&(t==="audio"||n?this.processAudioInboundStats(e):(t==="video"||r)&&this.processVideoInboundStats(e));break}case ko.TRANSPORT:{let t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case ko.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){let e=await this.pc.getStats(),t={local:cr({},Pl),remote:cr({},Pl)};return e.forEach(r=>{let n;if(r.type===ko.TRANSPORT&&(n=e.get(r.selectedCandidatePairId)),r.type===ko.CANDIDATE_PAIR&&r.selected&&(n=r),n){let i=(o,l)=>{o.type=l.type,o.id=l.id,l.address&&(o.address=l.address),l.candidateType&&(o.candidateType=l.candidateType),l.port&&(o.port=l.port),l.priority&&(o.priority=l.priority),l.protocol&&(o.protocol=l.protocol),l.relayProtocol&&(o.relayProtocol=l.relayProtocol)};if(n.localCandidateId){let o=e.get(n.localCandidateId);o&&i(t.local,o)}if(n.remoteCandidateId){let o=e.get(n.remoteCandidateId);o&&i(t.remote,o)}}}),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){let t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){let t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===ko.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===ko.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===ko.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(cr({},t),cr({},this.stats.selectedCandidatePair.localCandidate)),e.type===ko.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(cr({},t),cr({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find(n=>n.ssrc===e.ssrc);t||(t=qs(CP),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.packetsDiscarded=e.packetsDiscarded,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived,t.totalProcessingDelay=e.totalProcessingDelay,t.jitterBufferEmittedCount=e.jitterBufferEmittedCount;let r=this.lastDecodeAudioReceiverStats.get(t.ssrc);t.avgProcessingDelayMs=Xg(r,t,"totalProcessingDelay","jitterBufferEmittedCount",$m.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),typeof e.concealedSamples=="number"&&(t.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(t.ssrc,cr({},t))}processVideoInboundStats(e){let t=this._stats.videoRecv.find(l=>l.ssrc===e.ssrc);t||(t=qs(yP),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.framesDroppedCount=e.framesDropped,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,t.totalFreezesDuration=e.totalFreezesDuration,t.totalProcessingDelay=e.totalProcessingDelay,t.packetsDiscarded=e.packetsDiscarded,t.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,t.totalAssemblyTime=e.totalAssemblyTime,t.keyFramesDecoded=e.keyFramesDecoded,t.retransmittedBytesReceived=e.retransmittedBytesReceived,t.retransmittedPacketsReceived=e.retransmittedPacketsReceived;let r=this.lastDecodeVideoReceiverStats.get(t.ssrc),n=this.lastVideoFramesDecode.get(t.ssrc),i=this.lastVideoFramesOutput.get(t.ssrc),o=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){let l=t.decodedFrame?t.decodedFrame.width:0,u=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,l,u),this.isFirstVideoDecoded[t.ssrc]=!0}if(r){let l=r.stats,u=o-r.lts;t.framesDecodeFreezeTime=l.framesDecodeFreezeTime,t.framesDecodeInterval=l.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>l.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(r.lts=Date.now(),t.framesDecodeInterval=u,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<l.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(r.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-r.qpSum)/(e.framesDecoded-r.stats.framesDecodeCount))}e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime,t.avgDecodeMs=Xg(r?.stats,t,"decodeMs","framesDecodeCount")),t.avgProcessingDelayMs=Xg(r?.stats,t,"totalProcessingDelay","framesDecodeCount",$m.kMillisecondsFromSeconds),t.avgFramesAssembledFromMultiplePacketsMs=Xg(r?.stats,t,"totalAssemblyTime","framesAssembledFromMultiplePackets",$m.kMillisecondsFromSeconds),t.avgInterFrameDelayMs=Xg(r?.stats,t,"totalInterFrameDelay","framesDecodeCount",$m.kMillisecondsFromSeconds),n&&o-n.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-n.count)/((o-n.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:t.decodeFrameRate})):n?t.decodeFrameRate=n.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:o,rate:0}),t.framesDroppedCount&&e.framesReceived&&(i&&o-i.lts>=800?(t.outputFrameRate=Math.round((e.framesReceived-t.framesDroppedCount-i.count)/((o-i.lts)/1e3)),this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:Math.max(t.outputFrameRate,0)})):i?t.outputFrameRate=i.rate:this.lastVideoFramesOutput.set(t.ssrc,{count:e.framesReceived-t.framesDroppedCount,lts:o,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:cr({},t),lts:r?r.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find(n=>n.ssrc===e.ssrc);t||(t=qs(SP),this._stats.videoSend.push(t));let r=this.mediaBytesSent.get(e.ssrc);if(r)r.add(e.bytesSent);else{let n=new hA(10);n.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,n)}if(e.retransmittedBytesSent!==void 0){let n=this.mediaBytesRetransmit.get(e.ssrc);if(n)n.add(e.retransmittedBytesSent);else{let i=new hA(10);i.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,i)}}if(e.totalEncodedBytesTarget){let n=this.mediaBytesTargetEncode.get(e.ssrc);if(n)n.add(e.totalEncodedBytesTarget);else{let i=new hA(10);i.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,i)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,t.hugeFramesSent=e.hugeFramesSent,t.keyFramesEncoded=e.keyFramesEncoded,e.totalEncodeTime&&e.framesEncoded){let n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{let i=e.framesEncoded-n.lastFrameCount,o=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*o/i}}if(e.framesEncoded&&e.qpSum){let n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let n=this.findRemoteStatsId(e.ssrc,ko.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find(r=>r.ssrc===e.ssrc);if(t||(t=qs(RP),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,t.retransmittedBytesSent=e.retransmittedBytesSent,t.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{let r=this.findRemoteStatsId(e.ssrc,ko.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,t)}}findRemoteStatsId(e,t){var r;let n=Array.from(ro(r=this.report).call(r)).find(i=>i.type===t&&i.ssrc===e);return n?n.id:null}processVideoMediaSource(e,t){let r=this.report.get(e);r&&r.width&&r.height&&r.framesPerSecond&&(t.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(e,t){let r=this.report.get(e);r&&(t.inputLevel=r.audioLevel)}processVideoTrackSenderStats(e,t,r){var n,i,o,l;let u=t?this.report.get(t):void 0,h=(n=u?.framesSent)!==null&&n!==void 0?n:e.framesSent;if(typeof h!="number")return;let m=(i=u?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,_=(o=u?.frameHeight)!==null&&o!==void 0?o:e.frameHeight,R=(l=u?.framesPerSecond)!==null&&l!==void 0?l:e.framesPerSecond;if(typeof m=="number"&&typeof _=="number"||(m=0,_=0),R==null){let A=Date.now(),D=this.lastVideoFramesSent.get(r.ssrc);D&&A-D.lts>=800?(R=Math.round((h-D.count)/((A-D.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:h,lts:A,rate:R})):D?R=D.rate:this.lastVideoFramesSent.set(r.ssrc,{count:h,lts:A,rate:0})}r.sentFrame={width:m,height:_,frameRate:Math.max(0,R)}}processVideoTrackReceiverStats(e,t,r){var n,i,o,l,u;let h=t?this.report.get(t):void 0,m=(n=h?.framesReceived)!==null&&n!==void 0?n:e.framesReceived,_=(i=h?.frameWidth)!==null&&i!==void 0?i:e.frameWidth,R=(o=h?.frameHeight)!==null&&o!==void 0?o:e.frameHeight,A=(l=h?.jitterBufferDelay)!==null&&l!==void 0?l:e.jitterBufferDelay,D=(u=h?.jitterBufferEmittedCount)!==null&&u!==void 0?u:e.jitterBufferEmittedCount;if(typeof m=="number"){let J=this.lastVideoFramesRecv.get(r.ssrc),V=Date.now();r.framesReceivedCount=m;let K=0;J&&V-J.lts>=800?(K=Math.round((m-J.count)/((V-J.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:m,lts:V,rate:K})):J?K=J.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:m,lts:V,rate:0}),r.receivedFrame={width:_||0,height:R||0,frameRate:K||0},r.decodedFrame={width:_||0,height:R||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:_||0,height:R||0,frameRate:r.outputFrameRate||r.decodeFrameRate||0}}if(A&&D){let J=this.lastVideoJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},V=J.jitterBufferMs,K=D-J.jitterBufferEmittedCount;K>0&&(V=1e3*(A-J.jitterBufferDelay)/K),r.jitterBufferMs=V,r.currentDelayMs=Math.round(V),this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:D,jitterBufferMs:r.currentDelayMs})}}processAudioTrackSenderStats(e,t,r){var n,i,o,l;let u=t?this.report.get(t):void 0,h=(n=(i=u?.echoReturnLoss)!==null&&i!==void 0?i:e.echoReturnLoss)!==null&&n!==void 0?n:0,m=(o=(l=u?.echoReturnLossEnhancement)!==null&&l!==void 0?l:e.echoReturnLossEnhancement)!==null&&o!==void 0?o:0;r.aecReturnLoss=h,r.aecReturnLossEnhancement=m}processAudioTrackReceiverStats(e,t,r){var n,i,o,l,u,h,m;let _=t?this.report.get(t):void 0,R=(n=_?.removedSamplesForAcceleration)!==null&&n!==void 0?n:e.removedSamplesForAcceleration,A=(i=_?.totalSamplesReceived)!==null&&i!==void 0?i:e.totalSamplesReceived,D=(o=_?.jitterBufferDelay)!==null&&o!==void 0?o:e.jitterBufferDelay,J=(l=_?.jitterBufferEmittedCount)!==null&&l!==void 0?l:e.jitterBufferEmittedCount,V=(u=_?.audioLevel)!==null&&u!==void 0?u:e?.audioLevel,K=(h=_?.totalSamplesDuration)!==null&&h!==void 0?h:e?.totalSamplesDuration,se=(m=_?.concealedSamples)!==null&&m!==void 0?m:e.concealedSamples;if(typeof A=="number"&&(r.totalSamplesReceived=A),R&&A&&(r.accelerateRate=R/A),D&&J){let De=this.lastAudioJBDelay.get(r.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0},ze=De.jitterBufferMs,Ke=J-De.jitterBufferEmittedCount;Ke>0&&(ze=1e3*(D-De.jitterBufferDelay)/Ke),r.jitterBufferMs=Math.round(ze),this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:D,jitterBufferEmittedCount:J,jitterBufferMs:r.jitterBufferMs})}r.outputLevel=V;let ue=1920;K&&A&&(ue=A/K/50,r.receivedFrames=Math.round(A/ue)),se&&(r.droppedFrames=Math.round(se/ue))}processRemoteInboundStats(e,t){let r=this.report.get(e);r&&(t.packetsLost=r.packetsLost,r.roundTripTime&&(t.rttMs=1e3*r.roundTripTime),r.jitter&&(t.jitterMs=1e3*r.jitter),r.timestamp&&(t.timestamp=r.timestamp))}getCodecFromCodecStats(e){let t=this.report.get(e);if(!t)return"";let r=t.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let e=0,t=null,r=null;this.mediaBytesSent.forEach(i=>{e+=i.diffMean()}),this.mediaBytesRetransmit.forEach(i=>{t=t===null?i.diffMean():t+i.diffMean()}),this.mediaBytesTargetEncode.forEach(i=>{r=r===null?i.diffMean():r+i.diffMean()});let n=t!==null?e-t:e;this._stats.bitrate={actualEncoded:8*n/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},t!==null&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}},W6=class extends pA{updateStats(){return tr.resolve()}};function mA(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4,o=function(){let l=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return l&&l[0]?Number(l[0].split("/")[1]):null}();return o?o<76?new H6(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):new IP(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):function(l){if(!window.RTCStatsReport)return!1;let u=l.getStats();return!!(u instanceof tr||function(h){return!!h&&(typeof h=="object"||typeof h=="function")&&typeof h.then=="function"}(u))}(e)?new IP(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i}):new W6(e,{updateInterval:t,lossRateInterval:r,freezeRateLimit:n,firstVideoDecodedTimeout:i})}let AP="websdk_ng_install_id";function EA(){try{if(Se("INSTALL_ID"))return Se("INSTALL_ID");let e=window.localStorage.getItem(AP);return e||(e=Ap(),window.localStorage.setItem(AP,e)),pn("INSTALL_ID",e),e}catch{return}}let hs=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;let t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(t&&t[1]&&t[2]){let r=t[1],n=t[2];return"".concat(r,".").concat(n)}return"4.0.0.999"}("4.23.2"),_A=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),bp=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({}),aa=function(){let e="us".concat("erna","me"),t="pa".concat("sswo","rd"),r=["t","s","t"];r.splice(1,0,"e");let n=r.join(""),i=[];for(let u=0;u<6;u++)i.push("1");let o=i.join(""),l={};return l[e]=n,l[t]=o,Object.assign(l,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=aa;let QS={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:2,ENABLE_AUT_FEEDBACK:!1,SVC_EXTENDED:["VP9"]},gA={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},vA="v4.23.2-0-g1599fdac-dirty(3/4/2025, 5:13:36 PM)",TA={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!1,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!1,NEW_TURN_MODE:void 0,NEW_FORCE_TURN:!1},Un=cr(cr(cr({},TA),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS_METADATA:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:gA,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},QS),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1},{INSTALL_ID:""});function pn(e,t,r){var n,i,o;Qt(n=Object.keys(Un)).call(n,e)&&(!r&&Qt(i=Object.keys(jc)).call(i,e)||(Un[e]=t,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS_METADATA"||t!==!0||(Un.ENABLE_ENCODED_TRANSFORM=!0,e==="ENABLE_AUDIO_PTS_METADATA"&&(Un.ENABLE_AUDIO_METADATA=!0)),e==="USE_NEW_NETWORK_CONFIG"&&t&&(o=!!t,Un.USE_NEW_NETWORK_CONFIG=o,o&&(Un.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],Un.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],Un.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],Un.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],Un.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",Un.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",Un.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&t&&(Un.ENABLE_INSTANT_VIDEO=!0,Un.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&t&&(Un.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&t&&(Un.NEW_TURN_MODE||(Un.NEW_TURN_MODE=4))))}function Se(e){return Un[e]}_A||(Un.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],Un.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],Un.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],Un.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],Un.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],Un.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],Un.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",Un.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",Un.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",Un.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",Un.AREAS=["NORTH_AMERICA","OVERSEA"]);let bP=function(e){return e[e.REALTIME=1]="REALTIME",e}({}),jc={};var Hr=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(Hr||{});let $S=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});let OP=128,K6=96,NP=1e3,eE=10,z6=0;var wP=(()=>{var e={8:(n,i,o)=>{o.r(i),o.d(i,{Parser:()=>ar,Printer:()=>si,parse:()=>Yt,print:()=>fr});let l=`
`,u="".concat("\r").concat(l),h=" ",m;function _(wt){return wt>="0"&&wt<="9"}function R(wt){return wt>="!"&&wt<="~"}function A(wt){return R(wt)||wt>=""&&wt<="ÿ"}function D(wt){return wt==="!"||wt>="#"&&wt<="'"||wt>="*"&&wt<="+"||wt>="-"&&wt<="."||wt>="0"&&wt<="9"||wt>="A"&&wt<="Z"||wt>="^"&&wt<="~"}function J(wt){return wt>="1"&&wt<="9"}function V(wt){return wt>="A"&&wt<="Z"||wt>="a"&&wt<="z"}function K(wt){return wt==="d"||wt==="h"||wt==="m"||wt==="s"}function se(wt){return wt>""&&wt<"	"||wt>"\v"&&wt<"\f"||wt>""&&wt<"ÿ"}function ue(wt){return V(wt)||_(wt)||wt==="+"||wt==="/"}function De(wt){return _(wt)||V(wt)||wt==="+"||wt==="/"||wt==="-"||wt==="_"}function ze(wt){return V(wt)||_(wt)||wt==="+"||wt==="/"}function Ke(wt,B){var Ce=Object.keys(wt);if(Object.getOwnPropertySymbols){var ke=Object.getOwnPropertySymbols(wt);B&&(ke=ke.filter(function(Ft){return Object.getOwnPropertyDescriptor(wt,Ft).enumerable})),Ce.push.apply(Ce,ke)}return Ce}function Ve(wt){for(var B=1;B<arguments.length;B++){var Ce=arguments[B]!=null?arguments[B]:{};B%2?Ke(Object(Ce),!0).forEach(function(ke){_t(wt,ke,Ce[ke])}):Object.getOwnPropertyDescriptors?Object.defineProperties(wt,Object.getOwnPropertyDescriptors(Ce)):Ke(Object(Ce)).forEach(function(ke){Object.defineProperty(wt,ke,Object.getOwnPropertyDescriptor(Ce,ke))})}return wt}function _t(wt,B,Ce){return B in wt?Object.defineProperty(wt,B,{value:Ce,enumerable:!0,configurable:!0,writable:!0}):wt[B]=Ce,wt}(function(wt){wt.VERSION="v",wt.ORIGIN="o",wt.SESSION_NAME="s",wt.INFORMATION="i",wt.URI="u",wt.EMAIL="e",wt.PHONE="p",wt.CONNECTION="c",wt.BANDWIDTH="b",wt.TIME="t",wt.REPEAT="r",wt.ZONE_ADJUSTMENTS="z",wt.KEY="k",wt.ATTRIBUTE="a",wt.MEDIA="m"})(m||(m={}));class Vt{consumeText(B,Ce){let ke=Ce;for(;ke<B.length;){let Ft=B[ke];if(Ft==="\0"||Ft==="\r"||Ft===l)break;ke+=1}if(ke-Ce==0)throw new Error("Invalid text, at ".concat(B));return ke}consumeUnicastAddress(B,Ce,ke){return this.consumeTill(B,Ce,h)}consumeOneOrMore(B,Ce,ke){let Ft=Ce;for(;ke(B[Ft]);)Ft++;if(Ft-Ce==0)throw new Error("Invalid rule at ".concat(Ce,"."));return Ft}consumeSpace(B,Ce){if(B[Ce]===h)return Ce+1;throw new Error("Invalid space at ".concat(Ce,"."))}consumeIP4Address(B,Ce){let ke=Ce;for(let Ft=0;Ft<4;Ft++)if(ke=this.consumeDecimalUChar(B,ke),Ft!==3){if(B[ke]!==".")throw new Error("Invalid IP4 address.");ke++}return ke}consumeDecimalUChar(B,Ce){let ke=Ce;for(let Mr=0;Mr<3&&_(B[ke]);Mr++,ke++);if(ke-Ce==0)throw new Error("Invalid decimal uchar.");let Ft=parseInt(B.slice(Ce,ke));if(Ft>=0&&Ft<=255)return ke;throw new Error("Invalid decimal uchar")}consumeIP6Address(B,Ce){let ke=this.consumeHexpart(B,Ce);return B[ke]===":"&&(ke+=1,ke=this.consumeIP4Address(B,ke)),ke}consumeHexpart(B,Ce){let ke=Ce;if(B[ke]===":"&&B[ke+1]===":"){ke+=2;try{ke=this.consumeHexseq(B,ke)}catch{}return ke}if(ke=this.consumeHexseq(B,ke),B[ke]===":"&&B[ke+1]===":"){ke+=2;try{ke=this.consumeHexseq(B,ke)}catch{}return ke}return ke}consumeHexseq(B,Ce){let ke=Ce;for(;ke=this.consumeHex4(B,ke),B[ke]===":"&&B[ke+1]!==":";)ke+=1;return ke}consumeHex4(B,Ce){let ke=0;for(;ke<4;ke++)if(!((Ft=B[Ce+ke])>="0"&&Ft<="9"||Ft>="a"&&Ft<="f"||Ft>="A"&&Ft<="F")){if(ke===0)throw new Error("Invalid hex 4");break}var Ft;return Ce+ke}consumeFQDN(B,Ce){let ke=Ce;for(;_(B[ke])||V(B[ke])||B[ke]==="-"||B[ke]===".";)ke+=1;if(ke-Ce<4)throw new Error("Invalid FQDN");return ke}consumeExtnAddr(B,Ce){return this.consumeOneOrMore(B,Ce,A)}consumeMulticastAddress(B,Ce,ke){switch(ke){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(B,Ce);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(B,Ce);default:try{return this.consumeFQDN(B,Ce)}catch{return this.consumeExtnAddr(B,Ce)}}}consumeIP6MulticastAddress(B,Ce){let ke=this.consumeHexpart(B,Ce);return B[ke]==="/"?this.consumeInteger(B,ke+1):ke}consumeIP4MulticastAddress(B,Ce){let ke=Ce+3,Ft=B.slice(Ce,ke),Mr=parseInt(Ft);if(Mr<224||Mr>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Dn=0;Dn<3;Dn++){if(B[ke]!==".")throw new Error("Invalid IP4 multicast address.");ke+=1,ke=this.consumeDecimalUChar(B,ke)}return B[ke]==="/"&&(ke+=1),ke=this.consumeTTL(B,ke),B[ke]==="/"&&(ke=this.consumeInteger(B,ke)),ke}consumeInteger(B,Ce){if(!J(B[Ce]))throw new Error("Invalid integer.");for(Ce+=1;_(B[Ce]);)Ce+=1;return Ce}consumeTTL(B,Ce){if(B[Ce]==="0")return Ce+1;if(!J(B[Ce]))throw new Error("Invalid TTL.");Ce+=1;for(let ke=0;ke<2&&_(B[Ce]);ke++)Ce+=1;return Ce}consumeToken(B,Ce){return this.consumeOneOrMore(B,Ce,D)}consumeTime(B,Ce){let ke=Ce;if(B[ke]==="0")return ke+1;for(J(B[ke])&&(ke+=1);_(B[ke]);)ke++;if(ke-Ce<10)throw new Error("Invalid time");return ke}consumeAddress(B,Ce){return this.consumeTill(B,Ce,h)}consumeTypedTime(B,Ce){let ke=Ce;return ke=this.consumeOneOrMore(B,ke,_),K(B[ke])?ke+1:ke}consumeRepeatInterval(B,Ce){if(!J(B[Ce]))throw new Error("Invalid repeat interval");for(Ce+=1;_(B[Ce]);)Ce+=1;return K(B[Ce])&&(Ce+=1),Ce}consumePort(B,Ce){return this.consumeOneOrMore(B,Ce,_)}consume(B,Ce,ke){for(let Ft=0;Ft<ke.length;Ft++){if(Ce+Ft>=B.length)throw new Error("consume exceeding value length");if(B[Ce+Ft]!==ke[Ft])throw new Error("consume ".concat(ke," failed at ").concat(Ft))}return Ce+ke.length}consumeTill(B,Ce,ke){let Ft=Ce;for(;Ft<B.length&&(typeof ke!="string"||B[Ft]!==ke)&&(typeof ke!="function"||!ke(B[Ft]));)Ft++;return Ft}}class ar extends Vt{constructor(){super(),_t(this,"records",[]),_t(this,"currentLine",0)}parse(B){let Ce=this.probeEOL(B);this.records=B.split(Ce).filter(Zp=>!!Ia(Zp).call(Zp)).map(this.parseLine),this.currentLine=0;let ke=this.parseVersion(),Ft=this.parseOrigin(),Mr=this.parseSessionName(),Dn=this.parseInformation(),ki=this.parseUri(),lo=this.parseEmail(),Wu=this.parsePhone(),Jp=this.parseConnection(),Pv=this.parseBandWidth(),u0=this.parseTimeFields(),d0=this.parseKey(),Ts=this.parseSessionAttribute(),lh=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:ke,origin:Ft,sessionName:Mr,information:Dn,uri:ki,emails:lo,phones:Wu,connection:Jp,bandwidths:Pv,timeFields:u0,key:d0,attributes:Ts,mediaDescriptions:lh}}getCurrentRecord(){let B=this.records[this.currentLine];if(!B)throw new Error("Record doesn't exit.");return B}probeEOL(B){for(let Ce=0;Ce<B.length;Ce++)if(B[Ce]===l)return B[Ce-1]==="\r"?u:l;throw new Error("Invalid newline character.")}parseLine(B,Ce){if(B.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");let ke=B[0];if(B[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:ke,value:B.slice(2),line:Ce,cur:0}}parseSessionAttribute(){let B=new Kr;for(;this.currentLine<this.records.length;){let Ce=this.getCurrentRecord();if(Ce.type!==m.ATTRIBUTE)break;let ke={attField:this.extractOneOrMore(Ce,Ft=>D(Ft)&&Ft!==":"),_cur:0};Ce.value[Ce.cur]===":"&&(Ce.cur+=1,ke.attValue=this.extractOneOrMore(Ce,se)),B.parse(ke),this.currentLine++}return B.digest()}parseMediaAttributes(B){let Ce=new zr(B);for(;this.currentLine<this.records.length;){let ke=this.getCurrentRecord();if(ke.type!==m.ATTRIBUTE)break;let Ft={attField:this.extractOneOrMore(ke,Mr=>D(Mr)&&Mr!==":"),_cur:0};ke.value[ke.cur]===":"&&(ke.cur+=1,Ft.attValue=this.extractOneOrMore(ke,se)),Ce.parse(Ft),this.currentLine++}return Ce.digest()}parseKey(){let B=this.getCurrentRecord();if(B.type===m.KEY){if(B.value==="prompt"||B.value==="clear:"||B.value==="base64:"||B.value==="uri:")return B.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){let B=this.getCurrentRecord();if(B.type===m.ZONE_ADJUSTMENTS){let Ce=[];for(;;)try{let ke=this.extract(B,this.consumeTime);this.consumeSpaceForRecord(B);let Ft=!1;B.value[B.cur]==="-"&&(Ft=!0,B.cur+=1);let Mr=this.extract(B,this.consumeTypedTime);Ce.push({time:ke,typedTime:Mr,back:Ft})}catch{break}if(Ce.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,Ce}return[]}parseRepeat(){let B=[];for(;;){let Ce=this.getCurrentRecord();if(Ce.type!==m.REPEAT)break;{let ke=this.extract(Ce,this.consumeRepeatInterval),Ft=this.parseTypedTime(Ce);B.push({repeatInterval:ke,typedTimes:Ft}),this.currentLine++}}return B}parseTypedTime(B){let Ce=[];for(;;)try{this.consumeSpaceForRecord(B),Ce.push(this.extract(B,this.consumeTypedTime))}catch{break}if(Ce.length===0)throw new Error("Invalid typed time.");return Ce}parseTime(){let B=this.getCurrentRecord(),Ce=this.extract(B,this.consumeTime);this.consumeSpaceForRecord(B);let ke=this.extract(B,this.consumeTime);return this.currentLine++,{startTime:Ce,stopTime:ke}}parseBandWidth(){let B=[];for(;this.currentLine<this.records.length;){let Ce=this.getCurrentRecord();if(Ce.type!==m.BANDWIDTH)break;{let ke=this.extractOneOrMore(Ce,D);if(Ce.value[Ce.cur]!==":")throw new Error("Invalid bandwidth field.");Ce.cur++;let Ft=this.extractOneOrMore(Ce,_);B.push({bwtype:ke,bandwidth:Ft}),this.currentLine++}}return B}parseVersion(){let B=this.getCurrentRecord();if(B.type!==m.VERSION)throw new Error("first sdp record must be version");let Ce=B.value.slice(0,this.consumeOneOrMore(B.value,0,_));if(Ce.length!==B.value.length)throw new Error('invalid proto version, "v='.concat(B.value,'"'));return this.currentLine++,Ce}parseOrigin(){let B=this.getCurrentRecord();if(B.type!==m.ORIGIN)throw new Error("second line of sdp must be origin");let Ce=this.extractOneOrMore(B,A);this.consumeSpaceForRecord(B);let ke=this.extractOneOrMore(B,_);this.consumeSpaceForRecord(B);let Ft=this.extractOneOrMore(B,_);this.consumeSpaceForRecord(B);let Mr=this.extractOneOrMore(B,D);this.consumeSpaceForRecord(B);let Dn=this.extractOneOrMore(B,D);this.consumeSpaceForRecord(B);let ki=this.extract(B,this.consumeUnicastAddress);return this.currentLine++,{username:Ce,sessId:ke,sessVersion:Ft,nettype:Mr,addrtype:Dn,unicastAddress:ki}}parseSessionName(){let B=this.getCurrentRecord();if(B.type===m.SESSION_NAME){let Ce=this.extract(B,this.consumeText);return this.currentLine++,Ce}}parseInformation(){let B=this.getCurrentRecord();if(B.type!==m.INFORMATION)return;let Ce=this.extract(B,this.consumeText);return this.currentLine++,Ce}parseUri(){let B=this.getCurrentRecord();if(B.type===m.URI)return this.currentLine++,B.value}parseEmail(){let B=[];for(;;){let Ce=this.getCurrentRecord();if(Ce.type!==m.EMAIL)break;B.push(Ce.value),this.currentLine++}return B}parsePhone(){let B=[];for(;;){let Ce=this.getCurrentRecord();if(Ce.type!==m.PHONE)break;B.push(Ce.value),this.currentLine++}return B}parseConnection(){let B=this.getCurrentRecord();if(B.type===m.CONNECTION){let Ce=this.extractOneOrMore(B,D);this.consumeSpaceForRecord(B);let ke=this.extractOneOrMore(B,D);this.consumeSpaceForRecord(B);let Ft=this.extract(B,this.consumeAddress);return this.currentLine++,{nettype:Ce,addrtype:ke,address:Ft}}}parseMedia(){let B=this.getCurrentRecord(),Ce=this.extract(B,this.consumeToken);this.consumeSpaceForRecord(B);let ke=this.extract(B,this.consumePort);B.value[B.cur]==="/"&&(B.cur+=1,ke+=this.extract(B,this.consumeInteger)),this.consumeSpaceForRecord(B);let Ft=[];for(Ft.push(this.extract(B,this.consumeToken));B.value[B.cur]==="/";)B.cur+=1,Ft.push(this.extract(B,this.consumeToken));if(Ft.length===0)throw new Error("Invalid proto");let Mr=this.parseFmt(B);return this.currentLine++,{mediaType:Ce,port:ke,protos:Ft,fmts:Mr}}parseTimeFields(){let B=[];for(;this.getCurrentRecord().type===m.TIME;){let Ce=this.parseTime(),ke=this.parseRepeat(),Ft=this.parseZone();B.push({time:Ce,repeats:ke,zones:Ft})}return B}parseMediaDescription(){let B=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.MEDIA;){let Ce=this.parseMedia(),ke=this.parseInformation(),Ft=this.parseConnections(),Mr=this.parseBandWidth(),Dn=this.parseKey(),ki=this.parseMediaAttributes(Ce);B.push({media:Ce,information:ke,connections:Ft,bandwidths:Mr,key:Dn,attributes:ki})}return B}parseConnections(){let B=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===m.CONNECTION;)B.push(this.parseConnection());return B}parseFmt(B){let Ce=[];for(;;)try{this.consumeSpaceForRecord(B),Ce.push(this.extract(B,this.consumeToken))}catch{break}if(Ce.length===0)throw new Error("Invalid fmts");return Ce}extract(B,Ce){for(var ke=arguments.length,Ft=new Array(ke>2?ke-2:0),Mr=2;Mr<ke;Mr++)Ft[Mr-2]=arguments[Mr];let Dn=Ce.call(this,B.value,B.cur,...Ft),ki=B.value.slice(B.cur,Dn);return B.cur=Dn,ki}extractOneOrMore(B,Ce){let ke=this.consumeOneOrMore(B.value,B.cur,Ce),Ft=B.value.slice(B.cur,ke);return B.cur=ke,Ft}consumeSpaceForRecord(B){if(B.value[B.cur]!==h)throw new Error("Invalid space at ".concat(B.cur,"."));B.cur+=1}}class ur extends Vt{constructor(){super(...arguments),_t(this,"attributes",void 0),_t(this,"digested",!1)}extractOneOrMore(B,Ce,ke){let Ft=this.consumeOneOrMore(B.attValue,B._cur,Ce),Mr=B.attValue.slice(B._cur,Ft),[Dn,ki]=ke||[];if(typeof Dn=="number"&&Mr.length<Dn)throw new Error("error in length, should be more or equal than ".concat(Dn," characters."));if(typeof ki=="number"&&Mr.length>ki)throw new Error("error in length, should be less or equal than ".concat(ki," characters."));return B._cur=Ft,Mr}consumeAttributeSpace(B){if(B.attValue[B._cur]!==h)throw new Error("Invalid space at ".concat(B._cur,"."));B._cur+=1}extract(B,Ce){if(!B.attValue)throw new Error("Nothing to extract from attValue.");for(var ke=arguments.length,Ft=new Array(ke>2?ke-2:0),Mr=2;Mr<ke;Mr++)Ft[Mr-2]=arguments[Mr];let Dn=Ce.call(this,B.attValue,B._cur,...Ft),ki=B.attValue.slice(B._cur,Dn);return B._cur=Dn,ki}atEnd(B){if(!B.attValue)throw new Error;return B._cur>=B.attValue.length}peekChar(B){if(!B.attValue)throw new Error;return B.attValue[B._cur]}peek(B,Ce){if(!B.attValue)throw new Error;for(let ke=0;ke<Ce.length;ke++)if(Ce[ke]!==B.attValue[B._cur+ke])return!1;return!0}parseIceUfrag(B){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(B,ue,[4,256])}parseIcePwd(B){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(B,ue,[22,256])}parseIceOptions(B){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");let Ce=[];for(;!this.atEnd(B);){Ce.push(this.extractOneOrMore(B,ue));try{this.consumeAttributeSpace(B)}catch(ke){if(this.atEnd(B))break;throw ke}}this.attributes.iceOptions=Ce}parseFingerprint(B){let Ce=this.extract(B,this.consumeToken);this.consumeAttributeSpace(B);let ke=this.extract(B,this.consumeTill);this.attributes.fingerprints.push({hashFunction:Ce,fingerprint:ke})}parseExtmap(B){let Ce=this.extractOneOrMore(B,_),ke;this.peekChar(B)==="/"&&(this.extract(B,this.consume,"/"),ke=this.extract(B,this.consumeToken)),this.consumeAttributeSpace(B);let Ft=this.extract(B,this.consumeTill,h),Mr=Ve(Ve({entry:parseInt(Ce,10)},ke&&{direction:ke}),{},{extensionName:Ft});this.peekChar(B)===h&&(this.consumeAttributeSpace(B),Mr.extensionAttributes=this.extract(B,this.consumeTill)),this.attributes.extmaps.push(Mr)}parseSetup(B){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");let Ce=this.extract(B,this.consumeTill);if(Ce!=="active"&&Ce!=="passive"&&Ce!=="actpass"&&Ce!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=Ce}}class Kr extends ur{constructor(){super(...arguments),_t(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(B){if(this.digested)throw new Error("already digested");try{switch(B.attField){case"group":this.parseGroup(B);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(B);break;case"ice-pwd":this.parseIcePwd(B);break;case"ice-options":this.parseIceOptions(B);break;case"fingerprint":this.parseFingerprint(B);break;case"setup":this.parseSetup(B);break;case"tls-id":this.parseTlsId(B);break;case"identity":this.parseIdentity(B);break;case"extmap":this.parseExtmap(B);break;case"msid-semantic":this.parseMsidSemantic(B);break;default:B.ignored=!0,this.attributes.unrecognized.push(B)}}catch(Ce){throw console.error("parsing session attribute ".concat(B.attField,' error, "a=').concat(B.attField,":").concat(B.attValue,'"')),Ce}if(!B.ignored&&B.attValue&&!this.atEnd(B))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(B){let Ce=this.extract(B,this.consumeToken),ke=[];for(;!this.atEnd(B)&&this.peekChar(B)===h;)this.consumeAttributeSpace(B),ke.push(this.extract(B,this.consumeToken));this.attributes.groups.push({semantic:Ce,identificationTag:ke})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(B){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(B,De)}parseIdentity(B){let Ce=this.extractOneOrMore(B,ze),ke=[];for(;!this.atEnd(B)&&this.peekChar(B)===h;){this.consumeAttributeSpace(B);let Ft=this.extract(B,this.consumeToken);this.extract(B,this.consume,"=");let Mr=this.extractOneOrMore(B,Dn=>Dn!==h&&se(Dn));ke.push({name:Ft,value:Mr})}this.attributes.identities.push({assertionValue:Ce,extensions:ke})}parseMsidSemantic(B){this.peekChar(B)===h&&this.consumeAttributeSpace(B);let Ce={semantic:this.extract(B,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(B)}catch{break}if(this.peekChar(B)==="*"){this.extract(B,this.consume,"*"),Ce.applyForAll=!0;break}{let ke=this.extract(B,this.consumeTill,h);Ce.identifierList.push(ke)}}this.attributes.msidSemantic=Ce}}class zr extends ur{constructor(B){super(),_t(this,"attributes",void 0),B.protos.indexOf("RTP")!==-1||B.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(B){if(this.digested)throw new Error("already digested");try{switch(B.attField){case"extmap":this.parseExtmap(B);break;case"setup":this.parseSetup(B);break;case"ice-ufrag":this.parseIceUfrag(B);break;case"ice-pwd":this.parseIcePwd(B);break;case"ice-options":this.parseIceOptions(B);break;case"candidate":this.parseCandidate(B);break;case"remote-candidate":this.parseRemoteCandidate(B);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(B);break;case"rtpmap":this.parseRtpmap(B);break;case"ptime":this.parsePtime(B);break;case"maxptime":this.parseMaxPtime(B);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(B);break;case"ssrc":this.parseSSRC(B);break;case"fmtp":this.parseFmtp(B);break;case"rtcp-fb":this.parseRtcpFb(B);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(B);break;case"mid":this.parseMid(B);break;case"msid":this.parseMsid(B);break;case"imageattr":this.parseImageAttr(B);break;case"rid":this.parseRid(B);break;case"simulcast":this.parseSimulcast(B);break;case"sctp-port":this.parseSctpPort(B);break;case"max-message-size":this.parseMaxMessageSize(B);break;case"ssrc-group":this.parseSSRCGroup(B);break;default:B.ignored=!0,this.attributes.unrecognized.push(B)}}catch(Ce){throw console.error("parsing media attribute ".concat(B.attField,' error, "a=').concat(B.attField,":").concat(B.attValue,'"')),Ce}if(!B.ignored&&B.attValue&&!this.atEnd(B))throw new Error("attribute parsing error")}parseCandidate(B){let Ce=this.extractOneOrMore(B,ue,[1,32]);this.consumeAttributeSpace(B);let ke=this.extractOneOrMore(B,_,[1,5]);this.consumeAttributeSpace(B);let Ft=this.extract(B,this.consumeToken);this.consumeAttributeSpace(B);let Mr=this.extractOneOrMore(B,_,[1,10]);this.consumeAttributeSpace(B);let Dn=this.extract(B,this.consumeAddress);this.consumeAttributeSpace(B);let ki=this.extract(B,this.consumePort);this.consumeAttributeSpace(B),this.extract(B,this.consume,"typ"),this.consumeAttributeSpace(B);let lo={foundation:Ce,componentId:ke,transport:Ft,priority:Mr,connectionAddress:Dn,port:ki,type:this.extract(B,this.consumeToken),extension:{}};for(this.peek(B," raddr")&&(this.extract(B,this.consume," raddr"),this.consumeAttributeSpace(B),lo.relAddr=this.extract(B,this.consumeAddress)),this.peek(B," rport")&&(this.extract(B,this.consume," rport"),this.consumeAttributeSpace(B),lo.relPort=this.extract(B,this.consumePort));this.peekChar(B)===h;){this.consumeAttributeSpace(B);let Wu=this.extract(B,this.consumeToken);this.consumeAttributeSpace(B),lo.extension[Wu]=this.extractOneOrMore(B,R)}this.attributes.candidates.push(lo)}parseRemoteCandidate(B){let Ce=[];for(;;){let ke=this.extractOneOrMore(B,_,[1,5]);this.consumeAttributeSpace(B);let Ft=this.extract(B,this.consumeAddress);this.consumeAttributeSpace(B);let Mr=this.extract(B,this.consumePort);Ce.push({componentId:ke,connectionAddress:Ft,port:Mr});try{this.consumeAttributeSpace(B)}catch{break}}this.attributes.remoteCandidatesList.push(Ce)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(B){let Ce=this.extract(B,this.consumeToken);this.consumeAttributeSpace(B);let ke=this.extract(B,this.consumeTill,"/");this.extract(B,this.consume,"/");let Ft={encodingName:ke,clockRate:this.extractOneOrMore(B,_)};this.atEnd(B)||this.peekChar(B)!=="/"||(this.extract(B,this.consume,"/"),Ft.encodingParameters=parseInt(this.extract(B,this.consumeTill),10));let Mr=this.attributes.payloads.find(Dn=>Dn.payloadType===parseInt(Ce,10));Mr?Mr.rtpMap=Ft:this.attributes.payloads.push({payloadType:parseInt(Ce,10),rtpMap:Ft,rtcpFeedbacks:[]})}parsePtime(B){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(B,this.consumeTill)}parseMaxPtime(B){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(B,this.consumeTill)}parseDirection(B){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=B.attField}parseSSRC(B){let Ce=this.extractOneOrMore(B,_);this.consumeAttributeSpace(B);let ke=this.extract(B,this.consumeTill,":"),Ft;this.peekChar(B)===":"&&(this.extract(B,this.consume,":"),Ft=this.extract(B,this.consumeTill));let Mr=this.attributes.ssrcs.find(Dn=>Dn.ssrcId===parseInt(Ce,10));Mr?Mr.attributes[ke]=Ft:this.attributes.ssrcs.push({ssrcId:parseInt(Ce,10),attributes:{[ke]:Ft}})}parseFmtp(B){let Ce=this.extract(B,this.consumeTill,h);this.consumeAttributeSpace(B);let ke=this.extract(B,this.consumeTill),Ft={};ke.split(";").forEach(Dn=>{let[ki,lo]=Dn.split("=");ki=Ia(ki).call(ki);let Wu=typeof lo=="string"?Ia(lo).call(lo):null;typeof ki=="string"&&ki.length>0&&(Ft[ki]=Wu)});let Mr=this.attributes.payloads.find(Dn=>Dn.payloadType===parseInt(Ce,10));Mr?Mr.fmtp={parameters:Ft}:this.attributes.payloads.push({payloadType:parseInt(Ce,10),rtcpFeedbacks:[],fmtp:{parameters:Ft}})}parseFmtParameters(B){let Ce={},ke=this.extract(B,this.consumeTill,"=");B._cur++;let Ft=this.extract(B,this.consumeTill,";");for(Ce[ke]=Ft;B.attValue[B._cur]===";";){let Mr=this.extract(B,this.consumeTill,"=");B._cur++;let Dn=this.extract(B,this.consumeTill,";");Ce[Mr]=Dn}return Ce}parseRtcpFb(B){let Ce="";Ce=this.peekChar(B)==="*"?this.extract(B,this.consume,"*"):this.extract(B,this.consumeTill,h),this.consumeAttributeSpace(B);let ke=this.extract(B,this.consumeTill,h),Ft;if(ke==="trr-int")Ft={type:ke,interval:this.extract(B,this.consumeTill)};else{let Mr={type:ke};this.peekChar(B)===h&&(this.consumeAttributeSpace(B),Mr.parameter=this.extract(B,this.consumeToken),this.peekChar(B)===h&&(Mr.additional=this.extract(B,this.consumeTill))),Ft=Mr}if(Ce==="*")this.attributes.rtcpFeedbackWildcards.push(Ft);else{let Mr=this.attributes.payloads.find(Dn=>Dn.payloadType===parseInt(Ce,10));Mr?Mr.rtcpFeedbacks.push(Ft):this.attributes.payloads.push({payloadType:parseInt(Ce,10),rtcpFeedbacks:[Ft]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(B){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");let Ce={port:this.extract(B,this.consumePort)};this.peekChar(B)===h&&(this.consumeAttributeSpace(B),Ce.netType=this.extractOneOrMore(B,D),this.consumeAttributeSpace(B),Ce.addressType=this.extractOneOrMore(B,D),this.consumeAttributeSpace(B),Ce.address=this.extract(B,this.consumeAddress)),this.attributes.rtcp=Ce}parseMsid(B){let Ce={id:this.extractOneOrMore(B,D,[1,64])};this.peekChar(B)===h&&(this.consumeAttributeSpace(B),Ce.appdata=this.extractOneOrMore(B,D,[1,64])),this.attributes.msids.push(Ce)}parseImageAttr(B){this.attributes.imageattr.push(B.attValue)}parseRid(B){let Ce=this.extractOneOrMore(B,Ft=>V(Ft)||_(Ft)||Ft==="_"||Ft==="-");this.consumeAttributeSpace(B);let ke={id:Ce,direction:this.extract(B,this.consumeToken),params:[]};if(this.peekChar(B)===h){if(this.consumeAttributeSpace(B),this.peek(B,"pt=")){this.extract(B,this.consume,"pt=");let Ft=[];for(;;){let Mr=this.extract(B,this.consumeToken);Ft.push(Mr);try{this.extract(B,this.consume,",")}catch{break}}ke.payloads=Ft,this.peekChar(B)===h&&this.extract(B,this.consume,h)}for(;;){let Ft=this.extract(B,this.consumeToken);switch(Ft){case"depend":{let Mr={type:Ft,rids:this.extract(B,this.consume,"=").split(",")};ke.params.push(Mr);break}default:{let Mr={type:Ft};this.peekChar(B)==="="&&(this.extract(B,this.consume,"="),Mr.val=this.extract(B,this.consumeTill,";")),ke.params.push(Mr)}}try{this.extract(B,this.consume,";")}catch{break}}}this.attributes.rids.push(ke)}parseSimulcast(B){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=B.attValue,this.extract(B,this.consumeTill)}parseSctpPort(B){this.attributes.sctpPort=this.extractOneOrMore(B,_,[1,5])}parseMaxMessageSize(B){this.attributes.maxMessageSize=this.extractOneOrMore(B,_,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(B){this.attributes.mid=this.extract(B,this.consumeToken)}parseSSRCGroup(B){let Ce=this.extract(B,this.consumeToken),ke=[];for(;;)try{this.consumeAttributeSpace(B);let Ft=this.extract(B,this.consumeInteger);ke.push(parseInt(Ft,10))}catch{break}this.attributes.ssrcGroups.push({semantic:Ce,ssrcIds:ke})}}function wn(wt,B,Ce){return B in wt?Object.defineProperty(wt,B,{value:Ce,enumerable:!0,configurable:!0,writable:!0}):wt[B]=Ce,wt}class si{constructor(){wn(this,"eol",u)}print(B,Ce){let ke="";return Ce&&(this.eol=Ce),ke+=this.printVersion(B.version),ke+=this.printOrigin(B.origin),ke+=this.printSessionName(B.sessionName),ke+=this.printInformation(B.information),ke+=this.printUri(B.uri),ke+=this.printEmail(B.emails),ke+=this.printPhone(B.phones),ke+=this.printConnection(B.connection),ke+=this.printBandwidth(B.bandwidths),ke+=this.printTimeFields(B.timeFields),ke+=this.printKey(B.key),ke+=this.printSessionAttributes(B.attributes),ke+=this.printMediaDescription(B.mediaDescriptions),ke}printVersion(B){return"v=".concat(B).concat(this.eol)}printOrigin(B){return"o=".concat(B.username," ").concat(B.sessId," ").concat(B.sessVersion," ").concat(B.nettype," ").concat(B.addrtype," ").concat(B.unicastAddress).concat(this.eol)}printSessionName(B){return B?"s=".concat(B).concat(this.eol):""}printInformation(B){return B?"i=".concat(B).concat(this.eol):""}printUri(B){return B?"u=".concat(B).concat(this.eol):""}printEmail(B){let Ce="";for(let ke of B)Ce+="e=".concat(ke).concat(this.eol);return Ce}printPhone(B){let Ce="";for(let ke of B)Ce+="e=".concat(ke).concat(this.eol);return Ce}printConnection(B){return B?"c=".concat(B.nettype," ").concat(B.addrtype," ").concat(B.address).concat(this.eol):""}printBandwidth(B){let Ce="";for(let ke of B)Ce+="b=".concat(ke.bwtype,":").concat(ke.bandwidth).concat(this.eol);return Ce}printTimeFields(B){let Ce="";for(let ke of B){Ce+="t=".concat(ke.time.startTime," ").concat(ke.time.startTime).concat(this.eol);for(let Ft of ke.repeats)Ce+="r=".concat(Ft.repeatInterval," ").concat(Ft.typedTimes.join(" ")).concat(this.eol);ke.zoneAdjustments&&(Ce+="z=",Ce+="z=".concat(ke.zoneAdjustments.map(Ft=>"".concat(Ft.time," ").concat(Ft.back?"-":""," ").concat(Ft.typedTime)).join(" ")).concat(this.eol),Ce+=this.eol)}return Ce}printKey(B){return B?"k=".concat(B).concat(this.eol):""}printAttributes(B){let Ce="";for(let ke of B)Ce+="a=".concat(ke.attField).concat(ke.attValue?":".concat(ke.attValue):"").concat(this.eol);return Ce}printMediaDescription(B){let Ce="";for(let ke of B)Ce+=this.printMedia(ke.media),Ce+=this.printInformation(ke.information),Ce+=this.printConnections(ke.connections),Ce+=this.printBandwidth(ke.bandwidths),Ce+=this.printKey(ke.key),Ce+=this.printMediaAttributes(ke);return Ce}printConnections(B){let Ce="";for(let ke of B)Ce+=this.printConnection(ke);return Ce}printMedia(B){return"m=".concat(B.mediaType," ").concat(B.port," ").concat(B.protos.join("/")," ").concat(B.fmts.join(" ")).concat(this.eol)}printSessionAttributes(B){return new Xa(this.eol).print(B)}printMediaAttributes(B){return new Rt(this.eol).print(B)}}class ti{constructor(B){wn(this,"eol",void 0),this.eol=B}printIceUfrag(B){return B===void 0?"":"a=ice-ufrag:".concat(B).concat(this.eol)}printIcePwd(B){return B===void 0?"":"a=ice-pwd:".concat(B).concat(this.eol)}printIceOptions(B){return B===void 0?"":"a=ice-options:".concat(B.join(h)).concat(this.eol)}printFingerprints(B){return B.length>0?B.map(Ce=>"a=fingerprint:".concat(Ce.hashFunction).concat(h).concat(Ce.fingerprint)).join(this.eol)+this.eol:""}printExtmap(B){return B.map(Ce=>"a=extmap:".concat(Ce.entry).concat(Ce.direction?"/".concat(Ce.direction):"").concat(h).concat(Ce.extensionName).concat(Ce.extensionAttributes?"".concat(h).concat(Ce.extensionAttributes):"").concat(this.eol)).join("")}printSetup(B){return B===void 0?"":"a=setup:".concat(B).concat(this.eol)}printUnrecognized(B){return B.map(Ce=>"a=".concat(Ce.attField).concat(Ce.attValue?":".concat(Ce.attValue):"").concat(this.eol)).join("")}}class Xa extends ti{print(B){let Ce="";return Ce+=this.printGroups(B.groups),Ce+=this.printMsidSemantic(B.msidSemantic),Ce+=this.printIceLite(B.iceLite),Ce+=this.printIceUfrag(B.iceUfrag),Ce+=this.printIcePwd(B.icePwd),Ce+=this.printIceOptions(B.iceOptions),Ce+=this.printFingerprints(B.fingerprints),Ce+=this.printSetup(B.setup),Ce+=this.printTlsId(B.tlsId),Ce+=this.printIdentity(B.identities),Ce+=this.printExtmap(B.extmaps),Ce+=this.printUnrecognized(B.unrecognized),Ce}printGroups(B){let Ce="";return B.length>0&&(Ce+=B.map(ke=>"a=group:".concat(ke.semantic).concat(ke.identificationTag.map(Ft=>"".concat(h).concat(Ft)).join("")).concat(this.eol)).join("")),Ce}printIceLite(B){return B===void 0?"":"a=ice-lite"+this.eol}printTlsId(B){return B?"a=tls-id:".concat(B).concat(this.eol):""}printIdentity(B){return B.length===0?"":B.map(Ce=>"a=identity:".concat(Ce.assertionValue).concat(Ce.extensions.map(ke=>"".concat(h).concat(ke.name).concat(ke.value?"=".concat(ke.value):"")))).join(this.eol)+this.eol}printMsidSemantic(B){if(!B)return"";let Ce="a=msid-semantic:".concat(B.semantic);return B.applyForAll?Ce+="".concat(h,"*"):B.identifierList.length>0&&(Ce+=B.identifierList.map(ke=>"".concat(h).concat(ke))),Ce+this.eol}}class Rt extends ti{print(B){let Ce=B.attributes,ke="";return ke+=this.printRTCP(Ce.rtcp),ke+=this.printIceUfrag(Ce.iceUfrag),ke+=this.printIcePwd(Ce.icePwd),ke+=this.printIceOptions(Ce.iceOptions),ke+=this.printCandidates(Ce.candidates),ke+=this.printRemoteCandidatesList(Ce.remoteCandidatesList),ke+=this.printEndOfCandidates(Ce.endOfCandidates),ke+=this.printFingerprints(Ce.fingerprints),ke+=this.printSetup(Ce.setup),ke+=this.printMid(Ce.mid),ke+=this.printExtmap(Ce.extmaps),ke+=this.printRTPRelated(Ce),ke+=this.printPtime(Ce.ptime),ke+=this.printMaxPtime(Ce.maxPtime),ke+=this.printDirection(Ce.direction),ke+=this.printSSRCGroups(Ce.ssrcGroups),ke+=this.printSSRC(Ce.ssrcs),ke+=this.printRTCPMux(Ce.rtcpMux),ke+=this.printRTCPMuxOnly(Ce.rtcpMuxOnly),ke+=this.printRTCPRsize(Ce.rtcpRsize),ke+=this.printMSId(Ce.msids),ke+=this.printImageattr(Ce.imageattr),ke+=this.printRid(Ce.rids),ke+=this.printSimulcast(Ce.simulcast),ke+=this.printSCTPPort(Ce.sctpPort),ke+=this.printMaxMessageSize(Ce.maxMessageSize),ke+=this.printUnrecognized(Ce.unrecognized),ke}printCandidates(B){return B.map(Ce=>"a=candidate:".concat(Ce.foundation).concat(h).concat(Ce.componentId).concat(h).concat(Ce.transport).concat(h).concat(Ce.priority).concat(h).concat(Ce.connectionAddress).concat(h).concat(Ce.port).concat(h,"typ").concat(h).concat(Ce.type).concat(Ce.relAddr?"".concat(h,"raddr").concat(h).concat(Ce.relAddr):"").concat(Ce.relPort?"".concat(h,"rport").concat(h).concat(Ce.relPort):"").concat(Object.keys(Ce.extension).map(ke=>"".concat(h).concat(ke).concat(h).concat(Ce.extension[ke])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(B){return B.map(Ce=>"a=remote-candidates:".concat(Ce.join(h)).concat(this.eol)).join("")}printEndOfCandidates(B){return B===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(B){if(!B.payloads)return"";let Ce=B.payloads,ke="";ke+=B.rtcpFeedbackWildcards.map(Ft=>this.printRTCPFeedback("*",Ft)).join("");for(let Ft of Ce)ke+=this.printRtpMap(Ft.payloadType,Ft.rtpMap),ke+=this.printFmtp(Ft.payloadType,Ft.fmtp),ke+=Ft.rtcpFeedbacks.map(Mr=>this.printRTCPFeedback(Ft.payloadType,Mr)).join("");return ke}printFmtp(B,Ce){if(!Ce)return"";let ke=Object.keys(Ce.parameters);return ke.length===1&&Ce.parameters[ke[0]]===null?"a=fmtp:".concat(B).concat(h).concat(ke[0]).concat(this.eol):"a=fmtp:".concat(B).concat(h).concat(Object.keys(Ce.parameters).map(Ft=>"".concat(Ft,"=").concat(Ce.parameters[Ft])).join(";")).concat(this.eol)}printRtpMap(B,Ce){return Ce?"a=rtpmap:".concat(B).concat(h).concat(Ce.encodingName,"/").concat(Ce.clockRate).concat(Ce.encodingParameters?"/".concat(Ce.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(B,Ce){let ke="a=rtcp-fb:".concat(B).concat(h),Ft=Ce;return Ft.type==="trr-int"?ke+="ttr-int".concat(h).concat(Ft.interval):(ke+="".concat(Ft.type),Ft.parameter&&(ke+="".concat(h).concat(Ft.parameter),Ft.additional&&(ke+="".concat(h).concat(Ft.additional)))),ke+this.eol}printPtime(B){return B===void 0?"":"a=ptime:".concat(B).concat(this.eol)}printMaxPtime(B){return B===void 0?"":"a=maxptime:".concat(B).concat(this.eol)}printDirection(B){return B===void 0?"":"a=".concat(B).concat(this.eol)}printSSRC(B){return B.map(Ce=>Object.keys(Ce.attributes).map(ke=>"a=ssrc:".concat(Ce.ssrcId.toString(10)).concat(h).concat(ke).concat(Ce.attributes[ke]?":".concat(Ce.attributes[ke]):"").concat(this.eol)).join("")).join("")}printRTCPMux(B){return B===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(B){return B===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(B){return B===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(B){if(B===void 0)return"";let Ce="a=rtcp:".concat(B.port);return B.netType&&(Ce+="".concat(h).concat(B.netType)),B.addressType&&(Ce+="".concat(h).concat(B.addressType)),B.address&&(Ce+="".concat(h).concat(B.address)),Ce+this.eol}printMSId(B){return B.map(Ce=>"a=msid:".concat(Ce.id).concat(Ce.appdata?"".concat(h).concat(Ce.appdata):"").concat(this.eol)).join("")}printImageattr(B){return B.map(Ce=>"a=imageattr:".concat(Ce).concat(this.eol)).join("")}printRid(B){return B.map(Ce=>{let ke="a=rid:".concat(Ce.id).concat(h).concat(Ce.direction);return Ce.payloads&&(ke+="".concat(h,"pt=").concat(Ce.payloads.join(","))),Ce.params.length>0&&(ke+="".concat(h).concat(Ce.params.map(Ft=>Ft.type==="depend"?"depend=".concat(Ft.rids.join(",")):"".concat(Ft.type,"=").concat(Ft.val)).join(";"))),ke+this.eol}).join("")}printSimulcast(B){return B===void 0?"":"a=simulcast:".concat(B).concat(this.eol)}printSCTPPort(B){return B===void 0?"":"a=sctp-port:".concat(B).concat(this.eol)}printMaxMessageSize(B){return B===void 0?"":"a=max-message-size:".concat(B).concat(this.eol)}printMid(B){return B===void 0?"":"a=mid:".concat(B).concat(this.eol)}printSSRCGroups(B){return B.map(Ce=>"a=ssrc-group:".concat(Ce.semantic).concat(Ce.ssrcIds.map(ke=>"".concat(h).concat(ke.toString(10))).join("")).concat(this.eol)).join("")}}function Yt(wt){return new ar().parse(wt)}function fr(wt,B){return new si().print(wt,B)}}},t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{}};return e[n](i,i.exports,r),i.exports}return r.d=(n,i)=>{for(var o in i)r.o(i,o)&&!r.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:i[o]})},r.o=(n,i)=>Object.prototype.hasOwnProperty.call(n,i),r.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},r(8)})();function ao(e){return wP.parse(e)}function zd(e,t){return wP.print(e,t)}var q6=Ba("Array").keys,Y6=Zo,X6=Jt,J6=v,Z6=q6,yA=Array.prototype,Q6={DOMTokenList:!0,NodeList:!0},$6=function(e){var t=e.keys;return e===yA||J6(yA,e)&&t===yA.keys||X6(Q6,Y6(e))?Z6:t},Mo=fe($6);function DP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function jr(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?DP(Object(r),!0).forEach(function(n){Qn(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):DP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Qn(e,t,r){return(t=function(n){var i=function(o,l){if(typeof o!="object"||o===null)return o;var u=o[Symbol.toPrimitive];if(u!==void 0){var h=u.call(o,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(n);return typeof i=="symbol"?i:String(i)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let PP=new class extends zn{constructor(){super(...arguments),Qn(this,"currentUploadLogID",0)}reportLogUploadError(e){let{errorRange:t}=e;t[t.length-1]&&t[t.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=t[t.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class eF{constructor(t){Qn(this,"logger",void 0),Qn(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logger.debug(...this.prefixLists,...r)}info(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logger.info(...this.prefixLists,...r)}warning(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logger.warning(...this.prefixLists,...r)}error(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];this.logger.error(...this.prefixLists,...r)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function SA(){let e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function LP(){let e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?t?.[0]+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}let ps={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},eR=Date.now(),Jg=e=>{for(let t in ps)if(Object.prototype.hasOwnProperty.call(ps,t)&&ps[t]===e)return t;return"DEFAULT"},L=new class{constructor(){Qn(this,"proxyServerURL",void 0),Qn(this,"logLevel",ps.DEBUG),Qn(this,"uploadState","collecting"),Qn(this,"uploadLogWaitingList",[]),Qn(this,"uploadLogUploadingList",[]),Qn(this,"uploadErrorCount",0),Qn(this,"currentLogID",0),Qn(this,"url",void 0),Qn(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[ps.DEBUG].concat(t);this.log.apply(this,n)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[ps.INFO].concat(t);this.log.apply(this,n)}warning(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[ps.WARNING].concat(t);this.log.apply(this,n)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[ps.ERROR].concat(t);this.log.apply(this,n)}upload(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n=[ps.DEBUG].concat(t);this.uploadLog.apply(this,n)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){pn("UPLOAD_LOG",!0)}disableLogUpload(){pn("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new eF(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-eR<100)return void setTimeout(()=>{this.log(...t)},Date.now()-eR);let n=Math.max(0,Math.min(4,t[0]));if(t[0]=SA()+" Agora-SDK [".concat(Jg(n),"]:"),this.appendLogToWaitingList(n,...t),n<this.logLevel)return;let i=SA()+" %cAgora-SDK [".concat(Jg(n),"]:"),o=[];if(!Se("USE_NEW_LOG"))switch(n){case ps.DEBUG:o=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case ps.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case ps.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case ps.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(Date.now()-eR<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-eR);let n=Math.max(0,Math.min(4,t[0]));t[0]=SA()+" Agora-SDK [".concat(Jg(n),"]:"),this.appendLogToWaitingList(n,...t)}appendLogToWaitingList(e){if(!Se("UPLOAD_LOG"))return;for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];Array.isArray(r[0])?r[0][0]=LP()+" Agora-SDK [".concat(Jg(e),"]:"):r[0]=LP()+" Agora-SDK [".concat(Jg(e),"]:");let i="";r.forEach(o=>{typeof o=="object"&&(o=JSON.stringify(o)),i+="".concat(o," ")}),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){let e=this.uploadLogUploadingList,t={sdk_version:hs,process_id:Se("PROCESS_ID"),payload:JSON.stringify(e)};return xc(async()=>{let r=await Ha.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Se("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Se("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(r.data!=="OK"){let n=new Error("unexpected upload log response");throw n.response=r,n}},()=>(this.uploadLogUploadingList=[],!1),r=>{let n={status:-1,message:r.message,errorRange:e.map(i=>i.log_item_id)};return r.response?(n.status=r.response.status,n.data=r.response.data,n.headers=r.response.headers):r.request&&(n.status=r.request.status),PP.reportLogUploadError(n),!0},{timeout:Se("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Se("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Se("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Se("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Se("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Se("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var kP;function tF(e){return qi(e.reportId,"params.reportId",0,100,!1),qi(e.category,"params.category",0,100,!1),qi(e.event,"params.event",0,100,!1),qi(e.label,"params.label",0,100,!1),vn(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(kP={}).FREE="free",kP.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});let rF={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0},Pi=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),Hn=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let nF=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function Nr(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,r,n){let i=n.value;if(typeof i=="function"){let o=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);n.value=function(){for(var l,u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];let _=h;if(e.argsMap)try{_=e.argsMap(this,...h)}catch(A){L.warning(A),_=[]}try{JSON.stringify(_)}catch{L.warning("arguments for method ".concat(o,".").concat(String(r)," not serializable for apiInvoke.")),_=[]}let R=(e.report||gr).reportApiInvoke(this._sessionId||null,{id:this._clientId||((l=this.store)===null||l===void 0?void 0:l.clientId)||this._ID,name:"".concat(o,".").concat(String(r)),options:_,tag:Jn.TRACER,reportResult:e.reportResult},e.throttleTime);try{let A=i.apply(this,h);return A instanceof tr?A.then(D=>(R.onSuccess(e.reportResult&&D),D)).catch(D=>{throw R.onError(D),D}):(R.onSuccess(e.reportResult&&A),A)}catch(A){throw R.onError(A),A}}}return n}}let gr=new class{constructor(){Qn(this,"baseInfoMap",new Map),Qn(this,"proxyServer",void 0),Qn(this,"eventUploadTimer",void 0),Qn(this,"setSessionIdTimer",void 0),Qn(this,"url",void 0),Qn(this,"sids",new Set),Qn(this,"backupUrl",void 0),Qn(this,"_appId",void 0),Qn(this,"_aid",0),Qn(this,"keyEventUploadPendingItems",[]),Qn(this,"normalEventUploadPendingItems",[]),Qn(this,"apiInvokeUploadPendingItems",[]),Qn(this,"apiInvokeCount",0),Qn(this,"apiInvokeLoggedCount",0),Qn(this,"ltsList",[]),Qn(this,"lastSendNormalEventTime",Date.now()),Qn(this,"customReportCounterTimer",void 0),Qn(this,"customReportCount",0),Qn(this,"extApiInvoke",async e=>{for(let t of e){let r=jr(jr({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Jn.TRACER});this.sendApiInvoke(r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Se("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Se("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,t=>{let[r,n]=t;return r+n}),16)||0}reportApiInvoke(e,t,r){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;let n=Date.now();this.apiInvokeCount+=1;let i=this.apiInvokeCount,o=!!Se("SHOW_REPORT_INVOKER_LOG"),l=!!Se("SHOW_REPORT_USER_INVOKER_LOG"),u=o||l&&t.id;u&&(this.apiInvokeLoggedCount+=1);let h=this.apiInvokeLoggedCount;function m(D,J){if(u){let V="[apiInvoke-".concat(h,"]");t.id&&(V+="[".concat(t.id,"]")),t.name&&(V+="[".concat(t.name,"]")),L.info("".concat(V," ").concat(D),D==="start"?t.options:J||"")}}let _=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:n,options:t.options,states:t.states||null});m("start");let R=!1;Yi(t.timeout).then(()=>{R||(this.sendApiInvoke(jr(jr({},_()),{},{error:ce.API_INVOKE_TIMEOUT,success:!1})),m("timeout"))});let A=new Et(ce.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:D=>{let J=()=>{if(R)throw A;return R=!0,this.sendApiInvoke(jr(jr({},_()),{},{success:!0},t.reportResult&&{result:D})),m("onSuccess"),D};return r?pP(J,t.name+"Success",r,()=>R=!0):J()},onError:D=>{let J=()=>{if(R)throw D;R=!0,this.sendApiInvoke(jr(jr({},_()),{},{success:!1,error:D})),m("onFailure",D.toString())};return r?pP(J,t.name+"Error",r,()=>R=!0):J()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;let r=Date.now(),n=this.createBaseInfo(e,r);n.cname=t.cname;let i=Object.assign({},{willUploadConsoleLog:Se("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:_A?"global":"oversea",areas:Se("AREAS")&&Se("AREAS").join(",")},t.extend),{stringUid:o,channelProfile:l,channelMode:u,isABTestSuccess:h,lsid:m,clientRole:_}=t,R=Date.now(),A=jr(jr({},n),{},{eventType:Pi.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,buildFormat:t.buildFormat,build:vA,lts:R,elapse:R-r,extend:JSON.stringify(i),mode:t.mode,process:Se("PROCESS_ID"),appType:Se("APP_TYPE"),success:!0,version:hs,stringUid:o,channelProfile:l,channelMode:u,isABTestSuccess:h,lsid:m,clientType:Qt(D=window.navigator.userAgent).call(D,"AgoraWebView")?42:20,clientRole:_,serviceId:Se("PROCESS_ID"),extensionID:Se("PLUGIN_INFO").join(",")||""});var D;this.send({type:Hn.SESSION,data:A},!0)}joinChooseServer(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr({},n),{},{role:t.role,eventType:Pi.JOIN_CHOOSE_SERVER,lts:i,eventElapse:t.elapse||i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-r.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3,corssRegionTagReq:t.corssRegionTagReq||void 0,corssRegionTagRes:t.corssRegionTagRes||void 0});this.send({type:Hn.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr({},n),{},{eventType:Pi.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:t.elapse||i-r.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Hn.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info;t.vid&&(n.vid=t.vid),n.uid=t.uid,n.cid=t.cid;let i=Date.now(),{firstSuccess:o,avoidJoinStartTime:l,addr:u,isProxy:h}=t,m=i-(o&&l?l:r.startTime),_=jr(jr({},n),{},{eventType:Pi.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,errorMsg:t.errorMsg||"",elapse:m,eventElapse:i-t.lts,firstSuccess:o,signalChannel:t.signalChannel,preload:t.preload?1:0,installId:EA(),isABTestSuccess:t.isABTestSuccess?1:0}),R=_.success?1:0;if(t.succ&&(r.lastJoinSuccessTime=i),o)this.send({type:Hn.JOIN_GATEWAY,data:_},!0);else{let A;if(u)if(h){let J=u.match(/h=(\d{1,3}-){3}\d{1,3}/g),V=u.match(/p=[0-9]{1,6}/g);A={isSuccess:R,gatewayIp:J&&J.length?J[0].split("=")[1].replace(/-/g,"."):"",port:V&&V.length?V[0].split("=")[1]:"",isProxy:h?1:0}}else{let J=u.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),V=u.match(/(:|p=)[0-9]{1,6}/g);A={isSuccess:R,gatewayIp:J&&J.length?J[0].split("//")[1].replace(/-/g,"."):"",port:V&&V.length?V[0].split(/:|p=/g)[1]:"",isProxy:h?1:0}}else A={isSuccess:R,gatewayIp:"",port:"",isProxy:h?1:0};delete _.success,delete _.eventType,delete _.firstSuccess,_.vid=Number(_.vid);let D=Object.assign({},_,A,{eventType:Pi.REJOIN_GATEWAY});this.send({type:Hn.RE_JOIN_GATEWAY,data:D},!0)}}joinChannelTimeout(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=Date.now(),i=jr(jr({},r.info),{},{lts:n,timeout:t,elapse:n-r.startTime});this.send({type:Hn.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr({},n),{},{eventType:Pi.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-r.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Hn.PUBLISH,data:o},!0)}subscribe(e,t,r){let n=this.baseInfoMap.get(e);if(!n)return;let i=n.info,o=Date.now(),l=jr(jr({},i),{},{eventType:Pi.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid,preSsrc:t.preSsrc?1:0},r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?l.peerSuid=t.peerid:l.peer=t.peerid,this.send({type:Hn.SUBSCRIBE,data:l},!0)}wsCompressorInit(e){var t;let r=[...Mo(t=this.baseInfoMap).call(t)],n=r.length?r[0]:"UnableToGetSid",i=this.baseInfoMap.get(n);if(!i)return;let o=i.info,l=Date.now(),u=jr(jr({},o),{},{eventType:Pi.WS_COMPRESSOR_INIT,lts:l,eventElapse:e.eventElapse,elapse:l-i.startTime,status:e.status?1:2});this.send({type:Hn.WS_COMPRESSOR_INIT,data:u},!0)}firstRemoteVideoDecode(e,t,r,n){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,l=Date.now(),u=jr(jr(jr({},o),n),{},{elapse:l-i.startTime,eventType:t,lts:l,firstDecodeFrame:Math.max((n.firstFrame||l)-i.startTime,0),apEnd:Math.max(n.apEnd-i.startTime,0),apStart:Math.max(n.apStart-i.startTime,0),joinGwEnd:Math.max(n.joinGwEnd-i.startTime,0),joinGwStart:Math.max(n.joinGwStart-i.startTime,0),pcEnd:Math.max(n.pcEnd-i.startTime,0),pcStart:Math.max(n.pcStart-i.startTime,0),subscriberEnd:Math.max(n.subscriberEnd-i.startTime,0),subscriberStart:Math.max(n.subscriberStart-i.startTime,0),videoAddNotify:Math.max(n.videoAddNotify-i.startTime,0)});this.send({type:r,data:u},!0)}firstRemoteFrame(e,t,r,n){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,l=Date.now(),u=jr(jr(jr({},o),n),{},{elapse:l-i.startTime,eventType:t,lts:l});this.send({type:r,data:u},!0)}abTest(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr(jr({},n),t),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:i-r.startTime,eventType:Pi.AB_TEST,lts:i});this.send({type:Hn.AB_TEST,data:o},!0)}pcStats(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr(jr({},n),t),{},{vid:n.vid===void 0?0:Number(n.vid),elapse:i-r.startTime,eventType:Pi.PC_STATS,lts:i,preallocation:t.preallocation?1:0});this.send({type:Hn.PC_STATS,data:o},!0)}updateRemoteRTPCapabilities(e,t){if(e){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr(jr({},n),t),{},{vid:n.vid===void 0?0:Number(n.vid),eventType:Pi.UPDATE_REMOTE_RTPCAPABILITIES,lts:i});this.send({type:Hn.UPDATE_REMOTE_RTPCAPABILITIES,data:o},!0)}}onGatewayStream(e,t,r,n){let i=this.baseInfoMap.get(e);if(!i)return;let o=i.info,l=Date.now(),u=jr(jr(jr({},o),n),{},{eventType:t,lts:l});this.send({type:r,data:u},!0)}streamSwitch(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr({},n),{},{eventType:Pi.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-r.startTime,success:t.succ});this.send({type:Hn.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr({},n),{},{eventType:Pi.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-r.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Hn.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr({},n),{},{eventType:Pi.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-r.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Hn.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?L.debug("reportProxyServerurl: ".concat(e)):L.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr({},n),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-r.startTime,joinChannelSuccessElapse:i-(r.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Hn.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now();(function(o,l,u){let h=o[l];if(!h||typeof h!="string")return[o];o[l]="";let m=Dl(JSON.stringify(o)),_=0,R=[],A=0;for(let D=0;D<h.length;D++)A+=h.charCodeAt(D)<=127?1:3,A<=u-m||(R[R.length]=cr(cr({},o),{},{[l]:h.substring(_,D)}),_=D,A=h.charCodeAt(D)<=127?1:3);return _!==h.length-1&&(R[R.length]=cr(cr({},o),{},{[l]:h.substring(_)})),R})(jr(jr(jr({},n),t),{},{elapse:i-r.startTime,lts:i,productType:"WebRTC"}),"payload",1300).forEach(o=>this.send({type:Hn.WORKER_EVENT,data:o},!0))}apworkerEvent(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr(jr({},n),t),{},{elapse:i-r.startTime,lts:i});this.send({type:Hn.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr(jr({},n),t),{},{elapse:i-r.startTime,lts:i,extend:t.extend||void 0});this.send({type:Hn.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){let r=this.baseInfoMap.get(e);if(!r)return;let n=r.info,i=Date.now(),o=jr(jr(jr({},n),t),{},{elapse:i-r.startTime,lts:i});this.send({type:Hn.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>Se("CUSTOM_REPORT_LIMIT"))throw new Et(ce.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));let r=Date.now(),n=t.map(i=>({type:Hn.USER_ANALYTICS,data:jr(jr({sid:e},i),{},{lts:r})}));try{Se("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(n):await this.postDataToStatsCollector(n)}catch(i){throw L.error("send custom report message failed",i.toString()),new Et(ce.CUSTOM_REPORT_SEND_FAILED,i.message)}}sendApiInvoke(e){let t=Se("NOT_REPORT_EVENT");if(e.tag&&Qt(t)&&Qt(t).call(t,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;let r=this.baseInfoMap.get(e.sid);if(!r)return this.apiInvokeUploadPendingItems.push(e),!1;let{cname:n,uid:i,cid:o}=r.info,l;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Et){let{code:h,message:m}=e.error;l=h||m||e.error.toString()}else l=e.error.toString();let u={invokeId:e.invokeId,sid:e.sid,cname:n,cid:o,uid:i,lts:e.lts,success:e.success,elapse:e.lts-r.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?l:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Hn.API_INVOKE,data:u},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){let e=this.apiInvokeUploadPendingItems;if(e.length===0)return;let t=Array.from(this.sids).find(r=>r!==null);t&&e.forEach(r=>{r&&(r.sid=t,this.sendApiInvoke(Object.assign({},r)))}),e.length=0}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>Se("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){let r=[],n=[];for(;e.length;){let o=e.shift();r.length<20?r.push(o):n.push(o)}e.push(...n);for(let o of[...r]){var i;this.ltsList.indexOf(o.data.lts)!==-1?(o.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(o.data.lts)):(this.ltsList.push(o.data.lts),Ng(i=this.ltsList).call(i,(l,u)=>l-u))}return t||(this.lastSendNormalEventTime=Date.now()),Se("ENABLE_EVENT_REPORT")&&r.length&&(Se("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(r):this.postDataToStatsCollector(r)).catch((o=>l=>{Se("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(o):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(o),this.normalEventUploadPendingItems.length>Se("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Se("NORMAL_EVENT_QUEUE_CAPACITY")),L.warning("report: drop normal events"))))})(r)),e}async postDataToStatsCollector2(e){pi.networkState===To.OFFLINE&&await tr.race([pi.onlineWaiter,Yi(2*vi.maxRetryTimeout)]);let t=i=>{let o=new Uint8Array;return i.forEach(l=>{let u=iA(JSON.stringify(l.data)),h=new ArrayBuffer(5),m=(R=>{let A=0;return Object.entries(Hn).forEach(D=>{let[J,V]=D;V===R.type&&(A=nF[J])}),A})(l),_=new DataView(h);_.setUint16(0,u.byteLength,!0),_.setUint8(2,255&m),_.setUint8(3,m>>>8&255),_.setUint8(4,m>>>16&255),o=iP(o,new Uint8Array(h)),o=iP(o,u)}),o},r="event",n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Se("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(r):"https://".concat(Se("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(r);for(let i=0;i<2;i+=1){i===1&&(n=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Se("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(r):"https://".concat(Se("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(r));try{await dA(n,{timeout:1e4,data:t(e),headers:jr(jr({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(o){if(i===1)throw o;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=(u=>{let h=u&&u.data.sid&&this.baseInfoMap.get(u.data.sid);return h&&h.info.vid&&+h.info.vid||0})(e[0]),n=r?void 0:this._aid,i={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(u=>JSON.stringify(u)),vid:r,aid:n};pi.networkState===To.OFFLINE&&await tr.race([pi.onlineWaiter,Yi(2*vi.maxRetryTimeout)]);let o=t?"/events/proto-raws":"/events/messages",l=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Se("EVENT_REPORT_DOMAIN"),"&p=").concat(Se("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(Se("EVENT_REPORT_DOMAIN"),":").concat(Se("STATS_COLLECTOR_PORT")).concat(o));for(let u=0;u<2;u+=1){u===1&&(l=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Se("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Se("STATS_COLLECTOR_PORT"),"&d=").concat(o):"https://".concat(Se("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Se("STATS_COLLECTOR_PORT")).concat(o)));try{t?await G6(l,{timeout:1e4,data:i}):await dA(l,{timeout:1e4,data:i})}catch(h){if(u===1)throw h;continue}return}}createBaseInfo(e,t){let r=Object.assign({},rF);return r.sid=e,this.baseInfoMap.set(e,{info:r,startTime:t}),r}reportResourceTiming(e,t){let r=performance.getEntriesByName(e),n=r[r.length-1];n&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:n,tag:Jn.TRACER}).onSuccess()}};PP.on("REPORT_LOG_UPLOAD",e=>{e.networkState=pi.networkState,gr.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Jn.TRACER}).onSuccess("logUploadError")});class at extends Et{constructor(t){super(t,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),Qn(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(t,L)}throw(){super.throw(L)}}let Xi={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function rn(){return Xi}function MP(){return"setSinkId"in HTMLAudioElement.prototype&&(!Se("RESTRICTION_SET_PLAYBACK_DEVICE")||(Nu()||z1())&&!tA())}function UP(){return!Xi.supportUnifiedPlan||Se("CHROME_FORCE_PLAN_B")&&wu()}let Ji=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function tE(e,t,r){return{sampleRate:e,stereo:t,bitrate:r}}function en(e,t,r,n,i){return{width:e,height:t,frameRate:r,bitrateMin:n,bitrateMax:i}}function Ys(e,t,r,n,i){return{width:{max:e},height:{max:t},frameRate:r,bitrateMin:n,bitrateMax:i}}function RA(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}let iF={"90p":en(160,90),"90p_1":en(160,90),"120p":en(160,120,15,30,65),"120p_1":en(160,120,15,30,65),"120p_3":en(120,120,15,30,50),"120p_4":en(212,120),"180p":en(320,180,15,30,140),"180p_1":en(320,180,15,30,140),"180p_3":en(180,180,15,30,100),"180p_4":en(240,180,15,30,120),"240p":en(320,240,15,40,200),"240p_1":en(320,240,15,40,200),"240p_3":en(240,240,15,40,140),"240p_4":en(424,240,15,40,220),"360p":en(640,360,15,80,400),"360p_1":en(640,360,15,80,400),"360p_3":en(360,360,15,80,260),"360p_4":en(640,360,30,80,600),"360p_6":en(360,360,30,80,400),"360p_7":en(480,360,15,80,320),"360p_8":en(480,360,30,80,490),"360p_9":en(640,360,15,80,800),"360p_10":en(640,360,24,80,800),"360p_11":en(640,360,24,80,1e3),"480p":en(640,480,15,100,500),"480p_1":en(640,480,15,100,500),"480p_2":en(640,480,30,100,1e3),"480p_3":en(480,480,15,100,400),"480p_4":en(640,480,30,100,750),"480p_6":en(480,480,30,100,600),"480p_8":en(848,480,15,100,610),"480p_9":en(848,480,30,100,930),"480p_10":en(640,480,10,100,400),"720p":en(1280,720,15,120,1130),"720p_auto":en(1280,720,30,900,3e3),"720p_1":en(1280,720,15,120,1130),"720p_2":en(1280,720,30,120,2e3),"720p_3":en(1280,720,30,120,1710),"720p_5":en(960,720,15,120,910),"720p_6":en(960,720,30,120,1380),"1080p":en(1920,1080,15,120,2080),"1080p_1":en(1920,1080,15,120,2080),"1080p_2":en(1920,1080,30,120,3e3),"1080p_3":en(1920,1080,30,120,3150),"1080p_5":en(1920,1080,60,120,4780),"1440p":en(2560,1440,30,120,4850),"1440p_1":en(2560,1440,30,120,4850),"1440p_2":en(2560,1440,60,120,7350),"4k":en(3840,2160,30,120,8910),"4k_1":en(3840,2160,30,120,8910),"4k_3":en(3840,2160,60,120,13500)},aF={"480p":Ys(640,480,5),"480p_1":Ys(640,480,5),"480p_2":Ys(640,480,30),"480p_3":Ys(640,480,15),"720p":Ys(1280,720,5),"720p_auto":en(1280,720,30,900,3e3),"720p_1":Ys(1280,720,5),"720p_2":Ys(1280,720,30),"720p_3":Ys(1280,720,15),"1080p":Ys(1920,1080,5),"1080p_1":Ys(1920,1080,5),"1080p_2":Ys(1920,1080,30),"1080p_3":Ys(1920,1080,15)},oF={"1SL1TL":RA(1,1),"3SL3TL":RA(3,3),"2SL3TL":RA(2,3)};function Ll(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},iF[e]):e}function CA(e){return typeof e=="string"?Object.assign({},aF[e]):e}function tR(e){return typeof e=="string"?Object.assign({},oF[e]):e}let sF={speech_low_quality:tE(16e3,!1),speech_standard:tE(32e3,!1,18),music_standard:tE(48e3,!1),standard_stereo:tE(48e3,!0,56),high_quality:tE(48e3,!1,128),high_quality_stereo:tE(48e3,!0,192)};function rR(e){return typeof e=="string"?Object.assign({},sF[e]):e}let rE=[];function xP(e){return bi(e,"mediaSource",["screen","window","application"]),!0}let hr=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),Nn=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),nE=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),cF=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),lF=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),Op=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),iE=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),aE=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e}({}),oE=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),Uo=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});let IA={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},AA={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},jP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},uF={uplinkNetworkQuality:0,downlinkNetworkQuality:0},BP={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},La=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),xo=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),Zg=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),Np=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),Aa=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),kl=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({}),bA={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370},nR=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function VP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Wn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?VP(Object(r),!0).forEach(function(n){nt(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VP(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nt(e,t,r){return(t=function(n){var i=function(o,l){if(typeof o!="object"||o===null)return o;var u=o[Symbol.toPrimitive];if(u!==void 0){var h=u.call(o,"string");if(typeof h!="object")return h;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(o)}(n);return typeof i=="symbol"?i:String(i)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tn(e,t,r,n,i){var o,l,u={};return Object.keys(n).forEach(function(h){u[h]=n[h]}),u.enumerable=!!u.enumerable,u.configurable=!!u.configurable,("value"in u||u.initializer)&&(u.writable=!0),u=wa(o=Ih(l=r.slice()).call(l)).call(o,function(h,m){return m(e,t,h)||h},u),i&&u.initializer!==void 0&&(u.value=u.initializer?u.initializer.call(i):void 0,u.initializer=void 0),u.initializer===void 0&&(Object.defineProperty(e,t,u),u=null),u}class FP extends zn{set _mediaStreamTrack(t){t!==this.mediaStreamTrack&&(this.safeEmit(Op.TRACK_UPDATED,t),this.mediaStreamTrack=t)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(t,r){super(),nt(this,"trackMediaType",void 0),nt(this,"_ID",void 0),nt(this,"_rtpTransceiver",void 0),nt(this,"_lowRtpTransceiver",void 0),nt(this,"_hints",[]),nt(this,"_isClosed",!1),nt(this,"_originMediaStreamTrack",void 0),nt(this,"mediaStreamTrack",void 0),nt(this,"_external",{}),this._ID=r||On(8,"track-"),this._originMediaStreamTrack=t,this.mediaStreamTrack=t,function(n){Qt(rE).call(rE,n)||rE.push(n)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){return t||Wd(()=>{var r;gr.reportApiInvoke(null,{name:gi.GET_MEDIA_STREAM_TRACK,options:[],tag:Jn.TRACER}).onSuccess(((r=this._mediaStreamTrack)===null||r===void 0?void 0:r.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===nE.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){let r=rE.indexOf(t);r!==-1&&rE.splice(r,1)}(this),this.emit(iE.CLOSED),this.removeAllListeners(Op.SEI_RECEIVED)}_updateRtpTransceiver(t,r){if(r===nE.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Op.TRANSCEIVER_UPDATED,t,r)}}class sE extends FP{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(t,r){super(t,r),nt(this,"_enabled",!0),nt(this,"_muted",!1),nt(this,"_isExternalTrack",!1),nt(this,"_isClosed",!1),nt(this,"_enabledMutex",void 0),nt(this,"processor",void 0),nt(this,"_processorContext",void 0),nt(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new da("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,r;return(t=(r=this._originMediaStreamTrack)===null||r===void 0?void 0:r.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,L.debug("[".concat(this.getTrackId(),"] close")),this.emit(hr.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,r){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=n,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await bn(this,hr.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(iE.TRACK_ENDED)}stateCheck(t,r){if(L.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(r,"]")),Du(r,t),this._enabled&&this._muted&&t==="enabled"&&r===!1)throw new Et(ce.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",L);if(!this._enabled&&!this._muted&&t==="muted"&&r===!0)throw new Et(ce.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",L)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():tr.resolve([])}}let GP=window.AudioContext||window.webkitAudioContext,jo=null,fn=new class extends zn{constructor(){super(...arguments),nt(this,"prevState",void 0),nt(this,"curState",void 0),nt(this,"currentTime",void 0),nt(this,"currentTimeStuckAt",void 0),nt(this,"interruptDetectorTrack",void 0),nt(this,"onLocalAudioTrackMute",()=>{L.info("ios15-interruption-start"),this.emit(Ji.IOS_15_16_INTERRUPTION_START)}),nt(this,"onLocalAudioTrackUnmute",async()=>{L.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?L.info("ios15-interruption-end-canceled"):(jo&&await jo.suspend(),this.emit(Ji.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){L.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){L.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function cE(){if(!jo){if(function(){if(!GP)return void L.error("your browser is not support web audio");L.info("create audio context");let e=Wn({},Se("WEBAUDIO_INIT_OPTIONS"));L.debug("audio context init option:",JSON.stringify(e)),jo=new GP(e),fn.curState=jo.state,jo.onstatechange=()=>{fn.prevState=fn.curState,fn.curState=jo?jo.state:void 0;let{prevState:t,curState:r}=fn,n=r==="running",i=r==="interrupted",o=t==="running",l=t==="suspended",u=t==="interrupted",h=$r().osVersion;(Pa()||zs())&&o&&i&&(L.info("ios".concat(h,"-interruption-start")),fn.emit(Ji.IOS_INTERRUPTION_START)),(Pa()||zs())&&(l||u)&&n&&(L.info("ios".concat(h,"-interruption-end")),fn.emit(Ji.IOS_INTERRUPTION_END)),t!==r&&fn.emit(Ji.STATE_CHANGE,r,t)},setInterval(()=>{var t;let r=(t=jo)===null||t===void 0?void 0:t.currentTime;fn.currentTime!==r?(fn.currentTimeStuckAt&&(L.debug("AudioContext current time resume at ".concat(r)),fn.currentTimeStuckAt=void 0),fn.currentTime=r):(r!==fn.currentTimeStuckAt&&(gr.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:r},tag:Jn.TRACER}).onSuccess(),L.warning("AudioContext current time stuck at ".concat(r))),fn.currentTimeStuckAt=r)},5e3),async function(t){let r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"],n,i=!1,o=!1,l=!1;function u(V){t.state==="running"?h(!1):Pa()||zs()?t.state==="suspended"&&(h(!0),V&&t.resume().then(m,m)):t.state!=="closed"&&(h(!0),V&&t.resume().then(m,m))}function h(V){if(i!==V){i=V;for(let K=0,se=r;K<se.length;K+=1){let ue=se[K];V?window.addEventListener(ue,_,{capture:!0,passive:!0}):window.removeEventListener(ue,_,{capture:!0,passive:!0})}}}function m(){u(!1)}function _(){u(!0)}function R(V){if(!l)if(n.paused)if(V){let K;A(!1),l=!0;try{K=n.play(),K?K.then(D,D):(n.addEventListener("playing",D),n.addEventListener("abort",D),n.addEventListener("error",D))}catch{D()}}else A(!0);else A(!1)}function A(V){if(o!==V){o=V;for(let K=0,se=r;K<se.length;K++){let ue=se[K];V?window.addEventListener(ue,J,{capture:!0,passive:!0}):window.removeEventListener(ue,J,{capture:!0,passive:!0})}}}function D(){n.removeEventListener("playing",D),n.removeEventListener("abort",D),n.removeEventListener("error",D),l=!1,R(!1)}function J(){R(!0)}if(Pa()){let V=t.createMediaStreamDestination(),K=document.createElement("div");K.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=K.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=V.stream,R(!0)}fn.on(Ji.STATE_CHANGE,function(){u(!0)}),u(!1)}(jo)}(),!jo)throw new Et(ce.NOT_SUPPORTED,"can not create audio context");return jo}return jo}function wp(e){if(function(){if(OA!==null)return OA;let n=cE(),i=n.createBufferSource(),o=n.createGain(),l=n.createGain();i.connect(o),i.connect(l),i.disconnect(o);let u=!1;try{i.disconnect(o)}catch{u=!0}return i.disconnect(),OA=u,u}())return;let t=e.connect,r=e.disconnect;e.connect=(n,i,o)=>{var l;return e._inputNodes||(e._inputNodes=[]),Qt(l=e._inputNodes).call(l,n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,i,o)):t.call(e,n,i)),e},e.disconnect=(n,i,o)=>{r.call(e),n?zS(e._inputNodes,n):e._inputNodes=[];for(let l of e._inputNodes)t.call(e,l)}}let OA=null;function NA(e,t){let r=!1,n=1/t;if(Se("DISABLE_WEBAUDIO")){let i=window.setInterval(()=>{r?window.clearInterval(i):e(performance.now()/1e3)},1e3*n)}else{let i=cE(),o=i.createGain();o.gain.value=0,o.connect(i.destination);let l=()=>{if(r)return void(o=null);let u=i.createOscillator();u.onended=l,u.connect(o),u.start(0),u.stop(i.currentTime+n),e(i.currentTime)};l()}return()=>{r=!0}}class HP{constructor(){nt(this,"context",void 0),nt(this,"analyserNode",void 0),nt(this,"sourceNode",void 0),this.context=cE(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t?.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Pa()||zs()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;let t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{let n=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(n);for(let i=0;i<t.length;++i)t[i]=n[i]/128-1}let r=wa(t).call(t,(n,i)=>n+i*i,0)/t.length;return Math.max(10*Math.log10(r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,r;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(r=this.sourceNode)===null||r===void 0||r.connect(this.analyserNode)}catch{L.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class WP extends zn{get processSourceNode(){return this.sourceNode}set processedNode(t){var r;if(!this.isDestroyed&&this._processedNode!==t){try{var n;(n=this.sourceNode)===null||n===void 0||n.disconnect(this.outputNode)}catch{}(r=this._processedNode)===null||r===void 0||r.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),nt(this,"outputNode",void 0),nt(this,"outputTrack",void 0),nt(this,"isPlayed",!1),nt(this,"sourceNode",void 0),nt(this,"context",void 0),nt(this,"audioBufferNode",void 0),nt(this,"destNode",void 0),nt(this,"audioOutputLevel",0),nt(this,"volumeLevelAnalyser",void 0),nt(this,"_processedNode",void 0),nt(this,"playNode",void 0),nt(this,"isDestroyed",!1),nt(this,"onNoAudioInput",void 0),nt(this,"isNoAudioInput",!1),nt(this,"_noAudioInputCount",0),this.context=cE(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),wp(this.outputNode),this.volumeLevelAnalyser=new HP}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=r=>{this.emit(Uo.ON_AUDIO_BUFFER,function(n){for(let i=0;i<n.outputBuffer.numberOfChannels;i+=1){let o=n.outputBuffer.getChannelData(i);for(let l=0;l<o.length;l+=1)o[l]=0}return n.inputBuffer}(r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!rn().webAudioMediaStreamDest)throw new Et(ce.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&qS(()=>{fn.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Pa()||zs()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();let r=this.volumeLevelAnalyser.getAnalyserNode(),n;r.getFloatTimeDomainData?(n=new Float32Array(r.fftSize),r.getFloatTimeDomainData(n)):(n=new Uint8Array(r.fftSize),r.getByteTimeDomainData(n));let i=!1;for(let o=0;o<n.length;o++)n[o]!==0&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Yi(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,r;(t=this.processedNode)===null||t===void 0||t.disconnect(),(r=this.sourceNode)===null||r===void 0||r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class KP extends WP{get isFreeze(){return!1}constructor(t,r,n){var i;if(super(),nt(this,"sourceNode",void 0),nt(this,"track",void 0),nt(this,"clonedTrack",void 0),nt(this,"audioElement",void 0),nt(this,"isCurrentTrackCloned",!1),nt(this,"isRemoteTrack",!1),nt(this,"originVolumeLevelAnalyser",void 0),nt(this,"rebuildWebAudio",async()=>{if(L.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void L.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>L.info("resume success")),L.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();let u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;let h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),wp(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();let m=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(m,this.context.currentTime),wp(this.outputNode),this.emit(Uo.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new Et(ce.UNEXPECTED_ERROR);this.track=t;let o=new MediaStream([this.track]);if(this.isRemoteTrack=!!r,this.sourceNode=this.context.createMediaStreamSource(o),wp(this.sourceNode),n){let u=n.clone();u.enabled=!0,this.clonedTrack=u,L.debug("create an unmuted track ".concat(u.id," from the original track ").concat(n.id," to get the volume"));let h=this.context.createMediaStreamSource(new MediaStream([u]));wp(h),this.originVolumeLevelAnalyser=new HP,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=o;let l=$r();r&&l.os===Di.IOS&&Number((i=l.osVersion)===null||i===void 0?void 0:i.split(".")[0])<15&&(fn.on(Ji.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;let r=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(r),wp(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(Uo.UPDATE_SOURCE),this.audioElement.srcObject=r}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),fn.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){let r=t.clone();r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=r),L.debug("create an unmuted track ".concat(r.id," from the original track ").concat(t.id," to get the volume"));let n=this.context.createMediaStreamSource(new MediaStream([r]));wp(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function zP(e,t,r){let n=(o,l)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||l:o:l,i={audio:!!r&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(i.video.mandatory.maxFrameRate=t.frameRate.max,i.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(i.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(i)}async function dF(e,t){let r=await qP(e.mediaSource),{sourceId:n,audio:i}=await function(o){let l=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new tr((u,h)=>{let m=document.createElement("div");m.innerText="share screen",m.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");let _=document.createElement("div");_.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");let R=document.createElement("div");R.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",R.setAttribute("style","height: 12%;");let A=document.createElement("div");A.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");let D=document.createElement("div");D.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");let J=document.createElement("button");J.innerHTML="cancel",J.setAttribute("style","width: 85px;"),J.onclick=()=>{document.body.removeChild(se);let ue=new Error("NotAllowedError");ue.name="NotAllowedError",h(ue)};let V=l,K=document.createElement("div");if(l){let ue=document.createElement("input");ue.setAttribute("type","checkbox");let De=document.createElement("span");ue.setAttribute("style","margin-right: 6px;"),De.innerText="Share audio",ue.checked=V,ue.onchange=()=>{V=ue.checked},K.appendChild(ue),K.appendChild(De)}D.appendChild(K),D.appendChild(J),_.appendChild(R),_.appendChild(A),_.appendChild(D);let se=document.createElement("div");se.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),se.appendChild(m),se.appendChild(_),document.body.appendChild(se),o.map(ue=>{if(ue.id){let De=document.createElement("div");De.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let ze=ue.thumbnail;try{let{width:Ke}=ze.getSize();Ke>1920&&(ze=ze.resize({width:1920}))}catch(Ke){throw Ke&&Ke.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),Ke}De.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+ze.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+ue.name.replace(/[\u00A0-\u9999<>\&]/g,function(Ke){return"&#"+Ke.charCodeAt(0)+";"})+"</span>",De.onclick=()=>{document.body.removeChild(se),u({sourceId:ue.id,audio:V})},A.appendChild(De)}})})}(r,t);return await zP(n,e,i)}async function qP(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);let r=aP();if(!r)throw console.error("failed to fetch electron, please mount it to window"),new Et(ce.ELECTRON_IS_NULL);let n=null;try{var i;n=((i=r.desktopCapturer)===null||i===void 0?void 0:i.getSources({types:t}))||r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{n=null}n&&n.then||(n=new tr((o,l)=>{r.desktopCapturer.getSources({types:t},(u,h)=>{u?l(u):o(h)})}));try{return await n}catch(o){throw new Et(ce.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,o.toString())}}let wA=new da("safari"),YP=!1,XP=!1;async function Bo(e,t){let r=0,n=null;for(;r<2;)try{n=await hF(e,t,r>0);break}catch(i){if(i instanceof Et)throw L.error("[".concat(t,"] ").concat(i.toString())),i;let o=iR(i.name||i.code||i,i.message);if(o.code===ce.MEDIA_OPTION_INVALID){L.debug("[".concat(t,"] detect media option invalid, retry")),r+=1,await Yi(500);continue}throw L.error("[".concat(t,"] ").concat(o.toString())),o}if(!n)throw new Et(ce.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return n}async function hF(e,t,r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Et(ce.NOT_SUPPORTED,"can not find getUserMedia");r&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));let n=rn(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return L.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(aP())e.screen.sourceId?lE(i,await zP(e.screen.sourceId,e.screen,!!e.screenAudio)):lE(i,await dF(e.screen,!!e.screenAudio));else if(Nu()&&e.screen.extensionId&&e.screen.mandatory){if(!n.getStreamFromExtension)throw new Et(ce.NOT_SUPPORTED,"This browser does not support screen sharing");L.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));let A=await(l=e.screen.extensionId,u=t,new tr((D,J)=>{try{chrome.runtime.sendMessage(l,{getStream:!0},V=>{if(!V||!V.streamId)return L.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),V),void J(new Et(ce.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));D(V.streamId)})}catch(V){L.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(l,")"),V.toString()),J(new Et(ce.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=A,lE(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(n.getDisplayMedia){var o;e.screen.mediaSource&&xP(e.screen.mediaSource);let A={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(o=e.screen.displaySurface)!==null&&o!==void 0?o:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:D,surfaceSwitching:J,systemAudio:V,preferCurrentTab:K}=e.screen,se={selfBrowserSurface:D,surfaceSwitching:J,systemAudio:V,preferCurrentTab:K};!D&&delete se.selfBrowserSurface,!J&&delete se.surfaceSwitching,!V&&delete se.systemAudio,!K&&delete se.preferCurrentTab,L.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:A,audio:e.screenAudio,controls:se})),lE(i,await navigator.mediaDevices.getDisplayMedia(Wn({video:A,audio:e.screenAudio},se)))}else{if(!Yn())throw L.error("[".concat(t,"] This browser does not support screenSharing")),new Et(ce.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&xP(e.screen.mediaSource);let A={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};L.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(A))),lE(i,await navigator.mediaDevices.getUserMedia(A))}}var l,u;if(!e.video&&!e.audio)return i;let h={video:e.video,audio:e.audio},m=Se("MEDIA_DEVICE_CONSTRAINTS");if(m)try{typeof m=="string"&&(m=JSON.parse(m)),h=sA(h,m)}catch{}L.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(h)),$r();let _,R=null;(ra()||Pa()||WS())&&(R=await wA.lock());try{_=await navigator.mediaDevices.getUserMedia(h)}catch(A){throw R&&R(),A}return h.audio&&(YP=!0),h.video&&(XP=!0),lE(i,_),R&&R(),i}function iR(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Et(ce.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Et(ce.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Et(ce.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Et(ce.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Et(ce.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Et(ce.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return L.error("getUserMedia unexpected error",e),new Et(ce.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function lE(e,t){let r=e.getVideoTracks()[0],n=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(n&&e.removeTrack(n),e.addTrack(o)),i&&(r&&e.removeTrack(r),e.addTrack(i))}let Vo=new class extends zn{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Np.STATE_CHANGE,e),this._state=e)}constructor(){super(),nt(this,"_state",Zg.IDLE),nt(this,"isAccessMicrophonePermission",!1),nt(this,"isAccessCameraPermission",!1),nt(this,"lastAccessMicrophonePermission",!1),nt(this,"lastAccessCameraPermission",!1),nt(this,"checkdeviceMatched",!1),nt(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Se("ENUMERATE_DEVICES_INTERVAL")||(KS()||HS()===Di.HARMONY_OS)&&wu())&&this.updateDevicesInfo()},Se("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>L.error(e.toString()))}async enumerateDevices(e,t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Et(ce.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();let n=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(n),o=!this.isAccessMicrophonePermission&&e,l=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(l=!1);let u=null,h=null,m=null;if(!r&&(o||l)){if(wA.isLocked&&(L.debug("[device manager] wait GUM lock"),(await wA.lock())(),L.debug("[device manager] GUM unlock")),YP&&(o=!1,this.isAccessMicrophonePermission=!0),XP&&(l=!1,this.isAccessCameraPermission=!0),L.debug("[device manager] check media device permissions",e,t,o,l),o&&l){try{m=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(_){let R=iR(_.name||_.code||_,_.message);if(R.code===ce.PERMISSION_DENIED)throw R;L.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{u=await navigator.mediaDevices.getUserMedia({audio:e})}catch(_){let R=iR(_.name||_.code||_,_.message);if(R.code===ce.PERMISSION_DENIED)throw R;L.warning("getUserMedia failed in getDevices",R)}this.isAccessMicrophonePermission=!0}else if(l){try{h=await navigator.mediaDevices.getUserMedia({video:t})}catch(_){let R=iR(_.name||_.code||_,_.message);if(R.code===ce.PERMISSION_DENIED)throw R;L.warning("getUserMedia failed in getDevices",R)}this.isAccessCameraPermission=!0}L.debug("[device manager] mic permission",e,"cam permission",t)}try{let _=await navigator.mediaDevices.enumerateDevices();return u&&u.getTracks().forEach(R=>R.stop()),h&&h.getTracks().forEach(R=>R.stop()),m&&m.getTracks().forEach(R=>R.stop()),u=null,h=null,m=null,_}catch(_){return u&&u.getTracks().forEach(R=>R.stop()),h&&h.getTracks().forEach(R=>R.stop()),m&&m.getTracks().forEach(R=>R.stop()),u=null,h=null,m=null,new Et(ce.ENUMERATE_DEVICES_FAILED,_.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(r=>{r.device.label===e&&(t=r.device.deviceId)}),t}async getDeviceById(e){let t=(await this.enumerateDevices(!0,!0,!0)).find(r=>r.deviceId===e);if(!t)throw new Et(ce.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Zg.INITING;try{await this.updateDevicesInfo(),this.state=Zg.INITEND}catch(e){throw L.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Zg.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new Et(ce.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),r=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;let i=e.find(l=>l.kind==="audioinput"&&l.deviceId==="default"),o=e.find(l=>l.kind==="audiooutput"&&l.deviceId==="default");i&&o?o.groupId===i.groupId?L.debug("[device-check] default input ".concat(i.label," and output ").concat(o.label," is the same group")):L.debug("[device-check] default input ".concat(i.label," and output ").concat(o.label," is not the same group")):L.debug("[device-check] default input or output not found")}let n=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(i=>{if(!i.deviceId)return;let o=this.deviceInfoMap.get("".concat(i.kind,"_").concat(i.deviceId));if((o?o.state:"INACTIVE")!=="ACTIVE"){let l={initAt:t,updateAt:t,device:i,state:"ACTIVE"};this.deviceInfoMap.set("".concat(i.kind,"_").concat(i.deviceId),l),r.push(l)}o&&(o.updateAt=t)}),this.deviceInfoMap.forEach((i,o)=>{i.state==="ACTIVE"&&i.updateAt!==t&&(i.state="INACTIVE",r.push(i))}),this.state!==Zg.INITEND)return n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));r.forEach(i=>{switch(i.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Np.RECORDING_DEVICE_CHANGED,i);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Np.CAMERA_DEVICE_CHANGED,i);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Np.PLAYOUT_DEVICE_CHANGED,i)}}),n.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),n.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){let t=e.filter(i=>i.kind==="audioinput"),r=e.filter(i=>i.kind==="videoinput"),n={audio:!1,video:!1};for(let i of t)if(i.label&&i.deviceId){n.audio=!0;break}for(let i of r)if(i.label&&i.deviceId){n.video=!0;break}return n}},DA=!1,Fo=new class extends zn{constructor(){super(...arguments),nt(this,"onAutoplayFailed",void 0),nt(this,"onAudioAutoplayFailed",void 0)}};function JP(){if($r(),!DA){let e=t=>{t.preventDefault(),DA=!1,Gg()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};DA=!0,Gg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),L.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Fo.onAutoplayFailed?Fo.onAutoplayFailed():Fo.onAudioAutoplayFailed?L.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):L.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),Fo.emit("autoplay-failed")}}function ZP(e,t,r,n){if(!e)return;let i=gr.getBaseInfoBySessionId(e);if(!i)return;let o=i.info,l=Date.now(),u=Wn(Wn({},o),{},{vid:o.vid===void 0?0:Number(o.vid),lts:l,elapse:l-i.startTime,cbRegistered:Fo.onAutoplayFailed||Fo.onAudioAutoplayFailed?1:-1,errorMsg:r,mediaType:t,trackId:n,extend:void 0});gr.send({type:Hn.AUTOPLAY_FAILED,data:u},!0)}let pF=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],Wa=new class{constructor(){nt(this,"onAutoplayFailed",void 0),nt(this,"elementMap",new Map),nt(this,"elementStateMap",new Map),nt(this,"elementsNeedToResume",[]),nt(this,"sinkIdMap",new Map),nt(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(t=>{let[r,n]=t,i=this.elementStateMap.get(r),o=n.srcObject.getAudioTracks()[0],l=o&&o.readyState;if(L.debug("resume after interrupted, ele: ".concat(i," audio: ").concat(l," ").concat(e)),l==="live"){if(e)return n.pause(),void n.play();if(fn.curState==="running")return Xm()?(n.pause(),void n.play()):void(i&&i==="paused"&&n.play())}})}),nt(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,r]=e,n=r.srcObject.getAudioTracks()[0];n&&n.readyState==="live"&&(L.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),r.pause(),r.play())})}),this.autoResumeAudioElement(),fn.on(Ji.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),fn.on(Ji.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),fn.on(Ji.STATE_CHANGE,()=>{Pa()&&fn.prevState==="suspended"&&fn.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){let r=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),r)try{await r.setSinkId(t)}catch(n){throw new Et(ce.PERMISSION_DENIED,"can not set sink id: "+n.toString())}}play(e,t,r,n){if(this.elementMap.has(t))return;let i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,Aa.INIT),this.setVolume(t,r);let o=this.sinkIdMap.get(t);if(o)try{i.setSinkId(o).catch(u=>{L.warning("[".concat(t,"] set sink id failed"),u.toString())})}catch(u){L.warning("[".concat(t,"] set sink id failed"),u.toString())}let l=i.play();l&&l.then&&l.catch(u=>{n&&ZP(n,"audio",u.message,t),L.warning("audio element play warning",u.toString()),this.elementMap.has(t)&&u.name==="NotAllowedError"&&(L.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),qS(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),JP()}))})}updateTrack(e,t){let r=this.elementMap.get(e);r&&(r.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){let r=this.elementMap.get(e);r&&(t=Math.max(0,Math.min(100,t)),r.volume=t/100)}stop(e){let t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;let r=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(r,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){pF.forEach(r=>{t.addEventListener(r,n=>{let i=this.elementStateMap.get(e),o=n.type==="pause"?"paused":n.type;if(L.debug("[".concat(e,"] audio-element-status change ").concat(i," => ").concat(o)),n.type==="error"){let l=t?.error;l&&L.error("[".concat(e,"] media error, code: ").concat(l.code,", message: ").concat(l.message))}this.elementStateMap.set(e,o)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){let e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(r=>{L.debug("Auto resume audio element success")}).catch(r=>{L.warning("Auto resume audio element failed!",r)})}),this.elementsNeedToResume=[]};new tr(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Gg()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function ai(){return function(e,t,r){let n=r.value;return typeof n=="function"&&(r.value=function(){this._isClosed&&new Et(ce.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",L);for(var i=arguments.length,o=new Array(i),l=0;l<i;l++)o[l]=arguments[l];let u=n.apply(this,o);return u instanceof tr?new tr((h,m)=>{u.then(h).catch(m)}):u}),r}}class QP extends zn{constructor(t){super(),nt(this,"name","VideoProcessorDestination"),nt(this,"ID","0"),nt(this,"_source",void 0),nt(this,"videoContext",void 0),nt(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Et(ce.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Et(ce.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(La.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(La.ON_TRACK,void 0)}}class $P extends zn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r){super(),nt(this,"constraintsMap",new Map),nt(this,"statsRegistry",[]),nt(this,"usageRegistry",[]),nt(this,"trackId",void 0),nt(this,"direction",void 0),nt(this,"_chained",!1),this.trackId=t,this.direction=r}async getConstraints(){return await ia(this,xo.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,r){var n;return L.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),bn(this,xo.REQUEST_UPDATE_CONSTRAINTS,Array.from(ro(n=this.constraintsMap).call(n)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return L.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),bn(this,xo.REQUEST_UPDATE_CONSTRAINTS,Array.from(ro(r=this.constraintsMap).call(r)))}registerStats(t,r,n){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:n})}unregisterStats(t,r){let n=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===r);n!==-1&&this.statsRegistry.splice(n,1)}gatherStats(){let t=[];for(let{processorID:r,processorName:n,type:i,cb:o}of this.statsRegistry)try{let l=o();t.push({processorID:r,processorName:n,type:i,stats:l})}catch(l){L.error(new Et(ce.UNEXPECTED_ERROR,l.message))}return t}registerUsage(t,r){this.usageRegistry.find(n=>n.processorID===t.ID&&n.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){let r=this.usageRegistry.findIndex(n=>n.processorID===t.ID&&n.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:r}of this.usageRegistry)try{let n=r();n instanceof tr&&(n=await n),t.push(Wn(Wn({},n),{},{direction:this.direction}))}catch(n){L.error("gather extension usage error",n)}return t}getDirection(){return this.direction}}class eL extends zn{constructor(t){super(),nt(this,"name","AudioProcessorDestination"),nt(this,"ID","0"),nt(this,"inputTrack",void 0),nt(this,"inputNode",void 0),nt(this,"audioProcessorContext",void 0),nt(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Et(ce.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Et(ce.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(La.ON_TRACK,void 0),this.emit(La.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(La.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(La.ON_NODE,this.inputNode))}}class tL extends zn{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,r,n){super(),nt(this,"constraintsMap",new Map),nt(this,"statsRegistry",[]),nt(this,"audioContext",void 0),nt(this,"trackId",void 0),nt(this,"direction",void 0),nt(this,"usageRegistry",[]),nt(this,"_chained",!1),this.audioContext=t,this.trackId=r,this.direction=n}async getConstraints(){return ia(this,xo.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,r){var n;return L.info("processor ".concat(r.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(r,t),bn(this,xo.REQUEST_UPDATE_CONSTRAINTS,Array.from(ro(n=this.constraintsMap).call(n)))}async requestRevertConstraints(t){var r;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),bn(this,xo.REQUEST_UPDATE_CONSTRAINTS,Array.from(ro(r=this.constraintsMap).call(r)))}registerStats(t,r,n){this.statsRegistry.find(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===r)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:r,cb:n})}unregisterStats(t,r){let n=this.statsRegistry.findIndex(i=>i.processorID===t.ID&&i.processorName===t.name&&i.type===r);n!==-1&&this.statsRegistry.splice(n,1)}gatherStats(){let t=[];for(let{processorID:r,processorName:n,type:i,cb:o}of this.statsRegistry)try{let l=o();t.push({processorID:r,processorName:n,type:i,stats:l})}catch(l){L.error(new Et(ce.UNEXPECTED_ERROR,l.message))}return t}registerUsage(t,r){this.usageRegistry.find(n=>n.processorID===t.ID&&n.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:r})}unregisterUsage(t){let r=this.usageRegistry.findIndex(n=>n.processorID===t.ID&&n.processorName===t.name);r!==-1&&this.usageRegistry.splice(r,1)}async gatherUsage(){let t=[];if(!this.chained)return[];for(let{cb:r}of this.usageRegistry)try{let n=r();n instanceof tr&&(n=await n),t.push(Wn(Wn({},n),{},{direction:this.direction}))}catch(n){L.error("gather extension usage error",n)}return t}getDirection(){return this.direction}}class PA extends zn{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),nt(this,"context",void 0),nt(this,"processSourceNode",void 0),nt(this,"outputTrack",void 0),nt(this,"processedNode",void 0),nt(this,"clonedTrack",void 0),nt(this,"outputNode",void 0),this.outputNode=new fF}setVolume(){}createOutputTrack(){throw new Et(ce.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class fF{disconnect(){}connect(){}}function rL(e){return new tr((t,r)=>{let n=!1,i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);let o=Pa()?"canplay":"playing";i.addEventListener(o,()=>{let l=i.videoWidth,u=i.videoHeight;!l&&Yn()||(n=!0,i.srcObject=null,i.remove(),t([l,u]))}),i.srcObject=new MediaStream([e]),i.play().catch(YS),setTimeout(()=>{n||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))},4e3)})}function aR(e){let t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});let r=Ll(e.encoderConfig);return r.width!=null&&(t.width=r.width),r.height!=null&&(t.height=r.height),!eP()&&r.frameRate&&(t.frameRate=r.frameRate),z1()&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Yn()&&(t.frameRate={ideal:30,max:30}),t}function nL(e){let t={};return eP()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,Nu()&&e.ANS&&(t.googHighpassFilter=e.ANS))),t}function iL(e){let t=nL(e);if(e.encoderConfig){let r=rR(e.encoderConfig);t.channelCount=r.stereo?2:1,t.sampleRate=r.sampleRate,t.sampleSize=r.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),KS()&&(t.sampleRate=void 0),t}let mF=e=>{let t=e._encoderConfig;if(!t)return;let{frameRate:r,width:n,height:i}=e.getMediaStreamTrackSettings(),{frameRate:o=r,width:l=n,height:u=i}=t;if(!o||!l||!u)return;l=cA(l),u=cA(u),o=cA(o);let{max:h,min:m}=function(D,J,V){let K=200*Math.pow(V/15,.6)*Math.pow(D*J/640/360,.75);return{min:Math.floor(K),max:Math.floor(4*K)}}(l,u,o),{bitrateMax:_,bitrateMin:R}=t||{};_||L.debug("calculate bitrate: [w: ".concat(l,", h: ").concat(u,", fps: ").concat(o,"] => [brMax: ").concat(_,", brMin: ").concat(R,"]"));let{maxFramerate:A}=Se("ENCODER_CONFIG_LIMIT");return A&&typeof A=="number"&&(o=Math.min(o,A)),{frameRate:o,bitrateMax:_||h,bitrateMin:R||m,scaleResolutionDownBy:1,scale:0}},aL=async(e,t,r)=>await(async(n,i,o)=>{let l=function(m){let _=[];for(let R=0;R<m.length;R+=2)_.push(parseInt(m.slice(R,R+2),16));return Uint8Array.from(_)}(EP(""+i+o)).slice(0,16),u=l.slice(0,12),h=await window.crypto.subtle.importKey("raw",l,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:u},h,n))})(e.buffer,t,r),LA=e=>{let t=document.createElement("canvas");return t.width=2,t.height=2,new tr((r,n)=>{t.toBlob(async i=>{if(t.remove(),i){let o=await oL(i);r({buffer:o,width:t.width,height:t.height})}else n(new Et(ce.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},oL=async e=>{let t=await e.arrayBuffer();return new Uint8Array(t)};var sL,cL,lL,uL,dL,hL,pL,fL,mL,EL,_L,gL,vL,TL,yL,SL,RL,CL,qn,IL,AL,bL,OL,NL,wL,Ml,DL,PL,LL,kL,ML,UL,xL,jL,BL,VL,FL,GL,HL,oa;let ei=(sL=Nr({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),cL=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),lL=ai(),uL=Qm("LocalAudioTrack","_enabledMutex"),dL=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),hL=ai(),pL=Qm("LocalAudioTrack","_enabledMutex"),fL=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),mL=ai(),EL=ai(),_L=ai(),gL=Nr({argsMap:e=>[e.getTrackId()]}),vL=ai(),TL=Nr({argsMap:e=>[e.getTrackId()]}),yL=ai(),SL=Nr({argsMap:e=>[e.getTrackId()]}),RL=Nr({argsMap:(e,t)=>[e.getTrackId(),t.name]}),CL=Nr({argsMap:e=>[e.getTrackId()]}),tn((qn=class extends sE{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?Wa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,r,n){super(e,r),nt(this,"trackMediaType",oE.AUDIO),nt(this,"_encoderConfig",void 0),nt(this,"_trackSource",void 0),nt(this,"metadata",[]),nt(this,"_enabled",!0),nt(this,"_volume",100),nt(this,"_useAudioElement",!0),nt(this,"_bypassWebAudio",!1),nt(this,"processor",void 0),nt(this,"_processorContext",void 0),nt(this,"_processorDestination",void 0),nt(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!n,this._trackSource=new PA,Se("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),Se("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),ra()&&!jo?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){vn(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&Wa.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void L.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));let t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,bn(this,hr.NEED_REPLACE_TRACK,this).then(()=>{L.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(r=>{L.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!MP())throw new Et(ce.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Wa.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,r){return this._setEnabled(e,t,r)}async _setEnabled(e,t,r){if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{r||(this._enabled=!0),await bn(this,hr.NEED_ENABLE_TRACK,this),L.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(n){throw r||(this._enabled=!1),L.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}}else{this._originMediaStreamTrack.enabled=!1,r||(this._enabled=!1);try{await bn(this,hr.NEED_DISABLE_TRACK,this)}catch(n){throw r||(this._enabled=!0),L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,L.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await bn(this,hr.NEED_MUTE_TRACK,this):await bn(this,hr.NEED_UNMUTE_TRACK,this))}getStats(){return Wd(()=>{L.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),Lo(this,hr.GET_STATS)||Wn({},IA)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Uo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Uo.ON_AUDIO_BUFFER),this._source.on(Uo.ON_AUDIO_BUFFER,r=>e(r))}play(){L.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(L.debug("[".concat(this.getTrackId(),"] start audio playback in element")),Wa.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){L.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?Wa.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];L.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Wa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await bn(this,hr.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return tr.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Et(ce.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Et(ce.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(e){e.on(La.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await bn(this,hr.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await bn(this,hr.NEED_REPLACE_TRACK,this))}),e.on(La.ON_NODE,t=>{this._source.processedNode=t})}unbindProcessorDestinationEvents(e){e.removeAllListeners(La.ON_TRACK),e.removeAllListeners(La.ON_NODE)}bindProcessorContextEvents(e){e.on(xo.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(xo.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof PA&&(this._trackSource=new KP(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){let e=new tL(this._source.context,this.getTrackId(),"local"),t=new eL(e);return this._processorContext=e,this._processorDestination=t,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(t),this._source.on(Uo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(Wa.stop(this.getTrackId()),this._source.play()),bn(this,hr.NEED_REPLACE_MIXING_TRACK,this).then(()=>{L.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(r=>{L.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),r)})),{processorContext:e,processorDestination:t}}}).prototype,"setVolume",[sL],Object.getOwnPropertyDescriptor(qn.prototype,"setVolume"),qn.prototype),tn(qn.prototype,"setPlaybackDevice",[cL,lL],Object.getOwnPropertyDescriptor(qn.prototype,"setPlaybackDevice"),qn.prototype),tn(qn.prototype,"setEnabled",[uL,dL,hL],Object.getOwnPropertyDescriptor(qn.prototype,"setEnabled"),qn.prototype),tn(qn.prototype,"setMuted",[pL,fL,mL],Object.getOwnPropertyDescriptor(qn.prototype,"setMuted"),qn.prototype),tn(qn.prototype,"getStats",[EL],Object.getOwnPropertyDescriptor(qn.prototype,"getStats"),qn.prototype),tn(qn.prototype,"setAudioFrameCallback",[_L],Object.getOwnPropertyDescriptor(qn.prototype,"setAudioFrameCallback"),qn.prototype),tn(qn.prototype,"play",[gL,vL],Object.getOwnPropertyDescriptor(qn.prototype,"play"),qn.prototype),tn(qn.prototype,"stop",[TL,yL],Object.getOwnPropertyDescriptor(qn.prototype,"stop"),qn.prototype),tn(qn.prototype,"close",[SL],Object.getOwnPropertyDescriptor(qn.prototype,"close"),qn.prototype),tn(qn.prototype,"pipe",[RL],Object.getOwnPropertyDescriptor(qn.prototype,"pipe"),qn.prototype),tn(qn.prototype,"unpipe",[CL],Object.getOwnPropertyDescriptor(qn.prototype,"unpipe"),qn.prototype),qn),oR=(IL=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),AL=ai(),bL=Qm("MicrophoneAudioTrack","_enabledMutex"),OL=Nr({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),NL=ai(),wL=Nr({argsMap:e=>[e.getTrackId()]}),tn((Ml=class extends ei{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,r,n){super(e,t.encoderConfig?rR(t.encoderConfig):{},n,Se("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),nt(this,"_config",void 0),nt(this,"_deviceName","default"),nt(this,"_constraints",void 0),nt(this,"_originalConstraints",void 0),nt(this,"_enabled",!0),this._config=t,this._constraints=r,this._originalConstraints=r,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Xm()||eA())&&fn.bindInterruptDetectorTrack(this)}async setDevice(e){if(L.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{let t=await Vo.getDeviceById(e),r={};r.audio=Wn({},this._constraints),r.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let n=null;try{n=await Bo(r,this.getTrackId())}catch(i){throw L.error("[".concat(this.getTrackId(),"] setDevice failed"),i.toString()),n=await Bo({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{let t=await Vo.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}L.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,r){if(t)return L.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!r){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),e),Se("AUTO_RESET_AUDIO_ROUTE")&&(Pa()||zs())){let l=navigator.audioSession;l&&(e||(l.type="playback"),l.type="auto")}if(!e){var n;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(n=this._source.clonedTrack)===null||n===void 0||n.stop(),r||(this._enabled=!1);try{await bn(this,hr.NEED_DISABLE_TRACK,this)}catch(l){throw L.error("[".concat(this.getTrackId(),"] setEnabled false failed"),l.toString()),l}return}let i=Wn({},this._constraints),o=Vo.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{r||(this._enabled=!0);let l=await Bo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(l.getAudioTracks()[0],!1),await bn(this,hr.NEED_ENABLE_TRACK,this)}catch(l){throw r||(this._enabled=!1),L.error("[".concat(this.getTrackId(),"] setEnabled true failed"),l.toString()),l}L.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Xm()||eA())&&fn.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Pa()||zs())&&this._enabled&&!this._isClosed&&fn.duringInterruption){let e=async()=>{fn.off(Ji.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};fn.on(Ji.IOS_INTERRUPTION_END,e)}else L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(iE.TRACK_ENDED)}async renewMediaStreamTrack(e){let t=e||this._constraints,r=Vo.searchDeviceIdByName(this._deviceName);if(r&&!t.deviceId&&(t.deviceId=r),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();let n=await Bo({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(xo.REQUEST_UPDATE_CONSTRAINTS,async(t,r,n)=>{try{let i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),r()}catch(i){n(i)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(xo.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[IL,AL],Object.getOwnPropertyDescriptor(Ml.prototype,"setDevice"),Ml.prototype),tn(Ml.prototype,"setEnabled",[bL,OL,NL],Object.getOwnPropertyDescriptor(Ml.prototype,"setEnabled"),Ml.prototype),tn(Ml.prototype,"close",[wL],Object.getOwnPropertyDescriptor(Ml.prototype,"close"),Ml.prototype),Ml),EF=(DL=Nr({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),PL=ai(),LL=Nr({argsMap:e=>[e.getTrackId()]}),kL=ai(),ML=Nr({argsMap:e=>[e.getTrackId()]}),UL=ai(),xL=Nr({argsMap:e=>[e.getTrackId()]}),jL=ai(),BL=Nr({argsMap:e=>[e.getTrackId()]}),VL=ai(),FL=Nr({argsMap:e=>[e.getTrackId()]}),GL=Nr({argsMap:e=>[e.getTrackId()]}),HL=ai(),tn((oa=class extends ei{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,r,n){super(t.createOutputTrack(),r,n),nt(this,"source",void 0),nt(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=t,this._bufferSource.on(Uo.AUDIO_SOURCE_STATE_CHANGE,i=>{this.safeEmit(iE.SOURCE_STATE_CHANGE,i)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){vn(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[DL,PL],Object.getOwnPropertyDescriptor(oa.prototype,"startProcessAudioBuffer"),oa.prototype),tn(oa.prototype,"pauseProcessAudioBuffer",[LL,kL],Object.getOwnPropertyDescriptor(oa.prototype,"pauseProcessAudioBuffer"),oa.prototype),tn(oa.prototype,"seekAudioBuffer",[ML,UL],Object.getOwnPropertyDescriptor(oa.prototype,"seekAudioBuffer"),oa.prototype),tn(oa.prototype,"resumeProcessAudioBuffer",[xL,jL],Object.getOwnPropertyDescriptor(oa.prototype,"resumeProcessAudioBuffer"),oa.prototype),tn(oa.prototype,"stopProcessAudioBuffer",[BL,VL],Object.getOwnPropertyDescriptor(oa.prototype,"stopProcessAudioBuffer"),oa.prototype),tn(oa.prototype,"close",[FL],Object.getOwnPropertyDescriptor(oa.prototype,"close"),oa.prototype),tn(oa.prototype,"setAudioBufferPlaybackSpeed",[GL,HL],Object.getOwnPropertyDescriptor(oa.prototype,"setAudioBufferPlaybackSpeed"),oa.prototype),oa);class Ci extends ei{get __className__(){return"MixingAudioTrack"}get isActive(){for(let t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){let t=cE().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,On(8,"track-mix-")),nt(this,"trackList",void 0),nt(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(L.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):L.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){L.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}zS(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){let t={};this.trackList.forEach(r=>{r._encoderConfig&&((r._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=r._encoderConfig.bitrate),(r._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=r._encoderConfig.sampleRate),(r._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=r._encoderConfig.sampleSize),r._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(r=>{r instanceof Ci?r.emit(Op.TRANSCEIVER_UPDATED,t):r._updateRtpTransceiver(t)}))}}class _F extends WP{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(Uo.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),nt(this,"audioBuffer",void 0),nt(this,"sourceNode",void 0),nt(this,"startPlayTime",0),nt(this,"startPlayOffset",0),nt(this,"pausePlayTime",0),nt(this,"options",void 0),nt(this,"currentLoopCount",0),nt(this,"currentPlaybackSpeed",100),nt(this,"_currentState","stopped"),this.audioBuffer=t,this.options=r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):L.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){let t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}let WL=new Map;class kA{get rendFrameRate(){if(this.renderStats&&this.renderStats.curTs!==this.renderStats.lastTs){let t=this.renderStats.curTs-this.renderStats.lastTs,r=(this.renderStats.renderNum-this.renderStats.lastRenderNum)/t;return this.renderStats.lastRenderNum=this.renderStats.renderNum,this.renderStats.lastTs=this.renderStats.curTs,r}return 0}get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(L.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}get videoState(){return this._videoState}set videoState(t){var r;t!==this._videoState&&(this._videoState=t,(r=this.onVideoStateChanged)===null||r===void 0||r.call(this,this.videoState))}constructor(t){nt(this,"trackId",void 0),nt(this,"config",void 0),nt(this,"onFirstVideoFrameDecoded",void 0),nt(this,"onVideoStateChanged",void 0),nt(this,"freezeTimeCounterList",[]),nt(this,"renderFreezeAccTime",0),nt(this,"isKeepLastFrame",!1),nt(this,"timeUpdatedCount",0),nt(this,"freezeTime",0),nt(this,"playbackTime",0),nt(this,"lastTimeUpdatedTime",0),nt(this,"autoplayFailed",!1),nt(this,"videoTrack",void 0),nt(this,"videoElement",void 0),nt(this,"cacheVideoElement",void 0),nt(this,"renderStats",void 0),nt(this,"_videoState",kl.VideoStateStopped),nt(this,"videoElementCheckInterval",void 0),nt(this,"videoElementFreezeTimeout",void 0),nt(this,"_videoElementStatus",Aa.NONE),nt(this,"isGettingVideoDimensions",!1),nt(this,"startGetVideoDimensions",()=>{let r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return L.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(r,500)};!this.isGettingVideoDimensions&&r()}),nt(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&fn.curState==="running"&&(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(K1())),Q1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),nt(this,"handleVideoEvents",r=>{switch(r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=Aa.PLAYING;break;case"loadeddata":if(this.videoState=kl.VideoStateStarting,this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=Aa.CANPLAY;break;case"stalled":this.videoElementStatus=Aa.STALLED;break;case"suspend":this.videoElementStatus=Aa.SUSPEND;break;case"pause":this.videoElementStatus=Aa.PAUSED,Pa()||zs()||ra()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=Aa.WAITING;break;case"abort":this.videoElementStatus=Aa.ABORT;break;case"ended":this.videoElementStatus=Aa.ENDED;break;case"emptied":this.videoElementStatus=Aa.EMPTIED;break;case"error":{let n=this.videoElement.error;n&&(this.videoElementStatus=Aa.ERROR,L.error("[".concat(this.trackId,"] media error: ").concat(n.message," (").concat(n.code,")")));break}case"timeupdate":{let n=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=n);let i=n-this.lastTimeUpdatedTime,o=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=n,Lu.lastVisibleTime<Lu.lastHiddenTime||o<Lu.lastHiddenTime||o<Lu.lastVisibleTime)return;for(i>Se("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=i),this.playbackTime+=i;this.playbackTime>=6e3;){this.playbackTime-=6e3;let l=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(l),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),nt(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(L.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(K1())),Q1()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),fn.on(Ji.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),fn.on(Ji.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){let r=this.videoElement.play();r&&r.catch&&r.catch(i=>{t&&ZP(t,"video",i.message,this.trackId),i.name==="NotAllowedError"?(L.warning("detected video element autoplay failed",i),this.autoplayFailed=!0,this.handleAutoPlayFailed()):L.warning("[".concat(this.trackId,"] play warning: "),i)});let n=$r();if((n.name==="Safari"&&Number(n.version)===15||Xm())&&r&&r.then){let i=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};r.then(i).catch(i)}}getCurrentFrame(){let t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;let r=t.getContext("2d");if(!r)return L.error("create canvas context failed!"),new ImageData(2,2);r.drawImage(this.videoElement,0,0,t.width,t.height);let n=r.getImageData(0,0,t.width,t.height);return t.remove(),n}async getCurrentFrameToUint8Array(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;let i=n.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,n.width,n.height),new tr((o,l)=>{n.toBlob(async u=>{if(n.remove(),u){let h=await oL(u);o({buffer:h,width:n.width,height:n.height})}else l(new Et(ce.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,r<0?.1:r>1?1:r)})):await LA(t)}destroy(){this.renderStats=void 0,fn.off(Ji.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),fn.off(Ji.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=kl.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=Aa.INIT,!this.videoElementCheckInterval&&(KL.forEach(o=>{this.videoElement.addEventListener(o,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(o){return o!==document.body&&document.body.contains(o)})(this.videoElement)||(this.videoElementStatus=Aa.DESTROYED)},1e3),Se("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,r;let o,l=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",l),this.videoElementFreezeTimeout=window.setTimeout(u,Se("VIDEO_FREEZE_DURATION")))},u=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===kl.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=kl.VideoStateFrozen:document.addEventListener("visibilitychange",l))},h=(m,_)=>{if(this.videoElementStatus===Aa.PLAYING){if(this.renderStats?(this.renderStats.renderNum++,this.renderStats.curTs=_.mediaTime):this.renderStats={lastTs:_.mediaTime,curTs:_.mediaTime,lastRenderNum:0,renderNum:0},o){let D=_.presentationTime-o.presentationTime;this.videoState===kl.VideoStateStarting&&(this.videoState=kl.VideoStateDecoding),this.videoState===kl.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(u,Se("VIDEO_FREEZE_DURATION"))),D<Se("VIDEO_FREEZE_DURATION")&&this.videoState===kl.VideoStateFrozen&&(this.videoState=kl.VideoStateDecoding),D>Se("VIDEO_FREEZE_DURATION")&&Lu.lastVisibleTime>=Lu.lastHiddenTime&&o.timestamp>Lu.lastVisibleTime&&o.timestamp>Lu.lastHiddenTime&&(this.renderFreezeAccTime+=D)}o=Wn(Wn({},_),{},{timestamp:m})}var R,A;Se("ENABLE_VIDEO_FRAME_CALLBACK")&&((R=(A=this.videoElement).requestVideoFrameCallback)===null||R===void 0||R.call(A,h))};(t=(r=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(r,h)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),KS()&&!Se("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");let n=$r();n.name==="Safari"&&Number(n.version)===15||Xm()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Yn()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Yn()&&this.videoElement.load());let i=this.videoElement.play();i!==void 0&&i.catch(o=>{L.debug("[".concat(this.trackId,"] playback interrupted"),o.toString())})}resetVideoElement(){KL.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=Aa.NONE}handleAutoPlayFailed(){let t=r=>{r.preventDefault(),this.videoElement.play().then(()=>{L.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(n=>{L.error(n)}),this.autoplayFailed=!1,Gg()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Gg()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),JP()}}let KL=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class zL extends kA{constructor(t){super(t),nt(this,"container",void 0),nt(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;let r=t.element;r!==this.slot&&(this.destroy(),this.slot=r),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var r;let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,n):await LA(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Se("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var qL,YL,XL,JL,ZL,QL,$L,ek,tk,rk,nk,ik,ak,ok,sk,ck,lk,uk,dk,hk,pk,fk,mk,Ek,Xr,_k,gk,vk,Tk,yk,Sk,Rk,Ck,Go;let xn=(qL=Nr({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),YL=ai(),XL=Nr({argsMap:e=>[e.getTrackId()]}),JL=Qm("LocalVideoTrack","_enabledMutex"),ZL=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),QL=ai(),$L=Qm("LocalVideoTrack","_enabledMutex"),ek=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),tk=ai(),rk=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),nk=ai(),ik=ai(),ak=Nr({argsMap:(e,t,r)=>[e.getTrackId(),t,r]}),ok=ai(),sk=ai(),ck=ai(),lk=ai(),uk=ai(),dk=ai(),hk=ai(),pk=Nr({argsMap:(e,t)=>[e.getTrackId(),t.name]}),fk=Nr({argsMap:e=>[e.getTrackId()]}),mk=Nr({argsMap:e=>[e.getTrackId()]}),Ek=Nr({argsMap:(e,t,r)=>[e.getTrackId(),t.label,r]}),Xr=class M3 extends sE{get videoHeight(){if(ra()){let{height:t}=this._mediaStreamTrack.getSettings();return this._videoHeight=t,this._videoHeight}return this._videoHeight}get videoWidth(){if(ra()){let{width:t}=this._mediaStreamTrack.getSettings();return this._videoWidth=t,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Aa.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,r,n,i,o,l){if(super(t,o),nt(this,"trackMediaType",oE.VIDEO),nt(this,"_player",void 0),nt(this,"isUseScaleResolutionDownBy",!1),nt(this,"_videoVisibleTimer",null),nt(this,"_previousVideoVisibleStatus",void 0),nt(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),nt(this,"_encoderConfig",void 0),nt(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),nt(this,"_optimizationMode",void 0),nt(this,"_videoHeight",void 0),nt(this,"_videoWidth",void 0),nt(this,"_forceBitrateLimit",void 0),nt(this,"_enabled",!0),nt(this,"_processorDestination",void 0),nt(this,"_processorContext",void 0),ra()){let{width:u,height:h}=t.getSettings();this._videoWidth=u,this._videoHeight=h}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=r,this._scalabilityMode=n,this._optimizationMode=i,this._hints=l||[],this._hints.indexOf(Nn.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(ZI(an.CHROME,115)&&HS().indexOf("Windows")!==-1){let u=function(h,m){if("VideoFrame"in window&&"TransformStream"in window&&rn().supportWebRTCInsertableStream){let _=new MediaStreamTrackProcessor(h),R=new MediaStreamTrackGenerator({kind:"video"}),A,D,J=Date.now(),V=()=>{K&&(clearInterval(K),K=void 0),A&&(A.close(),A=void 0),h.stop(),D=void 0,R.removeEventListener("ended",V)},K=window.setInterval(()=>{if(D&&A&&Date.now()-J>1e3)try{R.readyState==="live"?D.enqueue(A.clone()):V()}catch{V()}},1e3),se=new TransformStream({transform:(ue,De)=>{R.readyState==="live"?(D=De,J=Date.now(),A===void 0?(A=ue,De.enqueue(ue.clone())):(De.enqueue(A),A=ue)):ue.close()}});return R.addEventListener("ended",V),_.readable.pipeThrough(se).pipeTo(R.writable),R}}(t);u&&(L.info("local screen video track begin to inject frame"),this._mediaStreamTrack=u)}r&&this._hints.indexOf(Nn.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(r),this._processorContext=new $P(this.getTrackId(),"local"),this._processorDestination=new QP(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){let i=document.getElementById(t);i?t=i:(L.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}L.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));let n=Wn(Wn(Wn({},this._getDefaultPlayerConfig()),r),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new kA(n):this._player=new zL(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let i=this.getVideoElementVisibleStatus();this.safeEmit(iE.VIDEO_ELEMENT_VISIBLE_STATUS,i)}catch{}},Se("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,L.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await bn(this,hr.NEED_DISABLE_TRACK,this)}catch(n){throw L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}return r||(this._enabled=!1),void L.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await bn(this,hr.NEED_ENABLE_TRACK,this)}catch(n){throw L.error("[".concat(this.getTrackId(),"] setEnabled to true error"),n.toString()),n}L.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,L.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await bn(this,hr.NEED_MUTE_TRACK,this):await bn(this,hr.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,r){if(!this._enabled)throw new Et(ce.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Ll(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){let n=aR({encoderConfig:t});(ra()||Pa()||zs())&&(n.deviceId=void 0),L.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(n));try{await this._originMediaStreamTrack.applyConstraints(n),this.updateMediaStreamTrackResolution()}catch(i){let o=new Et(ce.UNEXPECTED_ERROR,i.toString());throw L.error("[".concat(this.getTrackId(),"] applyConstraints error"),o.toString()),o}}this._encoderConfig=t,this._hints.indexOf(Nn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await bn(this,hr.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw(L)}}getStats(){return Wd(()=>{L.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),Lo(this,hr.GET_STATS)||Wn({},AA)}async setBeautyEffect(t){L.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,r):await LA(t)}async setBitrateLimit(t){L.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t&&(this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate))}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void L.error(ce.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");let r=this._optimizationMode;try{this._optimizationMode=t,await bn(this,hr.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(n){throw this._optimizationMode=r,L.error("[".concat(this.getTrackId(),"] set optimization mode failed"),n.toString()),n}L.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return L.error(ce.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,L.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){rL(this._originMediaStreamTrack).then(t=>{let[r,n]=t;this._videoHeight=n,this._videoWidth=r}).catch(YS)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Et(ce.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");L.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=Ll(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,this._hints.indexOf(Nn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await bn(this,hr.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw(L)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;let{width:t,height:r,frameRate:n}=this.getMediaStreamTrackSettings();if(!t||!r||!n)return;let{bitrateMax:i,bitrateMin:o}=this._encoderConfig;if(o==null||i==null){let{max:l,min:u}=function(h,m,_,R,A){let D=Se("BITRATE_ADAPTER_TYPE");if(D==="DEFAULT_BITRATE")return{min:R,max:A};if(A===void 0){var J;let K=Math.floor(200*Math.pow(_/15,.6)*Math.pow(h*m/640/360,.75));A=D==="STANDARD_BITRATE"?4*K:2*K,R=(J=R)!==null&&J!==void 0?J:K}else{var V;R=(V=R)!==null&&V!==void 0?V:Math.floor(A/10)}return{min:R,max:A}}(t,r,n,o,i);this._encoderConfig.bitrateMin=u,this._encoderConfig.bitrateMax=l,L.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(r,", fps: ").concat(n,"] => [brMax: ").concat(l,", brMin: ").concat(u,"]"))}}getVideoElementVisibleStatus(){try{var t,r;let n=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),i={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:n?.parentElement},{element:o,slot:l}=i;if(this.isPlaying&&o instanceof HTMLVideoElement&&l instanceof HTMLElement){let u=nP.checkOneElementVisible(o),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;let m=gr.reportApiInvoke(null,{tag:Jn.TRACER,name:gi.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(n){throw new Et(ce.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Et(ce.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;let t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;t&&(n=Wn(Wn({},n),Ll(t))),n=Cp(n);let i=On(8,"track-video-cloned-"),o=new M3(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,n,Cp(this._scalabilityMode),this._optimizationMode,i,Cp(this._hints));return t&&n&&o.setEncoderConfiguration(n),L.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(r)),o}async replaceTrack(t,r){if(!(t instanceof MediaStreamTrack))throw new Et(ce.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new Et(ce.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,r,!0),this.updateMediaStreamTrackResolution()}sendSeiData(t){if(Wd(()=>{gr.reportApiInvoke(null,{name:gi.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:Jn.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!Se("ENABLE_VIDEO_SEI")||!Se("ENABLE_ENCODED_TRANSFORM"))return void L.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(t instanceof Uint8Array==0)return new Et(ce.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();let r=this.getRTCRtpTransceiver();if(!r)return void L.warning("Video track is not published, SEI can not be send");let n=r.sender.getParameters();if(n.codecs.length===0)return;let i=n.codecs[0].mimeType.toLocaleLowerCase();i==="video/h264"?this.safeEmit("sei-to-send",t):L.warning("SEI is not supported by ".concat(i))}bindProcessorDestinationEvents(){this.processorDestination.on(La.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await bn(this,hr.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await bn(this,hr.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(La.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(xo.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(xo.REQUEST_CONSTRAINTS)}},tn(Xr.prototype,"play",[qL,YL],Object.getOwnPropertyDescriptor(Xr.prototype,"play"),Xr.prototype),tn(Xr.prototype,"stop",[XL],Object.getOwnPropertyDescriptor(Xr.prototype,"stop"),Xr.prototype),tn(Xr.prototype,"setEnabled",[JL,ZL,QL],Object.getOwnPropertyDescriptor(Xr.prototype,"setEnabled"),Xr.prototype),tn(Xr.prototype,"setMuted",[$L,ek,tk],Object.getOwnPropertyDescriptor(Xr.prototype,"setMuted"),Xr.prototype),tn(Xr.prototype,"setEncoderConfiguration",[rk,nk],Object.getOwnPropertyDescriptor(Xr.prototype,"setEncoderConfiguration"),Xr.prototype),tn(Xr.prototype,"getStats",[ik],Object.getOwnPropertyDescriptor(Xr.prototype,"getStats"),Xr.prototype),tn(Xr.prototype,"setBeautyEffect",[ak,ok],Object.getOwnPropertyDescriptor(Xr.prototype,"setBeautyEffect"),Xr.prototype),tn(Xr.prototype,"getCurrentFrameData",[sk],Object.getOwnPropertyDescriptor(Xr.prototype,"getCurrentFrameData"),Xr.prototype),tn(Xr.prototype,"getCurrentFrameImage",[ck],Object.getOwnPropertyDescriptor(Xr.prototype,"getCurrentFrameImage"),Xr.prototype),tn(Xr.prototype,"setBitrateLimit",[lk],Object.getOwnPropertyDescriptor(Xr.prototype,"setBitrateLimit"),Xr.prototype),tn(Xr.prototype,"setOptimizationMode",[uk],Object.getOwnPropertyDescriptor(Xr.prototype,"setOptimizationMode"),Xr.prototype),tn(Xr.prototype,"setScalabiltyMode",[dk],Object.getOwnPropertyDescriptor(Xr.prototype,"setScalabiltyMode"),Xr.prototype),tn(Xr.prototype,"updateMediaStreamTrackResolution",[hk],Object.getOwnPropertyDescriptor(Xr.prototype,"updateMediaStreamTrackResolution"),Xr.prototype),tn(Xr.prototype,"pipe",[pk],Object.getOwnPropertyDescriptor(Xr.prototype,"pipe"),Xr.prototype),tn(Xr.prototype,"unpipe",[fk],Object.getOwnPropertyDescriptor(Xr.prototype,"unpipe"),Xr.prototype),tn(Xr.prototype,"close",[mk],Object.getOwnPropertyDescriptor(Xr.prototype,"close"),Xr.prototype),tn(Xr.prototype,"replaceTrack",[Ek],Object.getOwnPropertyDescriptor(Xr.prototype,"replaceTrack"),Xr.prototype),Xr),MA=(_k=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),gk=ai(),vk=Qm("CameraVideoTrack","_enabledMutex"),Tk=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),yk=ai(),Sk=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),Rk=ai(),Ck=Nr({argsMap:e=>[e.getTrackId()]}),Go=class U3 extends xn{get __className__(){return"CameraVideoTrack"}constructor(t,r,n,i,o,l){super(t,Ll(r.encoderConfig),i,o,l),nt(this,"_config",void 0),nt(this,"_originalConstraints",void 0),nt(this,"_constraints",void 0),nt(this,"_enabled",!0),nt(this,"_deviceName","default"),nt(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Xm()||eA())&&!function(){let u=$r();if(u.os!==Di.IOS||!u.osVersion)return!1;let h=u.osVersion.split(".");return Number(h[0])===15&&Number(h[1])>=2}()&&$1()&&this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=r,this._originalConstraints=n,this._constraints=n,this._deviceName=t.label,this._encoderConfig=Ll(this._config.encoderConfig),fn.on(Ji.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),fn.on(Ji.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return typeof t=="string"?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(L.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{let r=await Vo.getDeviceById(t),n={};n.video=Wn({},this._constraints),n.video.deviceId={exact:t},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await Bo(n,this.getTrackId())}catch(o){throw L.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),i=await Bo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{let r=await Vo.getDeviceById(t);this._deviceName=r.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(r){throw L.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}L.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){L.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));let r={video:Wn(Wn({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let n=null;try{n=await Bo(r,this.getTrackId())}catch(i){throw L.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),i.toString()),n=await Bo({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),i}await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=Wn({},r.video),L.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,r){if(!r){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(L.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{let n=await Bo({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await bn(this,hr.NEED_ENABLE_TRACK,this)}catch(n){throw L.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),L.info("[".concat(this.getTrackId(),"] setEnabled to true success")),r||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),r||(this._enabled=!1);try{await bn(this,hr.NEED_DISABLE_TRACK,this)}catch(n){throw L.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}L.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,r){if(!this._enabled)throw new Et(ce.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");t=Ll(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate||t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate||t.bitrateMin);let n=Zn(this._config);n.encoderConfig=t;let i=aR(n);(ra()||Pa()||zs())&&(i.deviceId=void 0),L.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(o){let l=new Et(ce.UNEXPECTED_ERROR,o.toString());throw L.error("[".concat(this.getTrackId(),"] applyConstraints error"),l.toString()),l}this._config=n,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,this._hints.indexOf(Nn.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await bn(this,hr.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(L)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Pa()||zs())&&this._enabled&&!this._isClosed&&fn.duringInterruption){let t=async()=>{fn.off(Ji.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(L.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};fn.on(Ji.IOS_INTERRUPTION_END,t)}else L.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(iE.TRACK_ENDED)}async renewMediaStreamTrack(t){let r=t||this._constraints,n=Vo.searchDeviceIdByName(this._deviceName);if(n&&!r.deviceId&&(r.deviceId={exact:n}),this._enabled){let i=await Bo({video:r},this.getTrackId());this._constraints=r,await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),fn.off(Ji.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),fn.off(Ji.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],n=this._encoderConfig;t&&(n=Wn(Wn({},n),Ll(t))),n=Cp(n);let i=On(8,"track-cam-cloned-"),o=new U3(r?this._mediaStreamTrack.clone():this._mediaStreamTrack,Cp(Wn(Wn({},this._config),{},{encoderConfig:n})),Cp(this._constraints),Cp(this._scalabilityMode),this._optimizationMode,i);return t&&n&&o.setEncoderConfiguration(n),L.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(r)),o}bindProcessorContextEvents(){this.processorContext.on(xo.REQUEST_UPDATE_CONSTRAINTS,async(t,r,n)=>{try{let i=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(i),r()}catch(i){n(i)}}),this.processorContext.on(xo.REQUEST_CONSTRAINTS,async t=>{t(this._originMediaStreamTrack.getSettings())})}},tn(Go.prototype,"setDevice",[_k,gk],Object.getOwnPropertyDescriptor(Go.prototype,"setDevice"),Go.prototype),tn(Go.prototype,"setEnabled",[vk,Tk,yk],Object.getOwnPropertyDescriptor(Go.prototype,"setEnabled"),Go.prototype),tn(Go.prototype,"setEncoderConfiguration",[Sk,Rk],Object.getOwnPropertyDescriptor(Go.prototype,"setEncoderConfiguration"),Go.prototype),tn(Go.prototype,"close",[Ck],Object.getOwnPropertyDescriptor(Go.prototype,"close"),Go.prototype),Go);function UA(e,t,r,n){r.optimizationMode&&(n&&n.width&&n.height?(r.encoderConfig=Wn(Wn({},n),{},{bitrateMin:n.bitrateMin,bitrateMax:n.bitrateMax}),r.optimizationMode!=="motion"&&r.optimizationMode!=="detail"||(t.contentHint=r.optimizationMode,t.contentHint===r.optimizationMode?L.debug("[".concat(e,"] set content hint to"),r.optimizationMode):L.debug("[".concat(e,"] set content hint failed")))):L.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var Ik,Ak,bk,Ok,fs,Nk,wk,Dk,Pk,Lk,kk,ba;class Mk extends FP{getUserId(){return this._userId}constructor(t,r,n,i){super(t,"track-".concat(t.kind,"-").concat(r,"-").concat(i.clientId,"_").concat(On(5,""))),nt(this,"_userId",void 0),nt(this,"_uintId",void 0),nt(this,"_isDestroyed",!1),nt(this,"store",void 0),nt(this,"processor",void 0),nt(this,"processorContext",void 0),this._userId=r,this._uintId=n,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,L.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let uE=(Ik=Nr({argsMap:(e,t,r)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",r]}),Ak=Nr({argsMap:e=>[e.getTrackId()]}),bk=Nr({argsMap:(e,t)=>[e.getTrackId(),t.name]}),Ok=Nr({argsMap:e=>[e.getTrackId()]}),tn((fs=class extends Mk{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==Aa.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,r,n){super(e,t,r,n),nt(this,"_videoVisibleTimer",null),nt(this,"_previousVideoVisibleStatus",void 0),nt(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),nt(this,"trackMediaType",oE.VIDEO),nt(this,"_videoWidth",void 0),nt(this,"_videoHeight",void 0),nt(this,"_player",void 0),nt(this,"processorDestination",void 0),nt(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new $P(this.getTrackId(),"remote"),this.processorDestination=new QP(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Wd(()=>{L.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),Lo(this,hr.GET_STATS)||Wn({},BP)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){let n=document.getElementById(e);n?e=n:(L.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}L.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));let r=Wn(Wn({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(r):(e instanceof HTMLVideoElement?this._player=new kA(r):this._player=new zL(r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(aE.FIRST_FRAME_DECODED)},this._player.onVideoStateChanged=n=>{this.safeEmit(aE.VIDEO_STATE_CHANGED,n)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{let n=this.getVideoElementVisibleStatus();this.safeEmit(aE.VIDEO_ELEMENT_VISIBLE_STATUS,n)}catch{}},Se("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,L.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){rL(this._originMediaStreamTrack).then(e=>{let[t,r]=e;this._videoHeight=r,this._videoWidth=t}).catch(YS)}_updatePlayerSource(){L.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;let r=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),n={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:r?.parentElement},{element:i,slot:o}=n;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){let l=nP.checkOneElementVisible(i),u=Object.assign({},l);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;let h=gr.reportApiInvoke(null,{tag:Jn.TRACER,name:gi.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(r){throw new Et(ce.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Et(ce.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;let e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(La.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(La.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(Op.SEI_RECEIVED,e)}}).prototype,"play",[Ik],Object.getOwnPropertyDescriptor(fs.prototype,"play"),fs.prototype),tn(fs.prototype,"stop",[Ak],Object.getOwnPropertyDescriptor(fs.prototype,"stop"),fs.prototype),tn(fs.prototype,"pipe",[bk],Object.getOwnPropertyDescriptor(fs.prototype,"pipe"),fs.prototype),tn(fs.prototype,"unpipe",[Ok],Object.getOwnPropertyDescriptor(fs.prototype,"unpipe"),fs.prototype),fs),dE=(Nk=Nr({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),wk=Nr({argsMap:(e,t)=>[e.getTrackId(),t]}),Dk=Nr({argsMap:e=>[e.getTrackId()]}),Pk=Nr({argsMap:e=>[e.getTrackId()]}),Lk=Nr({argsMap:(e,t)=>[e.getTrackId(),t.name]}),kk=Nr({argsMap:e=>[e.getTrackId()]}),tn((ba=class extends Mk{get isPlaying(){return this._useAudioElement?Wa.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,r,n){super(e,t,r,n),nt(this,"trackMediaType",oE.AUDIO),nt(this,"_source",void 0),nt(this,"_useAudioElement",!0),nt(this,"_volume",100),nt(this,"processorContext",void 0),nt(this,"processorDestination",void 0),nt(this,"_played",!1),nt(this,"_bypassWebAudio",!1),Se("DISABLE_WEBAUDIO")?(this._source=new PA,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new KP(e,!0),Se("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(Uo.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(aE.FIRST_FRAME_DECODED)}),this.processorContext=new tL(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new eL(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(Uo.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(Uo.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(Uo.ON_AUDIO_BUFFER),this._source.on(Uo.ON_AUDIO_BUFFER,r=>e(r))}setVolume(e){this._volume=e,this._useAudioElement?Wa.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!MP())throw new Et(ce.NOT_SUPPORTED,"your browser does not support setting the audio output device");await Wa.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Wd(()=>{L.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),Lo(this,hr.GET_STATS)||Wn({},jP)}play(){L.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(L.debug("[".concat(this.getTrackId(),"] use audio element to play")),Wa.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){L.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?Wa.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];L.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&Wa.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Et(ce.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Et(ce.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Et(ce.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;let t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(La.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(La.ON_NODE,e=>{this._source.processedNode=e;let t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(La.ON_TRACK),this.processorDestination.removeAllListeners(La.ON_NODE)}}).prototype,"setVolume",[Nk],Object.getOwnPropertyDescriptor(ba.prototype,"setVolume"),ba.prototype),tn(ba.prototype,"setPlaybackDevice",[wk],Object.getOwnPropertyDescriptor(ba.prototype,"setPlaybackDevice"),ba.prototype),tn(ba.prototype,"play",[Dk],Object.getOwnPropertyDescriptor(ba.prototype,"play"),ba.prototype),tn(ba.prototype,"stop",[Pk],Object.getOwnPropertyDescriptor(ba.prototype,"stop"),ba.prototype),tn(ba.prototype,"pipe",[Lk],Object.getOwnPropertyDescriptor(ba.prototype,"pipe"),ba.prototype),tn(ba.prototype,"unpipe",[kk],Object.getOwnPropertyDescriptor(ba.prototype,"unpipe"),ba.prototype),ba),Lu=new class extends zn{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),nt(this,"_lastHiddenTime",0),nt(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),L.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Uk extends zn{constructor(t,r){super(),nt(this,"trackMediaType",oE.DATA),nt(this,"_version",1),nt(this,"_type",3),nt(this,"_config",void 0),nt(this,"_originDataChannel",void 0),nt(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),nt(this,"_dataStreamPacketHandler",{serialize:n=>n,deserialize:n=>n}),nt(this,"_datachannelEventMap",new Map),this._config=t,r&&(this._originDataChannel=r,this._bandDataChannelEvents(r)),this._initPacketHeader()}useDataStream(t){this._dataStreamPacketHandler=t}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return Se("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.readyState)!==null&&t!==void 0?t:"connecting"}get _originDataChannelId(){var t,r;return(t=(r=this._originDataChannel)===null||r===void 0?void 0:r.id)!==null&&t!==void 0?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new tr((t,r)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&t();let n=setTimeout(()=>{var i;r(new Et(ce.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((i=this._originDataChannel)===null||i===void 0?void 0:i.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new Et(ce.DATACHANNEL_CONNECTION_TIMEOUT)}}else r(new Et(ce.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){let t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[nR.OPEN,nR.CLOSE,nR.ERROR].forEach(r=>{let n=()=>{this.emit(r)};this._datachannelEventMap.set(r,n),t.addEventListener(r,n)})}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach(r=>{let[n,i]=r;t.removeEventListener(n,i)}),this._datachannelEventMap.clear()}}class gF extends Uk{constructor(t){super(t),nt(this,"_messageListener",void 0),this._messageListener=r=>{if(r.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);let n=r.data.slice(0,this._dataStreamPacketHeader.byteLength),i=new DataView(n).getUint8(3);if(i!==this.id)return void(Se("SHOW_DATASTREAM2_LOG")&&L.debug("invalid datachannel id: ".concat(i," !== ").concat(this.id)));let o=r.data.slice(this._dataStreamPacketHeader.byteLength);o=this._dataStreamPacketHandler.deserialize(o),this.emit(nR.MESSAGE,o)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class vF extends Uk{send(t){if(this._originDataChannel){let r=t;r=this._dataStreamPacketHandler.serialize(t);let n=new Uint8Array(this._dataStreamPacketHeader.byteLength+r.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(r),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}function sR(){let e=new Blob([atob("ZnVuY3Rpb24gdCh0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLG89W10scj0wO2Zvcig7by5sZW5ndGg8bjspciszPG4mJjA9PT1hW3JdJiYwPT09YVtyKzFdJiYzPT09YVtyKzJdJiYoMD09PWFbciszXXx8MT09PWFbciszXXx8Mj09PWFbciszXXx8Mz09PWFbciszXSk/KG8ucHVzaChhW3JdLGFbcisxXSxhW3IrM10pLHIrPTQpOihvLnB1c2goYVtyXSkscisrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobyl9ZnVuY3Rpb24gZSh0LGUpe2NvbnN0IG49ZnVuY3Rpb24odCl7Y29uc3QgZT10Lmxlbmd0aDtsZXQgbj1bXSxhPTA7Zm9yKDthPGU7KWErMjxlJiYwPT09dFthXSYmMD09PXRbYSsxXSYmKDA9PT10W2ErMl18fDE9PT10W2ErMl18fDI9PT10W2ErMl18fDM9PT10W2ErMl0pPyhuLnB1c2godFthXSx0W2ErMV0sMyx0W2ErMl0pLGErPTMpOihuLnB1c2godFthXSksYSsrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkobil9KGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxyPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNitvKzErYSt0LmJ5dGVMZW5ndGgpO3NbMF09MCxzWzFdPTAsc1syXT0wLHNbM109MSxzWzRdPTYsc1s1XT0xMDE7bGV0IGk9MDtmb3IoO2k8bzspc1s2K2ldPTI1NSxpKys7cmV0dXJuIHNbNitpXT1yLGkrKyxzLnNldChuLDYraSkscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNitpK2EpLHMuYnVmZmVyfWNvbnN0IG49NzEsYT0xLG89MixyPTEscz0yO3ZhciBpOyFmdW5jdGlvbih0KXt0W3QuQVVESU9fTEVWRUw9MV09IkFVRElPX0xFVkVMIix0W3QuTUVUQURBVEE9Ml09Ik1FVEFEQVRBIix0W3QuQVVESU9fNjRfQklUX1BUUz0zXT0iQVVESU9fNjRfQklUX1BUUyJ9KGl8fChpPXt9KSk7bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJTYWZhcmkiKT4tMSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIkNocm9tZSIpJiYoc2VsZi5vbnJ0Y3RyYW5zZm9ybT1mPT57Y29uc3QgdT1mLnRyYW5zZm9ybWVyO2xldCBkPVtdLGw9W107dS5vcHRpb25zLnBvcnQub25tZXNzYWdlPXQ9Pnt0LmRhdGEuc2VpJiZkLnB1c2godC5kYXRhLnNlaSksdC5kYXRhLm1ldGFkYXRhJiZsLnB1c2godC5kYXRhLm1ldGFkYXRhKX0sc2VsZi5wb3N0TWVzc2FnZSgic3RhcnRlZCIpO2NvbnN0IGc9dS5yZWFkYWJsZS5nZXRSZWFkZXIoKSxjPXUud3JpdGFibGUuZ2V0V3JpdGVyKCk7InNlaS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiBlKG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IGU9ZnVuY3Rpb24oZSl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcoZS5kYXRhKTtsZXQgYT0wO2Zvcig7YSs0PGUuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PW4uZ2V0VWludDgoYSswKSYmMD09PW4uZ2V0VWludDgoYSsxKSYmMD09PW4uZ2V0VWludDgoYSsyKSYmMT09PW4uZ2V0VWludDgoYSszKSYmNj09PW4uZ2V0VWludDgoYSs0KSl7bGV0IG89YSs2LHI9MCxzPTA7Zm9yKDsyNTU9PT0ocz1uLmdldFVpbnQ4KG8rKykpOylyKz0yNTU7cis9cztjb25zdCBpPXQoZS5kYXRhLG8scik7cmV0dXJuIG5ldyBVaW50OEFycmF5KGkpfWErK31yZXR1cm4gbnVsbH0oYS52YWx1ZSk7ZSYmbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTplfSl9Yy53cml0ZShhLnZhbHVlKSxuLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSxlKG4pfX0pKX0odSk6InNlaS10eCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KG4pe2cucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9ZC5zaGlmdCgpO3QmJihhLnZhbHVlLmRhdGE9ZShhLnZhbHVlLmRhdGEsdCkpfWMud3JpdGUoYS52YWx1ZSksbi5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChuKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS1yeCI9PT11Lm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2cucmVhZCgpLnRoZW4oKGY9PntpZighZi5kb25lKXtpZihmLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZEF1ZGlvRnJhbWUpe2NvbnN0IHQ9ZnVuY3Rpb24odCxlPSExKXtjb25zdCBmPXQuZ2V0VWludDgoMCk7aWYoZiE9PW4pcmV0dXJuO2NvbnN0IHU9dC5nZXRVaW50MTYoMSksZD1hK28rdSxsPW5ldyBVaW50OEFycmF5KHQuYnl0ZUxlbmd0aC1kKTtsLnNldChuZXcgVWludDhBcnJheSh0LmJ1ZmZlcixkLHQuYnl0ZUxlbmd0aC1kKSk7Y29uc3QgZz17bTpmLHRsdkxlbjp1LHRsdjpbXSxmcmFtZTpsfTtsZXQgYz1hK287Zm9yKDtjPGQ7KXtjb25zdCBuPXQuZ2V0VWludDgoYyksYT10LmdldFVpbnQxNihjK3IpLG89citzO2lmKG49PT1pLkFVRElPX0xFVkVMKXtsZXQgcj10LmdldFVpbnQ4KGMrbyk7Zm9yKGxldCBlPTE7ZTxhO2UrKylyPXI8PDh8dC5nZXRVaW50OChjK28rZSk7Zy50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZT8xMjdecj4+MToxMjcmcn0pfWVsc2UgaWYobj09PWkuTUVUQURBVEF8fG49PT1pLkFVRElPXzY0X0JJVF9QVFMpe2NvbnN0IGU9bmV3IFVpbnQ4QXJyYXkoYSk7Zm9yKGxldCBuPTA7bjxhO24rKyllW25dPXQuZ2V0VWludDgoYytvK24pO2cudGx2LnB1c2goe3RhZzpuLGxlbmd0aDphLHZhbHVlOmV9KX1jKz1vK2F9cmV0dXJuIGd9KG5ldyBEYXRhVmlldyhmLnZhbHVlLmRhdGEpKTtpZih0KXtjb25zdCBuPXQudGx2LmZpbmQoKHQ9PnQudGFnPT09aS5NRVRBREFUQXx8dC50YWc9PT1pLkFVRElPXzY0X0JJVF9QVFMpKTtuJiZuLnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe21ldGFkYXRhOm4udmFsdWV9KSxmLnZhbHVlLmRhdGE9dC5mcmFtZS5idWZmZXJ9fWMud3JpdGUoZi52YWx1ZSksZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3RyYW5zZm9ybWVkOiEwfSksdChlKX19KSl9KHUpOiJhdWRpby1tZXRhZGF0YS10eCI9PT11Lm9wdGlvbnMubmFtZSYmZnVuY3Rpb24gdChlKXtnLnJlYWQoKS50aGVuKChmPT57aWYoIWYuZG9uZSl7aWYoZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe2dldE1ldGFkYXRhOiEwfSksZi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRBdWRpb0ZyYW1lKXtjb25zdCB0PWwuc2hpZnQoKTt0JiYoZi52YWx1ZS5kYXRhPWZ1bmN0aW9uKHQsZSxpKXtjb25zdCBmPWkuYnl0ZUxlbmd0aCx1PWYrcitzLGQ9YStvK3UsbD1uZXcgQXJyYXlCdWZmZXIodC5ieXRlTGVuZ3RoK2QpLGc9bmV3IERhdGFWaWV3KGwpO2cuc2V0VWludDgoMCxuKSxnLnNldFVpbnQxNigxLHUpLGcuc2V0VWludDgoMyxlKSxnLnNldFVpbnQxNig0LGYpO2ZvcihsZXQgdD0wO3Q8Zjt0KyspZy5zZXRVaW50OCg2K3QsaVt0XSk7Y29uc3QgYz1uZXcgVWludDhBcnJheShnLmJ1ZmZlcik7cmV0dXJuIGMuc2V0KG5ldyBVaW50OEFycmF5KHQpLGQpLGMuYnVmZmVyfShmLnZhbHVlLmRhdGEsaS5BVURJT182NF9CSVRfUFRTLHQpKX1jLndyaXRlKGYudmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfSh1KX0sc2VsZi5wb3N0TWVzc2FnZSgicmVnaXN0ZXJlZCIpKTsK")],{type:"text/javascript"});return setTimeout(()=>sS.revokeObjectURL(e),0),new Worker(sS.createObjectURL(e))}let xk=71,xA=1,jA=2,BA=1,jk=2;var ku=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(ku||{});function Bk(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=e.getUint8(0);if(r!==xk)return;let n=e.getUint16(1),i=xA+jA+n,o=new Uint8Array(e.byteLength-i);o.set(new Uint8Array(e.buffer,i,e.byteLength-i));let l={m:r,tlvLen:n,tlv:[],frame:o},u=xA+jA;for(;u<i;){let h=e.getUint8(u),m=e.getUint16(u+BA),_=BA+jk;if(h===ku.AUDIO_LEVEL){let R=e.getUint8(u+_);for(let A=1;A<m;A++)R=R<<8|e.getUint8(u+_+A);l.tlv.push({tag:h,length:m,value:t?127^R>>1:127&R})}else if(h===ku.METADATA||h===ku.AUDIO_64_BIT_PTS){let R=new Uint8Array(m);for(let A=0;A<m;A++)R[A]=e.getUint8(u+_+A);l.tlv.push({tag:h,length:m,value:R})}u+=_+m}return l}let cR=new Map,lR=127,Dp=1e-10,VA=139/13,uR=new Map;function FA(e,t,r){let n="".concat(e,"-").concat(t,"-").concat(r),i=0;return uR.has(n)?i=uR.get(n):(i=Math.log(function(o,l){let u=o-l;l<u&&(l=u);let h=1;for(let m=o,_=1;m>l;m--,_++)h=h*m/_;return h}(t,e))+e*Math.log(.5)+(t-e)*Math.log(1-.5)-Math.log(r)+r*e,uR.set(n,i)),i<Dp&&(i=Dp),i}function Vk(e,t,r){let n=t.length,i=e.length/n,o=!1;for(let l=0,u=0;l<n;l++){let h=0;for(let m=u+i;u<m;u++)e[u]>r&&h++;t[l]!==h&&(t[l]=h,o=!0)}return o}window.cache=uR;let TF=0;class Fk{constructor(t){nt(this,"id",void 0),nt(this,"immediates",[]),nt(this,"lastNonSilence",-1),nt(this,"immediateSpeechActivityScore",Dp),nt(this,"lastLevelChangedTime",Date.now()),nt(this,"levels",[]),nt(this,"longs",[]),nt(this,"longSpeechActivityScore",Dp),nt(this,"mediums",[]),nt(this,"mediumSpeechActivityScore",Dp),nt(this,"minLevel",0),nt(this,"nextMinLevel",0),nt(this,"nextMinLevelWindowLength",0),nt(this,"energyScore",0),this.id=t||"".concat(TF++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){let t=this.immediates,r=this.levels,n=this.minLevel+VA,i=!1;for(let o=0;o<t.length;++o){let l=r[o];l<n&&(l=0);let u=Math.floor(l/VA);t[o]!==u&&(t[o]=u,i=!0)}return i}computeLongs(){return Vk(this.mediums,this.longs,4)}computeMediums(){return Vk(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=FA(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(t){this.longSpeechActivityScore=FA(this.longs[0],10,47),this.longSpeechActivityScore>Dp&&(this.lastNonSilence=t)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=FA(this.mediums[0],5,24)}evaluateSpeechActivityScores(t){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(t)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var t;return"[".concat(Ih(t=[...this.levels]).call(t).join(),"]")}getSpeechActivityScore(t){switch(t){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+t)}}levelChanged(t,r){if(this.lastLevelChangedTime<=r){this.lastLevelChangedTime=r;let n=t;return t<0&&(n=0),t>lR&&(n=lR),this.levels.unshift(n),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(n),n>=this.minLevel+VA?n:n/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(t){if(t!==0){if(this.minLevel===0||this.minLevel>t)return this.minLevel=t,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=t,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>t&&(this.nextMinLevel=t),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let r=Math.sqrt(this.minLevel*this.nextMinLevel);r<0?r=0:r>lR&&(r=lR),this.minLevel=r,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class yF{constructor(t){nt(this,"algorithm",void 0),this.algorithm=t}execute(){let t=!this.algorithm;if(!t)try{let r=this.algorithm.runInDecisionMaker(this);r<=0?t=!0:setTimeout(this.execute.bind(this),r)}catch{t=!0}t&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class GA{constructor(t,r,n){nt(this,"isDominant",void 0),nt(this,"energyRanking",void 0),nt(this,"energyScore",void 0),this.isDominant=t,this.energyRanking=r,this.energyScore=n}}class SF extends zn{constructor(t){super(),nt(this,"dominantId",null),nt(this,"lastDecisionTime",0),nt(this,"lastLevelChangedTime",0),nt(this,"lastLevelIdleTime",0),nt(this,"relativeSpeechActivities",[]),nt(this,"speakers",new Map),nt(this,"enableSilence",!1),nt(this,"timeoutToSilenceInterval",0),nt(this,"decisionMaker",null),nt(this,"loudest",[]),nt(this,"numLoudestToTrack",3),nt(this,"energyExpireTimeMs",250),nt(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=t,this.enableSilence=t>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,r=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=t,r!=null&&(this.energyExpireTimeMs=r),n!=null&&(this.energyAlphaPct=n),this.loudest.length>t&&this.loudest.splice(t)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(t){return this.loudest.some(r=>r.id===t)}levelChanged(t,r){let n=Date.now(),i=this.getOrCreateSpeaker(t);this.lastLevelChangedTime<n&&(this.lastLevelChangedTime=n,this.maybeStartDecisionMaker());let o=i.levelChanged(r,n);return this.updateLoudestList(i,o,n)}runInDecisionMaker(t){return this.decisionMaker!==t||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(t){this.decisionMaker===t&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(t){t.forEach(r=>{this.speakers.has(r.id)||this.speakers.set(r.id,r)})}removeSpeakers(t){t.forEach(r=>{this.speakers.delete(r.id)})}getOrCreateSpeaker(t){let r=this.speakers.get(t);return r||(r=new Fk(t),this.speakers.set(t,r),this.maybeStartDecisionMaker()),r}updateLoudestList(t,r,n){let i=t.id===this.dominantId;if(r<0){let h=0;for(;h<this.loudest.length&&this.loudest[h]!==t;)++h;return new GA(i,h,t.energyScore)}if(t.energyScore=Math.floor((this.energyAlphaPct*r+(100-this.energyAlphaPct)*t.energyScore+50)/100),this.numLoudestToTrack===0)return new GA(i,0,t.energyScore);let o=n-this.energyExpireTimeMs,l=0;for(;l<this.loudest.length;){let h=this.loudest[l];if(h.getLastLevelChangedTime()<o&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(l,1);else if(h.id!==t.id)++l;else if(this.loudest.splice(l,1),this.loudest.length<this.numLoudestToTrack)break}let u=0;for(;u<this.loudest.length&&!(this.loudest[u].energyScore<t.energyScore);)++u;return u<this.numLoudestToTrack&&(this.loudest.splice(u,0,t),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new GA(i,u,t.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new yF(this),this.decisionMaker.execute())}makeDecision(t){let r=null,n=null,i=this.speakers.size,o=null;if(i===0)o=null;else if(i===1){var l;let u=ro(l=this.speakers).call(l).next().value;this.enableSilence&&u&&(o=u.id,u.evaluateSpeechActivityScores(t),t-u.lastNonSilence>this.timeoutToSilenceInterval&&(o=null))}else{let u=this.dominantId==null?null:this.speakers.get(this.dominantId);if(u==null){let _=this.speakers.entries().next();_.value&&(o=_.value[0],u=_.value[1])}else o=u.id;u?.evaluateSpeechActivityScores(t);let h=this.relativeSpeechActivities,m=2;for(let _ of this.speakers.entries()){let[R,A]=_;if(A===u)continue;A.evaluateSpeechActivityScores(t);for(let K=0;K<h.length;++K){let se=u==null?Dp:u.getSpeechActivityScore(K);h[K]=Math.log(A.getSpeechActivityScore(K)/se)}let D=h[0],J=h[1],V=h[2];D>3&&J>2&&V>0&&J>m&&(m=J,o=R)}this.enableSilence&&u!=null&&o===u.id&&t-u.lastNonSilence>this.timeoutToSilenceInterval&&(o=null)}o==null&&!this.enableSilence||o===this.dominantId||(r=this.dominantId,this.dominantId=o,n=this.dominantId),n==null&&!this.enableSilence||n===r||this.emit("ActiveSpeakerChanged",n)}_runInDecisionMaker(){let t=Date.now(),r=300-(t-this.lastLevelIdleTime),n=0;r<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(t),this.lastLevelIdleTime=t):n=r;let i=300-(t-this.lastDecisionTime);return i<=0&&(this.lastDecisionTime=t,this.makeDecision(t),i=300-(Date.now()-t)),i>0&&n>i&&(n=i),n}timeoutIdleLevels(t){let r=[];for(let i of ro(n=this.speakers).call(n)){var n;let o=t-i.getLastLevelChangedTime();36e5<o&&(this.dominantId==null||i.id!==this.dominantId)?r.push(i.id):300<o&&i.levelTimedOut()}r.forEach(i=>this.speakers.delete(i))}}let hE=new Map,Bc=null,dR=null,Gk=3,Pp=[],Vc=new Map,hR=new Map;class RF{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(t,r){nt(this,"id",void 0),nt(this,"track",void 0),nt(this,"score",0),nt(this,"active",!0),nt(this,"muted",!1),nt(this,"timer",0),nt(this,"actives",0),nt(this,"inactives",0),this.id=t,this.track=r,this.setActive(Vc.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){let t=this.active;this.active=this.activeRate>=.8;let{actives:r,inactives:n}=function(){let i=[],o=[];return Array.from(ro(Vc).call(Vc)).forEach(l=>{l.active?i.push(l):o.push(l)}),{actives:i,inactives:o}}();if(r.length>3){let i;r.forEach(o=>{(!i||i.score>o.score)&&(i=o)}),i&&i.setActive(!1)}if(r.length<3&&n.length>0){let i;n.forEach(o=>{(!i||i.score<o.score)&&o.id!==this.id&&(i=o)}),i&&t&&!this.active&&(i.samples>40&&i.activeRate-this.activeRate>.4?i.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(t){this.active=t,this.resetTimer(),this.setMuted(!t)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){let t=function(r){let n;return Array.from(ro(Vc).call(Vc)).forEach(i=>{!i.active||i.id===r||i.samples<40||(!n||i.score<n.score)&&(n=i)}),n}(this.id);t&&this.activeRate-t.activeRate>.4&&(t.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){let t=function(r){let n;return Array.from(ro(Vc).call(Vc)).forEach(i=>{i.active||i.id===r||i.samples<40||(!n||i.score>n.score)&&(n=i)}),n}(this.id);t&&t.activeRate-this.activeRate>.4&&(t.setActive(!0),this.setActive(!1))}addSample(t){t?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(t){this.track&&(this.track.enabled=!t,this.muted=t)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let pR;function Hk(e){let t=Vc.get(e);t&&(Vc.delete(e),t.clearTimer())}let fR=new Map,CF=new Map;function IF(e,t,r){let n=new Uint8Array(e,t,r),i=[],o=0;for(;i.length<r;)o+3<r&&n[o]===0&&n[o+1]===0&&n[o+2]===3&&(n[o+3]===0||n[o+3]===1||n[o+3]===2||n[o+3]===3)?(i.push(n[o],n[o+1],n[o+3]),o+=4):(i.push(n[o]),o++);return new Uint8Array(i)}let mR=new Map,Qg=new Map;(function(){let e=$r();Xi.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),Xi.getStreamFromExtension=e.name===an.CHROME&&Number(e.version)>34,Xi.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let t=new RTCPeerConnection,r=!1;try{t.addTransceiver("audio"),r=!0}catch{}return t.close(),r}(),Xi.supportMinBitrate=e.name===an.CHROME||e.name===an.EDGE,Xi.supportSetRtpSenderParameters=function(){let t=$r();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!wu()||!(!ra()&&!WS())||t.name===an.FIREFOX&&Number(t.version)>=64)}(),e.name===an.SAFARI&&(Number(e.version)>=14?Xi.supportDualStream=!0:Xi.supportDualStream=!1),Xi.webAudioMediaStreamDest=function(){let t=$r();return!(t.name===an.SAFARI&&Number(t.version)<12)}(),Xi.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",Xi.supportWebGL=typeof WebGLRenderingContext<"u",Xi.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,wu()||(Xi.webAudioWithAEC=!0),Xi.supportShareAudio=function(){let t=$r();return(t.os===Di.WIN_10||t.os===Di.WIN_81||t.os===Di.WIN_7||t.os===Di.LINUX||t.os===Di.MAC_OS||t.os===Di.CHROMIUM_OS)&&t.name===an.CHROME&&Number(t.version)>=74}(),Xi.supportDataChannel=!!(Fg(76)||function(t){let r=$r();return!(r.name!==an.FIREFOX||!r.osVersion)&&Number(r.version)>=t}(68)||Y1(14)),Xi.supportPCSetConfiguration=function(){let t=window.RTCPeerConnection;return!Yn()&&!!t&&t.prototype.setConfiguration instanceof Function}(),Xi.supportWebRTCEncodedTransform=function(){let t=$r();return t.name==="Chrome"&&Number(t.version)>=87||t.name==="Safari"&&Number(t.version)>=15}(),Xi.supportWebRTCInsertableStream=function(){let t=$r();return(t.name===an.CHROME||t.name===an.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Xi.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,Xi.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,qS(()=>{Xi.supportDualStreamEncoding=function(){let t=$r();return!!Se("DISABLE_WEBAUDIO")||t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&Se("CHROME_DUAL_STREAM_USE_ENCODING"))}(),L.debug("browser ua: ",navigator.userAgent),L.info("browser info: ",e),L.info("browser compatibility: ",Xi)})})();let AF=["CHINA","GLOBAL"],Wk=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Lp=[],pE=[];function kp(e,t){return!!t&&Lp.some(r=>r.uid===e&&r.channelName===t)}function HA(){return pE.length>0}var bF=hD.forEach,Kk=Fa("forEach")?[].forEach:function(e){return bF(this,e,arguments.length>1?arguments[1]:void 0)};dn({target:"Array",proto:!0,forced:[].forEach!=Kk},{forEach:Kk});var OF=Ba("Array").forEach,NF=Zo,wF=Jt,DF=v,PF=OF,WA=Array.prototype,LF={DOMTokenList:!0,NodeList:!0},kF=function(e){var t=e.forEach;return e===WA||DF(WA,e)&&t===WA.forEach||wF(LF,NF(e))?PF:t},MF=fe(kF),UF=ct,zk=wh;dn({target:"Object",stat:!0,forced:We(function(){zk(1)})},{keys:function(e){return zk(UF(e))}});var qk=fe(yt.Object.keys),xF=fe(Sh),jF=fe(Ch),BF=dn,Yk=ya,VF=yd,FF=er,Xk=of,GF=uc,HF=pr,WF=ls,KF=mn,zF=Yh,qF=nD("slice"),YF=KF("species"),KA=Array,XF=Math.max;BF({target:"Array",proto:!0,forced:!qF},{slice:function(e,t){var r,n,i,o=HF(this),l=GF(o),u=Xk(e,l),h=Xk(t===void 0?l:t,l);if(Yk(o)&&(r=o.constructor,(VF(r)&&(r===KA||Yk(r.prototype))||FF(r)&&(r=r[YF])===null)&&(r=void 0),r===KA||r===void 0))return zF(o,u,h);for(n=new(r===void 0?KA:r)(XF(h-u,0)),i=0;u<h;u++,i++)u in o&&WF(n,i,o[u]);return n.length=i,n}});var JF=Ba("Array").slice,ZF=v,QF=JF,zA=Array.prototype,$F=function(e){var t=e.slice;return e===zA||ZF(zA,e)&&t===zA.slice?QF:t},eG=fe($F);function _r(e,t,r,n,i){var o,l,u,h={};return MF(o=qk(n)).call(o,function(m){h[m]=n[m]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=xF(l=jF(u=eG(r).call(r)).call(u)).call(l,function(m,_){return _(e,t,m)||m},h),i&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(i):void 0,h.initializer=void 0),h.initializer===void 0&&($w(e,t,h),h=null),h}let ER=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),qA=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),Xs=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),ka=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),br=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),Pn=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),Lr=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),Dr=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e}({}),$g=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),Wr=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),Ma=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Ur=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function _R(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw L.error("Invalid Channel Name ".concat(e)),new at(ce.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function gR(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||rP(e,1,255)))throw new at(ce.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&L.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let Mu=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({}),tG={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},YA={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function XA(e,t){qi(e.url,"".concat(t,".url"),1,1e3,!1),Xn(e.x)||vn(e.x,"".concat(t,".x"),0,1e4),Xn(e.y)||vn(e.y,"".concat(t,".y"),0,1e4),Xn(e.width)||vn(e.width,"".concat(t,".width"),0,1e4),Xn(e.height)||vn(e.height,"".concat(t,".height"),0,1e4),Xn(e.zOrder)||vn(e.zOrder,"".concat(t,".zOrder"),0,255),Xn(e.alpha)||vn(e.alpha,"".concat(t,".alpha"),0,1,!1)}let rG={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},qd=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),JA=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),Ii=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function Jk(e){if(!e.channelName)throw new at(ce.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new at(ce.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&qi(e.token,"info.token",1,2047),gR(e.uid),_R(e.channelName),!0}let Ua=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),Uu=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),oo=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),fE=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),un=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),Fi=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),vR=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),Li=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),on=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({}),Zk=[on.AFRICA,on.ASIA,on.CHINA,on.EUROPE,on.GLOBAL,on.INDIA,on.JAPAN,on.NORTH_AMERICA,on.OCEANIA,on.OVERSEA,on.SOUTH_AMERICA],ha=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({}),TR={CHINA:{},ASIA:{CODE:ha.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:ha.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:ha.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:ha.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:ha.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:ha.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:ha.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:ha.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:ha.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:ha.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:ha.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:ha.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:ha.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};_A&&(TR.CHINA={CODE:ha.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let ev=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function Qk(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class $k extends zn{constructor(t,r){super(),ie(this,"onICEConnectionStateChange",void 0),ie(this,"onConnectionStateChange",void 0),ie(this,"onDTLSTransportStateChange",void 0),ie(this,"onDTLSTransportError",void 0),ie(this,"onICETransportStateChange",void 0),ie(this,"onFirstAudioReceived",void 0),ie(this,"onFirstVideoReceived",void 0),ie(this,"onFirstAudioDecoded",void 0),ie(this,"onFirstVideoDecoded",void 0),ie(this,"onFirstVideoDecodedTimeout",void 0),ie(this,"onSelectedLocalCandidateChanged",void 0),ie(this,"onSelectedRemoteCandidateChanged",void 0),ie(this,"onICECandidateError",void 0),ie(this,"getLocalVideoStats",void 0)}}class eM extends $k{constructor(t,r){super(t,r),ie(this,"establishPromise",void 0)}}let lr=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),pa=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),xu=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({}),tM=["disconnected","failed"],Mt=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),ln=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),Cr=function(e){return e.AudioMetadata="audioMetadata",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),Js=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Zs=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),Gi=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),rM=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),Ul=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),ms=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),Fc=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),mE=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),oi=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),EE=function(e){return e.ABORT="abort",e}({}),Yd=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),nG=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({}),iG={[ER.ACCESS_POINT]:{[ka.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[ka.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[ka.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[ka.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[ka.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[ka.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[ka.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[ER.UNILBS]:{[Xs.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Xs.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Xs.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Xs.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Xs.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Xs.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Xs.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Xs.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Xs.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Xs.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Xs.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Xs.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[ER.STRING_UID_ALLOCATOR]:{[qA.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[qA.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[qA.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function _E(e){let t=iG[Math.floor(e/1e4)];if(!t)return{desc:"unknown error",retry:!1};let r=t[e%1e4];if(!r){if(Math.floor(e/1e4)===ER.ACCESS_POINT){let n=e%1e4;if(n.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(n.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return r}let aG={[br.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[br.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[br.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[br.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[br.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[br.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[br.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[br.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[br.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[br.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[br.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[br.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[br.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[br.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[br.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[br.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[br.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[br.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[br.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[br.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[br.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[br.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[br.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[br.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[br.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[br.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[br.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[br.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[br.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[br.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[br.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[br.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[br.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[br.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[br.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[br.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[br.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[br.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[br.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[br.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[br.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[br.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[br.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[br.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[br.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[br.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[br.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[br.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[br.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[br.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[br.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[br.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[br.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[br.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[br.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[br.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[br.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[br.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[br.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[br.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[br.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[br.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[br.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[br.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function tv(e){return aG[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function nM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ZA(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?nM(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iM(e,t){if(typeof e=="string")return e;let{proxy:r,host:n,port:i}=e;if(t){let o=Se("JOIN_GATEWAY_FALLBACK_PORT")||443;return o===443?"wss://".concat(n,"/ws/?p=").concat(Number(i)+150):"wss://".concat(n,":").concat(o,"/ws/?p=").concat(Number(i)+150)}return r?"wss://".concat(r,"/ws/?h=").concat(n,"&p=").concat(i):"wss://".concat(n,":").concat(i)}let oG=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,sG=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,cG=/wss:\/\/(.+):([0-9]+)\/?/,lG=/wss:\/\/(.[^\/]+)\/?/,uG=0;class dG{constructor(t,r){ie(this,"id",0),ie(this,"store",void 0),ie(this,"recordIndex",void 0),ie(this,"websockets",[]),ie(this,"try443PortDuration",2e3),ie(this,"forceCloseWSDuration",5e3),ie(this,"try443PortTimeout",null),ie(this,"forceCloseTimeout",null),ie(this,"isTry443PortFailed",!1),ie(this,"isNormalPortFailed",!1),ie(this,"useDoubleDomain",!1),ie(this,"useProxy",!1),ie(this,"startTime",Date.now()),this.id=++uG,this.try443PortDuration=Se("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=r}closeAllWebsockets(){this.websockets.forEach(t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var t;let r=Date.now()-this.startTime;for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];L.debug("[choose-best-ws ".concat((t=this.store)===null||t===void 0?void 0:t.clientId," ").concat(this.id,"] ").concat(r,"ms:"),...i)}createWebSocket(t,r,n){this.logger("createWebSocket:",t,{isTry443Port:r,hasTimeoutDetection:n});let i=Se("GATEWAY_DOMAINS"),o=Date.now(),l=[],u=i.find(A=>{var D;return Qt(D=t.host).call(D,A)});u||(this.useDoubleDomain=!1);let h=[];if(this.useDoubleDomain)i.forEach(A=>{h.push(iM(ZA(ZA({},t),{},{host:t.host.replace(u,A)}),r))});else{let A=ZA({},t);if(r&&u){let D=i.find(J=>J!==u);D&&(A.host=A.host.replace(u,D))}h.push(iM(A,r))}try{h.forEach(A=>{let D=new WebSocket(A);D.binaryType="arraybuffer",l.push(D),this.logger("ws is connecting:",D.url)})}catch(A){if(this.logger("ws create failed"),l.forEach(D=>D.close()),l.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,r,n);if(!r&&Number(t.port)!==443)return this.createWebSocket(t,!0,n);throw new at(ce.WS_ERR,"init websocket failed! Error: ".concat(A.toString()))}let m=Vg();this.store&&this.store.recordJoinChannelService({urls:l.map(A=>A.url),service:"gateway"},this.recordIndex),l.forEach(A=>{A.onopen=()=>{this.logger("onopen: ws ".concat(A.url," open cost ").concat(Date.now()-o,"ms")),this.websockets.forEach(D=>{D!==A&&(D.onopen=null,D.onclose=null,D.onmessage=null,D.close(),this.logger("close backup websocket: ".concat(D.url)))}),this.websockets.length=0,m.resolve(A)},A.onclose=D=>{this.logger("onclose: ws ".concat(A.url," closed cost ").concat(Date.now()-o,"ms state: ").concat(A.readyState));let J=l.every(V=>V.readyState===WebSocket.CLOSED||V.readyState===WebSocket.CLOSING);this.logger("".concat(r?"443":"47xx"," websocket closed, all failed: ").concat(J)),J&&(r||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(D.reason)),m.reject({code:D.code,reason:vR.A_ROUND_WS_FAILED})):!r&&J&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),R()),r?this.isTry443PortFailed=J:this.isNormalPortFailed=J},A.onmessage=D=>this.logger("".concat(A.url," onmessage: ").concat(D.data))}),this.websockets.push(...l);let _=()=>{this.websockets.forEach(A=>A.readyState!==WebSocket.OPEN&&A.close())},R=()=>{if(m.isResolved)return _();$r().os===Di.MAC_OS&&Yn()&&_(),this.createWebSocket(t,!0,!0).then(A=>{m.resolve(A)}).catch(A=>{this.isNormalPortFailed&&m.reject(A),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",m.isResolved),this.forceCloseTimeout=null,_()},this.forceCloseWSDuration)};return n||(()=>{if(r||this.useProxy)return this.logger("add 5s timeout at ".concat(r?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,_()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",m.isResolved),this.try443PortTimeout=null,R()},this.try443PortDuration)})(),m.promise}chooseBestWebsocket(t,r,n,i){return this.useDoubleDomain=!!r,typeof t=="string"&&(t=function(o){let l,u,h;return[,l,u,h]=o.match(oG)||[],l||([,u,h]=o.match(sG)||[]),u&&h||([,u,h]=o.match(cG)||[]),u&&h||([,u]=o.match(lG)||[]),u||L.warning("un-destructible url: ",o),{proxy:l,host:u,port:h||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,n&&this.useProxy&&(L.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(t,!!n,!1).finally(()=>this.clearTimeout())}}function aM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}class oM extends zn{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var r;Qt(r=["tryNext","recover"]).call(r,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Ur.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ur.CONNECTED):this._state==="closed"?this.emit(Ur.CLOSED):this._state==="failed"&&this.emit(Ur.FAILED))}resetReconnectCount(t){L.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,r){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2],i=arguments.length>3&&arguments[3]!==void 0&&arguments[3],o=arguments.length>4&&arguments[4]!==void 0&&arguments[4],l=arguments.length>5?arguments[5]:void 0;super(),ie(this,"connectionID",0),ie(this,"currentURLIndex",0),ie(this,"urls",[]),ie(this,"_reconnectMode","tryNext"),ie(this,"reconnectReason",void 0),ie(this,"_initMutex",void 0),ie(this,"name",void 0),ie(this,"_state","closed"),ie(this,"reconnectInterrupter",void 0),ie(this,"websocket",void 0),ie(this,"retryConfig",void 0),ie(this,"reconnectCount",0),ie(this,"forceCloseTimeout",5e3),ie(this,"onlineReconnectListener",void 0),ie(this,"useCompress",void 0),ie(this,"tryDoubleDomain",!1),ie(this,"use443PortOnly",!1),ie(this,"wsInflateLength",0),ie(this,"wsDeflateLength",0),ie(this,"closeEstablishingWs",()=>{}),ie(this,"store",void 0),ie(this,"joinGatewayRecordIndex",void 0),this.store=l,this.name=t,this.retryConfig=function(R){for(var A=1;A<arguments.length;A++){var D=arguments[A]!=null?arguments[A]:{};A%2?aM(Object(D),!0).forEach(function(J){ie(R,J,D[J])}):Object.getOwnPropertyDescriptors?Object.defineProperties(R,Object.getOwnPropertyDescriptors(D)):aM(Object(D)).forEach(function(J){Object.defineProperty(R,J,Object.getOwnPropertyDescriptor(D,J))})}return R}({},r),this.useCompress=n,this.tryDoubleDomain=i,this.use443PortOnly=o,this._initMutex=new da("websocket",l?l.clientId:void 0);let{timeout:u,timeoutFactor:h}=r,m=Math.max(300,Math.floor(3*u/5)),_=Math.max(1.2,Math.floor(8*h)/10);To.ONLINE&&(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_),pi.on(Jm.NETWORK_STATE_CHANGE,(R,A)=>{R!==A&&(this.resetReconnectCount("network state change: ".concat(A," -> ").concat(R)),R===To.ONLINE?(this.retryConfig.timeout=m,this.retryConfig.timeoutFactor=_):(this.retryConfig.timeout=u,this.retryConfig.timeoutFactor=h))})}getConnection(){return this.websocket||void 0}async init(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,n=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=r,this.urls=t,this.state="connecting";try{let i=Vg(),o=this.urls[this.currentURLIndex];Se("ENABLE_PREALLOC_PC")&&this.emit(rM.PRE_CONNECT_PC),this.createWebSocketConnection(o).then(i.resolve).catch(i.reject),this.once(Ur.CLOSED,()=>{i.reject(new Et(ce.WS_DISCONNECT))}),this.once(Ur.CONNECTED,i.resolve),await i.promise}catch{}finally{n()}}close(t,r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;let n=this.websocket;r?setTimeout(()=>n.close(),500):n.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,r){if(!this.websocket)return void L.warning("[".concat(this.name,"] can not reconnect, no websocket"));t!==void 0&&(this.reconnectMode=t),L.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(r)]},this.joinGatewayRecordIndex);let n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:r})}sendMessage(t){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Et(ce.WS_ABORT,"websocket is not ready");try{r||(t=JSON.stringify(t)),this.websocket.send(t)}catch(n){throw new Et(ce.WS_ERR,"send websocket message error"+n.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){let t=this.wsInflateLength,r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var r;let n=Vg();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;let i=_=>{var R;(R=this.store)===null||R===void 0||R.signalChannelOpen(),L.debug("[".concat(this.name,"] websocket opened:"),_),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},o=async _=>{var R;if(L.debug("[".concat(this.name,"] websocket close ").concat((R=this.websocket)===null||R===void 0?void 0:R.url,", code: ").concat(_.code,", reason: ").concat(_.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new Et(ce.WS_DISCONNECT,"websocket close: ".concat(_.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=_.reason,this.state="reconnecting");let A=Lo(this,Ur.WILL_RECONNECT,this.reconnectMode,_.reason)||this.reconnectMode,D=await this.reconnectWithAction(A);if(this.state==="closed")return void L.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!D)return n.reject(new Et(ce.WS_DISCONNECT,"websocket reconnect failed: ".concat(_.code))),this.close(!0);n.resolve()}},l=_=>{this.emit(Ur.ON_MESSAGE,_)},u=_=>{L.warn("[".concat(this.connectionID,"] ws open error ").concat(_))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Se("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=Se("GATEWAY_WSS_ADDRESS")),L.debug("[".concat(this.name,"] start connect, url:"),t);let h=(r=this.store)===null||r===void 0?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var m;let _=await this.chooseBestWebsocketConnection(t);this.websocket=_,i&&i(this.websocket.url),this.websocket.onclose=o,this.websocket.onmessage=l,this.websocket.onerror=u,(m=this.store)===null||m===void 0||m.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this.joinGatewayRecordIndex=h}catch(_){let R=this.state==="closed",A=_ instanceof Et,D=A&&_.code===ce.WS_ABORT,J=A&&_.code===ce.WS_ERR,V=A?_.message:_&&(_.reason||_.toString());L.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(V)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:D?"aborted":"error",errors:[_]},h),R||J?(n.reject(R?new Et(ce.WS_DISCONNECT,"websocket is closed: ".concat(V)):new Et(ce.WS_ERR,"init websocket failed: ".concat(V))),J&&L.error("[".concat(this.name,"] init websocket failed: ").concat(V))):o&&o(_)}return n.promise}async reconnectWithAction(t){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;L.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||pi.isOnline||!pi.onlineWaiter||(this.onlineReconnectListener=pi.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let n=!0;if(this.reconnectInterrupter=()=>n=!1,r){let l=lA(this.reconnectCount,this.retryConfig);L.debug("[".concat(this.name,"] wait ").concat(l,"ms to reconnect websocket, mode: ").concat(t)),await tr.race([Yi(l),this.onlineReconnectListener||new tr(()=>{})])}if(this._state==="closed"||!n)return!1;this.reconnectCount+=1;let i=async(l,u)=>{this.emit(Ur.RECONNECT_CREATE_CONNECTION,u),await this.createWebSocketConnection(l)};try{if(t==="retry")await i(this.urls[this.currentURLIndex],t);else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);L.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await i(this.urls[this.currentURLIndex],t)}else t==="recover"&&(L.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await ia(this,Ur.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(l){var o;L.error("[".concat(this.name,"] reconnect failed ").concat(l&&l.toString()));let u=l==null||(o=l.data)===null||o===void 0?void 0:o.desc;return Array.isArray(u)&&Qt(u).call(u,"dynamic key expired")?(this.emit(Ur.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,r)}return!0}}class QA extends oM{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){let n=Vg(),i=function(l,u){return new dG(l,u)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{L.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),n.reject(new Et(ce.WS_ABORT,"choose best websocket aborted"))};let o=Se("GATEWAY_DOMAINS");return L.debug("[choose-best-ws] currentDomain: ",t,", domains: ",o,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,r).then(n.resolve).catch(n.reject),n.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class rv extends oM{constructor(t,r){super(t,r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,r){return new tr((n,i)=>{let o=!1,l=[];this.closeEstablishingWs=()=>{L.debug("[choose-best-ws] close establishing websockets"),l.forEach(J=>{J.onclose=null,J.onopen=null,J.onmessage=null,J.close()}),i(new Et(ce.WS_ABORT,"choose best websocket aborted"))};let u=Se("GATEWAY_DOMAINS"),h,m=t.indexOf("?h="),_=u.find(J=>m!==-1?Qt(t).call(t,J,m):Qt(t).call(t,J));L.debug("[choose-best-ws] currentDomain: ",_,", domains: ",u);let R=!this.tryDoubleDomain||!_;if(!R&&_){var A;let J=Date.now();try{u.forEach(V=>{let K=m===-1?t.replace(_,V):t.substr(0,m)+t.substr(m).replace(_,V),se=new WebSocket(K);se.binaryType="arraybuffer",l.push(se),L.debug("[choose-best-ws] ws is connecting:",se.url)})}catch{for(L.debug("[choose-best-ws] ws create failed, fallback to single url"),l.forEach(V=>V.close());l.length;)l.pop();R=!0}(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:l.map(V=>V.url),service:"gateway"},r),l.forEach(V=>{V.onopen=()=>{if(o)return;let K=Date.now()-J;L.debug("[choose-best-ws] ws open cost ".concat(K,"ms")),l.filter(se=>se!==V).forEach(se=>{L.debug("[choose-best-ws]close backup websocket: ".concat(se.url)),se.close()}),o=!0,n(V)},V.onclose=K=>{h=K,!o&&(l.find(se=>!(se.readyState===WebSocket.CLOSED||se.readyState===WebSocket.CLOSING))||(L.debug("[choose-best-ws] all websocket is closed"),o=!0,i(h)))},V.onmessage=K=>{L.debug("[choose-best-ws]".concat(V.url," onmessage: ").concat(K.data))}}),Yi(this.forceCloseTimeout).then(()=>{l.forEach(V=>{V.readyState!==WebSocket.OPEN&&V.close()})})}if(R){var D;let J;L.debug("[choose-best-ws] use single url: ",t),(D=this.store)===null||D===void 0||D.recordJoinChannelService({urls:[t],service:"gateway"},r);try{J=new WebSocket(t),l.push(J),J.binaryType="arraybuffer"}catch(V){let K=new Et(ce.WS_ERR,"init websocket failed! Error: ".concat(V.toString()));return L.error("[".concat(this.name,"]").concat(K)),void i(K)}J.onopen=()=>{n(J)},J.onclose=V=>{i(V)},J.onmessage=V=>{L.debug("[choose-best-ws]".concat(J.url," onmessage: ").concat(V.data))},Yi(this.forceCloseTimeout).then(()=>{J&&J.readyState!==WebSocket.OPEN&&J.close()})}}).then(n=>(this.closeEstablishingWs=void 0,n)).catch(n=>{throw this.closeEstablishingWs=void 0,n})}}class hG extends zn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Pn.CONNECTED?this.emit(Lr.WS_CONNECTED):t===Pn.RECONNECTING?this.emit(Lr.WS_RECONNECTING,this._websocketReconnectReason):t===Pn.CLOSED&&this.emit(Lr.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),ie(this,"_disconnectedReason",void 0),ie(this,"_websocketReconnectReason",void 0),ie(this,"_connectionState",Pn.CLOSED),ie(this,"reconnectToken",void 0),ie(this,"websocket",void 0),ie(this,"openConnectionTime",void 0),ie(this,"clientId",void 0),ie(this,"lastMsgTime",Date.now()),ie(this,"uploadCache",[]),ie(this,"uploadCacheInterval",void 0),ie(this,"rttRolling",new gP(5)),ie(this,"pingpongTimer",void 0),ie(this,"wsInflateDataTimer",void 0),ie(this,"pingpongTimeoutCount",0),ie(this,"joinResponse",void 0),ie(this,"multiIpOption",void 0),ie(this,"initError",void 0),ie(this,"spec",void 0),ie(this,"store",void 0),ie(this,"onWebsocketMessage",n=>{if(n.data instanceof ArrayBuffer)return void this.emit(Lr.ON_BINARY_DATA,n.data);let i=JSON.parse(n.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){let o="res-@".concat(i._id);this.emit(o,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){if(this.emit(i._type,i._message),i._type===Wr.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Wr.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(cn.UID_BANNED);break;case 15:this.close(cn.IP_BANNED);break;case 16:this.close(cn.CHANNEL_BANNED)}if(i._type===Wr.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case br.ERR_LICENSE_MISSING:this.close(cn.LICENSE_MISSING);break;case br.ERR_LICENSE_EXPIRED:this.close(cn.LICENSE_EXPIRED);break;case br.ERR_LICENSE_MINUTES_EXCEEDED:this.close(cn.LICENSE_MINUTES_EXCEEDED);break;case br.ERR_LICENSE_PERIOD_INVALID:this.close(cn.LICENSE_PERIOD_INVALID);break;case br.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(cn.LICENSE_MULTIPLE_SDK_SERVICE);break;case br.ERR_LICENSE_ILLEGAL:this.close(cn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new QA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Se("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Se("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Pn.CONNECTED&&this.reconnect("retry",na.OFFLINE)})}async request(t,r,n,i){let o=On(6,""),l={_id:o,_type:t,_message:r},u=this.websocket.connectionID,h=()=>new tr((J,V)=>{if(this.connectionState===Pn.CONNECTED)return J();let K=()=>{this.off(Lr.WS_CLOSED,se),J()},se=()=>{this.off(Lr.WS_CONNECTED,K),V(new at(ce.WS_ABORT))};this.once(Lr.WS_CONNECTED,K),this.once(Lr.WS_CLOSED,se),t!==Dr.PUBLISH&&t!==Dr.PUBLISH_DATASTREAM&&t!==Dr.SUBSCRIBE&&t!==Dr.SUBSCRIBE_DATASTREAM&&t!==Dr.UNSUBSCRIBE&&t!==Dr.UNSUBSCRIBE_DATASTREAM&&t!==Dr.UNPUBLISH&&t!==Dr.UNPUBLISH_DATASTREAM&&t!==Dr.CONTROL&&t!==Dr.RESTART_ICE||this.once(Lr.DISCONNECT_P2P,()=>{V(new at(ce.DISCONNECT_P2P))}),t!==Dr.PUBLISH&&t!==Dr.RESTART_ICE||this.once(Lr.ABORT_P2P_EXECUTION,()=>{V(new at(ce.DISCONNECT_P2P))})});if(this.connectionState!==Pn.CONNECTING&&this.connectionState!==Pn.RECONNECTING||t===Dr.JOIN||t===Dr.REJOIN||await h(),this.websocket.sendMessage(l,!0),i)return;let m=new tr((J,V)=>{let K=!1,se=(De,ze)=>{K=!0,J({isSuccess:De==="success",message:ze||{}}),this.off(Lr.WS_CLOSED,ue),this.off(Lr.WS_RECONNECTING,ue),this.emit(Lr.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(o),se);let ue=()=>{V(new at(ce.WS_ABORT,"type: ".concat(t))),this.off(Lr.WS_CLOSED,ue),this.off(Lr.WS_RECONNECTING,ue),this.off("res-@".concat(o),se)};this.once(Lr.WS_CLOSED,ue),this.once(Lr.WS_RECONNECTING,ue),Yi(Se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||K||(L.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Lr.REQUEST_TIMEOUT,t,r))})}),_=null;try{_=await m}catch(J){if(this.connectionState===Pn.CLOSED||t===Dr.LEAVE)throw new at(ce.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?J.throw():t===Dr.JOIN||t===Dr.REJOIN?null:(await h(),await this.request(t,r))}if(_.isSuccess)return _.message;let R=Number(_.message.error_code||_.message.code),A=tv(R),D=new at(ce.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(_.message.error_str),{code:R,data:_.message,desc:A.desc});return A.action==="success"?_.message:(L.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(A.desc,", action: ").concat(A.action)),R===br.ERR_TOO_MANY_BROADCASTERS?((t===Dr.JOIN||t===Dr.REJOIN)&&(this.initError=D,this.close()),D.throw()):A.action==="failed"?D.throw():A.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===br.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,L.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",na.MULTI_IP)):this.reconnect(A.action,na.SERVER_ERROR),t===Dr.JOIN||t===Dr.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new tr(n=>{let i=o=>{(!r||r(o))&&(this.off(t,i),n(o))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void L.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload($g.WRTC_STATS,r)}upload(t,r){let n={_type:t,_message:r};try{this.websocket.sendMessage(n)}catch{let i=Se("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Pn.CONNECTED)return;let o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},Se("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){let n={_type:t,_message:r};this.websocket.sendMessage(n)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tr((r,n)=>{this.once(Lr.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Lr.WS_CLOSED,i=>n(this.initError||new at(ce.WS_ABORT,i))),this.connectionState=Pn.CONNECTING,this.websocket.init(t).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||cn.LEAVE,this.connectionState=Pn.CLOSED,L.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(Lr.ABORT_P2P_EXECUTION);let t=await ia(this,Lr.REQUEST_JOIN_INFO),r=await this.request(Dr.JOIN,t);if(!r)return this.emit(Lr.REPORT_JOIN_GATEWAY,vR.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(Lr.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Pn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new at(ce.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");let t=zg(this,Lr.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;let r=await this.request(Dr.REJOIN,t);return!!r&&(this.connectionState=Pn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),r.peers&&r.peers.forEach(n=>{this.emit(Wr.ON_USER_ONLINE,{uid:n.uid}),n.audio&&this.emit(Wr.ON_ADD_AUDIO_STREAM,{uid:n.uid,uint_id:n.uint_id,audio:!0,ssrcId:n.audio_ssrc}),n.video&&this.emit(Wr.ON_ADD_VIDEO_STREAM,{uid:n.uid,uint_id:n.uint_id,video:!0,ssrcId:n.video_ssrc}),n.audio_mute?this.emit(Wr.MUTE_AUDIO,{uid:n.uid}):this.emit(Wr.UNMUTE_AUDIO,{uid:n.uid}),n.video_mute?this.emit(Wr.MUTE_VIDEO,{uid:n.uid}):this.emit(Wr.UNMUTE_VIDEO,{uid:n.uid}),n.audio_enable_local?this.emit(Wr.ENABLE_LOCAL_AUDIO,{uid:n.uid}):this.emit(Wr.DISABLE_LOCAL_AUDIO,{uid:n.uid}),n.video_enable_local?this.emit(Wr.ENABLE_LOCAL_VIDEO,{uid:n.uid}):this.emit(Wr.DISABLE_LOCAL_VIDEO,{uid:n.uid}),n.audio||n.video||this.emit(Wr.ON_REMOVE_STREAM,{uid:n.uid,uint_id:n.uint_id})}),!0)}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleNotification(t){L.debug("[".concat(this.clientId,"] receive notification: "),t);let r=tv(t.code);if(t.code===28&&"detail"in t&&(L.info("[".concat(this.clientId,"] receive recover notification: "),t.detail),this.emit(Lr.RECOVER_NOTIFICATION,t.detail)),r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(cn.UID_BANNED),void this.close()):void this.reconnect(r.action,na.SERVER_ERROR);L.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=Se("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(L.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>Se("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",na.TIMEOUT):this.request(Dr.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let n=Date.now()-r;this.rttRolling.add(n),Se("REPORT_STATS")&&this.send(Dr.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWsInflateData(){let{wsInflateLength:t,wsDeflateLength:r}=this.websocket.getWsInflateData();t!==0&&r!==0&&this.upload($g.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:r,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ur.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Lr.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ur.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ur.CLOSED,()=>{this.connectionState=Pn.CLOSED}),this.websocket.on(Ur.FAILED,()=>{this._disconnectedReason=cn.NETWORK_ERROR,this.connectionState=Pn.CLOSED}),this.websocket.on(Ur.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Pn.CONNECTED?this.connectionState=Pn.RECONNECTING:this.connectionState=Pn.CONNECTING}),this.websocket.on(Ur.WILL_RECONNECT,(t,r,n)=>{let i=zg(this,Lr.IS_P2P_DISCONNECTED),o=i||t!=="retry";i&&t==="retry"&&(L.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",r=vR.P2P_DISCONNECTED),o&&(L.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(Lr.REPORT_JOIN_GATEWAY,r||vR.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(Lr.DISCONNECT_P2P)),n(t)}),this.websocket.on(Ur.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{L.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",na.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Lr.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof at){if(t.code===ce.UNEXPECTED_RESPONSE&&t.data.code===br.ERR_NO_AUTHORIZED)return this.initError=new at(ce.TOKEN_EXPIRE,"dynamic key expired"),void this.close(cn.TOKEN_EXPIRE);L.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",na.SERVER_ERROR):(this.initError=t,this.close())}})}),this.websocket.on(Ur.REQUEST_NEW_URLS,(t,r)=>{ia(this,Lr.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Ur.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Wr.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(rM.PRE_CONNECT_PC,()=>{this.emit(Lr.PRE_CONNECT_PC)})}}let pG=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),fi=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function sM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function yR(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?sM(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xd(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(Se("TURN_DOMAIN")):(L.debug("Cannot recognized as ip address: ".concat(e,", use as host")),e)}function $A(e,t){e.addresses||(e.addresses=[]);let r=function(u,h){if(Se("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return u.map(R=>{let{ip:A,port:D}=R;return{address:"".concat(A,":").concat(D)}});let m=Se("GATEWAY_DOMAINS"),_=m[1]&&Qt(h).call(h,m[1])?1:0;return u.map(R=>{let{domain_prefix:A,port:D,ip:J}=R;if(A)return{address:"".concat(A,".").concat(m[_++%m.length],":").concat(D)};let V=/^[\.\:\d]+$/.test(J),K=V?"".concat(J.replace(/[^\d]/g,"-"),".").concat(m[_++%m.length],":").concat(D):"".concat(J,":").concat(D);return V||L.debug("Cannot recognized as ip address: ".concat(J,", use as host")),{ip:J,port:D,address:K}})}(e.addresses,t),n=Array.isArray(e.detail)&&e.detail[18];if(n&&typeof n=="string"){let u=n.split(";");for(let h=0;h<u.length;h++){var i;let m=Ia(i=u[h]).call(i);r[h]&&m&&(r[h].ip6=m)}}let o=e.detail&&e.detail.candidate,l;if(o){let[u,h]=o.split(":");u&&h&&(l={port:Number(h),ip:u,address:"".concat(u,":").concat(h)})}return{gatewayAddrs:r,apGatewayAddress:l,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function yo(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function cM(e){let t=e._encoderConfig;if(!t)return{};let r={resolution:t.width&&t.height?"".concat(yo(t.width),"x").concat(yo(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(r.maxFrameRate=t.frameRate,r.minFrameRate=t.frameRate):t.frameRate&&(r.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,r.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),r}function lM(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function nv(e,t){let r,n,i;switch(t){case fi.CHOOSE_SERVER:n=4096,i="choose server";break;case fi.CLOUD_PROXY:n=1048576,i="proxy";break;case fi.CLOUD_PROXY_5:n=4194304,i="proxy5";break;case fi.CLOUD_PROXY_FALLBACK:n=4194310,i="proxy fallback";break;default:throw new at(ce.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(o=>{o.buffer&&o.buffer.flag===n&&(r={code:o.buffer.code,addresses:(o.buffer.edges_services||[]).map(l=>yR(yR({},l),{},{ticket:o.buffer.cert})),server_ts:e.enter_ts,uid:o.buffer.uid,cid:o.buffer.cid,cname:o.buffer.cname,detail:yR(yR({},o.buffer.detail),e.detail),flag:o.buffer.flag,opid:e.opid,cert:o.buffer.cert})}),!r)throw new at(ce.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(i," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return r}async function uM(e,t){return await tr.all(e.addresses.map(async r=>({address:Se("USE_TURN_IP")?r.ip:Xd(r.ip),tcpport:r.port,udpport:r.port,username:t&&Se("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():aa.username,password:t&&Se("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await aA(t.toString()):aa.password})))}function eb(e,t){let r=t.getMediaStreamTrack(!0).getSettings(),n=t.videoHeight||r.height,i=t.videoWidth||r.width;return n&&i?Math.max(Math.min(n,i)/Math.min(yo(e.height),yo(e.width)),1):(L.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function Jd(e){let{candidateType:t,relayProtocol:r,type:n,address:i,port:o,protocol:l}=e,u={candidateType:t,relayProtocol:r,protocol:l};if(n!=="local-candidate"){let h=i.split(".");h.length>=4&&(h[1]="*",h[2]="*"),u.address=h.join("."),u.port=o}return u}function SR(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Se("SVC_MODE");if(Se("ENABLE_SVC"))return function(t){return t in ZS}(e)?e:ZS.L1T3}let dM={[lr.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[lr.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function RR(e,t,r){t.forEach(n=>{var i;let o=dM[e].find(u=>{var h;let{key:m}=u;return Qt(h=n.extensionName).call(h,m)});if(!o)return;let l=r.find(u=>{let{extensionName:h}=u;return Qt(h).call(h,o.key)});l&&Qt(i=l.extensionName).call(i,"gdpr_forbidden")&&(n.extensionName=l.extensionName)})}function gE(e,t){t.forEach(r=>{var n;let i=dM[e].find(o=>{var l;let{key:u}=o;return Qt(l=r.extensionName).call(l,u)});Qt(n=r.extensionName).call(n,"gdpr_forbidden")&&i&&(r.extensionName=i.extensionName)})}function hM(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||Qt(e).call(e,"abs-send-time")}function CR(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||Qt(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function pM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function fM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?pM(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iv(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,{filterRTX:i,filterVideoFec:o,filterAudioFec:l,filterAudioCodec:u,filterVideoCodec:h}=t,{useXR:m}=r,_=[],R=[],A=[],D=[],J=!1,V=!1;if(ao(e).mediaDescriptions.forEach(se=>{n&&n!==se.attributes.direction||(se.media.mediaType!=="video"||J||(R=se.attributes.payloads,D=se.attributes.extmaps,J=!0),se.media.mediaType!=="audio"||V||(_=se.attributes.payloads,A=se.attributes.extmaps,V=!0))}),!D||R.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!A||_.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(R.forEach(se=>{var ue;(ue=se.rtpMap)!==null&&ue!==void 0&&ue.clockRate&&(se.rtpMap.clockRate=parseInt(se.rtpMap.clockRate)),m&&se.rtcpFeedbacks.push({type:"rrtr"})}),_.forEach(se=>{var ue;(ue=se.rtpMap)!==null&&ue!==void 0&&ue.clockRate&&(se.rtpMap.clockRate=parseInt(se.rtpMap.clockRate)),m&&se.rtcpFeedbacks.push({type:"rrtr"})}),i&&(_=_.filter(se=>{var ue;return((ue=se.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLowerCase())!=="rtx"}),R=R.filter(se=>{var ue;return((ue=se.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLowerCase())!=="rtx"})),o&&(R=R.filter(se=>{var ue;return!/(red)|(ulpfec)|(flexfec)/i.test(((ue=se.rtpMap)===null||ue===void 0?void 0:ue.encodingName)||"")})),l&&(_=_.filter(se=>{var ue;return!/(red)|(ulpfec)|(flexfec)/i.test(((ue=se.rtpMap)===null||ue===void 0?void 0:ue.encodingName)||"")})),u&&u?.length>0&&(_=_.filter(se=>{var ue;return Qt(u).call(u,((ue=se.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLowerCase())||"")})),h&&h?.length>0){let se=R.filter(ue=>{var De;return Qt(h).call(h,((De=ue.rtpMap)===null||De===void 0?void 0:De.encodingName.toLowerCase())||"")});R=se.concat(i?[]:nb(se,R))}let K=Se("UNSUPPORTED_VIDEO_CODEC");return K&&K.length>0&&(R=R.filter(se=>!(se.rtpMap&&Qt(K).call(K,se.rtpMap.encodingName.toLowerCase())))),{audioCodecs:_,videoCodecs:R,audioExtensions:A,videoExtensions:D}}function Zd(e){let t=ao(e),r,n;for(let i of t.mediaDescriptions){if(!r){let o=i.attributes.iceUfrag,l=i.attributes.icePwd;if(!o||!l)throw new Error("Cannot get iceUfrag or icePwd from SDP.");r={iceUfrag:o,icePwd:l}}if(!n){let o=i.attributes.fingerprints;o.length>0&&(n={fingerprints:o})}}if(!n&&t.attributes.fingerprints.length>0&&(n={fingerprints:t.attributes.fingerprints}),!n||!r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:r,dtlsParameters:n}}function mM(e,t){let r=[],n=e.attributes.ssrcGroups.filter(l=>l.semantic==="FID"),i=e.attributes.ssrcGroups.find(l=>l.semantic==="SIM"),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach(l=>{var u;let h=(u=n.find(m=>m.ssrcIds[0]===l))===null||u===void 0?void 0:u.ssrcIds[1];r.push({ssrcId:l,rtx:t?h:void 0})});else if(n.length>0){let l=n[0].ssrcIds[0],u=n[0].ssrcIds[1];r.push({ssrcId:l,rtx:t?u:void 0})}else{if(o.length===0)throw new Error("No ssrcs found on local media description.");r.push({ssrcId:o[0].ssrcId})}return r}function EM(e,t,r){let{cname:n}=e,i=[];t&&(i=_M(t)),i.length===0&&(i=e.iceParameters.candidates.map(_=>({foundation:_.foundation,componentId:"1",transport:_.protocol,priority:_.priority.toString(),connectionAddress:_.ip,port:_.port.toString(),type:_.type,extension:{}})),L.debug("Using candidates from gateway."));let o={fingerprints:e.dtlsParameters.fingerprints.map(_=>({hashFunction:_.algorithm,fingerprint:_.fingerprint}))},l={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd},u;switch(e.dtlsParameters.role){case"server":u="passive";break;case"client":u="active";break;case"auto":u="actpass"}let h=AR(e.rtpCapabilities),m=[];return Array.isArray(r)&&r.length>0&&r.forEach(_=>{m.push({kind:lr.VIDEO,ssrcId:_.v,rtx:_.v_rtx,mslabel:"".concat(_.v,"_").concat(_.a)},{kind:lr.AUDIO,ssrcId:_.a,mslabel:"".concat(_.v,"_").concat(_.a)})}),{dtlsParameters:o,iceParameters:l,candidates:i,rtpCapabilities:h,setup:u,cname:n,preSSRCs:m}}function _M(e){let t=[];return e.ip&&typeof e.port=="number"&&(t=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],L.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(t.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),L.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))),t}function Mp(e,t,r){let n=[],i=[];return e.forEach(o=>{let{ssrcId:l,rtx:u}=o,h=On(8,"track-"),m={ssrcId:l,attributes:fM({label:h,mslabel:r=r||On(10,""),msid:"".concat(r," ").concat(h)},t&&{cname:t})};if(n.push(m),u!==void 0){let _={ssrcId:u,attributes:fM({label:h,mslabel:r,msid:"".concat(r," ").concat(h)},t&&{cname:t})};n.push(_),i.push({semantic:"FID",ssrcIds:[l,u]})}}),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map(o=>{let{ssrcId:l}=o;return l})}),{ssrcs:n,ssrcGroups:i}}function vE(e,t){t instanceof ei&&e.attributes.payloads.forEach(r=>{var n;let i=(n=r.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase();if(!i||["opus","pcmu","pcma","g722"].indexOf(i)===-1)return;r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.minptime="10",r.fmtp.parameters.useinbandfec="1";let o=t._encoderConfig;o&&i!=="pcmu"&&i!=="pcma"&&i!=="g722"&&(o.bitrate&&!Yn()&&(r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*o.bitrate))),o.sampleRate&&(r.fmtp.parameters.maxplaybackrate="".concat(o.sampleRate),r.fmtp.parameters["sprop-maxcapturerate"]="".concat(o.sampleRate)),o.stereo&&(r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"))})}function tb(e){let t=e.attributes.unrecognized.findIndex(r=>r.attField==="x-google-flag"&&r.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function rb(e,t){var r;if(!(t instanceof xn&&t._encoderConfig&&t._hints.indexOf(Nn.SCREEN_TRACK)===-1))return;let n=t._encoderConfig;rn().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach(i=>{var o,l;Qt(o=["h264","h265","vp8","vp9","av1"]).call(o,((l=i.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),rn().supportMinBitrate&&!Qt(r=t._hints).call(r,Nn.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach(i=>{var o,l;Qt(o=["h264","h265","vp8","vp9","av1"]).call(o,((l=i.rtpMap)===null||l===void 0?void 0:l.encodingName.toLowerCase())||"")&&(i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters["x-google-start-bitrate"]="".concat(Se("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function gM(e){if(e.media.mediaType!=="video")return;let t=$r();if(t.name!==an.SAFARI&&t.os!==Di.IOS)return;let r=e.attributes.extmaps.findIndex(n=>/video-orientation/g.test(n.extensionName));r!==-1&&e.attributes.extmaps.splice(r,1)}function IR(e,t,r){if(!t)return;let n,i;if(e.media.mediaType==="video"?(n=r.videoExtensions,i=r.videoCodecs):(n=r.audioExtensions,i=r.audioCodecs),t.twcc===!0){let o=n.find(l=>CR(l.extensionName));if(o){let l=o.extensionName;e.attributes.extmaps.find(u=>CR(u.extensionName))||e.attributes.extmaps.push({entry:o.entry,extensionName:l}),function(u,h){return h.filter(m=>!!u.find(_=>_.payloadType===m.payloadType&&!!_.rtcpFeedbacks.find(R=>R.type==="transport-cc")))}(i,e.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(h=>h.type==="transport-cc")||u.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(t.twcc===!1){let o=e.attributes.extmaps.findIndex(l=>CR(l.extensionName));o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(l=>{let u=l.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}if(t.remb===!0){let o=n.find(l=>hM(l.extensionName));if(o){let l=o.extensionName;e.attributes.extmaps.find(u=>u.extensionName===l)||e.attributes.extmaps.push({entry:o.entry,extensionName:l}),function(u,h){return h.filter(m=>!!u.find(_=>_.payloadType===m.payloadType&&!!_.rtcpFeedbacks.find(R=>R.type==="goog-remb")))}(i,e.attributes.payloads).forEach(u=>{u.rtcpFeedbacks.find(h=>h.type==="goog-remb")||u.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(t.remb===!1){let o=e.attributes.extmaps.findIndex(l=>hM(l.extensionName));o!==-1&&e.attributes.extmaps.splice(o,1),e.attributes.payloads.forEach(l=>{let u=l.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");u!==-1&&l.rtcpFeedbacks.splice(u,1)})}}function vM(e,t,r){if(Yn()||e.media.mediaType!=="video"||!(t instanceof xn)||r!=="vp9"&&r!=="vp8"||r==="vp8"&&!Se("SIMULCAST")||r==="vp9"&&Se("ENABLE_SVC")||t._scalabilityMode===void 0||t._scalabilityMode.numSpatialLayers<=1)return;let n=r==="vp8"?2:t._scalabilityMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===i.ssrcId),l={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let u=1;u<n;u++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+u,attributes:Zn(i.attributes)}),l.ssrcIds.push(i.ssrcId+u),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+u,attributes:Zn(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+u,o.ssrcIds[1]+u]}));e.attributes.ssrcGroups.unshift(l)}async function TM(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=new RTCPeerConnection;r.addTransceiver("video",{direction:"sendonly"}),r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});let n=(await r.createOffer()).sdp,{send:i,recv:o,sendrecv:l}=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},m=arguments.length>2?arguments[2]:void 0,_=iv(m,u,h,"sendonly"),R=iv(m,u,h,"recvonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},J={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Qs(_,R,"videoExtensions",A,D,J),Qs(_,R,"videoCodecs",A,D,J),Qs(_,R,"audioExtensions",A,D,J),Qs(_,R,"audioCodecs",A,D,J),Se("RAISE_H264_BASELINE_PRIORITY")){let V=[],K=[];J.videoCodecs.forEach((se,ue)=>{var De;if(((De=se.rtpMap)===null||De===void 0?void 0:De.encodingName.toLocaleLowerCase())==="h264"){var ze,Ke;let Ve=J.videoCodecs[ue+1],_t=Ve&&IM(se,Ve),Vt=(ze=se.fmtp)===null||ze===void 0?void 0:ze.parameters["profile-level-id"],ar=(Ke=se.fmtp)===null||Ke===void 0?void 0:Ke.parameters["packetization-mode"];!Vt||Vt!==Se("FIRST_H264_PROFILE_LEVEL_ID")||Se("FIRST_PACKETIZATION_MODE")&&ar!==Se("FIRST_PACKETIZATION_MODE")?_t?K.push([se,Ve]):K.push([se]):_t?V.push([se,Ve]):V.push([se])}}),V.length>0&&K.length>0&&(L.debug("raising H264 baseline profile priority"),J.videoCodecs.forEach((se,ue)=>{var De;if(((De=se.rtpMap)===null||De===void 0?void 0:De.encodingName.toLocaleLowerCase())==="h264"){let ze=IM(se,J.videoCodecs[ue+1]),Ke=V.shift()||K.shift()||[];Ke.length>0&&(ze?J.videoCodecs.splice(ue,2,...Ke):J.videoCodecs.splice(ue,1,...Ke))}}),D.videoCodecs=D.videoCodecs.filter(se=>{var ue,De;return!(((ue=se.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLocaleLowerCase())==="h264"&&((De=se.fmtp)===null||De===void 0?void 0:De.parameters["profile-level-id"])!==Se("FIRST_H264_PROFILE_LEVEL_ID"))}),Se("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(se=>{var ue,De;return!(((ue=se.rtpMap)===null||ue===void 0?void 0:ue.encodingName.toLocaleLowerCase())==="h264"&&((De=se.fmtp)===null||De===void 0?void 0:De.parameters["profile-level-id"])!==Se("FIRST_H264_PROFILE_LEVEL_ID"))})))}return{send:A,recv:D,sendrecv:J}}(e,t,n);try{r.close()}catch{}return{send:i,recv:o,sendrecv:l}}function yM(){let e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},t=iv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},n={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Qs(e,t,"videoExtensions",r,n,i),Qs(e,t,"videoCodecs",r,n,i),Qs(e,t,"audioExtensions",r,n,i),Qs(e,t,"audioCodecs",r,n,i),Se("RAISE_H264_BASELINE_PRIORITY")){let o=i.videoCodecs.findIndex(l=>l.rtpMap&&l.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&l.fmtp&&l.fmtp.parameters["profile-level-id"]==="42001f");if(o!==-1){let l=i.videoCodecs.findIndex(u=>u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(l<o){L.debug("raising H264 baseline profile priority");let u=i.videoCodecs[o];i.videoCodecs.splice(o,1),i.videoCodecs.splice(l,0,u)}l!==-1&&(n.videoCodecs=n.videoCodecs.filter(u=>!(u.rtpMap&&u.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&u.fmtp&&u.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:r,recv:n,sendrecv:i}}function Qs(e,t,r,n,i,o){if(r==="videoExtensions"||r==="audioExtensions"){let l=[];return e[r].forEach(u=>{t[r].some((h,m)=>{if(u.entry===h.entry&&u.extensionName===h.extensionName)return l.push(m),!0})?o[r].push(u):n[r].push(u)}),void t[r].forEach((u,h)=>{l.indexOf(h)===-1&&i[r].push(u)})}if(r==="videoCodecs"||r==="audioCodecs"){let l=[];return e[r].forEach(u=>{t[r].some((h,m)=>{if(u.payloadType===h.payloadType&&JSON.stringify(u)===JSON.stringify(h))return l.push(m),!0})?o[r].push(u):n[r].push(u)}),void t[r].forEach((u,h)=>{l.indexOf(h)===-1&&i[r].push(u)})}}function AR(e){let{send:t,recv:r,sendrecv:n}=e;if(!n){if(!t||!r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:r}}let i,o;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...n.audioCodecs],i.videoCodecs=[...t.videoCodecs,...n.videoCodecs],i.audioExtensions=[...t.audioExtensions,...n.audioExtensions],i.videoExtensions=[...t.videoExtensions,...n.videoExtensions]):i=n,r?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...r.audioCodecs,...n.audioCodecs],o.videoCodecs=[...r.videoCodecs,...n.videoCodecs],o.audioExtensions=[...r.audioExtensions,...n.audioExtensions],o.videoExtensions=[...r.videoExtensions,...n.videoExtensions]):o=n,{send:i,recv:o}}function TE(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var r;return((r=t.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function av(e,t,r,n){let i=[];if(e===lr.VIDEO){if(Se("H264_PROFILE_LEVEL_ID")&&n==="h264"&&(i=t.videoCodecs.filter(o=>{var l;return Qt(l=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(l,n)&&o&&o.fmtp&&o.fmtp.parameters["profile-level-id"]===Se("H264_PROFILE_LEVEL_ID")})),!Array.isArray(i)||i.length===0){let o=[],l=[],u=[],h=[];if(r.videoCodecs.forEach(m=>{let _=m.rtpMap&&m.rtpMap.encodingName.toLowerCase()||"";Qt(_).call(_,n)?o.push(m):Qt(_).call(_,"vp9")?l.push(m):Qt(_).call(_,"vp8")?u.push(m):Qt(_).call(_,"h264")&&h.push(m)}),o.length===0){let m="";l.length!==0?(o=l,m="vp9"):u.length!==0?(o=u,m="vp8"):h.length!==0&&(o=h,m="h264"),L.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(m))}o.length!==0&&(i=t.videoCodecs.filter(m=>o.some(_=>_.payloadType===m.payloadType)))}if(i.length===0&&(L.warning("codec ".concat(n," not included in rtpCapabilities, fallback to default payloads: ").concat(t.videoCodecs[0].rtpMap&&t.videoCodecs[0].rtpMap.encodingName)),i=t.videoCodecs),Se("USE_PUB_RTX")||Se("USE_SUB_RTX")){let o=nb(i,t.videoCodecs);i=[...i,...o]}}else i=t.audioCodecs.filter(o=>{var l;return Qt(l=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(l,n)}),i.length===0&&(L.warning("codec ".concat(n," not included in rtpCapabilities, fallback to opus")),i=t.audioCodecs.filter(o=>{var l;return Qt(l=o.rtpMap&&o.rtpMap.encodingName.toLowerCase()||"").call(l,"opus")}));return i}function nb(e,t){let r=e.map(n=>n.payloadType.toString());return t.filter(n=>n.rtpMap&&n.rtpMap.encodingName==="rtx"&&n.fmtp&&n.fmtp.parameters.apt&&Qt(r).call(r,n.fmtp&&n.fmtp.parameters.apt))}async function ov(e,t,r){let n=t.toString(),i=RM(n,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:n});let o=await e.createAnswer();if(!o.sdp)throw new Error("cannot get answer sdp");let l=o.sdp;l=SM(l,r||{}),i?.(l||""),await e.setLocalDescription({type:"answer",sdp:l})}function SM(e,t,r){let n=ao(e),{useXR:i}=t;return n.mediaDescriptions.forEach(o=>{var l;o.attributes.mid&&(Array.isArray(r)&&!Qt(r).call(r,o.attributes.mid)||(o.media.mediaType==="audio"&&TE(o),i&&Qt(l=["audio","video"]).call(l,o.media.mediaType)&&o.attributes.payloads.forEach(u=>{u.rtcpFeedbacks.findIndex(h=>h.type==="rrtr")===-1&&u.rtcpFeedbacks.push({type:"rrtr"})})))}),zd(n)}function RM(e,t,r,n){if(Se("SDP_LOGGING"))return L.upload("exchanging ".concat(r," ").concat(t," SDP during P2PConnection.").concat(n,`
`),e),t==="offer"?i=>{RM(i,"answer",r==="local"?"remote":"local",n)}:void 0}function CM(e){let t=Se("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(t)&&t.length>0)&&t.some(r=>Qt(e).call(e,r))}function IM(e,t){try{var r;return((r=e.fmtp)===null||r===void 0?void 0:r.parameters.apt)===t.payloadType.toString()}catch{return!1}}function AM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Es(e,t){return typeof Se(e)===t?Se(e):void 0}function fG(){try{let e=Se("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r]!=null?arguments[r]:{};r%2?AM(Object(n),!0).forEach(function(i){ie(t,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):AM(Object(n)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))})}return t}({},e)}catch(e){return L.debug("handle gateway attributes failed: ",e),{}}}let bM={};function Qd(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&L.debug("install service ".concat(e.name)),bM[e.name]=e}function ju(e){let t=bM[e];if(!t)throw new Et(ce.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return t}function OM(e,t){return ju("DataStream").create(e,t)}function bR(){return ju("InterceptFrame").create()}function NM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Bu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NM(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let ib=new Map;class mG extends zn{get state(){return this._state}set state(t){if(t===this._state)return;let r=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Fi.CONNECTION_STATE_CHANGE,t,r,this._disconnectedReason):this.emit(Fi.CONNECTION_STATE_CHANGE,t,r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){L.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,r){var n,i,o;super(),ie(this,"store",void 0),ie(this,"joinInfo",void 0),ie(this,"key",void 0),ie(this,"ntpOffset",0),ie(this,"signal",void 0),ie(this,"role",void 0),ie(this,"inChannelInfo",{joinAt:null,duration:0}),ie(this,"spec",void 0),ie(this,"_state","DISCONNECTED"),ie(this,"_statsCollector",void 0),ie(this,"_disconnectedReason",void 0),ie(this,"isSignalRecover",!1),ie(this,"hasChangeBGPAddress",!1),ie(this,"trafficStatsInterval",void 0),ie(this,"networkQualityInterval",void 0),ie(this,"_joinGatewayStartTime",0),ie(this,"_signalTimeout",!1),ie(this,"_clientRoleOptions",void 0),ie(this,"_isProactiveJoin",!1),this.store=t,this.spec=r,this.signal=this.store.useP2P?(n={spec:Bu(Bu({},r),{},{retryConfig:r.websocketRetryConfig}),store:t},(i=(o=ju("P2PChannel")).createSubmodule)===null||i===void 0?void 0:i.call(o,n)):new hG(Bu(Bu({},r),{},{retryConfig:r.websocketRetryConfig}),t),this._statsCollector=r.statsCollector,this.role=r.role||"audience",this._clientRoleOptions=r.clientRoleOptions,this.handleSignalEvents()}async join(t,r,n){this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);let i=Date.now(),o=ib.get(t.cname);if(o||(o=new Map,ib.set(t.cname,o)),this._isProactiveJoin=!0,o.has(t.uid)){let m=new at(ce.UID_CONFLICT);throw gr.joinGateway(t.sid,{lts:i,succ:!1,ec:m.code,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:"0",preload:t.preload}),m}o.set(t.uid,!0),this.joinInfo=t,this.key=r;let l=0;this.joinGatewayStartTime=i;let u=t.proxyServer;try{L.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(l));let m=t.gatewayAddrs.map(_=>{let{address:R}=_,[A,D]=R.split(":"),J={host:A,port:D};return t.proxyServer&&(J.proxy=t.proxyServer),J});l=(await this.signal.init(m)).uid,L.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(l," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(m){var h;throw L.error("[".concat(this.store.clientId,"] User join failed"),m.toString()),gr.joinGateway(t.sid,{lts:i,succ:!1,ec:((h=m.data)===null||h===void 0?void 0:h.desc)||m.code,errorMsg:m.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!u,signalChannel:"0",preload:t.preload}),o.delete(t.uid),this.signal.close(),m}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),L.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(m=>{L.warning("[".concat(this.store.clientId,"] get traffic stats error"),m.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Fi.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Fi.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Fi.NETWORK_QUALITY,{uplinkNetworkQuality:lM(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:lM(this._statsCollector.trafficStats.B_dnq)}):this.emit(Fi.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),l}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){r!==cn.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==Pn.CONNECTED||await function(n,i){return i===1/0?n:tr.race([n,V6(i)])}(this.signal.request(Dr.LEAVE,void 0,!0),3e3)}catch(n){L.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),n)}this.signal.close(r),r!==cn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let i={state:"offer",p2p_id:this.store.p2pId,ortc:r,mode:this.spec.mode,extend:Se("PUB_EXTEND"),twcc:!!Se("PUBLISH_TWCC"),rtx:!!Se("USE_PUB_RTX")};try{return(await this.signal.request(Dr.PUBLISH,i,!0))._message}catch(o){if(n&&o.data&&o.data.code===br.ERR_PUBLISH_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),o.toString()),await this.tryUnpubBeforeRepub(t,r),this.publish(t,r,!1);throw o}}async publishDataChannel(t,r,n){var i;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));let o={stream_id:r.streamId,ordered:r.ordered?1:0,max_retrans_times:(i=r.maxRetransmits)!==null&&i!==void 0?i:10,channel_id:r.channelId,metadata:r.metadata};try{await this.signal.request(Dr.PUBLISH_DATASTREAM,o,!0)}catch(l){if(n&&l.data&&l.data.code===br.ERR_PUBLISH_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),l.toString()),await this.tryUnpubDataChannelBeforeRepub(t,r),this.publishDataChannel(t,r,!1);throw l}}async unpublish(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(Dr.UNPUBLISH,{stream_id:r,ortc:t},!0)}catch(n){L.warning("[".concat(this.store.clientId,"] unpublish warning: "),n)}}async unpublishDataChannel(t){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await tr.all(t.map(r=>this.signal.request(Dr.UNPUBLISH_DATASTREAM,{channel_id:r},!0)))}catch(r){L.warning("unpublish datachannels warning: ",r)}}async presubscribe(t,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));let i={stream_id:t,stream_type:r,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Se("SUBSCRIBE_TWCC"),rtx:!!Se("USE_SUB_RTX")||void 0,extend:Se("SUB_EXTEND"),svc:Array.isArray(Se("SVC"))&&Se("SVC").length!==0?Se("SVC"):void 0};try{return await this.signal.request(Dr.PRE_SUBSCRIBE,i,!0)}catch(o){if(n&&o.data&&o.data.code===br.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),o.toString()),this.presubscribe(t,r,!1);throw o}}async subscribe(t,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));let i={stream_id:t,stream_type:r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Se("SUBSCRIBE_TWCC"),rtx:!!Se("USE_SUB_RTX"),extend:Se("SUB_EXTEND"),ssrcId:r.ssrcId,svc:Array.isArray(Se("SVC"))&&Se("SVC").length!==0?Se("SVC"):void 0};try{return(await this.signal.request(Dr.SUBSCRIBE,i,!0))._message}catch(o){if(n&&o.data&&o.data.code===br.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),o.toString()),await this.tryUnsubBeforeResub(t,r),await this.subscribe(t,r,!1);throw o}}async subscribeDataChannel(t,r,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));let i={uid:t,stream_id:r.id,channel_id:r.datachannelId};try{return void await this.signal.request(Dr.SUBSCRIBE_DATASTREAM,i,!0)}catch(o){if(n&&o.data&&o.data.code===br.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),o.toString()),await this.tryUnsubDataChannelBeforeResub(t,r),await this.subscribeDataChannel(t,r,!1);throw o}}async subscribeAll(t,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));let n={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!Se("USE_SUB_RTX"),twcc:!!Se("SUBSCRIBE_TWCC"),svc:Array.isArray(Se("SVC"))&&Se("SVC").length!==0?Se("SVC"):void 0};try{return await this.signal.request(Dr.SUBSCRIBE_STREAMS,n,!0)}catch(i){if(r&&i.data&&i.data.code===br.ERR_SUBSCRIBE_REQUEST_INVALID)return L.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),i.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw i}}async setVideoProfile(t){let r=function(n){if(!(n.bitrateMax&&n.bitrateMin&&n.frameRate&&n.height&&n.width))return;let i=n.frameRate,o=n.width,l=n.height,u=!0;return typeof i!="number"&&(i=i.exact||i.ideal||i.max||i.min||0,i||(u=!1)),typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(u=!1)),typeof l!="number"&&(l=l.exact||l.ideal||l.max||l.min||0,i||(u=!1)),u?{stream_type:0,width:o,height:l,fps:i,start_bps:1e3*n.bitrateMax,min_bps:1e3*n.bitrateMin,target_bps:1e3*n.bitrateMax}:void 0}(t);if(r)return this.signal.request(Dr.SET_VIDEO_PROFILE,r);L.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,r){try{await this.signal.request(Dr.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:r},!0)}catch(n){L.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),n)}}async unsubscribeDataChannel(t,r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await tr.all(t.map(n=>this.signal.request(Dr.UNSUBSCRIBE_DATASTREAM,{stream_id:n,uid:r},!0)))}catch(n){L.warning("unsubscribeDataChannel warning: ",n)}}async massUnsubscribe(t){try{await this.signal.request(Dr.UNSUBSCRIBE_STREAMS,t,!0)}catch(r){L.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),r)}}async reconnectPC(t){let{iceParameters:r,dtlsParameters:n,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(Dr.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:r,dtlsParameters:n,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(Dr.GATEWAY_INFO)}async renewToken(t){await this.signal.request(Dr.RENEW_TOKEN,t),this.key=t.token}updateClientRole(t,r){r&&(this._clientRoleOptions=Object.assign({},r)),Se("CLIENT_ROLE_OPTIONS")&&(L.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Se("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},Se("CLIENT_ROLE_OPTIONS"))),this.role=t}async setClientRole(t,r){if(r&&(this._clientRoleOptions=Object.assign({},r)),Se("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},Se("CLIENT_ROLE_OPTIONS")),L.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(Se("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=t);let n,i=0;t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request(Dr.SET_CLIENT_ROLE,{role:t,level:i,delay:n,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,r){await this.signal.request(Dr.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:r})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(Dr.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,r){await this.signal.request(Dr.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:r})}async pickSVCLayer(t,r){await this.signal.request(Dr.PICK_SVC_LAYER,{stream_id:t,spatial_layer:r.spatialLayer,temporal_layer:r.temporalLayer})}async setRTM2Flag(t){await this.signal.request(Dr.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,r,n){if(this.store.useP2P)return this.signal.sendExtensionMessage(t,r,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Bu({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(Dr.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){let t=ib.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;let t=function(r){let n;return n=r.startsWith("dc")?r.match(/(dc\:\/\/)?([^:]+):(\d+)/):r.match(/(wss\:\/\/)?([^:]+):(\d+)/),n?{username:aa.username,password:aa.password,turnServerURL:n[2],tcpport:parseInt(n[3])+30,udpport:parseInt(n[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Bu(Bu({},aa),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;let t=await this.signal.request(Dr.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.ntp_offset!=null&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach(r=>{let n=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(i=>i.peer_uid===r.peer_uid);n&&n.B_st!==r.B_st&&qS(()=>{this.emit(Fi.STREAM_TYPE_CHANGE,r.peer_uid,r.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new at(ce.UNEXPECTED_ERROR,"can not generate join message, no join info");let r=Object.assign({},this.joinInfo.apResponse),n=Se("REPORT_APP_SCENARIO");if(typeof n!="string")try{n=JSON.stringify(n)}catch{n=void 0}var i;n&&n.length>128&&(n=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(Fi.UPDATE_GATEWAY_CONFIG),i=this.store.clientId,Qt(pE).call(pE,i)||pE.push(i);let o=!(Yn()||q1(87)||UP())&&typeof Se("ENABLE_PRE_SUB")=="boolean"&&Se("ENABLE_PRE_SUB"),l=!UP()&&Es("ENABLE_PREALLOC_PC","boolean"),u=fG(),h=Fg(87)||function(){let _=$r();if(_.name!==an.SAFARI||!_.browserVersion)return!1;let R=_.browserVersion.split(".");return Number(R[0])>15||Number(R[0])===15&&Number(R[1])>=4}(),m=Bu({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:hs,browser:navigator.userAgent,process_id:Se("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:r,extend:Se("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:Bu({enableEncodedTransform:!!Se("ENABLE_AUDIO_METADATA")&&h||!!Se("ENABLE_AUDIO_TOPN")&&ZI(an.CHROME,87,116)||void 0,enableAudioMetadata:!!Se("ENABLE_AUDIO_METADATA")&&h,enableAudioPts:!!Se("ENABLE_AUDIO_PTS_METADATA")&&h,topnSmoothLevel:Se("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:Se("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:Se("TOPN_SWITCH_HOLD_MS"),topnAudioGain:Se("TOPN_AUDIO_GAIN"),enablePublishedUserList:Se("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Se("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:Es("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:Es("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:Es("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:Se("USE_PUB_RTX")===!0||Se("USE_SUB_RTX")===!0||void 0,disableFEC:Se("DISABLE_FEC"),enableNTPReport:!!Se("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!Se("ENABLE_INSTANT_VIDEO")||void 0,enableFulllinkAvSync:!!Se("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:Es("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!Se("ENABLE_AUT_FEEDBACK")||void 0,rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!Se("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:Es("USE_XR","boolean"),enableLossbasedBwe:Es("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!Se("ENABLE_AUT_CC")||void 0,enableCCFallback:Es("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:l,preSubNum:o?Es("PRE_SUB_NUM","number"):void 0,enablePubTWCC:Es("PUBLISH_TWCC","boolean"),enableSubTWCC:Es("SUBSCRIBE_TWCC","boolean"),enablePubRTX:Es("USE_PUB_RTX","boolean"),enableSubRTX:Es("USE_SUB_RTX","boolean"),enableSubSVC:Se("ENABLE_SVC")?Se("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(Se("SVC"))&&Se("SVC").length!==0?Se("SVC"):void 0,enableSvcExtended:Se("ENABLE_SVC")&&Array.isArray(Se("SVC_EXTENDED"))&&Se("SVC_EXTENDED").length!==0?Se("SVC_EXTENDED"):void 0},u)},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(m.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(m.aes_mode=this.joinInfo.aesmode,Se("ENCRYPT_AES")?(m.aes_secret=this.joinInfo.aespassword,m.aes_encrypt=!0):m.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(m.aes_salt=this.joinInfo.aessalt)),r.addresses[this.signal.websocket.currentURLIndex]&&(m.ap_response.ticket=r.addresses[this.signal.websocket.currentURLIndex].ticket,delete r.addresses),this.joinInfo.defaultVideoStream!==void 0&&(m.default_video_stream=this.joinInfo.defaultVideoStream),m}getRejoinMessage(){if(!this.joinInfo)throw new at(ce.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Lr.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Lr.WS_RECONNECTING,t=>{this.joinInfo&&gr.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||na.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",gr.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Lr.WS_CLOSED,t=>{let r;switch(t){case cn.LEAVE:r=na.LEAVE;break;case cn.UID_BANNED:case cn.IP_BANNED:case cn.CHANNEL_BANNED:case cn.SERVER_ERROR:r=na.SERVER_ERROR;break;case cn.FALLBACK:r=na.FALLBACK;break;case cn.LICENSE_MISSING:case cn.LICENSE_EXPIRED:case cn.LICENSE_MINUTES_EXCEEDED:case cn.LICENSE_PERIOD_INVALID:case cn.LICENSE_MULTIPLE_SDK_SERVICE:case cn.LICENSE_ILLEGAL:case cn.TOKEN_EXPIRE:r=t;break;default:r=na.NETWORK_ERROR}L.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(r||"undefined -> "+na.NETWORK_ERROR)),this.joinInfo&&gr.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===cn.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r}),this._disconnectedReason=t,t!==cn.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Lr.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){let t=Se("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;t&&(t.level||t.delay)&&(L.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(t.level,", delay: ").concat(t.delay)),this.setClientRole(this.role,t))}if(gr.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){let t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void L.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));pn("EVENT_REPORT_DOMAIN",t[1]),pn("EVENT_REPORT_BACKUP_DOMAIN",t[1]),pn("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}}),this.signal.on(Wr.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Lr.REQUEST_RECOVER,(t,r,n)=>{if(!this.joinInfo)return n(new at(ce.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,ia(this,Fi.REQUEST_NEW_GATEWAY_LIST).then(r).catch(n)}),this.signal.on(Lr.REQUEST_JOIN_INFO,async(t,r,n)=>{var i;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));let o=Zn((i=this.joinInfo)===null||i===void 0?void 0:i.turnServer);if(Se("NEW_TURN_MODE")&&o){let m=o.servers,_=o.serversFromGateway,R=this.signal.currentURLIndex;m.length>0&&(m=[m[R%m.length]],o.servers=m),Array.isArray(_)&&_.length>0&&(_=[_[0]],o.serversFromGateway=_),L.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(R))}let{iceParameters:l,dtlsParameters:u,rtpCapabilities:h}=await ia(this,Fi.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:o});try{t(this.getJoinMessage({ortc:{iceParameters:l,dtlsParameters:u,rtpCapabilities:h,version:"2"}}))}catch(m){r(m)}}),this.signal.on(Lr.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Lr.REPORT_JOIN_GATEWAY,(t,r)=>{if(!this.joinInfo)return;let n,i="";var o;t instanceof at?(n=((o=t.data)===null||o===void 0?void 0:o.desc)||t.code,i=t.message):n=t,gr.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:n,errorMsg:i,addr:r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(Lr.IS_P2P_DISCONNECTED,t=>{t(zg(this,Fi.IS_P2P_DISCONNECTED))}),this.signal.on(Lr.DISCONNECT_P2P,()=>{this.emit(Fi.DISCONNECT_P2P)}),this.signal.on(Lr.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Lr.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Lr.JOIN_RESPONSE,t=>{let r=this.getCurrentGatewayAddress();this.emit(Fi.JOIN_RESPONSE,t,r)}),this.signal.on(Lr.PRE_CONNECT_PC,async()=>{if(this.joinInfo){this.updateTurnConfigFromSignal();let t=this.getCurrentGatewayAddress(),r=Se("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(t&&r){let n=_M(t);this.emit(Fi.PRE_CONNECT_PC,{candidates:n,fingerprint:r})}}}),this.signal.on(Lr.RECOVER_NOTIFICATION,t=>{this.joinInfo&&typeof Se("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(Se("AP_REQUEST_DETAIL"),";").concat(t))})}async tryUnsubBeforeResub(t,r){try{await this.signal.request(Dr.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[r]},!0)}catch(n){throw L.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),n),n}}async tryUnsubDataChannelBeforeResub(t,r){try{await this.signal.request(Dr.UNSUBSCRIBE,{stream_id:r.id},!0)}catch(n){throw L.warning("unsubscribe datachannel warning",n),n}}async tryUnpubBeforeRepub(t,r){try{await this.signal.request(Dr.UNPUBLISH,{stream_id:t,ortc:r},!0)}catch(n){throw L.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),n),n}}async tryUnpubDataChannelBeforeRepub(t,r){try{await this.signal.request(Dr.UNPUBLISH_DATASTREAM,{channnel_id:r.channelId},!0)}catch(n){throw L.warning("unpublish datastream warning: ",n),n}}async tryMassUnsubBeforeResub(t){let r={users:t.map(n=>({stream_id:n.stream_id,stream_type:n.stream_type}))};try{await this.signal.request(Dr.UNSUBSCRIBE_STREAMS,r,!0)}catch(n){throw L.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),n),n}}async muteLocal(t,r){let n={action:t.find(i=>i.stream_type===un.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(Dr.CONTROL,n,!0,!0)}catch(i){throw L.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),i),i}}async unmuteLocal(t,r){let n={action:t.find(i=>i.stream_type===un.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:r};try{await this.signal.request(Dr.CONTROL,n,!0,!0)}catch(i){throw L.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),i),i}}async muteRemote(t,r){let n={action:t===lr.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(Dr.CONTROL,n,!0,!0)}catch(i){throw L.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),i),i}}async unmuteRemote(t,r){let n={action:t===lr.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:r};try{await this.signal.request(Dr.CONTROL,n,!0,!0)}catch(i){throw L.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),i),i}}uploadWRTCStats(t){this.signal.uploadWRTCStats(t)}upload(t,r){this.signal.upload(t,r)}getSignalRTT(){return this.signal.rtt}async restartICE(t){let r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(Dr.RESTART_ICE,r,!0)}catch(n){throw L.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),n),n}}reconnect(t,r){this.state==="CONNECTED"&&this.signal.reconnect(t||void 0,r||na.P2P_FAILED)}getCurrentGatewayAddress(){var t,r;if(!Se("GATEWAY_WSS_ADDRESS"))return Se("USE_CANDIDATE_FROM_AP_DETAIL")&&(t=this.joinInfo)!==null&&t!==void 0&&t.apGatewayAddress?(L.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(r=this.joinInfo)!==null&&r!==void 0&&r.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(Dr.SET_PARAMETER,{enablePublishAudioFilter:t})}}let OR=0,ab=0;function Gc(e,t,r,n){return new tr((i,o)=>{t.timeout=t.timeout||Se("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!r?(t.data=JSON.stringify(t.data),OR+=Dl(t.data)):r&&(t.data.size?OR+=t.data.size:t.data instanceof FormData?OR+=dP(t.data):OR+=Dl(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Ha.request(t).then(l=>{typeof l.data=="string"?ab+=Dl(l.data):l.data instanceof ArrayBuffer||l.data instanceof Uint8Array?ab+=l.data.byteLength:ab+=Dl(JSON.stringify(l.data)),n&&i({data:l.data,headers:l.headers}),i(l.data)}).catch(l=>{Ha.isCancel(l)?o(new at(ce.OPERATION_ABORTED,"cancel token canceled")):l.code==="ECONNABORTED"?o(new at(ce.NETWORK_TIMEOUT,l.message)):l.response?o(new at(ce.NETWORK_RESPONSE_ERROR,l.response.status)):o(new at(ce.NETWORK_ERROR,l.message))})})}(function(){var e;function t(Rt){var Yt=0;return function(){return Yt<Rt.length?{done:!1,value:Rt[Yt++]}:{done:!0}}}var r=typeof Object.defineProperties=="function"?Object.defineProperty:function(Rt,Yt,fr){return Rt==Array.prototype||Rt==Object.prototype||(Rt[Yt]=fr.value),Rt},n,i=function(Rt){Rt=[typeof globalThis=="object"&&globalThis,Rt,typeof window=="object"&&window,typeof self=="object"&&self,typeof de=="object"&&de];for(var Yt=0;Yt<Rt.length;++Yt){var fr=Rt[Yt];if(fr&&fr.Math==Math)return fr}throw Error("Cannot find global object")}(this);function o(Rt,Yt){if(Yt)e:{var fr=i;Rt=Rt.split(".");for(var wt=0;wt<Rt.length-1;wt++){var B=Rt[wt];if(!(B in fr))break e;fr=fr[B]}(Yt=Yt(wt=fr[Rt=Rt[Rt.length-1]]))!=wt&&Yt!=null&&r(fr,Rt,{configurable:!0,writable:!0,value:Yt})}}function l(Rt){return(Rt={next:Rt})[Symbol.iterator]=function(){return this},Rt}function u(Rt){var Yt=typeof Symbol<"u"&&Symbol.iterator&&Rt[Symbol.iterator];return Yt?Yt.call(Rt):{next:t(Rt)}}if(o("Symbol",function(Rt){function Yt(B,Ce){this.A=B,r(this,"description",{configurable:!0,writable:!0,value:Ce})}if(Rt)return Rt;Yt.prototype.toString=function(){return this.A};var fr="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",wt=0;return function B(Ce){if(this instanceof B)throw new TypeError("Symbol is not a constructor");return new Yt(fr+(Ce||"")+"_"+wt++,Ce)}}),o("Symbol.iterator",function(Rt){if(Rt)return Rt;Rt=Symbol("Symbol.iterator");for(var Yt="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),fr=0;fr<Yt.length;fr++){var wt=i[Yt[fr]];typeof wt=="function"&&typeof wt.prototype[Rt]!="function"&&r(wt.prototype,Rt,{configurable:!0,writable:!0,value:function(){return l(t(this))}})}return Rt}),typeof Object.setPrototypeOf=="function")n=Object.setPrototypeOf;else{var h;e:{var m={};try{m.__proto__={a:!0},h=m.a;break e}catch{}h=!1}n=h?function(Rt,Yt){if(Rt.__proto__=Yt,Rt.__proto__!==Yt)throw new TypeError(Rt+" is not extensible");return Rt}:null}var _=n;function R(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function A(Rt){if(Rt.m)throw new TypeError("Generator is already running");Rt.m=!0}function D(Rt,Yt){return Rt.h=3,{value:Yt}}function J(Rt){this.g=new R,this.G=Rt}function V(Rt,Yt,fr,wt){try{var B=Yt.call(Rt.g.j,fr);if(!(B instanceof Object))throw new TypeError("Iterator result "+B+" is not an object");if(!B.done)return Rt.g.m=!1,B;var Ce=B.value}catch(ke){return Rt.g.j=null,Rt.g.s(ke),K(Rt)}return Rt.g.j=null,wt.call(Rt.g,Ce),K(Rt)}function K(Rt){for(;Rt.g.h;)try{var Yt=Rt.G(Rt.g);if(Yt)return Rt.g.m=!1,{value:Yt.value,done:!1}}catch(fr){Rt.g.v=void 0,Rt.g.s(fr)}if(Rt.g.m=!1,Rt.g.l){if(Yt=Rt.g.l,Rt.g.l=null,Yt.F)throw Yt.D;return{value:Yt.return,done:!0}}return{value:void 0,done:!0}}function se(Rt){this.next=function(Yt){return Rt.o(Yt)},this.throw=function(Yt){return Rt.s(Yt)},this.return=function(Yt){return function(fr,wt){A(fr.g);var B=fr.g.j;return B?V(fr,"return"in B?B.return:function(Ce){return{value:Ce,done:!0}},wt,fr.g.return):(fr.g.return(wt),K(fr))}(Rt,Yt)},this[Symbol.iterator]=function(){return this}}function ue(Rt,Yt){return Yt=new se(new J(Yt)),_&&Rt.prototype&&_(Yt,Rt.prototype),Yt}if(R.prototype.o=function(Rt){this.v=Rt},R.prototype.s=function(Rt){this.l={D:Rt,F:!0},this.h=this.C||this.u},R.prototype.return=function(Rt){this.l={return:Rt},this.h=this.u},J.prototype.o=function(Rt){return A(this.g),this.g.j?V(this,this.g.j.next,Rt,this.g.o):(this.g.o(Rt),K(this))},J.prototype.s=function(Rt){return A(this.g),this.g.j?V(this,this.g.j.throw,Rt,this.g.o):(this.g.s(Rt),K(this))},o("Array.prototype.entries",function(Rt){return Rt||function(){return function(Yt,fr){Yt instanceof String&&(Yt+="");var wt=0,B=!1,Ce={next:function(){if(!B&&wt<Yt.length){var ke=wt++;return{value:fr(ke,Yt[ke]),done:!1}}return B=!0,{done:!0,value:void 0}}};return Ce[Symbol.iterator]=function(){return Ce},Ce}(this,function(Yt,fr){return[Yt,fr]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var De=function(Rt,Yt){for(var fr=0;fr<Rt.length;fr++)Yt(Rt[fr])},ze=function(Rt){return Rt.replace(/\r?\n|\r/g,`\r
`)},Ke=function(Rt,Yt,fr){return Yt instanceof Blob?(fr=fr!==void 0?fr+"":typeof Yt.name=="string"?Yt.name:"blob",Yt.name===fr&&Object.prototype.toString.call(Yt)!=="[object Blob]"||(Yt=new File([Yt],fr)),[String(Rt),Yt]):[String(Rt),String(Yt)]},Ve=function(Rt,Yt){if(Rt.length<Yt)throw new TypeError(Yt+" argument required, but only "+Rt.length+" present.")},_t=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,Vt=_t.FormData,ar=_t.XMLHttpRequest&&_t.XMLHttpRequest.prototype.send,ur=_t.Request&&_t.fetch,Kr=_t.navigator&&_t.navigator.sendBeacon,zr=_t.Element&&_t.Element.prototype,wn=_t.Symbol&&Symbol.toStringTag;wn&&(Blob.prototype[wn]||(Blob.prototype[wn]="Blob"),"File"in _t&&!File.prototype[wn]&&(File.prototype[wn]="File"));try{new File([],"")}catch{_t.File=function(Rt,Yt,fr){return Rt=new Blob(Rt,fr||{}),Object.defineProperties(Rt,{name:{value:Yt},lastModified:{value:+(fr&&fr.lastModified!==void 0?new Date(fr.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),wn&&Object.defineProperty(Rt,wn,{value:"File"}),Rt}}var si=function(Rt){return Rt.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},ti=function(Rt){this.i=[];var Yt=this;Rt&&De(Rt.elements,function(fr){if(fr.name&&!fr.disabled&&fr.type!=="submit"&&fr.type!=="button"&&!fr.matches("form fieldset[disabled] *"))if(fr.type==="file"){var wt=fr.files&&fr.files.length?fr.files:[new File([],"",{type:"application/octet-stream"})];De(wt,function(B){Yt.append(fr.name,B)})}else fr.type==="select-multiple"||fr.type==="select-one"?De(fr.options,function(B){!B.disabled&&B.selected&&Yt.append(fr.name,B.value)}):fr.type==="checkbox"||fr.type==="radio"?fr.checked&&Yt.append(fr.name,fr.value):(wt=fr.type==="textarea"?ze(fr.value):fr.value,Yt.append(fr.name,wt))})};if((e=ti.prototype).append=function(Rt,Yt,fr){Ve(arguments,2),this.i.push(Ke(Rt,Yt,fr))},e.delete=function(Rt){Ve(arguments,1);var Yt=[];Rt=String(Rt),De(this.i,function(fr){fr[0]!==Rt&&Yt.push(fr)}),this.i=Yt},e.entries=function Rt(){var Yt,fr=this;return ue(Rt,function(wt){if(wt.h==1&&(Yt=0),wt.h!=3)return Yt<fr.i.length?wt=D(wt,fr.i[Yt]):(wt.h=0,wt=void 0),wt;Yt++,wt.h=2})},e.forEach=function(Rt,Yt){Ve(arguments,1);for(var fr=u(this),wt=fr.next();!wt.done;wt=fr.next()){var B=u(wt.value);wt=B.next().value,B=B.next().value,Rt.call(Yt,B,wt,this)}},e.get=function(Rt){Ve(arguments,1);var Yt=this.i;Rt=String(Rt);for(var fr=0;fr<Yt.length;fr++)if(Yt[fr][0]===Rt)return Yt[fr][1];return null},e.getAll=function(Rt){Ve(arguments,1);var Yt=[];return Rt=String(Rt),De(this.i,function(fr){fr[0]===Rt&&Yt.push(fr[1])}),Yt},e.has=function(Rt){Ve(arguments,1),Rt=String(Rt);for(var Yt=0;Yt<this.i.length;Yt++)if(this.i[Yt][0]===Rt)return!0;return!1},e.keys=function Rt(){var Yt,fr,wt,B,Ce=this;return ue(Rt,function(ke){if(ke.h==1&&(Yt=u(Ce),fr=Yt.next()),ke.h!=3)return fr.done?void(ke.h=0):(wt=fr.value,B=u(wt),D(ke,B.next().value));fr=Yt.next(),ke.h=2})},e.set=function(Rt,Yt,fr){Ve(arguments,2),Rt=String(Rt);var wt=[],B=Ke(Rt,Yt,fr),Ce=!0;De(this.i,function(ke){ke[0]===Rt?Ce&&(Ce=!wt.push(B)):wt.push(ke)}),Ce&&wt.push(B),this.i=wt},e.values=function Rt(){var Yt,fr,wt,B,Ce=this;return ue(Rt,function(ke){if(ke.h==1&&(Yt=u(Ce),fr=Yt.next()),ke.h!=3)return fr.done?void(ke.h=0):(wt=fr.value,(B=u(wt)).next(),D(ke,B.next().value));fr=Yt.next(),ke.h=2})},ti.prototype._asNative=function(){for(var Rt=new Vt,Yt=u(this),fr=Yt.next();!fr.done;fr=Yt.next()){var wt=u(fr.value);fr=wt.next().value,wt=wt.next().value,Rt.append(fr,wt)}return Rt},ti.prototype._blob=function(){var Rt="----formdata-polyfill-"+Math.random(),Yt=[],fr="--"+Rt+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(wt,B){return typeof wt=="string"?Yt.push(fr+si(ze(B))+`"\r
\r
`+ze(wt)+`\r
`):Yt.push(fr+si(ze(B))+'"; filename="'+si(wt.name)+`"\r
Content-Type: `+(wt.type||"application/octet-stream")+`\r
\r
`,wt,`\r
`)}),Yt.push("--"+Rt+"--"),new Blob(Yt,{type:"multipart/form-data; boundary="+Rt})},ti.prototype[Symbol.iterator]=function(){return this.entries()},ti.prototype.toString=function(){return"[object FormData]"},zr&&!zr.matches&&(zr.matches=zr.matchesSelector||zr.mozMatchesSelector||zr.msMatchesSelector||zr.oMatchesSelector||zr.webkitMatchesSelector||function(Rt){for(var Yt=(Rt=(this.document||this.ownerDocument).querySelectorAll(Rt)).length;0<=--Yt&&Rt.item(Yt)!==this;);return-1<Yt}),wn&&(ti.prototype[wn]="FormData"),ar){var Xa=_t.XMLHttpRequest.prototype.setRequestHeader;_t.XMLHttpRequest.prototype.setRequestHeader=function(Rt,Yt){Xa.call(this,Rt,Yt),Rt.toLowerCase()==="content-type"&&(this.B=!0)},_t.XMLHttpRequest.prototype.send=function(Rt){Rt instanceof ti?(Rt=Rt._blob(),this.B||this.setRequestHeader("Content-Type",Rt.type),ar.call(this,Rt)):ar.call(this,Rt)}}ur&&(_t.fetch=function(Rt,Yt){return Yt&&Yt.body&&Yt.body instanceof ti&&(Yt.body=Yt.body._blob()),ur.call(this,Rt,Yt)}),Kr&&(_t.navigator.sendBeacon=function(Rt,Yt){return Yt instanceof ti&&(Yt=Yt._asNative()),Kr.call(this,Rt,Yt)}),_t.FormData=ti}})();let sv=()=>{let e=Se("AREAS");return e.length===0&&e.push(on.GLOBAL),wa(e).call(e,(t,r,n)=>{let i=wM(r);return i?n===0?i:"".concat(t,",").concat(i):t},"")},wM=e=>e===on.OVERSEA?"".concat(ha.ASIA,",").concat(ha.EUROPE,",").concat(ha.AFRICA,",").concat(ha.NORTH_AMERICA,",").concat(ha.SOUTH_AMERICA,",").concat(ha.OCEANIA):ha[e],EG=e=>{let t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(r=>{let n=TR[r],i=Object.keys(n);i&&i.map(o=>{o!=="CODE"&&(t[o]=t[o].concat(n[o]))})}),t},NR={GLOBAL:{ASIA:[on.CHINA,on.JAPAN,on.INDIA,on.KOREA,on.HKMC],EUROPE:[],NORTH_AMERICA:[on.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},wR=Object.keys(NR[on.GLOBAL]),ob=[on.CHINA,on.NORTH_AMERICA,on.EUROPE,on.ASIA,on.JAPAN,on.INDIA,on.OCEANIA,on.SOUTH_AMERICA,on.AFRICA,on.KOREA,on.HKMC,on.US],_G=function(e,t){let r=[];if(Qt(e).call(e,on.GLOBAL)){let o=[on.GLOBAL,on.OVERSEA],l=Object.keys(TR);if(t===on.GLOBAL)throw new at(ce.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===on.CHINA)r=[on.OVERSEA];else if(i=t,Qt(wR).call(wR,i)){let u=(n=t,NR[on.GLOBAL][n]||[]),h=[...o,t,...u];r=l.filter(m=>!Qt(h).call(h,m))}else if(function(u){let h=!1;return wR.forEach(m=>{var _;Qt(_=NR[on.GLOBAL][m]).call(_,u)&&(h=!0)}),h}(t)){let u=function(m){let _;return wR.forEach(R=>{var A;Qt(A=NR[on.GLOBAL][R]).call(A,m)&&(_=R)}),_}(t),h=[...o,u,t];r=l.filter(m=>!Qt(h).call(h,m))}else r=e;r=function(u){let h=[];return ob.forEach(m=>{Qt(u).call(u,m)&&h.push(m)}),h.concat(u.filter(m=>!Qt(ob).call(ob,m)))}(r)}else r=e;var n,i;return r};function DM(e){var t,r;if(!e&&Qt(t=Se("AREAS")).call(t,on.EXTENSIONS))return L.debug("update area from ap : reset"),void sb(AF,!0);if(!Qt(r=Se("AREAS")).call(r,on.GLOBAL)||!e)return;let n=TR.EXTENSIONS;n&&(n={CODE:wM(on.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},L.debug("update area from ap success: ".concat(e,",config is "),n),pn("AREAS",[on.EXTENSIONS],!0),Object.keys(n).map(i=>{i==="LOG_UPLOAD_SERVER"||i==="EVENT_REPORT_DOMAIN"||i==="EVENT_REPORT_BACKUP_DOMAIN"||i==="PROXY_SERVER_TYPE3"?pn(i,n[i][0]):pn(i,n[i])}))}function sb(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=gr.reportApiInvoke(null,{name:gi.SET_AREA,options:e,tag:Jn.TRACER});try{let n=[];if(typeof e=="string"&&(n=[e]),Array.isArray(e)&&(e.forEach(o=>{if(!Qt(Zk).call(Zk,o))throw new at(ce.INVALID_PARAMS,"invalid area code")}),n=e),Object.prototype.toString.call(e)==="[object Object]"){let{areaCode:o,excludedArea:l}=e;if(!o)throw new at(ce.INVALID_PARAMS,"area code is needed");let u=o;typeof o=="string"&&(u=[o]),n=l?_G(u,l):u}if(!t){if(jc.AREAS){let o=new at(ce.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return r.onError(o),void L.warning("setArea is prohibited because of config-distribute")}if(Qt(n).call(n,on.GLOBAL)&&Se("AREAS")===on.EXTENSIONS){let o=new at(ce.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return r.onError(o),void L.warning("setArea is prohibited because of ap extensions")}}pn("AREAS",n,t);let i=EG(n);Object.keys(i).map(o=>{o==="LOG_UPLOAD_SERVER"||o==="EVENT_REPORT_DOMAIN"||o==="EVENT_REPORT_BACKUP_DOMAIN"||o==="PROXY_SERVER_TYPE3"?pn(o,i[o][0]):pn(o,i[o])}),L.debug("set area success:",n.join(","))}catch(n){throw r.onError(n),n}r.onSuccess()}function PM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function xl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PM(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let cb=1;function gG(e,t,r,n,i){cb+=1;let o={sid:r.sid,command:"convergeAllocateEdge",uid:"666",appId:r.appId,ts:Math.floor(Date.now()/1e3),seq:cb,requestId:cb,version:hs,cname:r.cname},l={service_name:t,json_body:JSON.stringify(o)},u,h,m=e[0];return xc(async()=>{u=Date.now();let _=await Gc(m,{data:l,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-u,_.code!==0){let D=new at(ce.UNEXPECTED_RESPONSE,"live streaming ap error, code"+_.code,{retry:!0,responseTime:h});throw L.error(D.toString()),D}let R=JSON.parse(_.json_body);if(R.code!==200){let D=new at(ce.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(R.code,", reason: ").concat(R.reason),{code:R.code,responseTime:h});throw L.error(D.toString()),D}if(!R.servers||R.servers.length===0){let D=new at(ce.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:R.code,responseTime:h});throw L.error(D.toString()),D}let A=function(D,J){return{addressList:D.servers.map(V=>"wss://".concat(V.address.replace(/\./g,"-"),".").concat(Se("WORKER_DOMAIN"),":").concat(V.wss,"?serviceName=").concat(encodeURIComponent(J))),workerToken:D.workerToken,vid:D.vid}}(R,t);return Se("LIVE_STREAMING_ADDRESS")&&(A.addressList=Se("LIVE_STREAMING_ADDRESS")instanceof Array?Se("LIVE_STREAMING_ADDRESS"):[Se("LIVE_STREAMING_ADDRESS")]),xl(xl({},A),{},{responseTime:h})},(_,R)=>(gr.apworkerEvent(r.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(_.addressList),firstSuccess:R===0,responseTime:h,serverIp:e[R%e.length]}),!1),(_,R)=>(gr.apworkerEvent(r.sid,{success:!1,sc:_.data&&_.data.code||200,serviceName:t,responseTime:h,serverIp:e[R%e.length]}),!!(_.code!==ce.OPERATION_ABORTED&&_.code!==ce.UNEXPECTED_RESPONSE||_.data&&_.data.retry)&&(m=e[(R+1)%e.length],!0)),i)}let lb=1;function LM(e,t,r,n){let{url:i,areaCode:o}=e,{clientId:l,sid:u}=t,h=Date.now(),m,_=t.role,[R,A]=db(t,o,[fi.CHOOSE_SERVER]),D=pi.networkState;return xc(async()=>{D&&pi.networkState===To.OFFLINE&&pi.onlineWaiter&&await tr.race([pi.onlineWaiter,Yi(n&&n.maxRetryTimeout||vi.maxRetryTimeout)]),D=pi.networkState;let{data:J,headers:V}=await Gc(i,{data:R,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);m=V.http3==="1"?1:-1,gr.reportResourceTiming(i,u),MM(J,i,t,h,[fi.CHOOSE_SERVER],m);let K=nv(J,fi.CHOOSE_SERVER);return ub(K),$A(K,i)},J=>(J&&gr.joinChooseServer(u,{role:_,lts:h,succ:!0,csAddr:i,opid:A,serverList:J.gatewayAddrs.map(V=>V.address),ec:null,cid:J.cid.toString(),uid:J.uid.toString(),csIp:J.csIp,unilbsServerIds:[fi.CHOOSE_SERVER].toString(),isHttp3:m,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:J.res.detail&&J.res.detail[38]}),!1),J=>J.code!==ce.OPERATION_ABORTED&&(J.code===ce.CAN_NOT_GET_GATEWAY_SERVER?J.data.retry:(gr.joinChooseServer(u,{role:_,lts:h,succ:!1,csAddr:i,serverList:null,opid:A,ec:J.code,csIp:J.data&&J.data.csIp,unilbsServerIds:[fi.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:D}),isHttp3:m,corssRegionTagReq:t.apRequestDetail}),L.warning("[".concat(l||"sid-".concat(u.slice(0,6)),"] Choose server network error, retry"),J),!0)),n)}function kM(e,t,r,n){let i,{url:o,areaCode:l,serviceIds:u}=e,h=Date.now(),m=t.role,[_,R]=db(t,l,u),A;return xc(async()=>{A&&pi.networkState===To.OFFLINE&&pi.onlineWaiter&&await tr.race([pi.onlineWaiter,Yi(n&&n.maxRetryTimeout||vi.maxRetryTimeout)]),A=pi.networkState;let{data:D,headers:J}=await Gc(o,{data:_,cancelToken:r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i=J.http3==="1"?1:-1,gr.reportResourceTiming(o,t.sid),MM(D,o,t,h,u,i);let V=nv(D,fi.CHOOSE_SERVER),K=nv(D,t.cloudProxyServer==="proxy5"?fi.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?fi.CLOUD_PROXY:fi.CLOUD_PROXY_FALLBACK);return ub(V),{gatewayInfo:$A(V,o),proxyInfo:K,url:o}},D=>(D.gatewayInfo&&gr.joinChooseServer(t.sid,{role:m,lts:h,succ:!0,csAddr:o,serverList:D.gatewayInfo.gatewayAddrs.map(J=>J.address),ec:null,opid:R,cid:D.gatewayInfo.cid.toString(),uid:D.gatewayInfo.uid.toString(),csIp:D.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:i,corssRegionTagReq:t.apRequestDetail,corssRegionTagRes:D.gatewayInfo.res.detail&&D.gatewayInfo.res.detail[38]}),D.proxyInfo&&gr.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:o,turnServerAddrList:D.proxyInfo.addresses.map(J=>J.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:u.toString()}),!1),D=>D.code!==ce.OPERATION_ABORTED&&(D.code===ce.CAN_NOT_GET_GATEWAY_SERVER?D.data.retry:(gr.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:D.code,eventType:t.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:A})}),L.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),D),!0)),n)}let MM=(e,t,r,n,i,o)=>{let{sid:l,clientId:u,cloudProxyServer:h}=r,m=[],_=R=>{R.flag===4096?gr.joinChooseServer(l,{role:r.role,lts:n,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:R.error.message,csIp:R.error.data&&R.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o,corssRegionTagReq:r.apRequestDetail}):R.flag!==1048576&&R.flag!==4194304&&R.flag!==4194310||gr.joinWebProxyAP(l,{lts:n,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:R.error.code,eventType:h,unilbsServerIds:i.toString()})};if(e.response_body.forEach(R=>{let A=R.buffer.code;if(R.uri===23&&A===0&&!R.buffer.edges_services)if(R.buffer.flag===4194310)L.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),R.buffer.edges_services=[];else{let D={error:new at(ce.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:R.buffer.flag};m.push(D),_(D)}if(A!==0){let D=_E(A),J={error:new at(ce.CAN_NOT_GET_GATEWAY_SERVER,D.desc,{desc:D.desc,retry:D.retry,csIp:e.detail[502]}),flag:R.buffer.flag};R.buffer.flag===4194310?L.warning(J.error.toString()):m.push(J),_(J)}}),m.length)throw L.warning("[".concat(u||"sid-".concat(l.slice(0,6)),"] multi unilbs ").concat(t," failed, ").concat(m.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message,", retry: ").concat(R.error.data.retry)).join(" | "))),new at(ce.CAN_NOT_GET_GATEWAY_SERVER,m.map(R=>"flag: ".concat(R.flag,", message: ").concat(R.error.message)).join(" | "),{retry:!!m.find(R=>R.error.data.retry),csIp:e.detail[502],desc:[...new Set(m.map(R=>{var A;return R==null||(A=R.error)===null||A===void 0||(A=A.data)===null||A===void 0?void 0:A.desc}).filter(R=>!!R))]})},ub=e=>{var t,r,n,i;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new at(ce.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(Se("AP_AREA")&&((n=e.detail)!==null&&n!==void 0&&n[23]&&typeof((i=e.detail)===null||i===void 0?void 0:i[23])=="string"?DM(e.detail[23].toLowerCase()):DM()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((r=e.detail)===null||r===void 0?void 0:r[19])=="string"){let l=e.detail[19],u=l?.split(";");for(let h=0;h<u.length;h++){var o;let m=Ia(o=u[h]).call(o);e.addresses[h]&&u&&(e.addresses[h].fingerprint=m)}}if(Se("GATEWAY_ADDRESS")&&Se("GATEWAY_ADDRESS").length>0){L.debug("assign gateway address to",Se("GATEWAY_ADDRESS"));let l=Se("GATEWAY_ADDRESS").map(u=>{var h,m;let _=(h=(m=e.addresses.find(R=>R.ip===u.ip&&R.port===u.port))===null||m===void 0?void 0:m.fingerprint)!==null&&h!==void 0?h:"";return{ip:u.ip,port:u.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:_}});e.addresses=l}},vG=(e,t)=>{if(e.response_body&&e.response_body.length){let r=e.response_body[0];if(r.buffer.code!==0){let n=_E(r.buffer.code);throw new at(ce.UPDATE_TICKET_FAILED,"[".concat(r.buffer.code,"]: ").concat(n.desc),{retry:n.retry})}return r.buffer.ticket}throw L.debug("update ticket request received ap response without response body:",t),new at(ce.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},db=(e,t,r)=>{let n=Math.floor(Math.random()*1e12),i=e.role==="host"?"1":e.role==="audience"?"2":void 0,o={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:xl(xl(xl({6:e.stringUid,11:t,12:Se("USE_NEW_TOKEN")?"1":void 0},i?{17:i}:{}),{},{22:t},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:r,uid:e.uid||0}}]};o.request_bodies.forEach(u=>{e.multiIP&&e.multiIP.gateway_ip&&(u.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});let l=new FormData;return l.append("request",JSON.stringify(o)),[l,n]},TG=(e,t)=>{let r=Math.floor(Math.random()*1e12),n={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(o=>({ip:o.ip,port:o.port}))}}]},i=new FormData;return i.append("request",JSON.stringify(n)),[i,r]},yE=0;function SE(e){return tr.all(e.map(t=>t.then(r=>{throw r},r=>r))).then(t=>{throw t},t=>t)}let cv=async e=>{let{fragementLength:t,referenceList:r,asyncMapHandler:n,allFailedhandler:i,promisesCollector:o}=e,l=0,u=t,h,m=0,_=async()=>{let R=(()=>{let A=l*u,D=A+u;return r.slice(A,D).map(n)})();o&&o.push(...R);try{h=await SE(R)}catch(A){if(m+=u,l++,!(m>=r.length))return void await _();i(A)}R.forEach(A=>A.cancel())};return await _(),h},UM=async e=>{let{referenceList:t,asyncMapHandler:r,closeFn:n}=e,i=t.length,o=0,l=async()=>{let u=r(t.shift());try{return await u}catch(h){if(o++,o>=i||n!=null&&n(h))throw h;return l()}};return l()};async function hb(e,t,r,n){return{gatewayInfo:await async function(i,o,l,u){let h=null,m=[],_=async()=>{let A=Se("WEBCS_DOMAIN").slice(0,Se("AJAX_REQUEST_CONCURRENT")).map(V=>({url:i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:sv()})),D=u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map(V=>V.url)}),J=await cv({fragementLength:Se("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:V=>(L.debug("[".concat(i.clientId,"] Connect to choose_server:"),V.url),LM(V,i,o,l)),allFailedhandler:V=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},D),V[0]},promisesCollector:m});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},D),J},R=async()=>{if(await Yi(1e3),h!==null)return h;let A=Se("WEBCS_DOMAIN_BACKUP_LIST").map(V=>({url:i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(V+"/api/v2/transpond/webrtc?v=2"):"https://".concat(V,"/api/v2/transpond/webrtc?v=2"),areaCode:sv()})),D=u.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:A.map(V=>V.url)}),J=await cv({fragementLength:Se("FRAGEMENT_LENGTH"),referenceList:A,asyncMapHandler:V=>(L.debug("[".concat(i.clientId,"] Connect to backup choose_server:"),V.url),LM(V,i,o,l)),allFailedhandler:V=>{throw u.recordJoinChannelService({endTs:Date.now(),status:"error",errors:V},D),V[0]},promisesCollector:m});return u.recordJoinChannelService({endTs:Date.now(),status:"success"},D),J};try{return h=await SE([_(),R()]),m.length&&m.forEach(A=>A.cancel&&typeof A.cancel=="function"&&A.cancel()),h}catch(A){throw A[0]}}(e,t,r,n)}}async function xM(e,t,r,n,i){let o=e.cloudProxyServer;if(o==="disabled"){if(e.useLocalAccessPoint)return await hb(e,t,r,i);if(Se("JOIN_WITH_FALLBACK_MEDIA_PROXY")){let{gatewayInfo:A,proxyInfo:D}=await VM(e,t,r,i);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:A};let J=D.map(V=>({turnServerURL:V.address,tcpport:V.tcpport||aa.tcpport,udpport:V.udpport||aa.udpport,username:V.username||aa.username,password:V.password||aa.password,forceturn:!1,security:!0}));if(i.useP2P){var l;let V=(l=e.uid)!==null&&l!==void 0?l:A.uid,K="glb:".concat(V.toString()),se=await aA(K),ue=D.map(De=>({turnServerURL:De.address,tcpport:De.tcpport||aa.tcpport,udpport:De.udpport||aa.udpport,username:K,password:se,forceturn:!1,security:!0}));J.push(...ue)}return e.turnServer={mode:"manual",servers:J},{gatewayInfo:A}}return await hb(e,t,r,i)}let{proxyInfo:u,gatewayInfo:h}=await VM(e,t,r,i),m={gatewayInfo:h},_=u.map(A=>({turnServerURL:A.address,tcpport:o==="proxy3"?void 0:A.tcpport?A.tcpport:aa.tcpport,udpport:o==="proxy4"?void 0:A.udpport?A.udpport:aa.udpport,username:A.username||aa.username,password:A.password||aa.password,forceturn:o!=="proxy4",security:o==="proxy5"}));if(i.useP2P){var R;let A=(R=e.uid)!==null&&R!==void 0?R:h.uid,D="glb:".concat(A.toString()),J=await aA(D),V=u.map(K=>({turnServerURL:K.address,tcpport:o==="proxy3"?void 0:K.tcpport||aa.tcpport,udpport:o==="proxy4"?void 0:K.udpport||aa.udpport,username:D,password:J,forceturn:o!=="proxy4",security:o==="proxy5"}));_.push(...V)}return e.turnServer={mode:"manual",servers:_},L.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),m}async function jM(e,t,r,n,i){let o=Se("ACCOUNT_REGISTER").slice(0,Se("AJAX_REQUEST_CONCURRENT")),l=[];l=t.proxyServer?o.map(h=>"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v1")):o.map(h=>"https://".concat(h,"/api/v1"));let u=i?.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:l});try{let h=await async function(m,_,R,A,D){let J=Date.now(),V={sid:R.sid,opid:10,appid:R.appId,string_uid:_},K=m[0],se=await xc(()=>Gc(K+"".concat(K.indexOf("?")===-1?"?":"&","action=stringuid"),{data:V,cancelToken:A,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(ue,De)=>{if(ue.code===0){if(ue.uid<=0||ue.uid>=Math.pow(2,32))throw L.error("Invalid Uint Uid ".concat(_," => ").concat(ue.uid),ue),gr.reqUserAccount(V.sid,{lts:J,success:!1,serverAddr:K,stringUid:V.string_uid,uid:ue.uid,errorCode:ce.INVALID_UINT_UID_FROM_STRING_UID,extend:V}),new at(ce.INVALID_UINT_UID_FROM_STRING_UID);return gr.reqUserAccount(V.sid,{lts:J,success:!0,serverAddr:K,stringUid:V.string_uid,uid:ue.uid,errorCode:null,extend:V}),!1}let ze=_E(ue.code);return ze.retry&&(K=m[(De+1)%m.length]),gr.reqUserAccount(V.sid,{lts:J,success:!1,serverAddr:K,stringUid:V.string_uid,uid:ue.uid,errorCode:ze.desc,extend:V}),ze.retry},(ue,De)=>ue.code!==ce.OPERATION_ABORTED&&(gr.reqUserAccount(V.sid,{lts:J,success:!1,serverAddr:K,stringUid:V.string_uid,uid:null,errorCode:ue.code,extend:V}),K=m[(De+1)%m.length],!0),D);if(se.code!==0){let ue=_E(se.code);throw new at(ce.UNEXPECTED_RESPONSE,ue.desc)}return se}(l,e,t,r,n);return i?.recordJoinChannelService({status:"success",endTs:Date.now()},u),h.uid}catch(h){throw i?.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},u),h}}async function yG(e,t,r){let n=Se("ACCOUNT_REGISTER"),i=[];i=t.proxyServer?n.map(o=>"https://".concat(t.proxyServer,"/ap/?url=").concat(o+"/api/v1")):n.map(o=>"https://".concat(o,"/api/v1"));try{return await UM({referenceList:i,asyncMapHandler:o=>async function(l,u,h,m){let _=Date.now(),R={sid:h.sid,opid:10,appid:h.appId,string_uid:u};try{let A=await Gc(l+"".concat(l.indexOf("?")===-1?"?":"&","action=stringuid"),{data:R,cancelToken:m,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(A.code!==0){let D=_E(A.code);throw new at(ce.UNEXPECTED_RESPONSE,"preload sua error:".concat(D.desc),D)}if(A.uid<=0||A.uid>=Math.pow(2,32))throw new at(ce.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:_,url:l,req:R,uid:A.uid,elapse:Date.now()-_}}catch(A){throw A}}(o,e,t,r),closeFn:o=>o.code===ce.OPERATION_ABORTED||o.code===ce.UNEXPECTED_RESPONSE&&!o.data.retry})}catch(o){throw o}}async function SG(e,t,r){let n=Se("CDS_AP").slice(0,Se("AJAX_REQUEST_CONCURRENT")).map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v1"):"https://".concat(h,"/api/v1?action=config")),i=n.map(h=>function(m,_,R,A){let D=$r(),J={flag:64,cipher_method:0,features:xl(xl(xl(xl(xl({install_id:EA(),device:D.name,system:D.os,system_general:navigator.userAgent,vendor:_.appId,version:hs,cname:_.cname,session_id:_.sid,proxyServer:_.proxyServer,sdk_type:pG.WEB_RTC,browser_name:D.name,browser_version:D.version,user_agent:navigator.userAgent,channel_name:_.cname},_.stringUid&&{string_uid:_.stringUid}),_.uid&&{uid:_.uid+""}),D.os&&{os_name:D.os}),D.osVersion&&{os_version:D.osVersion}),{},{detail:""})};return xc(()=>Gc(m,{data:J,timeout:1e3,cancelToken:R,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,V=>V.code!==ce.OPERATION_ABORTED,A)}(h,e,t,r)),o=null,l=null,u={};try{o=await SE(i)}catch(h){if(h.code===ce.OPERATION_ABORTED)throw h;l=h}if(i.forEach(h=>h.cancel()),gr.reportApiInvoke(e.sid,{name:gi.REQUEST_CONFIG_DISTRIBUTE,options:{error:l,res:o}}).onSuccess(),o&&o.test_tags)try{u=function(h){if(!h.test_tags)return{};let m=h.test_tags,_=Object.keys(m),R={};return _.forEach(A=>{var D;let J=Ia(D=A.slice(4)).call(D),V=JSON.parse(m[A]),K=V[1];R[J]={tag:V[0]||"",value:K}}),R}(o)}catch{}return u}async function BM(e,t){let r=Se("WEBCS_DOMAIN").concat(Se("WEBCS_DOMAIN_BACKUP_LIST")).map(n=>({url:"https://".concat(n,"/api/v2/transpond/webrtc?v=2"),areaCode:sv(),serviceIds:[fi.CHOOSE_SERVER,fi.CLOUD_PROXY_FALLBACK]}));try{return await UM({referenceList:r,asyncMapHandler:n=>async function(i,o,l){let u,{url:h,areaCode:m,serviceIds:_}=i,R=Date.now(),[A,D]=db(o,m,_),J=pi.networkState;try{J&&pi.networkState===To.OFFLINE&&pi.onlineWaiter&&await tr.race([pi.onlineWaiter,Yi(vi.maxRetryTimeout)]),J=pi.networkState;let{data:V,headers:K}=await Gc(h,{data:A,cancelToken:l,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=K.http3==="1"?1:-1,(De=>{let ze=[];if(De.response_body.forEach(Ke=>{let Ve=Ke.buffer.code;if(Ke.uri===23&&Ve===0&&!Ke.buffer.edges_services)if(Ke.buffer.flag===4194310)Ke.buffer.edges_services=[];else{let _t={error:new at(ce.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:De.detail[502]}),flag:Ke.buffer.flag};ze.push(_t)}if(Ve!==0){let _t=_E(Ve),Vt={error:new at(ce.CAN_NOT_GET_GATEWAY_SERVER,_t.desc,{desc:_t.desc,retry:_t.retry,csIp:De.detail[502]}),flag:Ke.buffer.flag};Ke.buffer.flag===4194310?L.warning(Vt.error.toString()):ze.push(Vt)}}),ze.length)throw new at(ce.CAN_NOT_GET_GATEWAY_SERVER,ze.map(Ke=>"flag: ".concat(Ke.flag,", message: ").concat(Ke.error.message)).join(" | "),{retry:!!ze.find(Ke=>Ke.error.data.retry),csIp:De.detail[502],desc:[...new Set(ze.map(Ke=>{var Ve;return Ke==null||(Ve=Ke.error)===null||Ve===void 0||(Ve=Ve.data)===null||Ve===void 0?void 0:Ve.desc}).filter(Ke=>!!Ke))]})})(V);let se=nv(V,fi.CHOOSE_SERVER),ue=nv(V,fi.CLOUD_PROXY_FALLBACK);return ub(se),{gatewayInfo:$A(se,h),proxyInfo:ue,opid:D,requestTime:R,url:h,isHttp3:u,elapse:Date.now()-R}}catch(V){throw V}}(n,e,t),closeFn:n=>n.code===ce.OPERATION_ABORTED||n.code===ce.CAN_NOT_GET_GATEWAY_SERVER&&!n.data.retry})}catch(n){throw n}}async function VM(e,t,r,n){let i=Se("PROXY_SERVER_TYPE3"),o=(D,J,V)=>{let K=V||i;return Array.isArray(K)&&(K=J%2==0?i[1]:i[0]),"https://".concat(K,"/ap/?url=").concat(D)},l=null,u=[],h=async()=>{let D=Se("WEBCS_DOMAIN").slice(0,Se("AJAX_REQUEST_CONCURRENT")).map((K,se)=>{let ue;return ue=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(K,"/api/v2/transpond/webrtc?v=2"),se,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(K,"/api/v2/transpond/webrtc?v=2"):o("".concat(K,"/api/v2/transpond/webrtc?v=2"),se),{url:ue,areaCode:sv(),serviceIds:[fi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?fi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?fi.CLOUD_PROXY:fi.CLOUD_PROXY_FALLBACK]}}),J=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(K=>K.url)}),V=await cv({fragementLength:Se("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:K=>(L.debug("[".concat(e.clientId,"] Connect to choose_server:"),K.url),kM(K,e,t,r)),allFailedhandler:K=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:K},J),K[0]},promisesCollector:u});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},J),V},m=async()=>{if(await Yi(1e3),l!==null)return l;let D=Se("WEBCS_DOMAIN_BACKUP_LIST").map((K,se)=>{let ue;return ue=e.cloudProxyServer==="disabled"&&e.proxyServer?o("".concat(K,"/api/v2/transpond/webrtc?v=2"),se,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(K,"/api/v2/transpond/webrtc?v=2"):o("".concat(K,"/api/v2/transpond/webrtc?v=2"),se),{url:ue,areaCode:sv(),serviceIds:[fi.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?fi.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?fi.CLOUD_PROXY:fi.CLOUD_PROXY_FALLBACK]}}),J=n.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:D.map(K=>K.url)}),V=await cv({fragementLength:Se("FRAGEMENT_LENGTH"),referenceList:D,asyncMapHandler:K=>(L.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),K.url),kM(K,e,t,r)),allFailedhandler:K=>{throw n.recordJoinChannelService({endTs:Date.now(),status:"error",errors:K},J),K[0]},promisesCollector:u});return n.recordJoinChannelService({endTs:Date.now(),status:"success"},J),V},_,R,A;try{({gatewayInfo:_,proxyInfo:R,url:A}=await SE([h(),m()]))}catch(D){throw D[0]}if(u.length&&u.forEach(D=>D.cancel&&typeof D.cancel=="function"&&D.cancel()),!_||!R)throw new at(ce.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=A,e.cloudProxyServer!=="disabled"&&Array.isArray(i)&&A){let D=/^https?:\/\/(.+?)(\/.*)?$/.exec(A)[1];Qt(i).call(i,D)&&(e.proxyServer=D,L.setProxyServer(D),gr.setProxyServer(D))}return l={gatewayInfo:_,proxyInfo:await uM(R,_.uid)},l}async function RG(e,t,r){let n=Se("UAP_AP").slice(0,Se("AJAX_REQUEST_CONCURRENT")).map(o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")),i=n.map(o=>function(l,u,h,m){let _={command:"convergeAllocateEdge",sid:u.sid,appId:u.appId,token:u.token,ts:Date.now(),version:hs,cname:u.cname,uid:u.uid.toString(),requestId:lb,seq:lb};lb+=1;let R={service_name:"tele_channel",json_body:JSON.stringify(_)};return xc(async()=>{let A=await Gc(l,{data:R,cancelToken:h,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(A.code!==0){let J=new at(ce.UNEXPECTED_RESPONSE,"cross channel ap error, code"+A.code,{retry:!0});throw L.error(J.toString()),J}let D=JSON.parse(A.json_body);if(D.code!==200){let J=new at(ce.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(D.code,", reason: ").concat(D.reason));throw L.error(J.toString()),J}if(!D.servers||D.servers.length===0){let J=new at(ce.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw L.error(J.toString()),J}return{vid:D.vid,workerToken:D.workerToken,addressList:(Se("CHANNEL_MEDIA_RELAY_SERVERS")||D.servers).map(J=>"wss://".concat(J.address.replace(/\./g,"-"),".").concat(Se("WORKER_DOMAIN"),":").concat(J.wss))}},void 0,A=>!!(A.code!==ce.OPERATION_ABORTED&&A.code!==ce.UNEXPECTED_RESPONSE||A.data&&A.data.retry),m)}(o,e,t,r));try{let o=await SE(i);return i.forEach(l=>l.cancel()),o}catch(o){throw o[0]}}async function CG(e,t,r){let n=null,i=[],o=async l=>{let u=Se(l?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return l&&(await Yi(1e3),n!==null)?n:await cv({fragementLength:Se("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:h=>(L.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(l?"backup":""," choose_server:"),h),function(m,_,R,A){let[D]=TG(_,[fi.CHOOSE_SERVER]),J=pi.networkState;return xc(async()=>{J&&pi.networkState===To.OFFLINE&&pi.onlineWaiter&&await tr.race([pi.onlineWaiter,Yi(A&&A.maxRetryTimeout||vi.maxRetryTimeout)]),J=pi.networkState;let V=await Gc(m,{data:D,cancelToken:R,headers:{"Content-Type":"multipart/form-data;"}},!0);return vG(V,m)},()=>!1,V=>V.code!==ce.OPERATION_ABORTED&&(V.code===ce.UPDATE_TICKET_FAILED?V.data.retry:(L.warning("[".concat(_.clientId,"] update ticket network error, retry"),V),!0)),A)}(h,e,t,r)),allFailedhandler:h=>{throw h[0]},promisesCollector:i})};try{return n=await SE([o(!1),o(!0)]),i.length&&i.forEach(l=>l.cancel&&typeof l.cancel=="function"&&l.cancel()),n}catch(l){throw l[0]}}function FM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function pb(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FM(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class IG extends zn{get isSuccess(){return!!this.configs}constructor(t,r){super(),ie(this,"configs",void 0),ie(this,"store",void 0),ie(this,"joinInfo",void 0),ie(this,"cancelToken",void 0),ie(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),ie(this,"interval",void 0),ie(this,"mutex",void 0),ie(this,"mutableParamsRead",!1),ie(this,"configCache",{}),ie(this,"limit_bitrate",void 0),this.mutex=new da("config-distribute",t),this.store=r}startGetConfigDistribute(t,r){this.joinInfo=t,this.cancelToken=r,this.interval&&this.stopGetConfigDistribute(),Se("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Se("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,gr.reportApiInvoke(null,{options:void 0,name:gi.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Jn.TRACER}).onSuccess(JSON.stringify(jc))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void L.debug("[config-distribute] get config distribute interrupted have no joininfo");let t,r=await this.mutex.lock();try{t=await SG(this.joinInfo,this.cancelToken,this.retryConfig),L.debug("[config-distribute] get config distribute",JSON.stringify(t));let n=function(i){var o;let l=Ng(o=Object.keys(i).filter(m=>/^webrtc_ng_global_parameter/.test(m))).call(o);for(let m=0;m<l.length;m++)for(let _=l.length-1;_>m;_--){let R=l[_],A=i[R].value;if(typeof A.__priority=="number"){let D=A.__priority,J=l[_-1],V=i[J].value;if(typeof V.__priority=="number"){if(!(D>V.__priority))continue;{let K=R;l[_]=l[_-1],l[_-1]=K}}else{let K=R;l[_]=l[_-1],l[_-1]=K}}}let u=Date.now(),h={};return l.forEach(m=>{let _=i[m].value.__expires;_&&_<=u||(h[m]=i[m])}),h}(t);this.cacheGlobalParameterConfig(n),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=n}catch(n){let i=new at(ce.NETWORK_RESPONSE_ERROR,n);L.warning("[config-distribute] ".concat(i.toString()))}finally{r()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(t){Qk(t)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==t.id&&this.emit(ev.UPDATE_BITRATE_LIMIT,t):this.emit(ev.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.limit_bitrate&&pb({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(t){try{let r={},n=Object.keys(t),i=[];n.forEach(o=>{let l=t[o].value;r[o]=l;let u=l.__id;if(u&&this.configCache[o]&&this.configCache[o].__id===u)return;let h=l.__type,m=t[o].value,_=t[o].tag,R=0;h?h===bP.REALTIME&&(R=1):Object.keys(m).some(A=>Object.prototype.hasOwnProperty.call(TA,A)||!HA()&&Object.prototype.hasOwnProperty.call(QS,A)?(R=1,!0):void 0),i.push({tag:_,isApplied:R,feature:o,params:JSON.stringify(l)})}),i.forEach(o=>{let{tag:l,feature:u,params:h,isApplied:m}=o;this.store.sessionId&&gr.abTest(this.store.sessionId,{intSucc:1,isApplied:m,tag:l,feature:u,params:h,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=r}catch(r){L.debug("handleABTestConfigDistribute error",r)}}cacheGlobalParameterConfig(t){let r=function(i){let o={};return Object.keys(i).forEach(l=>{let u=i[l].value,h=u.__expires,m=u.__type;Object.keys(u).forEach(_=>{_==="__id"||_==="__type"||_==="__priority"||_==="__expires"||Object.prototype.hasOwnProperty.call(o,_)||(o[_]=pb(pb({value:u[_]},h&&{expires:h}),m&&{type:m}))})}),o}(t);try{var n;let i=(n=r.LIMIT_BITRATE)===null||n===void 0?void 0:n.value;delete r.LIMIT_BITRATE,i&&Qk(i)&&this.handleBitrateLimit(i),this.limit_bitrate=i,this.handleGlobalParameterConfig(r),this.handleABTestConfigDistribute(t),function(u){try{let h=Date.now();Object.keys(u).forEach(m=>{let{value:_,type:R,expires:A}=u[m];A&&A<=h||((R===bP.REALTIME||Object.prototype.hasOwnProperty.call(TA,m))&&(jc[m]=_,Un[m]=_,L.debug("Update realtime parameters from config distribute",m,_)),R||HA()||!Object.prototype.hasOwnProperty.call(QS,m)||(jc[m]=_,Un[m]=_,L.debug("Update gateway parameters from config distribute",m,_)))})}catch(h){L.error("Error update config immediately: ".concat(u),h.message)}}(r);let o=JSON.stringify(r),l=window.btoa(o);window.localStorage.setItem("websdk_ng_global_parameter",l),L.debug("Caching global parameters ".concat(o))}catch(i){L.error("Error caching global parameters:",i.message)}}handleGlobalParameterConfig(t){try{let r=Date.now();Object.keys(t).forEach(n=>{if(n==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(Un,n)){let{value:i,expires:o}=t[n];if(o&&o<=r)return;(function(l,u){try{return typeof l=="object"&&typeof u=="object"&&JSON.stringify(l)===JSON.stringify(u)}catch{return!1}})(Un[n],i)||(jc[n]=i,Un[n]=i,this.emit(ev.UPDATE_CLIENT_ROLE_OPTIONS,i),L.debug("Updating client role options: ".concat(JSON.stringify(i))))}})}catch(r){L.error("Error handling global parameter config:",r.message)}}}class AG extends zn{constructor(){super(...arguments),ie(this,"resultStorage",new Map)}setLocalAudioStats(t,r,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(n,r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(n,r))}setLocalVideoStats(t,r,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(n,r)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(n,r)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(n))}setRemoteAudioStats(t,r){let n=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(r))}setRemoteVideoStats(t,r){let n=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(r))}record(t,r,n){if(Se("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});let i=this.resultStorage.get(t);if(i&&(i.result.push(n),i.result.length>=5)){var o;let l=Qt(o=i.result).call(o,!0);i.isPrevNormal&&!l&&this.emit("exception",GM[t],t,r),!i.isPrevNormal&&l&&this.emit("exception",GM[t]+2e3,t+"_RECOVER",r),i.isPrevNormal=l,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,r){return r instanceof Ci&&!r.isActive||!!r.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,r){let n=null;r._encoderConfig&&r._encoderConfig.frameRate&&(n=yo(r._encoderConfig.frameRate));let i=t.captureFrameRate;return!n||!i||!(n>10&&i<5||n<10&&n>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,r){return!!r.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,r){return r instanceof Ci&&!r.isActive||!!r.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}let GM={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},fa=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(r.length>0){let n=r[r.length-1];return Math.round(performance.now()-n.startTime)}return 0}measureFromPublishStart(e,t){let r=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(r.length>0){let n=r[r.length-1];return Math.round(performance.now()-n.startTime)}return 0}};function HM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Up(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?HM(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):HM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class lv{constructor(t){ie(this,"store",void 0),ie(this,"onStatsException",void 0),ie(this,"onUploadPublishDuration",void 0),ie(this,"onStatsChanged",void 0),ie(this,"localStats",new Map),ie(this,"remoteStats",new Map),ie(this,"updateStatsInterval",void 0),ie(this,"trafficStats",void 0),ie(this,"trafficStatsPeerList",[]),ie(this,"uplinkStats",void 0),ie(this,"exceptionMonitor",void 0),ie(this,"p2pChannel",void 0),ie(this,"scalabilityMode",ZS.L1T1),ie(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.exceptionMonitor=new AG,this.exceptionMonitor.on("exception",(r,n,i)=>{this.onStatsException&&this.onStatsException(r,n,i)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(Mt.LocalAudioTrack)||Up({},IA)}getLocalVideoTrackStats(){return this.localStats.get(Mt.LocalVideoTrack)||Up({},AA)}getRemoteAudioTrackStats(t){let r=(o,l)=>{if(!this.trafficStats)return l;let u=this.trafficStats.peer_delay.find(h=>h.peer_uid===o);return u&&(l.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),l},n={};if(t){var i;let o=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.audioStats;o&&(n[t]=r(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[l,{audioStats:u}]=o;u&&(n[l]=r(l,u))});return n}getRemoteNetworkQualityStats(t){let r={};if(t){var n;let i=(n=this.remoteStats.get(t))===null||n===void 0?void 0:n.networkStats;i&&(r[t]=i)}else Array.from(this.remoteStats.entries()).forEach(i=>{let[o,{networkStats:l}]=i;l&&(r[o]=l)});return r}getRemoteVideoTrackStats(t){let r=(o,l)=>{if(!this.trafficStats)return l;let u=this.trafficStats.peer_delay.find(h=>h.peer_uid===o);return u&&(l.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),l},n={};if(t){var i;let o=(i=this.remoteStats.get(t))===null||i===void 0?void 0:i.videoStats;o&&(n[t]=r(t,o))}else Array.from(this.remoteStats.entries()).forEach(o=>{let[l,{videoStats:u}]=o;u&&(n[l]=r(l,u))});return n}getRTCStats(){let t=0,r=0,n=0,i=0,o=this.localStats.get(Mt.LocalAudioTrack);o&&(t+=o.sendBytes,r+=o.sendBitrate);let l=this.localStats.get(Mt.LocalVideoTrack);l&&(t+=l.sendBytes,r+=l.sendBitrate);let u=this.localStats.get(Mt.LocalVideoLowTrack);u&&(t+=u.sendBytes,r+=u.sendBitrate),this.remoteStats.forEach(m=>{let{audioStats:_,videoStats:R}=m;_&&(n+=_.receiveBytes,i+=_.receiveBitrate),R&&(n+=R.receiveBytes,i+=R.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:r,SendBytes:t,RecvBytes:n,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(r=>r.B_ppad!==void 0||r.B_ppvd!==void 0),t.peer_delay.filter(r=>this.trafficStatsPeerList.indexOf(r.peer_uid)===-1).forEach(r=>{var n;let i=(n=this.p2pChannel)===null||n===void 0?void 0:n.getRemoteMedia(r.peer_uid),o=i!=null&&i.videoSSRC?fa.measureFromSubscribeStart(this.store.clientId,i.videoSSRC):0,l=i!=null&&i.audioSSRC?fa.measureFromSubscribeStart(this.store.clientId,i.audioSSRC):0;r.B_ppad!==void 0&&r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(r.peer_uid,r.B_ppad,r.B_ppvd,o>l?o:l),this.trafficStatsPeerList.push(r.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&L.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,r,n){if(!t)return!1;let i=!!n&&r.framesDecodeFreezeTime>n.framesDecodeFreezeTime,o=!n||r.framesDecodeCount>n.framesDecodeCount;return i||!o}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(r=>{let[n,i]=r;switch(n){case Mt.LocalVideoTrack:case Mt.LocalVideoLowTrack:{let l=i,u=Up({},AA),h=t.getStats(),m=t.getLocalMedia(n);if(h){let _=h.videoSend.find(R=>R.ssrc===m?.ssrcs[0].ssrcId);if(_){let R=t.getLocalVideoSize(),A=t.getEncoderConfig(Mt.LocalVideoTrack);_.codec!=="H264"&&_.codec!=="H265"&&_.codec!=="VP8"&&_.codec!=="VP9"&&_.codec!=="AV1X"&&_.codec!=="AV1"||(u.codecType=_.codec),u.sendBytes=_.bytes,u.sendBitrate=l?8*Math.max(0,u.sendBytes-l.sendBytes):0,_.inputFrame?(u.captureFrameRate=_.inputFrame.frameRate,u.captureResolutionHeight=_.inputFrame.height,u.captureResolutionWidth=_.inputFrame.width):R&&(u.captureResolutionWidth=R.width,u.captureResolutionHeight=R.height),_.sentFrame?(u.sendFrameRate=_.sentFrame.frameRate,u.sendResolutionHeight=_.sentFrame.height,u.sendResolutionWidth=_.sentFrame.width):R&&(u.sendResolutionWidth=R.width,u.sendResolutionHeight=R.height),_.avgEncodeMs&&(u.encodeDelay=_.avgEncodeMs),A&&A.bitrateMax&&(u.targetSendBitrate=1e3*A.bitrateMax),u.sendPackets=_.packets,u.sendPacketsLost=_.packetsLost,u.sendJitterMs=_.jitterMs,u.sendRttMs=_.rttMs,u.totalDuration=l?l.totalDuration+1:1,u.totalFreezeTime=l?l.totalFreezeTime:0,this.isLocalVideoFreeze(_)&&(u.totalFreezeTime+=1),_.scalabilityMode&&this.scalabilityMode!==_.scalabilityMode&&(L.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(_.scalabilityMode)),this.scalabilityMode=_.scalabilityMode)}this.trafficStats&&(u.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var o;this.localStats.set(n,u),(l?.sendResolutionWidth!==u.sendResolutionWidth||l?.sendResolutionHeight!==u.sendResolutionHeight)&&((o=this.onStatsChanged)===null||o===void 0||o.call(this,"resolution",{width:u.sendResolutionWidth,height:u.sendResolutionHeight})),u&&m&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,m.track,u);break}case Mt.LocalAudioTrack:{let l=i,u=Up({},IA),h=t.getStats(),m=t.getLocalMedia(n);if(h){let _=h.audioSend.find(R=>R.ssrc===m?.ssrcs[0].ssrcId);if(_){if(_.codec!=="opus"&&_.codec!=="aac"&&_.codec!=="PCMU"&&_.codec!=="PCMA"&&_.codec!=="G722"||(u.codecType=_.codec),_.inputLevel)u.sendVolumeLevel=Math.round(32767*_.inputLevel);else{let R=t.getLocalAudioVolume();R&&(u.sendVolumeLevel=Math.round(32767*R))}u.sendBytes=_.bytes,u.sendPackets=_.packets,u.sendPacketsLost=_.packetsLost,u.sendJitterMs=_.jitterMs,u.sendRttMs=_.rttMs,u.sendBitrate=l?8*Math.max(0,u.sendBytes-l.sendBytes):0}}this.trafficStats&&(u.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(Mt.LocalAudioTrack,u),u&&m&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,m.track,u);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(r=>{var n,i;let[o,{videoStats:l,audioStats:u,videoPcStats:h}]=r,m=u,_=l,R=h,A=Up({},jP),D=Up({},BP),J=Up({},uF),{audioTrack:V,videoTrack:K,audioSSRC:se,videoSSRC:ue}=t.getRemoteMedia(o),De;De=this.store.useP2P?t.getStats(!0):t.getStats();let ze=(n=De)===null||n===void 0?void 0:n.audioRecv.find(Vt=>Vt.ssrc===se),Ke=(i=De)===null||i===void 0?void 0:i.videoRecv.find(Vt=>Vt.ssrc===ue),Ve=this.trafficStats&&this.trafficStats.peer_delay.find(Vt=>Vt.peer_uid===o);if(ze&&(ze.codec!=="opus"&&ze.codec!=="aac"&&ze.codec!=="PCMU"&&ze.codec!=="PCMA"&&ze.codec!=="G722"||(A.codecType=ze.codec),ze.outputLevel?A.receiveLevel=Math.round(32767*ze.outputLevel):V&&(A.receiveLevel=Math.round(32767*V.getVolumeLevel())),A.receiveBytes=ze.bytes,A.receivePackets=ze.packets,A.receivePacketsLost=ze.packetsLost,A.receivePacketsDiscarded=ze.packetsDiscarded,A.packetLossRate=A.receivePacketsLost/(A.receivePackets+A.receivePacketsLost),A.receiveBitrate=m?8*Math.max(0,A.receiveBytes-m.receiveBytes):0,A.totalDuration=m?m.totalDuration+1:1,A.totalFreezeTime=m?m.totalFreezeTime:0,A.freezeRate=A.totalFreezeTime/A.totalDuration,A.receiveDelay=ze.jitterBufferMs,A.totalDuration>10&&lv.isRemoteAudioFreeze(V)&&(A.totalFreezeTime+=1)),Ke){var _t;Ke.codec!=="H264"&&Ke.codec!=="H265"&&Ke.codec!=="VP8"&&Ke.codec!=="VP9"&&Ke.codec!=="AV1X"&&Ke.codec!=="AV1"||(D.codecType=Ke.codec),D.receiveBytes=Ke.bytes,D.receiveBitrate=_?8*Math.max(0,D.receiveBytes-_.receiveBytes):0,D.decodeFrameRate=Ke.decodeFrameRate<0?0:Ke.decodeFrameRate,D.renderFrameRate=Ke.decodeFrameRate<0?0:Ke.decodeFrameRate,Ke.outputFrame&&(D.renderFrameRate=Ke.outputFrame.frameRate),Ke.receivedFrame?(D.receiveFrameRate=Ke.receivedFrame.frameRate,D.receiveResolutionHeight=Ke.receivedFrame.height,D.receiveResolutionWidth=Ke.receivedFrame.width):K&&(D.receiveResolutionHeight=K._videoHeight||0,D.receiveResolutionWidth=K._videoWidth||0),Ke.framesRateFirefox!==void 0&&(D.receiveFrameRate=Math.round(Ke.framesRateFirefox)),D.receivePackets=Ke.packets,D.receivePacketsLost=Ke.packetsLost,D.packetLossRate=D.receivePacketsLost/(D.receivePackets+D.receivePacketsLost);let Vt=_?_.totalFreezeTime:0,ar=_?_.totalDuration:0;D.totalDuration=_?_.totalDuration+1:1,D.totalFreezeTime=(_t=Ke.totalFreezesDuration)!==null&&_t!==void 0?_t:Vt||0,D.receiveDelay=Ke.jitterBufferMs||0;let ur=!!ue&&t.getRemoteVideoIsReady(ue);Ke.totalFreezesDuration===void 0&&K&&ur&&lv.isRemoteVideoFreeze(K,Ke,R)&&(D.totalFreezeTime+=1),D.freezeRate=Math.max(0,Math.min((D.totalFreezeTime-Vt)/(D.totalDuration-ar),1))}Ve&&(A.end2EndDelay=Ve.B_ad,D.end2EndDelay=Ve.B_vd,A.transportDelay=Ve.B_ed,D.transportDelay=Ve.B_ed,A.currentPacketLossRate=Ve.B_ealr4/100,D.currentPacketLossRate=Ve.B_evlr4/100,J.uplinkNetworkQuality=Ve.B_punq?Ve.B_punq:0,J.downlinkNetworkQuality=Ve.B_pdnq?Ve.B_pdnq:0),this.remoteStats.set(o,{audioStats:A,videoStats:D,videoPcStats:Ke,networkStats:J}),V&&this.exceptionMonitor.setRemoteAudioStats(V,A),K&&this.exceptionMonitor.setRemoteVideoStats(K,D)})}}class WM{constructor(){ie(this,"destChannelMediaInfos",new Map),ie(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){Jk(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){Jk(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){_R(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function KM(e){if(!(e instanceof WM))return new at(ce.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();let t=e.getSrcChannelMediaInfo(),r=e.getDestChannelMediaInfo();if(!t)return new at(ce.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(r.size===0)return new at(ce.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class $d{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,r){ie(this,"uid",void 0),ie(this,"_uintid",void 0),ie(this,"_trust_in_room_",!0),ie(this,"_trust_audio_enabled_state_",!0),ie(this,"_trust_video_enabled_state_",!0),ie(this,"_trust_audio_mute_state_",!0),ie(this,"_trust_video_mute_state_",!0),ie(this,"_audio_muted_",!1),ie(this,"_video_muted_",!1),ie(this,"_audio_enabled_",!0),ie(this,"_video_enabled_",!0),ie(this,"_audio_added_",!1),ie(this,"_video_added_",!1),ie(this,"_is_pre_created",!1),ie(this,"_video_pre_subscribed",!1),ie(this,"_audio_pre_subscribed",!1),ie(this,"_trust_video_stream_added_state_",!0),ie(this,"_trust_audio_stream_added_state_",!0),ie(this,"_audioTrack",void 0),ie(this,"_videoTrack",void 0),ie(this,"_dataChannels",[]),ie(this,"_audioSSRC",void 0),ie(this,"_videoSSRC",void 0),ie(this,"_audioOrtc",void 0),ie(this,"_videoOrtc",void 0),ie(this,"_cname",void 0),ie(this,"_rtxSsrcId",void 0),ie(this,"_videoMid",void 0),ie(this,"_audioMid",void 0),this.uid=t,this._uintid=r}}function zM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function qM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zM(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let uv="9",YM=4e4;function XM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Vu(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XM(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var RE=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(RE||{});let DR=new Map;function JM(e,t,r,n){let{scale:i}=e;if(i===0&&n===RE.UP||i>=t.length-1&&n===RE.DOWN)return e;let o=Vu(Vu({},e),{},{scale:n===RE.DOWN?++i:--i});switch(r){case"maintain-framerate":o=Vu(Vu({},o),t[i].motion);break;case"maintain-resolution":o=Vu(Vu({},o),t[i].detail);break;case"balanced":o=Vu(Vu({},o),t[i].balanced)}return o}function ZM(e,t){if(t){let r={overUse:0,underUse:0,adaptationList:QM(t)};DR.set(e,r)}else DR.delete(e)}function QM(e){let t=Vu({},e),{bitrateMax:r,frameRate:n,scaleResolutionDownBy:i,bitrateMin:o}=t,{MIN_FRAME_RATE:l,MAX_THRESHOLD_FRAMERATE:u,MAX_SCALE:h,BITRATE_MIN_THRESHOLD:m,BITRATE_MAX_THRESHOLD:_,BWE_SCALE_UP_THRESHOLD:R,BWE_SCALE_DOWN_THRESHOLD:A,PERF_SCALE_DOWN_THRESHOLD:D,PERF_SCALE_UP_THRESHOLD:J,BALANCE_BITRATE_FACTOR:V,BALANCE_FRAMERATE_FACTOR:K,BALANCE_RESOLUTION_FACTOR:se,MOTION_RESOLUTION_FACTOR:ue,MOTION_BITRATE_FACTOR:De,DETAIL_FRAMERATE_FACTOR:ze,DETAIL_BITRATE_FACTOR:Ke}=gA,Ve=Math.min(t.frameRate,u),_t=[{scale:0,threshold:{bwe_down:Math.round(Math.pow(A,1)*r),bwe_up:r,fps_down:Math.round(Math.pow(D,1)*Ve),fps_up:n},balanced:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:o},motion:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:o},detail:{scaleResolutionDownBy:1,frameRate:n,bitrateMax:r,bitrateMin:o}}];for(let Vt=1;Vt<=h;Vt++){let ar={bwe_up:Math.round(Math.pow(R,Vt)*r),bwe_down:Math.round(Math.pow(A,Vt+1)*r),fps_up:Math.round(Math.pow(J,Vt)*Ve),fps_down:Math.round(Math.pow(D,Vt+1)*Ve)},ur={scaleResolutionDownBy:i/Math.pow(se,Vt),frameRate:Math.max(Math.round(Math.pow(K,Vt)*n),l),bitrateMax:Math.max(Math.round(Math.pow(V,Vt)*r),_),bitrateMin:Math.max(Math.round(Math.pow(V,Vt)*o),m)},Kr={scaleResolutionDownBy:i/Math.pow(ue,Vt),frameRate:n,bitrateMax:Math.max(Math.round(Math.pow(De,Vt)*r),_),bitrateMin:Math.max(Math.round(Math.pow(De,Vt)*o),m)},zr={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(ze,Vt)*n),l),bitrateMax:Math.max(Math.round(Math.pow(Ke,Vt)*r),_),bitrateMin:Math.max(Math.round(Math.pow(Ke,Vt)*o),m)};_t.push({scale:Vt,threshold:ar,balanced:ur,motion:Kr,detail:zr})}return _t}function bG(e,t,r,n,i,o){let l=DR.get(e)||{overUse:0,underUse:0,adaptationList:QM(i)},{adaptationList:u}=l;DR.set(e,l);let{OVERUSE_TIMES_THRESHOLD:h,UNDERUSE_TIMES_THRESHOLD:m}=gA,{scale:_}=n,R,A;return typeof t=="number"&&t>0&&function(D,J,V,K){if(J>=V.length)return!1;let{threshold:{fps_down:se}}=V[J];return Se("FORCE_AG_HIGH_FRAMERATE")&&K==="maintain-framerate"&&(se=V[0].threshold.fps_down),D<se}(t,_,u,o)&&(l.overUse++,A=Yg.CPU,l.overUse>h)||typeof r=="number"&&r>0&&function(D,J,V){if(J>=V.length)return!1;let{threshold:{bwe_down:K}}=V[J];return D<K}(r,_,u)&&(l.overUse++,A=Yg.BANDWIDTH,l.overUse>h)?(l.overUse=0,l.underUse=0,R=JM(n,u,o,RE.DOWN),[R,A]):(typeof t=="number"&&t>0&&typeof r=="number"&&r>0&&function(D,J,V,K){if(J===0)return;let{threshold:{fps_up:se}}=V[J];return Se("FORCE_AG_HIGH_FRAMERATE")&&K==="maintain-framerate"&&(se=V[1].threshold.fps_up),D>se}(t,_,u,o)&&function(D,J,V){if(J===0)return;let{threshold:{bwe_up:K}}=V[J];return D>K}(r,_,u)&&(l.underUse++,l.underUse>m&&(l.overUse=0,l.underUse=0,R=JM(n,u,o,RE.UP),R.scale===0&&(A=Yg.NONE))),[R,A])}function $M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function fb(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$M(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$M(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OG(e){var t;return!!Se("ENABLE_AG_ADAPTATION")&&!!(e instanceof MA||Qt(t=e._hints).call(t,Nn.CUSTOM_TRACK))&&(!!Se("FORCE_SUPPORT_AG_ADAPTATION")||!!(function(r){let n=$r();if(n.os!==Di.IOS||!n.osVersion)return!1;let i=n.osVersion.split(".");return Number(i[0])>=r}(14)&&X1(17,4)||Y1(14)&&J1(17,4,!0)))}let PR=new Map;function LR(e,t){let r=PR.get(e);if(r){let{timer:n}=r;window.clearTimeout(n),PR.delete(e)}t.qualityLimitationReason=Yg.NONE,ZM(e)}function NG(e,t){var r;let n;switch(t){case Mt.LocalAudioTrack:n=un.Audio;break;case Mt.LocalVideoTrack:n=Qt(r=e._hints).call(r,Nn.SCREEN_TRACK)?un.Screen:un.High;break;case Mt.LocalVideoLowTrack:n=un.Low}return n}function mb(e){let t=rn();if(e.some(r=>r._bypassWebAudio))throw new Et(ce.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!t.webAudioMediaStreamDest)throw new Et(ce.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function Eb(e,t){mb(e);let r=new Ci;return e.forEach(n=>r.addAudioTrack(n)),r}let wG=!rn().supportUnifiedPlan||Se("CHROME_FORCE_PLAN_B")&&wu();function kR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var r;return wG?(r={spec:t,store:e},ju("PlanBConnection").create(r)):new jl(t,e)}function _b(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function e2(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(Kg(e.turnServer.servers))return!1;if(Se("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(t=>t.forceturn))return!0}return!1}catch{return!1}}var Jr;function t2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Hc(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?t2(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let jl=(Jr=class Qp extends eM{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Qt(r=Object.keys($S)).call(r,t)}))]}constructor(t,r){super(t,r),ie(this,"id",On(5,"connection-")),ie(this,"store",void 0),ie(this,"peerConnection",void 0),ie(this,"forceTurn",!1),ie(this,"remoteSDP",void 0),ie(this,"initialOffer",void 0),ie(this,"transportEventReceiver",void 0),ie(this,"statsFilter",void 0),ie(this,"extension",{useXR:Se("USE_XR")}),ie(this,"localCapabilities",void 0),ie(this,"remoteCodecs",void 0),ie(this,"localCandidateCount",0),ie(this,"allCandidatesReceived",!1),ie(this,"isPreallocation",!1),ie(this,"preSSRCMap",new Map),ie(this,"dataStreamChannelMap",new Map),ie(this,"establishPromise",void 0),ie(this,"recoveredDataChannelIds",[]),ie(this,"currentDataChannelId",1),ie(this,"supportAV1RtpSpec",!1),ie(this,"mutex",void 0),ie(this,"qualityLimitationReason",Yg.NONE),ie(this,"isFirstConnected",!1),this.store=r,this.forceTurn=e2(t),this.mutex=new da("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Qp.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=mA(this.peerConnection,Se("STATS_UPDATE_INTERVAL"),void 0,Yn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}getPreMedia(t){let r=this.preSSRCMap.get(t);if(r!==void 0){let n=this.peerConnection.getTransceivers().find(i=>i.mid===r);if(n)return{transceiver:n,track:n.receiver.track,id:r}}}async updateRemoteRTPCapabilities(t,r){if(this.remoteCodecs=r,!this.remoteSDP)return void L.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(r));if(this.remoteSDP.updateRemoteCodec(t,r,this.store.codec)){let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n);let o=this.remoteSDP.toString();i?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}else L.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});let n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=Zd(n.sdp),o=await TM({filterRTX:!Se("USE_PUB_RTX")&&!Se("USE_SUB_RTX"),filterVideoFec:Se("FILTER_VIDEO_FEC"),filterAudioFec:Se("FILTER_AUDIO_FEC"),filterVideoCodec:Se("FILTER_VIDEO_CODEC")},this.extension);if(this.localCapabilities=AR(o),this.initialOffer=n,Se("ENABLE_SVC")&&this.store.codec=="av1"){let u=await async function(){try{let h=new RTCPeerConnection;h.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:ZS.L1T3}]});let m=await h.createOffer();if(!m.sdp)return void h.close();let _=ao(m.sdp).mediaDescriptions[0];if(!_)return;let R=_.attributes.extmaps.find(A=>A.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return h.close(),R}catch{return}}();var t;u&&(this.supportAV1RtpSpec=!0,(t=o.send)===null||t===void 0||t.videoExtensions.push(u))}let l;return n.sdp&&CM(n.sdp)&&(l=Zn(o),(r=l).send&&(gE(lr.VIDEO,r.send.videoExtensions),gE(lr.AUDIO,r.send.audioExtensions)),r.recv&&(gE(lr.VIDEO,r.recv.videoExtensions),gE(lr.AUDIO,r.recv.audioExtensions)),r.sendrecv&&(gE(lr.VIDEO,r.sendrecv.videoExtensions),gE(lr.AUDIO,r.sendrecv.audioExtensions))),Hc(Hc({},i),{},{rtpCapabilities:l||o,offerSDP:n.sdp})}catch(n){throw new Et(ce.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}var r}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&CM(this.initialOffer.sdp)&&(r=t.rtpCapabilities,n=this.localCapabilities,r.send&&(RR(lr.VIDEO,r.send.videoExtensions,n.send.videoExtensions),RR(lr.AUDIO,r.send.audioExtensions,n.send.audioExtensions)),r.recv&&(RR(lr.VIDEO,r.recv.videoExtensions,n.recv.videoExtensions),RR(lr.AUDIO,r.recv.audioExtensions,n.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return Zn(this._localCapabilities)}get rtpCapabilities(){return Zn(this._rtpCapabilities)}get candidates(){return Zn(this._candidates)}get iceParameters(){return Zn(this._iceParameters)}get dtlsParameters(){return Zn(this._dtlsParameters)}constructor(m){let _=arguments.length>1&&arguments[1]!==void 0&&arguments[1];ie(this,"sessionDesc",void 0),ie(this,"_localCapabilities",void 0),ie(this,"_rtpCapabilities",void 0),ie(this,"_candidates",void 0),ie(this,"_originCandidates",void 0),ie(this,"_iceParameters",void 0),ie(this,"_isUseExtmapAllowMixed",void 0),ie(this,"_dtlsParameters",void 0),ie(this,"setup",void 0),ie(this,"currentMidIndex",void 0),ie(this,"cname",void 0),ie(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=_,m=Zn(m);let{iceParameters:R,dtlsParameters:A,candidates:D,rtpCapabilities:J,setup:V,localCapabilities:K,cname:se}=m;this._rtpCapabilities=J,this._candidates=D,this._originCandidates=Zn(D),this._iceParameters=R,this._dtlsParameters=A,this._localCapabilities=K,this.setup=V,this.cname=se,this.sessionDesc=this.updateRemoteRTPCapabilities(J),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}preloadRemoteMedia(m){let _=this.candidates,R=this.dtlsParameters,A=this.iceParameters,D=this.rtpCapabilities.send,J=this.sessionDesc.mediaDescriptions.length-1;for(let V=1;V<m;V++){let K=2*V+2e4,se=2*V+YM,{ssrcs:ue,ssrcGroups:De}=Mp([{ssrcId:K}],this.cname),{ssrcs:ze,ssrcGroups:Ke}=Mp([{ssrcId:se,rtx:Se("USE_SUB_RTX")?se+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:uv,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.videoCodecs.map(Ve=>Ve.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:A.iceUfrag,icePwd:A.icePwd,unrecognized:[],candidates:_,extmaps:D.videoExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ze,ssrcGroups:Ke,rtcpFeedbackWildcards:[],payloads:D.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++J)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:uv,protos:["UDP","TLS","RTP","SAVPF"],fmts:D.audioCodecs.map(Ve=>Ve.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:A.iceUfrag,icePwd:A.icePwd,unrecognized:[],candidates:_,extmaps:D.audioExtensions,fingerprints:R.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:ue,ssrcGroups:De,rtcpFeedbackWildcards:[],payloads:D.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(++J)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return zd(this.sessionDesc)}send(m,_,R,A){let{ssrcs:D,ssrcGroups:J}=Mp(_,this.cname,Se("SYNC_GROUP")?R:void 0),V=this.findPreloadMediaDesc(D);if(V){if(Yn()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,V.attributes.mid),A&&(A.twcc||A.remb)){let K=this.sessionDesc.mediaDescriptions.indexOf(V);return this.sessionDesc.mediaDescriptions[K]=this.mungSendMediaDesc(V,A),{mid:V.attributes.mid,needExchangeSDP:!0}}return{mid:V.attributes.mid,needExchangeSDP:!1}}{let K=this.findAvailableMediaIndex(m,D),se;return K===-1||K===1&&(ra()||function(){let ue=$r();return!(ue.name!==an.CHROME||!ue.osVersion)&&Number(ue.version)<=90}()||Se("ENABLE_ENCODED_TRANSFORM")&&Nu())||K===0&&Se("USE_SUB_RTX")||Z1()?(se=this.createOrRecycleSendMedia(m,D,J,"sendonly",A),this.updateBundleMids()):(se=Zn(this.sessionDesc.mediaDescriptions[K]),se.attributes.direction="sendonly",se.attributes.ssrcs=D,se.attributes.ssrcGroups=J,this.sessionDesc.mediaDescriptions[K]=this.mungSendMediaDesc(se,A)),Yn()&&this.firefoxSsrcMidMap.set(D[0].ssrcId,se.attributes.mid),{mid:se.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){let{mediaDesc:m,needExchangeSDP:_}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:m.attributes.mid,needExchangeSDP:_}}batchSend(m){let _=m.map(D=>{let{kind:J,ssrcMsg:V,mslabel:K}=D;return this.send(J,V,K)}),R=[],A=!1;return _.forEach(D=>{let{mid:J,needExchangeSDP:V}=D;V&&(A=!0),R.push(J)}),{mids:R,needExchangeSDP:A}}stopSending(m){let _=this.sessionDesc.mediaDescriptions.filter(R=>R.attributes.mid&&m.indexOf(R.attributes.mid)!==-1);if(_.length!==m.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");_.forEach(R=>{R.attributes.mid==="0"||Yn()||Z1()?R.attributes.ssrcs=[]:(R.attributes.ssrcs=[],R.attributes.direction="inactive",R.media.port="0")}),this.updateBundleMids()}mute(m){let _=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===m);if(!_)throw new Error("mediaDescription not found with ".concat(m," in remote SDP when calling RemoteSDP.mute."));_.attributes.direction="inactive"}unmute(m){let _=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===m);if(!_)throw new Error("mediaDescription not found with ".concat(m," in remote SDP when calling RemoteSDP.unmute."));_.attributes.direction="sendonly"}muteRemote(m){let _=this.sessionDesc.mediaDescriptions.filter(R=>Qt(m).call(m,R.attributes.mid||""));if(_.length!==m.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_.forEach(R=>{R.attributes.direction="inactive"})}unmuteRemote(m){let _=this.sessionDesc.mediaDescriptions.filter(R=>Qt(m).call(m,R.attributes.mid||""));if(_.length!==m.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_.forEach(R=>{R.attributes.direction="recvonly"})}receive(m,_,R,A){m.forEach((D,J)=>{this.createOrRecycleRecvMedia(D,[],"recvonly",_,R,A[J])}),this.updateBundleMids()}stopReceiving(m){let _=this.sessionDesc.mediaDescriptions.filter(R=>m.indexOf(R.attributes.mid)!==-1);if(_.length!==m.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");_.forEach(R=>{R.media.port="0",R.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(m){let _=this.sessionDesc||ao((R=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(R?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var R;this._rtpCapabilities=m;let A=this.rtpCapabilities.send,D=this.localCapabilities.send;for(let J of _.mediaDescriptions){if(J.attributes.iceUfrag=this._iceParameters.iceUfrag,J.attributes.icePwd=this._iceParameters.icePwd,J.attributes.fingerprints=this._dtlsParameters.fingerprints,J.attributes.candidates=this._candidates,J.attributes.setup=this.setup,J.media.mediaType==="application"&&(J.attributes.sctpPort="5000"),J.media.mediaType==="video"){if(A.videoCodecs.length===0){let V=D.videoCodecs.filter(K=>{var se,ue;return(se=K.rtpMap)===null||se===void 0?void 0:Qt(ue=se.encodingName.toLowerCase()).call(ue,"vp8")})||[D.videoCodecs[0]];J.media.fmts=V.map(K=>K.payloadType.toString(10)),J.attributes.payloads=V,J.attributes.extmaps=[]}else if(J.media.fmts=A.videoCodecs.map(V=>V.payloadType.toString(10)),J.attributes.payloads=A.videoCodecs,J.attributes.extmaps=A.videoExtensions,Se("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:V,ssrcGroups:K}=Mp([{ssrcId:YM,rtx:Se("USE_SUB_RTX")?40001:void 0}],this.cname);J.attributes.ssrcs=V,J.attributes.ssrcGroups=K}}if(J.media.mediaType==="audio"){if(A.audioCodecs.length===0){let V=D.audioCodecs.filter(K=>{var se,ue;return(se=K.rtpMap)===null||se===void 0?void 0:Qt(ue=se.encodingName.toLowerCase()).call(ue,"opus")})||[D.audioCodecs[0]];J.media.fmts=V.map(K=>K.payloadType.toString(10)),J.attributes.payloads=V,J.attributes.extmaps=[]}else if(J.media.fmts=A.audioCodecs.map(V=>V.payloadType.toString(10)),J.attributes.payloads=A.audioCodecs,J.attributes.extmaps=A.audioExtensions,TE(J),Se("PRELOAD_MEDIA_COUNT")>0){let{ssrcs:V,ssrcGroups:K}=Mp([{ssrcId:2e4}],this.cname);J.attributes.ssrcs=V,J.attributes.ssrcGroups=K}}}return this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1,this.sessionDesc}updateCandidates(m){let _=this._originCandidates.filter(A=>A.transport==="udp"),R=[];if(_.forEach(A=>{R.push(qM(qM({},A),{},{foundation:"tcpcandidate",priority:Number(A.priority)-1+"",transport:"tcp",port:Number(A.port)+90+""}))}),_.length!==0){switch(m){case pa.TCP_RELAY:this._candidates=R;break;case pa.UDP_TCP_RELAY:case pa.RELAY:this._candidates=[..._,...R];break;default:this._candidates=_}for(let A of this.sessionDesc.mediaDescriptions)A.attributes.candidates=this.candidates}}restartICE(m){m=Zn(m),this._iceParameters=m,this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.iceUfrag=m.iceUfrag,_.attributes.icePwd=m.icePwd})}predictReceivingMids(m){let _=[];for(let R=0;R<m;R++)_.push((this.currentMidIndex+R+1).toString(10));return _}findAvailableMediaIndex(m,_){return this.sessionDesc.mediaDescriptions.findIndex(R=>{let A=R.media.mediaType===m&&R.media.port!=="0"&&(R.attributes.direction==="sendonly"||R.attributes.direction==="sendrecv")&&R.attributes.ssrcs.length===0;if(Yn()){if(A){let D=this.firefoxSsrcMidMap.get(_[0].ssrcId);return!(D||R.attributes.mid!=="0"&&R.attributes.mid!=="1")||!(!D||D!==R.attributes.mid)}return!1}return A})}createOrRecycleDataChannel(){for(let R of this.sessionDesc.mediaDescriptions)if(R.media.mediaType==="application")return{mediaDesc:R,needExchangeSDP:!1};this.currentMidIndex+=1;let m="".concat(this.currentMidIndex),_={media:{mediaType:"application",port:uv,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(m),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(_),{mediaDesc:_,needExchangeSDP:!0}}createOrRecycleRecvMedia(m,_,R,A,D,J){let V=m._mediaStreamTrack.kind,K=this.rtpCapabilities.recv,se=av(V,K,this.localCapabilities.send,V===lr.VIDEO?A:D),ue=V===lr.VIDEO?K.videoExtensions:K.audioExtensions;this.currentMidIndex+=1;let De="".concat(this.currentMidIndex),ze={media:{mediaType:V,port:uv,protos:["UDP","TLS","RTP","SAVPF"],fmts:se.map(Ve=>Ve.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ue,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:se,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:R,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(De)}};ze=this.mungRecvMediaDsec(ze,m,J);let Ke=this.findFirstClosedMedia(V);if(Ke){let Ve=this.sessionDesc.mediaDescriptions.indexOf(Ke);this.sessionDesc.mediaDescriptions[Ve]=ze}else this.sessionDesc.mediaDescriptions.push(ze);return ze}updateRemoteCodec(m,_,R){let A=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(ze=>ze.rtpMap&&ze.rtpMap.encodingName.toLowerCase()||"").filter(ze=>{var Ke;return Qt(Ke=Object.keys($S)).call(Ke,ze)}))],D=new Set(_);if(A.every(ze=>D.has(ze)))return L.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(_)),!1;let J=this._rtpCapabilities.recv.videoCodecs.filter(ze=>_.some(Ke=>{var Ve;return Qt(Ve=ze.rtpMap&&ze.rtpMap.encodingName.toLowerCase()||"").call(Ve,Ke)}));if(J.length===0)return L.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(A," codecs: ").concat(_)),!1;let V=[...new Set(J.map(ze=>ze.rtpMap&&ze.rtpMap.encodingName.toLowerCase()||""))],K;if(L.debug("updateRemoteCodec, from ".concat(A," to ").concat(V)),m.length===0)K=this.sessionDesc.mediaDescriptions.filter(ze=>ze.media.mediaType==="video"&&ze.attributes.direction==="recvonly");else if(K=this.sessionDesc.mediaDescriptions.filter(ze=>ze.attributes.mid&&Qt(m).call(m,ze.attributes.mid)&&ze.attributes.direction==="recvonly"),K.length!==m.length)return L.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(m,", codecs: ").concat(_)),!1;if(Se("USE_PUB_RTX")||Se("USE_SUB_RTX")){let ze=nb(J,this.rtpCapabilities.recv.videoCodecs);J.push(...ze)}this._rtpCapabilities.recv.videoCodecs=J;let se=this.localCapabilities.send,ue=this.rtpCapabilities.recv,De=av(lr.VIDEO,ue,se,R);return K.forEach(ze=>{let Ke=De.map(Ve=>Ve.payloadType.toString(10));L.debug("updateRemoteCodec mid: ".concat(ze.attributes.mid,", from"),ze.attributes.payloads,"to",De),ze.attributes.payloads=De,ze.media.fmts=Ke}),!0}createOrRecycleSendMedia(m,_,R,A,D){let J=this.rtpCapabilities.send,V=m===lr.VIDEO?J.videoCodecs:J.audioCodecs,K=m===lr.VIDEO?J.videoExtensions:J.audioExtensions;this.currentMidIndex+=1;let se="".concat(this.currentMidIndex),ue={media:{mediaType:m,port:uv,protos:["UDP","TLS","RTP","SAVPF"],fmts:V.map(ze=>ze.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:K,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_,ssrcGroups:R,rtcpFeedbackWildcards:[],payloads:V,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:A,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(se)}};ue=this.mungSendMediaDesc(ue,D);let De=this.findFirstClosedMedia(m);if(De){let ze=this.sessionDesc.mediaDescriptions.indexOf(De);this.sessionDesc.mediaDescriptions[ze]=ue}else this.sessionDesc.mediaDescriptions.push(ue);return ue}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(m=>m.media.port!=="0").map(m=>m.attributes.mid)}mungRecvMediaDsec(m,_,R){let A=Zn(m);return tb(A),vE(A,_),rb(A,_),gM(A),IR(A,R,this.localCapabilities.send),A}mungSendMediaDesc(m,_){let R=Zn(m);return IR(R,_,this.localCapabilities.recv),TE(R),R}updateRecvMedia(m,_){let R=this.sessionDesc.mediaDescriptions.findIndex(A=>A.attributes.mid===m);if(R!==-1){let A=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[R],_);this.sessionDesc.mediaDescriptions[R]=A}}bumpMid(m){this.currentMidIndex+=m}findFirstClosedMedia(m){return this.sessionDesc.mediaDescriptions.find(_=>Yn()?_.media.port==="0"&&_.media.mediaType===m:_.media.port==="0")}findPreloadMediaDesc(m){return this.sessionDesc.mediaDescriptions.find(_=>{var R;return((R=_.attributes)===null||R===void 0||(R=R.ssrcs[0])===null||R===void 0?void 0:R.ssrcId)===m[0].ssrcId})}getSSRC(m){var _;return(_=this.sessionDesc.mediaDescriptions.find(R=>R.attributes.mid===m))===null||_===void 0?void 0:_.attributes.ssrcs}}(Hc(Hc({},t),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec),t.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let i=this.remoteSDP.toString(),o=SM(this.initialOffer.sdp,this.extension),l=this.logSDPExchange(o||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),l?.(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i});let u=this.peerConnection.getTransceivers()[0];if(u!=null&&u.receiver&&this.tryBindTransportEvents(u.receiver),Se("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia(Se("PRELOAD_MEDIA_COUNT"));let m=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:m});let _=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(_)}let{preSSRCs:h}=t;if(Array.isArray(h)&&h.length>0){let{mids:m}=this.remoteSDP.batchSend(h.map(_=>({kind:_.kind,ssrcMsg:[{ssrcId:_.ssrcId,rtx:_.rtx}],mslabel:_.mslabel})));m.forEach((_,R)=>{this.preSSRCMap.set(h[R].ssrcId,_)}),await ov(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] pre-batchReceive exchange SDP."))}}catch(i){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}var r,n}async updateRemoteConnect(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let{rtpCapabilities:r}=t;this.remoteSDP.updateRemoteRTPCapabilities(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);let{preSSRCs:n}=t;if(Array.isArray(n)&&n.length>0){let{mids:i}=this.remoteSDP.batchSend(n.map(o=>Object.assign({},{kind:o.kind,ssrcMsg:[{ssrcId:o.ssrcId,rtx:o.rtx}],mslabel:o.mslabel})));i.forEach((o,l)=>{this.preSSRCMap.set(n[l].ssrcId,o)})}await ov(this.peerConnection,this.remoteSDP,this.extension),L.debug("[P2PConnection] updateRemoteRTPCapabilities by exchanging SDP.")}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(r.toString()))}}send(t,r,n){var i=this;return ds(function*(){let o=yield Qr(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let l=[],u=SR();t.forEach(K=>{let se=i.peerConnection.addTransceiver(K._mediaStreamTrack,Hc({direction:"sendonly"},K.trackMediaType==="video"&&i.supportAV1RtpSpec&&u?{sendEncodings:[{scalabilityMode:u}]}:{}));l.push(se),K._updateRtpTransceiver(se)}),Yn()&&Se("SIMULCAST")===!0&&(yield Qr(i.applySimulcastForFirefox(l,t)));let h=yield Qr(i.peerConnection.createOffer()),m=i.remoteSDP.predictReceivingMids(t.length),_=i.mungSendOfferSDP(h.sdp,t,m),R=ao(_),A=m.map(K=>{let se=R.mediaDescriptions.find(ue=>ue.attributes.mid===K);if(!se)throw new Error("Cannot extract ssrc from mediaDescription.");return mM(se,Se("USE_PUB_RTX"))}),D;try{D=yield A}catch(K){D=[],i.remoteSDP.receive(t,r,n,D);let se=i.remoteSDP.toString();throw yield Qr(i.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Qr(i.peerConnection.setRemoteDescription({type:"answer",sdp:se})),yield Qr(i.stopSending(m,!0)),K}i.remoteSDP.receive(t,r,n,D);let J=i.remoteSDP.toString(),V=i.logSDPExchange(_,"offer","local","send");return yield Qr(i.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Qr(i.applySimulcastEncodings(l,t)),yield Qr(i.applySendEncodings(l,t)),V?.(J),yield Qr(i.peerConnection.setRemoteDescription({type:"answer",sdp:J})),l.map((K,se)=>{let ue=m[se];return{localSSRC:A[se],id:ue,transceiver:K}})}catch(l){throw l instanceof Et?l:new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{o()}})()}async createDataChannels(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(t);if(n&&n.readyState==="open")L.debug("[P2PConnection] Channels are already available and can be reused directly.");else{let o=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof o!="number")throw new Error("create DataChannel error, because cannot get dc id");n=this.peerConnection.createDataChannel("datastream-channel",{id:o,negotiated:!0,ordered:!1,maxRetransmits:Se("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,n)}r.forEach(o=>{o._updateOriginDataChannel(n)});let{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){let o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});let l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(l),L.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else L.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(n){throw n instanceof Et?n:new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(n.toString()))}}async stopDataChannels(t){try{let r=this.dataStreamChannelMap.get(t);return r&&(r.id&&this.recoveredDataChannelIds.push(r.id),r.close()),void this.dataStreamChannelMap.delete(t)}catch(r){throw r instanceof Et?r:new Et(ce.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(r.toString()))}}async stopSending(t,r){let n=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(h=>{var m;LR(this.id+h.mid,this),h.direction="inactive",(m=h.stop)===null||m===void 0||m.call(h)});let o=await this.peerConnection.createOffer(),l=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let u=this.remoteSDP.toString();l?.(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{n&&n()}}async receive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:l}=this.remoteSDP.send(t,r,n,i);l&&(await ov(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP.")));let u=this.peerConnection.getTransceivers().find(h=>h.mid===o);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:o,transceiver:u}}catch(o){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let{mids:r,needExchangeSDP:n}=this.remoteSDP.batchSend(t);return n&&(await ov(this.peerConnection,this.remoteSDP,this.extension),L.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),r.map(i=>{let o=this.peerConnection.getTransceivers().find(l=>l.mid===i);if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:i,transceiver:o}})}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");t.forEach(o=>{Array.from(this.preSSRCMap.entries()).some(l=>{let[u,h]=l;if(h===o)return this.preSSRCMap.delete(u),!0})}),this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);let r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(r.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);let r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(r.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(l=>{l.direction="inactive"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(t);let o=this.remoteSDP.toString();i?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async(l,u)=>{l.direction="sendonly"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(t,this.remoteCodecs,this.store.codec);let o=this.remoteSDP.toString();i?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return ds(function*(){let n=yield Qr(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let i=rn().supportPCSetConfiguration,o=Se("FORCE_TURN_TCP")||r.forceTurn;if(t===pa.RELAY&&!i)return;if(i&&!o){let R=t===pa.RELAY?"relay":"all",A=r.peerConnection.getConfiguration();A.iceTransportPolicy!==R&&(L.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(A.iceTransportPolicy,"] to [").concat(R,"]")),A.iceTransportPolicy=R,r.peerConnection.setConfiguration(A))}r.remoteSDP.updateCandidates(t);let l=yield Qr(r.peerConnection.createOffer({iceRestart:!0}));if(!l.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let u=Zd(l.sdp),{remoteIceParameters:h}=yield u.iceParameters;r.remoteSDP.restartICE(h);let m=r.remoteSDP.toString(),_=r.logSDPExchange(l.sdp||"","offer","local","restartICE");r.store.descriptionStart(),yield Qr(r.peerConnection.setLocalDescription(l)),_?.(m),yield Qr(r.peerConnection.setRemoteDescription({type:"answer",sdp:m}))}catch(i){L.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),i)}finally{n()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;let t=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(pa.TCP_RELAY),await ov(this.peerConnection,this.remoteSDP,this.extension)}catch(r){L.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),r)}finally{t()}}close(){var t;this.peerConnection.getTransceivers().forEach(r=>{LR(this.id+r.mid,this)}),this.preSSRCMap.clear(),this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return Hc(Hc({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let o=this.remoteSDP.toString(),l=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),l?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new Et(ce.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,r){let n=this.peerConnection.getTransceivers().filter(i=>i.mid===t);n.length===1&&(this.isVP8Simulcast(r)?Yn()||await this.applySimulcastEncodings(n,[r]):await this.applySendEncodings(n,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let n=this.peerConnection.getTransceivers().find(i=>i.mid===r);n&&await n.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:n,remote:i}=r.getSelectedCandidatePair();return{local:Hc(Hc({},Pl),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:Hc(Hc({},Pl),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=t=>{if(t&&(t.errorCode||t.errorText)){var r;let n="code: ".concat(t.errorCode,", message: ").concat(t.errorText),i=t.port?"local: ".concat(t.port):"";L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(n,"), url: ").concat(t.url||"",", host_candidate:").concat(i)),(r=this.onICECandidateError)===null||r===void 0||r.call(this,n)}},this.peerConnection.onicegatheringstatechange=t=>{t&&t.target&&"iceGatheringState"in t.target&&L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(t.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Se("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[]};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&(Kg(t.turnServer.servers)?r.iceServers=t.turnServer.servers:Se("NEW_TURN_MODE")&&r.iceServers?(Se("USE_TURN_SERVER_OF_GATEWAY")?t.turnServer.serversFromGateway&&r.iceServers.push(...Qp.newTurnServerConfigToIceServers(t.turnServer.serversFromGateway)):r.iceServers.push(...Qp.newTurnServerConfigToIceServers(t.turnServer.servers)),Se("NEW_FORCE_TURN")&&(r.iceTransportPolicy="relay")):t.turnServer.mode!=="off"&&(r.iceServers&&r.iceServers.push(...Qp.turnServerConfigToIceServers(t.turnServer.servers)),Se("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Qp.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),Se("FORCE_TURN_TCP")?r.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(n=>{n.forceturn&&(r.iceTransportPolicy="relay")}))),Se("ENABLE_ENCODED_TRANSFORM")&&rn().supportWebRTCEncodedTransform&&(r.encodedInsertableStreams=!0),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(n=>{n.security?n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(Xd(n.turnServerURL),":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&!Se("FORCE_TURN_TCP")&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),r}static newTurnServerConfigToIceServers(t){let r=[];return t.forEach(n=>{let i=Se("NEW_TURN_MODE");i===1?r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=udp")}):i===2?r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=tcp")}):i===3?r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(Xd(n.turnServerURL),":443?transport=tcp")}):i===4&&(r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=udp")}),r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":3478?transport=tcp")}),r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(Xd(n.turnServerURL),":443?transport=tcp")}))}),r}tryBindTransportEvents(t){let r=t.transport;if(r){this.transportEventReceiver=t,r.onstatechange=()=>{var i;r!=null&&r.state&&((i=this.onDTLSTransportStateChange)===null||i===void 0||i.call(this,r.state))},r.onerror=i=>{var o;(o=this.onDTLSTransportError)===null||o===void 0||o.call(this,"error"in i?i.error:i)};let n=r.iceTransport;n&&(n.onstatechange=()=>{let i=r?.iceTransport.state;var o;i&&((o=this.onICETransportStateChange)===null||o===void 0||o.call(this,i))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){let{local:i,remote:o}=n.getSelectedCandidatePair();L.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol}),", remote ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var n,i;if(r||(r=this.peerConnection.getSenders().find(V=>V.track===t._mediaStreamTrack)),!r)return L.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return L.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!rn().supportSetRtpSenderParameters)return L.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let o={},l={};switch(t._optimizationMode){case"motion":o.degradationPreference="maintain-framerate";break;case"detail":o.degradationPreference="maintain-resolution";break;case"balanced":o.degradationPreference="balanced"}let u=function(V,K){return V.getTransceivers().find(se=>se.sender.track===K||se.receiver.track===K)}(this.peerConnection,t._mediaStreamTrack),h=mF(t);if(OG(t)&&u&&r&&h&&this.getLocalVideoStats&&Qt(n=["vp8","vp9"]).call(n,this.store.codec)){var m;let V=o.degradationPreference||(Qt(m=t._hints).call(m,Nn.CUSTOM_TRACK)?Se("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(K,se,ue,De,ze,Ke){if(LR(K,ue),ze(se),De!=="balanced"&&De!=="maintain-framerate"&&De!=="maintain-resolution")return;let Ve=-1;ZM(K,se);let _t=window.setInterval(()=>{let ar=PR.get(K);if(!Se("ENABLE_AG_ADAPTATION")||!ar)return LR(K,ue),void ze(se);let ur=Ke();if(ur.sendPackets>0&&ur.OutgoingAvailableBandwidth>0){if(Ve===-1)return void(Ve=Date.now());if(Date.now()-Ve<1e3)return;let Kr=ur.sendFrameRate,zr=ur.OutgoingAvailableBandwidth,[wn,si]=bG(K,Kr,zr,ar.adaptationConfig,se,De);si&&(ue.qualityLimitationReason=si),wn&&ar.adaptationConfig.scale!==wn.scale&&(L.debug("[".concat(K,"] applyAdaptation: ").concat(ue.qualityLimitationReason,`
           sendFps `).concat(Kr,", bwe ").concat(zr,", switch from ").concat(ar.adaptationConfig.scale," to ").concat(wn.scale," ")),ar.adaptationConfig=fb(fb({},ar.adaptationConfig),wn),ze(wn))}},Se("CHECK_LOCAL_STATS_INTERVAL")),Vt=fb({},se);PR.set(K,{timer:_t,adaptationConfig:Vt,originConfig:se,adaptationFunc:ze}),L.debug("[".concat(K,"] start adaptation, originConfig: ").concat(JSON.stringify(se),", degradationPreference: ").concat(De))})(this.id+u.mid,h,this,V,K=>{r&&this.updateAdaptation(r,K)},this.getLocalVideoStats.bind(this))}if(t._encoderConfig){var _;let{bitrateMax:V,frameRate:K,scaleResolutionDownBy:se}=t._encoderConfig;V&&(l.maxBitrate=1e3*V),(Qt(_=t._hints).call(_,Nn.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(K&&(l.maxFramerate=yo(K)),se&&se>=1&&(l.scaleResolutionDownBy=se))}let{maxFramerate:R}=Se("ENCODER_CONFIG_LIMIT");if(R&&typeof R=="number"&&(l.maxFramerate=l.maxFramerate?Math.min(l.maxFramerate,R):R),Se("DSCP_TYPE")&&wu()){var A;let V=Se("DSCP_TYPE");Qt(A=["very-low","low","medium","high"]).call(A,V)&&(l.networkPriority=V)}let D=r.getParameters(),J=(i=D.encodings)===null||i===void 0?void 0:i[0];Yn()&&!J&&(o.encodings=[l]),J&&Object.assign(J,l),Object.assign(D,o),L.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(D.encodings))),await r.setParameters(D),await async function(V,K,se){try{var ue;if(!rn().supportSetRtpSenderParameters||!function(_t){return _t==="vp9"||_t==="av1"}(V)||!Se("ENABLE_SVC"))return;let De={},ze={},Ke=K.getParameters(),Ve=(ue=Ke.encodings)===null||ue===void 0?void 0:ue[0];ze.scalabilityMode=SR(se),Ve&&Object.assign(Ve,ze),Object.assign(Ke,De),await K.setParameters(Ke),L.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(Ke.encodings)))}catch(De){L.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",De)}}(this.store.codec,r,Se("SVC_MODE"))}async updateAdaptation(t,r){var n,i;if(!t)return L.debug("[updateAdaptation] no rtpSender found");if(!rn().supportSetRtpSenderParameters)return L.debug("[updateAdaptation] Browser not support set rtp-sender parameters");let o={},{bitrateMax:l,frameRate:u,scaleResolutionDownBy:h}=r;l&&(o.maxBitrate=1e3*l),u&&(o.maxFramerate=yo(u)),h&&h>=1&&Qt(n=["vp8","vp9"]).call(n,this.store.codec)&&(o.scaleResolutionDownBy=h);let m=t.getParameters(),_=(i=m.encodings)===null||i===void 0?void 0:i[0];_&&Object.assign(_,o),Object.assign(m,{});try{await t.setParameters(m),L.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(m.encodings)))}catch(R){!("transport"in t)||t.transport&&t.transport.state==="connected"?this.peerConnectionState!=="connected"?L.debug("[updateAdaptation] peerConnection not connected}"):L.debug("[updateAdaptation] updateRtpSenderEncodings failed",R):L.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(t,r){try{if(!rn().supportSetRtpSenderParameters||t.length!==r.length)return;for(let n=0;n<t.length;n++){let i=t[n],o=r[n];o instanceof xn&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,i.sender)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,n){let i=ao(t);return r.forEach((o,l)=>{let u=n[l],h=i.mediaDescriptions.find(m=>m.attributes.mid===u);h&&(vE(h,o),vM(h,o,this.store.codec))}),zd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let h=0;h<t.length;h++){var n,i,o,l,u;let m=t[h],_=r[h];if(_ instanceof xn&&!Qt(n=_._hints).call(n,Nn.LOW_STREAM)&&(i=_._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=_._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(l=_._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=_._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){let R={},A={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];let D=m.sender.getParameters();await m.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(t,r){if(!Yn()&&t.length===r.length)for(let n=0;n<t.length;n++){let i=r[n];if(i instanceof xn&&this.isVP8Simulcast(i)){let o=t[n],l={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];let h=o.sender.getParameters();await o.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(t){var r,n,i,o,l;return!!(t instanceof xn&&Se("SIMULCAST")&&this.store.codec==="vp8"&&!Qt(r=t._hints).call(r,Nn.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,r,n,i){if(Se("SDP_LOGGING"))return L.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(r," SDP during P2PConnection.").concat(i,`
`),t),r==="offer"?o=>{this.logSDPExchange(o,"answer",n==="local"?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;let r=this.remoteSDP.getSSRC(t);return r&&r.length!==0?r[0].ssrcId:void 0}setConfiguration(t){if(rn().supportPCSetConfiguration){let r=Qp.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},_r(Jr.prototype,"updateRemoteRTPCapabilities",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"updateRemoteRTPCapabilities"),Jr.prototype),_r(Jr.prototype,"connect",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"connect"),Jr.prototype),_r(Jr.prototype,"updateRemoteConnect",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"updateRemoteConnect"),Jr.prototype),_r(Jr.prototype,"createDataChannels",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"createDataChannels"),Jr.prototype),_r(Jr.prototype,"receive",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"receive"),Jr.prototype),_r(Jr.prototype,"batchReceive",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"batchReceive"),Jr.prototype),_r(Jr.prototype,"stopReceiving",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"stopReceiving"),Jr.prototype),_r(Jr.prototype,"muteRemote",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"muteRemote"),Jr.prototype),_r(Jr.prototype,"unmuteRemote",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"unmuteRemote"),Jr.prototype),_r(Jr.prototype,"muteLocal",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"muteLocal"),Jr.prototype),_r(Jr.prototype,"unmuteLocal",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"unmuteLocal"),Jr.prototype),_r(Jr.prototype,"close",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"close"),Jr.prototype),_r(Jr.prototype,"updateEncoderConfig",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"updateEncoderConfig"),Jr.prototype),_r(Jr.prototype,"updateSendParameters",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"updateSendParameters"),Jr.prototype),_r(Jr.prototype,"replaceTrack",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"replaceTrack"),Jr.prototype),_r(Jr.prototype,"updateAdaptation",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"updateAdaptation"),Jr.prototype),_r(Jr.prototype,"getRemoteSSRC",[Ka],Object.getOwnPropertyDescriptor(Jr.prototype,"getRemoteSSRC"),Jr.prototype),Jr);function Ka(e,t,r){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let i=this.mutex,o=await i.lock("From P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await n.apply(this,u)}finally{o()}},r}function gb(e,t){let r=document.createElement("video"),n=document.createElement("canvas");r.setAttribute("style","display:none"),n.setAttribute("style","display:none"),r.setAttribute("muted",""),r.muted=!0,r.setAttribute("autoplay",""),r.autoplay=!0,r.setAttribute("playsinline",""),n.width=yo(t.width),n.height=yo(t.height);let i=yo(t.framerate||15);document.body.append(r),document.body.append(n);let o=e._mediaStreamTrack;r.srcObject=new MediaStream([o]),r.play();let l=n.getContext("2d");if(!l)throw new at(ce.UNEXPECTED_ERROR,"can not get canvas context");let u=rn(),h=n.captureStream(u.supportRequestFrame?0:i).getVideoTracks()[0];h.canvas||(h.canvas=n),n.startCapture=()=>{if(!r)return n.stopCapture&&n.stopCapture();if(r.paused&&r.play(),r.videoHeight>2&&r.videoWidth>2){let _=r.videoWidth,R=r.videoHeight/_,A=n.width*R;Math.abs(A-n.height)>=2&&(L.debug("adjust low stream resolution","".concat(n.width,"x").concat(n.height," -> ").concat(n.width,"x").concat(A)),n.height=A)}l.drawImage(r,0,0,n.width,n.height),h.requestFrame&&h.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,r.srcObject=new MediaStream([o]))},n.stopCapture=NA(()=>n.startCapture&&n.startCapture(),i);let m=h.stop;return h.stop=()=>{m.call(h),r&&(r.remove(),r.srcObject=null,r=null),n&&(n.width=0,n.remove(),n.stopCapture&&n.stopCapture(),n.startCapture=void 0,n.stopCapture=void 0,n=null),L.debug("clean low stream renderer")},h}var MR=function(e){return e[e.HEIGHT=2033]="HEIGHT",e[e.FRAME_RATE=2034]="FRAME_RATE",e[e.WIDTH=2035]="WIDTH",e}(MR||{}),mi=function(e){return e[e.FRAME_RATE=2002]="FRAME_RATE",e[e.WIDTH=2003]="WIDTH",e[e.HEIGHT=2004]="HEIGHT",e[e.PACKAGE_LOST=2005]="PACKAGE_LOST",e[e.AVG_ENCODE=2007]="AVG_ENCODE",e[e.NACKS=2009]="NACKS",e[e.PLIS=2010]="PLIS",e[e.FIRS=2011]="FIRS",e[e.BITRATE=2012]="BITRATE",e[e.PACKAGE_RATE=2031]="PACKAGE_RATE",e[e.ADAPTATION=2032]="ADAPTATION",e[e.ACTUAL_ENCODED=2060]="ACTUAL_ENCODED",e[e.BANDWIDTH=2061]="BANDWIDTH",e[e.RETRANSMIT=2062]="RETRANSMIT",e[e.TARGET_ENCODED=2064]="TARGET_ENCODED",e[e.TRANSMIT=2066]="TRANSMIT",e[e.FREEZE=2082]="FREEZE",e[e.DISABLED=2095]="DISABLED",e[e.PLAYER_STATUS=2128]="PLAYER_STATUS",e[e.QP_SUM=2143]="QP_SUM",e[e.BYTES_RETRANSMIT=2173]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2172]="PACKAGES_RETRANSMIT",e[e.HUGE_FRAME_SENT=2174]="HUGE_FRAME_SENT",e[e.KEY_FRAMES_ENCODED=2207]="KEY_FRAMES_ENCODED",e}(mi||{}),xp=function(e){return e[e.BITRATE=2069]="BITRATE",e[e.PACKAGE_LOST=2070]="PACKAGE_LOST",e[e.PACKAGE_RATE=2071]="PACKAGE_RATE",e[e.HEIGHT=2073]="HEIGHT",e[e.FRAME_RATE=2075]="FRAME_RATE",e[e.WIDTH=2077]="WIDTH",e}(xp||{}),Ei=function(e){return e[e.JITTER=-1]="JITTER",e[e.PACKAGE_LOST=2014]="PACKAGE_LOST",e[e.WIDTH=2018]="WIDTH",e[e.HEIGHT=2019]="HEIGHT",e[e.FRAME_RATE=2020]="FRAME_RATE",e[e.JITTER_BUFFER=2023]="JITTER_BUFFER",e[e.CURRENT_DELAY=2024]="CURRENT_DELAY",e[e.NACKS=2026]="NACKS",e[e.PLIS=2027]="PLIS",e[e.FIRS=2028]="FIRS",e[e.BITRATE=2029]="BITRATE",e[e.PACKAGE_RATE=2078]="PACKAGE_RATE",e[e.FREEZE=2084]="FREEZE",e[e.DISABLED=2101]="DISABLED",e[e.PLAYER_STATUS=2129]="PLAYER_STATUS",e[e.QP_SUM=2144]="QP_SUM",e[e.I_FRAME_DELAY=2149]="I_FRAME_DELAY",e[e.FRAMES_DROPPED=2181]="FRAMES_DROPPED",e[e.BYTES_RETRANSMIT=2175]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2176]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2198]="PACKAGES_DISCARDED",e[e.AVG_DECODE=2200]="AVG_DECODE",e[e.AVG_PROCESSING_DELAY=2202]="AVG_PROCESSING_DELAY",e[e.AVG_ASSEMBLY_TIME=2203]="AVG_ASSEMBLY_TIME",e[e.AVG_INTER_FRAME_DELAY=2204]="AVG_INTER_FRAME_DELAY",e[e.KEY_FRAMES_DECODED=2206]="KEY_FRAMES_DECODED",e}(Ei||{}),jp=function(e){return e[e.FRAME_RATE_DECODE=2021]="FRAME_RATE_DECODE",e[e.FRAME_RATE_RENDER=2022]="FRAME_RATE_RENDER",e[e.FRAME_RATE_OUTPUT=2155]="FRAME_RATE_OUTPUT",e[e.FREEZE_TIME=2109]="FREEZE_TIME",e[e.FREEZE_TIME_RENDER=2147]="FREEZE_TIME_RENDER",e[e.FREEZE_DURATION=2156]="FREEZE_DURATION",e}(jp||{}),r2=function(e){return e[e.PCM_LEVEL=2104]="PCM_LEVEL",e}(r2||{}),Bl=function(e){return e[e.PACKAGE_LOST=-1]="PACKAGE_LOST",e[e.LEVEL=2038]="LEVEL",e[e.BITRATE=2039]="BITRATE",e[e.PACKAGE_RATE=2040]="PACKAGE_RATE",e[e.AEC_RETURN_LOSS=2041]="AEC_RETURN_LOSS",e[e.AEC_RETURN_LOSS_ENH=2042]="AEC_RETURN_LOSS_ENH",e[e.FREEZE=2081]="FREEZE",e[e.DISABLED=2096]="DISABLED",e[e.BYTES_RETRANSMIT=2179]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2180]="PACKAGES_RETRANSMIT",e}(Bl||{}),za=function(e){return e[e.BITRATE=2044]="BITRATE",e[e.PACKAGE_LOST=2045]="PACKAGE_LOST",e[e.PACKAGE_RATE=2046]="PACKAGE_RATE",e[e.CURRENT_DELAY=2047]="CURRENT_DELAY",e[e.JITTER_BUFFER=2054]="JITTER_BUFFER",e[e.JITTER=2055]="JITTER",e[e.FREEZE=2083]="FREEZE",e[e.DISABLED=2102]="DISABLED",e[e.PCM_LEVEL=2105]="PCM_LEVEL",e[e.PLAYER_STATUS=2130]="PLAYER_STATUS",e[e.CONCEALED_SAMPLES=2148]="CONCEALED_SAMPLES",e[e.BYTES_RETRANSMIT=2178]="BYTES_RETRANSMIT",e[e.PACKAGES_RETRANSMIT=2177]="PACKAGES_RETRANSMIT",e[e.PACKAGES_DISCARDED=2199]="PACKAGES_DISCARDED",e[e.AVG_PROCESSING_DELAY=2201]="AVG_PROCESSING_DELAY",e[e.TOTAL_SAMPLES_RECEIVED=2224]="TOTAL_SAMPLES_RECEIVED",e}(za||{}),n2=function(e){return e[e.FREEZE_TIME=-1]="FREEZE_TIME",e[e.LEVEL=2043]="LEVEL",e}(n2||{}),qa=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(qa||{}),UR=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(UR||{});let Bp=1e3,Vp=6,xR=3,DG=Math.max(Vp,xR);function wr(e,t,r){r!=null&&Number.isFinite(r)&&(e[t]=Math.round(Math.max(0,r)))}function i2(e){let t={[qa.CONN_TYPE]:0,[qa.RTT]:e.rtt,[qa.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{let r=e.selectedCandidatePair.localCandidate.relayProtocol;r==="udp"&&(t[qa.CONN_TYPE]=1),r==="tcp"&&(t[qa.CONN_TYPE]=3),r==="tls"&&(t[qa.CONN_TYPE]=4);break}case"srflx":t[qa.CONN_TYPE]=2;break;case"unknown":t[qa.CONN_TYPE]=5;break;default:t[qa.CONN_TYPE]=0}return t}function a2(e){let t=0;switch(e){case"none":t=0;break;case"cpu":t=1;break;case"bandwidth":t=2;break;case"other":t=3}return t}class o2 extends zn{constructor(t){super(),ie(this,"store",void 0),ie(this,"uploadWRTCStatsTimer",void 0),ie(this,"uploadOutboundDenoiserStatsTimer",void 0),ie(this,"uploadExtStatsTimer",void 0),ie(this,"uploadExtUsageStatsTimer",void 0),ie(this,"uploadInboundExtStatsTimer",void 0),ie(this,"requestStats",void 0),ie(this,"requestTransportStats",void 0),ie(this,"requestLocalMedia",void 0),ie(this,"requestRemoteMedia",void 0),ie(this,"requestAllTracks",void 0),ie(this,"requestVideoIsReady",void 0),ie(this,"requestUploadStats",void 0),ie(this,"requestUpload",void 0),ie(this,"uploadOutboundStarted",!1),ie(this,"uploadInboundStarted",!1),ie(this,"uploadTransportStarted",!1),ie(this,"uploadBaseStatsStarted",!1),ie(this,"uploadExtensionUsageStarted",!1),ie(this,"lastRecvStats",void 0),ie(this,"lastSendStats",void 0),ie(this,"lastRefRecvStats",void 0),ie(this,"lastRefSendStats",void 0),ie(this,"lastFullRecvStats",void 0),ie(this,"lastFullSendStats",void 0),ie(this,"needUploadRenderFreezeTime",!0),this.store=t}uploadWRTCStats(t){if(!this.requestStats||!this.requestUploadStats)return;let r=t%xR==0,n=t%Vp==0,i,o;if(this.uploadTransportStarted&&(i=this.requestStats(),this.store.useP2P&&(o=this.requestStats(!0))),!i&&this.uploadOutboundStarted&&(i=this.requestStats()),!o&&this.uploadInboundStarted&&(o=this.requestStats(!0)),i||o){var l;let u={};if(this.uploadTransportStarted&&i){let m=this.getTransportStats(i,o,r);m&&(u.misc=[m])}if(this.uploadOutboundStarted&&i){let m=this.getOutboundStats(i,n?this.lastFullSendStats:r?this.lastRefSendStats:this.lastSendStats,r,n);m&&(u.outbound=[m])}if(this.uploadInboundStarted&&o){let m=this.getInboundStats(o,n?this.lastFullRecvStats:r?this.lastRefRecvStats:this.lastRecvStats,r,n);m&&(u.inbound=m)}let h=(l=this.requestTransportStats)===null||l===void 0?void 0:l.call(this).connectState;h&&(Array.isArray(u.misc)?u.misc[0]&&u.misc[0].addition&&(u.misc[0].addition[UR.RTC_PEER_CONNECTION_STATE]=fA[h]):u.misc=[{addition:{[UR.RTC_PEER_CONNECTION_STATE]:fA[h]}}]),this.requestUploadStats(u)}this.lastRecvStats=o,this.lastSendStats=i,n&&(this.lastFullRecvStats=o,this.lastFullSendStats=i),r&&(this.lastRefRecvStats=o,this.lastRefSendStats=i)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let t=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var r,n;let i=(r=this.requestTransportStats)===null||r===void 0?void 0:r.call(this);return void(i&&((n=this.requestUploadStats)===null||n===void 0||n.call(this,{misc:[{addition:{[UR.RTC_PEER_CONNECTION_STATE]:fA[i.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(t),++t===DG+1&&(t=1)},Bp)}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0)}getTransportStats(t,r,n){if(!this.requestStats)return;if(!n)return t.rtt==null?void 0:{addition:{[qa.RTT]:t.rtt,[qa.CONN_TYPE]:void 0,[qa.STATS_UPDATE_INTERVAL]:t.updateInterval||void 0}};let i=i2(t);if(this.store.useP2P){if(r){let o=i2(r);i[qa.CONN_TYPE]+=o[qa.CONN_TYPE]<<3}i[qa.CONN_TYPE]+=110}else i[qa.CONN_TYPE]+=100;return{addition:i}}getOutboundStats(t,r,n,i){if(!this.requestUploadStats||!this.requestLocalMedia)return;let o=this.requestLocalMedia();if(!o||o.length===0)return;let l,u,h;return o.forEach(m=>{let[_,{track:R,ssrcs:A}]=m;switch(_){case Mt.LocalVideoLowTrack:case Mt.LocalVideoTrack:if(_===Mt.LocalVideoTrack){let D=function(K,se,ue,De,ze,Ke){let Ve=se.videoSend.find(ur=>ur.ssrc===K);if(!Ve)return;let _t={},{sentFrame:Vt,inputFrame:ar}=Ve;if(Ke&&(wr(_t,mi.QP_SUM,Ve.qpSumPerFrame),ar&&Vt)){let ur=ar.frameRate,Kr=Vt.frameRate;_t[mi.FREEZE]=function(zr,wn){let si=!0;return si=!(zr<=5)&&(zr<=10?wn<3:zr<=20?wn<4:wn<5),si}(ur,Kr)?1:0}if(ze){switch(Vt&&(wr(_t,mi.HEIGHT,Vt.height),wr(_t,mi.WIDTH,Vt.width),wr(_t,mi.FRAME_RATE,Vt.frameRate)),_t[mi.DISABLED]=De._originMediaStreamTrack&&!De._originMediaStreamTrack.enabled||De._mediaStreamTrack&&!De._mediaStreamTrack.enabled?1:0,Ve.adaptionChangeReason){case"none":_t[mi.ADAPTATION]=0;break;case"cpu":_t[mi.ADAPTATION]=1;break;case"bandwidth":_t[mi.ADAPTATION]=2;break;case"other":_t[mi.ADAPTATION]=3}let ur=0;Ve.adaptionChangeReason&&(ur+=a2(Ve.adaptionChangeReason)),se.qualityLimitationReason&&(ur+=a2(se.qualityLimitationReason)<<3),_t[mi.ADAPTATION]=ur,_t[mi.PLAYER_STATUS]=bA[De._player?De._player.videoElementStatus:"uninit"],wr(_t,mi.NACKS,Ve.nacksCount),wr(_t,mi.PLIS,Ve.plisCount),wr(_t,mi.FIRS,Ve.firsCount),wr(_t,mi.AVG_ENCODE,Ve.avgEncodeMs),wr(_t,mi.HUGE_FRAME_SENT,Ve.hugeFramesSent),wr(_t,mi.BYTES_RETRANSMIT,Ve.retransmittedBytesSent),wr(_t,mi.PACKAGES_RETRANSMIT,Ve.retransmittedPacketsSent),wr(_t,mi.KEY_FRAMES_ENCODED,Ve.keyFramesEncoded);let Kr=ue&&ue.videoSend.find(zr=>zr.ssrc===K);if(Kr){let zr=ze?Bp:Bp*Vp;Kr.timestamp&&Ve.timestamp&&(zr=Ve.timestamp-Kr.timestamp),Kr.packets!=null&&Ve.packets!=null&&wr(_t,mi.PACKAGE_RATE,1e3*(Ve.packets-Kr.packets)/zr),Ve.packetsLost!=null&&Kr.packetsLost!=null&&wr(_t,mi.PACKAGE_LOST,Ve.packetsLost-Kr.packetsLost),Kr.bytes!=null&&Ve.bytes!=null&&wr(_t,mi.BITRATE,8*(Ve.bytes-Kr.bytes)/zr)}}return _t}(A[0].ssrcId,t,r,R,n,i),J=R&&function(K,se,ue,De){let ze=se.videoSend.find(Ve=>Ve.ssrc===K);if(!ze)return null;let Ke={};if(De){let Ve=ze.inputFrame,_t=Ve&&Ve.height||ue.videoHeight||0,Vt=Ve&&Ve.width||ue.videoWidth||0,ar=Ve&&Ve.frameRate||0;wr(Ke,MR.HEIGHT,_t),wr(Ke,MR.WIDTH,Vt),wr(Ke,MR.FRAME_RATE,ar)}return Ke}(A[0].ssrcId,t,R,n),V=function(K,se){let ue={};return se&&(wr(ue,mi.RETRANSMIT,K.bitrate.retransmit),wr(ue,mi.TARGET_ENCODED,K.bitrate.targetEncoded),wr(ue,mi.ACTUAL_ENCODED,K.bitrate.actualEncoded),wr(ue,mi.TRANSMIT,K.bitrate.transmit),wr(ue,mi.BANDWIDTH,K.sendBandwidth)),ue}(t,n);u=Object.assign({},D,J,V)}else h=function(D,J,V,K){let se=J.videoSend.find(De=>De.ssrc===D);if(!se)return;let ue={};if(K){let De=se.sentFrame;if(De&&(wr(ue,xp.HEIGHT,De.height),wr(ue,xp.WIDTH,De.width),wr(ue,xp.FRAME_RATE,De.frameRate)),V){let ze=V.videoSend.find(Ke=>Ke.ssrc===D);if(ze){let Ke=Bp*Vp;ze.timestamp&&se.timestamp&&(Ke=se.timestamp-ze.timestamp),ze.packets!=null&&se.packets!=null&&wr(ue,xp.PACKAGE_RATE,1e3*(se.packets-ze.packets)/Ke),se.packetsLost!=null&&ze.packetsLost!=null&&wr(ue,xp.PACKAGE_LOST,se.packetsLost-ze.packetsLost),ze.bytes!=null&&se.bytes!=null&&wr(ue,xp.BITRATE,8*(se.bytes-ze.bytes)/Ke)}}}return ue}(A[0].ssrcId,t,r,n);break;case Mt.LocalAudioTrack:l=R&&function(D,J,V,K,se){let ue=J.audioSend.find(ze=>ze.ssrc===D);if(!ue)return;let De={};if(se){De[Bl.DISABLED]=K._originMediaStreamTrack&&!K._originMediaStreamTrack.enabled||K._mediaStreamTrack&&!K._mediaStreamTrack.enabled?1:0;let ze=100*K._source.getAccurateVolumeLevel(),Ke=ue.inputLevel;if(Ke!=null){let _t=Math.ceil(50*Math.log10(100*Ke+1));wr(De,Bl.LEVEL,_t)}wr(De,r2.PCM_LEVEL,ze),wr(De,Bl.AEC_RETURN_LOSS,ue.aecReturnLoss),wr(De,Bl.AEC_RETURN_LOSS_ENH,ue.aecReturnLossEnhancement),wr(De,Bl.BYTES_RETRANSMIT,ue.retransmittedBytesSent),wr(De,Bl.PACKAGES_RETRANSMIT,ue.retransmittedPacketsSent),De[Bl.FREEZE]=0;let Ve=V&&V.audioSend.find(_t=>_t.ssrc===D);if(Ve){let _t=Bp*Vp;Ve.timestamp&&ue.timestamp&&(_t=ue.timestamp-Ve.timestamp),Ve.bytes!=null&&ue.bytes!=null&&wr(De,Bl.BITRATE,8*(ue.bytes-Ve.bytes)/_t),Ve.packets!=null&&ue.packets!=null&&wr(De,Bl.PACKAGE_RATE,1e3*(ue.packets-Ve.packets)/_t)}}return De}(A[0].ssrcId,t,r,R,n)}}),{high:u,low:h,audio:l}}getInboundStats(t,r,n,i){if(!this.requestRemoteMedia)return;let o=this.requestRemoteMedia()||[],l=[];return o.forEach(u=>{let[h,m]=u,_={peer:h.uid};if(m.has(lr.VIDEO)&&h.videoTrack){let R=h._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(h._videoSSRC)||!1,A=h.videoTrack?function(D,J,V,K,se,ue,De,ze){let Ke=J.videoRecv.find(zr=>zr.ssrc===D);if(!Ke)return;let Ve={},{receivedFrame:_t,outputFrame:Vt,decodeFrameRate:ar}=Ke,ur=V&&V.videoRecv.find(zr=>zr.ssrc===D);if(wr(Ve,jp.FRAME_RATE_DECODE,ar),Ke.framesRateFirefox&&wr(Ve,Ei.FRAME_RATE,Ke.framesRateFirefox),_t&&wr(Ve,Ei.FRAME_RATE,_t.frameRate),wr(Ve,Ei.FRAMES_DROPPED,Ke.framesDroppedCount),wr(Ve,Ei.BYTES_RETRANSMIT,Ke.retransmittedBytesReceived),wr(Ve,Ei.PACKAGES_RETRANSMIT,Ke.retransmittedPacketsReceived),wr(Ve,Ei.PACKAGES_DISCARDED,Ke.packetsDiscarded),wr(Ve,Ei.AVG_DECODE,Ke.avgDecodeMs),wr(Ve,Ei.AVG_PROCESSING_DELAY,Ke.avgProcessingDelayMs),wr(Ve,Ei.AVG_ASSEMBLY_TIME,Ke.avgFramesAssembledFromMultiplePacketsMs),wr(Ve,Ei.AVG_INTER_FRAME_DELAY,Ke.avgInterFrameDelayMs),wr(Ve,Ei.KEY_FRAMES_DECODED,Ke.keyFramesDecoded),ur){let zr=J.timestamp-V.timestamp||Bp*(ze?Vp:De?xR:1);Ke.packetsLost!=null&&ur.packetsLost!=null&&wr(Ve,Ei.PACKAGE_LOST,Ke.packetsLost-ur.packetsLost),ur.bytes!=null&&Ke.bytes!=null&&wr(Ve,Ei.BITRATE,8*(Ke.bytes-ur.bytes)/zr),ur.packets!=null&&Ke.packets!=null&&wr(Ve,Ei.PACKAGE_RATE,1e3*(Ke.packets-ur.packets)/zr)}if(ze&&(wr(Ve,Ei.QP_SUM,Ke.qpSumPerFrame),Ve[Ei.FREEZE]=se&&lv.isRemoteVideoFreeze(K,Ke,ur)?1:0),De){var Kr;_t?(wr(Ve,Ei.HEIGHT,_t.height),wr(Ve,Ei.WIDTH,_t.width)):K&&(wr(Ve,Ei.HEIGHT,K._videoHeight||0),wr(Ve,Ei.WIDTH,K._videoWidth||0)),Vt&&wr(Ve,jp.FRAME_RATE_OUTPUT,Vt.frameRate);let zr=(Kr=K._player)===null||Kr===void 0?void 0:Kr.rendFrameRate.toFixed(0);if(zr&&wr(Ve,jp.FRAME_RATE_RENDER,+zr),wr(Ve,Ei.JITTER_BUFFER,Ke.jitterBufferMs),wr(Ve,Ei.CURRENT_DELAY,Ke.currentDelayMs),wr(Ve,Ei.FIRS,Ke.firsCount),wr(Ve,Ei.NACKS,Ke.nacksCount),wr(Ve,Ei.PLIS,Ke.plisCount),K){Ve[Ei.DISABLED]=K._originMediaStreamTrack.enabled&&K._mediaStreamTrack.enabled?0:1;let wn=K._player;if(wn){let{freezeTimeCounterList:si,renderFreezeAccTime:ti,videoElementStatus:Xa}=wn;if(si&&si.length>0&&wr(Ve,jp.FREEZE_TIME,si.splice(0,1)[0]),ue&&Lu.visibility==="visible"&&Xa===Aa.PLAYING&&rn().supportRequestVideoFrameCallback){let Rt=Math.min(6e3,ti);wn.renderFreezeAccTime=Math.max(0,ti-Rt),wr(Ve,jp.FREEZE_TIME_RENDER,Rt)}if(typeof Ke.totalFreezesDuration=="number"){let Rt=ur&&ur.totalFreezesDuration?Ke.totalFreezesDuration-ur.totalFreezesDuration:Ke.totalFreezesDuration;wr(Ve,jp.FREEZE_DURATION,1e3*Rt)}}}if(Ve[Ei.PLAYER_STATUS]=bA[K._player?K._player.videoElementStatus:"uninit"],ur&&Ke.totalInterFrameDelay!==void 0&&Ke.totalSquaredInterFrameDelay!==void 0&&ur.totalInterFrameDelay!==void 0&&ur.totalSquaredInterFrameDelay!==void 0){let wn=Ke.totalInterFrameDelay-ur.totalInterFrameDelay,si=Ke.totalSquaredInterFrameDelay-ur.totalSquaredInterFrameDelay,ti=Ke.framesDecodeCount-ur.framesDecodeCount,Xa=wn/ti*1e3,Rt=Math.round(1e3*Math.sqrt((si-Math.pow(wn,2)/ti)/ti));!isNaN(Rt)&&Xa+Rt>Math.max(3*Xa,Xa+150)&&(Ve[Ei.I_FRAME_DELAY]=Rt)}}return Ve}(h._videoSSRC,t,r,h.videoTrack,R===!0,this.needUploadRenderFreezeTime,n,i):void 0;A&&(_.video=A)}if(m.has(lr.AUDIO)&&h.audioTrack){let R=h.audioTrack?function(A,D,J,V,K,se){let ue=D.audioRecv.find(Ve=>Ve.ssrc===A);if(!ue)return;let De={},ze=J&&J.audioRecv.find(Ve=>Ve.ssrc===A);if(wr(De,za.JITTER,ue.jitterMs),wr(De,za.BYTES_RETRANSMIT,ue.retransmittedBytesReceived),wr(De,za.PACKAGES_RETRANSMIT,ue.retransmittedPacketsReceived),wr(De,za.PACKAGES_DISCARDED,ue.packetsDiscarded),wr(De,za.AVG_PROCESSING_DELAY,ue.avgProcessingDelayMs),ze){let Ve=D.timestamp-J.timestamp||Bp*(se?Vp:K?xR:1);ue.packets!=null&&ze.packets!=null&&wr(De,za.PACKAGE_RATE,1e3*(ue.packets-ze.packets)/Ve),K&&ze.bytes!=null&&ue.bytes!=null&&wr(De,za.BITRATE,8*(ue.bytes-ze.bytes)/Ve),ue.packetsLost!=null&&ze.packetsLost!=null&&wr(De,za.PACKAGE_LOST,ue.packetsLost-ze.packetsLost)}if(se){let{receivedFrames:Ve,droppedFrames:_t}=ue;Ve!=null&&_t!=null&&(De[za.FREEZE]=(Ke=Ve)===0||100*_t/Ke>20?1:0)}var Ke;if(K){let Ve=100*V._source.getAccurateVolumeLevel(),_t=ue.outputLevel;if(_t!=null){let Vt=Math.ceil(50*Math.log10(100*_t+1));wr(De,n2.LEVEL,Vt)}if(wr(De,za.PCM_LEVEL,Ve),V&&(De[za.DISABLED]=V._originMediaStreamTrack.enabled&&V._mediaStreamTrack.enabled?0:1),wr(De,za.JITTER_BUFFER,ue.jitterBufferMs),wr(De,za.CURRENT_DELAY,ue.jitterBufferMs),De[za.PLAYER_STATUS]=bA[Wa.getPlayerState(V.getTrackId())],ze){let Vt=ue.concealedSamples-ze.concealedSamples;Vt>0&&wr(De,za.CONCEALED_SAMPLES,Vt);let ar=ue.totalSamplesReceived-ze.totalSamplesReceived;ar>0&&wr(De,za.TOTAL_SAMPLES_RECEIVED,ar)}}return De}(h._audioSSRC,t,r,h.audioTrack,n,i):void 0;R&&(_.audio=R)}(_.video||_.audio)&&l.push(_)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,l}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;let t=(this.requestAllTracks()||[]).find(r=>r instanceof oR);if(t&&t._external.getDenoiserStats){let r=t._external.getDenoiserStats();r&&this.requestUpload($g.DENOISER_STATS,r)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(t=>{t.getProcessorStats().forEach(r=>{this.requestUpload&&this.requestUpload(r.type,r.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(t=>{let[r,n]=t;n.has(lr.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)}),n.has(lr.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);let t=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{let r=Date.now(),n={connectionInterval:Se("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r},i=[],o=this.requestAllTracks&&this.requestAllTracks()||[];for(let m of o)!m.muted&&m.enabled&&(i=i.concat(await m.getProcessorUsage()));let l=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(let[m,_]of l)_.has(lr.VIDEO)&&m.videoTrack&&(i=i.concat(await m.videoTrack.getProcessorUsage())),_.has(lr.AUDIO)&&m.audioTrack&&(i=i.concat(await m.audioTrack.getProcessorUsage()));if(i.length===0)return;n.details=function(m,_){let R={};for(let{id:V,value:K,level:se,direction:ue}of m){var A;let De=(A=_.get(V))!==null&&A!==void 0?A:0,ze=K===2?De+Se("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:De;var D,J;_.set(V,ze),R[V]?(K===2&&(R[V].value=K),se>R[V].level&&(R[V].level=se),ue==="remote"&&(R[V].remoteUidCount+=1),R[V].totalTs=(D=_.get(V))!==null&&D!==void 0?D:0):R[V]={value:K,level:se,remoteUidCount:ue==="local"?0:1,totalTs:(J=_.get(V))!==null&&J!==void 0?J:0}}return Object.keys(R).map(V=>{let{level:K,value:se,totalTs:ue}=R[V];return{id:V,level:K,value:se,totalTs:ue}})}(i,t);let u=Date.now(),h=u>r?u:r+1;this.requestUpload&&this.requestUpload($g.EXTENSION_USAGE_STATS,{usageStats:n,sendTs:h})},Se("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}let PG=Se("ICE_RESTART_INTERVAL"),jR=new Map,CE=new Map,eh=[pa.UDP_TCP_RELAY,pa.TCP_RELAY,pa.RELAY],vb=Se("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&rn().supportPCSetConfiguration;function s2(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1],r=jR.get(e.id);r&&(window.clearTimeout(r),jR.delete(e.id));let n=CE.get(e.id);t&&n&&n.index===eh.length-1&&(L.debug("[".concat(e.id,"] reset ICE restart policy")),CE.delete(e.id))}function c2(e,t,r){if(jR.size===0&&CE.size===0&&(Array.isArray(Se("RESTART_SEQUENCE"))&&Se("RESTART_SEQUENCE").length>0&&!function(u,h){if(u.length!==h.length)return!1;for(let m=0;m<u.length;m+=1){let _=u[m];if(u.filter(R=>R===_).length!==h.filter(R=>R===_).length)return!1}return!0}(eh,Se("RESTART_SEQUENCE"))&&(eh=Se("RESTART_SEQUENCE").filter(u=>{var h;if(Qt(h=Object.values(pa)).call(h,u))return!0}),L.debug("use reconnection policy from config distribution, queues: ".concat(eh.join(" => ")))),vb=Se("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&rn().supportPCSetConfiguration),eh.length===0)return void r();let n,{index:i=0,type:o}=CE.get(e.id)||{};if(vb&&o===pa.RELAY)return void r();let l=o&&i>=eh.length-1;if(vb)o=pa.RELAY;else{if(l)return void r();o?(i++,o=eh[i]):(o=eh[0],i=0)}L.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(o,", index: ").concat(i)),t(o),CE.set(e.id,{index:i,type:o}),n=window.setTimeout(()=>c2(e,t,r),PG),jR.set(e.id,n)}var Vr;function l2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Vl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?l2(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function u2(e){var t,r,n,i=2;for(typeof Symbol<"u"&&(r=HI,n=Symbol.iterator);i--;){if(r&&(t=e[r])!=null)return t.call(e);if(n&&(t=e[n])!=null)return new BR(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function BR(e){function t(r){if(Object(r)!==r)return tr.reject(new TypeError(r+" is not an object."));var n=r.done;return tr.resolve(r.value).then(function(i){return{value:i,done:n}})}return BR=function(r){this.s=r,this.n=r.next},BR.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(r){var n=this.s.return;return n===void 0?tr.resolve({value:r,done:!0}):t(n.apply(this.s,arguments))},throw:function(r){var n=this.s.return;return n===void 0?tr.reject(r):t(n.apply(this.s,arguments))}},new BR(e)}let dv=(Vr=class extends zn{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Cr.StateChange,t,this._state)}constructor(e,t){super(),ie(this,"isPlanB",void 0),ie(this,"store",void 0),ie(this,"statsUploader",void 0),ie(this,"connection",void 0),ie(this,"localTrackMap",new Map),ie(this,"remoteUserMap",new Map),ie(this,"localDataChannels",[]),ie(this,"remoteDataChannelMap",new Map),ie(this,"pendingLocalTracks",[]),ie(this,"pendingRemoteTracks",[]),ie(this,"pendingLocalDataChannels",[]),ie(this,"pendingRemoteDataChannels",[]),ie(this,"statsCollector",void 0),ie(this,"shouldForwardP2PCreation",void 0),ie(this,"iceFailedCount",0),ie(this,"dtlsFailedCount",0),ie(this,"mutex",void 0),ie(this,"_state",ln.Disconnected),ie(this,"_pcStatsUploadType",Se("NEW_ICE_RESTART")?xu.FIRST_CONNECTION:xu.OLD_FIRST_CONNECTION),ie(this,"_isStartRestartIce",!1),ie(this,"_restartTimer",void 0),ie(this,"_isTryConnecting",!1),ie(this,"_iceError",null),ie(this,"_forceTurn",!1),ie(this,"_isWaitPcToRePub",!1),ie(this,"handleMuteLocalTrack",async(r,n,i)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ln.Connected)return void i(new Et(ce.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));let l=this.filterTobeMutedTracks(r);if(l.length===0)return void n();let u=l.find(m=>m[0]==="videoLowTrack");u&&u[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(l.map(m=>{let[,{id:_}]=m;return _}));let h=this.createMuteMessage(l);await bn(this,Cr.RequestMuteLocal,h),n()}catch(l){i(l)}finally{o()}}),ie(this,"handleUnmuteLocalTrack",async(r,n,i)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ln.Connected)return void i(new Et(ce.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));let l=this.filterTobeUnmutedTracks(r);if(l.length===0)return void n();let u=l.find(m=>m[0]==="videoLowTrack");if(u){let m=u[1];if(m.track._originMediaStreamTrack.stop(),!Se("DISABLE_DUAL_STREAM_USE_ENCODING")&&rn().supportDualStreamEncoding){let _=r._mediaStreamTrack.clone();m.track._mediaStreamTrack=_,m.track._originMediaStreamTrack=_}else{let _=gb(r,zg(this,Cr.RequestLowStreamParameter));m.track._mediaStreamTrack=_,m.track._originMediaStreamTrack=_}await new tr((_,R)=>{this.handleReplaceTrack(m.track,_,R,!0)})}await this.connection.unmuteLocal(l.map(m=>{let[,{id:_}]=m;return _}));let h=this.createUnmuteMessage(l);await bn(this,Cr.RequestUnmuteLocal,h),n()}catch(l){i(l)}finally{o()}}),ie(this,"handleUpdateVideoEncoder",async(r,n,i,o)=>{let l;o||(l=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{let h=this.localTrackMap.get(Mt.LocalVideoTrack);if(!this.connection||!h||h.track!==r||this.state!==ln.Connected)return void n();let{id:m,track:_}=h;await this.connection.updateSendParameters(m,_),await this.connection.updateEncoderConfig(m,_),this.emit(Cr.UpdateVideoEncoder,_),n()}catch(h){i(h)}finally{var u;(u=l)===null||u===void 0||u()}}),ie(this,"handleUpdateVideoSendParameters",async(r,n,i)=>{let o=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{let l=this.localTrackMap.get(Mt.LocalVideoTrack);if(!this.connection||!l||l.track!==r||this.state!==ln.Connected)return void n();let{id:u,track:h}=l;await this.connection.updateSendParameters(u,h),n()}catch(l){i(l)}finally{o()}}),ie(this,"handleReplaceMixingTrack",async(r,n,i,o)=>{if(!this.connection||this.state!==ln.Connected)return void n();let l=Eb([r]),u;L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(l.getTrackId(),"]")),typeof o=="boolean"&&o||(u=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(r,l),n()}catch(m){i(m)}finally{var h;(h=u)===null||h===void 0||h()}}),ie(this,"handleReplaceTrack",async(r,n,i,o)=>{let l;L.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof o=="boolean"&&o||(l=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var u;let m=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:R}]=_;return r===R});if(!this.connection||!m||this.state!==ln.Connected)return void n();if(await((u=this.connection)===null||u===void 0?void 0:u.replaceTrack(r,m[1].id)),this.isPlanB){let _=m[1];_.id=r._mediaStreamTrack.id,this.localTrackMap.set(m[0],_)}if(m[0]===Mt.LocalVideoTrack&&!Se("DISABLE_DUAL_STREAM_USE_ENCODING")&&rn().supportDualStreamEncoding){let _=this.localTrackMap.get(Mt.LocalVideoLowTrack);if(_){let R=r._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=R,_.track._originMediaStreamTrack=R,await new tr((A,D)=>{this.handleReplaceTrack(_.track,A,D,!0)})}}n()}catch(m){i(m)}finally{var h;(h=l)===null||h===void 0||h()}}),ie(this,"handleGetRTCStats",r=>{r(this.statsCollector.getRTCStats())}),ie(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),ie(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),ie(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),ie(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new o2(this.store),this.bindStatsUploaderEvents(),this.mutex=new da("P2PChannel-mutex",this.store.clientId),this.isPlanB=!rn().supportUnifiedPlan||Se("CHROME_FORCE_PLAN_B")&&wu(),this.shouldForwardP2PCreation=Se("FORWARD_P2P_CREATION")&&rn().supportPCSetConfiguration&&tA(),this.shouldForwardP2PCreation&&(this.connection=kR(this.store),this.emit(Cr.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e){var t;this.state=ln.New,this._forceTurn=e2(e),L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));let r=this.shouldForwardP2PCreation&&((t=this.connection)===null||t===void 0?void 0:t.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=kR(this.store,e),this.emit(Cr.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new Et(ce.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=Se("NEW_ICE_RESTART")?xu.FIRST_CONNECTION:xu.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new Et(ce.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");Se("ENABLE_PREALLOC_PC")&&this.state===ln.Connected?await this.connection.updateRemoteConnect(e):(this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ln.Connected)}updateRemoteRTPCapabilities(e){let t=Array.from(this.localTrackMap.entries()).filter(i=>{var o;let[l]=i;return Qt(o=[Mt.LocalVideoLowTrack,Mt.LocalVideoTrack]).call(o,l)}),r=t.map(i=>{let[,{id:o}]=i;return o}),n=t.map(i=>{let[o]=i;return o});if(this.connection instanceof jl){if(gr.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(n),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!Qt(e).call(e,this.store.codec)){let i=["vp9","vp8","h264"].find(o=>Qt(e).call(e,o));i&&(this.store.codec=i,L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(i,".")))}this.connection.updateRemoteRTPCapabilities(r,e)}}async getEstablishParams(){var e;if(this.connection instanceof jl&&this.connection.peerConnectionState!=="closed"&&Qt(e=[ln.New,ln.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==ln.Connected){if(this.state===ln.Disconnected)throw new Et(ce.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(r=>{var n;Qt(n=this.pendingLocalDataChannels).call(n,r)||this.pendingLocalDataChannels.push(r)}),[]}let t=this.filterTobePublishedDataChannels(e);return t.length===0?[]:(t.forEach(r=>{let n=Date.now();this.store.publish(r.id.toString(),"datachannel",n)}),await this.connection.createDataChannels(this.store.uid,t),t.forEach(r=>{this.localDataChannels.push(r);let n=Date.now();this.store.publish(r.id+"","datachannel",void 0,n)}),e.map(r=>({streamId:r.id,ordered:r.ordered,maxRetransmits:r.maxRetransmits,metadata:r.metadata,channelId:r._originDataChannelId})))}publish(e,t,r){var n=this;return ds(function*(){let i=yield Qr(n.mutex.lock("From P2PChannel.publish"));try{var o;let l=n.connection&&Qt(o=["disconnected","failed"]).call(o,n.connection.peerConnectionState);if(!n.connection||n.state!==ln.Connected||l){if(n.state===ln.Disconnected)throw new Et(ce.UNEXPECTED_ERROR,"PeerConnection already disconnected.");n.throwIfTrackTypeNotMatch(e);let h=e.filter(m=>n.pendingLocalTracks.indexOf(m)===-1);return n.pendingLocalTracks=n.pendingLocalTracks.concat(h),void(l&&(n._isWaitPcToRePub=!0))}n.store.pubId=n.store.pubId+1,fa.markPublishStart(n.store.clientId,n.store.pubId);let u=n.filterTobePublishedTracks(e,t,r);if(u.length===0)return void(yield Qr(n.tryToUnmuteAudio(e)));yield*LS(u2(n.doPublish(n.connection,u)))}finally{i()}})()}doPublish(e,t){var r=this;return ds(function*(){t.forEach(A=>{let{track:D,type:J}=A,V=Date.now();r.store.publish(D.getTrackId(),J===Mt.LocalAudioTrack?"audio":"video",V)}),r.bindLocalTrackEvents(t);let n=t.map(A=>{let{track:D}=A;return D}),i=yield Qr(e.send(n,r.store.codec,r.store.audioCodec)),o=(yield Qr(i.next())).value,l=r.createGatewayPublishMessage(t,o),u;try{u=yield l}catch(A){throw i.throw(A),A?.code===ce.WS_ABORT&&t.forEach(D=>{let{track:J}=D;r.pendingLocalTracks.indexOf(J)===-1&&r.pendingLocalTracks.push(J)}),r.unbindLocalTrackEvents(t),A}let h=r.mapPubResToRemoteConfig(l,u,n),m=(yield Qr(i.next(h))).value;if(r.state===ln.Disconnected)throw new Et(ce.UNEXPECTED_ERROR,"PeerConnection already disconnected.");Se("ENABLE_VIDEO_SEI");let _=Se("ENABLE_ENCODED_TRANSFORM"),R=Se("ENABLE_AUDIO_METADATA");n.forEach(async A=>{let D=A.getRTCRtpTransceiver();if(!D||!_)return;let{interceptLocalVideoFrame:J,interceptLocalAudioFrame:V}=bR();A.trackMediaType===lr.VIDEO?await J(D.sender,A):A.trackMediaType===lr.AUDIO&&await V(D.sender,{metadata:R?()=>{let K=A.metadata.shift();return K&&K.value}:void 0})}),t.forEach(A=>{let{type:D}=A;r.statsCollector.addLocalStats(D)}),r.assignLocalTracks(t,m),r.statsUploader.startUploadOutboundStats(),t.forEach(A=>{let{track:D,type:J}=A,V=Date.now();r.store.publish(D.getTrackId(),J===Mt.LocalAudioTrack?"audio":"video",void 0,V)})})()}async updateVideoStreamParameter(e,t){let r=this.localTrackMap.get(t);if(!r||!this.connection)return;if(!(r.track instanceof xn))return L.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");let{track:n}=r,i=function(o,l){let u={};return o.height&&o.width&&(u.scaleResolutionDownBy=eb(o,l)),u.maxFramerate=o.framerate?yo(o.framerate):void 0,u.maxBitrate=o.bitrate?1e3*o.bitrate:void 0,u}(e,n);if(n._encoderConfig||(n._encoderConfig={}),t!==Mt.LocalVideoLowTrack||!Se("DISABLE_DUAL_STREAM_USE_ENCODING")&&rn().supportDualStreamEncoding)i.scaleResolutionDownBy!=null&&(n._encoderConfig.scaleResolutionDownBy=i.scaleResolutionDownBy);else{let o=n._originMediaStreamTrack;if(!o.canvas)return L.warn("[".concat(n.getTrackId(),"] no canvas on track"));(function(l,u){let h=l.canvas;u.width&&(h.width=yo(u.width)),u.height&&(h.height=yo(u.height)),u.framerate&&(h.stopCapture&&h.stopCapture(),h.stopCapture=NA(()=>{!h.startCapture&&h.stopCapture&&h.stopCapture(),h.startCapture&&h.startCapture()},yo(u.framerate)))})(o,e)}i.maxBitrate!=null&&(n._encoderConfig.bitrateMax=i.maxBitrate/1e3),i.maxFramerate!=null&&(n._encoderConfig.frameRate&&typeof n._encoderConfig.frameRate=="object"?n._encoderConfig.frameRate.max=i.maxFramerate:n._encoderConfig.frameRate={max:i.maxFramerate}),L.debug("[".concat(n.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(n._encoderConfig))),await this.connection.updateRtpSenderEncodings(n)}publishLowStream(e){var t=this;return ds(function*(){if(!t.connection||t.state!==ln.Connected)return;let r=yield Qr(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{let i=t.localTrackMap.get(Mt.LocalVideoTrack);if(!i)throw new Et(ce.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(Mt.LocalVideoLowTrack))throw new Et(ce.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));let o=[{track:t.getLowVideoTrack(i.track,e),type:Mt.LocalVideoLowTrack}];if(yield*LS(u2(t.doPublish(t.connection,o))),i.track.muted||!i.track.enabled){var n;let l=(n=t.localTrackMap.get(Mt.LocalVideoLowTrack))===null||n===void 0?void 0:n.id;l!==void 0&&(yield Qr(t.connection.muteLocal([l])))}}finally{r()}})()}async republish(){this.pendingLocalTracks.length>0&&(L.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ia(this,Cr.RequestRePublish,this.pendingLocalTracks),this.emit(Cr.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(L.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await ia(this,Cr.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){let{user:r,kind:n}=this.pendingRemoteTracks[t];(n!==lr.AUDIO||r._audio_added_&&r._audioSSRC)&&(n!==lr.VIDEO||r._video_added_&&r._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await ia(this,Cr.RequestReSubscribe,this.pendingRemoteTracks);else for(let{user:t,kind:r}of this.pendingRemoteTracks)await this.subscribe(t,r,r===lr.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:r}=t;this.emit(Cr.MediaReconnectEnd,r.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==ln.Connected)return void e.forEach(n=>{let i=this.pendingLocalTracks.indexOf(n);i!==-1&&this.pendingLocalTracks.splice(i,1)});let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(n=>n[0]==="videoLowTrack");return r&&r[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishDataChannel(e){if(!this.connection||this.state!==ln.Connected)return void e.forEach(r=>{let n=this.pendingLocalDataChannels.indexOf(r);n!==-1&&this.pendingLocalDataChannels.splice(n,1)});let t=this.filterTobeUnpublishedDataChannels(e);return t.length!==0?(t.forEach(r=>{let n=this.localDataChannels.indexOf(r);n!==-1&&this.localDataChannels.splice(n,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),t.map(r=>r.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==ln.Connected)return;let e=this.localTrackMap.get(Mt.LocalVideoLowTrack);if(!e)return;e.track.close();let t=[[Mt.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){let r=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(n=>{let[,{id:i}]=n;return i})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(n=>{let[i,{track:o}]=n;return{type:i,track:o}})),t.forEach(n=>{let[i]=n;this.statsCollector.removeLocalStats(i)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),r}async subscribeDataChannel(e,t){if(!this.connection||this.state!==ln.Connected)throw new Et(ce.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");let r=t.filter(n=>{var i;return!((i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.get(n.id))});if(r.length!==0)return await this.connection.createDataChannels(e.uid,r),r.forEach(n=>{var i;this.remoteDataChannelMap.has(e)?(i=this.remoteDataChannelMap.get(e))===null||i===void 0||i.set(n.id,n):this.remoteDataChannelMap.set(e,new Map([[n.id,n]]));let o=this.pendingRemoteDataChannels.findIndex(l=>{let{user:u,id:h}=l;return u.uid===e.uid&&h===n.id});o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),r.map(n=>n.id)}async subscribe(e,t,r,n,i){var o;if(!this.connection||this.state!==ln.Connected)throw new Et(ce.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((o=this.remoteUserMap.get(e))!==null&&o!==void 0&&o.has(t))return;let l,u,h,m=this.connection.getPreMedia(r);if(m)L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(r,", no need to send sub to gateway.")),h=m.transceiver,l=m.track,u=m.id;else if(i){let A=i.find(J=>{let{stream_type:V}=J;return V===t});if(!A)throw new Et(ce.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));let D=await this.connection.receive(t,A.ssrcs,String(e._uintid),A.attributes);this.connection instanceof jl&&(h=D.transceiver),l=D.track,u=D.id}else{let A=await this.connection.receive(t,[{ssrcId:r,rtx:n}],String(e._uintid),void 0);this.connection instanceof jl&&(h=A.transceiver),l=A.track,u=A.id}if(t===lr.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(l):(e._audioTrack=new dE(l,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(l):(e._videoTrack=new uE(l,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack)),h&&Se("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:A,interceptRemoteAudioFrame:D}=bR();t==lr.VIDEO?await A(h.receiver,{onSei:Se("ENABLE_VIDEO_SEI")&&(J=>{var V;return(V=e._videoTrack)===null||V===void 0?void 0:V._onSei(J)})}):t==lr.AUDIO&&await D(h.receiver,{enableTopn:!!Se("ENABLE_AUDIO_TOPN"),enableMetadata:!!Se("ENABLE_AUDIO_METADATA"),onMetadata:J=>{this.safeEmit(Cr.AudioMetadata,J)}})}let _=this.remoteUserMap.get(e);_?_.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();let R=this.pendingRemoteTracks.findIndex(A=>{let{user:D,kind:J}=A;return D.uid===e.uid&&t===J});R!==-1&&(this.pendingRemoteTracks.splice(R,1),this.emit(Cr.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==ln.Connected)throw new Et(ce.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(i=>{var o;let{user:l,mediaType:u}=i;return!((o=this.remoteUserMap.get(l))!==null&&o!==void 0&&o.has(u))});let t=[],r=new Map;e.forEach(i=>{if(!this.connection)return;let o=this.connection.getPreMedia(i.ssrcId);o?r.set(i.ssrcId,o):t.push(i)});let n=await this.connection.batchReceive(t.map(i=>{let{user:o,mediaType:l,ssrcId:u,rtxSsrcId:h}=i;return{kind:l,ssrcMsg:[{ssrcId:u,rtx:h}],mslabel:String(o._uintid)}}));t.forEach((i,o)=>{r.set(i.ssrcId,n[o])});for(let{user:i,mediaType:o,ssrcId:l}of e){let u=r.get(l);if(!u)return void L.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(i.uid," subscribe data,").concat(o,", ").concat(l));let{track:h,id:m,transceiver:_}=u;if(_&&Se("ENABLE_ENCODED_TRANSFORM")){let{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:J}=bR();o==lr.VIDEO?await D(_.receiver,{onSei:Se("ENABLE_VIDEO_SEI")&&(V=>{var K;return(K=i._videoTrack)===null||K===void 0?void 0:K._onSei(V)})}):o==lr.AUDIO&&await J(_.receiver,{enableTopn:!!Se("ENABLE_AUDIO_TOPN"),enableMetadata:!!Se("ENABLE_AUDIO_METADATA"),onMetadata:V=>{this.safeEmit(Cr.AudioMetadata,V)}})}if(o===lr.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(h):(i._audioTrack=new dE(h,i.uid,i._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),_&&i._audioTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(h):(i._videoTrack=new uE(h,i.uid,i._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),_&&i._videoTrack._updateRtpTransceiver(_),this.bindRemoteTrackEvents(i,i._videoTrack)),Se("ENABLE_VIDEO_SEI")&&_){let{interceptRemoteVideoFrame:D,interceptRemoteAudioFrame:J}=bR();o==lr.VIDEO?await D(_.receiver,{onSei:V=>{var K;(K=i._videoTrack)===null||K===void 0||K._onSei(V)}}):o==lr.AUDIO&&await J(_.receiver)}let R=this.remoteUserMap.get(i);R?R.set(o,m):this.remoteUserMap.set(i,new Map([[o,m]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadInboundStats();let A=this.pendingRemoteTracks.findIndex(D=>{let{user:J,kind:V}=D;return J.uid===i.uid&&o===V});A!==-1&&(this.pendingRemoteTracks.splice(A,1),this.emit(Cr.MediaReconnectEnd,i.uid))}}async unsubscribe(e,t,r){let n=this.pendingRemoteTracks.filter(l=>{let{user:u,kind:h}=l;return t!==void 0?u.uid===e.uid&&t===h:u.uid===e.uid});if(n.forEach(l=>{let u=this.pendingRemoteTracks.indexOf(l);this.pendingRemoteTracks.splice(u,1)}),this.connection&&this.state===ln.Connected||r||n.forEach(l=>{let{kind:u}=l;var h;if(u===lr.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(u===lr.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==ln.Connected)return;let i=this.filterTobeUnSubscribedTracks(e,t);if(i.length===0)return;await this.connection.stopReceiving(i.map(l=>{let[,{id:u}]=l;return u}));let o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(l=>{let[u,{kind:h}]=l;var m,_;if(h===lr.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===lr.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),r||((_=u._videoTrack)===null||_===void 0||_._destroy(),u._videoTrack=void 0);else if(h===lr.AUDIO){var R;this.unbindRemoteTrackEvents(u._audioTrack),!r&&((R=u._audioTrack)===null||R===void 0||R._destroy(),u._audioTrack=void 0)}}),o}async unsubscribeDataChannel(e,t){if(t.forEach(i=>{let o=this.pendingRemoteDataChannels.findIndex(l=>l.id===i.id);o!==-1&&this.pendingRemoteDataChannels.splice(o,1)}),!this.connection)return;let r=this.filterTobeUnSubscribedDataChannels(e,t);if(r.length===0)return;t.forEach(i=>{i._close()});let n=this.remoteDataChannelMap.get(e);return r.forEach(i=>{n&&n.delete(i.id)}),n&&n.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),r.map(i=>i.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(let{user:i,mediaType:o}of e){let l=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return o!==void 0?h.uid===i.uid&&o===m:h.uid===i.uid});l.forEach(u=>{let h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),t=t.concat(l)}if(!this.connection||this.state!==ln.Connected)return void t.forEach(i=>{let{user:o,kind:l}=i;var u;if(l===lr.AUDIO)(u=o._audioTrack)===null||u===void 0||u._destroy(),o._audioTrack=void 0;else if(l===lr.VIDEO){var h;(h=o._videoTrack)===null||h===void 0||h._destroy(),o._videoTrack=void 0}});let r=wa(e).call(e,(i,o)=>{let{user:l,mediaType:u}=o,h=this.filterTobeUnSubscribedTracks(l,u);return i.concat(h)},[]);if(r.length===0)return;await this.connection.stopReceiving(r.map(i=>{let[,{id:o}]=i;return o}));let n=this.createUnsubscribeAllMessage(r);return this.withdrawRemoteTracks(r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),r.forEach(i=>{let[o,{kind:l}]=i;var u,h;if(l===lr.VIDEO&&o._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(o._videoSSRC,!1)),l===lr.VIDEO)this.unbindRemoteTrackEvents(o._videoTrack),(h=o._videoTrack)===null||h===void 0||h._destroy(),o._videoTrack=void 0;else if(l===lr.AUDIO){var m;this.unbindRemoteTrackEvents(o._audioTrack),(m=o._audioTrack)===null||m===void 0||m._destroy(),o._audioTrack=void 0}}),n}isPreSubScribe(e){return!this.connection||this.state!==ln.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void L.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void L.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let n=t===lr.VIDEO?e._videoSSRC:e._audioSSRC;n!==void 0&&this.connection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;let r=this.remoteUserMap.get(e);if(!r)return void L.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||L.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}addAudioMetadata(e){let t=this.localTrackMap.get(Mt.LocalAudioTrack),r=t&&t.track;r&&r.metadata.push(e)}getAllTracks(e){let t=this.localTrackMap.get(Mt.LocalAudioTrack);if(t?.track instanceof Ci){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return i!==Mt.LocalAudioTrack}).filter(n=>{let[i]=n;return!(e&&i===Mt.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return!(e&&n===Mt.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,t,r,n,i){if(e){let l=this.localTrackMap.get(Mt.LocalAudioTrack),u=n?this.localTrackMap.get(Mt.LocalVideoLowTrack):this.localTrackMap.get(Mt.LocalVideoTrack);gr.publish(this.store.sessionId,{eventElapse:fa.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l?.track.getTrackLabel(),videoName:u?.track.getTrackLabel(),screenshare:u?.track._hints.indexOf(Nn.SCREEN_TRACK)!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;r||(r=[]);let l=r.find(h=>h instanceof ei),u=n?(o=this.localTrackMap.get(Mt.LocalVideoTrack))===null||o===void 0?void 0:o.track:r.find(h=>h instanceof xn);gr.publish(this.store.sessionId,{eventElapse:fa.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l?.getTrackLabel(),videoName:u?.getTrackLabel(),screenshare:u?._hints.indexOf(Nn.SCREEN_TRACK)!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,r,n){let i=n===lr.VIDEO?r._videoSSRC:r._audioSSRC;i&&gr.subscribe(this.store.sessionId,{succ:e,ec:t,video:n===lr.VIDEO,audio:n===lr.AUDIO,peerid:r.uid,subscribeRequestid:i,p2pid:this.store.p2pId,eventElapse:fa.measureFromSubscribeStart(this.store.clientId,i),preSsrc:this.isPreSubScribe(i)})}reset(){L.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new da("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=kR(this.store),this.emit(Cr.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Mt.LocalAudioTrack);if(e?.track instanceof Ci){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=ln.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Mt.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Mt.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof xn||t&&t.track instanceof ei?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(Mo(t=this.remoteUserMap).call(t)).find(n=>n.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[n]=r;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Mt.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ng(e).call(e,(r,n)=>r.level-n.level),e}async disconnectForReconnect(){this.connection&&(L.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ln.Reconnecting,Se("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=kR(this.store),this.emit(Cr.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:n}]=e;switch(r){case Mt.LocalVideoTrack:Qt(t=n._hints).call(t,Nn.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case Mt.LocalAudioTrack:n instanceof Ci?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case Mt.LocalVideoLowTrack:}}),this.emit(Cr.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Mo(r).call(r)).forEach(n=>{this.setPendingRemoteMedia(t,n)}),this.emit(Cr.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Mo(r).call(r)).forEach(n=>{this.setPendingRemoteDataChannel(t,n)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),L.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,t){for(let r of this.pendingRemoteDataChannels){let{user:n,id:i}=r;if((e instanceof $d?e.uid:e)===n.uid&&i===t)return!0}return!1}setPendingRemoteDataChannel(e,t){this.hasPendingRemoteDataChannel(e,t)||this.pendingRemoteDataChannels.push({user:e,id:t})}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:n,kind:i}=r;if((e instanceof $d?e.uid:e)===n.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ds(function*(){if(!t.connection||t.state!==ln.Connected)return;let r=yield Qr(t.mutex.lock("From P2PChannel.restartICE")),n;try{n=yield Qr(t.connection.restartICE(e));let o=yield Qr(n.next());if(o.done)return;let l=o.value,u=yield l;switch(_b(t.connection)&&t.reportPCStats(Date.now(),!1,t._pcStatsUploadType),e){case pa.UDP_TCP_RELAY:t._pcStatsUploadType=xu.UDP_TCP_RESTART;break;case pa.TCP_RELAY:t._pcStatsUploadType=xu.TCP_RESTART;break;case pa.RELAY:t._pcStatsUploadType=xu.RELAY_RESTART;break;default:t._pcStatsUploadType=xu.OLD_RESTART}t._isTryConnecting=!0,n.next(u)}catch(o){var i;(i=n)===null||i===void 0||i.throw(o)}finally{r()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=this.localTrackMap.get(Mt.LocalVideoTrack),r=this.localTrackMap.get(Mt.LocalAudioTrack),n=e.videoSend.find(D=>D.ssrc===t?.ssrcs[0].ssrcId),i=e.audioSend.find(D=>D.ssrc===r?.ssrcs[0].ssrcId);if(!n||!i)return 1;let o=Lo(this,Cr.NeedSignalRTT),l=n?n.rttMs:void 0,u=i?i.rttMs:void 0,h=l&&u?(l+u)/2:l||u,m=(h&&o?(h+o)/2:h||o)||0,_=100*e.sendPacketLossRate*.7/50+.3*m/1500,R=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,A=t?.track;if(A&&A._encoderConfig&&A._hints.indexOf(Nn.SCREEN_TRACK)===-1){let D=A._encoderConfig.bitrateMax,J=e.bitrate.actualEncoded;if(D&&J){let V=(1e3*D-J)/(1e3*D);return Wk[V<.15?0:V<.3?1:V<.45?2:V<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.connection)return 0;let e=this.connection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[n]=r,i=n._audioSSRC,o=n._videoSSRC,l=e.audioRecv.find(J=>J.ssrc===i),u=e.videoRecv.find(J=>J.ssrc===o);if(!l&&!u)return void(t+=1);let h=Lo(this,Cr.NeedSignalRTT),m=e.rtt,_=(m&&h?(m+h)/2:m||h)||0,R=l?l.jitterMs:void 0,A=e.recvPacketLossRate,D=.7*A*100/50+.3*_/1500;R&&(D=.6*A*100/50+.2*_/1500+.2*R/400),t+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new tr((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}async replaceTrack(e,t){var r;if(L.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(t.getTrackId(),"]")),!this.connection||this.state!==ln.Connected)return;let n=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:l}]=o;return e===l});if(!n)return;let i=n[0];if(e!==t&&(this.unbindLocalTrackEvents([{track:e,type:i}]),this.bindLocalTrackEvents([{track:t,type:i}]),n[1].track=t),await((r=this.connection)===null||r===void 0?void 0:r.replaceTrack(t,n[1].id)),this.isPlanB){let o=n[1];o.id=t._mediaStreamTrack.id,this.localTrackMap.set(i,o)}if(i===Mt.LocalVideoTrack&&!Se("DISABLE_DUAL_STREAM_USE_ENCODING")&&rn().supportDualStreamEncoding){let o=this.localTrackMap.get(Mt.LocalVideoLowTrack);if(o){let l=e._mediaStreamTrack.clone();o.track._originMediaStreamTrack.stop(),o.track._mediaStreamTrack=l,o.track._originMediaStreamTrack=l,await new tr((u,h)=>{this.handleReplaceTrack(o.track,u,h,!0)})}}}filterTobePublishedTracks(e,t,r){let n=[],i=this.getAllTracks();e=Zm(e=e.filter(h=>i.indexOf(h)===-1));let o,l=!1,u=this.localTrackMap.get(Mt.LocalAudioTrack);for(let h of e){if(h instanceof xn&&(this.localTrackMap.has(Mt.LocalVideoTrack)||l?new Et(ce.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:h,type:Mt.LocalVideoTrack}),l=!0),t)){let m=this.getLowVideoTrack(h,r);n.push({track:m,type:Mt.LocalVideoLowTrack})}if(h instanceof ei)if(u){let m=u.track;if(m instanceof Ci)mb([h]),m.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0);else{let _=Eb([m,h]);L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(_.getTrackId(),"]")),this.replaceTrack(m,_)}}else o instanceof Ci?(mb([h]),o.addAudioTrack(h)):o||!h._useAudioElement&&rn().webAudioMediaStreamDest&&!h._bypassWebAudio?o=Eb(o?[h,o]:[h]):o=h}return o&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(o.getTrackId(),"]")),n.push({track:o,type:Mt.LocalAudioTrack})),n}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=Zm(e=e.filter(n=>r.indexOf(n)!==-1));for(let n of e){if(n instanceof ei){let i=this.localTrackMap.get(Mt.LocalAudioTrack);if(!i)continue;i.track instanceof Ci?(i.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),i.track.trackList.length===0&&(t.push([Mt.LocalAudioTrack,i]),i.track.close())):t.push([Mt.LocalAudioTrack,i])}if(n instanceof xn){let i=this.localTrackMap.get(Mt.LocalVideoTrack);if(!i)continue;t.push([Mt.LocalVideoTrack,i]);let o=this.localTrackMap.get(Mt.LocalVideoLowTrack);o&&t.push([Mt.LocalVideoLowTrack,o])}}return t}filterTobePublishedDataChannels(e){return e=(e=Zm(e)).filter(t=>this.localDataChannels.findIndex(r=>r.id===t.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=Zm(e)).filter(t=>this.localDataChannels.indexOf(t)!==-1)).filter(t=>t._originDataChannel)}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:n}=t;switch(n){case Mt.LocalVideoTrack:r.addListener(hr.GET_STATS,this.handleGetLocalVideoStats),r.addListener(hr.GET_RTC_STATS,this.handleGetRTCStats),r.addListener(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(hr.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(hr.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(hr.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Mt.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Mt.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ci?e.trackList.forEach(r=>{r.addListener(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(hr.GET_STATS,this.handleGetLocalAudioStats),r.addListener(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(hr.GET_STATS,this.handleGetLocalAudioStats),e.addListener(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||(e.addListener(hr.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(hr.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:n}]=t;return{track:n,type:r}})),e.forEach(t=>{let{track:r,type:n}=t;switch(n){case Mt.LocalVideoTrack:r.off(hr.GET_STATS,this.handleGetLocalVideoStats),r.off(hr.GET_RTC_STATS,this.handleGetRTCStats),r.off(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(hr.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(hr.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(hr.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Mt.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Mt.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ci?e.trackList.forEach(t=>{t.off(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(hr.GET_STATS,this.handleGetLocalAudioStats),t.off(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(hr.GET_STATS,this.handleGetLocalAudioStats),e.off(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(hr.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(hr.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof uE&&t.addListener(hr.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof dE&&t.addListener(hr.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(hr.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(lr.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(lr.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,n)=>{var i;let o,l,{track:u,type:h}=r;switch(h){case Mt.LocalAudioTrack:o=un.Audio,l={dtx:u instanceof oR&&u._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case Mt.LocalVideoTrack:o=Qt(i=u._hints).call(i,Nn.SCREEN_TRACK)?un.Screen:un.High,l=Vl(Vl({},cM(u)),{},{codec:this.store.codec,svc_mode:SR()});break;case Mt.LocalVideoLowTrack:o=un.Low,l=Vl(Vl({},cM(u)),{},{codec:this.store.codec,svc_mode:SR()})}return{stream_type:o,attributes:l,ssrcs:t[n]}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:l,id:u}]=t;switch(i){case Mt.LocalVideoTrack:n=Qt(r=o._hints).call(r,Nn.SCREEN_TRACK)?un.Screen:un.High;break;case Mt.LocalAudioTrack:n=un.Audio;break;case Mt.LocalVideoLowTrack:n=un.Low}return{stream_type:n,ssrcs:l,mid:u}})}assignLocalTracks(e,t){e.forEach((r,n)=>{let{track:i,type:o}=r;this.localTrackMap.set(o,{track:i,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Cr.PeerConnectionStateChange,t),t==="connecting"&&e instanceof jl&&!Yn()&&Se("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{t==="connecting"&&e.extendCandidate()},Se("FIRST_TCP_CANDIDATE_INTERVAL")),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof jl&&s2(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=xu.DISCONNECTED_OR_FAILED,Lo(this,Cr.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){let r=this.pendingLocalTracks.map(i=>i.getTrackId()),n=this.pendingLocalDataChannels.map(i=>"dc_".concat(i.id));gr.reportApiInvoke(this.store.sessionId,{name:gi.REPUB_AFTER_PC_CONNECTED,options:r.concat(n),tag:Jn.TRACER}).onSuccess(),this.republish()}if(Se("NEW_ICE_RESTART")&&e instanceof jl&&!Yn()&&!this._forceTurn){if(Qt(tM).call(tM,t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;let r=i=>{_b(e)&&(L.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(i)),Lo(this,Cr.QueryClientConnectionState)==="CONNECTED"&&this.emit(Cr.RequestRestartICE,i))},n=()=>{_b(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),L.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Cr.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{c2(e,r,n)},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&Se("ICE_RESTART")&&Lo(this,Cr.QueryClientConnectionState)==="CONNECTED"&&this.emit(Cr.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(Cr.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(L.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(Cr.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),gr.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Jn.TRACER}).onSuccess(),this.emit(Cr.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let n=Array.from(Mo(r=this.remoteUserMap).call(r)).find(o=>o._audioSSRC===t);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(i=n.audioTrack)===null||i===void 0||i.emit(aE.FIRST_FRAME_DECODED),gr.firstRemoteFrame(this.store.sessionId,Pi.FIRST_AUDIO_DECODE,Hn.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:fa.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let n=Array.from(Mo(r=this.remoteUserMap).call(r)).find(i=>i._audioSSRC===t);n&&gr.firstRemoteFrame(this.store.sessionId,Pi.FIRST_AUDIO_RECEIVED,Hn.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:fa.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,n)=>{this.reportVideoFirstFrameDecoded(t,r,n)},e.onFirstVideoReceived=t=>{var r;let n=Array.from(Mo(r=this.remoteUserMap).call(r)).find(i=>i._videoSSRC===t);n&&gr.firstRemoteFrame(this.store.sessionId,Pi.FIRST_VIDEO_RECEIVED,Hn.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:fa.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{let n=t.candidateType==="relay",i=r.candidateType==="relay";r.candidateType!=="unknown"&&n===i||this.emit(Cr.ConnectionTypeChange,n),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Jd(r))," -> ").concat(JSON.stringify(Jd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Jd(r))," -> ").concat(JSON.stringify(Jd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.getLocalVideoStats=()=>{let t=this.statsCollector.getLocalVideoTrackStats(),r=this.statsCollector.getRTCStats();return Vl(Vl({},t),r)},e.onICECandidateError=t=>{this._iceError=t}}resetConnection(e){e instanceof jl&&function(t){CE.delete(t.id),s2(t)}(e),e.close(),this.emit(Cr.PeerConnectionStateChange,"closed"),function(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(Mt.LocalAudioTrack);if(e instanceof ei&&r?.track instanceof Ci)return r.track.isActive||t.push([Mt.LocalAudioTrack,r]),t;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return e===o});if(n&&(t.push(n),n[0]===Mt.LocalVideoTrack)){let i=this.localTrackMap.get(Mt.LocalVideoLowTrack);i&&t.push([Mt.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(Mt.LocalAudioTrack);if(e instanceof ei&&r?.track instanceof Ci)return r.track.isActive&&t.push([Mt.LocalAudioTrack,r]),t;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return e===o});if(n)if(n[0]===Mt.LocalVideoTrack){t.push(n);let i=this.localTrackMap.get(Mt.LocalVideoLowTrack);i&&t.push([Mt.LocalVideoLowTrack,i])}else t.push(n);return t}createMuteMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:l,id:u}]=t;switch(i){case Mt.LocalAudioTrack:n=un.Audio;break;case Mt.LocalVideoTrack:n=Qt(r=o._hints).call(r,Nn.SCREEN_TRACK)?un.Screen:un.High;break;case Mt.LocalVideoLowTrack:n=un.Low}return{stream_type:n,ssrcs:l,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:l,id:u}]=t;switch(i){case Mt.LocalAudioTrack:n=un.Audio;break;case Mt.LocalVideoTrack:n=Qt(r=o._hints).call(r,Nn.SCREEN_TRACK)?un.Screen:un.High;break;case Mt.LocalVideoLowTrack:n=un.Low}return{stream_type:n,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(e,t){let r=[],n=this.remoteUserMap.get(e);if(!n)return r;if(t){let i=n.get(t);if(!i)return r;r.push([e,{kind:t,id:i}])}else Array.from(n.entries()).forEach(i=>{let[o,l]=i;r.push([e,{kind:o,id:l}])});return r}filterTobeUnSubscribedDataChannels(e,t){let r=[];return t.forEach(n=>{var i;(i=this.remoteDataChannelMap.get(e))!==null&&i!==void 0&&i.has(n.id)&&r.push(n)}),r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[n,{kind:i,id:o}]=r;switch(i){case lr.VIDEO:return void(n._videoSSRC&&t.push({stream_type:lr.VIDEO,ssrcId:n._videoSSRC}));case lr.AUDIO:return void(n._audioSSRC&&t.push({stream_type:lr.AUDIO,ssrcId:n._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){let t=new Map;return e.forEach(r=>{let[n,{kind:i}]=r;if(t.has(n)){let o=t.get(n);i===lr.VIDEO?o|=Li.Video:o|=Li.Audio,t.set(n,o)}else i===lr.VIDEO?t.set(n,Li.Video):t.set(n,Li.Audio)}),{users:Array.from(t.entries()).map(r=>{let[n,i]=r;return{stream_id:n.uid,stream_type:i}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:n}]=t,i=this.remoteUserMap.get(r);i&&(i.delete(n),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Mt.LocalVideoTrack),r=this.localTrackMap.get(Mt.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new tr((n,i)=>{this.handleUpdateVideoEncoder(t.track,n,i,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new tr((n,i)=>{this.handleUpdateVideoEncoder(r.track,n,i,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t,r){return e.map((n,i)=>{var o;let{stream_type:l}=n,u=(o=t.find(h=>{let{stream_type:m}=h;return l===m}))===null||o===void 0?void 0:o.attributes;if(u&&Se("DISABLE_SCREEN_SHARE_REMB")){let h=r[i]._hints;(Qt(h).call(h,Nn.SCREEN_TRACK)||Qt(h).call(h,Nn.SCREEN_LOW_TRACK))&&(u.remb=!1,L.debug("disable remb for screen share, hints:",h))}return u})}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof ei){var t;let n=this.filterTobeUnmutedTracks(e[r]);if(n.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(n.map(o=>{let[,{id:l}]=o;return l})));let i=this.createUnmuteMessage(n);return void await bn(this,Cr.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Cr.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Cr.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Yi(lA(this.dtlsFailedCount,vi)),this.emit(Cr.RequestReconnect)}async reconnectP2P(){let e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await ia(this,Cr.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Cr.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(Mt.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof xn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof xn).length>1)throw new Et(ce.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof ei).length>1&&(e.some(t=>t instanceof ei&&t._bypassWebAudio)||!rn().webAudioMediaStreamDest))throw new Et(ce.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof xn&&this.pendingLocalTracks.some(r=>r instanceof xn))throw new Et(ce.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof ei&&this.pendingLocalTracks.some(r=>r instanceof ei)&&(!rn().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof ei&&r._bypassWebAudio)))throw new Et(ce.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){var r;let n=!Se("DISABLE_DUAL_STREAM_USE_ENCODING")&&rn().supportDualStreamEncoding,i=Vl(Vl({},{width:160,height:120,framerate:15,bitrate:50}),t),o;o=n?e._mediaStreamTrack.clone():gb(e,i);let l=On(8,"track-low-"),u=new xn(o,Vl(Vl({},n&&{scaleResolutionDownBy:eb(i,e)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,l);return u.on(Op.TRANSCEIVER_UPDATED,h=>{e._updateRtpTransceiver(h,nE.LOW_STREAM)}),u._hints.push(Nn.LOW_STREAM),Qt(r=e._hints).call(r,Nn.SCREEN_TRACK)&&u._hints.push(Nn.SCREEN_LOW_TRACK),e.on("sei-to-send",h=>{u.emit("sei-to-send",h)}),e.addListener(hr.NEED_CLOSE,()=>{u.close()}),u}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof jl){var i,o,l,u;let h=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:m,dtlsTransportState:_,peerConnectionState:R}=this.connection,{local:A,remote:D}=await this.connection.getSelectedCandidatePair();gr.pcStats(this.store.sessionId,{startTime:h,eventElapse:e-h||0,iceconnectionsate:m,dtlsstate:_,connectionstate:R,intSucc:t?1:2,error:this._iceError||n||"",selectedLocalCandidateProtocol:(i=A?.protocol)!==null&&i!==void 0?i:"",selectedLocalCandidateType:(o=A.candidateType)!==null&&o!==void 0?o:"",selectedLocalCandidateAddress:"".concat(A.address,":").concat(A.port),selectedRemoteCandidateProtocol:(l=D.protocol)!==null&&l!==void 0?l:"",selectedRemoteCandidateType:(u=D.candidateType)!==null&&u!==void 0?u:"",selectedRemoteCandidateAddress:"".concat(D.address,":").concat(D.port),restartCnt:r,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameDecoded(e,t,r,n){var i;let o=Array.from(Mo(i=this.remoteUserMap).call(i)).find(l=>l._videoSSRC===e);if(o){n||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let l=this.store.keyMetrics,u=l.subscribe.find(h=>h.userId===o.uid&&h.type==="video");gr.firstRemoteVideoDecode(this.store.sessionId,Pi.FIRST_VIDEO_DECODE,Hn.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:r,subscribeElapse:fa.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:u?.subscribeEnd||0,subscriberStart:u?.subscribeStart||0,videoAddNotify:u?.streamAdded||0,state:n?1:0,firstFrame:u?.firstFrame||0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.connection)return!1;let n=this.remoteUserMap.get(e);if(!n)return!1;let i=n.get(t);if(!i)return!1;let o=await this.connection.getRemoteSSRC(i);return o!==void 0&&o!==r}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===Mt.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,nE.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},_r(Vr.prototype,"startP2PConnection",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"startP2PConnection"),Vr.prototype),_r(Vr.prototype,"connect",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"connect"),Vr.prototype),_r(Vr.prototype,"updateRemoteRTPCapabilities",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"updateRemoteRTPCapabilities"),Vr.prototype),_r(Vr.prototype,"publishDataChannel",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"publishDataChannel"),Vr.prototype),_r(Vr.prototype,"unpublish",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"unpublish"),Vr.prototype),_r(Vr.prototype,"unpublishDataChannel",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"unpublishDataChannel"),Vr.prototype),_r(Vr.prototype,"unpublishLowStream",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"unpublishLowStream"),Vr.prototype),_r(Vr.prototype,"subscribeDataChannel",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"subscribeDataChannel"),Vr.prototype),_r(Vr.prototype,"subscribe",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"subscribe"),Vr.prototype),_r(Vr.prototype,"massSubscribe",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"massSubscribe"),Vr.prototype),_r(Vr.prototype,"unsubscribe",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"unsubscribe"),Vr.prototype),_r(Vr.prototype,"unsubscribeDataChannel",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"unsubscribeDataChannel"),Vr.prototype),_r(Vr.prototype,"massUnsubscribe",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"massUnsubscribe"),Vr.prototype),_r(Vr.prototype,"muteRemote",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"muteRemote"),Vr.prototype),_r(Vr.prototype,"unmuteRemote",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"unmuteRemote"),Vr.prototype),_r(Vr.prototype,"hasRemoteMediaWithLock",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"hasRemoteMediaWithLock"),Vr.prototype),_r(Vr.prototype,"disconnectForReconnect",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"disconnectForReconnect"),Vr.prototype),_r(Vr.prototype,"updateBitrateLimit",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"updateBitrateLimit"),Vr.prototype),_r(Vr.prototype,"remoteMediaSsrcChanged",[Oa],Object.getOwnPropertyDescriptor(Vr.prototype,"remoteMediaSsrcChanged"),Vr.prototype),Vr);function Oa(e,t,r){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let i=this.mutex,o=await i.lock("From P2PChannel.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await n.apply(this,u)}finally{o()}},r}function d2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function h2(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?d2(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let LG=Date.now(),kG=20,Tb=new Map,VR=new Map;async function p2(e){let t=Tb.get(e),r=Array.isArray(t)&&t[t.length-1],n=VR.get(e);if(!r)return void(n.isSyncing=!1);let i={uid:r.uid,payload:r.payload};n.firstRecvTs===0&&(n.firstRecvTs=r.recvTs,n.firstSendTs=r.sendTs);let o=r.sendTs-n.firstSendTs,l=o-(Date.now()-n.firstRecvTs);l>0&&(n.firstRecvTs=Date.now()-o);let u=r.mediaDelay+l;u<=0?(t.pop(),f2(r.context,i),u=0):u=Math.min(u,kG),setTimeout(()=>t.length&&p2(e),u)}function f2(e,t){e.safeEmit(Gr.STREAM_MESSAGE,t.uid,t.payload),e.onStreamMessage&&e.onStreamMessage(t)}function MG(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return f2(r,{uid:e.uid,payload:e.payload});let n="".concat(r.id,"-").concat(e.uid),i=Tb.get(n)||[],o=i.findIndex(m=>e.sendTs>=m.sendTs),l=h2(h2({},e),{},{context:r,mediaDelay:t,recvTs:Date.now()});o===-1?i.push(l):i.splice(o,0,l),Tb.set(n,i);let u=!1;var h;VR.has(n)?u=!((h=VR.get(n))===null||h===void 0||!h.isSyncing):VR.set(n,{isSyncing:u,firstRecvTs:0,firstSendTs:0}),u||p2(n)}let UG=$r().name;function m2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function E2(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?m2(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m2(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let IE="websdk_ng_cache_parameter",xG=Se("MAX_PRELOAD_ASYNC_LENGTH"),jG=1e4,Fp=new Map,Gp=[],yb=null,Sb=0,Rb=0,FR=new Map,BG=function(e,t){let r=[],n=0,i=async()=>{let o=r.shift();o&&await o(),r.length>0&&n<t?i():n--};return async function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];return new tr(async(h,m)=>{r.push(async()=>{try{let _=await e(...l);h(_)}catch(_){m(_)}}),n<t&&(n++,i())})}}(_2,xG),Cb=Ha.CancelToken.source();async function _2(e,t,r,n,i,o){try{if(!Se("ENABLE_PRELOAD"))return;if(!rn().supportWebCrypto)return void Wd(()=>{L.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!r&&r!==null)throw new Et(ce.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&qi(r,"token",1,2047),qi(e,"appid",1,2047),_R(t),n&&gR(n);let l=Ap();L.debug("preload channel ".concat(t,", uid is ").concat(n));let u={appId:e,cname:t,token:r||e,uid:typeof n!="string"?n:null,sid:l,proxyServer:i},h,m;typeof n=="string"?(u.stringUid=n,[m,h]=await tr.all([yG(n,{sid:l,appId:e},Cb.token),BM(E2(E2({},u),{},{token:r||e,uid:0}),Cb.token)]),u.uid=m.uid,h.gatewayInfo.uid=u.uid,h.gatewayInfo.res.uid=u.uid):(o&&(u.stringUid=o),h=await BM(u,Cb.token));let _={sid:l,appId:e,cname:t,token:r||e,uid:u.stringUid||n,intUid:u.uid||h.gatewayInfo.uid,stringUid:u.stringUid,ts:Date.now(),sua:m,ap:h};await async function(R){let A;try{R.uid&&v2({appId:R.appId,cname:R.cname,token:R.token,uid:R.uid,stringUid:R.stringUid});let D=R2(R),J=await async function(K,se){try{let ue=await window.crypto.subtle.importKey("raw",lP(se),"AES-GCM",!1,["encrypt"]),De=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},ue,Ip(window.btoa(JSON.stringify(K))));return Kd(new Uint8Array(De))}catch{return}}(R,R.token||R.appId);if(!J)return;A=S2(IE);let V=A?JSON.parse(A):[];V.push({[D]:J}),V.length>Se("AP_CACHE_NUM")&&V.shift(),GR(IE,JSON.stringify(V))}catch(D){L.warn("Error caching server parameters:",D.message),GR(IE,"")}}(_),Sb++}catch(l){throw Rb++,function(u){yb||(yb=window.setTimeout(()=>{let m="";FR.forEach((_,R)=>{m+="".concat(R,": ").concat(_," ;")}),gr.reportApiInvoke(null,{name:gi.PRELOAD,options:{success:Sb,failed:Rb,err:m}}).onError(u),Sb=0,Rb=0,FR.clear(),yb=null},jG));let h=FR.get(u.code)||0;FR.set(u.code,h+1)}(l),l}}async function g2(e){try{if(Se("AP_REQUEST_DETAIL")||Se("ENABLE_ROLE_SELECT_EDGE"))return;let t=v2(e);if(!t||e.cloudProxyServer!=="disabled")return;let r=await async function(n,i){try{let o=await window.crypto.subtle.importKey("raw",lP(i),"AES-GCM",!1,["decrypt"]),l=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},o,Ip(n));return JSON.parse(window.atob(Kd(new Uint8Array(l))))}catch{return}}(t,e.token||e.appId);if(!r||!function(n,i){return n.cname===i.cname&&n.appId===i.appId&&n.token===i.token?i.stringUid?n.stringUid===i.stringUid:typeof i.uid=="number"?n.uid===i.uid:n.uid==i.uid:!1}(r,e))return;if(r&&Date.now()-r.ts<Se("AP_CACHE_LIFETIME"))return r}catch(t){L.warn("Error get preloadInfo",t.message)}}function v2(e){let t;try{if(t=S2(IE),!t)return;let r=JSON.parse(t),n=R2(e),i=function(l,u){for(let h=l.length-1;h>=0;h--)if(u(l[h]))return h;return-1}(r,l=>n in l);if(i===-1)return;let o=r.splice(i,1)[0];return GR(IE,JSON.stringify(r)),o[n]}catch(r){L.warn("Error delete preload info: ".concat(t),r.message),GR(IE,"")}}function Ib(e){if(e){let t=Fp.get(e);t&&(window.clearTimeout(t),t=null,Fp.delete(e)),Qt(Gp).call(Gp,e)||e.cloudProxyServer!=="disabled"||Gp.push(e)}if(Fp.size<Se("AP_CACHE_NUM")&&Gp.length>0){let t=Gp.shift();Fp.set(t,window.setTimeout(async()=>{let{appId:r,cname:n,token:i,stringUid:o,uid:l,proxyServer:u}=t;try{await BG(r,n,i,l,u,o),Fp.has(t)&&Ib(t)}catch(h){L.warn("update preload failed",h.message),T2(t)}},Se("AP_UPDATE_INTERVAL")))}}function T2(e){let t=Gp.indexOf(e);t!==-1&&Gp.splice(t,1);let r=Fp.get(e);r&&(window.clearTimeout(r),r=null,Fp.delete(e),Ib())}function y2(e,t){let r=e.sua,n=e.ap;t&&r&&gr.reqUserAccount(e.sid,{lts:r.requestTime,elapse:r.elapse,success:!0,serverAddr:r.url,stringUid:t,uid:e.intUid,errorCode:null,extend:r.req}),gr.reportResourceTiming(e.ap.url,e.sid),gr.joinWebProxyAP(e.sid,{lts:n.requestTime,elapse:n.elapse,sucess:1,apServerAddr:n.url,turnServerAddrList:n.proxyInfo.addresses.map(i=>i.ip).join(","),eventType:"disabled",unilbsServerIds:[fi.CHOOSE_SERVER,fi.CLOUD_PROXY_FALLBACK].toString()}),gr.joinChooseServer(e.sid,{lts:n.requestTime,elapse:n.elapse,succ:!0,csAddr:n.url,opid:n.opid,serverList:n.gatewayInfo.gatewayAddrs.map(i=>i.address),ec:null,cid:n.gatewayInfo.cid.toString(),uid:n.gatewayInfo.uid.toString(),csIp:n.gatewayInfo.csIp,unilbsServerIds:[fi.CHOOSE_SERVER].toString(),isHttp3:n.isHttp3})}function S2(e){return window.atob(window.localStorage.getItem(e)||"")}function GR(e,t){window.localStorage.setItem(e,window.btoa(t))}function R2(e){let t="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(t+="_s_".concat(e.uid)),typeof e.uid=="number"&&(t+="_".concat(e.uid)),e.token&&(t+="_".concat(e.token)),EP(t)}function VG(e){let t=function(){let r=HG.pop();return r?(r.offset=r.limit=0,r):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(r,n){let i=r.appId;i!==void 0&&(_i(n,10),th(n,i));let o=r.cid;o!==void 0&&(_i(n,16),_i(n,o));let l=r.cname;l!==void 0&&(_i(n,26),th(n,l));let u=r.deviceId;u!==void 0&&(_i(n,34),th(n,u));let h=r.elapse;h!==void 0&&(_i(n,40),rh(n,h));let m=r.fileSize;m!==void 0&&(_i(n,48),rh(n,AE(m)));let _=r.height;_!==void 0&&(_i(n,56),rh(n,AE(_)));let R=r.jpg;R!==void 0&&(_i(n,66),_i(n,R.length),I2(n,R));let A=r.networkType;A!==void 0&&(_i(n,72),rh(n,AE(A)));let D=r.osType;D!==void 0&&(_i(n,80),rh(n,AE(D)));let J=r.requestId;J!==void 0&&(_i(n,90),th(n,J));let V=r.sdkVersion;V!==void 0&&(_i(n,98),th(n,V));let K=r.sequence;K!==void 0&&(_i(n,104),rh(n,AE(K)));let se=r.sid;se!==void 0&&(_i(n,114),th(n,se));let ue=r.timestamp;ue!==void 0&&(_i(n,120),rh(n,ue));let De=r.uid;De!==void 0&&(_i(n,128),_i(n,De));let ze=r.vid;ze!==void 0&&(_i(n,136),_i(n,ze));let Ke=r.width;Ke!==void 0&&(_i(n,144),rh(n,AE(Ke)));let Ve=r.service;Ve!==void 0&&(_i(n,152),_i(n,Ve));let _t=r.callbackData;_t!==void 0&&(_i(n,162),_i(n,_t.length),I2(n,_t));let Vt=r.ticket;Vt!==void 0&&(_i(n,170),th(n,Vt));let ar=r.vendorConfigs;ar!==void 0&&(_i(n,178),th(n,ar))}(e,t),function(r){let n=r.bytes,i=r.limit;return n.length===i?n:n.subarray(0,i)}(t)}function FG(e){return function(r){let n={};e:for(;!WG(r);){let i=hv(r);switch(i>>>3){case 0:break e;case 1:n.code=hv(r);break;case 2:n.msg=A2(r,hv(r));break;case 3:n.requestId=A2(r,hv(r));break;case 4:n.timestamp=KG(r,!1);break;default:GG(r,7&i)}}return n}({bytes:t=e,offset:0,limit:t.length});var t}function GG(e,t){switch(t){case 0:for(;128&$s(e););break;case 2:Ab(e,hv(e));break;case 5:Ab(e,4);break;case 1:Ab(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function AE(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let HG=[];function Ab(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function WG(e){return e.offset>=e.limit}function HR(e,t){let r=e.bytes,n=e.offset,i=e.limit,o=n+t;if(o>r.length){let l=new Uint8Array(2*o);l.set(r),e.bytes=l}return e.offset=o,o>i&&(e.limit=o),n}function C2(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function I2(e,t){let r=HR(e,t.length);e.bytes.set(t,r)}function A2(e,t){let r=C2(e,t),n=String.fromCharCode,i=e.bytes,o="�",l="";for(let u=0;u<t;u++){let h,m,_,R,A=i[u+r];128&A?(224&A)==192?u+1>=t?l+=o:(h=i[u+r+1],(192&h)!=128?l+=o:(R=(31&A)<<6|63&h,R<128?l+=o:(l+=n(R),u++))):(240&A)==224?u+2>=t?l+=o:(h=i[u+r+1],m=i[u+r+2],(49344&(h|m<<8))!=32896?l+=o:(R=(15&A)<<12|(63&h)<<6|63&m,R<2048||R>=55296&&R<=57343?l+=o:(l+=n(R),u+=2))):(248&A)==240?u+3>=t?l+=o:(h=i[u+r+1],m=i[u+r+2],_=i[u+r+3],(12632256&(h|m<<8|_<<16))!=8421504?l+=o:(R=(7&A)<<18|(63&h)<<12|(63&m)<<6|63&_,R<65536||R>1114111?l+=o:(R-=65536,l+=n(55296+(R>>10),56320+(1023&R)),u+=3))):l+=o:l+=n(A)}return l}function th(e,t){let r=t.length,n=0;for(let l=0;l<r;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<r&&(u=(u<<10)+t.charCodeAt(++l)-56613888),n+=u<128?1:u<2048?2:u<65536?3:4}_i(e,n);let i=HR(e,n),o=e.bytes;for(let l=0;l<r;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<r&&(u=(u<<10)+t.charCodeAt(++l)-56613888),u<128?o[i++]=u:(u<2048?o[i++]=u>>6&31|192:(u<65536?o[i++]=u>>12&15|224:(o[i++]=u>>18&7|240,o[i++]=u>>12&63|128),o[i++]=u>>6&63|128),o[i++]=63&u|128)}}function $s(e){return e.bytes[C2(e,1)]}function b2(e,t){let r=HR(e,1);e.bytes[r]=t}function hv(e){let t,r=0,n=0;do t=$s(e),r<32&&(n|=(127&t)<<r),r+=7;while(128&t);return n}function _i(e,t){for(t>>>=0;t>=128;)b2(e,127&t|128),t>>>=7;b2(e,t)}function KG(e,t){let r,n=0,i=0,o=0;return r=$s(e),n=127&r,128&r&&(r=$s(e),n|=(127&r)<<7,128&r&&(r=$s(e),n|=(127&r)<<14,128&r&&(r=$s(e),n|=(127&r)<<21,128&r&&(r=$s(e),i=127&r,128&r&&(r=$s(e),i|=(127&r)<<7,128&r&&(r=$s(e),i|=(127&r)<<14,128&r&&(r=$s(e),i|=(127&r)<<21,128&r&&(r=$s(e),o=127&r,128&r&&(r=$s(e),o|=(127&r)<<7))))))))),{low:n|i<<28,high:i>>>4|o<<24,unsigned:t}}function rh(e,t){let r=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=i===0?n===0?r<16384?r<128?1:2:r<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10,l=HR(e,o),u=e.bytes;switch(o){case 10:u[l+9]=i>>>7&1;case 9:u[l+8]=o!==9?128|i:127&i;case 8:u[l+7]=o!==8?n>>>21|128:n>>>21&127;case 7:u[l+6]=o!==7?n>>>14|128:n>>>14&127;case 6:u[l+5]=o!==6?n>>>7|128:n>>>7&127;case 5:u[l+4]=o!==5?128|n:127&n;case 4:u[l+3]=o!==4?r>>>21|128:r>>>21&127;case 3:u[l+2]=o!==3?r>>>14|128:r>>>14&127;case 2:u[l+1]=o!==2?r>>>7|128:r>>>7&127;case 1:u[l]=o!==1?128|r:127&r}}let O2={},N2={},WR=4294967296,zG=WR*WR,qG=zG/2;D2(0,!0);let w2=D2(0),YG=pv(0,-2147483648,!1),XG=pv(-1,2147483647,!1);function D2(e,t){let r,n,i;return t?(i=0<=(e>>>=0)&&e<256)&&(n=N2[e],n)?n:(r=pv(e,0,!0),i&&(N2[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(n=O2[e],n)?n:(r=pv(e,e<0?-1:0,!1),i&&(O2[e]=r),r)}function pv(e,t,r){return{low:0|e,high:0|t,unsigned:!!r}}function P2(e,t){if(isNaN(e))return w2;{if(e<=-9223372036854776e3)return YG;if(e+1>=qG)return XG}return e<0?w2:pv(e%WR|0,e/WR|0,t)}function L2(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}class bb extends zn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let r=this._connectionState;this._connectionState=t,this.emit(Fc.CONNECTION_STATE_CHANGE,t,r)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var r;super(),ie(this,"name","AgoraRTCImageModeration"),ie(this,"_connectionState",ms.CONNECTING),ie(this,"_sequence",0),ie(this,"_moderationStartTime",void 0),ie(this,"_workerConnection",void 0),ie(this,"_workerMessageLengthLimit",void 0),ie(this,"_qualityRatio",void 0),ie(this,"_connectInfo",void 0),ie(this,"_cancelTokenSource",Ha.CancelToken.source()),ie(this,"_retryConfig",void 0),ie(this,"_moderationInterval",void 0),ie(this,"_moderationTimer",null),ie(this,"_moderationMode",1),ie(this,"_quality",1),ie(this,"_qualityTimer",null),ie(this,"_ticket",void 0),ie(this,"_moderationIntervalMinimum",void 0),ie(this,"_uploadFailedNum",0),ie(this,"_uploadNum",0),ie(this,"_uploadTimer",null),ie(this,"_extraInfo",void 0),ie(this,"_vendor",""),ie(this,"_encoder",new TextEncoder),ie(this,"_moderationId",void 0),ie(this,"inspectImage",()=>{if(this.connectionState!==ms.CONNECTED)throw new at(ce.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ms.CONNECTED?this.requestToInspectImage():L.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=On(5,"image-moderation-"),this._workerMessageLengthLimit=Se("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=Se("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),this._qualityRatio=Se("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new rv("worker-"+this._moderationId,vi),this.on(Fc.STATE_CHANGE,(n,i)=>{L.debug("[".concat(this._moderationId,"] Moderation operation :").concat(mE[n]," ").concat(i||""))}),this.handleWorkerEvents()}async init(t,r){this.emit(Fc.STATE_CHANGE,mE.CONNECT_AP),this._connectInfo=t;let n=this._cancelTokenSource.token;return this._retryConfig=r,new tr((i,o)=>{this.on(Fc.CONNECTION_STATE_CHANGE,(l,u)=>{l===ms.CONNECTED&&i()}),this.requestAP(t,n,r).then(l=>{this.connectWorker(l)}).catch(l=>{o(l)})})}updateConfig(t){var r;this._moderationInterval=(r=t.interval)!==null&&r!==void 0?r:1e3,t.extraInfo&&(this._extraInfo=this._encoder.encode(t.extraInfo)),t.vendor&&(this._vendor=t.vendor),L.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===ms.CONNECTED&&this.inspectImage()}async requestAP(t,r,n){let i=Se("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),o=await function(h,m,_,R){let{appId:A,areaCode:D,cname:J,sid:V,token:K,uid:se}=m;yE++;let ue="moderation_plugin",De={service_name:ue,json_body:JSON.stringify({appId:A,areaCode:D,cname:J,command:"allocateEdge",requestId:yE,seq:yE,sid:V,appToken:K,ts:Date.now(),uid:se+""})},ze,Ke,Ve=h[0];return xc(async()=>{ze=Date.now();let _t=await Gc(Ve,{data:De,cancelToken:_,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(Ke=Date.now()-ze,_t.code!==0){let ur=new at(ce.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+_t.code,{retry:!0,responseTime:Ke});throw L.error(ur.toString()),ur}let Vt=JSON.parse(_t.json_body);if(Vt.code!==200){let ur=new at(ce.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(Vt.code,", reason: ").concat(Vt.reason),{code:Vt.code,responseTime:Ke});throw L.error(ur.toString()),ur}if(!Vt.servers||!Array.isArray(Vt.servers)||Vt.servers.length===0){let ur=new at(ce.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:Vt.code,responseTime:Ke});throw L.error(ur.toString()),ur}if(!Vt.servers.some(ur=>!!ur.wss)){let ur=new at(ce.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:Vt.code,responseTime:Ke});throw L.error(ur.toString()),ur}let ar=Se("IMAGE_MODERATION_WORKER_HOST");return{addressList:Vt.servers.map(ur=>{let{address:Kr,wss:zr}=ur;if(Kr&&zr)return"wss://".concat(Kr.replace(/\./g,"-"),".").concat(ar,":").concat(zr,"/moderation")}).filter(ur=>!!ur),workerToken:Vt.workerToken,vid:Vt.vid,ticket:Vt.appTicket,responseTime:Ke}},(_t,Vt)=>(gr.apworkerEvent(V,{success:!0,sc:200,serviceName:ue,responseDetail:JSON.stringify(_t.addressList),firstSuccess:Vt===0,responseTime:Ke,serverIp:h[Vt%h.length]}),!1),(_t,Vt)=>(gr.apworkerEvent(V,{success:!1,sc:_t.data&&_t.data.code||200,serviceName:ue,responseTime:Ke,serverIp:h[Vt%h.length]}),!!(_t.code!==ce.OPERATION_ABORTED&&_t.code!==ce.UNEXPECTED_RESPONSE||_t.data&&_t.data.retry)&&(Ve=h[(Vt+1)%h.length],!0)),R)}(i,t,r,n);this.emit(Fc.STATE_CHANGE,mE.AP_CONNECTED);let{addressList:l,ticket:u}=o;return this._ticket=u,l}async connectWorker(t){this.emit(Fc.STATE_CHANGE,mE.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Ur.CONNECTED,async()=>{this.emit(Fc.STATE_CHANGE,mE.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ms.CONNECTED}),this._workerConnection.on(Ur.CLOSED,()=>{this.connectionState=ms.CLOSED}),this._workerConnection.on(Ur.FAILED,()=>{this.connectionState=ms.CLOSED}),this._workerConnection.on(Ur.RECONNECTING,()=>{this.connectionState=this.connectionState===ms.CONNECTED?ms.RECONNECTING:ms.CONNECTING}),this._workerConnection.on(Ur.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let r=FG(new Uint8Array(t.data));Se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(r)),this._uploadNum++,r.code===void 0||r.code===0||(this._uploadFailedNum++,L.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(r.code,", msg is ").concat(r.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{gr.reportApiInvoke(this._connectInfo.sid||null,{name:gi.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,r.code],tag:Jn.TRACER}).onError(new at(ce.IMAGE_MODERATION_UPLOAD_FAILED,r.msg)),this._uploadTimer=null},Se("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else L.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ur.WILL_RECONNECT,(t,r,n)=>{t==="recover"&&n(t),n("tryNext")}),this._workerConnection.on(Ur.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){let t=Lo(this,Fc.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(Se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("Only the track being played can be inspected"));this._sequence++;let n=await this.generateRequestData(t,r);this._workerConnection.sendMessage(n,!0,!0)}else Se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&L.debug("Only the track being published can be inspected")}async generateRequestData(t,r){let{appId:n,cname:i,cid:o,vid:l,sid:u,uid:h}=r,m=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),R=await aL(_,n,i),A=this._sequence+"-"+o+"-"+h+"-"+m+"-"+On(12,""),D={appId:n,cid:o,cname:i,deviceId:"",elapse:bb.intToLong(Number(m-this._moderationStartTime)),fileSize:_.buffer.byteLength,height:_.height,width:_.width,jpg:R,networkType:6,osType:7,requestId:A,sdkVersion:"4.23.2",sequence:this._sequence,sid:u,timestamp:P2(m),uid:h,vid:l,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete D.callbackData;let J=VG(D);if(J.byteLength<this._workerMessageLengthLimit){if(Se("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){let V=function(K){for(var se=1;se<arguments.length;se++){var ue=arguments[se]!=null?arguments[se]:{};se%2?L2(Object(ue),!0).forEach(function(De){ie(K,De,ue[De])}):Object.getOwnPropertyDescriptors?Object.defineProperties(K,Object.getOwnPropertyDescriptors(ue)):L2(Object(ue)).forEach(function(De){Object.defineProperty(K,De,Object.getOwnPropertyDescriptor(ue,De))})}return K}({},D);delete V.jpg,L.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(V))}return J}{let V=this.quality*this._qualityRatio;return this.quality=V,await this.generateRequestData(t,{appId:n,cname:i,cid:o,vid:l,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ha.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ms.CLOSED,this.emit(Fc.STATE_CHANGE,mE.CLOSED)}}function k2(e){if(vn(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new at(ce.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new at(ce.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}let JG={name:"ImageModeration",create:function(e){let{config:t}=e;return k2(t),new bb(t)}};var M2,U2,x2,j2,B2,V2,F2,G2,H2,W2,K2,z2,q2,Y2,X2,J2,Z2,Q2,$2,eU,tU,rU,nU,iU,aU,oU,sU,cU,lU,uU,dU,hU,pU,fU,mU,EU,_U,gU,vU,TU,yU,sr;function SU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ec(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SU(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}da.setLogger(L);let ZG=(M2=Nr(),U2=Nr({argsMap:(e,t)=>{if(!Array.isArray(t)){if(!(t instanceof sE))return[t];t=[t]}return t.map(r=>r?Object(r).toString():"null")}}),x2=Nr({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||t.trackMediaType!==oE.DATA?(Array.isArray(t)||(t=[t]),t.map(r=>r.getTrackId())):[t.getChannelId()])}),j2=Nr({argsMap:(e,t,r,n)=>[typeof t=="object"?t.uid:t,r,n]}),B2=Nr({argsMap:(e,t,r)=>[t,r]}),V2=Nr({argsMap:(e,t)=>t.map(r=>{let{user:n,mediaType:i}=r;return[n?.uid,i]})}),F2=Nr({argsMap:(e,t,r,n)=>[typeof t=="object"?t.uid:t,r,n]}),G2=Nr({argsMap:(e,t)=>t.map(r=>{let{user:n,mediaType:i}=r;return{uid:n?.uid,mediaType:i}})}),H2=Nr(),W2=Nr(),K2=Nr(),z2=Nr(),q2=Nr(),Y2=Nr(),X2=Nr(),J2=Nr(),Z2=Nr(),Q2=Nr(),$2=Nr(),eU=Nr(),tU=Nr(),rU=Nr(),nU=Nr(),iU=Nr({argsMap:(e,t)=>[t]}),aU=Nr(),oU=Nr(),sU=Nr(),cU=Nr(),lU=Nr(),uU=Nr(),dU=Nr(),hU=Nr(),pU=Nr({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),fU=Nr(),mU=Nr(),EU=Nr(),_U=Nr(),gU=Nr(),vU=Nr(),TU=Nr({reportResult:!0}),yU=Nr(),sr=class extends zn{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,t){let r;if(super(),ie(this,"store",void 0),ie(this,"_uid",void 0),ie(this,"_channelName",void 0),ie(this,"_uintUid",void 0),ie(this,"_users",[]),ie(this,"_config",void 0),ie(this,"_clientId",void 0),ie(this,"_appId",void 0),ie(this,"_sessionId",null),ie(this,"_key",void 0),ie(this,"_rtmConfig",{}),ie(this,"_joinInfo",void 0),ie(this,"_gateway",void 0),ie(this,"_statsCollector",void 0),ie(this,"_configDistribute",void 0),ie(this,"_leaveMutex",void 0),ie(this,"_publishMutex",void 0),ie(this,"_renewTokenMutex",void 0),ie(this,"_subscribeMutex",void 0),ie(this,"_encryptionMode","none"),ie(this,"_encryptionSecret",null),ie(this,"_encryptionSalt",null),ie(this,"_encryptDataStream",!1),ie(this,"_encryptDataStreamKey",null),ie(this,"_encryptDataStreamIv",null),ie(this,"_proxyServer",void 0),ie(this,"_turnServer",{servers:[],mode:"auto"}),ie(this,"_cloudProxyServerMode","disabled"),ie(this,"_isDualStreamEnabled",!1),ie(this,"_defaultStreamFallbackType",void 0),ie(this,"_lowStreamParameter",void 0),ie(this,"_streamFallbackTypeCacheMap",new Map),ie(this,"_remoteStreamTypeCacheMap",new Map),ie(this,"_axiosCancelSource",Ha.CancelToken.source()),ie(this,"_audioVolumeIndicationInterval",void 0),ie(this,"_networkQualityInterval",void 0),ie(this,"_userOfflineTimeout",void 0),ie(this,"_streamRemovedTimeout",void 0),ie(this,"_liveTranscodeStreamingClient",void 0),ie(this,"_liveRawStreamingClient",void 0),ie(this,"_channelMediaRelayClient",void 0),ie(this,"_networkQualitySensitivity","normal"),ie(this,"_p2pChannel",void 0),ie(this,"_useLocalAccessPoint",!1),ie(this,"_setLocalAPVersion",void 0),ie(this,"_joinAndNotLeaveYet",!1),ie(this,"_numberOfJoinCount",0),ie(this,"_remoteDefaultVideoStreamType",void 0),ie(this,"_inspect",void 0),ie(this,"_moderation",void 0),ie(this,"_license",void 0),ie(this,"_pendingPublishedUsers",[]),ie(this,"ntpAlignErrorCount",0),ie(this,"remoteInboundOffset",0),ie(this,"_peerConnectionState",void 0),ie(this,"_handleLocalTrackEnable",(i,o,l)=>{this.publish(i,!1).then(o).catch(l)}),ie(this,"_handleLocalTrackDisable",(i,o,l)=>{this.unpublish(i).then(o).catch(l)}),ie(this,"_handleUserOnline",i=>{if(Se("BLOCK_LOCAL_CLIENT")&&kp(i.uid,this.channelName))return void L.debug("[".concat(i.uid,"] will be ignored in local"));this.isStringUID&&typeof i.uid!="string"&&L.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));let o=this._users.find(l=>l.uid===i.uid);if(o)o._trust_in_room_=!0,o._is_pre_created&&(o._is_pre_created=!1,this.safeEmit(Gr.USER_JOINED,o));else{let l=new $d(i.uid,i.uint_id||i.uid);this._users.push(l),L.debug("[".concat(this._clientId,"] user online"),i.uid),this.safeEmit(Gr.USER_JOINED,l)}}),ie(this,"_handleUserOffline",i=>{if(Se("BLOCK_LOCAL_CLIENT")&&kp(i.uid,this.channelName))return;let o=this._users.find(l=>l.uid===i.uid);o&&(this._handleRemoveStream(i),this._handleRemoveDataChannels(i),o._audio_pre_subscribed||o._video_pre_subscribed?o._is_pre_created=!0:zS(this._users,o),this._remoteStreamTypeCacheMap.delete(o.uid),this._streamFallbackTypeCacheMap.delete(o.uid),L.debug("[".concat(this._clientId,"] user offline"),i.uid,"reason:",i.reason),this.safeEmit(Gr.USER_LEAVED,o,i.reason))}),ie(this,"_handleAddAudioOrVideoStream",(i,o,l,u,h,m,_)=>{if(Se("BLOCK_LOCAL_CLIENT")&&kp(o,this.channelName))return;let R=this._users.find(D=>D.uid===o);if(!R)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));L.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(R.uid,i,void 0,void 0,void 0,Date.now());let A=i==="audio"?R.hasAudio:R.hasVideo;R._uintid||(R._uintid=h||o),i==="audio"?R._trust_audio_stream_added_state_=!0:R._trust_video_stream_added_state_=!0,i==="audio"?(R._audio_added_=!0,l!==void 0&&(R._audioSSRC=l),u!==void 0&&(R._cname=u),m&&(R._audioOrtc=m)):(R._video_added_=!0,l!==void 0&&(R._videoSSRC=l),u!==void 0&&(R._cname=u),_!==void 0&&(R._rtxSsrcId=_),m&&(R._videoOrtc=m)),(i==="audio"?R.hasAudio:R.hasVideo)&&!A&&(L.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published ").concat(i)),this.safeEmit(Gr.USER_PUBLISHED,R,i)),i==="video"?gr.onGatewayStream(this._sessionId,Pi.ON_ADD_VIDEO_STREAM,Hn.ON_ADD_VIDEO_STREAM,{peer:h||o,ssrc:R._videoSSRC}):gr.onGatewayStream(this._sessionId,Pi.ON_ADD_AUDIO_STREAM,Hn.ON_ADD_AUDIO_STREAM,{peer:h||o,ssrc:R._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(R,i,l).then(D=>{if(D&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(R.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof dv))return this._p2pChannel.unsubscribe(R,i,!0).then(()=>this._subscribe(R,i,!0).catch(J=>{L.error("[".concat(this._clientId,"] resubscribe error"),J.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(R,i)&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(R.uid," after reconnect.")),this._subscribe(R,i,!0).catch(D=>{L.error("[".concat(this._clientId,"] resubscribe error"),D.toString())}))}),ie(this,"_handleRemoveStream",i=>{if(Se("BLOCK_LOCAL_CLIENT")&&kp(i.uid,this.channelName))return;let o=this._users.find(u=>u.uid===i.uid);if(!o)return void L.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));L.debug("[".concat(this._clientId,"] stream removed with uid ").concat(i.uid));let l=()=>{};o.hasAudio&&o.hasVideo?l=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(Gr.USER_UNPUBLISHED,o,"audio"),L.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(Gr.USER_UNPUBLISHED,o,"video")}:o.hasVideo?l=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished video track")),this.safeEmit(Gr.USER_UNPUBLISHED,o,"video")}:o.hasAudio&&(l=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished audio track")),this.safeEmit(Gr.USER_UNPUBLISHED,o,"audio")}),o._video_pre_subscribed||o._audio_pre_subscribed||(o._trust_audio_stream_added_state_=!0,o._trust_video_stream_added_state_=!0,o._audio_added_=!1,o._video_added_=!1,this._p2pChannel instanceof dv&&this._p2pChannel.unsubscribe(o).then(u=>{if(u)return this._gateway.unsubscribe(u,o.uid)}),o._audioSSRC=void 0,o._videoSSRC=void 0,o._audioOrtc=void 0,o._videoOrtc=void 0,o._rtxSsrcId=void 0),gr.onGatewayStream(this._sessionId,Pi.ON_REMOVE_STREAM,Hn.ON_REMOVE_STREAM,{peer:i.uint_id||i.uid}),l()}),ie(this,"_handleSetStreamLocalEnable",(i,o,l)=>{if(Se("BLOCK_LOCAL_CLIENT")&&kp(o,this.channelName))return;let u=this._users.find(_=>_.uid===o);if(!u)return void L.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));L.debug("[".concat(this._clientId,"] local ").concat(i," ").concat(l?"enabled":"disabled"," with uid ").concat(o));let h=i==="audio"?u.hasAudio:u.hasVideo;if(i==="audio"){u._trust_audio_enabled_state_=!0;let _=u._audio_enabled_;if(u._audio_enabled_=l,u._audio_enabled_===_)return;{let R=u._audio_enabled_?"enable-local-audio":"disable-local-audio";L.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(o,", msg: ").concat(R)),this.safeEmit(Gr.USER_INFO_UPDATED,o,R)}}else{u._trust_video_enabled_state_=!0;let _=u._video_enabled_;if(u._video_enabled_=l,u._video_enabled_===_)return;{let R=u._video_enabled_?"enable-local-video":"disable-local-video";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(o,", msg: ").concat(R)),this.safeEmit(Gr.USER_INFO_UPDATED,o,R)}}let m=i==="audio"?u.hasAudio:u.hasVideo;return h!==m?!h&&m?(L.info("[".concat(this._clientId,"] remote user ").concat(o," published ").concat(i)),void this.safeEmit(Gr.USER_PUBLISHED,u,i)):(i==="video"&&u._videoTrack&&u._videoTrack._destroy(),i==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,i),L.info("[".concat(this._clientId,"] remote user ").concat(o," unpublished ").concat(i)),void this.safeEmit(Gr.USER_UNPUBLISHED,u,i)):void 0}),ie(this,"_handleMuteStream",(i,o,l)=>{if(Se("BLOCK_LOCAL_CLIENT")&&kp(i,this.channelName))return;L.debug("[".concat(this._clientId,"] receive mute message"),i,o,l);let u=this._users.find(_=>_.uid===i);if(!u)return void L.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i));let h=o==="audio"?u.hasAudio:u.hasVideo;if(o==="audio"){u._trust_audio_mute_state_=!0;let _=u._audio_muted_;if(u._audio_muted_=l,u._audio_muted_===_)return;{let R=u._audio_muted_?"mute-audio":"unmute-audio";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(R)),this.safeEmit(Gr.USER_INFO_UPDATED,i,R)}}else{u._trust_video_mute_state_=!0;let _=u._video_muted_;if(u._video_muted_=l,u._video_muted_===_)return;{let R=u._video_muted_?"mute-video":"unmute-video";L.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(i,", msg: ").concat(R)),this.safeEmit(Gr.USER_INFO_UPDATED,i,R)}}let m=o==="audio"?u.hasAudio:u.hasVideo;if(h!==m){if(!h&&m)return(o==="audio"?u._audioSSRC:u._videoSSRC)?(L.info("[".concat(this._clientId,"] remote user ").concat(i," published ").concat(o)),void this.safeEmit(Gr.USER_PUBLISHED,u,o)):void L.warning("[".concat(this._clientId,"] remote user ").concat(i," receive ").concat(o," unmute message  before add stream message, ").concat(o," SSRC doesn't exist yet."));o==="video"&&u._videoTrack&&!u._video_pre_subscribed&&u._videoTrack._destroy(),o==="audio"&&u._audioTrack,this._p2pChannel.muteRemote(u,o),L.info("[".concat(this._clientId,"] remote user ").concat(i," unpublished ").concat(o)),this.safeEmit(Gr.USER_UNPUBLISHED,u,o)}}),ie(this,"_handleP2PLost",async i=>{L.debug("[".concat(this._clientId,"] receive p2p lost"),i),parseInt(i.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():L.warning("[".concat(this._clientId,"] P2PLost stream not found"),i)}),ie(this,"_handleTokenWillExpire",()=>{L.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Gr.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),ie(this,"_handleBeforeUnload",i=>{i.type==="beforeunload"&&i.returnValue!==void 0&&i.returnValue!==""||(this.leave(),L.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),ie(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Gr.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});let i={downlinkNetworkQuality:0,uplinkNetworkQuality:0};i.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),i.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Gr.NETWORK_QUALITY,i)}),ie(this,"_handleP2PAddAudioOrVideoStream",(i,o,l,u)=>{let h=this._users.find(_=>_.uid===o);if(!h)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));L.debug("[".concat(this._clientId,"] stream added with uid ").concat(o,", type ").concat(i)),this.store.subscribe(h.uid,i,void 0,void 0,void 0,Date.now());let m=i==="audio"?h.hasAudio:h.hasVideo;i==="audio"?h._trust_audio_stream_added_state_=!0:h._trust_video_stream_added_state_=!0,i==="audio"?(h._audio_added_=!0,l!==void 0&&(h._audioSSRC=l),u!==void 0&&(h._audioMid=u)):(h._video_added_=!0,l!==void 0&&(h._videoSSRC=l),u!==void 0&&(h._videoMid=u)),(i==="audio"?h.hasAudio:h.hasVideo)&&!m&&(L.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published ").concat(i)),this.safeEmit(Gr.USER_PUBLISHED,h,i)),this._p2pChannel.hasPendingRemoteMedia(h,i)&&(L.debug("[".concat(this._clientId,"] resubscribe ").concat(i," for user ").concat(h.uid," after reconnect.")),this._subscribe(h,i,!0).catch(_=>{L.error("[".concat(this._clientId,"] resubscribe error"),_.toString())}))}),this._config=e,this._clientId=t||On(5,"client-"),this.store=new class{constructor(i,o,l,u){kr(this,"state",void 0),this.state={codec:i,audioCodec:o,mode:l,clientId:u,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:bp.Default,hasStartJoinChannel:!1,isABTestSuccess:!1}}dispatch(i){this.state=function(o,l){switch(l.type){case Hr.SET_SESSION_ID:return cr(cr({},o),{},{sessionId:l.sessionId});case Hr.SET_P2P_ID:return cr(cr({},o),{},{p2pId:l.p2pId});case Hr.SET_UID:return cr(cr({},o),{},{uid:l.uid});case Hr.SET_INT_UID:return cr(cr({},o),{},{intUid:l.intUid});case Hr.SET_PUB_ID:return cr(cr({},o),{},{pubId:l.pubId});case Hr.KEY_METRIC_CLIENT_CREATED:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{clientCreated:l.metric})});case Hr.KEY_METRIC_JOIN_START:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{joinStart:l.metric})});case Hr.AVOID_JOIN_START:return cr(cr({},o),{},{avoidJoinStart:l.avoidJoinStart});case Hr.KEY_METRIC_JOIN_END:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{joinEnd:l.metric})});case Hr.KEY_METRIC_REQUEST_AP_START:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{requestAPStart:l.metric})});case Hr.KEY_METRIC_REQUEST_AP_END:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{requestAPEnd:l.metric})});case Hr.KEY_METRIC_JOIN_GATEWAY_START:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{joinGatewayStart:l.metric})});case Hr.KEY_METRIC_JOIN_GATEWAY_END:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{joinGatewayEnd:l.metric})});case Hr.KEY_METRIC_PEER_CONNECTION_START:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{peerConnectionStart:l.metric})});case Hr.KEY_METRIC_PEER_CONNECTION_END:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{peerConnectionEnd:l.metric})});case Hr.KEY_METRIC_DESCRIPTION_START:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{descriptionStart:l.metric})});case Hr.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{signalChannelOpen:l.metric})});case Hr.KEY_METRIC_ICE_CONNECTION_END:return cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{iceConnectionEnd:l.metric})});case Hr.KEY_METRIC_PUBLISH:{let u=o.keyMetrics.publish,h=u.findIndex(m=>m.trackId===l.metric.trackId);return h!==-1?(u[h]=cr(cr({},u[h]),l.metric),cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{publish:[...u]})})):cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{publish:[...o.keyMetrics.publish,l.metric]})})}case Hr.KEY_METRIC_SUBSCRIBE:{let u=o.keyMetrics.subscribe,h=u.findIndex(m=>m.userId===l.metric.userId&&m.type===l.metric.type);return h!==-1?(u[h]=cr(cr({},u[h]),l.metric),cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{subscribe:[...u]})})):cr(cr({},o),{},{keyMetrics:cr(cr({},o.keyMetrics),{},{subscribe:[...o.keyMetrics.subscribe,l.metric]})})}case Hr.SET_CLOUD_PROXY_SERVER_MODE:return o.cloudProxyServerMode=l.mode,o;case Hr.RECORD_JOIN_CHANNEL_SERVICE:return typeof l.index!="number"?o.joinChannelServiceRecords=[...o.joinChannelServiceRecords,l.record]:(o.joinChannelServiceRecords[l.index]=cr(cr({},o.joinChannelServiceRecords[l.index]),l.record),o.joinChannelServiceRecords=[...o.joinChannelServiceRecords]),o;case Hr.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return o.joinChannelServiceRecords=[],o;case Hr.RESET_KEY_METRICS:return o.keyMetrics={publish:[],subscribe:[]},o;case Hr.SET_USE_P2P:return cr(cr({},o),{},{useP2P:l.val});case Hr.SET_TRANSPORT_TYPE:return cr(cr({},o),{},{p2pTransport:l.val});default:return o}}(this.state,i)}set sessionId(i){this.dispatch({type:Hr.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set cid(i){this.state.cid=i}get cid(){return this.state.cid}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:Hr.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:Hr.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:Hr.SET_UID,uid:i})}get uid(){return this.state.uid}set intUid(i){this.dispatch({type:Hr.SET_INT_UID,intUid:i})}get intUid(){return this.state.intUid}set pubId(i){this.dispatch({type:Hr.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:Hr.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(i){this.dispatch({type:Hr.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}set p2pTransport(i){this.dispatch({type:Hr.SET_TRANSPORT_TYPE,val:i})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(i){this.state.hasStartJoinChannel=i}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(i){this.state.isABTestSuccess=i}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:Hr.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:Hr.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:Hr.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:Hr.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:Hr.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:Hr.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:Hr.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:Hr.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:Hr.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:Hr.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:Hr.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:Hr.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,o,l,u){this.dispatch({type:Hr.KEY_METRIC_PUBLISH,metric:cr(cr({trackId:i,type:o},l&&{publishStart:l}),u&&{publishEnd:u})})}subscribe(i,o,l,u,h,m,_){this.dispatch({type:Hr.KEY_METRIC_SUBSCRIBE,metric:cr(cr(cr(cr(cr({userId:i,type:o},l&&{subscribeStart:l}),u&&{subscribeEnd:u}),h&&{firstFrame:h}),m&&{streamAdded:m}),_&&{firstDecoded:_})})}massSubscribe(i,o,l,u){i.forEach(h=>{this.dispatch({type:Hr.KEY_METRIC_SUBSCRIBE,metric:cr(cr(cr({userId:h.userId,type:h.type},o&&{subscribeStart:o}),l&&{subscribeEnd:l}),u&&{firstFrame:u})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,o){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(l=>l.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof o!="number"?(this.dispatch({type:Hr.RECORD_JOIN_CHANNEL_SERVICE,record:cr(cr({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(o<0||o>=this.state.joinChannelServiceRecords.length||this.dispatch({type:Hr.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:o}),o)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:Hr.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:Hr.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(i){this.dispatch({type:Hr.AVOID_JOIN_START,avoidJoinStart:i})}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new da("client-leave",this._clientId),this._publishMutex=new da("client-publish",this._clientId),this._renewTokenMutex=new da("client-renewtoken",this._clientId),this._subscribeMutex=new da("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),L.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(hs," build: ").concat(vA,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{oA(e.clientRoleOptions),r=Object.assign({},e.clientRoleOptions)}catch(i){L.warning("[".concat(this._clientId,"] ").concat(i.toString()))}var n;this._statsCollector=new lv(this.store),this._statsCollector.onStatsException=(i,o,l)=>{L.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(i,", msg: ").concat(o,", uid: ").concat(l)),this.safeEmit(Gr.EXCEPTION,{code:i,msg:o,uid:l})},this._statsCollector.onUploadPublishDuration=(i,o,l,u)=>{let h=this._users.find(m=>m.uid===i);h&&gr.peerPublishStatus(this._sessionId,{subscribeElapse:u,audioPublishDuration:o,videoPublishDuration:l,peer:h._uintid})},this.store.useP2P=e.mode==="p2p",this._gateway=new mG(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||vi,httpRetryConfig:e.httpRetryConfig||vi,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:r}),this._configDistribute=new IG(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(n={store:this.store,statsCollector:this._statsCollector},ju("P2PChannel").create(n)),this._handleP2PEvents()):this._p2pChannel=new dv(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,t,r,n,i){let o=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],l=arguments.length>6&&arguments[6]!==void 0&&arguments[6];pn("JOIN_GATEWAY_USE_443PORT_ONLY",o),pn("JOIN_GATEWAY_USE_DUAL_DOMAIN",l);let u=this._gateway.signal.websocket;return u instanceof QA&&(u.use443PortOnly=o,u.tryDoubleDomain=l),async function(h,m,_){FS.get(h)||FS.set(h,[]),GS.get(h)||GS.set(h,m),wl.get(h)||wl.set(h,0);let R=FS.get(h),A=GS.get(h);if(!R||!A)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(wl.get(h)===A){let se=Vg();R.push(se),await se.promise}wl.set(h,wl.get(h)+1);for(var D=arguments.length,J=new Array(D>3?D-3:0),V=3;V<D;V++)J[V-3]=arguments[V];let K=await _(...J);return wl.set(h,wl.get(h)-1),wl.get(h)===A-1&&R.length>0&&(R[0].resolve(),R.shift()),wl.get(h)===0&&(FS.set(h,[]),GS.set(h,0),wl.set(h,0)),K}("client.join",Se("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,t,r,n,i)}async join(e,t,r,n,i){let o=++this._numberOfJoinCount;this.store.joinStart(),n&&(this.store.uid=n);let l=(XS||XS||(XS=(window.location.protocol.split(":")[0]||"").toUpperCase(),XS))==="HTTPS",u=vP()?window.isSecureContext:"Browser Not Support";(!vP()&&!l||!window.isSecureContext)&&L.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser"),this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),L.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart))),gr.setAppId(e);try{if(!r&&r!==null)throw new at(ce.INVALID_PARAMS,"Invalid token: ".concat(r,". If you don not use token, set it to null"));r&&qi(r,"token",1,2047),qi(e,"appid",1,2047),_R(t),n&&gR(n),i&&qi(i,"optionalInfo",1,2047)}catch(V){throw gr.reportApiInvoke(Ap(),{name:gi.JOIN,options:[e,t,r,n],states:{isHttps:l,isSecureContext:u},tag:Jn.TRACER}).onError(V),V}if(this._leaveMutex.isLocked&&(L.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),L.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){let V=new at(ce.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw gr.reportApiInvoke(Ap(),{name:gi.JOIN,options:[e,t,r,n],states:{isHttps:l,isSecureContext:u},tag:Jn.TRACER}).onError(V),V}this._gateway.state="CONNECTING";let h=await g2({appId:e,cname:t,uid:n,stringUid:typeof n=="string"?n:void 0,token:r||e,cloudProxyServer:this._cloudProxyServerMode});if(!this._joinAndNotLeaveYet)throw new at(ce.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));let m=h?.sid||Ap();L.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._sessionId||(this._sessionId=m,this.store.sessionId=this._sessionId);let _=gr.reportApiInvoke(m,{id:this._clientId,name:gi.JOIN,options:[e,t,r,n],states:{isHttps:l,isSecureContext:u},tag:Jn.TRACER}),R=ec(ec(ec({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof n!="string"?n:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:r||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!h},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:Se("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&(R.setLocalAPVersion=this._setLocalAPVersion),typeof n=="string"&&(R.stringUid=n,this._uintUid?(R.uid=this._uintUid,this._uintUid=void 0):R.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(R.aesmode=this._encryptionMode,R.aespassword=await(async V=>{let K=function(ze){let Ke=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),Ve=new Uint8Array(new ArrayBuffer(Ke.length));for(let _t=0;_t<Ke.length;_t+=1)Ve[_t]=Ke.charCodeAt(_t);return Ve}(),se=await window.crypto.subtle.importKey("spki",K,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),ue=iA(V),De=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},se,ue);return function(ze){let Ke="";for(let Ve=0;Ve<ze.length;Ve+=1)Ke+=String.fromCharCode(ze[Ve]);return window.btoa(Ke)}(new Uint8Array(De))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new at(ce.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(R.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){let V=new TextEncoder,K=Se("USE_PURE_ENCRYPTION_MASTER_KEY")?V.encode(R.appId+this._encryptionSecret+this._encryptionSecret):V.encode(R.appId+R.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(se,ue,De){let ze=await window.crypto.subtle.importKey("raw",ue,"PBKDF2",!1,["deriveBits","deriveKey"]),Ke=se==="aes-128-gcm2"?128:256,Ve=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:NP,hash:"SHA-256",salt:De},ze,Ke+K6);return new Uint8Array(Ve).subarray(Ke/8)}(this._encryptionMode,K,Ip(this._encryptionSalt)),this._encryptDataStreamKey=await async function(se,ue,De){let ze=await window.crypto.subtle.importKey("raw",ue,"PBKDF2",!1,["deriveBits","deriveKey"]),Ke=se==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:NP,hash:"SHA-256",salt:De},ze,{name:"AES-GCM",length:Ke},!0,["encrypt","decrypt"])}(this._encryptionMode,K,Ip(this._encryptionSalt))}else u?L.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):L.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,L.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:t,appId:e,stringUid:R.stringUid});let A=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&A===this._sessionId&&gr.joinChannelTimeout(this._sessionId,5)},5e3);try{var D;let V,K=R.cloudProxyServer;if(Qt(D=["proxy3","proxy4","proxy5"]).call(D,K)){let Ke=Se("PROXY_SERVER_TYPE3");Array.isArray(Ke)?R.proxyServer=Ke[0]:R.proxyServer=Ke}if(gr.setProxyServer(R.proxyServer),L.setProxyServer(R.proxyServer),this.store.requestAPStart(),h){if(L.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat(R.stringUid?", ".concat(R.stringUid," => ").concat(h.intUid):""," ")),R.stringUid&&!R.uid&&(R.uid=h.intUid),V={gatewayInfo:h.ap.gatewayInfo},Se("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&R.turnServer.mode==="auto")if(h.ap.proxyInfo.addresses.length===0)L.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{let Ke=(await uM(h.ap.proxyInfo,h.ap.gatewayInfo.uid)).map(Ve=>({turnServerURL:Ve.address,tcpport:Ve.tcpport||aa.tcpport,udpport:Ve.udpport||aa.udpport,username:Ve.username||aa.username,password:Ve.password||aa.password,forceturn:!1,security:!0}));R.turnServer={mode:"manual",servers:Ke}}y2(h,R.stringUid)}else{if(R.stringUid&&!R.uid){let Ke;[Ke,V]=await tr.all([jM(R.stringUid,R,this._axiosCancelSource.token,this._config.httpRetryConfig||vi,this.store),xM(R,this._axiosCancelSource.token,this._config.httpRetryConfig||vi,!0,this.store)]),L.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(R.stringUid," => ").concat(Ke)),R.uid=Ke,V.gatewayInfo.uid=Ke,V.gatewayInfo.res.uid=Ke}else V=await xM(R,this._axiosCancelSource.token,this._config.httpRetryConfig||vi,!0,this.store);if(!this._joinAndNotLeaveYet)throw new at(ce.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(R,this._axiosCancelSource.token),this._configDistribute.on(ev.UPDATE_BITRATE_LIMIT,Ke=>{this._p2pChannel.updateBitrateLimit(Ke)}),this._configDistribute.on(ev.UPDATE_CLIENT_ROLE_OPTIONS,Ke=>{this._setClientRoleOptions(Ke)})},0),this._key=r||e;let se=V.gatewayInfo,ue=R.uid?R.uid:se.uid;this._joinInfo=ec(ec({},R),{},{cid:se.cid,uid:ue,vid:se.vid,apResponse:se.res,apGatewayAddress:se.apGatewayAddress,uni_lbs_ip:se.uni_lbs_ip,gatewayAddrs:se.gatewayAddrs}),this.store.intUid=ue,this.store.cid=se.cid;let De=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new at(ce.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));_.onSuccess(De),this._appId=e,this._channelName=R.cname,this._uid=De,this.store.uid=De,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(ra()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);let ze=R.stringUid?"string uid: ".concat(R.stringUid,",uid: ").concat(R.uid):"uid: ".concat(this._uid);return L.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(ze)),setTimeout(()=>{L.startUpload()},5e3),this.store.joinEnd(),J=this,Qt(Lp).call(Lp,J)||Lp.push(J),this._cloudProxyServerMode==="disabled"&&rn().supportWebCrypto&&Se("ENABLE_PRELOAD")&&Ib(this._joinInfo),De}catch(V){let K=Array.isArray(V)?V[0]:V;throw K&&K.code===ce.OPERATION_ABORTED?L.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),K):L.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),K),K.code!==ce.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),_.onError(K),K}var J}_joinGateway(){if(!this._joinInfo||!this._key)throw new at(ce.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Se("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){L.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(ra()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){let r=Lp.indexOf(t);r!==-1&&Lp.splice(r,1)}(this),this._statsCollector.stopUpdateStats();let e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return L.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",cn.LEAVE),L.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof sE))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new at(ce.INVALID_PARAMS,"param list is empty");let r=e;if(this._gateway.role==="audience")throw new at(ce.INVALID_OPERATION,"audience can not publish stream");for(let i of r){if(!(i instanceof sE))throw new at(ce.INVALID_PARAMS,"parameter is not local track");if(!i._enabled&&t)throw new at(ce.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(i.getTrackId()))}L.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(r.map(i=>"".concat(i.getTrackId()," "))));let n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&r.forEach(i=>{let o=this._configDistribute.getBitrateLimit();i instanceof xn&&o&&i.setBitrateLimit(o.uplink)});try{await this._publishHighStream(r),L.info("[".concat(this._clientId,"] Publish success, id ").concat(r.map(i=>"".concat(i.getTrackId()," "))))}catch(i){throw L.error("[".concat(this._clientId,"] publish error"),i.toString()),i}finally{n()}}async _publishDataChannel(e){vn(e.id,"id",0,65535,!0),Du(e.ordered,"ordered"),qi(e.metadata,"metadata",0,512),L.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));let t=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(i=>i.id===e.id)!==-1)throw new at(ce.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new at(ce.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Se("FORCE_TURN")&&!Se("TURN_ENABLE_TCP")&&!Se("TURN_ENABLE_UDP"))throw new at(ce.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");let r=function(i){return OM(i,!1)}(e),n=await this._p2pChannel.publishDataChannel([r]);if(n.length>0){if(typeof r._originDataChannelId!="number")throw L.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new at(ce.CREATE_DATACHANNEL_ERROR);try{await tr.all(n.map(i=>this._uid&&this._gateway.publishDataChannel(this._uid,i,!0))),await r._waitTillOpen()}catch(i){if(i.code!==ce.DISCONNECT_P2P)throw i}}return L.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(r.id)),r}catch(r){throw L.error("[".concat(this._clientId,"] publish datachannels error"),r.toString()),r}finally{t()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new at(ce.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let t=[];if(e)if(Array.isArray(e))t=e;else{if(!(e instanceof sE))return this._unpublishDataChannel([e]);t=[e]}else this.store.useP2P||await this._unpublishDataChannel(),t=this._p2pChannel.getAllTracks(!0);L.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(t.map(n=>"".concat(n.getTrackId()," "))," "));let r=await this._publishMutex.lock();try{if(this.store.useP2P){let n=await this._p2pChannel.unpublish(t);n&&await this._gateway.sendExtensionMessage(oi.UNPUBLISH,{unpubMsg:n},!0)}else{let n=await this._p2pChannel.unpublish(t);n&&await this._gateway.unpublish(n,this._uid),L.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(t.map(i=>"".concat(i.getTrackId()))))}}catch(n){throw L.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{r&&r()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),L.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(r=>"".concat(r.id," "))," "));let t=await this._publishMutex.lock();try{let r=await this._p2pChannel.unpublishDataChannel(e);r&&await this._gateway.unpublishDataChannel(r),L.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(n=>"".concat(n.id))))}catch(r){throw L.error("[".concat(this._clientId,"] unpublish dataChannel error"),r.toString()),r}finally{t&&t()}}async subscribe(e,t,r){if(!(e instanceof $d)){let n=this.remoteUsers.find(i=>i.uid===e);if(!n)throw new at(ce.INVALID_REMOTE_USER,"user is not in the channel");e=n}return t==="datachannel"?this._subscribeDataChannel(e,r):this._subscribe(e,t)}async presubscribe(e,t){if(bi(t,"mediaType",["audio","video"]),this.store.useP2P)throw new at(ce.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new at(ce.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));let r=t===lr.AUDIO,n=t===lr.VIDEO,i=await this._subscribeMutex.lock();try{let{ssrcId:o,ortc:l,rtxSsrcId:u,cname:h,uint_id:m}=await this._gateway.presubscribe(e,t,!0);if(o==null)throw new at(ce.UNEXPECTED_RESPONSE,"no ssrc id");let _=this._users.find(A=>A.uid===e);_||(_=new $d(e,m||e),_._is_pre_created=!0,this._users.push(_)),h&&(_._cname=h),_._uintid||(_._uintid=m||e),r&&(_._audioSSRC=o,_._audio_pre_subscribed=!0,l&&(_._audioOrtc=l)),n&&(_._videoSSRC=o,_._video_pre_subscribed=!0,l&&(_._videoOrtc=l),u!=null&&(_._rtxSsrcId=u)),L.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(o)),await this._p2pChannel.subscribe(_,t,o,u,l);let R=r?_._audioTrack:_._videoTrack;if(!R)throw new at(ce.UNEXPECTED_ERROR,"can not find remote track in user");return r&&(_._trust_audio_stream_added_state_=!0,_._audio_added_=!0),n&&(_._trust_video_stream_added_state_=!0,_._video_added_=!0),R}catch(o){throw L.error("[".concat(this._clientId,"] presub user ").concat(e," error"),o),o}finally{i()}}async _subscribeDataChannel(e,t){var r;if(vn(t,"channelId",0,65535,!0),!this._joinInfo)throw new at(ce.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(l=>l===e))throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new at(ce.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new at(ce.INVALID_REMOTE_USER,"user is not published");let n=(r=e._dataChannels)===null||r===void 0?void 0:r.find(l=>l.id===t);if(!n)throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new at(ce.REMOTE_USER_IS_NOT_PUBLISHED);let i=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{let l=await this._p2pChannel.subscribeDataChannel(e,[n]);if(l&&Qt(l).call(l,n.id))try{var o;if(typeof n._originDataChannelId!="number")throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new at(ce.CREATE_DATACHANNEL_ERROR);let u={id:n.id,datachannelId:n._originDataChannelId,ordered:n.ordered,maxRetransmits:n.maxRetransmits,metadata:(o=n.metadata)!==null&&o!==void 0?o:""};await this._gateway.subscribeDataChannel(e.uid,u,!0),await n._waitTillOpen()}catch(u){if(u?.code!==ce.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[n]),u;await this._p2pChannel.unsubscribeDataChannel(e,[n]),this._p2pChannel.setPendingRemoteDataChannel(e,n.id)}return L.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),n}finally{i()}}async _p2pSubscribe(e,t,r){if(bi(t,"mediaType",["audio","video"]),!this._joinInfo)throw new at(ce.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(i=>i===e)){let i=new at(ce.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),i}if(!e.hasAudio&&!e.hasVideo){let i=new at(ce.INVALID_REMOTE_USER,"user is not published");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),i}if(!r&&(t==="audio"&&!e.hasAudio||t==="video"&&!e.hasVideo)){let i=new at(ce.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),i}let n=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let o=t==="audio"?e._audioSSRC:e._videoSSRC,l=t==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,t,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,t,o,l)}catch(o){throw o}L.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(o=>{L.warning("[".concat(this._clientId,"] auto set fallback failed"),o)});let i=t==="audio"?e._audioTrack:e._videoTrack;if(!i)throw new at(ce.UNEXPECTED_ERROR,"can not find remote track in user object");return i}catch(i){throw L.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),i),i}finally{n()}}async _subscribe(e,t,r){if(this.store.useP2P)return this._p2pSubscribe(e,t);if(bi(t,"mediaType",["audio","video"]),!this._joinInfo)throw new at(ce.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e)){let h=new at(ce.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),h}if(!e.hasAudio&&!e.hasVideo){let h=new at(ce.INVALID_REMOTE_USER,"user is not published");throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),h}if(!(r||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){let h=new at(ce.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),h}let n=t==="audio"?e._audioSSRC:e._videoSSRC,i=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,l={stream_type:t==="audio"?lr.AUDIO:lr.VIDEO,ssrcId:n},u=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{let m=t==="audio"?e._audioSSRC:e._videoSSRC;m!==void 0&&m!==n&&(n=m,i=t==="audio"?e._audioOrtc:e._videoOrtc,o=t==="video"?e._rtxSsrcId:void 0,l={stream_type:t==="audio"?lr.AUDIO:lr.VIDEO,ssrcId:n}),fa.markSubscribeStart(this.store.clientId,n),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,n,o,i);try{this._p2pChannel.isPreSubScribe(n)||await this._gateway.subscribe(e.uid,l,!0)}catch(_){if(_?.code!==ce.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),_;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m?.code,e,t),m}L.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{L.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});let h=t==="audio"?e._audioTrack:e._videoTrack;if(!h)throw new at(ce.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw L.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),h),h}finally{u()}}async massSubscribe(e){if(Pu(e,"subscribeList"),!this._joinInfo)throw new at(ce.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));let t=Date.now(),r=new Map,n=await this._subscribeMutex.lock();L.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(u=>{let{user:h,mediaType:m}=u;return"user: ".concat(h?.uid,", mediaType: ").concat(m)}).join("; ")));let i=(e=[...e]).map(u=>{let{user:h,mediaType:m}=u;return{user:h,mediaType:m}}),o=await this._p2pChannel.globalLock();try{var l;for(let h=e.length-1;h>=0;h--){let m=e[h],{user:_,mediaType:R}=m;if(bi(R,"mediaType",["audio","video"]),!_){let J=new at(ce.INVALID_PARAMS,"user property does not exist in subscribeList item");throw L.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),J}if(!this._users.find(J=>J===_)){let J=new at(ce.INVALID_REMOTE_USER,"user is not in the channel");L.error("[".concat(this._clientId,"] can not massSubscribe ").concat(_.uid,", this user is not in the channel")),i[h].error=J,e.splice(h,1);continue}if(R==="audio"&&(!_.hasAudio||_._audioSSRC===void 0)||R==="video"&&(!_.hasVideo||_._videoSSRC===void 0)){let J=new at(ce.REMOTE_USER_IS_NOT_PUBLISHED);L.error("[".concat(this._clientId,"] can not subscribe ").concat(_.uid," with mediaType ").concat(R,", remote user is not published")),i[h].error=J,e.splice(h,1);continue}let A=Li.Video|Li.LwoVideo,D=r.get(_);if(D){if(R==="video"?D&A:D&Li.Audio){e.splice(h,1),L.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(_.uid,", mediaType:").concat(R," twice"));continue}r.set(_,D|(R==="video"?A:Li.Audio))}else r.set(_,R==="video"?A:Li.Audio)}for(let h=e.length-1;h>=0;h--){let m=e[h],{user:_,mediaType:R}=m,A=Li.Video|Li.LwoVideo;if(this._p2pChannel.hasRemoteMedia(_,R)){await this._p2pChannel.unmuteRemoteNoLock(_,R);let D=r.get(_);r.set(_,R==="video"?D^A:D^Li.Audio),e.splice(h,1)}}this.store.massSubscribe(e.map(h=>({userId:h.user.uid,type:h.mediaType})),t);let u=wa(l=Array.from(r.entries())).call(l,(h,m)=>{let[_,R]=m;if(R===0)return h;let A={stream_id:_.uid,stream_type:R};return R&Li.Audio&&(A.audio_ssrc=_._audioSSRC),R&Li.Video&&(A.video_ssrc=_._videoSSRC),h.push(A),h},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(m=>{let{user:_,mediaType:R}=m;return{user:_,mediaType:R,ssrcId:R===lr.VIDEO?_._videoSSRC:_._audioSSRC,rtxSsrcId:R===lr.VIDEO?_._rtxSsrcId:void 0}}));let h=new Map;if(u=u.filter(m=>m.video_ssrc&&!this._p2pChannel.isPreSubScribe(m.video_ssrc)||m.audio_ssrc&&!this._p2pChannel.isPreSubScribe(m.audio_ssrc)||!m.video_ssrc&&!m.audio_ssrc),u.length>0&&((await this._gateway.subscribeAll(u,!0))?.users||[]).forEach(_=>{let{stream_id:R,video_error_code:A,audio_error_code:D,error_code:J}=_;(A||D||J)&&h.set(R,{video_error_code:A,audio_error_code:D,error_code:J})}),Array.from(h.entries()).length>0){let m=[];Array.from(h.entries()).forEach(_=>{let[R,A]=_,D=this.remoteUsers.find(J=>J.uid===R);if(D){let J;A.error_code||A.video_error_code&&A.audio_error_code?J=void 0:A.video_error_code?J=lr.VIDEO:A.audio_error_code&&(J=lr.AUDIO),m.push({user:D,mediaType:J})}}),m.length>0&&await this._p2pChannel.massUnsubscribeNoLock(m)}for(let m of i){let _=h.get(m.user.uid);if(_){let R=_.error_code||m.mediaType==="audio"&&_.audio_error_code||m.mediaType==="video"&&_.video_error_code;if(R){let A=tv(R);L.error("user:".concat(m.user.uid," mediaType:").concat(m.mediaType," has massSubscribe error ").concat(A.desc)),m.error=new at(ce.SUBSCRIBE_FAILED,"code ".concat(R,": ").concat(A.desc))}}m.error||(m.mediaType==="video"?m.track=m.user.videoTrack:m.track=m.user.audioTrack)}return this.store.massSubscribe(i.filter(m=>!m.error).map(m=>({userId:m.user.uid,type:m.mediaType})),void 0,Date.now()),i.forEach(m=>{var _;gr.subscribe(this.store.sessionId,{succ:!!m.error,ec:((_=m.error)===null||_===void 0?void 0:_.code)||null,video:m.mediaType===lr.VIDEO,audio:m.mediaType===lr.AUDIO,peerid:m.user.uid,subscribeRequestid:m.mediaType===lr.VIDEO?m.user._videoSSRC:m.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t),preSsrc:this._p2pChannel.isPreSubScribe(m.user._videoSSRC)},!0)}),L.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(m=>{let{user:_,mediaType:R}=m;return"user: ".concat(_?.uid,", mediaType: ").concat(R)}).join("; "))),i}catch(h){throw await this._p2pChannel.massUnsubscribeNoLock(e),h}}finally{o(),n()}}async unsubscribe(e,t,r){if(!(e instanceof $d)){let i=this.remoteUsers.find(o=>o.uid===e);if(!i)throw new at(ce.INVALID_REMOTE_USER,"user is not in the channel");e=i}if(t||this.store.useP2P){if(t==="datachannel")return this._unsubscribeDataChannel(e,r)}else await this._unsubscribeDataChannel(e,r);if(t&&bi(t,"mediaType",["audio","video"]),!this._joinInfo)throw new at(ce.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(i=>i===e)){let i=new at(ce.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),i}L.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));let n=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,t);else{let i=await this._p2pChannel.unsubscribe(e,t);i&&await this._gateway.unsubscribe(i,e.uid),t&&t!=="audio"||(e._audio_pre_subscribed=!1),t&&t!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&zS(this._users,e),L.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}}catch(i){if(i.code===ce.DISCONNECT_P2P)return void L.warning("disconnecting p2p, abort unsubscribe request.");throw L.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),i.toString()),i}finally{n()}}async _unsubscribeDataChannel(e,t){if(t&&vn(t,"id",0,65535,!0),!this._joinInfo)throw new at(ce.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(n=>n===e)){let n=new at(ce.INVALID_REMOTE_USER,"user is not in the channel");throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),n}let r;if(typeof t=="number"){let n=e._dataChannels.find(i=>i.id===t);n&&(r=[n])}else r=e._dataChannels;if(r===void 0){let n=new at(ce.REMOTE_USER_IS_NOT_PUBLISHED);throw L.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(t,", remote datachannel is not published")),n}L.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(r.map(n=>n.id)));try{let n=await this._p2pChannel.unsubscribeDataChannel(e,r);n&&await this._gateway.unsubscribeDataChannel(n,e.uid),L.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(n))}catch(n){if(n.code===ce.DISCONNECT_P2P)return void L.warning("disconnecting p2p, abort unsubscribe request.");throw L.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),n.toString()),n}}async massUnsubscribe(e){if(Pu(e,"unsubscribeList"),!this._joinInfo)throw new at(ce.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");L.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(r=>{let{user:n,mediaType:i}=r;return"user: ".concat(n?.uid,", mediaType: ").concat(i,";")}).join())),e=[...e];let t=new Map;for(let r=e.length-1;r>=0;r--){let{user:n,mediaType:i}=e[r];if(!n){let l=new at(ce.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw L.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),l}if(bi(i,"mediaType",["video","audio",void 0]),!this._users.find(l=>l===n)){L.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(n.uid,", user is not in the channel")),e.splice(r,1);continue}let o=Li.Video|Li.LwoVideo;if(t.has(n)){let l=t.get(n),u;switch(i){case"video":u=l&o;break;case"audio":u=l&Li.Audio;break;default:u=l&(Li.Audio|o)}if(u){L.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(n.uid,",mediaType:").concat(i," twice.")),e.splice(r,1);continue}i?i==="audio"?t.set(n,l|Li.Audio):i==="video"&&t.set(n,l|o):t.set(n,l|Li.Audio|o)}else i?i==="audio"?t.set(n,Li.Audio):i==="video"&&t.set(n,o):t.set(n,Li.Audio|o)}try{let r=await this._p2pChannel.massUnsubscribe(e);r&&await this._gateway.massUnsubscribe(r),L.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(n=>{let{user:i,mediaType:o}=n;return"user: ".concat(i?.uid,", mediaType: ").concat(o,";")}).join()))}catch(r){if(r.code===ce.DISCONNECT_P2P)return void L.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw L.error("[".concat(this._clientId,"] massUnsubscribe error"),r.toString()),r}}async setLowStreamParameter(e){(function(r){if(!r)throw new Et(ce.INVALID_PARAMS);Xn(r.width)||rA(r.width,"streamParameter.width"),Xn(r.height)||rA(r.height,"streamParameter.height"),Xn(r.framerate)||rA(r.framerate,"streamParameter.framerate"),Xn(r.bitrate)||vn(r.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&L.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),L.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));let t=this._configDistribute.getLowStreamConfigDistribute();if(t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,Mt.LocalVideoLowTrack)}async enableDualStream(){if(!rn().supportDualStream)throw gr.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new at(ce.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new at(ce.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw gr.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,gr.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),L.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new at(ce.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(Mt.LocalVideoLowTrack))try{let e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw gr.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,gr.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),L.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(n){bi(n,"role",["audience","host"])}(e),t&&oA(t),this.mode==="rtc"||this.mode==="p2p")throw L.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new at(ce.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(t&&t.level&&e==="host")throw new at(ce.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new at(ce.INVALID_OPERATION,"can not set client role to audience when publishing stream");let r=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==r&&Se("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,t),this._config.role=e,this._gateway.reconnect("recover",na.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,t),this._config.role=e),L.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let t=!1;try{e&&oA(e),await this._gateway.setClientRole(this._config.role,e),t=!0}catch{}finally{L.info("[".concat(this._clientId,"] set client role options ").concat(t?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;let t=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!t||!t.timestamp)return 0;let r=t.timestamp-Date.now();return Math.abs(r)>1e3+t.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?r:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,t){if(qi(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new at(ce.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new at(ce.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,gr.setProxyServer(this._proxyServer),L.setProxyServer(this._proxyServer),L.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new at(ce.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new at(ce.INVALID_OPERATION,"You have already set the proxy")}if(Kg(e))return this._turnServer={servers:e,mode:"original-manual"},void L.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(r=>r.urls).join(","),"."));e.forEach(r=>sP(r)),this._turnServer={servers:e,mode:"manual"},L.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new at(ce.INVALID_OPERATION,"you should set license before join channel");if(qi(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new at(ce.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,L.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new at(ce.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new at(ce.INVALID_OPERATION,"You have already set the proxy");let t=[3,4,5],r;switch(e===void 0&&(e=3),e){case 1:case 2:throw new at(ce.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:r="proxy3";break;case 4:r="proxy4";break;case 5:r="proxy5";break;default:throw new at(ce.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=r,this.store.cloudProxyServerMode=r,L.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new at(ce.INVALID_OPERATION,"Stop proxy server after leave channel");gr.setProxyServer(),L.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",L.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new at(ce.INVALID_PARAMS,"accessPoints is required.");Pu(e.accessPoints.serverList,"accessPoints.serverList"),qi(e.accessPoints.domain,"accessPoints.domain");let t=(A,D)=>{vn(A,D,0,65535,!0)},r=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),r=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new at(ce.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Se("CLOSE_AFB_FOR_LOCAL_AP")&&(pn("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),pn("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));let n=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map(A=>n.test(A)?"".concat(A.replace(/\./g,"-"),".").concat(i):A),l=o.map(A=>"".concat(A,":").concat(r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,pn("WEBCS_DOMAIN",l),pn("WEBCS_DOMAIN_BACKUP_LIST",l),pn("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Pu(e.report.hostname,"report.hostname"),pn("EVENT_REPORT_DOMAIN",e.report.hostname[0]),pn("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(pn("EVENT_REPORT_DOMAIN",o[0]),pn("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let u=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),u=e.report.port),pn("STATS_COLLECTOR_PORT",u),e.report?pn("ENABLE_EVENT_REPORT",!0):pn("ENABLE_EVENT_REPORT",!1);let h="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Pu(e.log.hostname,"log.hostname"),h=e.log.hostname[0]):h=o[0];let m=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),m=e.log.port),pn("LOG_UPLOAD_SERVER","".concat(h,":").concat(m));let _=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Pu(e.cds.hostname,"cds.hostname"),_=e.cds.hostname):_=o;let R=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),R=e.cds.port),pn("CDS_AP",_.map(A=>"".concat(A,":").concat(R))),e.cds?pn("ENABLE_CONFIG_DISTRIBUTE",!0):pn("ENABLE_CONFIG_DISTRIBUTE",!1),L.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Pu(e,"serverList"),qi(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new at(ce.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");let r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(n=>r.test(n)?"".concat(n.replace(/\./g,"-"),".").concat(t):n),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,pn("WEBCS_DOMAIN",e),pn("WEBCS_DOMAIN_BACKUP_LIST",e),pn("GATEWAY_DOMAINS",[t]),pn("EVENT_REPORT_DOMAIN",e[0]),pn("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),pn("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),L.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(bi(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw L.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else L.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){bi(t,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{let r=this._users.find(n=>n.uid===e);r&&r.videoTrack&&r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(r){throw L.error("[".concat(this._clientId,"] set remote video stream type error"),r.toString()),r}L.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){bi(t,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(r){throw L.error("[".concat(this._clientId,"] set stream fallback option"),r.toString()),r}L.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,r,n){(function(o){bi(o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),qi(t,"secret");let i=["aes-128-gcm2","aes-256-gcm2"];if(Qt(i).call(i,e)){if(!r||!(r instanceof Uint8Array&&r.length===32))throw new at(ce.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(r)throw new at(ce.INVALID_PARAMS,"current encrypt mode does not need salt");if(n){if(Du(n,"encryptDataStream"),!Qt(i).call(i,e))throw new at(ce.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||L.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,r&&(this._encryptionSalt=Kd(r))}async renewToken(e){if(qi(e,"token",1,2047),!this._key||!this._joinInfo)throw new at(ce.INVALID_OPERATION,"renewToken should not be called before user join");let t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);let r=await this._renewTokenMutex.lock();try{if(Se("USE_NEW_TOKEN")){L.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));let n=await CG(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||vi);L.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:n})}else L.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});L.debug("[".concat(this._clientId,"] renewToken success"))}catch(n){throw this._key=t,this._joinInfo.token=t,L.error("[".concat(this._clientId,"] renewToken failed"),n.toString()),n}finally{r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?L.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{let e=this._p2pChannel.getAudioLevels();this.safeEmit(Gr.VOLUME_INDICATOR,e)},Se("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){let e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new at(ce.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new at(ce.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new at(ce.LIVE_STREAMING_TASK_CONFLICT);let r=t?Mu.TRANSCODE:Mu.RAW;return this._createLiveStreamingClient(r).startLiveStreamingTask(e,r)}setLiveTranscoding(e){return this._createLiveStreamingClient(Mu.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){let t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(r=>r&&r.hasUrl(e));if(!t.length)throw new at(ce.INVALID_PARAMS,"can not find live streaming url to stop");await tr.all(t.map(r=>r&&r.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){KM(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){KM(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof dv&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var t;let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new at(ce.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){let i=new TextEncoder;e.payload=i.encode(e.payload)}let n=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Qt(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)&&(n=!0,e.payload=await async function(i,o,l){var u;let h=wa(u=Array.from(l)).call(u,(V,K)=>V+K,0),m={serverTs:0,seq:z6++,length:l.length,checkSum:h},_=new Uint8Array(mP(h,2)),R=new ArrayBuffer(eE),A=new DataView(R);A.setUint32(0,m.serverTs),A.setUint16(4,m.seq),A.setUint16(6,m.length),A.setUint16(8,m.checkSum);let D=16-l.length%16;l=uP(l,new Uint8Array(D));let J=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i,tagLength:OP,additionalData:_},o,l);return uP(new Uint8Array(R),new Uint8Array(J))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new at(ce.INVALID_PARAMS,n?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(Dr.DATA_STREAM,{payload:Kd(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-LG},!r)}sendMetadata(e){if(!this._joinInfo)throw new at(ce.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new at(ce.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(Dr.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Kd(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(tF),!this._joinInfo)throw new at(ce.INVALID_OPERATION,"can not send custom report, not joined");await gr.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){bi(t.spatialLayer,"spatialLayer",[0,1,2,3]),bi(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(r){throw L.error("[".concat(this._clientId,"] pick SVC layer failed"),r.toString()),r}}async setRTMConfig(e){let{apRTM:t=!1,rtmFlag:r}=e;if(Du(t,"apRTM"),vn(r,"rtmFlag",0),this._rtmConfig.apRTM=t,this._rtmConfig.rtmFlag=r,L.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=t,this._joinInfo.rtmFlag=r,this._gateway.setRTM2Flag(r)}_reset(){if(L.debug("[".concat(this._clientId,"] reset client")),function(e){let t=pE.indexOf(e);t!==-1&&pE.splice(t,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=Ha.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&T2(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&gr.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(t=>t._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new da("client-publish",this._clientId),this._subscribeMutex=new da("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){var r;let n=e||Ap();e?L.debug("[".concat(this._clientId,"] new Session ").concat(n)):L.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n));let i=e?"":this._sessionId||"";this._sessionId=n,this.store.sessionId=n,gr.addSid(n);let o={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:t?.stringUid||((r=this._joinInfo)===null||r===void 0?void 0:r.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:i,clientRole:this.role==="audience"?2:1};gr.sessionInit(this._sessionId,ec({cname:t.channel,appid:t.appId},o)),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new at(ce.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Se("FORCE_TURN")&&!Se("TURN_ENABLE_TCP")&&!Se("TURN_ENABLE_UDP"))throw new at(ce.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");L.debug("[".concat(this._clientId,"] publish high stream"));try{let r=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){let n=(await r.next()).value;if(n){try{await this._gateway.sendExtensionMessage(oi.PUBLISH,n,!0)}catch(i){throw r.throw(i),i}await r.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{let n=(await r.next()).value;if(n){var t;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(o){if(o.code!==ce.DISCONNECT_P2P)throw r.throw(o),o}await r.next(((t=i)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(let i of e)i instanceof xn&&i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig).catch(o=>{L.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!i.muted&&i.enabled||await this._p2pChannel.muteLocalTrack(i)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r?.code,e),r?.code===ce.WS_ABORT)return;throw r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new at(ce.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new at(ce.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));L.debug("[".concat(this._clientId,"] publish low stream"));let e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{let r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await r.next()).value;if(n){var t;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(o){if(o.code!==ce.DISCONNECT_P2P)throw r.throw(o),o}r.next(((t=i)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(r){if(this._p2pChannel.reportPublishEvent(!1,r?.code,void 0,!0),r?.code===ce.WS_ABORT)return;throw r}}_createLiveStreamingClient(e){let t=()=>{if(!this._joinInfo||!this._appId)return new at(ce.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();let r=(n={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},ju("LiveStreaming").create(n));var n;return r.onLiveStreamError=(i,o)=>{gr.reportApiInvoke(this._sessionId,{name:gi.ON_LIVE_STREAM_ERROR,options:[i,o],tag:Jn.TRACER}).onSuccess(),this.safeEmit(Gr.LIVE_STREAMING_ERROR,i,o)},r.onLiveStreamWarning=(i,o)=>{gr.reportApiInvoke(this._sessionId,{name:gi.ON_LIVE_STREAM_WARNING,options:[i,o],tag:Jn.TRACER}).onSuccess(),this.safeEmit(Gr.LIVE_STREAMING_WARNING,i,o)},r.on(JA.REQUEST_WORKER_MANAGER_LIST,(i,o,l)=>{if(!this._joinInfo)return l(new at(ce.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(u,h,m,_){let R=Se("UAP_AP").slice(0,Se("AJAX_REQUEST_CONCURRENT")).map(A=>h.proxyServer?"https://".concat(h.proxyServer,"/ap/?url=").concat(A+"/api/v1?action=uap"):"https://".concat(A,"/api/v1?action=uap"));return await gG(R,u,h,m,_)})(i,this._joinInfo,this._axiosCancelSource.token,vi).then(o).catch(l)}),r};return e===Mu.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||t(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||t(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new at(ce.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){let{sendResolutionWidth:t,sendResolutionHeight:r}=this.getLocalVideoStats(),n=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:t,height:r}},ju("ChannelMediaRelay").create(e));n.on("state",i=>{i===oo.RELAY_STATE_FAILURE&&n&&n.dispose(),this.safeEmit(Gr.CHANNEL_MEDIA_RELAY_STATE,i)}),n.on("event",i=>{this.safeEmit(Gr.CHANNEL_MEDIA_RELAY_EVENT,i)}),this._channelMediaRelayClient=n,this._statsCollector.onStatsChanged=(i,o)=>{var l;i==="resolution"&&((l=this._channelMediaRelayClient)===null||l===void 0||l.setVideoProfile(o))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,t){let{added:r,deleted:n}=e,i=[];if(t){let o=[];this._users.forEach(l=>{l._dataChannels.forEach(u=>{r.every(h=>h.uid!==l._uintid||h.stream_id!==u.id)&&o.push({uid:l._uintid,stream_id:u.id,ordered:u.ordered,max_retrans_times:u.maxRetransmits,metadata:u.metadata})})}),o.length>0&&this._handleUpdateDataChannel({added:[],deleted:o})}Array.isArray(r)&&r.length>0&&r.forEach(o=>{let{uid:l,stream_id:u,ordered:h,max_retrans_times:m,metadata:_}=o,R=this._users.find(A=>A._uintid===l);if(!R)return void L.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(L.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(l)),Qt(i).call(i,R)||i.push(R),R._uintid||(R._uintid=l),R._dataChannels.findIndex(A=>A.id===o.stream_id)===-1){let A={id:u,ordered:!!h,maxRetransmits:m,metadata:_},D=function(J){return OM(J,!0)}(A);R._dataChannels.push(D),L.info("[".concat(this._clientId,"] remote user ").concat(R.uid," published datachannel")),t||this.safeEmit(Gr.USER_PUBLISHED,R,"datachannel",A)}this._p2pChannel.hasPendingRemoteDataChannel(R,o.stream_id)&&(L.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(R.uid," after reconnect.")),this._subscribeDataChannel(R,o.stream_id).catch(A=>{L.error("[".concat(this._clientId,"] resubscribe datachannel error"),A.toString())}))}),t&&(this.safeEmit(Gr.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(n)&&n.length>0&&n.forEach(o=>{let{uid:l,stream_id:u}=o,h=this._users.find(_=>_._uintid===l);if(!h)return void L.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));let m=h._dataChannels.find(_=>_.id===o.stream_id);m&&(L.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(l)),this._p2pChannel.unsubscribeDataChannel(h,[m]).then(_=>{if(h._dataChannels=h._dataChannels.filter(R=>R!==m),_)return this._gateway.unsubscribeDataChannel(_,h.uid)}),L.info("[".concat(this._clientId,"] remote user ").concat(l," unpublished datachannel ,id:").concat(m.id)),this.safeEmit(Gr.USER_UNPUBLISHED,h,"datachannel",m._config))})}_handleRemoveDataChannels(e){let t=this._users.find(r=>r.uid===e.uid);if(t){if(t._dataChannels!==void 0&&t._dataChannels.length>0){L.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));let r=()=>{L.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished datachannel")),t._dataChannels.forEach(n=>{this.safeEmit(Gr.USER_UNPUBLISHED,t,"datachannel",n._config)})};this._p2pChannel.unsubscribeDataChannel(t,t._dataChannels).then(n=>{if(n)return this._gateway.unsubscribeDataChannel(n,t.uid)}),r()}}else L.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(Fi.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void L.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();Object.keys(t).forEach(n=>{let{value:i,type:o,expires:l}=t[n];l&&l<=r||o||HA()||!Object.prototype.hasOwnProperty.call(QS,n)||(jc[n]=i,Un[n]=i,L.debug("Update gateway parameters from config distribute",n,i))})}catch(t){L.error("Error update config from local cache",t.message)}})()}),this._gateway.on(Fi.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Fi.CONNECTION_STATE_CHANGE,(e,t,r)=>{var n;if(r===cn.FALLBACK)return;let i=()=>{this.safeEmit(Gr.CONNECTION_STATE_CHANGE,e,t,r)};if(gr.reportApiInvoke(this._sessionId||((n=this._gateway.joinInfo)===null||n===void 0?void 0:n.sid)||null,{name:gi.CONNECTION_STATE_CHANGE,options:[e,t,r],tag:Jn.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:r})),L.info("[".concat(this._clientId,"] signal connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void i();if(e==="RECONNECTING")this._users.forEach(l=>{l._trust_in_room_=!1,l._trust_audio_enabled_state_=!1,l._trust_video_enabled_state_=!1,l._trust_audio_mute_state_=!1,l._trust_video_mute_state_=!1,l._trust_audio_stream_added_state_=!1,l._trust_video_stream_added_state_=!1,l._is_pre_created||(l._audio_pre_subscribed||(l._audioSSRC=void 0,l._audioOrtc=void 0),l._video_pre_subscribed||(l._videoSSRC=void 0,l._videoOrtc=void 0,l._rtxSsrcId=void 0),l._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var o;this._streamFallbackTypeCacheMap.forEach((l,u)=>{this._gateway.setStreamFallbackOption(u,l).catch(h=>{L.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),h)})}),this._remoteStreamTypeCacheMap.forEach((l,u)=>{this._gateway.setRemoteVideoStreamType(u,l).catch(h=>{L.warning("[".concat(this._clientId,"] auto set remote stream type failed"),h)})}),this._remoteDefaultVideoStreamType!==void 0&&((o=this._joinInfo)===null||o===void 0?void 0:o.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{L.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(l=>{L.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(l))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(l=>!l._trust_in_room_).forEach(l=>{L.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(l.uid)),this._handleUserOffline({uid:l.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(l=>{l._trust_audio_mute_state_||(L.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,lr.AUDIO,!1)),l._trust_video_mute_state_||(L.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(l.uid)),this._handleMuteStream(l.uid,lr.VIDEO,!1)),l._trust_audio_enabled_state_||(L.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(l.uid)),this._handleSetStreamLocalEnable("audio",l.uid,!0)),l._trust_video_enabled_state_||(L.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(l.uid)),this._handleSetStreamLocalEnable("video",l.uid,!0)),l._trust_video_stream_added_state_||(L.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(l.uid)),this._handleResetAddStream(l,"video")),l._trust_audio_stream_added_state_||(L.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(l.uid)),this._handleResetAddStream(l,"audio")),l._video_added_||l._audio_added_||(L.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(l.uid)),this._handleRemoveStream({uid:l.uid,uint_id:l._uintid}))}))},1e3))}i()}),this._gateway.on(Fi.REQUEST_NEW_GATEWAY_LIST,async(e,t)=>{if(!this._joinInfo)return t(new at(ce.UNEXPECTED_ERROR,"can not recover, no join info"));try{let r,n=await g2(ec(ec({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));n?(r=n.ap,y2(n),this._joinInfo.preload=!0):(r=await hb(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||vi,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=r.gatewayInfo.res,this._joinInfo.gatewayAddrs=r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=r.gatewayInfo.uni_lbs_ip);let i=[];r.gatewayInfo.gatewayAddrs.forEach(o=>{let{address:l}=o,[u,h]=l.split(":");this._joinInfo&&this._joinInfo.proxyServer?i.push({proxy:this._joinInfo.proxyServer,host:u,port:h}):i.push({host:u,port:h})}),e(i)}catch(r){t(r)}}),this._gateway.on(Fi.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Gr.NETWORK_QUALITY,e)}),this._gateway.on(Fi.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Gr.STREAM_TYPE_CHANGED,e,t),gr.reportApiInvoke(this._sessionId,{name:gi.STREAM_TYPE_CHANGE,options:[e,t],tag:Jn.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(Fi.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(Fi.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,r)=>{try{let n=await this._p2pChannel.getEstablishParams();Se("ENABLE_PREALLOC_PC")&&n||(n=await this._p2pChannel.startP2PConnection(e)),t(n)}catch(n){r(n)}}),this._gateway.on(Fi.JOIN_RESPONSE,(e,t)=>{if(this.store.useP2P)return;let r;e.attributes?r=e.attributes.userAttributes.preSubSsrcs:L.debug("no attributes in joinResponse");let n=EM(e.ortc,t,r);this._p2pChannel.connect(n)}),this._gateway.on(Fi.PRE_CONNECT_PC,async e=>{let{candidates:t,fingerprint:r}=e;if(this._joinInfo&&t.length>0&&!this._p2pChannel.isPlanB){var n;await this._p2pChannel.startP2PConnection({turnServer:this._joinInfo.turnServer});let{cert:i,cid:o}=this._joinInfo.apResponse;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(o,"_").concat(i),icePwd:"".concat(o,"_").concat(i)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(n=Se("FINGERPRINT"))!==null&&n!==void 0?n:r}]},candidates:t,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}})}_handleGatewaySignalEvents(){this._gateway.signal.on(Wr.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Wr.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Wr.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Wr.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Wr.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(Wr.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(Wr.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Wr.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Wr.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,lr.AUDIO,!0)),this._gateway.signal.on(Wr.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,lr.AUDIO,!1)),this._gateway.signal.on(Wr.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,lr.VIDEO,!0)),this._gateway.signal.on(Wr.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,lr.VIDEO,!1)),this._gateway.signal.on(Wr.RECEIVE_METADATA,e=>{let t=Ip(e.metadata);this.safeEmit(Gr.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Wr.ON_DATA_STREAM,async e=>{var t;if(!e)return;let r=Ip(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&Qt(t=["aes-128-gcm2","aes-256-gcm2"]).call(t,this._encryptionMode)){if(e.payload.length<eE)throw new at(ce.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(eE));r=await async function(i,o,l){let u=l.subarray(0,eE),h=u.slice(8,eE),m=(h[0]<<8)+h[1],_=(u[6]<<8)+u[7],R=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:i,tagLength:OP,additionalData:new Uint8Array(mP(m,2))},o,l.subarray(eE));return new Uint8Array(R).subarray(0,_)}(this._encryptDataStreamIv,this._encryptDataStreamKey,r)}let n=0;if(e.ordered||e.syncWithAudio){let i=this._p2pChannel.getStats(),o=this.remoteUsers.find(u=>u.uid===e.uid);n=i?.audioRecv.find(u=>u.ssrc===o?._audioSSRC)?.jitterBufferMs}(n==null||Number.isNaN(n))&&(n=0),MG(ec(ec({},e),{},{payload:r}),n,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(Wr.ON_CRYPT_ERROR,()=>{Wd(()=>{L.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Gr.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Wr.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Wr.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{L.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,cn.TOKEN_EXPIRE),this.safeEmit(Gr.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Wr.ON_STREAM_FALLBACK_UPDATE,e=>{L.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Gr.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Wr.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),L.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Wr.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Wr.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Lr.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case Dr.PUBLISH:{if(!t)return;let i=t.ortc;if(i){var r,n;let o=i.some(h=>{let{stream_type:m}=h;return m===un.Audio}),l=i.some(h=>{let{stream_type:m}=h;return m!==un.Audio}),u=i.some(h=>{let{stream_type:m}=h;return m===un.Screen||m===un.ScreenLow});t.state==="offer"&&gr.publish(this._joinInfo.sid,{eventElapse:fa.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:ce.TIMEOUT,audio:o,video:l,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:u,audioName:o?(r=i.find(h=>{let{stream_type:m}=h;return m===un.Audio}))===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:l?(n=i.find(h=>{let{stream_type:m}=h;return m!==un.Audio}))===null||n===void 0||(n=n.ssrcs[0])===null||n===void 0?void 0:n.ssrcId.toString():void 0})}break}case Dr.SUBSCRIBE:t&&gr.subscribe(this._joinInfo.sid,{succ:!1,ec:ce.TIMEOUT,audio:t.stream_type===lr.AUDIO,video:t.stream_type===lr.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:fa.measureFromSubscribeStart(this.store.clientId,t.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(t.ssrcId)})}}),this._gateway.signal.on(Wr.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Wr.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;Se("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(n=>!kp(n.string_id||n.stream_id,this.channelName)));let t=[],r=[];for(let n of e.users){let i=this._users.find(_=>_._uintid===n.stream_id);i?i._trust_in_room_=!0:(i=new $d(n.string_id||n.stream_id,n.stream_id),this._users.push(i),this.getListeners(Gr.PUBLISHED_USER_LIST).length===0&&(L.debug("[".concat(this._clientId,"] user online"),n.stream_id),this.safeEmit(Gr.USER_JOINED,i)));let o=Li.Audio&n.stream_type,l=(Li.Video|Li.LwoVideo)&n.stream_type,u=(65280&n.stream_type)!=0,h=o&&i.hasAudio,m=l&&i.hasVideo;l&&(i._trust_video_stream_added_state_=!0,i._video_added_=!0,i._videoSSRC=n.video_ssrc,i._rtxSsrcId=n.video_rtx),o&&(i._trust_audio_stream_added_state_=!0,i._audio_added_=!0,i._audioSSRC=n.audio_ssrc),o&&!h&&this.getListeners(Gr.PUBLISHED_USER_LIST).length===0&&(L.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published audio")),this.safeEmit(Gr.USER_PUBLISHED,i,"audio")),l&&!m&&this.getListeners(Gr.PUBLISHED_USER_LIST).length===0&&(L.info("[".concat(this._clientId,"] remote user ").concat(i.uid," published video")),this.safeEmit(Gr.USER_PUBLISHED,i,"video")),(o&&!h||l&&!m||u)&&t.push(i),l&&this._p2pChannel.hasPendingRemoteMedia(i,"video")&&r.push({user:i,mediaType:"video"}),o&&this._p2pChannel.hasPendingRemoteMedia(i,"audio")&&r.push({user:i,mediaType:"audio"})}r.length>0&&(L.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(r.map(n=>"user: ".concat(n.user.uid,", mediaType: ").concat(n.mediaType)).join("; ")," ")),this.massSubscribe(r).catch(n=>{L.error("[".concat(this._clientId,"] mass resubscribe error"),n.toString())})),this.getListeners(Gr.PUBLISHED_USER_LIST).length>0?Se("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=t:(L.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(n=>n.uid).join(", "))),this.safeEmit(Gr.PUBLISHED_USER_LIST,t)):L.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(n=>n.uid).join(", ")))}),this._gateway.signal.on(Wr.ON_RTP_CAPABILITY_CHANGE,e=>{let{video_codec:t}=e;this._p2pChannel instanceof dv&&this._p2pChannel.updateRemoteRTPCapabilities(t.map(r=>r.toLowerCase()).filter(r=>{var n;return Qt(n=Object.keys($S)).call(n,r)}))})}_handleP2PEvents(){this._gateway.signal.on(Wr.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(oi.PUBLISH,(e,t,r)=>{let{uid:n}=e;e.forEach(i=>{let{kind:o,ssrcs:l,mid:u,isMuted:h}=i;this._handleP2PAddAudioOrVideoStream(o,n,l[0].ssrcId,u);let m=this._users.find(_=>_.uid===n);return m&&this.store.useP2P?this._p2pChannel.mockSubscribe(m,o,l[0].ssrcId,u).then(()=>{t()}).catch(r):t(),this._handleMuteStream(n,o,!!h)})}),this._gateway.signal.on(oi.CALL,async(e,t,r)=>{if(this.store.useP2P)try{var n;t(await this._p2pChannel.startP2P({turnServer:(n=this._joinInfo)===null||n===void 0?void 0:n.turnServer},e))}catch(i){r(i)}}),this._gateway.signal.on(Lr.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on(oi.UNPUBLISH,async(e,t,r)=>{if(this.store.useP2P){let{unpubMsg:n,uid:i}=e,o=this._users.find(l=>l.uid===i);if(!o)return L.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(i)),void t();try{n.forEach(async l=>{let{stream_type:u}=l,h=u===un.Audio?lr.AUDIO:lr.VIDEO;await this._p2pChannel.unsubscribe(o,h),this._handleMuteStream(i,h,!0)}),t()}catch(l){r(l)}}}),this._gateway.signal.on(oi.CONTROL,async(e,t)=>{let{action:r}=e;switch(r){case Yd.MUTE_LOCAL_VIDEO:this._handleMuteStream(t,lr.VIDEO,!0);break;case Yd.MUTE_LOCAL_AUDIO:this._handleMuteStream(t,lr.AUDIO,!0);break;case Yd.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",t),this._handleMuteStream(t,lr.VIDEO,!1);break;case Yd.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",t),this._handleMuteStream(t,lr.AUDIO,!1)}}),this._gateway.signal.on(oi.RESTART_ICE,async(e,t,r)=>{if(this.store.useP2P)try{let{direction:n,iceParameter:i}=e;n!==Ma.SEND_ONLY||i?t(await this._p2pChannel.restartICE(n,i)):(this._p2pChannel.handleDisconnect(n),t())}catch(n){r(n)}}),this._gateway.signal.on(oi.CANDIDATE,e=>{if(this.store.useP2P){let{candidate:t,direction:r}=e;this._p2pChannel.addRemoteCandidate(t,r)}}),this._p2pChannel.on(Cr.RequestP2PRestartICE,async(e,t,r)=>{try{let{direction:n}=e;t(await this._gateway.sendExtensionMessage(oi.RESTART_ICE,e,n===Ma.SEND_ONLY))}catch(n){r(n)}}),this._p2pChannel.on(Cr.LocalCandidate,e=>{this._gateway.sendExtensionMessage(oi.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(Cr.RequestP2PMuteLocal,async(e,t,r)=>{try{await this._gateway.sendExtensionMessage(oi.CONTROL,e,!0),t()}catch(n){r(n)}}),this._p2pChannel.on(Cr.RequestP2PUnmuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===ce.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(Cr.RequestP2PMuteRemote,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===ce.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(Cr.StateChange,(e,t)=>{t===ln.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(Cr.PeerConnectionStateChange,e=>{let t=this._peerConnectionState;e!==t&&(this.safeEmit(Gr.PEERCONNECTION_STATE_CHANGE,e,t),this._peerConnectionState=e)}),this._p2pChannel.on(Cr.RequestMuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===ce.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(Cr.RequestUnmuteLocal,async(e,t,r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(n){n.code===ce.DISCONNECT_P2P?t():r(n)}else t()}),this._p2pChannel.on(Cr.RequestRePublish,(e,t,r)=>{this.publish(e,!1).then(t).catch(r)}),this._p2pChannel.on(Cr.RequestRePublishDataChannel,(e,t,r)=>{tr.all(e.map(async n=>{let i=await this._p2pChannel.publishDataChannel([n]);try{i.forEach(o=>{this._uid&&this._gateway.publishDataChannel(this._uid,o,!0)})}catch(o){if(o.code!==ce.DISCONNECT_P2P)throw o}})).then(t).catch(r)}),this._p2pChannel.on(Cr.RequestReSubscribe,async(e,t,r)=>{try{for(let{user:n,kind:i}of e)i===lr.VIDEO?await this.subscribe(n,"video"):await this.subscribe(n,"audio");t()}catch(n){r(n)}}),this._p2pChannel.on(Cr.RequestUpload,(e,t)=>{this._gateway.upload(e,t)}),this._p2pChannel.on(Cr.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(Cr.MediaReconnectStart,e=>{this.safeEmit(Gr.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Cr.MediaReconnectEnd,e=>{this.safeEmit(Gr.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Cr.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Cr.RequestRestartICE,async e=>{if(this.store.useP2P)return;let t=await this._p2pChannel.restartICE(e),r=await t.next();if(r.done)return;let n=r.value,i;try{i=await this._gateway.restartICE({iceParameters:n})}catch(l){return void t.throw(l)}let{iceParameters:o}=function(l){let u=l.iceParameters;return{iceParameters:{iceUfrag:u.iceUfrag,icePwd:u.icePwd}}}(i);await t.next({remoteIceParameters:o})}),this._p2pChannel.on(Cr.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Cr.RequestReconnectPC,async()=>{var e;let{iceParameters:t,dtlsParameters:r,rtpCapabilities:n}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:r,rtpCapabilities:n}),l=EM(i,o);await this._p2pChannel.connect(l),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Cr.RequestUnpublishForReconnectPC,async(e,t,r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):r()}),this._p2pChannel.on(Cr.P2PLost,()=>{this.safeEmit(Gr.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Cr.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Cr.ConnectionTypeChange,e=>{this.safeEmit(Gr.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Cr.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Cr.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(Cr.AudioMetadata,e=>{this.safeEmit(Gr.AUDIO_METADATA,e)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new at(ce.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new at(ce.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{let r=(t={config:e},ju("ContentInspect").create(t));this._inspect=r,this.handleVideoInspectEvents(r);let{appId:n,cname:i,sid:o,token:l,uid:u,cid:h,vid:m}=this._joinInfo;await r.init({appId:n,areaCode:"",cname:i,sid:o,token:l,uid:u,cid:h,vid:m?Number(m):0},vi)}catch(r){throw Array.isArray(r)?r[0]:r}var t}handleVideoInspectEvents(e){e.on(Gi.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(Gr.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,r),r===Js.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(Gr.CONTENT_INSPECT_ERROR,new at(ce.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Gi.INSPECT_RESULT,(t,r)=>{var n;if(r?.code===ce.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return L.debug("Stop inspect content because that has left channel"),this==null||(n=this._inspect)===null||n===void 0||n.close(),void(this._inspect=void 0);this.safeEmit(Gr.CONTENT_INSPECT_RESULT,t,r)}),e.on(Gi.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new at(ce.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Du(e,"enabled"),e){if(!t)throw new at(ce.INVALID_PARAMS,"config is required");if(k2(t),!this._joinInfo)throw new at(ce.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(t);else{let n=(r={config:t},ju("ImageModeration").create(r));this._moderation=n,this.handleImageModerationEvents(n);let{appId:i,cname:o,sid:l,token:u,uid:h,cid:m,vid:_}=this._joinInfo;await n.init({appId:i,areaCode:"",cname:o,sid:l,token:u,uid:h,cid:m,vid:_?Number(_):0},vi)}}catch(n){throw Array.isArray(n)?n[0]:n}}else{var r;if(!this._moderation)throw new at(ce.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}handleImageModerationEvents(e){e.on(Fc.CONNECTION_STATE_CHANGE,(t,r)=>{if(this.safeEmit(Gr.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,r),t===ms.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new at(ce.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Fc.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(r=>r.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(t){bi(t,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new at(ce.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,L.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return L.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Du(e,"enabled"),pn("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},_r(sr.prototype,"leave",[M2],Object.getOwnPropertyDescriptor(sr.prototype,"leave"),sr.prototype),_r(sr.prototype,"publish",[U2],Object.getOwnPropertyDescriptor(sr.prototype,"publish"),sr.prototype),_r(sr.prototype,"unpublish",[x2],Object.getOwnPropertyDescriptor(sr.prototype,"unpublish"),sr.prototype),_r(sr.prototype,"subscribe",[j2],Object.getOwnPropertyDescriptor(sr.prototype,"subscribe"),sr.prototype),_r(sr.prototype,"presubscribe",[B2],Object.getOwnPropertyDescriptor(sr.prototype,"presubscribe"),sr.prototype),_r(sr.prototype,"massSubscribe",[V2],Object.getOwnPropertyDescriptor(sr.prototype,"massSubscribe"),sr.prototype),_r(sr.prototype,"unsubscribe",[F2],Object.getOwnPropertyDescriptor(sr.prototype,"unsubscribe"),sr.prototype),_r(sr.prototype,"massUnsubscribe",[G2],Object.getOwnPropertyDescriptor(sr.prototype,"massUnsubscribe"),sr.prototype),_r(sr.prototype,"setLowStreamParameter",[H2],Object.getOwnPropertyDescriptor(sr.prototype,"setLowStreamParameter"),sr.prototype),_r(sr.prototype,"enableDualStream",[W2],Object.getOwnPropertyDescriptor(sr.prototype,"enableDualStream"),sr.prototype),_r(sr.prototype,"disableDualStream",[K2],Object.getOwnPropertyDescriptor(sr.prototype,"disableDualStream"),sr.prototype),_r(sr.prototype,"setClientRole",[z2],Object.getOwnPropertyDescriptor(sr.prototype,"setClientRole"),sr.prototype),_r(sr.prototype,"_setClientRoleOptions",[q2],Object.getOwnPropertyDescriptor(sr.prototype,"_setClientRoleOptions"),sr.prototype),_r(sr.prototype,"setProxyServer",[Y2],Object.getOwnPropertyDescriptor(sr.prototype,"setProxyServer"),sr.prototype),_r(sr.prototype,"setTurnServer",[X2],Object.getOwnPropertyDescriptor(sr.prototype,"setTurnServer"),sr.prototype),_r(sr.prototype,"setLicense",[J2],Object.getOwnPropertyDescriptor(sr.prototype,"setLicense"),sr.prototype),_r(sr.prototype,"startProxyServer",[Z2],Object.getOwnPropertyDescriptor(sr.prototype,"startProxyServer"),sr.prototype),_r(sr.prototype,"stopProxyServer",[Q2],Object.getOwnPropertyDescriptor(sr.prototype,"stopProxyServer"),sr.prototype),_r(sr.prototype,"setLocalAccessPointsV2",[$2],Object.getOwnPropertyDescriptor(sr.prototype,"setLocalAccessPointsV2"),sr.prototype),_r(sr.prototype,"setLocalAccessPoints",[eU],Object.getOwnPropertyDescriptor(sr.prototype,"setLocalAccessPoints"),sr.prototype),_r(sr.prototype,"setRemoteDefaultVideoStreamType",[tU],Object.getOwnPropertyDescriptor(sr.prototype,"setRemoteDefaultVideoStreamType"),sr.prototype),_r(sr.prototype,"setRemoteVideoStreamType",[rU],Object.getOwnPropertyDescriptor(sr.prototype,"setRemoteVideoStreamType"),sr.prototype),_r(sr.prototype,"setStreamFallbackOption",[nU],Object.getOwnPropertyDescriptor(sr.prototype,"setStreamFallbackOption"),sr.prototype),_r(sr.prototype,"setEncryptionConfig",[iU],Object.getOwnPropertyDescriptor(sr.prototype,"setEncryptionConfig"),sr.prototype),_r(sr.prototype,"renewToken",[aU],Object.getOwnPropertyDescriptor(sr.prototype,"renewToken"),sr.prototype),_r(sr.prototype,"enableAudioVolumeIndicator",[oU],Object.getOwnPropertyDescriptor(sr.prototype,"enableAudioVolumeIndicator"),sr.prototype),_r(sr.prototype,"startLiveStreaming",[sU],Object.getOwnPropertyDescriptor(sr.prototype,"startLiveStreaming"),sr.prototype),_r(sr.prototype,"setLiveTranscoding",[cU],Object.getOwnPropertyDescriptor(sr.prototype,"setLiveTranscoding"),sr.prototype),_r(sr.prototype,"stopLiveStreaming",[lU],Object.getOwnPropertyDescriptor(sr.prototype,"stopLiveStreaming"),sr.prototype),_r(sr.prototype,"startChannelMediaRelay",[uU],Object.getOwnPropertyDescriptor(sr.prototype,"startChannelMediaRelay"),sr.prototype),_r(sr.prototype,"updateChannelMediaRelay",[dU],Object.getOwnPropertyDescriptor(sr.prototype,"updateChannelMediaRelay"),sr.prototype),_r(sr.prototype,"stopChannelMediaRelay",[hU],Object.getOwnPropertyDescriptor(sr.prototype,"stopChannelMediaRelay"),sr.prototype),_r(sr.prototype,"sendCustomReportMessage",[pU],Object.getOwnPropertyDescriptor(sr.prototype,"sendCustomReportMessage"),sr.prototype),_r(sr.prototype,"pickSVCLayer",[fU],Object.getOwnPropertyDescriptor(sr.prototype,"pickSVCLayer"),sr.prototype),_r(sr.prototype,"setRTMConfig",[mU],Object.getOwnPropertyDescriptor(sr.prototype,"setRTMConfig"),sr.prototype),_r(sr.prototype,"enableContentInspect",[EU],Object.getOwnPropertyDescriptor(sr.prototype,"enableContentInspect"),sr.prototype),_r(sr.prototype,"disableContentInspect",[_U],Object.getOwnPropertyDescriptor(sr.prototype,"disableContentInspect"),sr.prototype),_r(sr.prototype,"setImageModeration",[gU],Object.getOwnPropertyDescriptor(sr.prototype,"setImageModeration"),sr.prototype),_r(sr.prototype,"setP2PTransport",[vU],Object.getOwnPropertyDescriptor(sr.prototype,"setP2PTransport"),sr.prototype),_r(sr.prototype,"getJoinChannelServiceRecords",[TU],Object.getOwnPropertyDescriptor(sr.prototype,"getJoinChannelServiceRecords"),sr.prototype),_r(sr.prototype,"setPublishAudioFilterEnabled",[yU],Object.getOwnPropertyDescriptor(sr.prototype,"setPublishAudioFilterEnabled"),sr.prototype),sr);class fv{constructor(t,r){ie(this,"id",0),ie(this,"element",void 0),ie(this,"peerPair",void 0),ie(this,"context",void 0),ie(this,"audioPlayerElement",void 0),ie(this,"audioTrack",void 0),fv.count+=1,this.id=fv.count,this.element=t,this.context=r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{let r=document.createElement("audio");r.srcObject=new MediaStream([t.track]),r.play(),this.audioPlayerElement=r}}async switchSdp(){if(!this.peerPair)return;let t=async(n,i)=>{let o=i==="offer"?await n.createOffer():await n.createAnswer();return await n.setLocalDescription(o),n.iceGatheringState==="complete"?n.localDescription:new tr(l=>{n.onicegatheringstatechange=()=>{n.iceGatheringState==="complete"&&l(n.localDescription)}})},r=async(n,i)=>await n.setRemoteDescription(i);try{let n=await t(this.peerPair[0],"offer");await r(this.peerPair[1],n);let i=await t(this.peerPair[1],"answer");await r(this.peerPair[0],i)}catch(n){throw new at(ce.LOCAL_AEC_ERROR,n.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let r;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(r)}catch(i){throw new at(ce.LOCAL_AEC_ERROR,i.toString()).print()}if(!r)throw new at(ce.LOCAL_AEC_ERROR,"no dest node when local aec").print();let n=r.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();let t=this.element,r=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(r),await this.switchSdp()}close(){L.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var RU,KR;ie(fv,"count",0);let QG=window.AudioContext||window.webkitAudioContext,$G=new(RU=Nr({report:gr}),_r((KR=class{constructor(){ie(this,"units",[]),ie(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return L.debug("the system does not need to process local aec"),-1;this.context||(this.context=new QG);let t=this.units.find(r=>r&&r.getElement()===e);return t||(t=new fv(e,this.context),this.units.push(t)),t.startEchoCancellation(),L.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return $r().name!==an.SAFARI}}).prototype,"processExternalMediaAEC",[RU],Object.getOwnPropertyDescriptor(KR.prototype,"processExternalMediaAEC"),KR.prototype),KR);function CU(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function IU(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CU(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CU(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let Ob=window||document;function AU(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!Ob)return;let r=Ti._cspEventHandlerPointer;if(r&&t)return void console.error(r,t);let n=i=>{if(!(i&&i.blockedURI&&(Ti.onSecurityPolicyViolation||Ti.getListeners(Ul.SECURITY_POLICY_VIOLATION).length>0)))return;let o=i.blockedURI;Se("CSP_DETECTED_HOSTNAME_LIST").some(l=>Qt(o).call(o,l))&&(Ti.onSecurityPolicyViolation&&typeof Ti.onSecurityPolicyViolation=="function"&&Ti.onSecurityPolicyViolation(i),Ti.getListeners(Ul.SECURITY_POLICY_VIOLATION).length>0&&Ti.safeEmit(Ul.SECURITY_POLICY_VIOLATION,i))};r&&Ob.removeEventListener("securitypolicyviolation",r),(t||e&&typeof e=="function"||Ti.getListeners(Ul.SECURITY_POLICY_VIOLATION).length>0)&&Ob.addEventListener("securitypolicyviolation",n),Ti._cspEventHandlerPointer=n}var eH=v,tH=l1,bU=RegExp.prototype,rH=function(e){return e===bU||eH(bU,e)?tH(e):e.flags},Na=fe(rH);function bE(e){let t=e.length;for(;--t>=0;)e[t]=0}let Nb=256,OU=286,mv=30,Ev=15,wb=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),zR=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),nH=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),NU=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Fu=new Array(576);bE(Fu);let _v=new Array(60);bE(_v);let gv=new Array(512);bE(gv);let vv=new Array(256);bE(vv);let Db=new Array(29);bE(Db);let qR=new Array(mv);function Pb(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}let wU,DU,PU;function Lb(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}bE(qR);let LU=e=>e<256?gv[e]:gv[256+(e>>>7)],Tv=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Ho=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,Tv(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},Fl=(e,t,r)=>{Ho(e,r[2*t],r[2*t+1])},kU=(e,t)=>{let r=0;do r|=1&e,e>>>=1,r<<=1;while(--t>0);return r>>>1},MU=(e,t,r)=>{let n=new Array(16),i,o,l=0;for(i=1;i<=Ev;i++)l=l+r[i-1]<<1,n[i]=l;for(o=0;o<=t;o++){let u=e[2*o+1];u!==0&&(e[2*o]=kU(n[u]++,u))}},UU=e=>{let t;for(t=0;t<OU;t++)e.dyn_ltree[2*t]=0;for(t=0;t<mv;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},xU=e=>{e.bi_valid>8?Tv(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},jU=(e,t,r,n)=>{let i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]},kb=(e,t,r)=>{let n=e.heap[r],i=r<<1;for(;i<=e.heap_len&&(i<e.heap_len&&jU(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!jU(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n},BU=(e,t,r)=>{let n,i,o,l,u=0;if(e.sym_next!==0)do n=255&e.pending_buf[e.sym_buf+u++],n+=(255&e.pending_buf[e.sym_buf+u++])<<8,i=e.pending_buf[e.sym_buf+u++],n===0?Fl(e,i,t):(o=vv[i],Fl(e,o+Nb+1,t),l=wb[o],l!==0&&(i-=Db[o],Ho(e,i,l)),n--,o=LU(n),Fl(e,o,r),l=zR[o],l!==0&&(n-=qR[o],Ho(e,n,l)));while(u<e.sym_next);Fl(e,256,t)},Mb=(e,t)=>{let r=t.dyn_tree,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.elems,l,u,h,m=-1;for(e.heap_len=0,e.heap_max=573,l=0;l<o;l++)r[2*l]!==0?(e.heap[++e.heap_len]=m=l,e.depth[l]=0):r[2*l+1]=0;for(;e.heap_len<2;)h=e.heap[++e.heap_len]=m<2?++m:0,r[2*h]=1,e.depth[h]=0,e.opt_len--,i&&(e.static_len-=n[2*h+1]);for(t.max_code=m,l=e.heap_len>>1;l>=1;l--)kb(e,r,l);h=o;do l=e.heap[1],e.heap[1]=e.heap[e.heap_len--],kb(e,r,1),u=e.heap[1],e.heap[--e.heap_max]=l,e.heap[--e.heap_max]=u,r[2*h]=r[2*l]+r[2*u],e.depth[h]=(e.depth[l]>=e.depth[u]?e.depth[l]:e.depth[u])+1,r[2*l+1]=r[2*u+1]=h,e.heap[1]=h++,kb(e,r,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((_,R)=>{let A=R.dyn_tree,D=R.max_code,J=R.stat_desc.static_tree,V=R.stat_desc.has_stree,K=R.stat_desc.extra_bits,se=R.stat_desc.extra_base,ue=R.stat_desc.max_length,De,ze,Ke,Ve,_t,Vt,ar=0;for(Ve=0;Ve<=Ev;Ve++)_.bl_count[Ve]=0;for(A[2*_.heap[_.heap_max]+1]=0,De=_.heap_max+1;De<573;De++)ze=_.heap[De],Ve=A[2*A[2*ze+1]+1]+1,Ve>ue&&(Ve=ue,ar++),A[2*ze+1]=Ve,ze>D||(_.bl_count[Ve]++,_t=0,ze>=se&&(_t=K[ze-se]),Vt=A[2*ze],_.opt_len+=Vt*(Ve+_t),V&&(_.static_len+=Vt*(J[2*ze+1]+_t)));if(ar!==0){do{for(Ve=ue-1;_.bl_count[Ve]===0;)Ve--;_.bl_count[Ve]--,_.bl_count[Ve+1]+=2,_.bl_count[ue]--,ar-=2}while(ar>0);for(Ve=ue;Ve!==0;Ve--)for(ze=_.bl_count[Ve];ze!==0;)Ke=_.heap[--De],Ke>D||(A[2*Ke+1]!==Ve&&(_.opt_len+=(Ve-A[2*Ke+1])*A[2*Ke],A[2*Ke+1]=Ve),ze--)}})(e,t),MU(r,m,e.bl_count)},VU=(e,t,r)=>{let n,i,o=-1,l=t[1],u=0,h=7,m=4;for(l===0&&(h=138,m=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=l,l=t[2*(n+1)+1],++u<h&&i===l||(u<m?e.bl_tree[2*i]+=u:i!==0?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):u<=10?e.bl_tree[34]++:e.bl_tree[36]++,u=0,o=i,l===0?(h=138,m=3):i===l?(h=6,m=3):(h=7,m=4))},FU=(e,t,r)=>{let n,i,o=-1,l=t[1],u=0,h=7,m=4;for(l===0&&(h=138,m=3),n=0;n<=r;n++)if(i=l,l=t[2*(n+1)+1],!(++u<h&&i===l)){if(u<m)do Fl(e,i,e.bl_tree);while(--u!=0);else i!==0?(i!==o&&(Fl(e,i,e.bl_tree),u--),Fl(e,16,e.bl_tree),Ho(e,u-3,2)):u<=10?(Fl(e,17,e.bl_tree),Ho(e,u-3,3)):(Fl(e,18,e.bl_tree),Ho(e,u-11,7));u=0,o=i,l===0?(h=138,m=3):i===l?(h=6,m=3):(h=7,m=4)}},GU=!1,HU=(e,t,r,n)=>{Ho(e,0+(n?1:0),3),xU(e),Tv(e,r),Tv(e,~r),r&&e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r};var iH=e=>{GU||((()=>{let t,r,n,i,o,l=new Array(16);for(n=0,i=0;i<28;i++)for(Db[i]=n,t=0;t<1<<wb[i];t++)vv[n++]=i;for(vv[n-1]=i,o=0,i=0;i<16;i++)for(qR[i]=o,t=0;t<1<<zR[i];t++)gv[o++]=i;for(o>>=7;i<mv;i++)for(qR[i]=o<<7,t=0;t<1<<zR[i]-7;t++)gv[256+o++]=i;for(r=0;r<=Ev;r++)l[r]=0;for(t=0;t<=143;)Fu[2*t+1]=8,t++,l[8]++;for(;t<=255;)Fu[2*t+1]=9,t++,l[9]++;for(;t<=279;)Fu[2*t+1]=7,t++,l[7]++;for(;t<=287;)Fu[2*t+1]=8,t++,l[8]++;for(MU(Fu,287,l),t=0;t<mv;t++)_v[2*t+1]=5,_v[2*t]=kU(t,5);wU=new Pb(Fu,wb,257,OU,Ev),DU=new Pb(_v,zR,0,mv,Ev),PU=new Pb(new Array(0),nH,0,19,7)})(),GU=!0),e.l_desc=new Lb(e.dyn_ltree,wU),e.d_desc=new Lb(e.dyn_dtree,DU),e.bl_desc=new Lb(e.bl_tree,PU),e.bi_buf=0,e.bi_valid=0,UU(e)},aH=(e,t,r,n)=>{let i,o,l=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(u=>{let h,m=4093624447;for(h=0;h<=31;h++,m>>>=1)if(1&m&&u.dyn_ltree[2*h]!==0)return 0;if(u.dyn_ltree[18]!==0||u.dyn_ltree[20]!==0||u.dyn_ltree[26]!==0)return 1;for(h=32;h<Nb;h++)if(u.dyn_ltree[2*h]!==0)return 1;return 0})(e)),Mb(e,e.l_desc),Mb(e,e.d_desc),l=(u=>{let h;for(VU(u,u.dyn_ltree,u.l_desc.max_code),VU(u,u.dyn_dtree,u.d_desc.max_code),Mb(u,u.bl_desc),h=18;h>=3&&u.bl_tree[2*NU[h]+1]===0;h--);return u.opt_len+=3*(h+1)+5+5+4,h})(e),i=e.opt_len+3+7>>>3,o=e.static_len+3+7>>>3,o<=i&&(i=o)):i=o=r+5,r+4<=i&&t!==-1?HU(e,t,r,n):e.strategy===4||o===i?(Ho(e,2+(n?1:0),3),BU(e,Fu,_v)):(Ho(e,4+(n?1:0),3),((u,h,m,_)=>{let R;for(Ho(u,h-257,5),Ho(u,m-1,5),Ho(u,_-4,4),R=0;R<_;R++)Ho(u,u.bl_tree[2*NU[R]+1],3);FU(u,u.dyn_ltree,h-1),FU(u,u.dyn_dtree,m-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),BU(e,e.dyn_ltree,e.dyn_dtree)),UU(e),n&&xU(e)},oH=(e,t,r)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=r,t===0?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(vv[r]+Nb+1)]++,e.dyn_dtree[2*LU(t)]++),e.sym_next===e.sym_end),sH=e=>{Ho(e,2,3),Fl(e,256,Fu),(t=>{t.bi_valid===16?(Tv(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(e)},cH={_tr_init:iH,_tr_stored_block:HU,_tr_flush_block:aH,_tr_tally:oH,_tr_align:sH},yv=(e,t,r,n)=>{let i=65535&e|0,o=e>>>16&65535|0,l=0;for(;r!==0;){l=r>2e3?2e3:r,r-=l;do i=i+t[n++]|0,o=o+i|0;while(--l);i%=65521,o%=65521}return i|o<<16|0};let lH=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var xa=(e,t,r,n)=>{let i=lH,o=n+r;e^=-1;for(let l=n;l<o;l++)e=e>>>8^i[255&(e^t[l])];return-1^e},Hp={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},YR={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};let{_tr_init:uH,_tr_stored_block:Ub,_tr_flush_block:dH,_tr_tally:nh,_tr_align:hH}=cH,{Z_NO_FLUSH:ih,Z_PARTIAL_FLUSH:pH,Z_FULL_FLUSH:fH,Z_FINISH:tc,Z_BLOCK:WU,Z_OK:Ya,Z_STREAM_END:KU,Z_STREAM_ERROR:Gl,Z_DATA_ERROR:mH,Z_BUF_ERROR:xb,Z_DEFAULT_COMPRESSION:EH,Z_FILTERED:_H,Z_HUFFMAN_ONLY:XR,Z_RLE:gH,Z_FIXED:vH,Z_DEFAULT_STRATEGY:TH,Z_UNKNOWN:yH,Z_DEFLATED:JR}=YR,jb=286,SH=30,RH=19,CH=2*jb+1,IH=15,Wp=258,Hl=262,OE=42,Kp=113,Sv=666,zp=(e,t)=>(e.msg=Hp[t],t),zU=e=>2*e-(e>4?9:0),ah=e=>{let t=e.length;for(;--t>=0;)e[t]=0},AH=e=>{let t,r,n,i=e.w_size;t=e.hash_size,n=t;do r=e.head[--n],e.head[n]=r>=i?r-i:0;while(--t);t=i,n=t;do r=e.prev[--n],e.prev[n]=r>=i?r-i:0;while(--t)},oh=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask,_s=e=>{let t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),r!==0&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,t.pending===0&&(t.pending_out=0))},gs=(e,t)=>{dH(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_s(e.strm)},ri=(e,t)=>{e.pending_buf[e.pending++]=t},Rv=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},Bb=(e,t,r,n)=>{let i=e.avail_in;return i>n&&(i=n),i===0?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),r),e.state.wrap===1?e.adler=yv(e.adler,t,i,r):e.state.wrap===2&&(e.adler=xa(e.adler,t,i,r)),e.next_in+=i,e.total_in+=i,i)},qU=(e,t)=>{let r,n,i=e.max_chain_length,o=e.strstart,l=e.prev_length,u=e.nice_match,h=e.strstart>e.w_size-Hl?e.strstart-(e.w_size-Hl):0,m=e.window,_=e.w_mask,R=e.prev,A=e.strstart+Wp,D=m[o+l-1],J=m[o+l];e.prev_length>=e.good_match&&(i>>=2),u>e.lookahead&&(u=e.lookahead);do if(r=t,m[r+l]===J&&m[r+l-1]===D&&m[r]===m[o]&&m[++r]===m[o+1]){o+=2,r++;do;while(m[++o]===m[++r]&&m[++o]===m[++r]&&m[++o]===m[++r]&&m[++o]===m[++r]&&m[++o]===m[++r]&&m[++o]===m[++r]&&m[++o]===m[++r]&&m[++o]===m[++r]&&o<A);if(n=Wp-(A-o),o=A-Wp,n>l){if(e.match_start=t,l=n,n>=u)break;D=m[o+l-1],J=m[o+l]}}while((t=R[t&_])>h&&--i!=0);return l<=e.lookahead?l:e.lookahead},NE=e=>{let t=e.w_size,r,n,i;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Hl)&&(e.window.set(e.window.subarray(t,t+t-n),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),AH(e),n+=t),e.strm.avail_in===0)break;if(r=Bb(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=r,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=oh(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=oh(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Hl&&e.strm.avail_in!==0)},YU=(e,t)=>{let r,n,i,o=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,l=0,u=e.strm.avail_in;do{if(r=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i||(i=e.strm.avail_out-i,n=e.strstart-e.block_start,r>n+e.strm.avail_in&&(r=n+e.strm.avail_in),r>i&&(r=i),r<o&&(r===0&&t!==tc||t===ih||r!==n+e.strm.avail_in)))break;l=t===tc&&r===n+e.strm.avail_in?1:0,Ub(e,0,0,l),e.pending_buf[e.pending-4]=r,e.pending_buf[e.pending-3]=r>>8,e.pending_buf[e.pending-2]=~r,e.pending_buf[e.pending-1]=~r>>8,_s(e.strm),n&&(n>r&&(n=r),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+n),e.strm.next_out),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n,e.block_start+=n,r-=n),r&&(Bb(e.strm,e.strm.output,e.strm.next_out,r),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r)}while(l===0);return u-=e.strm.avail_in,u&&(u>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=u&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-u,e.strm.next_in),e.strstart),e.strstart+=u,e.insert+=u>e.w_size-e.insert?e.w_size-e.insert:u),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),l?4:t!==ih&&t!==tc&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(Bb(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,o=i>e.w_size?e.w_size:i,n=e.strstart-e.block_start,(n>=o||(n||t===tc)&&t!==ih&&e.strm.avail_in===0&&n<=i)&&(r=n>i?i:n,l=t===tc&&e.strm.avail_in===0&&r===n?1:0,Ub(e,e.block_start,r,l),e.block_start+=r,_s(e.strm)),l?3:1)},Vb=(e,t)=>{let r,n;for(;;){if(e.lookahead<Hl){if(NE(e),e.lookahead<Hl&&t===ih)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=oh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),r!==0&&e.strstart-r<=e.w_size-Hl&&(e.match_length=qU(e,r)),e.match_length>=3)if(n=nh(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=oh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=oh(e,e.ins_h,e.window[e.strstart+1]);else n=nh(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(gs(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,t===tc?(gs(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(gs(e,!1),e.strm.avail_out===0)?1:2},wE=(e,t)=>{let r,n,i;for(;;){if(e.lookahead<Hl){if(NE(e),e.lookahead<Hl&&t===ih)return 1;if(e.lookahead===0)break}if(r=0,e.lookahead>=3&&(e.ins_h=oh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,r!==0&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-Hl&&(e.match_length=qU(e,r),e.match_length<=5&&(e.strategy===_H||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=nh(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=i&&(e.ins_h=oh(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(gs(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(n=nh(e,0,e.window[e.strstart-1]),n&&gs(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=nh(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===tc?(gs(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(gs(e,!1),e.strm.avail_out===0)?1:2};function Wl(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}let Cv=[new Wl(0,0,0,0,YU),new Wl(4,4,8,4,Vb),new Wl(4,5,16,8,Vb),new Wl(4,6,32,32,Vb),new Wl(4,4,16,16,wE),new Wl(8,16,32,32,wE),new Wl(8,16,128,128,wE),new Wl(8,32,128,256,wE),new Wl(32,128,258,1024,wE),new Wl(32,258,258,4096,wE)];function bH(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=JR,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*CH),this.dyn_dtree=new Uint16Array(2*(2*SH+1)),this.bl_tree=new Uint16Array(2*(2*RH+1)),ah(this.dyn_ltree),ah(this.dyn_dtree),ah(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(IH+1),this.heap=new Uint16Array(2*jb+1),ah(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*jb+1),ah(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}let Iv=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.status!==OE&&t.status!==57&&t.status!==69&&t.status!==73&&t.status!==91&&t.status!==103&&t.status!==Kp&&t.status!==Sv?1:0},XU=e=>{if(Iv(e))return zp(e,Gl);e.total_in=e.total_out=0,e.data_type=yH;let t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap===2?57:t.wrap?OE:Kp,e.adler=t.wrap===2?0:1,t.last_flush=-2,uH(t),Ya},JU=e=>{let t=XU(e);return t===Ya&&(r=>{r.window_size=2*r.w_size,ah(r.head),r.max_lazy_match=Cv[r.level].max_lazy,r.good_match=Cv[r.level].good_length,r.nice_match=Cv[r.level].nice_length,r.max_chain_length=Cv[r.level].max_chain,r.strstart=0,r.block_start=0,r.lookahead=0,r.insert=0,r.match_length=r.prev_length=2,r.match_available=0,r.ins_h=0})(e.state),t},ZU=(e,t,r,n,i,o)=>{if(!e)return Gl;let l=1;if(t===EH&&(t=6),n<0?(l=0,n=-n):n>15&&(l=2,n-=16),i<1||i>9||r!==JR||n<8||n>15||t<0||t>9||o<0||o>vH||n===8&&l!==1)return zp(e,Gl);n===8&&(n=9);let u=new bH;return e.state=u,u.strm=e,u.status=OE,u.wrap=l,u.gzhead=null,u.w_bits=n,u.w_size=1<<u.w_bits,u.w_mask=u.w_size-1,u.hash_bits=i+7,u.hash_size=1<<u.hash_bits,u.hash_mask=u.hash_size-1,u.hash_shift=~~((u.hash_bits+3-1)/3),u.window=new Uint8Array(2*u.w_size),u.head=new Uint16Array(u.hash_size),u.prev=new Uint16Array(u.w_size),u.lit_bufsize=1<<i+6,u.pending_buf_size=4*u.lit_bufsize,u.pending_buf=new Uint8Array(u.pending_buf_size),u.sym_buf=u.lit_bufsize,u.sym_end=3*(u.lit_bufsize-1),u.level=t,u.strategy=o,u.method=r,JU(e)};var OH=(e,t)=>{if(Iv(e)||t>WU||t<0)return e?zp(e,Gl):Gl;let r=e.state;if(!e.output||e.avail_in!==0&&!e.input||r.status===Sv&&t!==tc)return zp(e,e.avail_out===0?xb:Gl);let n=r.last_flush;if(r.last_flush=t,r.pending!==0){if(_s(e),e.avail_out===0)return r.last_flush=-1,Ya}else if(e.avail_in===0&&zU(t)<=zU(n)&&t!==tc)return zp(e,xb);if(r.status===Sv&&e.avail_in!==0)return zp(e,xb);if(r.status===OE&&r.wrap===0&&(r.status=Kp),r.status===OE){let i=JR+(r.w_bits-8<<4)<<8,o=-1;if(o=r.strategy>=XR||r.level<2?0:r.level<6?1:r.level===6?2:3,i|=o<<6,r.strstart!==0&&(i|=32),i+=31-i%31,Rv(r,i),r.strstart!==0&&(Rv(r,e.adler>>>16),Rv(r,65535&e.adler)),e.adler=1,r.status=Kp,_s(e),r.pending!==0)return r.last_flush=-1,Ya}if(r.status===57){if(e.adler=0,ri(r,31),ri(r,139),ri(r,8),r.gzhead)ri(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ri(r,255&r.gzhead.time),ri(r,r.gzhead.time>>8&255),ri(r,r.gzhead.time>>16&255),ri(r,r.gzhead.time>>24&255),ri(r,r.level===9?2:r.strategy>=XR||r.level<2?4:0),ri(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ri(r,255&r.gzhead.extra.length),ri(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=xa(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69;else if(ri(r,0),ri(r,0),ri(r,0),ri(r,0),ri(r,0),ri(r,r.level===9?2:r.strategy>=XR||r.level<2?4:0),ri(r,3),r.status=Kp,_s(e),r.pending!==0)return r.last_flush=-1,Ya}if(r.status===69){if(r.gzhead.extra){let i=r.pending,o=(65535&r.gzhead.extra.length)-r.gzindex;for(;r.pending+o>r.pending_buf_size;){let u=r.pending_buf_size-r.pending;if(r.pending_buf.set(r.gzhead.extra.subarray(r.gzindex,r.gzindex+u),r.pending),r.pending=r.pending_buf_size,r.gzhead.hcrc&&r.pending>i&&(e.adler=xa(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex+=u,_s(e),r.pending!==0)return r.last_flush=-1,Ya;i=0,o-=u}let l=new Uint8Array(r.gzhead.extra);r.pending_buf.set(l.subarray(r.gzindex,r.gzindex+o),r.pending),r.pending+=o,r.gzhead.hcrc&&r.pending>i&&(e.adler=xa(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex=0}r.status=73}if(r.status===73){if(r.gzhead.name){let i,o=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(e.adler=xa(e.adler,r.pending_buf,r.pending-o,o)),_s(e),r.pending!==0)return r.last_flush=-1,Ya;o=0}i=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ri(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>o&&(e.adler=xa(e.adler,r.pending_buf,r.pending-o,o)),r.gzindex=0}r.status=91}if(r.status===91){if(r.gzhead.comment){let i,o=r.pending;do{if(r.pending===r.pending_buf_size){if(r.gzhead.hcrc&&r.pending>o&&(e.adler=xa(e.adler,r.pending_buf,r.pending-o,o)),_s(e),r.pending!==0)return r.last_flush=-1,Ya;o=0}i=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ri(r,i)}while(i!==0);r.gzhead.hcrc&&r.pending>o&&(e.adler=xa(e.adler,r.pending_buf,r.pending-o,o))}r.status=103}if(r.status===103){if(r.gzhead.hcrc){if(r.pending+2>r.pending_buf_size&&(_s(e),r.pending!==0))return r.last_flush=-1,Ya;ri(r,255&e.adler),ri(r,e.adler>>8&255),e.adler=0}if(r.status=Kp,_s(e),r.pending!==0)return r.last_flush=-1,Ya}if(e.avail_in!==0||r.lookahead!==0||t!==ih&&r.status!==Sv){let i=r.level===0?YU(r,t):r.strategy===XR?((o,l)=>{let u;for(;;){if(o.lookahead===0&&(NE(o),o.lookahead===0)){if(l===ih)return 1;break}if(o.match_length=0,u=nh(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++,u&&(gs(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,l===tc?(gs(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(gs(o,!1),o.strm.avail_out===0)?1:2})(r,t):r.strategy===gH?((o,l)=>{let u,h,m,_,R=o.window;for(;;){if(o.lookahead<=Wp){if(NE(o),o.lookahead<=Wp&&l===ih)return 1;if(o.lookahead===0)break}if(o.match_length=0,o.lookahead>=3&&o.strstart>0&&(m=o.strstart-1,h=R[m],h===R[++m]&&h===R[++m]&&h===R[++m])){_=o.strstart+Wp;do;while(h===R[++m]&&h===R[++m]&&h===R[++m]&&h===R[++m]&&h===R[++m]&&h===R[++m]&&h===R[++m]&&h===R[++m]&&m<_);o.match_length=Wp-(_-m),o.match_length>o.lookahead&&(o.match_length=o.lookahead)}if(o.match_length>=3?(u=nh(o,1,o.match_length-3),o.lookahead-=o.match_length,o.strstart+=o.match_length,o.match_length=0):(u=nh(o,0,o.window[o.strstart]),o.lookahead--,o.strstart++),u&&(gs(o,!1),o.strm.avail_out===0))return 1}return o.insert=0,l===tc?(gs(o,!0),o.strm.avail_out===0?3:4):o.sym_next&&(gs(o,!1),o.strm.avail_out===0)?1:2})(r,t):Cv[r.level].func(r,t);if(i!==3&&i!==4||(r.status=Sv),i===1||i===3)return e.avail_out===0&&(r.last_flush=-1),Ya;if(i===2&&(t===pH?hH(r):t!==WU&&(Ub(r,0,0,!1),t===fH&&(ah(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),_s(e),e.avail_out===0))return r.last_flush=-1,Ya}return t!==tc?Ya:r.wrap<=0?KU:(r.wrap===2?(ri(r,255&e.adler),ri(r,e.adler>>8&255),ri(r,e.adler>>16&255),ri(r,e.adler>>24&255),ri(r,255&e.total_in),ri(r,e.total_in>>8&255),ri(r,e.total_in>>16&255),ri(r,e.total_in>>24&255)):(Rv(r,e.adler>>>16),Rv(r,65535&e.adler)),_s(e),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Ya:KU)},NH=(e,t)=>{let r=t.length;if(Iv(e))return Gl;let n=e.state,i=n.wrap;if(i===2||i===1&&n.status!==OE||n.lookahead)return Gl;if(i===1&&(e.adler=yv(e.adler,t,r,0)),n.wrap=0,r>=n.w_size){i===0&&(ah(n.head),n.strstart=0,n.block_start=0,n.insert=0);let h=new Uint8Array(n.w_size);h.set(t.subarray(r-n.w_size,r),0),t=h,r=n.w_size}let o=e.avail_in,l=e.next_in,u=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,NE(n);n.lookahead>=3;){let h=n.strstart,m=n.lookahead-2;do n.ins_h=oh(n,n.ins_h,n.window[h+3-1]),n.prev[h&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=h,h++;while(--m);n.strstart=h,n.lookahead=2,NE(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=2,n.match_available=0,e.next_in=l,e.input=u,e.avail_in=o,n.wrap=i,Ya},Av={deflateInit:(e,t)=>ZU(e,t,JR,15,8,TH),deflateInit2:ZU,deflateReset:JU,deflateResetKeep:XU,deflateSetHeader:(e,t)=>Iv(e)||e.state.wrap!==2?Gl:(e.state.gzhead=t,Ya),deflate:OH,deflateEnd:e=>{if(Iv(e))return Gl;let t=e.state.status;return e.state=null,t===Kp?zp(e,mH):Ya},deflateSetDictionary:NH,deflateInfo:"pako deflate (from Nodeca project)"};let wH=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var ZR={assign:function(e){let t=Array.prototype.slice.call(arguments,1);for(;t.length;){let r=t.shift();if(r){if(typeof r!="object")throw new TypeError(r+"must be non-object");for(let n in r)wH(r,n)&&(e[n]=r[n])}}return e},flattenChunks:e=>{let t=0;for(let n=0,i=e.length;n<i;n++)t+=e[n].length;let r=new Uint8Array(t);for(let n=0,i=0,o=e.length;n<o;n++){let l=e[n];r.set(l,i),i+=l.length}return r}};let QU=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{QU=!1}let bv=new Uint8Array(256);for(let e=0;e<256;e++)bv[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;bv[254]=bv[254]=1;var Ov={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let t,r,n,i,o,l=e.length,u=0;for(i=0;i<l;i++)r=e.charCodeAt(i),(64512&r)==55296&&i+1<l&&(n=e.charCodeAt(i+1),(64512&n)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),u+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(u),o=0,i=0;o<u;i++)r=e.charCodeAt(i),(64512&r)==55296&&i+1<l&&(n=e.charCodeAt(i+1),(64512&n)==56320&&(r=65536+(r-55296<<10)+(n-56320),i++)),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},buf2string:(e,t)=>{let r=t||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,t));let n,i,o=new Array(2*r);for(i=0,n=0;n<r;){let l=e[n++];if(l<128){o[i++]=l;continue}let u=bv[l];if(u>4)o[i++]=65533,n+=u-1;else{for(l&=u===2?31:u===3?15:7;u>1&&n<r;)l=l<<6|63&e[n++],u--;u>1?o[i++]=65533:l<65536?o[i++]=l:(l-=65536,o[i++]=55296|l>>10&1023,o[i++]=56320|1023&l)}}return((l,u)=>{if(u<65534&&l.subarray&&QU)return String.fromCharCode.apply(null,l.length===u?l:l.subarray(0,u));let h="";for(let m=0;m<u;m++)h+=String.fromCharCode(l[m]);return h})(o,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&(192&e[r])==128;)r--;return r<0||r===0?t:r+bv[e[r]]>t?r:t}},$U=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};let ex=Object.prototype.toString,{Z_NO_FLUSH:DH,Z_SYNC_FLUSH:PH,Z_FULL_FLUSH:LH,Z_FINISH:kH,Z_OK:QR,Z_STREAM_END:MH,Z_DEFAULT_COMPRESSION:UH,Z_DEFAULT_STRATEGY:xH,Z_DEFLATED:jH}=YR;function $R(e){this.options=ZR.assign({level:UH,method:jH,chunkSize:16384,windowBits:15,memLevel:8,strategy:xH},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $U,this.strm.avail_out=0;let r=Av.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==QR)throw new Error(Hp[r]);if(t.header&&Av.deflateSetHeader(this.strm,t.header),t.dictionary){let n;if(n=typeof t.dictionary=="string"?Ov.string2buf(t.dictionary):ex.call(t.dictionary)==="[object ArrayBuffer]"?new Uint8Array(t.dictionary):t.dictionary,r=Av.deflateSetDictionary(this.strm,n),r!==QR)throw new Error(Hp[r]);this._dict_set=!0}}function BH(e,t){let r=new $R(t);if(r.push(e,!0),r.err)throw r.msg||Hp[r.err];return r.result}$R.prototype.push=function(e,t){let r=this.strm,n=this.options.chunkSize,i,o;if(this.ended)return!1;for(o=t===~~t?t:t===!0?kH:DH,typeof e=="string"?r.input=Ov.string2buf(e):ex.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),(o===PH||o===LH)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(i=Av.deflate(r,o),i===MH)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),i=Av.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===QR;if(r.avail_out!==0){if(o>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(r.avail_in===0)break}else this.onData(r.output)}return!0},$R.prototype.onData=function(e){this.chunks.push(e)},$R.prototype.onEnd=function(e){e===QR&&(this.result=ZR.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var VH={deflate:BH};let e0=16209;var FH=function(e,t){let r,n,i,o,l,u,h,m,_,R,A,D,J,V,K,se,ue,De,ze,Ke,Ve,_t,Vt,ar,ur=e.state;r=e.next_in,Vt=e.input,n=r+(e.avail_in-5),i=e.next_out,ar=e.output,o=i-(t-e.avail_out),l=i+(e.avail_out-257),u=ur.dmax,h=ur.wsize,m=ur.whave,_=ur.wnext,R=ur.window,A=ur.hold,D=ur.bits,J=ur.lencode,V=ur.distcode,K=(1<<ur.lenbits)-1,se=(1<<ur.distbits)-1;e:do{D<15&&(A+=Vt[r++]<<D,D+=8,A+=Vt[r++]<<D,D+=8),ue=J[A&K];t:for(;;){if(De=ue>>>24,A>>>=De,D-=De,De=ue>>>16&255,De===0)ar[i++]=65535&ue;else{if(!(16&De)){if(!(64&De)){ue=J[(65535&ue)+(A&(1<<De)-1)];continue t}if(32&De){ur.mode=16191;break e}e.msg="invalid literal/length code",ur.mode=e0;break e}ze=65535&ue,De&=15,De&&(D<De&&(A+=Vt[r++]<<D,D+=8),ze+=A&(1<<De)-1,A>>>=De,D-=De),D<15&&(A+=Vt[r++]<<D,D+=8,A+=Vt[r++]<<D,D+=8),ue=V[A&se];r:for(;;){if(De=ue>>>24,A>>>=De,D-=De,De=ue>>>16&255,!(16&De)){if(!(64&De)){ue=V[(65535&ue)+(A&(1<<De)-1)];continue r}e.msg="invalid distance code",ur.mode=e0;break e}if(Ke=65535&ue,De&=15,D<De&&(A+=Vt[r++]<<D,D+=8,D<De&&(A+=Vt[r++]<<D,D+=8)),Ke+=A&(1<<De)-1,Ke>u){e.msg="invalid distance too far back",ur.mode=e0;break e}if(A>>>=De,D-=De,De=i-o,Ke>De){if(De=Ke-De,De>m&&ur.sane){e.msg="invalid distance too far back",ur.mode=e0;break e}if(Ve=0,_t=R,_===0){if(Ve+=h-De,De<ze){ze-=De;do ar[i++]=R[Ve++];while(--De);Ve=i-Ke,_t=ar}}else if(_<De){if(Ve+=h+_-De,De-=_,De<ze){ze-=De;do ar[i++]=R[Ve++];while(--De);if(Ve=0,_<ze){De=_,ze-=De;do ar[i++]=R[Ve++];while(--De);Ve=i-Ke,_t=ar}}}else if(Ve+=_-De,De<ze){ze-=De;do ar[i++]=R[Ve++];while(--De);Ve=i-Ke,_t=ar}for(;ze>2;)ar[i++]=_t[Ve++],ar[i++]=_t[Ve++],ar[i++]=_t[Ve++],ze-=3;ze&&(ar[i++]=_t[Ve++],ze>1&&(ar[i++]=_t[Ve++]))}else{Ve=i-Ke;do ar[i++]=ar[Ve++],ar[i++]=ar[Ve++],ar[i++]=ar[Ve++],ze-=3;while(ze>2);ze&&(ar[i++]=ar[Ve++],ze>1&&(ar[i++]=ar[Ve++]))}break}}break}}while(r<n&&i<l);ze=D>>3,r-=ze,D-=ze<<3,A&=(1<<D)-1,e.next_in=r,e.next_out=i,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=i<l?l-i+257:257-(i-l),ur.hold=A,ur.bits=D};let t0=15,GH=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),HH=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),WH=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),KH=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Nv=(e,t,r,n,i,o,l,u)=>{let h=u.bits,m,_,R,A,D,J,V=0,K=0,se=0,ue=0,De=0,ze=0,Ke=0,Ve=0,_t=0,Vt=0,ar=null,ur=new Uint16Array(16),Kr=new Uint16Array(16),zr,wn,si,ti=null;for(V=0;V<=t0;V++)ur[V]=0;for(K=0;K<n;K++)ur[t[r+K]]++;for(De=h,ue=t0;ue>=1&&ur[ue]===0;ue--);if(De>ue&&(De=ue),ue===0)return i[o++]=20971520,i[o++]=20971520,u.bits=1,0;for(se=1;se<ue&&ur[se]===0;se++);for(De<se&&(De=se),Ve=1,V=1;V<=t0;V++)if(Ve<<=1,Ve-=ur[V],Ve<0)return-1;if(Ve>0&&(e===0||ue!==1))return-1;for(Kr[1]=0,V=1;V<t0;V++)Kr[V+1]=Kr[V]+ur[V];for(K=0;K<n;K++)t[r+K]!==0&&(l[Kr[t[r+K]]++]=K);if(e===0?(ar=ti=l,J=20):e===1?(ar=GH,ti=HH,J=257):(ar=WH,ti=KH,J=0),Vt=0,K=0,V=se,D=o,ze=De,Ke=0,R=-1,_t=1<<De,A=_t-1,e===1&&_t>852||e===2&&_t>592)return 1;for(;;){zr=V-Ke,l[K]+1<J?(wn=0,si=l[K]):l[K]>=J?(wn=ti[l[K]-J],si=ar[l[K]-J]):(wn=96,si=0),m=1<<V-Ke,_=1<<ze,se=_;do _-=m,i[D+(Vt>>Ke)+_]=zr<<24|wn<<16|si|0;while(_!==0);for(m=1<<V-1;Vt&m;)m>>=1;if(m!==0?(Vt&=m-1,Vt+=m):Vt=0,K++,--ur[V]==0){if(V===ue)break;V=t[r+l[K]]}if(V>De&&(Vt&A)!==R){for(Ke===0&&(Ke=De),D+=se,ze=V-Ke,Ve=1<<ze;ze+Ke<ue&&(Ve-=ur[ze+Ke],!(Ve<=0));)ze++,Ve<<=1;if(_t+=1<<ze,e===1&&_t>852||e===2&&_t>592)return 1;R=Vt&A,i[R]=De<<24|ze<<16|D-o|0}}return Vt!==0&&(i[D+Vt]=V-Ke<<24|64<<16|0),u.bits=De,0};let{Z_FINISH:tx,Z_BLOCK:zH,Z_TREES:r0,Z_OK:qp,Z_STREAM_END:qH,Z_NEED_DICT:YH,Z_STREAM_ERROR:rc,Z_DATA_ERROR:rx,Z_MEM_ERROR:nx,Z_BUF_ERROR:XH,Z_DEFLATED:ix}=YR,n0=16180,i0=16190,Gu=16191,Fb=16192,Gb=16194,a0=16199,o0=16200,Hb=16206,Hi=16209,ax=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function JH(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}let Yp=e=>{if(!e)return 1;let t=e.state;return!t||t.strm!==e||t.mode<n0||t.mode>16211?1:0},ox=e=>{if(Yp(e))return rc;let t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=n0,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,qp},sx=e=>{if(Yp(e))return rc;let t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,ox(e)},cx=(e,t)=>{let r;if(Yp(e))return rc;let n=e.state;return t<0?(r=0,t=-t):(r=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?rc:(n.window!==null&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,sx(e))},lx=(e,t)=>{if(!e)return rc;let r=new JH;e.state=r,r.strm=e,r.window=null,r.mode=n0;let n=cx(e,t);return n!==qp&&(e.state=null),n},Wb,Kb,ux=!0,ZH=e=>{if(ux){Wb=new Int32Array(512),Kb=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Nv(1,e.lens,0,288,Wb,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Nv(2,e.lens,0,32,Kb,0,e.work,{bits:5}),ux=!1}e.lencode=Wb,e.lenbits=9,e.distcode=Kb,e.distbits=5},dx=(e,t,r,n)=>{let i,o=e.state;return o.window===null&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new Uint8Array(o.wsize)),n>=o.wsize?(o.window.set(t.subarray(r-o.wsize,r),0),o.wnext=0,o.whave=o.wsize):(i=o.wsize-o.wnext,i>n&&(i=n),o.window.set(t.subarray(r-n,r-n+i),o.wnext),(n-=i)?(o.window.set(t.subarray(r-n,r),0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0};var QH=(e,t)=>{let r,n,i,o,l,u,h,m,_,R,A,D,J,V,K,se,ue,De,ze,Ke,Ve,_t,Vt=0,ar=new Uint8Array(4),ur,Kr,zr=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Yp(e)||!e.output||!e.input&&e.avail_in!==0)return rc;r=e.state,r.mode===Gu&&(r.mode=Fb),l=e.next_out,i=e.output,h=e.avail_out,o=e.next_in,n=e.input,u=e.avail_in,m=r.hold,_=r.bits,R=u,A=h,_t=qp;e:for(;;)switch(r.mode){case n0:if(r.wrap===0){r.mode=Fb;break}for(;_<16;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}if(2&r.wrap&&m===35615){r.wbits===0&&(r.wbits=15),r.check=0,ar[0]=255&m,ar[1]=m>>>8&255,r.check=xa(r.check,ar,2,0),m=0,_=0,r.mode=16181;break}if(r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&m)<<8)+(m>>8))%31){e.msg="incorrect header check",r.mode=Hi;break}if((15&m)!==ix){e.msg="unknown compression method",r.mode=Hi;break}if(m>>>=4,_-=4,Ve=8+(15&m),r.wbits===0&&(r.wbits=Ve),Ve>15||Ve>r.wbits){e.msg="invalid window size",r.mode=Hi;break}r.dmax=1<<r.wbits,r.flags=0,e.adler=r.check=1,r.mode=512&m?16189:Gu,m=0,_=0;break;case 16181:for(;_<16;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}if(r.flags=m,(255&Na(r))!==ix){e.msg="unknown compression method",r.mode=Hi;break}if(57344&Na(r)){e.msg="unknown header flags set",r.mode=Hi;break}r.head&&(r.head.text=m>>8&1),512&Na(r)&&4&r.wrap&&(ar[0]=255&m,ar[1]=m>>>8&255,r.check=xa(r.check,ar,2,0)),m=0,_=0,r.mode=16182;case 16182:for(;_<32;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}r.head&&(r.head.time=m),512&Na(r)&&4&r.wrap&&(ar[0]=255&m,ar[1]=m>>>8&255,ar[2]=m>>>16&255,ar[3]=m>>>24&255,r.check=xa(r.check,ar,4,0)),m=0,_=0,r.mode=16183;case 16183:for(;_<16;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}r.head&&(r.head.xflags=255&m,r.head.os=m>>8),512&Na(r)&&4&r.wrap&&(ar[0]=255&m,ar[1]=m>>>8&255,r.check=xa(r.check,ar,2,0)),m=0,_=0,r.mode=16184;case 16184:if(1024&Na(r)){for(;_<16;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}r.length=m,r.head&&(r.head.extra_len=m),512&Na(r)&&4&r.wrap&&(ar[0]=255&m,ar[1]=m>>>8&255,r.check=xa(r.check,ar,2,0)),m=0,_=0}else r.head&&(r.head.extra=null);r.mode=16185;case 16185:if(1024&Na(r)&&(D=r.length,D>u&&(D=u),D&&(r.head&&(Ve=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(n.subarray(o,o+D),Ve)),512&Na(r)&&4&r.wrap&&(r.check=xa(r.check,n,D,o)),u-=D,o+=D,r.length-=D),r.length))break e;r.length=0,r.mode=16186;case 16186:if(2048&Na(r)){if(u===0)break e;D=0;do Ve=n[o+D++],r.head&&Ve&&r.length<65536&&(r.head.name+=String.fromCharCode(Ve));while(Ve&&D<u);if(512&Na(r)&&4&r.wrap&&(r.check=xa(r.check,n,D,o)),u-=D,o+=D,Ve)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=16187;case 16187:if(4096&Na(r)){if(u===0)break e;D=0;do Ve=n[o+D++],r.head&&Ve&&r.length<65536&&(r.head.comment+=String.fromCharCode(Ve));while(Ve&&D<u);if(512&Na(r)&&4&r.wrap&&(r.check=xa(r.check,n,D,o)),u-=D,o+=D,Ve)break e}else r.head&&(r.head.comment=null);r.mode=16188;case 16188:if(512&Na(r)){for(;_<16;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}if(4&r.wrap&&m!==(65535&r.check)){e.msg="header crc mismatch",r.mode=Hi;break}m=0,_=0}r.head&&(r.head.hcrc=Na(r)>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=Gu;break;case 16189:for(;_<32;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}e.adler=r.check=ax(m),m=0,_=0,r.mode=i0;case i0:if(r.havedict===0)return e.next_out=l,e.avail_out=h,e.next_in=o,e.avail_in=u,r.hold=m,r.bits=_,YH;e.adler=r.check=1,r.mode=Gu;case Gu:if(t===zH||t===r0)break e;case Fb:if(r.last){m>>>=7&_,_-=7&_,r.mode=Hb;break}for(;_<3;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}switch(r.last=1&m,m>>>=1,_-=1,3&m){case 0:r.mode=16193;break;case 1:if(ZH(r),r.mode=a0,t===r0){m>>>=2,_-=2;break e}break;case 2:r.mode=16196;break;case 3:e.msg="invalid block type",r.mode=Hi}m>>>=2,_-=2;break;case 16193:for(m>>>=7&_,_-=7&_;_<32;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}if((65535&m)!=(m>>>16^65535)){e.msg="invalid stored block lengths",r.mode=Hi;break}if(r.length=65535&m,m=0,_=0,r.mode=Gb,t===r0)break e;case Gb:r.mode=16195;case 16195:if(D=r.length,D){if(D>u&&(D=u),D>h&&(D=h),D===0)break e;i.set(n.subarray(o,o+D),l),u-=D,o+=D,h-=D,l+=D,r.length-=D;break}r.mode=Gu;break;case 16196:for(;_<14;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}if(r.nlen=257+(31&m),m>>>=5,_-=5,r.ndist=1+(31&m),m>>>=5,_-=5,r.ncode=4+(15&m),m>>>=4,_-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=Hi;break}r.have=0,r.mode=16197;case 16197:for(;r.have<r.ncode;){for(;_<3;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}r.lens[zr[r.have++]]=7&m,m>>>=3,_-=3}for(;r.have<19;)r.lens[zr[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,ur={bits:r.lenbits},_t=Nv(0,r.lens,0,19,r.lencode,0,r.work,ur),r.lenbits=ur.bits,_t){e.msg="invalid code lengths set",r.mode=Hi;break}r.have=0,r.mode=16198;case 16198:for(;r.have<r.nlen+r.ndist;){for(;Vt=r.lencode[m&(1<<r.lenbits)-1],K=Vt>>>24,se=Vt>>>16&255,ue=65535&Vt,!(K<=_);){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}if(ue<16)m>>>=K,_-=K,r.lens[r.have++]=ue;else{if(ue===16){for(Kr=K+2;_<Kr;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}if(m>>>=K,_-=K,r.have===0){e.msg="invalid bit length repeat",r.mode=Hi;break}Ve=r.lens[r.have-1],D=3+(3&m),m>>>=2,_-=2}else if(ue===17){for(Kr=K+3;_<Kr;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}m>>>=K,_-=K,Ve=0,D=3+(7&m),m>>>=3,_-=3}else{for(Kr=K+7;_<Kr;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}m>>>=K,_-=K,Ve=0,D=11+(127&m),m>>>=7,_-=7}if(r.have+D>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=Hi;break}for(;D--;)r.lens[r.have++]=Ve}}if(r.mode===Hi)break;if(r.lens[256]===0){e.msg="invalid code -- missing end-of-block",r.mode=Hi;break}if(r.lenbits=9,ur={bits:r.lenbits},_t=Nv(1,r.lens,0,r.nlen,r.lencode,0,r.work,ur),r.lenbits=ur.bits,_t){e.msg="invalid literal/lengths set",r.mode=Hi;break}if(r.distbits=6,r.distcode=r.distdyn,ur={bits:r.distbits},_t=Nv(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,ur),r.distbits=ur.bits,_t){e.msg="invalid distances set",r.mode=Hi;break}if(r.mode=a0,t===r0)break e;case a0:r.mode=o0;case o0:if(u>=6&&h>=258){e.next_out=l,e.avail_out=h,e.next_in=o,e.avail_in=u,r.hold=m,r.bits=_,FH(e,A),l=e.next_out,i=e.output,h=e.avail_out,o=e.next_in,n=e.input,u=e.avail_in,m=r.hold,_=r.bits,r.mode===Gu&&(r.back=-1);break}for(r.back=0;Vt=r.lencode[m&(1<<r.lenbits)-1],K=Vt>>>24,se=Vt>>>16&255,ue=65535&Vt,!(K<=_);){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}if(se&&!(240&se)){for(De=K,ze=se,Ke=ue;Vt=r.lencode[Ke+((m&(1<<De+ze)-1)>>De)],K=Vt>>>24,se=Vt>>>16&255,ue=65535&Vt,!(De+K<=_);){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}m>>>=De,_-=De,r.back+=De}if(m>>>=K,_-=K,r.back+=K,r.length=ue,se===0){r.mode=16205;break}if(32&se){r.back=-1,r.mode=Gu;break}if(64&se){e.msg="invalid literal/length code",r.mode=Hi;break}r.extra=15&se,r.mode=16201;case 16201:if(r.extra){for(Kr=r.extra;_<Kr;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}r.length+=m&(1<<r.extra)-1,m>>>=r.extra,_-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=16202;case 16202:for(;Vt=r.distcode[m&(1<<r.distbits)-1],K=Vt>>>24,se=Vt>>>16&255,ue=65535&Vt,!(K<=_);){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}if(!(240&se)){for(De=K,ze=se,Ke=ue;Vt=r.distcode[Ke+((m&(1<<De+ze)-1)>>De)],K=Vt>>>24,se=Vt>>>16&255,ue=65535&Vt,!(De+K<=_);){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}m>>>=De,_-=De,r.back+=De}if(m>>>=K,_-=K,r.back+=K,64&se){e.msg="invalid distance code",r.mode=Hi;break}r.offset=ue,r.extra=15&se,r.mode=16203;case 16203:if(r.extra){for(Kr=r.extra;_<Kr;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}r.offset+=m&(1<<r.extra)-1,m>>>=r.extra,_-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=Hi;break}r.mode=16204;case 16204:if(h===0)break e;if(D=A-h,r.offset>D){if(D=r.offset-D,D>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=Hi;break}D>r.wnext?(D-=r.wnext,J=r.wsize-D):J=r.wnext-D,D>r.length&&(D=r.length),V=r.window}else V=i,J=l-r.offset,D=r.length;D>h&&(D=h),h-=D,r.length-=D;do i[l++]=V[J++];while(--D);r.length===0&&(r.mode=o0);break;case 16205:if(h===0)break e;i[l++]=r.length,h--,r.mode=o0;break;case Hb:if(r.wrap){for(;_<32;){if(u===0)break e;u--,m|=n[o++]<<_,_+=8}if(A-=h,e.total_out+=A,r.total+=A,4&r.wrap&&A&&(e.adler=r.check=Na(r)?xa(r.check,i,A,l-A):yv(r.check,i,A,l-A)),A=h,4&r.wrap&&(Na(r)?m:ax(m))!==r.check){e.msg="incorrect data check",r.mode=Hi;break}m=0,_=0}r.mode=16207;case 16207:if(r.wrap&&Na(r)){for(;_<32;){if(u===0)break e;u--,m+=n[o++]<<_,_+=8}if(4&r.wrap&&m!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=Hi;break}m=0,_=0}r.mode=16208;case 16208:_t=qH;break e;case Hi:_t=rx;break e;case 16210:return nx;default:return rc}return e.next_out=l,e.avail_out=h,e.next_in=o,e.avail_in=u,r.hold=m,r.bits=_,(r.wsize||A!==e.avail_out&&r.mode<Hi&&(r.mode<Hb||t!==tx))&&dx(e,e.output,e.next_out,A-e.avail_out),R-=e.avail_in,A-=e.avail_out,e.total_in+=R,e.total_out+=A,r.total+=A,4&r.wrap&&A&&(e.adler=r.check=Na(r)?xa(r.check,i,A,e.next_out-A):yv(r.check,i,A,e.next_out-A)),e.data_type=r.bits+(r.last?64:0)+(r.mode===Gu?128:0)+(r.mode===a0||r.mode===Gb?256:0),(R===0&&A===0||t===tx)&&_t===qp&&(_t=XH),_t},Hu={inflateReset:sx,inflateReset2:cx,inflateResetKeep:ox,inflateInit:e=>lx(e,15),inflateInit2:lx,inflate:QH,inflateEnd:e=>{if(Yp(e))return rc;let t=e.state;return t.window&&(t.window=null),e.state=null,qp},inflateGetHeader:(e,t)=>{if(Yp(e))return rc;let r=e.state;return 2&r.wrap?(r.head=t,t.done=!1,qp):rc},inflateSetDictionary:(e,t)=>{let r=t.length,n,i,o;return Yp(e)?rc:(n=e.state,n.wrap!==0&&n.mode!==i0?rc:n.mode===i0&&(i=1,i=yv(i,t,r,0),i!==n.check)?rx:(o=dx(e,t,r,r),o?(n.mode=16210,nx):(n.havedict=1,qp)))},inflateInfo:"pako inflate (from Nodeca project)"},$H=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};let hx=Object.prototype.toString,{Z_NO_FLUSH:e8,Z_FINISH:t8,Z_OK:wv,Z_STREAM_END:zb,Z_NEED_DICT:qb,Z_STREAM_ERROR:r8,Z_DATA_ERROR:px,Z_MEM_ERROR:n8}=YR;function s0(e){this.options=ZR.assign({chunkSize:65536,windowBits:15,to:""},e||{});let t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,t.windowBits===0&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $U,this.strm.avail_out=0;let r=Hu.inflateInit2(this.strm,t.windowBits);if(r!==wv)throw new Error(Hp[r]);if(this.header=new $H,Hu.inflateGetHeader(this.strm,this.header),t.dictionary&&(typeof t.dictionary=="string"?t.dictionary=Ov.string2buf(t.dictionary):hx.call(t.dictionary)==="[object ArrayBuffer]"&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=Hu.inflateSetDictionary(this.strm,t.dictionary),r!==wv)))throw new Error(Hp[r])}function i8(e,t){let r=new s0(t);if(r.push(e),r.err)throw r.msg||Hp[r.err];return r.result}s0.prototype.push=function(e,t){let r=this.strm,n=this.options.chunkSize,i=this.options.dictionary,o,l,u;if(this.ended)return!1;for(l=t===~~t?t:t===!0?t8:e8,hx.call(e)==="[object ArrayBuffer]"?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(r.avail_out===0&&(r.output=new Uint8Array(n),r.next_out=0,r.avail_out=n),o=Hu.inflate(r,l),o===qb&&i&&(o=Hu.inflateSetDictionary(r,i),o===wv?o=Hu.inflate(r,l):o===px&&(o=qb));r.avail_in>0&&o===zb&&r.state.wrap>0&&e[r.next_in]!==0;)Hu.inflateReset(r),o=Hu.inflate(r,l);switch(o){case r8:case px:case qb:case n8:return this.onEnd(o),this.ended=!0,!1}if(u=r.avail_out,r.next_out&&(r.avail_out===0||o===zb))if(this.options.to==="string"){let h=Ov.utf8border(r.output,r.next_out),m=r.next_out-h,_=Ov.buf2string(r.output,h);r.next_out=m,r.avail_out=n-m,m&&r.output.set(r.output.subarray(h,h+m),0),this.onData(_)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(o!==wv||u!==0){if(o===zb)return o=Hu.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,!0;if(r.avail_in===0)break}}return!0},s0.prototype.onData=function(e){this.chunks.push(e)},s0.prototype.onEnd=function(e){e===wv&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=ZR.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var a8={inflate:i8};let{deflate:o8}=VH,{inflate:s8}=a8;var c8=o8,l8=s8,fx=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(fx||{});class u8{constructor(){ie(this,"_sequence",0),ie(this,"_startTime",Date.now()),ie(this,"isUseOneByte",!0)}get startTime(){let t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){let r={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){let u=new Uint8Array(4);u.set([1,0,0,0]);let h={id:0,length:4,data:u.buffer},m={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[h]};r.commonPacketHeader.extension=1,r.extension=m,r.payload=this.compress(t),r.commonPacketHeader.length=8+(r.extension.length+2)+r.payload.byteLength}else r.commonPacketHeader.length=8+r.payload.byteLength;Se("SHOW_DATASTREAM2_LOG")&&L.debug("send data header: ".concat(JSON.stringify(r.commonPacketHeader)));let n=new ArrayBuffer(r.commonPacketHeader.length),i=new Uint8Array(n),o=new DataView(n),l=0;if(o.setUint16(l,r.commonPacketHeader.extension<<15|r.commonPacketHeader.reserved<<14|r.commonPacketHeader.length,!0),l+=2,o.setUint32(l,r.commonPacketHeader.sequence,!0),l+=4,o.setUint16(l,r.commonStreamHeader,!0),l+=2,r.extension){let u=this.serializeExtension(r.extension);i.set(new Uint8Array(u),l),l+=u.byteLength}if(i.set(new Uint8Array(r.payload),l),l+=r.payload.byteLength,l!==r.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);let r=new DataView(t),n=0,i=r.getUint16(n,!0);n+=2;let o={length:16383&i,reserved:(16384&i)>>14,extension:(32768&i)>>15,sequence:r.getUint16(n+2,!0)<<16|r.getUint16(n,!0)},l,u;if(n+=4,Se("SHOW_DATASTREAM2_LOG")&&L.debug("receive data header: ".concat(JSON.stringify(o))),r.getUint16(n,!0),n+=2,o.extension){u=this.deserializeExtension(t.slice(n)),n+=2+u.length,l=t.slice(n);let h=!1;if(u.datas.length>0){let m=u.datas.find(_=>_.id===0);m&&(h=(1&new DataView(m.data).getUint32(0,!0))==1)}l=h?this.decompress(l):l}else l=t.slice(8);return l}serializeExtension(t){let{profile:r,length:n,datas:i}=t,o=new ArrayBuffer(n+2),l=new Uint8Array(o),u=new DataView(o),h=0;if(u.setUint8(h++,r),u.setUint8(h++,n),i.forEach(m=>{r?(u.setUint8(h++,m.id),u.setUint8(h++,m.length),l.set(new Uint8Array(m.data),h),h+=m.data.byteLength):(u.setUint8(h++,m.id|m.length<<4),l.set(new Uint8Array(m.data),h),h+=m.data.byteLength)}),h!==n+2)throw Error("serialize extension error, is ".concat(h,"!==").concat(n+2));return o}deserializeExtension(t){let r=new DataView(t),n=0,i=r.getUint8(n);n++;let o=r.getUint8(n);n++;let l=i===fx.TWO_BYTE,u=[],h=new DataView(t,2),m=0;for(;m<o;){let _=0,R=0,A=new ArrayBuffer(0);l?(_=h.getUint8(m),m++,R=h.getUint8(m),m++):(_=15&h.getUint8(m),R=h.getUint8(m)>>4,m++),R>0&&(A=h.buffer.slice(m+2,m+2+R),m+=A.byteLength),u.push({id:_,length:R,data:A})}if(m!==o)throw Error("parse error");return{profile:i,length:o,datas:u}}decompress(t){return l8(new Uint8Array(t))}compress(t){return c8(new Uint8Array(t))}}let d8={name:"DataStream",create:(e,t)=>{let r=t?new gF(e):new vF(e);return r.useDataStream(new u8),r}};class h8 extends zn{constructor(t,r,n){super(),ie(this,"ws",void 0),ie(this,"requestId",1),ie(this,"heartBeatTimer",void 0),ie(this,"joinInfo",void 0),ie(this,"clientId",void 0),ie(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),ie(this,"onClose",i=>{this.emit("close"),this.dispose()}),ie(this,"onMessage",i=>{let o=JSON.parse(i.data);if(!o||o.command!=="serverResponse"||!o.requestId)return o&&o.command==="serverStatus"&&o.serverStatus&&o.serverStatus.command?(this.emit("status",o.serverStatus),void this.emit(o.serverStatus.command,o.serverStatus)):void 0;this.emit("req_".concat(o.requestId),o)}),this.joinInfo=t,this.clientId=r,this.ws=new rv("cross-channel-".concat(this.clientId),n),this.ws.on(Ur.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ur.CONNECTED,this.onOpen),this.ws.on(Ur.ON_MESSAGE,this.onMessage),this.ws.on(Ur.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){let r=this.requestId++;return t.requestId=r,t.seq=r,this.ws.sendMessage(t),r}waitStatus(t){return new tr((r,n)=>{let i=window.setTimeout(()=>{n(new at(ce.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,o=>{window.clearTimeout(i),o.state&&o.state!==0?n(new at(ce.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):r(void 0)}),this.once("dispose",()=>{window.clearTimeout(i),n(new at(ce.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new at(ce.WS_DISCONNECT);let r=()=>new tr((l,u)=>{this.ws.once(Ur.CLOSED,()=>u(new at(ce.WS_ABORT))),this.ws.once(Ur.CONNECTED,l)});this.ws.state!=="connected"&&await r();let n=this.sendMessage(t),i=new tr((l,u)=>{let h=()=>{u(new at(ce.WS_ABORT))};this.ws.once(Ur.RECONNECTING,h),this.ws.once(Ur.CLOSED,h),this.once("req_".concat(n),l),Yi(3e3).then(()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(Ur.RECONNECTING,h),this.ws.off(Ur.CLOSED,h),u(new at(ce.TIMEOUT,"cross channel ws request timeout"))})}),o=await i;if(!o||o.code!==200)throw new at(ce.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(o)));return o}async connect(t){this.ws.removeAllListeners(Ur.REQUEST_NEW_URLS),this.ws.on(Ur.REQUEST_NEW_URLS,r=>{r(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){let r=this.requestId++;return t.requestId=r,this.ws.sendMessage(t),r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class p8 extends zn{set state(t){t!==this._state&&(t!==oo.RELAY_STATE_FAILURE&&(this.errorCode=fE.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,r,n,i,o){super(),ie(this,"joinInfo",void 0),ie(this,"sid",void 0),ie(this,"clientId",void 0),ie(this,"cancelToken",Ha.CancelToken.source()),ie(this,"workerToken",void 0),ie(this,"requestId",0),ie(this,"signal",void 0),ie(this,"prevChannelMediaConfig",void 0),ie(this,"httpRetryConfig",void 0),ie(this,"_resolution",void 0),ie(this,"_state",oo.RELAY_STATE_IDLE),ie(this,"errorCode",fE.RELAY_OK),ie(this,"onStatus",l=>{L.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(l))),l&&l.command&&(l.command==="onAudioPacketReceived"&&this.emit("event",Uu.PACKET_RECEIVED_AUDIO_FROM_SRC),l.command==="onVideoPacketReceived"&&this.emit("event",Uu.PACKET_RECEIVED_VIDEO_FROM_SRC),l.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=fE.SRC_TOKEN_EXPIRED,this.state=oo.RELAY_STATE_FAILURE),l.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=fE.DEST_TOKEN_EXPIRED,this.state=oo.RELAY_STATE_FAILURE))}),ie(this,"onReconnect",async()=>{L.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Uu.NETWORK_DISCONNECTED),this.state=oo.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(l=>{this.state!==oo.RELAY_STATE_IDLE&&(L.error("auto restart channel media relay failed",l.toString()),this.errorCode=fE.SERVER_CONNECTION_LOST,this.state=oo.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=r,this.sid=Ap(),this.signal=new h8(this.joinInfo,this.clientId,n),this.httpRetryConfig=i,this._resolution=o}async startChannelMediaRelay(t){if(this.state!==oo.RELAY_STATE_IDLE)throw new at(ce.INVALID_OPERATION);this.state=oo.RELAY_STATE_CONNECTING,await this.connect(),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(r){throw r.data&&r.data.serverResponse&&r.data.serverResponse.command==="SetSourceChannel"?new at(ce.CROSS_CHANNEL_FAILED_JOIN_SRC):r.data&&r.data.serverResponse&&r.serverResponse.command==="SetDestChannelStatus"?new at(ce.CROSS_CHANNEL_FAILED_JOIN_DEST):r.data&&r.data.serverResponse&&r.serverResponse.command==="StartPacketTransfer"?new at(ce.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):r}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==oo.RELAY_STATE_RUNNING)throw new at(ce.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==oo.RELAY_STATE_RUNNING)throw new at(ce.INVALID_OPERATION);let r=this.genMessage(Ua.SetVideoProfile);await this.signal.request(r),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),L.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=oo.RELAY_STATE_IDLE,this.dispose()}dispose(){L.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Ha.CancelToken.source(),this.state=oo.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){let t=await RG(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",Uu.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){let r=this.genMessage(Ua.StopPacketTransfer);await this.signal.request(r),await this.signal.waitStatus("Normal Quit"),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));let n=this.genMessage(Ua.SetSdkProfile,t);await this.signal.request(n),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));let i=this.genMessage(Ua.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Uu.PACKET_JOINED_SRC_CHANNEL),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));let o=this.genMessage(Ua.SetSourceUserId,t);await this.signal.request(o),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));let l=this.genMessage(Ua.SetDestChannel,t);await this.signal.request(l),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Uu.PACKET_JOINED_DEST_CHANNEL),L.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));let u=this.genMessage(Ua.StartPacketTransfer,t);await this.signal.request(u),this.emit("event",Uu.PACKET_SENT_TO_DEST_CHANNEL),this.state=oo.RELAY_STATE_RUNNING,L.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){let r=this.genMessage(Ua.UpdateDestChannel,t);await this.signal.request(r),this.emit("event",Uu.PACKET_UPDATE_DEST_CHANNEL),L.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){let t=this.genMessage(Ua.StopPacketTransfer);await this.signal.request(t),L.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,r){let n=[],i=[],o=[];this.requestId+=1;let l={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:hs,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};l.sdkVersion==="4.23.2"&&(l.sdkVersion="0.0.1");let u=null,h=null;switch(t){case Ua.SetSdkProfile:return l.clientRequest={command:"SetSdkProfile",type:"multi_channel"},l;case Ua.SetSourceChannel:if(h=r&&r.getSrcChannelMediaInfo(),!h)throw new at(ce.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},l;case Ua.SetSourceUserId:if(h=r&&r.getSrcChannelMediaInfo(),!h)throw new at(ce.UNEXPECTED_ERROR,"can not find source config");return l.clientRequest={command:"SetSourceUserId",uid:h.uid+""},l;case Ua.SetDestChannel:if(u=r&&r.getDestChannelMediaInfo(),!u)throw new at(ce.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(m=>{n.push(m.channelName),i.push(m.uid+""),o.push(m.token||this.joinInfo.appId)}),l.clientRequest={command:"SetDestChannel",channelName:n,uid:i,token:o},l;case Ua.StartPacketTransfer:return l.clientRequest={command:"StartPacketTransfer"},l;case Ua.Reconnect:return l.clientRequest={command:"Reconnect"},l;case Ua.StopPacketTransfer:return l.clientRequest={command:"StopPacketTransfer"},l;case Ua.UpdateDestChannel:if(u=r&&r.getDestChannelMediaInfo(),!u)throw new at(ce.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(m=>{n.push(m.channelName),i.push(m.uid+""),o.push(m.token||this.joinInfo.appId)}),l.clientRequest={command:"UpdateDestChannel",channelName:n,uid:i,token:o},l;case Ua.SetVideoProfile:l.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return l}}let f8={name:"ChannelMediaRelay",create:function(e){return new p8(e.joinInfo,e.clientId,e.websocketRetryConfig||vi,e.httpRetryConfig||vi,e.resolution)}};function mx(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Dv(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mx(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class m8 extends zn{constructor(t,r,n,i){super(),ie(this,"spec",void 0),ie(this,"token",void 0),ie(this,"websocket",void 0),ie(this,"pingpongTimer",void 0),ie(this,"reconnectMode","retry"),ie(this,"serviceMode",void 0),ie(this,"reqId",0),ie(this,"commandReqId",0),ie(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),ie(this,"handleWebSocketMessage",o=>{if(!o.data)return;let l=JSON.parse(o.data);l.requestId?this.emit("@".concat(l.requestId,"-").concat(l.sid),l):(gr.workerEvent(this.spec.sid,{actionType:"status",serverCode:l.code,workerType:this.serviceMode===Mu.TRANSCODE?1:2}),this.emit(qd.PUBLISH_STREAM_STATUS,l))}),this.spec=r,this.token=t,this.serviceMode=i,this.websocket=new rv("live-streaming",n),this.websocket.on(Ur.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ur.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ur.REQUEST_NEW_URLS,(o,l)=>{ia(this,qd.REQUEST_NEW_ADDRESS).then(o).catch(l)}),this.websocket.on(Ur.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,r,n,i){this.reqId+=1,t==="request"&&(this.commandReqId+=1);let o=this.commandReqId,l=this.reqId;if(!l||!this.websocket)throw new at(ce.UNEXPECTED_ERROR);let u=Dv({command:t,sdkVersion:hs==="4.23.2"?"0.0.1":hs,seq:l,requestId:l,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},r);if(this.websocket.state==="closed")throw new at(ce.WS_DISCONNECT);let h=()=>new tr((A,D)=>{this.websocket.once(Ur.CLOSED,()=>D(new at(ce.WS_ABORT))),this.websocket.once(Ur.CONNECTED,A)});this.websocket.state!=="connected"&&await h(),u.clientRequest&&(u.clientRequest.workerToken=this.token);let m=new tr((A,D)=>{let J=()=>{D(new at(ce.WS_ABORT))};this.websocket.once(Ur.RECONNECTING,J),this.websocket.once(Ur.CLOSED,J),this.once("@".concat(l,"-").concat(this.spec.sid),V=>{A(V)})});i&&gr.workerEvent(this.spec.sid,Dv(Dv({},i),{},{requestId:o,actionType:"request",payload:JSON.stringify(r.clientRequest),serverCode:0,code:0}));let _=Date.now();this.websocket.sendMessage(u);let R=null;try{R=await m}catch(A){if(this.websocket.state==="closed")throw A;return await h(),await this.request(t,r,n)}return i&&gr.workerEvent(this.spec.sid,Dv(Dv({},i),{},{requestId:o,actionType:"response",payload:JSON.stringify(R.serverResponse),serverCode:R.code,success:R.code===200,responseTime:Date.now()-_})),R.code!==200&&this.handleResponseError(R),R}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){let t=hs==="4.23.2"?"0.0.1":hs;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Ii.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void L.warning("live stream response already exists stream");case Ii.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ii.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ii.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new at(ce.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Ii.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream")return;throw new at(ce.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ii.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new at(ce.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Ii.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let r=new at(ce.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(qd.WARNING,r,t.serverResponse.url)}case Ii.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{let r=new at(ce.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(qd.WARNING,r,t.serverResponse.url)}case Ii.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new at(ce.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ii.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new at(ce.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Ii.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{let r=new at(ce.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(qd.WARNING,r,t.serverResponse.url)}case Ii.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new at(ce.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Ii.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new at(ce.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ii.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ii.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream")return;throw new at(ce.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ii.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new at(ce.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new at(ce.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ii.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new at(ce.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(YS)},6e3)}}function Ex(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function so(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Ex(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ex(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class E8 extends zn{constructor(t){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:vi,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:vi;super(),ie(this,"onLiveStreamWarning",void 0),ie(this,"onLiveStreamError",void 0),ie(this,"spec",void 0),ie(this,"retryTimeout",1e4),ie(this,"connection",void 0),ie(this,"httpRetryConfig",void 0),ie(this,"wsRetryConfig",void 0),ie(this,"streamingTasks",new Map),ie(this,"isStartingStreamingTask",!1),ie(this,"taskMutex",new da("live-streaming")),ie(this,"cancelToken",Ha.CancelToken.source()),ie(this,"transcodingConfig",void 0),ie(this,"uapResponse",void 0),ie(this,"lastTaskId",1),ie(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=n,this.wsRetryConfig=r}async setTranscodingConfig(t){let r=so(so({},rG),t);r.videoCodecProfile!==66&&r.videoCodecProfile!==77&&r.videoCodecProfile!==100&&(L.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(r.videoCodecProfile," -> 100")),r.videoCodecProfile=100),r.transcodingUsers||(r.transcodingUsers=r.userConfigs),r.transcodingUsers&&(r.transcodingUsers=r.transcodingUsers.map(l=>so(so(so({},tG),l),{},{zOrder:l.zOrder?l.zOrder+1:1}))),function(l){Xn(l.width)||vn(l.width,"config.width",0,1e4),Xn(l.height)||vn(l.height,"config.height",0,1e4),Xn(l.videoBitrate)||vn(l.videoBitrate,"config.videoBitrate",1,1e6),Xn(l.videoFrameRate)||vn(l.videoFrameRate,"config.videoFrameRate"),Xn(l.lowLatency)||Du(l.lowLatency,"config.lowLatency"),Xn(l.audioSampleRate)||bi(l.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Xn(l.audioBitrate)||vn(l.audioBitrate,"config.audioBitrate",1,128),Xn(l.audioChannels)||bi(l.audioChannels,"config.audioChannels",[1,2,3,4,5]),Xn(l.videoGop)||vn(l.videoGop,"config.videoGop"),Xn(l.videoCodecProfile)||bi(l.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Xn(l.userCount)||vn(l.userCount,"config.userCount",0,17),Xn(l.backgroundColor)||vn(l.backgroundColor,"config.backgroundColor",0,16777215),Xn(l.userConfigExtraInfo)||qi(l.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),l.transcodingUsers&&!Xn(l.transcodingUsers)&&(Pu(l.transcodingUsers,"config.transcodingUsers"),l.transcodingUsers.forEach((u,h)=>{gR(u.uid),Xn(u.x)||vn(u.x,"transcodingUser[".concat(h,"].x"),0,1e4),Xn(u.y)||vn(u.y,"transcodingUser[".concat(h,"].y"),0,1e4),Xn(u.width)||vn(u.width,"transcodingUser[".concat(h,"].width"),0,1e4),Xn(u.height)||vn(u.height,"transcodingUser[".concat(h,"].height"),0,1e4),Xn(u.zOrder)||vn(u.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),Xn(u.alpha)||vn(u.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),Xn(l.watermark)||XA(l.watermark,"watermark"),Xn(l.backgroundImage)||XA(l.backgroundImage,"backgroundImage"),l.images&&!Xn(l.images)&&(Pu(l.images,"config.images"),l.images.forEach((u,h)=>{XA(u,"images[".concat(h,"]"))}))}(r);let n=[];r.images&&n.push(...r.images.map(l=>so(so(so({},YA),l),{},{zOrder:255}))),r.backgroundImage&&(n.push(so(so(so({},YA),r.backgroundImage),{},{zOrder:0})),delete r.backgroundImage),r.watermark&&(n.push(so(so(so({},YA),r.watermark),{},{zOrder:255})),delete r.watermark),r.images=n,r.transcodingUsers&&(r.userConfigs=r.transcodingUsers.map(l=>so({},l)),r.userCount=r.transcodingUsers.length,delete r.transcodingUsers);let i=(r.userConfigs||[]).map(l=>typeof l.uid=="number"?tr.resolve(l.uid):jM(l.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await tr.all(i)).forEach((l,u)=>{r.userConfigs&&r.userConfigs[u]&&(r.userConfigs[u].uid=l)}),this.transcodingConfig=r,this.connection)try{var o;let l=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(ro(o=this.streamingTasks).call(o)).map(u=>u.taskId).join("#")});L.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(l.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(l){if(!l.data||!l.data.retry)throw l;l.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{L.warning("[".concat(this.spec.clientId,"] live streaming receive error"),l.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,l).then(()=>{L.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(h=>{L.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)})})}}async startLiveStreamingTask(t,r,n){if(!this.transcodingConfig&&r===Mu.TRANSCODE)throw new at(ce.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let i={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};L.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(r));let o=await this.taskMutex.lock();if(!this.connection&&n)return void o();if(this.streamingTasks.get(t)&&!n)return o(),new at(ce.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(r))}catch(u){throw o(),u}switch(r){case Mu.TRANSCODE:i.transcodingConfig=so({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;let l=this.lastTaskId++;try{let u=new tr((m,_)=>{Yi(this.retryTimeout).then(()=>{if(n)return _(n);let R=this.statusError.get(t);return R?(this.statusError.delete(t),_(R)):void 0})}),h=await tr.race([this.connection.request("request",{clientRequest:i},!0,{url:t,command:"PublishStream",workerType:r===Mu.TRANSCODE?1:2,requestByUser:!n,tid:l.toString()}),u]);this.isStartingStreamingTask=!1,L.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(h.code)),this.streamingTasks.set(t,{clientRequest:i,mode:r,url:t,taskId:l}),o()}catch(u){if(o(),this.isStartingStreamingTask=!1,!u.data||!u.data.retry||n)throw u;return u.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,r,u)):await this.startLiveStreamingTask(t,r,u)}}stopLiveStreamingTask(t){return new tr((r,n)=>{let i=this.streamingTasks.get(t);if(!i||!this.connection)return new at(ce.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();let o=i.mode;i.abortTask=()=>{L.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),r()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:o===Mu.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(l=>{L.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(l.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),r()}).catch(n)})}resetAllTask(){var t;let r=Array.from(ro(t=this.streamingTasks).call(t));this.terminate();for(let n of r)this.startLiveStreamingTask(n.url,n.mode).catch(i=>{this.onLiveStreamError&&this.onLiveStreamError(n.url,i)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Ha.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new at(ce.UNEXPECTED_ERROR,"live streaming connection has already connected");let r=await ia(this,JA.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=r,this.connection=new m8(r.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(qd.WARNING,(n,i)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(i,n)),this.connection.on(qd.PUBLISH_STREAM_STATUS,n=>this.handlePublishStreamServer(n)),this.connection.on(qd.REQUEST_NEW_ADDRESS,(n,i)=>{if(!this.connection)return i(new at(ce.UNEXPECTED_ERROR,"can not get new live streaming address list"));ia(this,JA.REQUEST_WORKER_MANAGER_LIST,t).then(o=>{this.uapResponse=o,n(o.addressList)}).catch(i)}),await this.connection.init(r.addressList),this.connection}handlePublishStreamServer(t){let r=t.serverStatus&&t.serverStatus.url||"empty_url",n=this.streamingTasks.get(r),i=t.reason;switch(t.code){case Ii.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ii.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{let l=new at(ce.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(n)return L.error(l.toString()),this.onLiveStreamError&&this.onLiveStreamError(r,l);if(!this.isStartingStreamingTask)return;this.statusError.set(r,l)}case Ii.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{let l=new at(ce.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(r,l)}case Ii.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ii.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var o;if(!this.connection)return;this.connection.tryNextAddress();let l=Array.from(ro(o=this.streamingTasks).call(o));for(let u of l)u.abortTask?u.abortTask():(L.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new at(ce.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{L.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(h=>{L.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)}));return}}}hasUrl(t){return this.streamingTasks.has(t)}}let _8={name:"LiveStreaming",create:function(e){return new E8(e.joinInfo,e.websocketRetryConfig||vi,e.httpRetryConfig||vi)}};function g8(e){let t=vx();return function(r,n){let i=r.appId;i!==void 0&&(hn(n,10),Kl(n,i));let o=r.cid;o!==void 0&&(hn(n,16),hn(n,o));let l=r.cname;l!==void 0&&(hn(n,26),Kl(n,l));let u=r.deviceId;u!==void 0&&(hn(n,34),Kl(n,u));let h=r.elapse;h!==void 0&&(hn(n,40),sh(n,h));let m=r.fileSize;m!==void 0&&(hn(n,48),sh(n,DE(m)));let _=r.height;_!==void 0&&(hn(n,56),sh(n,DE(_)));let R=r.jpg;R!==void 0&&(hn(n,66),hn(n,R.length),function(Xa,Rt){let Yt=PE(Xa,Rt.length);Xa.bytes.set(Rt,Yt)}(n,R));let A=r.networkType;A!==void 0&&(hn(n,72),sh(n,DE(A)));let D=r.osType;D!==void 0&&(hn(n,80),sh(n,DE(D)));let J=r.requestId;J!==void 0&&(hn(n,90),Kl(n,J));let V=r.sdkVersion;V!==void 0&&(hn(n,98),Kl(n,V));let K=r.sequence;K!==void 0&&(hn(n,104),sh(n,DE(K)));let se=r.sid;se!==void 0&&(hn(n,114),Kl(n,se));let ue=r.timestamp;ue!==void 0&&(hn(n,120),sh(n,ue));let De=r.uid;De!==void 0&&(hn(n,128),hn(n,De));let ze=r.vid;ze!==void 0&&(hn(n,136),hn(n,ze));let Ke=r.width;Ke!==void 0&&(hn(n,144),sh(n,DE(Ke)));let Ve=r.service;Ve!==void 0&&(hn(n,152),hn(n,Ve));let _t=r.callbackData;_t!==void 0&&(hn(n,162),Kl(n,_t));let Vt=r.jpgEncryption;Vt!==void 0&&(hn(n,168),hn(n,Vt));let ar=r.requestType;ar!==void 0&&(hn(n,176),hn(n,ar));let ur=r.scorePorn;ur!==void 0&&(hn(n,185),Qb(n,ur));let Kr=r.scoreSexy;Kr!==void 0&&(hn(n,193),Qb(n,Kr));let zr=r.scoreNeutral;zr!==void 0&&(hn(n,201),Qb(n,zr));let wn=r.scene;wn!==void 0&&(hn(n,208),hn(n,wn));let si=r.ossFilePrefix;si!==void 0&&(hn(n,218),Kl(n,si));let ti=r.serviceVendor;if(ti!==void 0)for(let Xa of ti){hn(n,226);let Rt=vx();y8(Xa,Rt),hn(n,Rt.limit),I8(n,Rt),C8(Rt)}}(e,t),function(r){let n=r.bytes,i=r.limit;return n.length===i?n:n.subarray(0,i)}(t)}function v8(e){return function(r){let n={};e:for(;!Tx(r);){let i=zl(r);switch(i>>>3){case 0:break e;case 1:n.code=zl(r);break;case 2:n.msg=yx(r,zl(r));break;case 3:{let o=S8(r);n.data=T8(r),r.limit=o;break}default:_x(r,7&i)}}return n}({bytes:t=e,offset:0,limit:t.length});var t}function T8(e){let t={};e:for(;!Tx(e);){let r=zl(e);switch(r>>>3){case 0:break e;case 1:t.requestId=yx(e,zl(e));break;case 2:t.requestType=zl(e)>>>0;break;case 3:t.scorePorn=Zb(e);break;case 4:t.scoreSexy=Zb(e);break;case 5:t.scoreNeutral=Zb(e);break;case 6:t.requestScene=zl(e)>>>0;break;case 7:t.scene=zl(e)>>>0;break;default:_x(e,7&r)}}return t}function y8(e,t){let r=e.service;r!==void 0&&(hn(t,8),hn(t,r));let n=e.vendor;n!==void 0&&(hn(t,16),hn(t,n));let i=e.token;i!==void 0&&(hn(t,26),Kl(t,i));let o=e.callbackUrl;o!==void 0&&(hn(t,34),Kl(t,o))}function S8(e){let t=zl(e),r=e.limit;return e.limit=e.offset+t,r}function _x(e,t){switch(t){case 0:for(;128&Sx(e););break;case 2:Xb(e,zl(e));break;case 5:Xb(e,4);break;case 1:Xb(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let R8=new Float32Array(1);new Uint8Array(R8.buffer);let Yb=new Float64Array(1),co=new Uint8Array(Yb.buffer);function DE(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let gx=[];function vx(){let e=gx.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function C8(e){gx.push(e)}function Xb(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Tx(e){return e.offset>=e.limit}function PE(e,t){let r=e.bytes,n=e.offset,i=e.limit,o=n+t;if(o>r.length){let l=new Uint8Array(2*o);l.set(r),e.bytes=l}return e.offset=o,o>i&&(e.limit=o),n}function Jb(e,t){let r=e.offset;if(r+t>e.limit)throw new Error("Read past limit");return e.offset+=t,r}function yx(e,t){let r=Jb(e,t),n=String.fromCharCode,i=e.bytes,o="�",l="";for(let u=0;u<t;u++){let h,m,_,R,A=i[u+r];128&A?(224&A)==192?u+1>=t?l+=o:(h=i[u+r+1],(192&h)!=128?l+=o:(R=(31&A)<<6|63&h,R<128?l+=o:(l+=n(R),u++))):(240&A)==224?u+2>=t?l+=o:(h=i[u+r+1],m=i[u+r+2],(49344&(h|m<<8))!=32896?l+=o:(R=(15&A)<<12|(63&h)<<6|63&m,R<2048||R>=55296&&R<=57343?l+=o:(l+=n(R),u+=2))):(248&A)==240?u+3>=t?l+=o:(h=i[u+r+1],m=i[u+r+2],_=i[u+r+3],(12632256&(h|m<<8|_<<16))!=8421504?l+=o:(R=(7&A)<<18|(63&h)<<12|(63&m)<<6|63&_,R<65536||R>1114111?l+=o:(R-=65536,l+=n(55296+(R>>10),56320+(1023&R)),u+=3))):l+=o:l+=n(A)}return l}function Kl(e,t){let r=t.length,n=0;for(let l=0;l<r;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<r&&(u=(u<<10)+t.charCodeAt(++l)-56613888),n+=u<128?1:u<2048?2:u<65536?3:4}hn(e,n);let i=PE(e,n),o=e.bytes;for(let l=0;l<r;l++){let u=t.charCodeAt(l);u>=55296&&u<=56319&&l+1<r&&(u=(u<<10)+t.charCodeAt(++l)-56613888),u<128?o[i++]=u:(u<2048?o[i++]=u>>6&31|192:(u<65536?o[i++]=u>>12&15|224:(o[i++]=u>>18&7|240,o[i++]=u>>12&63|128),o[i++]=u>>6&63|128),o[i++]=63&u|128)}}function I8(e,t){let r=PE(e,t.limit),n=e.bytes,i=t.bytes;for(let o=0,l=t.limit;o<l;o++)n[o+r]=i[o]}function Sx(e){return e.bytes[Jb(e,1)]}function Rx(e,t){let r=PE(e,1);e.bytes[r]=t}function Zb(e){let t=Jb(e,8),r=e.bytes;return co[0]=r[t++],co[1]=r[t++],co[2]=r[t++],co[3]=r[t++],co[4]=r[t++],co[5]=r[t++],co[6]=r[t++],co[7]=r[t++],Yb[0]}function Qb(e,t){let r=PE(e,8),n=e.bytes;Yb[0]=t,n[r++]=co[0],n[r++]=co[1],n[r++]=co[2],n[r++]=co[3],n[r++]=co[4],n[r++]=co[5],n[r++]=co[6],n[r++]=co[7]}function zl(e){let t,r=0,n=0;do t=Sx(e),r<32&&(n|=(127&t)<<r),r+=7;while(128&t);return n}function hn(e,t){for(t>>>=0;t>=128;)Rx(e,127&t|128),t>>>=7;Rx(e,t)}function sh(e,t){let r=t.low>>>0,n=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=i===0?n===0?r<16384?r<128?1:2:r<1<<21?3:4:n<16384?n<128?5:6:n<1<<21?7:8:i<128?9:10,l=PE(e,o),u=e.bytes;switch(o){case 10:u[l+9]=i>>>7&1;case 9:u[l+8]=o!==9?128|i:127&i;case 8:u[l+7]=o!==8?n>>>21|128:n>>>21&127;case 7:u[l+6]=o!==7?n>>>14|128:n>>>14&127;case 6:u[l+5]=o!==6?n>>>7|128:n>>>7&127;case 5:u[l+4]=o!==5?128|n:127&n;case 4:u[l+3]=o!==4?r>>>21|128:r>>>21&127;case 3:u[l+2]=o!==3?r>>>14|128:r>>>14&127;case 2:u[l+1]=o!==2?r>>>7|128:r>>>7&127;case 1:u[l]=o!==1?128|r:127&r}}function Cx(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}let A8=new Map([["moderation",1],["supervise",2]]);class b8 extends zn{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;let r=this._connectionState;this._connectionState=t,this.emit(Gi.CONNECTION_STATE_CHANGE,r,t)}get inspectType(){return this._inspectType}set inspectType(t){var r;this._inspectMode=wa(r=t.map(n=>A8.get(n)||0)).call(r,(n,i)=>n+i),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),ie(this,"name","AgoraRTCVideoContentInspect"),ie(this,"_connectionState",Js.CONNECTING),ie(this,"_innerConnectionState",void 0),ie(this,"sequence",0),ie(this,"inspectStartTime",void 0),ie(this,"workerManagerConnection",void 0),ie(this,"workerConnection",void 0),ie(this,"workerMessageLengthLimit",void 0),ie(this,"inspectIntervalMinimum",void 0),ie(this,"qualityRatio",void 0),ie(this,"_connectInfo",void 0),ie(this,"_cancelTokenSource",Ha.CancelToken.source()),ie(this,"_retryConfig",void 0),ie(this,"wmSequence",0),ie(this,"inspectInterval",void 0),ie(this,"inspectTimer",null),ie(this,"ossFilePrefix",void 0),ie(this,"extraInfo",void 0),ie(this,"_inspectType",void 0),ie(this,"_inspectMode",void 0),ie(this,"_quality",1),ie(this,"qualityTimer",null),ie(this,"_inspectId",void 0),ie(this,"_needWorkUrlOnly",!1),ie(this,"inspectImage",()=>{if(this.connectionState!==Js.CONNECTED)throw new at(ce.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Js.CONNECTED?this.requestToInspectImage():L.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=On(5,"inspect-"),this.workerMessageLengthLimit=Se("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Se("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Se("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new rv("worker-manager-"+this._inspectId,vi),this.on(Gi.STATE_CHANGE,(r,n)=>{this._innerConnectionState=r,L.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Zs[r]," ").concat(n||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new rv("worker-"+this._inspectId,vi),this.handleWorkerEvents()}async init(t,r){this.emit(Gi.STATE_CHANGE,Zs.CONNECT_AP),this._connectInfo=t;let n=this._cancelTokenSource.token;return this._retryConfig=r,new tr((i,o)=>{this.on(Gi.CONNECTION_STATE_CHANGE,(l,u)=>{u===Js.CONNECTED&&i()}),this.requestAP(t,n,r).then(l=>{this.connectWorkerManager(l)}).catch(l=>{o(l)})})}async requestAP(t,r,n){let i=Se("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),o=await function(u,h,m,_){let{appId:R,areaCode:A,cname:D,sid:J,token:V,uid:K}=h;yE++;let se="image_moderation_api",ue={service_name:se,json_body:JSON.stringify({appId:R,areaCode:A,cname:D,command:"allocateEdge",requestId:yE,seq:yE,sid:J,token:V,ts:Date.now(),uid:K+""})},De,ze,Ke=u[0];return xc(async()=>{De=Date.now();let Ve=await Gc(Ke,{data:ue,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(ze=Date.now()-De,Ve.code!==0){let ur=new at(ce.UNEXPECTED_RESPONSE,"image inspect ap error, code"+Ve.code,{retry:!0,responseTime:ze});throw L.error(ur.toString()),ur}let _t=JSON.parse(Ve.json_body);if(_t.code!==200){let ur=new at(ce.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(_t.code,", reason: ").concat(_t.reason),{code:_t.code,responseTime:ze});throw L.error(ur.toString()),ur}if(!_t.servers||!Array.isArray(_t.servers)||_t.servers.length===0){let ur=new at(ce.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:_t.code,responseTime:ze});throw L.error(ur.toString()),ur}let Vt=Se("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ar=Se("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:_t.servers.map(ur=>{let{address:Kr,wss:zr}=ur;if(Kr&&zr)return"wss://".concat(Kr.replace(/\./g,"-"),".").concat(Vt,":").concat(ar||zr)}).filter(ur=>!!ur),workerToken:_t.workerToken,vid:_t.vid,responseTime:ze}},(Ve,_t)=>(gr.apworkerEvent(J,{success:!0,sc:200,serviceName:se,responseDetail:JSON.stringify(Ve.addressList),firstSuccess:_t===0,responseTime:ze,serverIp:u[_t%u.length]}),!1),(Ve,_t)=>(gr.apworkerEvent(J,{success:!1,sc:Ve.data&&Ve.data.code||200,serviceName:se,responseTime:ze,serverIp:u[_t%u.length]}),!!(Ve.code!==ce.OPERATION_ABORTED&&Ve.code!==ce.UNEXPECTED_RESPONSE||Ve.data&&Ve.data.retry)&&(Ke=u[(_t+1)%u.length],!0)),_)}(i,t,r,n);this.emit(Gi.STATE_CHANGE,Zs.AP_CONNECTED);let{addressList:l}=o;return this.wmSequence++,l}async connectWorkerManager(t){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=r,this.emit(Gi.STATE_CHANGE,Zs.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ur.CONNECTED,async()=>{this.emit(Gi.STATE_CHANGE,Zs.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.23.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ur.CLOSED,()=>{this._innerConnectionState<Zs.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ur.FAILED,()=>{this._innerConnectionState<Zs.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ur.RECONNECTING,()=>{this._innerConnectionState<Zs.GET_WORKER_MANAGER_RESPONSE&&L.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ur.ON_MESSAGE,async t=>{this.emit(Gi.STATE_CHANGE,Zs.GET_WORKER_MANAGER_RESPONSE);let r=this.workerManagerConnection.url;this.workerManagerConnection.close();let n=JSON.parse(t.data);if(n.code!==200)throw L.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new at(ce.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&r))throw L.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new at(ce.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{let i=Se("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,o=r.replace(/:\d+\/?$/,":".concat(i));this.emit(Gi.STATE_CHANGE,Zs.CONNECT_WORKER,o),this._needWorkUrlOnly?this.emit(Gi.REQUEST_NEW_WORKER_URL,o):await this.connectWorker(o)}}),this.workerManagerConnection.on(Ur.WILL_RECONNECT,(t,r,n)=>{n(t)}),this.workerManagerConnection.on(Ur.REQUEST_NEW_URLS,(t,r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(r)})}handleWorkerEvents(){this.workerConnection.on(Ur.CONNECTED,async()=>{this.emit(Gi.STATE_CHANGE,Zs.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Js.CONNECTED}),this.workerConnection.on(Ur.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){let n=v8(new Uint8Array(t.data));if(Se("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&L.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),n.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Gi.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var r;let i={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},o=wa(r=Object.keys(i)).call(r,(u,h)=>i[u]>i[h]?u:h,"porn"),l=Object.keys(i).find(u=>u===o);this.emit(Gi.INSPECT_RESULT,l)}else this.emit(Gi.INSPECT_RESULT,void 0,new at(ce.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(Gi.INSPECT_RESULT,void 0,new at(ce.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else L.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Gi.INSPECT_RESULT,void 0,new at(ce.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ur.CLOSED,()=>{this.connectionState=Js.CLOSED}),this.workerConnection.on(Ur.FAILED,()=>{this.connectionState=Js.CLOSED}),this.workerConnection.on(Ur.RECONNECTING,()=>{this.connectionState=this.connectionState===Js.CONNECTED?Js.RECONNECTING:Js.CONNECTING}),this.workerConnection.on(Ur.WILL_RECONNECT,(t,r,n)=>{t==="recover"&&n(t),n("tryNext")}),this.workerConnection.on(Ur.REQUEST_NEW_URLS,(t,r)=>{this.workerManagerConnection.close(),this.once(Gi.REQUEST_NEW_WORKER_URL,n=>{t([n])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(n=>{this.connectWorkerManager(n,!0)}).catch(n=>{r(n)})})}async requestToInspectImage(){this.sequence++;let t=Lo(this,Gi.CLIENT_LOCAL_VIDEO_TRACK),r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Gi.INSPECT_RESULT,void 0,new at(ce.INVALID_OPERATION,"Only the track being played can be inspected"));let n=await this.generateRequestData(t,r);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(Gi.INSPECT_RESULT,void 0,new at(ce.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,r){let{appId:n,cname:i,cid:o,vid:l,sid:u,uid:h}=r,m=Date.now(),_=await t.getCurrentFrameImage("image/jpeg",this.quality),R=await aL(_,n,i),A=this.sequence+"-"+o+"-"+h+"-"+m+"-"+On(12,""),D={appId:n,cid:o,cname:i,deviceId:"",elapse:(J=Number(m-this.inspectStartTime),{low:J|=0,high:J>>31,unsigned:J>=0}),fileSize:R.byteLength,jpgEncryption:2,height:_.height,width:_.width,jpg:R,networkType:6,osType:7,requestId:A,sdkVersion:"4.23.2",sequence:this.sequence,sid:u,timestamp:P2(m),uid:h,vid:l,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var J;this.extraInfo===void 0&&delete D.callbackData,this.ossFilePrefix===void 0&&delete D.ossFilePrefix;let V=g8(D);if(V.byteLength<this.workerMessageLengthLimit){if(Se("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){let K=function(se){for(var ue=1;ue<arguments.length;ue++){var De=arguments[ue]!=null?arguments[ue]:{};ue%2?Cx(Object(De),!0).forEach(function(ze){ie(se,ze,De[ze])}):Object.getOwnPropertyDescriptors?Object.defineProperties(se,Object.getOwnPropertyDescriptors(De)):Cx(Object(De)).forEach(function(ze){Object.defineProperty(se,ze,Object.getOwnPropertyDescriptor(De,ze))})}return se}({},D);delete K.jpg,L.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(K))}return V}{let K=this.quality*this.qualityRatio;return this.quality=K,await this.generateRequestData(t,{appId:n,cname:i,cid:o,vid:l,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Ha.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Js.CLOSED,this.emit(Gi.STATE_CHANGE,Zs.CLOSED)}}let O8={name:"ContentInspect",create:function(e){let{config:t}=e;return function(r){if(!r)throw new at(ce.INVALID_PARAMS,"inspectConfig is necessary.");if(!r.inspectType||!Array.isArray(r.inspectType))throw new at(ce.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{let n=[...new Set(r.inspectType)];n.forEach(i=>{var o;if(!Qt(o=["supervise","moderation"]).call(o,i))throw new at(ce.INVALID_PARAMS,"".concat(i," is not a valid inspect type."))}),r.inspectType=n}if(r&&r.extraInfo&&r.extraInfo.length>1024)throw new at(ce.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(t),new b8(t)}};var Ix=fe(yt.Object.getOwnPropertySymbols),N8=dn,w8=au.indexOf,D8=Fa,$b=F([].indexOf),Ax=!!$b&&1/$b([1],1,-0)<0;N8({target:"Array",proto:!0,forced:Ax||!D8("indexOf")},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Ax?$b(this,e,t)||0:w8(this,e,t)}});var P8=Ba("Array").indexOf,L8=v,k8=P8,eO=Array.prototype,M8=function(e){var t=e.indexOf;return e===eO||L8(eO,e)&&t===eO.indexOf?k8:t},bx=fe(M8);function U8(e,t){if(e==null)return{};var r,n,i=function(l,u){if(l==null)return{};var h,m,_={},R=qk(l);for(m=0;m<R.length;m++)h=R[m],bx(u).call(u,h)>=0||(_[h]=l[h]);return _}(e,t);if(Ix){var o=Ix(e);for(n=0;n<o.length;n++)r=o[n],bx(t).call(t,r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}let Ox=class{get localCapabilities(){return Zn(this._localCapabilities)}get rtpCapabilities(){return Zn(this._rtpCapabilities)}get candidates(){return Zn(this._candidates)}get iceParameters(){return Zn(this._iceParameters)}get dtlsParameters(){return Zn(this._dtlsParameters)}constructor(e){ie(this,"sessionDesc",void 0),ie(this,"_localCapabilities",void 0),ie(this,"_rtpCapabilities",void 0),ie(this,"_candidates",void 0),ie(this,"_iceParameters",void 0),ie(this,"_dtlsParameters",void 0),ie(this,"setup",void 0),ie(this,"currentMidIndex",void 0),ie(this,"cname","o/i14u9pJrxRKAsu"),ie(this,"firefoxSsrcMidMap",new Map),e=Zn(e);let{remoteIceParameters:t,remoteDtlsParameters:r,candidates:n,remoteRTPCapabilities:i,localCapabilities:o,direction:l,setup:u,videoCodec:h,audioCodec:m}=e,_;this.setup=u,_=l===Ma.RECEIVE_ONLY?ao(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):ao(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=i,this._candidates=n,this._iceParameters=t,this._dtlsParameters=r,this._localCapabilities=o;let R=l===Ma.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,A=l===Ma.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,D=l===Ma.RECEIVE_ONLY?i.send.videoCodecs:av(lr.VIDEO,R,A,h),J=l===Ma.RECEIVE_ONLY?i.send.audioCodecs:av(lr.AUDIO,R,A,m);for(let V of _.mediaDescriptions)V.attributes.iceUfrag=t.iceUfrag,V.attributes.icePwd=t.icePwd,V.attributes.fingerprints=r.fingerprints,V.attributes.candidates=n,V.attributes.setup=this.setup,V.media.mediaType==="application"&&(V.attributes.sctpPort="5000"),V.media.mediaType==="video"&&(V.media.fmts=D.map(K=>K.payloadType.toString(10)),V.attributes.payloads=D,V.attributes.extmaps=R.videoExtensions),V.media.mediaType==="audio"&&(V.media.fmts=J.map(K=>K.payloadType.toString(10)),V.attributes.payloads=J,V.attributes.extmaps=R.audioExtensions,TE(V));this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return zd(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(t=>this.hasMid(t)):this.sessionDesc.mediaDescriptions.some(t=>t.attributes.mid===e)}send(e,t,r,n,i){r=r.replace(/ /g,"-");let{ssrcs:o,ssrcGroups:l}=Mp(t,this.cname,Se("SYNC_GROUP")?r:void 0),u=this.findPreloadMediaDesc(o);if(u){if(Yn()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,u.attributes.mid),i&&(i.twcc||i.remb)){let h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,i),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{let h=this.findAvailableMediaIndex(e,o,n),m;return h===-1?(m=this.createOrRecycleSendMedia(e,o,l,"sendonly",n,i),this.updateBundleMids()):(m=Zn(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="sendonly",m.attributes.ssrcs=o,m.attributes.ssrcGroups=l,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(m,i)),Yn()&&this.firefoxSsrcMidMap.set(o[0].ssrcId,m.attributes.mid),{needExchangeSDP:!0,mid:m.attributes.mid}}}stopSending(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach(r=>{r.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,t,r){let n=[];return e.forEach(i=>{let o=i._mediaStreamTrack.kind,l=this.findAvailableRecvMediaIndex(o),u,h=!1;l===-1?(h=!0,u=this.createOrRecycleRecvMedia(i,[],"recvonly",t,r),this.updateBundleMids()):(u=Zn(this.sessionDesc.mediaDescriptions[l]),u.attributes.direction="recvonly"),n.push({mid:u.attributes.mid,needCreateTransceiver:h})}),n}stopReceiving(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>e.indexOf(r.attributes.mid)!==-1);if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){let{foundation:t,protocol:r,address:n,port:i,type:o,relatedAddress:l,relatedPort:u,priority:h}=new RTCIceCandidate(e),m={foundation:t??"",componentId:"1",transport:r??"",priority:h?h+"":"",connectionAddress:n??"",port:i?i+"":"",type:o?o+"":"",relAddr:l??"",relPort:u?u+"":"",extension:{}};this.candidates.some(_=>_.priority===m.priority&&_.connectionAddress===m.connectionAddress&&_.port===m.port)||(this._candidates.push(m),this.sessionDesc.mediaDescriptions.forEach(_=>{_.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,t,r,n,i){let o=e._mediaStreamTrack.kind,l=this.rtpCapabilities.recv,u=av(o,l,this.localCapabilities.send,o===lr.AUDIO?i:n),h=o===lr.VIDEO?l.videoExtensions:l.audioExtensions,m="".concat(++this.currentMidIndex),_={media:{mediaType:o,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(A=>A.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};_=this.mungRecvMediaDsec(_,e);let R=this.findFirstClosedMedia(o);if(R){let A=this.sessionDesc.mediaDescriptions.indexOf(R);this.sessionDesc.mediaDescriptions[A]=_}else this.sessionDesc.mediaDescriptions.push(_);return _}muteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>Qt(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(e){let t=this.sessionDesc.mediaDescriptions.filter(r=>Qt(e).call(e,r.attributes.mid||""));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach(r=>{r.attributes.direction="recvonly"})}findAvailableMediaIndex(e,t,r){return this.sessionDesc.mediaDescriptions.findIndex(n=>{let i=n.media.mediaType===e&&n.media.port!=="0"&&(n.attributes.direction==="sendonly"||n.attributes.direction==="sendrecv")&&n.attributes.ssrcs.length===0;if(Yn()){if(i){let o=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(o||n.attributes.mid!=="0"&&n.attributes.mid!=="1")||!(!o||o!==n.attributes.mid)}return!1}return i&&n.attributes.mid===r})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(t=>{let r=t.media.mediaType===e&&t.media.port!=="0"&&(t.attributes.direction==="recvonly"||t.attributes.direction==="sendrecv");return t.attributes.mid!=="0"&&t.attributes.mid!=="1"&&r})}predictReceivingMids(e){let t=[];for(let r=0;r<e;r++)t.push((this.currentMidIndex+r+1).toString(10));return t}restartICE(e){e=Zn(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,t,r,n,i,o){let l=this.rtpCapabilities.send,u=e===lr.VIDEO?l.videoCodecs:l.audioCodecs,h=e===lr.VIDEO?l.videoExtensions:l.audioExtensions;Yn()&&(i="".concat(++this.currentMidIndex));let m={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:i}};m=this.mungSendMediaDesc(m,o);let _=this.findFirstClosedMedia(e);if(_){let R=this.sessionDesc.mediaDescriptions.indexOf(_);this.sessionDesc.mediaDescriptions[R]=m}else this.sessionDesc.mediaDescriptions.push(m);return m}mungRecvMediaDsec(e,t,r){let n=Zn(e);return tb(n),vE(n,t),rb(n,t),gM(n),IR(n,r,this.localCapabilities.send),n}mungSendMediaDesc(e,t){let r=Zn(e);return IR(r,t,this.localCapabilities.recv),TE(r),r}updateRecvMedia(e,t){let r=this.sessionDesc.mediaDescriptions.findIndex(n=>n.attributes.mid===e);if(r!==-1){let n=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],t);this.sessionDesc.mediaDescriptions[r]=n}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(t=>{var r;return((r=t.attributes)===null||r===void 0||(r=r.ssrcs[0])===null||r===void 0?void 0:r.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(t=>Yn()?t.media.port==="0"&&t.media.mediaType===e:t.media.port==="0")}},x8=["sdp"];var Ln;function Nx(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function ch(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Nx(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let Dx=(Ln=class LE extends $k{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,r;return(t=(r=this.peerConnection.getReceivers()[0])===null||r===void 0||(r=r.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}get localCodecs(){return[]}set isInRestartIce(t){this._isInRestartIce=t}get isInRestartIce(){return this._isInRestartIce}constructor(t,r,n){super(t,r),ie(this,"direction",void 0),ie(this,"name",void 0),ie(this,"store",void 0),ie(this,"spec",void 0),ie(this,"peerConnection",void 0),ie(this,"initialOffer",void 0),ie(this,"transport",void 0),ie(this,"statsFilter",void 0),ie(this,"localCandidateCount",0),ie(this,"_isInRestartIce",!1),ie(this,"mutex",void 0),ie(this,"onLocalCandidate",void 0),ie(this,"remoteSDP",void 0),ie(this,"pendingCandidates",[]),ie(this,"localCapabilities",void 0),ie(this,"isReady",!1),ie(this,"restartCnt",0),ie(this,"curTurnServerIndex",0),this.store=r,this.spec=t,this.mutex=new da("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(LE.resolvePCConfiguration(t,r.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=n??Ma.SEND_ONLY,this.name=this.direction===Ma.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=mA(this.peerConnection,Se("STATS_UPDATE_INTERVAL"),void 0,Yn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{let r=await TM();if(this.localCapabilities=AR(r),t){let{sdp:n}=t,i=U8(t,x8),o=function(){let _={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},R=iv(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},D={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},J={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Qs(R,_,"videoExtensions",A,D,J),Qs(R,_,"videoCodecs",A,D,J),Qs(R,_,"audioExtensions",A,D,J),Qs(R,_,"audioCodecs",A,D,J),Se("RAISE_H264_BASELINE_PRIORITY")){let V=J.videoCodecs.findIndex(K=>K.rtpMap&&K.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&K.fmtp&&K.fmtp.parameters["profile-level-id"]==="42001f");if(V!==-1){let K=J.videoCodecs.findIndex(se=>se.rtpMap&&se.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(K<V){L.debug("raising H264 baseline profile priority");let se=J.videoCodecs[V];J.videoCodecs.splice(V,1),J.videoCodecs.splice(K,0,se)}K!==-1&&Se("FILTER_SEND_H264_BASELINE")&&(A.videoCodecs=A.videoCodecs.filter(se=>!(se.rtpMap&&se.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&se.fmtp&&se.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:A,recv:D,sendrecv:J}}({},{},n);this.remoteSDP=new Ox({remoteIceParameters:i.iceParameters,remoteDtlsParameters:i.dtlsParameters,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;let l=await this.peerConnection.createAnswer();if(!l.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");let u=Zd(l.sdp);await this.peerConnection.setLocalDescription(l);let h=await yM({},{},l.sdp);this.localCapabilities=AR(h);let m=this.peerConnection.getTransceivers()[0];return m!=null&&m.receiver&&m.receiver.transport&&this.tryBindTransportEvents(m.receiver.transport),ch(ch({},u),{},{sdp:l.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});let n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let i=Zd(n.sdp);return this.initialOffer=n,ch(ch({},i),{},{sdp:n.sdp})}}catch(r){throw new Et(ce.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);let{sdp:r,iceParameters:n,dtlsParameters:i}=t,o=await yM({},{},r);this.remoteSDP=new Ox({remoteIceParameters:n,remoteDtlsParameters:i,candidates:[],remoteRTPCapabilities:o,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});let l=this.peerConnection.getTransceivers()[0];l!=null&&l.sender&&l.sender.transport&&this.tryBindTransportEvents(l.sender.transport)}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async addRemoteCandidate(t){try{t&&this.pendingCandidates.push(t),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(r=>{this.peerConnection.addIceCandidate(r)}),this.pendingCandidates=[])}catch(r){throw new Et(ce.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(r.toString()))}}send(t,r,n){var i=this;return ds(function*(){let o=yield Qr(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let l=[],u=i.remoteSDP.receive(t,r,n);t.forEach((K,se)=>{if(u[se].needCreateTransceiver){let ue=i.peerConnection.addTransceiver(K._mediaStreamTrack,{direction:"sendonly"});l.push(ue),K._updateRtpTransceiver(ue)}else{let ue=i.peerConnection.getTransceivers().find(De=>De.mid===u[se].mid);if(!ue)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(u[se].mid));l.push(ue),K._updateRtpTransceiver(ue)}}),Yn()&&Se("SIMULCAST")===!0&&(yield Qr(i.applySimulcastForFirefox(l,t)));let h=u.map(K=>K.mid),m=yield Qr(i.peerConnection.createOffer()),_=i.mungSendOfferSDP(m.sdp,t,h),R=ao(_),A=h.map(K=>{let se=R.mediaDescriptions.find(ue=>ue.attributes.mid===K);if(!se)throw new Error("Cannot extract ssrc from mediaDescription.");return mM(se,Se("USE_PUB_RTX"))}),D=l.map((K,se)=>{let ue=h[se];return{localSSRC:A[se],id:ue}});yield Qr(i.peerConnection.setLocalDescription({type:"offer",sdp:_}));try{yield D}catch(K){let se=i.remoteSDP.toString();throw yield Qr(i.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Qr(i.peerConnection.setRemoteDescription({type:"answer",sdp:se})),yield Qr(i.stopSending(h,!0)),K}yield Qr(i.applySimulcastEncodings(l,t)),yield Qr(i.applySendEncodings(l,t));let J=i.remoteSDP.toString();return i.logSDPExchange(_,"offer","local","send")?.(J),yield Qr(i.setRemoteDescription({type:"answer",sdp:J})),l.map((K,se)=>{let ue=h[se];return{localSSRC:A[se],id:ue}})}catch(l){throw l instanceof Et?l:new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(l.toString()))}finally{o()}})()}async stopSending(t,r){let n=r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let i=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(i.length!==t.length)throw new Error("Transceivers' length (".concat(i.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));i.map(h=>{var m;h.direction="inactive",(m=h.stop)===null||m===void 0||m.call(h)});let o=await this.peerConnection.createOffer(),l=this.logSDPExchange(o.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(o),this.remoteSDP.stopReceiving(t);let u=this.remoteSDP.toString();l?.(u),await this.setRemoteDescription({type:"answer",sdp:u})}catch(i){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}finally{n&&n()}}async receive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:l}=this.remoteSDP.send(t,r,n,i);if(l){let h=this.remoteSDP.toString(),m=this.logSDPExchange(h,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:h});let _=await this.peerConnection.createAnswer(),R=this.mungReceiveAnswerSDP(_.sdp,o,t);m?.(R||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:R}),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));let u=this.peerConnection.getTransceivers().find(h=>h.mid===o);if(!u||u.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,mid:u.mid,transceiver:u}}catch(o){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async mockReceive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{mid:o,needExchangeSDP:l}=this.remoteSDP.send(t,r,n,i);if(l){let u=this.remoteSDP.toString(),h=this.logSDPExchange(u,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:u});let m=await this.peerConnection.createAnswer(),_=this.mungReceiveAnswerSDP(m.sdp,o,t);h?.(_||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:_}),L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else L.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."))}catch(o){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString(),n=this.logSDPExchange(r,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:r});let i=await this.peerConnection.createAnswer();n?.(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async restartICE(t){try{if(this.store.p2pTransport===bp.Auto&&(this.store.p2pTransport=bp.SdRtn,rn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(LE.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,rn().supportPCSetConfiguration&&this.peerConnection.setConfiguration(LE.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!t){this.restartCnt++,this.isReady=!1;let r=await this.peerConnection.createOffer({iceRestart:!0});if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let{iceParameters:n}=Zd(r.sdp);return this.store.descriptionStart(),this.direction===Ma.SEND_ONLY&&await this.peerConnection.setLocalDescription(r),n}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(t),this.store.descriptionStart(),this.direction===Ma.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});let r=await this.peerConnection.createAnswer();if(!r.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");let{iceParameters:n}=Zd(r.sdp);return await this.peerConnection.setLocalDescription(r),n}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}close(){var t;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r],[t]);this.remoteSDP.updateRecvMedia(t,r);let o=this.remoteSDP.toString(),l=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),l?.(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new Et(ce.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,r){let n=this.peerConnection.getTransceivers().filter(i=>i.mid===t);n.length===1&&(this.isVP8Simulcast(r)?Yn()||await this.applySimulcastEncodings(n,[r]):await this.applySendEncodings(n,[r]))}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let n=this.peerConnection.getTransceivers().find(i=>i.mid===r);n&&await n.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){let t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){let r=t[0].transport.iceTransport,{local:n,remote:i}=r.getSelectedCandidatePair();return{local:ch(ch({},Pl),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:ch(ch({},Pl),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t,r;Qt(t=["connected","completed"]).call(t,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=t=>{if(t.candidate){var r;t.candidate.candidate&&((r=this.onLocalCandidate)===null||r===void 0||r.call(this,t.candidate.toJSON())),this.localCandidateCount+=1}else L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i={iceServers:[]};var o;return t.iceServers?i.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Kg(t.turnServer.servers)?i.iceServers=t.turnServer.servers:(i.iceServers&&i.iceServers.push(...LE.turnServerConfigToIceServers(t.turnServer.servers,r,n)),Se("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&t.turnServer.serversFromGateway&&i.iceServers.push(...LE.turnServerConfigToIceServers(t.turnServer.serversFromGateway,r,n)),Qt(o=[bp.Relay,bp.SdRtn]).call(o,r)&&(i.iceTransportPolicy="relay"),Se("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(l=>{l.forceturn&&(i.iceTransportPolicy="relay")}))),Se("ENABLE_ENCODED_TRANSFORM")&&rn().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),L.debug("P2PConnection p2pTransport is ".concat(r)),i}static turnServerConfigToIceServers(t,r){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=[],o=t.filter(u=>u.tcpport);L.debug("P2PConnection turnServers is ".concat(o,", current index is ").concat(n));let l=o.length>n?o[n]:o[0];switch(r){case bp.SdRtn:let u=t.filter(m=>{var _;return Qt(_=m.username).call(_,"glb:")&&m.turnServerURL==m.turnServerURL}),h=u.length>n?u[n]:u[0];h&&(i.push({username:h.username,credential:h.password,credentialType:"password",urls:"turn:".concat(Xd(h.turnServerURL),":").concat(h.tcpport,"?transport=udp")}),i.push({username:h.username,credential:h.password,credentialType:"password",urls:"turns:".concat(Xd(h.turnServerURL),":").concat(h.tcpport,"?transport=tcp")}));break;case bp.Relay:l&&(i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Xd(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}));break;default:l&&(i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turn:".concat(l.turnServerURL,":").concat(l.tcpport,"?transport=udp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"turns:".concat(Xd(l.turnServerURL),":").concat(l.tcpport,"?transport=tcp")}),i.push({username:l.username,credential:l.password,credentialType:"password",urls:"stun:".concat(l.turnServerURL,":").concat(l.tcpport)}))}return i}tryBindTransportEvents(t){if(t){this.transport=t,t.onstatechange=()=>{var n;t!=null&&t.state&&((n=this.onDTLSTransportStateChange)===null||n===void 0||n.call(this,t.state))},t.onerror=n=>{var i;(i=this.onDTLSTransportError)===null||i===void 0||i.call(this,"error"in n?n.error:n)};let r=t.iceTransport;r&&(r.onstatechange=()=>{let n=t?.iceTransport.state;var i;n&&((i=this.onICETransportStateChange)===null||i===void 0||i.call(this,n))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){let{local:n,remote:i}=r.getSelectedCandidatePair();L.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:n.type,protocol:n.protocol}),", remote ").concat(JSON.stringify({candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})," )"))}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,r){var n;if(r||(r=this.peerConnection.getSenders().find(_=>_.track===t._mediaStreamTrack)),!r)return L.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return L.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!rn().supportSetRtpSenderParameters)return L.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");let i={},o={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var l;let{bitrateMax:_,frameRate:R,scaleResolutionDownBy:A}=t._encoderConfig;_&&(o.maxBitrate=1e3*_),Qt(l=t._hints).call(l,Nn.LOW_STREAM)&&(R&&(o.maxFramerate=yo(R)),A&&A>=1&&(o.scaleResolutionDownBy=A))}if(Se("DSCP_TYPE")&&wu()){var u;let _=Se("DSCP_TYPE");Qt(u=["very-low","low","medium","high"]).call(u,_)&&(o.networkPriority=_)}let h=r.getParameters(),m=(n=h.encodings)===null||n===void 0?void 0:n[0];Yn()&&!m&&(i.encodings=[o]),m&&Object.assign(m,o),Object.assign(h,i),L.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(h.encodings))),await r.setParameters(h)}async applySendEncodings(t,r){try{if(!rn().supportSetRtpSenderParameters||t.length!==r.length)return;for(let n=0;n<t.length;n++){let i=t[n],o=r[n];o instanceof xn&&!this.isVP8Simulcast(o)&&await this.updateRtpSenderEncodings(o,i.sender)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r,n){let i=ao(t);return r.forEach((o,l)=>{let u=n[l],h=i.mediaDescriptions.find(m=>m.attributes.mid===u);h&&(vE(h,o),vM(h,o,this.store.codec))}),zd(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var r;(r=this.onFirstVideoDecodedTimeout)===null||r===void 0||r.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,r){if(t.length===r.length)for(let h=0;h<t.length;h++){var n,i,o,l,u;let m=t[h],_=r[h];if(_ instanceof xn&&!Qt(n=_._hints).call(n,Nn.LOW_STREAM)&&(i=_._encoderConfig)!==null&&i!==void 0&&i.bitrateMax&&((o=_._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(l=_._scalabilityMode)!==null&&l!==void 0&&l.numSpatialLayers&&((u=_._scalabilityMode)===null||u===void 0?void 0:u.numSpatialLayers)>1&&this.store.codec==="vp8"){let R={},A={high:1e3*(_._encoderConfig.bitrateMax-50),medium:5e4};R.encodings=[{rid:"m",active:!0,maxBitrate:A.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:A.high}];let D=m.sender.getParameters();await m.sender.setParameters(Object.assign(D,R))}}}async applySimulcastEncodings(t,r){if(!Yn()&&t.length===r.length)for(let n=0;n<t.length;n++){let i=r[n];if(i instanceof xn&&this.isVP8Simulcast(i)){let o=t[n],l={},u={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};l.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];let h=o.sender.getParameters();await o.sender.setParameters(Object.assign(h,l))}}}isVP8Simulcast(t){var r,n,i,o,l;return!!(t instanceof xn&&Se("SIMULCAST")&&this.store.codec==="vp8"&&!Qt(r=t._hints).call(r,Nn.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((i=t._encoderConfig)===null||i===void 0?void 0:i.bitrateMax)>200&&(o=t._scalabilityMode)!==null&&o!==void 0&&o.numSpatialLayers&&((l=t._scalabilityMode)===null||l===void 0?void 0:l.numSpatialLayers)>1)}logSDPExchange(t,r,n,i){if(Se("SDP_LOGGING"))return L.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(r," SDP during P2PConnection.").concat(i,`
`),t),r==="offer"?o=>{this.logSDPExchange(o,"answer",n==="local"?"remote":"local",i)}:void 0}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(l=>{l.direction="inactive"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(t);let o=this.remoteSDP.toString();i?.(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getTransceivers().filter(l=>l.mid&&t.indexOf(l.mid)!==-1);if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");r.map(async l=>{l.direction="sendonly"});let n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(t);let o=this.remoteSDP.toString();i?.(o),await this.setRemoteDescription({type:"answer",sdp:o})}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}async getRemoteSSRC(t,r){var n,i;if(r=(n=r)!==null&&n!==void 0?n:(i=this.currentRemoteDescription)===null||i===void 0?void 0:i.sdp){var o;return((o=ao(r).mediaDescriptions.find(u=>u.attributes.mid===t))===null||o===void 0?void 0:o.attributes.ssrcs)?.[0].ssrcId}}async setRemoteDescription(t){var r;await this.peerConnection.setRemoteDescription(t),Qt(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(t,r,n){let i=ao(t),o=i.mediaDescriptions.find(l=>l.attributes.mid===r);return o&&n===lr.AUDIO&&o.media.mediaType==="audio"&&TE(o),zd(i)}},_r(Ln.prototype,"establish",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"establish"),Ln.prototype),_r(Ln.prototype,"connect",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"connect"),Ln.prototype),_r(Ln.prototype,"receive",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"receive"),Ln.prototype),_r(Ln.prototype,"mockReceive",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"mockReceive"),Ln.prototype),_r(Ln.prototype,"stopReceiving",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"stopReceiving"),Ln.prototype),_r(Ln.prototype,"restartICE",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"restartICE"),Ln.prototype),_r(Ln.prototype,"close",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"close"),Ln.prototype),_r(Ln.prototype,"updateEncoderConfig",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"updateEncoderConfig"),Ln.prototype),_r(Ln.prototype,"updateSendParameters",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"updateSendParameters"),Ln.prototype),_r(Ln.prototype,"replaceTrack",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"replaceTrack"),Ln.prototype),_r(Ln.prototype,"muteLocal",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"muteLocal"),Ln.prototype),_r(Ln.prototype,"unmuteLocal",[nc],Object.getOwnPropertyDescriptor(Ln.prototype,"unmuteLocal"),Ln.prototype),Ln);function nc(e,t,r){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let i=this.mutex,o=await i.lock("From P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await n.apply(this,u)}finally{o()}},r}let Wc=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var Px,Lx,kx,Mx,Ux,xx,jx,Bx,Vx,Fx,Gx,Kn;function Hx(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function c0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Hx(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let j8=(Px=Kc(Wc.SEND_ONLY),Lx=Kc(Wc.SEND_ONLY),kx=Kc(),Mx=Kc(Wc.RECEIVE_ONLY),Ux=Kc(Wc.RECEIVE_ONLY),xx=Kc(Wc.RECEIVE_ONLY),jx=Kc(Wc.RECEIVE_ONLY),Bx=Kc(Wc.RECEIVE_ONLY),Vx=Kc(Wc.RECEIVE_ONLY),Fx=Kc(),Gx=Kc(Wc.RECEIVE_ONLY),Kn=class extends zn{get state(){return this._state}set state(e){let t=this._state;this._state=e,this.emit(Cr.StateChange,t,this._state)}constructor(e,t){super(),ie(this,"isPlanB",!1),ie(this,"store",void 0),ie(this,"statsUploader",void 0),ie(this,"sendConnection",void 0),ie(this,"recvConnection",void 0),ie(this,"localTrackMap",new Map),ie(this,"remoteUserMap",new Map),ie(this,"localDataChannels",[]),ie(this,"pendingLocalTracks",[]),ie(this,"pendingRemoteTracks",[]),ie(this,"statsCollector",void 0),ie(this,"dtlsFailedCount",0),ie(this,"sendMutex",void 0),ie(this,"recvMutex",void 0),ie(this,"_state",ln.Disconnected),ie(this,"_restartStates",["disconnected","failed"]),ie(this,"reconnectInterval",void 0),ie(this,"uploadUnplinkStarted",!1),ie(this,"uploadDownlinkStarted",!1),ie(this,"uplinkStateUploadInterval",void 0),ie(this,"downlinkStatsUploadInterval",void 0),ie(this,"handleMuteLocalTrack",async(r,n,i)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==ln.Connected)return void i(new Et(ce.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));let h=this.filterTobeMutedTracks(r);if(h.length===0)return void n();let m=h.find(D=>D[0]==="videoLowTrack");m&&m[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(h.map(D=>{let[,{id:J}]=D;return J}));let _=!1;var l,u;r.trackMediaType==="video"?_=!((l=this.localTrackMap.get(Mt.LocalAudioTrack))===null||l===void 0||!l.track._muted):_=((u=this.localTrackMap.get(Mt.LocalVideoTrack))===null||u===void 0?void 0:u.id)===void 0;let R=this.createMuteMessage(h);await bn(this,Cr.RequestMuteLocal,R);let A=r.trackMediaType==="video"?Yd.MUTE_LOCAL_VIDEO:Yd.MUTE_LOCAL_AUDIO;await bn(this,Cr.RequestP2PMuteLocal,{action:A,message:R,isMuteAll:_}),n()}catch(h){i(h)}finally{o()}}),ie(this,"handleUnmuteLocalTrack",async(r,n,i)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==ln.Connected)return void i(new Et(ce.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));let l=this.filterTobeUnmutedTracks(r);if(l.length===0)return void n();await this.sendConnection.unmuteLocal(l.map(m=>{let[,{id:_}]=m;return _}));let u=this.createUnmuteMessage(l),h=r.trackMediaType==="video"?Yd.UNMUTE_LOCAL_VIDEO:Yd.UNMUTE_LOCAL_AUDIO;await bn(this,Cr.RequestP2PMuteLocal,{action:h,message:u}),n()}catch(l){i(l)}finally{o()}}),ie(this,"handleUpdateVideoEncoder",async(r,n,i,o)=>{let l;typeof o=="boolean"&&o||(l=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{let h=this.localTrackMap.get(Mt.LocalVideoTrack);if(!this.sendConnection||!h||h.track!==r||this.state!==ln.Connected)return void n();let{id:m,track:_}=h;m&&(await this.sendConnection.updateSendParameters(m,_),await this.sendConnection.updateEncoderConfig(m,_),this.emit(Cr.UpdateVideoEncoder,_)),n()}catch(h){i(h)}finally{var u;(u=l)===null||u===void 0||u()}}),ie(this,"handleUpdateVideoSendParameters",async(r,n,i)=>{let o=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{let l=this.localTrackMap.get(Mt.LocalVideoTrack);if(!this.sendConnection||!l||l.track!==r||this.state!==ln.Connected)return void n();let{id:u,track:h}=l;u&&await this.sendConnection.updateSendParameters(u,h),n()}catch(l){i(l)}finally{o()}}),ie(this,"handleReplaceTrack",async(r,n,i,o)=>{let l;L.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(r.getTrackId(),"]")),typeof o=="boolean"&&o||(l=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var u;let m=Array.from(this.localTrackMap.entries()).find(_=>{let[,{track:R}]=_;return r===R});if(!this.sendConnection||!m||m[1].id===void 0||this.state!==ln.Connected)return void n();if(await((u=this.sendConnection)===null||u===void 0?void 0:u.replaceTrack(r,m[1].id)),m[0]===Mt.LocalVideoTrack&&rn().supportDualStreamEncoding){let _=this.localTrackMap.get(Mt.LocalVideoLowTrack);if(_){let R=r._mediaStreamTrack.clone();_.track._originMediaStreamTrack.stop(),_.track._mediaStreamTrack=R,_.track._originMediaStreamTrack=R,await new tr((A,D)=>{this.handleReplaceTrack(_.track,A,D,!0)})}}n()}catch(m){i(m)}finally{var h;(h=l)===null||h===void 0||h()}}),ie(this,"handleGetLocalVideoStats",r=>{r(this.statsCollector.getLocalVideoTrackStats())}),ie(this,"handleGetLocalAudioStats",r=>{r(this.statsCollector.getLocalAudioTrackStats())}),ie(this,"handleGetRemoteVideoStats",r=>this.statsCollector.getRemoteVideoTrackStats(r.uid)[r.uid]),ie(this,"handleGetRemoteAudioStats",r=>this.statsCollector.getRemoteAudioTrackStats(r.uid)[r.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new o2(e),this.bindStatsUploaderEvents(),this.sendMutex=new da("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new da("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(r=>{r&&(r.iceConnectionState!=="disconnected"&&r.iceConnectionState!=="failed"||this.handleDisconnect(r.direction))})},Se("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,t){throw new Et(ce.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new Et(ce.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,t){let r;try{if(t){this.recvConnection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),r=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new Dx(e,this.store,Ma.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);let n=await this.recvConnection.establish(t);return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}{this.state=ln.New,this.sendConnection&&(L.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),r=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new Dx(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);let n=await this.sendConnection.establish();return{iceParameters:n.iceParameters,dtlsParameters:n.dtlsParameters,sdp:n.sdp}}}finally{r&&r()}}async p2pConnect(e){if(!this.sendConnection)throw new Et(ce.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ln.Connected}async addRemoteCandidate(e,t){if(t===Ma.RECEIVE_ONLY){if(!this.sendConnection)throw new Et(ce.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new Et(ce.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,t,r){var n=this;return ds(function*(){let i=yield Qr(n.sendMutex.lock("From P2PChannel.publish"));try{if(!n.sendConnection||n.state!==ln.Connected){n.throwIfTrackTypeNotMatch(e);let m=e.filter(_=>n.pendingLocalTracks.indexOf(_)===-1);return void(n.pendingLocalTracks=n.pendingLocalTracks.concat(m))}n.store.pubId=n.store.pubId+1,fa.markPublishStart(n.store.clientId,n.store.pubId);let o=n.filterTobePublishedTracks(e,t,r);if(o.length===0)return void(yield Qr(n.tryToUnmuteAudio(e)));o.forEach(m=>{let{track:_,type:R}=m,A=Date.now();n.store.publish(_.getTrackId(),R===Mt.LocalAudioTrack?"audio":"video",A)}),n.bindLocalTrackEvents(o);let l=yield Qr(n.sendConnection.send(o.map(m=>{let{track:_}=m;return _}),n.store.codec,n.store.audioCodec)),u=(yield Qr(l.next())).value,h=n.createGatewayPublishMessage(o,u);try{yield h}catch(m){throw l.throw(m),m?.code===ce.WS_ABORT&&o.forEach(_=>{let{track:R}=_;n.pendingLocalTracks.indexOf(R)===-1&&n.pendingLocalTracks.push(R)}),n.unbindLocalTrackEvents(o),m}yield Qr(l.next()),o.forEach(m=>{let{type:_}=m;n.statsCollector.addLocalStats(_)}),n.statsUploader.startUploadOutboundStats(),n.assignLocalTracks(o,u),o.forEach(m=>{let{track:_,type:R}=m,A=Date.now();n.store.publish(_.getTrackId(),R===Mt.LocalAudioTrack?"audio":"video",void 0,A)}),n.startUploadUplinkState()}finally{i()}})()}async unpublish(e){if(!this.sendConnection||this.state!==ln.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(i=>!Qt(e).call(e,i)));let t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;let r=t.find(i=>i[0]==="videoLowTrack");r&&r[1].track.close();let n=this.createGatewayUnpublishMessage(t);if(await this.sendConnection.stopSending(t.map(i=>{let[,{id:o}]=i;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(i=>{let[o,{track:l}]=i;return{type:o,track:l}})),t.forEach(i=>{let[o]=i;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===ln.Connected)return r&&r[1].track.close(),n;e.forEach(i=>{let o=this.pendingLocalTracks.indexOf(i);o!==-1&&this.pendingLocalTracks.splice(o,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);let e=()=>{let t=[],r=[];Array.from(this.localTrackMap.entries()).forEach(n=>{let[i,{track:o,ssrcs:l}]=n,u={stream_type:NG(o,i),ssrcs:l};o._muted||!o._enabled?t.push(u):r.push(u)}),t.length>0&&t.forEach(n=>{bn(this,Cr.RequestMuteLocal,[n])}),r.length>0&&r.forEach(n=>{bn(this,Cr.RequestUnmuteLocal,[n])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return ds(function*(){throw new Et(ce.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(L.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await ia(this,Cr.RequestRePublish,this.pendingLocalTracks),this.emit(Cr.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new Et(ce.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,t,r,n){var i;if(!this.recvConnection)throw new Et(ce.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((i=this.remoteUserMap.get(e))!==null&&i!==void 0&&i.has(t))return;let{track:o,mid:l,transceiver:u}=await this.recvConnection.receive(t,[{ssrcId:r}],String(e.uid),n);t===lr.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(o):(e._audioTrack=new dE(o,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),u&&e._audioTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=r,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(o):(e._videoTrack=new uE(o,e.uid,e._uintid,this.store),L.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),u&&e._videoTrack._updateRtpTransceiver(u),this.bindRemoteTrackEvents(e,e._videoTrack));let h=this.remoteUserMap.get(e);h?h.set(t,l):this.remoteUserMap.set(e,new Map([[t,l]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();let m=this.pendingRemoteTracks.findIndex(_=>{let{user:R,kind:A}=_;return R.uid===e.uid&&t===A});m!==-1&&(this.pendingRemoteTracks.splice(m,1),this.emit(Cr.MediaReconnectEnd,e.uid))}async mockSubscribe(e,t,r,n){if(!this.recvConnection)throw new Et(ce.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(t,[{ssrcId:r}],String(e.uid),n)}async unsubscribe(e,t,r){let n=this.pendingRemoteTracks.filter(o=>{let{user:l,kind:u}=o;return t!==void 0?l.uid===e.uid&&t===u:l.uid===e.uid});if(n.forEach(o=>{let l=this.pendingRemoteTracks.indexOf(o);this.pendingRemoteTracks.splice(l,1)}),this.recvConnection||r||n.forEach(o=>{let{kind:l}=o;var u;if(l===lr.AUDIO)(u=e._audioTrack)===null||u===void 0||u._destroy(),e._audioTrack=void 0;else if(l===lr.VIDEO){var h;(h=e._videoTrack)===null||h===void 0||h._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;let i=this.filterTobeUnSubscribedTracks(e,t);i.length!==0&&(await this.recvConnection.stopReceiving(i.map(o=>{let[,{id:l}]=o;return l})),this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),i.forEach(o=>{let[l,{kind:u}]=o;var h,m;if(u===lr.VIDEO&&l._videoSSRC&&((h=this.recvConnection)===null||h===void 0||h.setStatsRemoteVideoIsReady(l._videoSSRC,!1)),u===lr.VIDEO)this.unbindRemoteTrackEvents(l._videoTrack),r||((m=l._videoTrack)===null||m===void 0||m._destroy(),l._videoTrack=void 0);else if(u===lr.AUDIO){var _;this.unbindRemoteTrackEvents(l._audioTrack),!r&&((_=l._audioTrack)===null||_===void 0||_._destroy(),l._audioTrack=void 0)}}),i.forEach(o=>{let[,{kind:l}]=o;bn(this,Cr.RequestP2PMuteRemote,l)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=()=>Array.from(this.remoteUserMap.entries()).forEach(t=>{let[,r]=t;[lr.VIDEO,lr.AUDIO].forEach(n=>{r.has(n)?bn(this,Cr.RequestP2PUnmuteRemote,n):bn(this,Cr.RequestP2PMuteRemote,n)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new Et(ce.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new Et(ce.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new Et(ce.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new Et(ce.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!r.get(t))return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));let n=t===lr.VIDEO?e._videoSSRC:e._audioSSRC;n!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(n,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.recvConnection)return;let r=this.remoteUserMap.get(e);if(!r)return void L.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));r.get(t)||L.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){let t=this.localTrackMap.get(Mt.LocalAudioTrack);if(t?.track instanceof Ci){let r=t.track;return Array.from(this.localTrackMap.entries()).filter(n=>{let[i]=n;return i!==Mt.LocalAudioTrack}).filter(n=>{let[i]=n;return!(e&&i===Mt.LocalVideoLowTrack)}).map(n=>{let[,{track:i}]=n;return i}).concat(r.trackList)}return Array.from(this.localTrackMap.entries()).filter(r=>{let[n]=r;return!(e&&n===Mt.LocalVideoLowTrack)}).map(r=>{let[,{track:n}]=r;return n})}reportPublishEvent(e,t,r,n,i){if(e){let l=this.localTrackMap.get(Mt.LocalAudioTrack),u=n?this.localTrackMap.get(Mt.LocalVideoLowTrack):this.localTrackMap.get(Mt.LocalVideoTrack);gr.publish(this.store.sessionId,{eventElapse:fa.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l?.track.getTrackLabel(),videoName:u?.track.getTrackLabel(),screenshare:u?.track._hints.indexOf(Nn.SCREEN_TRACK)!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;r||(r=[]);let l=r.find(h=>h instanceof ei),u=n?(o=this.localTrackMap.get(Mt.LocalVideoTrack))===null||o===void 0?void 0:o.track:r.find(h=>h instanceof xn);gr.publish(this.store.sessionId,{eventElapse:fa.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:l?.getTrackLabel(),videoName:u?.getTrackLabel(),screenshare:u?._hints.indexOf(Nn.SCREEN_TRACK)!==-1,audio:!!l,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,r,n){let i=n===lr.VIDEO?r._videoSSRC:r._audioSSRC;i&&gr.subscribe(this.store.sessionId,{succ:e,ec:t,video:n===lr.VIDEO,audio:n===lr.AUDIO,peerid:r.uid,subscribeRequestid:n===lr.VIDEO?r._videoSSRC:r._audioSSRC,p2pid:this.store.p2pId,eventElapse:fa.measureFromSubscribeStart(this.store.clientId,i)})}reset(){L.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new da("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new da("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();let e=this.localTrackMap.get(Mt.LocalAudioTrack);if(e?.track instanceof Ci){if(e.track.trackList.length>0){let t=e.track;e.track.trackList.forEach(r=>{t.removeAudioTrack(r)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=ln.Disconnected}getStats(e){var t,r;return e?(r=this.recvConnection)===null||r===void 0?void 0:r.getStats():(t=this.sendConnection)===null||t===void 0?void 0:t.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.recvConnection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){let e=this.localTrackMap.get(Mt.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){let e=this.localTrackMap.get(Mt.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){let t=this.localTrackMap.get(e);return t&&t.track instanceof xn||t&&t.track instanceof ei?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;let r=this.remoteUserMap.get(e);return!!r&&(!t||r.has(t))}getRemoteMedia(e){var t;let r=Array.from(Mo(t=this.remoteUserMap).call(t)).find(n=>n.uid===e);return r?{audioTrack:r.audioTrack,audioSSRC:r._audioSSRC,videoTrack:r.videoTrack,videoSSRC:r._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(r=>{let[n]=r;return{uid:n.uid,level:n.audioTrack?100*n.audioTrack._source.getAccurateVolumeLevel():0}}),t=this.localTrackMap.get(Mt.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Ng(e).call(e,(r,n)=>r.level-n.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(L.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=ln.Reconnecting,Se("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var r;t._videoTrack&&t._videoTrack._player&&((r=t._videoTrack._player.getVideoElement())===null||r===void 0||r.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var t;let[r,{track:n}]=e;switch(r){case Mt.LocalVideoTrack:Qt(t=n._hints).call(t,Nn.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case Mt.LocalAudioTrack:n instanceof Ci?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case Mt.LocalVideoLowTrack:}}),this.emit(Cr.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;Array.from(Mo(r).call(r)).forEach(n=>{this.setPendingRemoteMedia(t,n)}),this.emit(Cr.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),L.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(let r of this.pendingRemoteTracks){let{user:n,kind:i}=r;if((e instanceof $d?e.uid:e)===n.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}async restartICE(e,t){let r,n;if(e===Ma.SEND_ONLY){if(!this.sendConnection)throw new Et(ce.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");r=await this.sendMutex.lock("From P2PChannel.restartICE"),n=this.sendConnection}else{if(!this.recvConnection)throw new Et(ce.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");r=await this.recvMutex.lock("From P2PChannel.restartICE"),n=this.recvConnection}try{if(t){let i=await n.restartICE(t);return n.isInRestartIce=!1,i}{let i=await n.restartICE();if(i){let o=await ia(this,Cr.RequestP2PRestartICE,{direction:Ma.RECEIVE_ONLY,iceParameter:i});await n.restartICE(o),n.isInRestartIce=!1}}}finally{r()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;let e=this.sendConnection.getStats(),t=this.localTrackMap.get(Mt.LocalVideoTrack),r=this.localTrackMap.get(Mt.LocalAudioTrack),n=e.videoSend.find(D=>{var J;return D.ssrc===(t==null||(J=t.ssrcs)===null||J===void 0?void 0:J[0].ssrcId)}),i=e.audioSend.find(D=>{var J;return D.ssrc===(r==null||(J=r.ssrcs)===null||J===void 0?void 0:J[0].ssrcId)});if(!n||!i)return 1;let o=Lo(this,Cr.NeedSignalRTT),l=n?n.rttMs:void 0,u=i?i.rttMs:void 0,h=l&&u?(l+u)/2:l||u,m=(h&&o?(h+o)/2:h||o)||0,_=100*e.sendPacketLossRate*.7/50+.3*m/1500,R=_<.17?1:_<.36?2:_<.59?3:_<.1?4:5,A=t?.track;if(A&&A._encoderConfig&&A._hints.indexOf(Nn.SCREEN_TRACK)===-1){let D=A._encoderConfig.bitrateMax,J=e.bitrate.actualEncoded;if(D&&J){let V=(1e3*D-J)/(1e3*D);return Wk[V<.15?0:V<.3?1:V<.45?2:V<.6?3:4][R]}}return R}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;let e=this.recvConnection.getStats(),t=0;return Array.from(this.remoteUserMap.entries()).forEach(r=>{let[n]=r,i=n._audioSSRC,o=n._videoSSRC,l=e.audioRecv.find(J=>J.ssrc===i),u=e.videoRecv.find(J=>J.ssrc===o);if(!l&&!u)return void(t+=1);let h=Lo(this,Cr.NeedSignalRTT),m=e.rtt,_=(m&&h?(m+h)/2:m||h)||0,R=l?l.jitterMs:void 0,A=e.recvPacketLossRate,D=.7*A*100/50+.3*_/1500;R&&(D=.6*A*100/50+.2*_/1500+.2*R/400),t+=D<.1?1:D<.17?2:D<.36?3:D<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new tr((t,r)=>{this.handleMuteLocalTrack(e,t,r)})}filterTobePublishedTracks(e,t,r){let n=[],i=rn(),o=this.getAllTracks();e=Zm(e=e.filter(h=>o.indexOf(h)===-1));let l=!1,u=!1;for(let h of e){if(h instanceof xn&&(this.localTrackMap.has(Mt.LocalVideoTrack)||l?new Et(ce.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(n.push({track:h,type:Mt.LocalVideoTrack}),l=!0),t)){let m=this.getLowVideoTrack(h,r);n.push({track:m,type:Mt.LocalVideoLowTrack})}if(h instanceof ei){let m=this.localTrackMap.get(Mt.LocalAudioTrack);if(m){if(!(m.track instanceof Ci))throw new Et(ce.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new Et(ce.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0)}else if(u){let _=n.find(R=>{let{type:A}=R;return A===Mt.LocalAudioTrack});if(!(_.track instanceof Ci))throw new Et(ce.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new Et(ce.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");_.track.addAudioTrack(h)}else{if(!i.webAudioMediaStreamDest||h instanceof Ci||h._bypassWebAudio)n.push({track:h,type:Mt.LocalAudioTrack});else{let _=new Ci;_.addAudioTrack(h),n.push({track:_,type:Mt.LocalAudioTrack})}u=!0}}}return n}filterTobeUnpublishedTracks(e){let t=[],r=this.getAllTracks();e=Zm(e=e.filter(n=>r.indexOf(n)!==-1));for(let n of e){if(n instanceof ei){let i=this.localTrackMap.get(Mt.LocalAudioTrack);if(!i)continue;i.track instanceof Ci?(i.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),i.track.trackList.length===0&&(t.push([Mt.LocalAudioTrack,i]),i.track.close())):t.push([Mt.LocalAudioTrack,i])}if(n instanceof xn){let i=this.localTrackMap.get(Mt.LocalVideoTrack);if(!i)continue;t.push([Mt.LocalVideoTrack,i]);let o=this.localTrackMap.get(Mt.LocalVideoLowTrack);o&&t.push([Mt.LocalVideoLowTrack,o])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:r,type:n}=t;switch(n){case Mt.LocalVideoTrack:r.addListener(hr.GET_STATS,this.handleGetLocalVideoStats),r.addListener(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(hr.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.addListener(hr.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.addListener(hr.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.addListener(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Mt.LocalAudioTrack:this.bindLocalAudioTrackEvents(r);case Mt.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof Ci?e.trackList.forEach(r=>{r.addListener(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.addListener(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.addListener(hr.GET_STATS,this.handleGetLocalAudioStats),r.addListener(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.addListener(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(hr.GET_STATS,this.handleGetLocalAudioStats),e.addListener(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(hr.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[r,{track:n}]=t;return{track:n,type:r}})),e.forEach(t=>{let{track:r,type:n}=t;switch(n){case Mt.LocalVideoTrack:r.off(hr.GET_STATS,this.handleGetLocalVideoStats),r.off(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(hr.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),r.off(hr.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),r.off(hr.NEED_REPLACE_TRACK,this.handleReplaceTrack),r.off(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case Mt.LocalAudioTrack:this.unbindLocalAudioTrackEvents(r);case Mt.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof Ci?e.trackList.forEach(t=>{t.off(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(hr.GET_STATS,this.handleGetLocalAudioStats),t.off(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(hr.GET_STATS,this.handleGetLocalAudioStats),e.off(hr.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(hr.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(hr.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(hr.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(hr.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof uE&&t.addListener(hr.GET_STATS,r=>{r(this.handleGetRemoteVideoStats(e))}),t instanceof dE&&t.addListener(hr.GET_STATS,r=>{r(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(hr.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,r]=e;r.has(lr.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),r.has(lr.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((r,n)=>{var i;let o,{track:l,type:u}=r;switch(u){case Mt.LocalAudioTrack:o=un.Audio;break;case Mt.LocalVideoTrack:o=Qt(i=l._hints).call(i,Nn.SCREEN_TRACK)?un.Screen:un.High;break;case Mt.LocalVideoLowTrack:o=un.Low}return{kind:u===Mt.LocalAudioTrack?lr.AUDIO:lr.VIDEO,stream_type:o,mid:t[n].id,ssrcs:t[n].localSSRC,isMuted:l.muted||!l.enabled}})}createGatewayUnpublishMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:l,id:u}]=t;switch(i){case Mt.LocalVideoTrack:n=Qt(r=o._hints).call(r,Nn.SCREEN_TRACK)?un.Screen:un.High;break;case Mt.LocalAudioTrack:n=un.Audio;break;case Mt.LocalVideoLowTrack:n=un.Low}return{stream_type:n,ssrcs:l,mid:u}})}assignLocalTracks(e,t){e.forEach((r,n)=>{let{track:i,type:o}=r;this.localTrackMap.set(o,{track:i,id:t[n].id,ssrcs:t[n].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[r]=t;this.localTrackMap.delete(r)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{var r;L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(t,")")),this.emit(Cr.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(e.isInRestartIce=!1),Qt(r=this._restartStates).call(r,t)&&!e.isInRestartIce&&(t==="disconnected"&&await Yi(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),gr.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Jn.TRACER}).onSuccess(),this.emit(Cr.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var r;let n=Array.from(Mo(r=this.remoteUserMap).call(r)).find(o=>o._audioSSRC===t);var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),(i=n.audioTrack)===null||i===void 0||i.emit(aE.FIRST_FRAME_DECODED),gr.firstRemoteFrame(this.store.sessionId,Pi.FIRST_AUDIO_DECODE,Hn.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:fa.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var r;let n=Array.from(Mo(r=this.remoteUserMap).call(r)).find(i=>i._audioSSRC===t);n&&gr.firstRemoteFrame(this.store.sessionId,Pi.FIRST_AUDIO_RECEIVED,Hn.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:fa.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,r,n)=>{this.reportVideoFirstFrameDecoded(t,r,n)},e.onFirstVideoReceived=t=>{var r;let n=Array.from(Mo(r=this.remoteUserMap).call(r)).find(i=>i._videoSSRC===t);n&&gr.firstRemoteFrame(this.store.sessionId,Pi.FIRST_VIDEO_RECEIVED,Hn.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:fa.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,r)=>{let n=t.candidateType==="relay",i=r.candidateType==="relay";r.candidateType!=="unknown"&&n===i||this.emit(Cr.ConnectionTypeChange,n),L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Jd(r))," -> ").concat(JSON.stringify(Jd(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,r)=>{L.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Jd(r))," -> ").concat(JSON.stringify(Jd(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},e.onLocalCandidate=t=>{this.emit(Cr.LocalCandidate,{candidate:t,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){let t=e===Ma.SEND_ONLY?this.sendConnection:this.recvConnection;t&&!t.isInRestartIce&&(t.isInRestartIce=!0,L.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(t.name,"] start use restartICE")),e===Ma.SEND_ONLY?this.restartICE(e):ia(this,Cr.RequestP2PRestartICE,{direction:Ma.SEND_ONLY}))}filterTobeMutedTracks(e){let t=[];if(this.getAllTracks().indexOf(e)===-1)return t;let r=this.localTrackMap.get(Mt.LocalAudioTrack);if(e instanceof ei&&r?.track instanceof Ci)return r.track.isActive||t.push([Mt.LocalAudioTrack,r]),t;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return e===o});if(n&&(t.push(n),n[0]===Mt.LocalVideoTrack)){let i=this.localTrackMap.get(Mt.LocalVideoLowTrack);i&&t.push([Mt.LocalVideoLowTrack,i])}return t}filterTobeUnmutedTracks(e){let t=[],r=this.localTrackMap.get(Mt.LocalAudioTrack);if(e instanceof ei&&r?.track instanceof Ci)return r.track.isActive&&t.push([Mt.LocalAudioTrack,r]),t;let n=Array.from(this.localTrackMap.entries()).find(i=>{let[,{track:o}]=i;return e===o});if(n)if(n[0]===Mt.LocalVideoTrack){t.push(n);let i=this.localTrackMap.get(Mt.LocalVideoLowTrack);i&&t.push([Mt.LocalVideoLowTrack,i])}else t.push(n);return t}createMuteMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:l,id:u}]=t;switch(i){case Mt.LocalAudioTrack:n=un.Audio;break;case Mt.LocalVideoTrack:n=Qt(r=o._hints).call(r,Nn.SCREEN_TRACK)?un.Screen:un.High;break;case Mt.LocalVideoLowTrack:n=un.Low}return{stream_type:n,ssrcs:l,mid:u}})}createUnmuteMessage(e){return e.map(t=>{var r;let n,[i,{track:o,ssrcs:l,id:u}]=t;switch(i){case Mt.LocalAudioTrack:n=un.Audio;break;case Mt.LocalVideoTrack:n=Qt(r=o._hints).call(r,Nn.SCREEN_TRACK)?un.Screen:un.High;break;case Mt.LocalVideoLowTrack:n=un.Low}return{stream_type:n,ssrcs:l,mid:u}})}filterTobeUnSubscribedTracks(e,t){let r=[],n=this.remoteUserMap.get(e);if(!n)return r;if(t){let i=n.get(t);if(!i)return r;r.push([e,{kind:t,id:i}])}else Array.from(n.entries()).forEach(i=>{let[o,l]=i;r.push([e,{kind:o,id:l}])});return r}createUnsubscribeMessage(e){let t=[];return e.forEach(r=>{let[n,{kind:i,id:o}]=r;switch(i){case lr.VIDEO:return void(n._videoSSRC&&t.push({stream_type:lr.VIDEO,ssrcId:n._videoSSRC}));case lr.AUDIO:return void(n._audioSSRC&&t.push({stream_type:lr.AUDIO,ssrcId:n._audioSSRC}))}}),t}withdrawRemoteTracks(e){e.forEach(t=>{let[r,{kind:n}]=t,i=this.remoteUserMap.get(r);i&&(i.delete(n),Array.from(i.entries()).length===0&&this.remoteUserMap.delete(r))})}async updateBitrateLimit(e){let t=this.localTrackMap.get(Mt.LocalVideoTrack),r=this.localTrackMap.get(Mt.LocalVideoLowTrack);t&&(await t.track.setBitrateLimit(e.uplink),await new tr((n,i)=>{this.handleUpdateVideoEncoder(t.track,n,i,!0)})),r&&e.low_stream_uplink&&(await r.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new tr((n,i)=>{this.handleUpdateVideoEncoder(r.track,n,i,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){let e=this.sendConnection.peerConnectionState,t=this.recvConnection.peerConnectionState;return e!=="connected"&&t!=="connected"}return!0}async tryToUnmuteAudio(e){for(let t=0;t<e.length;t++)if(e[t]instanceof ei){let r=this.filterTobeUnmutedTracks(e[t]);if(r.length===0)continue;let n=this.createUnmuteMessage(r);return void await bn(this,Cr.RequestUnmuteLocal,n)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:t}]=e;return!!t}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.recvConnection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Cr.RequestUpload,e,t),this.statsUploader.requestUploadStats=e=>this.emit(Cr.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Yi(lA(this.dtlsFailedCount,vi)),this.emit(Cr.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(Mt.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof xn)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof xn).length>1)throw new Et(ce.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof ei).length>1&&(e.some(t=>t instanceof ei&&t._bypassWebAudio)||!rn().webAudioMediaStreamDest))throw new Et(ce.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(let t of e){if(t instanceof xn&&this.pendingLocalTracks.some(r=>r instanceof xn))throw new Et(ce.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof ei&&this.pendingLocalTracks.some(r=>r instanceof ei)&&(!rn().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(r=>r instanceof ei&&r._bypassWebAudio)))throw new Et(ce.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){let r=!Se("DISABLE_DUAL_STREAM_USE_ENCODING")&&rn().supportDualStreamEncoding,n=c0(c0({},{width:160,height:120,framerate:15,bitrate:50}),t),i;i=r?e._mediaStreamTrack.clone():gb(e,n);let o=On(8,"track-low-"),l=new xn(i,c0(c0({},r&&{scaleResolutionDownBy:eb(n,e)}),{},{frameRate:n.framerate,bitrateMax:n.bitrate,bitrateMin:n.bitrate}),void 0,void 0,o);return l.on(Op.TRANSCEIVER_UPDATED,u=>{e._updateRtpTransceiver(u,nE.LOW_STREAM)}),l._hints.push(Nn.LOW_STREAM),e.addListener(hr.NEED_CLOSE,()=>{l.close()}),l}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,t,r,n){var i;let o=Array.from(Mo(i=this.remoteUserMap).call(i)).find(l=>l._videoSSRC===e);if(o){n||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());let l=this.store.keyMetrics,u=l.subscribe.find(h=>h.userId===o.uid&&h.type==="video");gr.firstRemoteVideoDecode(this.store.sessionId,Pi.FIRST_VIDEO_DECODE,Hn.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:r,subscribeElapse:fa.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:l.requestAPEnd||0,apStart:l.requestAPStart||0,joinGwEnd:l.joinGatewayEnd||0,joinGwStart:l.joinGatewayStart||0,pcEnd:l.peerConnectionEnd||0,pcStart:l.peerConnectionStart||0,subscriberEnd:u?.subscribeEnd||0,subscriberStart:u?.subscribeStart||0,videoAddNotify:u?.streamAdded||0,state:n?1:0})}}async remoteMediaSsrcChanged(e,t,r){if(!this.recvConnection)return!1;let n=this.remoteUserMap.get(e);if(!n)return!1;let i=n.get(t);if(!i)return!1;let o=await this.recvConnection.getRemoteSSRC(i);return o!==void 0&&o!==r}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new Et(ce.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new Et(ce.NOT_SUPPORTED)}async subscribeDataChannel(e,t){throw new Et(ce.NOT_SUPPORTED)}async unsubscribeDataChannel(e,t){throw new Et(ce.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,t){throw new Et(ce.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,t){throw new Et(ce.NOT_SUPPORTED)}async preConnect(e){throw new Et(ce.NOT_SUPPORTED)}getEstablishParams(){throw new Et(ce.NOT_SUPPORTED)}async reSubscribe(e){throw new Et(ce.NOT_SUPPORTED)}async updateVideoStreamParameter(e,t){throw new Et(ce.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:r}]=e;t===Mt.LocalVideoLowTrack?r._updateRtpTransceiver(void 0,nE.LOW_STREAM):r._updateRtpTransceiver(void 0)})}},_r(Kn.prototype,"p2pConnect",[Px],Object.getOwnPropertyDescriptor(Kn.prototype,"p2pConnect"),Kn.prototype),_r(Kn.prototype,"unpublish",[Lx],Object.getOwnPropertyDescriptor(Kn.prototype,"unpublish"),Kn.prototype),_r(Kn.prototype,"unpublishLowStream",[kx],Object.getOwnPropertyDescriptor(Kn.prototype,"unpublishLowStream"),Kn.prototype),_r(Kn.prototype,"subscribe",[Mx],Object.getOwnPropertyDescriptor(Kn.prototype,"subscribe"),Kn.prototype),_r(Kn.prototype,"mockSubscribe",[Ux],Object.getOwnPropertyDescriptor(Kn.prototype,"mockSubscribe"),Kn.prototype),_r(Kn.prototype,"unsubscribe",[xx],Object.getOwnPropertyDescriptor(Kn.prototype,"unsubscribe"),Kn.prototype),_r(Kn.prototype,"muteRemote",[jx],Object.getOwnPropertyDescriptor(Kn.prototype,"muteRemote"),Kn.prototype),_r(Kn.prototype,"unmuteRemote",[Bx],Object.getOwnPropertyDescriptor(Kn.prototype,"unmuteRemote"),Kn.prototype),_r(Kn.prototype,"hasRemoteMediaWithLock",[Vx],Object.getOwnPropertyDescriptor(Kn.prototype,"hasRemoteMediaWithLock"),Kn.prototype),_r(Kn.prototype,"disconnectForReconnect",[Fx],Object.getOwnPropertyDescriptor(Kn.prototype,"disconnectForReconnect"),Kn.prototype),_r(Kn.prototype,"remoteMediaSsrcChanged",[Gx],Object.getOwnPropertyDescriptor(Kn.prototype,"remoteMediaSsrcChanged"),Kn.prototype),Kn);function Kc(e){return function(t,r,n){let i=t[r];if(typeof i!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){for(var o=arguments.length,l=new Array(o),u=0;u<o;u++)l[u]=arguments[u];switch(e){case Wc.SEND_ONLY:{let h=await this.sendMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,l)}finally{h()}}case Wc.RECEIVE_ONLY:{let h=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,l)}finally{h()}}default:{let h=await this.sendMutex.lock("From P2PChannel2.".concat(r)),m=await this.recvMutex.lock("From P2PChannel2.".concat(r));try{return await i.apply(this,l)}finally{h(),m()}}}},n}}class Xp extends zn{constructor(t,r){super(),ie(this,"signal",void 0),ie(this,"token",void 0),ie(this,"tokenTimeout",void 0),ie(this,"tokenInterval",void 0),ie(this,"_sequence",0),ie(this,"userMap",new Map),ie(this,"encoder",new TextEncoder),this.signal=t,this.token=r;let n=()=>{this.signal.connectionState===Pn.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(n,1e3):this.tokenInterval=window.setTimeout(n,3*Se("P2P_TOKEN_INTERVAL"))};n()}async send(t,r,n,i,o){var l,u,h;if(this.userMap.size===0)return;let m=Array.from(ro(l=this.userMap).call(l))[0].token;typeof r!="string"&&(r=JSON.stringify(r)),i=(u=i)!==null&&u!==void 0?u:On(6,""),o=(h=o)!==null&&h!==void 0?h:this._sequence++;let _={_id:i,_type:t,_seq:o,_message:r,token:"".concat(this.token,"_").concat(m)};Se("SHOW_P2P_LOG")&&L.debug("send message",_,"noNeedResponse : ".concat(n)),this.splitMessage(JSON.stringify(_)).forEach(A=>{this.signal.request(Dr.DATA_STREAM,{payload:Kd(this.encoder.encode(A))})});let R=new tr((A,D)=>{let J=window.setTimeout(()=>{this.off("res-@".concat(i,"_ack"),V),this.off("res-@".concat(i),se),this.off(EE.ABORT,K),L.debug("[external-signal] request timeout, type: ".concat(t,", requestId: ").concat(i)),this.userMap.size===0?D(new Et(ce.INVALID_REMOTE_USER)):D(new Et(ce.TIMEOUT))},Se("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),V=()=>{J&&window.clearTimeout(J),this.off(EE.ABORT,K),n&&A()},K=()=>{J&&window.clearTimeout(J),this.off("res-@".concat(i,"_ack"),V),this.off("res-@".concat(i),se),D(new Et(ce.EXTERNAL_SIGNAL_ABORT,"type: ".concat(t,", requestId: ").concat(i)))};this.once(EE.ABORT,K),this.once("res-@".concat(i,"_ack"),V);let se=(De,ze)=>{ue=!0,J&&window.clearTimeout(J),this.off("res-@".concat(i,"_ack"),V),this.off(EE.ABORT,K),De==="success"?A(ze):D(new Et(ce.P2P_MESSAGE_FAILED,"request ".concat(t," failed, requestId: ").concat(i)))},ue=!1;n||(this.once("res-@".concat(i),se),Yi(Se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{ue||L.warning("external_signal request timeout, type: ".concat(t,", requestId: ").concat(i,", ").concat(_))}))});try{return await R}catch(A){if(A.code===ce.TIMEOUT)return await this.send(t,r,n,i,o);throw A}}onMessage(t){var r;let{_uid:n}=t,i,o=this.userMap.get(n);if(o)i=o.splitMessageMap;else{if(this.userMap.size>0||!("_type"in t)||t._type!==oi.CHECK)return;let{token:m}=t;i=new Map,o={uid:n,isStart:!0,token:m,splitMessageMap:i,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(n,o),this.signal.emit(Wr.ON_USER_ONLINE,{uid:n}),this.handleUserOnline()}if("id"in t&&"total"in t){var l;let{id:m,total:_}=t,R=(l=i.get(m))!==null&&l!==void 0?l:[];if(R.push(t),i.has(m)||i.set(m,R),R.length!==_)return;{let A=Ng(R).call(R,(D,J)=>D.index-J.index).map(D=>D.payload).join("");i.delete(m),(t=JSON.parse(A))._uid=n}}let{_type:u,token:h}=t;if(Qt(r=[oi.ACK,oi.CHECK]).call(r,u))return u===oi.CHECK&&this.handleCheckToken(o,h),void this.receiveMessage(t);h==="".concat(o.token,"_").concat(this.token)?this.handleReceivedMessage(t):L.debug('Receive unexpected message", '.concat(h,", cur_token: ").concat(o.token,"_").concat(this.token),t)}check(){let t={_id:On(6,""),token:this.token,_type:oi.CHECK};Se("SHOW_P2P_LOG")&&L.debug("send message",t),this.signal.request(Dr.DATA_STREAM,{payload:Kd(this.encoder.encode(JSON.stringify(t)))})}ack(t){let r={_id:t,_type:oi.ACK,token:this.token};Se("SHOW_P2P_LOG")&&L.debug("send message",r),this.signal.request(Dr.DATA_STREAM,{payload:Kd(this.encoder.encode(JSON.stringify(r)))})}response(t,r,n){this.send(oi.RESPONSE,JSON.stringify({success:!n,message:r}),!0,t)}handleReceivedMessage(t){let r=()=>{this.userMap.forEach(m=>{let{receivedMessagesMap:_,nextExpectedSequenceNumber:R}=m;for(;_.has(R);){let A=_.get(R);_.delete(R),this.receiveMessage(A),m.nextExpectedSequenceNumber++}})};if(!t)return void r();let{_uid:n,_seq:i}=t,o=this.userMap.get(n),{receivedMessagesMap:l,isStart:u,nextExpectedSequenceNumber:h}=o;if(i<h)return this.ack(t._id),void L.debug("[external-signal] receive old message, seq: ".concat(i,", ").concat(t._message));l.set(i,t),u&&i===h&&(this.receiveMessage(t),l.delete(h),o.nextExpectedSequenceNumber++,r())}receiveMessage(t){let{_id:r,_type:n,_message:i,_uid:o}=t;if(Se("SHOW_P2P_LOG")&&L.debug("receive message",t),r){let l;switch(t._type!==oi.ACK&&(i&&(l=JSON.parse(i)),this.ack(t._id)),t._type){case oi.CANDIDATE:case oi.CONTROL:this.signal.emit(n,l,o);break;case oi.PUBLISH:case oi.UNPUBLISH:case oi.RESTART_ICE:case oi.CALL:l.uid=o,ia(this.signal,n,l).then(u=>{this.response(t._id,u)}).catch(()=>{this.response(t._id,void 0,!0)});break;case oi.ACK:this.getListeners("res-@".concat(r,"_ack")).length>0&&this.emit("res-@".concat(r,"_ack"));break;case oi.RESPONSE:{let{success:u,message:h}=l;this.emit("res-@".concat(r),u?"success":"failed",h);break}}}}splitMessage(t){if(t.length<Xp.MAX_MESSAGE_SIZE)return[t];let r=[],{remoteToken:n}=JSON.parse(t),i=On(6,""),o=0,l=800,u=Math.ceil(t.length/l);for(;t.length>0;){o++;let h={id:i,index:o,total:u,payload:t.slice(0,l),token:"".concat(this.token,"_").concat(n)};JSON.stringify(h).length>Xp.MAX_MESSAGE_SIZE?l-=50:(r.push(h),t=t.slice(l))}return r.map(h=>JSON.stringify(h))}handleCheckToken(t,r){return t.token!==r?(L.debug("token changed, from ".concat(t.token," to ").concat(r)),this.reset(t.uid,r),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{L.debug("token timeout, ".concat(r)),this.reset(t.uid)},Se("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){let t=await ia(this.signal,oi.CALL,void 0),r=await this.send(oi.CALL,t);this.signal.emit(Lr.P2P_CONNECTION,r,!0)}async reset(t,r){let n=this.userMap.get(t);n&&(this.emit(EE.ABORT),this.signal.emit(Wr.ON_USER_OFFLINE,{uid:n.uid,reason:nG.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),r||(L.debug("change local token from ".concat(r," to ").concat(r)),this.token=On(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(EE.ABORT)}}ie(Xp,"MAX_SIZE",1),ie(Xp,"MAX_MESSAGE_SIZE",1024);class B8 extends zn{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===Pn.CONNECTED?this.emit(Lr.WS_CONNECTED):t===Pn.RECONNECTING?this.emit(Lr.WS_RECONNECTING,this._websocketReconnectReason):t===Pn.CLOSED&&this.emit(Lr.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,r){super(),ie(this,"_disconnectedReason",void 0),ie(this,"_websocketReconnectReason",void 0),ie(this,"_connectionState",Pn.CLOSED),ie(this,"reconnectToken",void 0),ie(this,"p2pToken",void 0),ie(this,"websocket",void 0),ie(this,"openConnectionTime",void 0),ie(this,"clientId",void 0),ie(this,"lastMsgTime",Date.now()),ie(this,"uploadCache",[]),ie(this,"uploadCacheInterval",void 0),ie(this,"rttRolling",new gP(5)),ie(this,"pingpongTimer",void 0),ie(this,"pingpongTimeoutCount",0),ie(this,"joinResponse",void 0),ie(this,"multiIpOption",void 0),ie(this,"initError",void 0),ie(this,"spec",void 0),ie(this,"store",void 0),ie(this,"_external_signal",void 0),ie(this,"onWebsocketMessage",n=>{if(n.data instanceof ArrayBuffer)return void this.emit(Lr.ON_BINARY_DATA,n.data);let i=JSON.parse(n.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(i,"_id")){let o="res-@".concat(i._id);this.emit(o,i._result,i._message)}else if(Object.prototype.hasOwnProperty.call(i,"_type")){switch(i._type){case Wr.ON_DATA_STREAM:return void this.handleDataStream(i._message);case Wr.MUTE_AUDIO:case Wr.MUTE_VIDEO:case Wr.ON_P2P_LOST:case Wr.ON_USER_ONLINE:return;case Wr.ON_USER_OFFLINE:let{uid:o}=i._message;return L.debug("[".concat(this.clientId,"] user-offline uid: ").concat(o)),void this._external_signal.reset(o)}if(this.emit(i._type,i._message),i._type===Wr.ON_NOTIFICATION&&this.handleNotification(i._message),i._type===Wr.ON_USER_BANNED)switch(i._message.error_code){case 14:this.close(cn.UID_BANNED);break;case 15:this.close(cn.IP_BANNED);break;case 16:this.close(cn.CHANNEL_BANNED)}if(i._type===Wr.ON_USER_LICENSE_BANNED)switch(i._message.error_code){case br.ERR_LICENSE_MISSING:this.close(cn.LICENSE_MISSING);break;case br.ERR_LICENSE_EXPIRED:this.close(cn.LICENSE_EXPIRED);break;case br.ERR_LICENSE_MINUTES_EXCEEDED:this.close(cn.LICENSE_MINUTES_EXCEEDED);break;case br.ERR_LICENSE_PERIOD_INVALID:this.close(cn.LICENSE_PERIOD_INVALID);break;case br.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(cn.LICENSE_MULTIPLE_SDK_SERVICE);break;case br.ERR_LICENSE_ILLEGAL:this.close(cn.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=r,this.websocket=new QA("gateway-".concat(this.clientId),this.spec.retryConfig,!0,Se("JOIN_GATEWAY_USE_DUAL_DOMAIN"),Se("JOIN_GATEWAY_USE_443PORT_ONLY"),r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===Pn.CONNECTED&&this.reconnect("retry",na.OFFLINE)}),this.p2pToken=On(6,""),this._external_signal=new Xp(this,this.p2pToken)}async request(t,r,n,i){let o=On(6,""),l={_id:o,_type:t,_message:r},u=this.websocket.connectionID,h=()=>new tr((J,V)=>{if(this.connectionState===Pn.CONNECTED)return J();let K=()=>{this.off(Lr.WS_CLOSED,se),J()},se=()=>{this.off(Lr.WS_CONNECTED,K),V(new Et(ce.WS_ABORT))};this.once(Lr.WS_CONNECTED,K),this.once(Lr.WS_CLOSED,se)});if(this.connectionState!==Pn.CONNECTING&&this.connectionState!==Pn.RECONNECTING||t===Dr.JOIN||t===Dr.REJOIN||await h(),this.websocket.sendMessage(l,!0),i)return;let m=new tr((J,V)=>{let K=!1,se=(De,ze)=>{K=!0,J({isSuccess:De==="success",message:ze||{}}),this.off(Lr.WS_CLOSED,ue),this.off(Lr.WS_RECONNECTING,ue),this.emit(Lr.REQUEST_SUCCESS,t,r)};this.once("res-@".concat(o),se);let ue=()=>{V(new Et(ce.WS_ABORT,"type: ".concat(t))),this.off(Lr.WS_CLOSED,ue),this.off(Lr.WS_RECONNECTING,ue),this.off("res-@".concat(o),se)};this.once(Lr.WS_CLOSED,ue),this.once(Lr.WS_RECONNECTING,ue),Yi(Se("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||K||(L.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Lr.REQUEST_TIMEOUT,t,r))})}),_=null;try{_=await m}catch(J){if(this.connectionState===Pn.CLOSED||t===Dr.LEAVE)throw new Et(ce.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?J.throw():t===Dr.JOIN||t===Dr.REJOIN?null:(await h(),await this.request(t,r))}if(_.isSuccess)return _.message;let R=Number(_.message.error_code||_.message.code),A=tv(R),D=new Et(ce.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(_.message.error_str),{code:R,data:_.message,desc:A.desc});return A.action==="success"?_.message:(L.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(R,", message: ").concat(A.desc,", action: ").concat(A.action)),R===br.ERR_TOO_MANY_BROADCASTERS?((t===Dr.JOIN||t===Dr.REJOIN)&&(this.initError=D,this.close()),D.throw()):A.action==="failed"?D.throw():A.action==="quit"?(this.initError=D,this.close(),D.throw()):(R===br.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=_.message.option,L.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",na.MULTI_IP)):this.reconnect(A.action,na.SERVER_ERROR),t===Dr.JOIN||t===Dr.REJOIN?null:await this.request(t,r)))}waitMessage(t,r){return new tr(n=>{let i=o=>{(!r||r(o))&&(this.off(t,i),n(o))};this.on(t,i)})}uploadWRTCStats(t){if(!this.store.sessionId)return void L.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));let r={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:t};this.upload($g.WRTC_STATS,r)}upload(t,r){let n={_type:t,_message:r};try{this.websocket.sendMessage(n)}catch{let i=Se("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>i&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==Pn.CONNECTED)return;let o=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(o._type,o._message)},Se("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,r){let n={_type:t,_message:r};this.websocket.sendMessage(n)}async sendExtensionMessage(t,r,n){return await this._external_signal.send(t,r,n)}init(t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new tr((r,n)=>{this.once(Lr.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Lr.WS_CLOSED,()=>n(this.initError||new Et(ce.WS_ABORT))),this.connectionState=Pn.CONNECTING,this.websocket.init(t).catch(n)})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=t||cn.LEAVE,this.connectionState=Pn.CLOSED,L.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=On(6,""),this._external_signal.clear(),this._external_signal=new Xp(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(Lr.ABORT_P2P_EXECUTION);let t=await ia(this,Lr.REQUEST_JOIN_INFO),r=await this.request(Dr.JOIN,t);if(!r)return this.emit(Lr.REPORT_JOIN_GATEWAY,ce.TIMEOUT,this.url||""),!1;this.joinResponse=r,this.emit(Lr.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Pn.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(t,r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,r)}handleDataStream(t){try{var r;let n=Ip(t.payload),i=new TextDecoder().decode(n),o=JSON.parse(i);"total"in o&&"id"in o||Qt(r=Object.values(oi)).call(r,o._type)?(o._uid=t.uid,this._external_signal.onMessage(o)):this.emit(Wr.ON_DATA_STREAM,t)}catch{this.emit(Wr.ON_DATA_STREAM,t)}}handleNotification(t){L.debug("[".concat(this.clientId,"] receive notification: "),t);let r=tv(t.code);if(r.action!=="success"){if(r.action!=="failed")return r.action==="quit"?(r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(cn.UID_BANNED),void this.close()):void this.reconnect(r.action,na.SERVER_ERROR);L.error("[".concat(this.clientId,"] ignore error: "),r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;let t=Se("PING_PONG_TIME_OUT"),r=Date.now();this.pingpongTimeoutCount>=t&&(L.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(r-this.lastMsgTime,"ms")),r-this.lastMsgTime>Se("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",na.TIMEOUT):this.request(Dr.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;let n=Date.now()-r;this.rttRolling.add(n),Se("REPORT_STATS")&&this.send(Dr.PING_BACK,{pingpongElapse:n})}).catch(n=>{})}handleWebsocketEvents(){this.websocket.on(Ur.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Lr.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ur.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ur.CLOSED,()=>{this.connectionState=Pn.CLOSED}),this.websocket.on(Ur.FAILED,()=>{this._disconnectedReason=cn.NETWORK_ERROR,this.connectionState=Pn.CLOSED}),this.websocket.on(Ur.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===Pn.CONNECTED?this.connectionState=Pn.RECONNECTING:this.connectionState=Pn.CONNECTING}),this.websocket.on(Ur.WILL_RECONNECT,(t,r,n)=>{t!=="retry"?(L.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0):L.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),n(t)}),this.websocket.on(Ur.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(t=>{if(this.emit(Lr.REPORT_JOIN_GATEWAY,t,this.url||""),t instanceof Et&&t.code===ce.UNEXPECTED_RESPONSE&&t.data.code===br.ERR_NO_AUTHORIZED)return L.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",na.SERVER_ERROR);L.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",na.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ur.REQUEST_NEW_URLS,(t,r)=>{ia(this,Lr.REQUEST_RECOVER,this.multiIpOption).then(t).catch(r)}),this.websocket.on(Ur.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Wr.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}let V8={name:"P2PChannel",create:function(e){let{store:t,statsCollector:r}=e;return new j8(t,r)},createSubmodule:function(e){let{store:t,spec:r}=e;return new B8(r,t)}};function Wx(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function Kx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Wx(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}class F8{constructor(t){ie(this,"sessionDesc",void 0),ie(this,"localCapabilities",void 0),ie(this,"rtpCapabilities",void 0),ie(this,"candidates",void 0),ie(this,"_originCandidates",void 0),ie(this,"iceParameters",void 0),ie(this,"dtlsParameters",void 0),ie(this,"setup",void 0),ie(this,"currentMidIndex",void 0),ie(this,"cname",void 0),t=Zn(t);let{iceParameters:r,dtlsParameters:n,candidates:i,rtpCapabilities:o,setup:l,localCapabilities:u,sdkCodec:h,cname:m}=t,_=ao(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=o,this.candidates=i,this._originCandidates=Zn(i),this.iceParameters=r,this.dtlsParameters=n,this.setup=l,this.localCapabilities=u,this.cname=m;for(let R=0;R<_.mediaDescriptions.length;R++){let A=_.mediaDescriptions[R];if(A.attributes.iceUfrag=r.iceUfrag,A.attributes.icePwd=r.icePwd,A.attributes.fingerprints=n.fingerprints,A.attributes.candidates=i,A.attributes.setup=l,A.media.mediaType==="video"){A.media.fmts=o.videoCodecs.map(J=>J.payloadType.toString(10));let D=o.videoCodecs.filter(J=>{var V,K;return(V=J.rtpMap)===null||V===void 0?void 0:Qt(K=V.encodingName.toLowerCase()).call(K,h)});D.length===0&&(D=o.videoCodecs),A.attributes.payloads=D,A.attributes.extmaps=o.videoExtensions}A.media.mediaType==="audio"&&(A.media.fmts=o.audioCodecs.map(D=>D.payloadType.toString(10)),A.attributes.payloads=o.audioCodecs,A.attributes.extmaps=o.audioExtensions),_.mediaDescriptions[R]=this.mungMediaDesc(A)}this.sessionDesc=_,this.currentMidIndex=_.mediaDescriptions.length-1}toString(){return zd(this.sessionDesc)}send(t,r,n){let{ssrcs:i,ssrcGroups:o}=Mp(r,this.cname),l=this.sessionDesc.mediaDescriptions.find(m=>t===lr.VIDEO?m.media.mediaType==="video":m.media.mediaType==="audio"),u=i[0].attributes.label,h=i[0].attributes.mslabel;return l.attributes.ssrcs=l.attributes.ssrcs.concat(i),l.attributes.ssrcGroups=l.attributes.ssrcGroups.concat(o),{id:u,mslabel:h}}batchSend(t){return t.map(r=>{let{kind:n,ssrcMsg:i}=r;return this.send(n,i,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(r=>{let n=[],i=[],o=[];r.attributes.ssrcs.forEach(l=>{Qt(t).call(t,l.attributes.label||"")?o.push(l):n.push(l)}),r.attributes.ssrcGroups.forEach(l=>{var u;Qt(u=o.map(h=>h.ssrcId)).call(u,l.ssrcIds[0])||i.push(l)}),r.attributes.ssrcs=n,r.attributes.ssrcGroups=i})}mute(t){let r=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));r.attributes.direction="inactive"}unmute(t){let r=this.sessionDesc.mediaDescriptions.find(n=>n.attributes.mid===t);if(!r)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));r.attributes.direction="sendonly"}receive(t,r,n){t.forEach((i,o)=>{let l=i._mediaStreamTrack,u=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===l.kind),h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],i);this.sessionDesc.mediaDescriptions[u]=h})}stopReceiving(t){}updateCandidates(t){let r=this._originCandidates.filter(i=>i.transport==="udp"),n=[];if(r.forEach(i=>{n.push(Kx(Kx({},i),{},{foundation:"tcpcandidate",priority:Number(i.priority)-1+"",transport:"tcp",port:Number(i.port)+90+""}))}),r.length!==0){switch(t){case pa.TCP_RELAY:this.candidates=n;break;case pa.UDP_TCP_RELAY:case pa.RELAY:this.candidates=[...r,...n];break;default:this.candidates=r}for(let i of this.sessionDesc.mediaDescriptions)i.attributes.candidates=this.candidates}}restartICE(t){t=Zn(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=t.iceUfrag,r.attributes.icePwd=t.icePwd})}predictReceivingMids(t){let r=[];for(let n=0;n<t;n++)r.push((this.currentMidIndex+n+1).toString(10));return r}mungRecvMediaDsec(t,r){let n=Zn(t);return vE(n,r),rb(n,r),n}updateRecvMedia(t,r){let n=this.sessionDesc.mediaDescriptions.findIndex(i=>i.attributes.mid===t);if(n!==-1){let i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],r);this.sessionDesc.mediaDescriptions[n]=i}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,r,n){let i=this.sessionDesc.mediaDescriptions.find(l=>t===lr.VIDEO?l.attributes.mid==="video":l.attributes.mid==="audio");if(i){let l=i.attributes.ssrcs.find(u=>u.attributes.label===r);var o;l&&(l.attributes.label=n,(o=l.attributes.msid)===null||o===void 0||o.replace(r,n))}}mungMediaDesc(t){let r=Zn(t);return tb(r),function(n){let i=n.attributes.extmaps.find(o=>CR(o.extensionName));i&&n.attributes.extmaps.splice(n.attributes.extmaps.indexOf(i),1),n.attributes.payloads.forEach(o=>{let l=o.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");l!==-1&&o.rtcpFeedbacks.splice(l,1)})}(r),r}getSSRC(t){for(let r of this.sessionDesc.mediaDescriptions)for(let n of r.attributes.ssrcs)if(n.attributes.label===t)return[n]}}var Sn;function zx(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function l0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?zx(Object(r),!0).forEach(function(n){ie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}let G8=(Sn=class Uv extends eM{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").filter(t=>{var r;return Qt(r=Object.keys($S)).call(r,t)}))]}constructor(t,r){super(t,r),ie(this,"store",void 0),ie(this,"peerConnection",void 0),ie(this,"remoteSDP",void 0),ie(this,"initialOffer",void 0),ie(this,"statsFilter",void 0),ie(this,"useRTX",!1),ie(this,"localCapabilities",void 0),ie(this,"localCandidateCount",0),ie(this,"allCandidatesReceived",!1),ie(this,"establishPromise",void 0),ie(this,"mutex",void 0),this.store=r,this.mutex=new da("P2PConnection-mutex",r.clientId),this.peerConnection=new RTCPeerConnection(Uv.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=mA(this.peerConnection,Se("STATS_UPDATE_INTERVAL"),void 0,Yn()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{let t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");let r=Zd(t.sdp),n=iv(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:Se("FILTER_VIDEO_FEC"),filterAudioFec:Se("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=t,l0(l0({},r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:t.sdp})}catch(t){throw new Et(ce.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async updateRemoteConnect(){}async connect(t){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new F8(l0(l0({},t),{},{rtpCapabilities:t.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));let r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(r.toString()))}}async updateRemoteRTPCapabilities(t,r){throw new Et(ce.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(t){}send(t,r){var n=this;return ds(function*(){let i=yield Qr(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");let o=t.map(A=>n.peerConnection.addTrack(A._mediaStreamTrack)),l=yield Qr(n.peerConnection.createOffer()),u=ao(l.sdp),h=t.map(A=>{let D=A._mediaStreamTrack,J=u.mediaDescriptions.find(V=>V.attributes.mid===D.kind);if(!J)throw new Error("Cannot extract ssrc from mediaDescription.");return function(V,K,se){let ue=V.attributes.ssrcs.filter(ze=>ze.attributes.label===K),De=V.attributes.ssrcGroups;if(ue.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(De&&ue.length>1){let ze=De.find(Ke=>Ke.ssrcIds.indexOf(ue[0].ssrcId)!==-1);return ze?[{ssrcId:ze.ssrcIds[0],rtx:se?ze.ssrcIds[1]:void 0}]:[{ssrcId:ue[0].ssrcId}]}return[{ssrcId:ue[0].ssrcId}]}(J,D.id,n.useRTX)}),m;try{m=yield h}catch(A){throw o.forEach(D=>{ra()&&D.replaceTrack(null),n.peerConnection.removeTrack(D)}),A}let _=n.mungSendOfferSDP(l.sdp,t);n.remoteSDP.receive(t,r,m);let R=n.remoteSDP.toString();return yield Qr(n.peerConnection.setLocalDescription({type:"offer",sdp:_})),yield Qr(n.applySendEncodings(o,t)),yield Qr(n.peerConnection.setRemoteDescription({type:"answer",sdp:R})),t.map((A,D)=>{let J=A._mediaStreamTrack.id;return{localSSRC:h[D],id:J}})}catch(o){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}finally{i()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");let r=this.peerConnection.getSenders().filter(o=>{var l;return t.indexOf(((l=o.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(r.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");r.map(o=>{ra()&&o.replaceTrack(null),this.peerConnection.removeTrack(o)});let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(t);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(r.toString()))}}async receive(t,r,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));let{id:o,mslabel:l}=this.remoteSDP.send(t,r,i),u=new tr((_,R)=>{let A=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(o)))},1e4),D=J=>{let V=$r();if((V.name==="Safari"&&Number(V.version)===11||Pa())&&J.track.id!==o&&J.streams[0].id===l){var K;let se=J.streams[0].getTracks()[0];return(K=this.remoteSDP)===null||K===void 0||K.updateTrackLabel(t,o,J.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(A),void _(se)}if(J.track.id===o)return this.peerConnection.removeEventListener("track",D),clearTimeout(A),void _(J.track)};this.peerConnection.addEventListener("track",D)}),h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});let m=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(m),{track:await u,id:o}}catch(o){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);let r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});let n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(r.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(n=>{var i;return t.indexOf(((i=n.track)===null||i===void 0?void 0:i.id)||"")!==-1});if(r.length!==t.length)throw new Error("sender' length doesn't match mids' length.");r.map(n=>{if(ra()&&n.track)n.track.enabled=!1;else{let i=n.getParameters();i.encodings.forEach(o=>o.active=!1),n.setParameters(i)}})}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(r.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");let r=this.peerConnection.getSenders().filter(o=>{var l;return t.indexOf(((l=o.track)===null||l===void 0?void 0:l.id)||"")!==-1});if(r.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");r.map(async o=>{if(ra()&&o.track)o.track.enabled=!0;else{let l=o.getParameters();l.encodings.forEach(u=>u.active=!0),await o.setParameters(l)}});let n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);let i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(r.toString()))}}restartICE(t){var r=this;return ds(function*(){let n=yield Qr(r.mutex.lock("From P2PConnection.restartICE"));try{if(!r.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");let i=rn().supportPCSetConfiguration;if(t===pa.RELAY&&!i)return;if(i){let m=r.peerConnection.getConfiguration(),_=t===pa.RELAY?"relay":"all";m.iceTransportPolicy!==_&&(L.debug("[".concat(r.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(_,"]")),m.iceTransportPolicy=_,r.peerConnection.setConfiguration(m))}t!==pa.RELAY&&r.remoteSDP.updateCandidates(t);let o=yield Qr(r.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");let l=Zd(o.sdp),{remoteIceParameters:u}=yield l.iceParameters;r.remoteSDP.restartICE(u);let h=r.remoteSDP.toString();yield Qr(r.peerConnection.setLocalDescription(o)),yield Qr(r.peerConnection.setRemoteDescription({type:"answer",sdp:h}))}catch(i){L.warning("[".concat(r.store.clientId,"] restart ICE failed, abort operation"),i)}finally{n()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");let n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[r]);this.remoteSDP.updateRecvMedia(r._mediaStreamTrack.kind,r);let o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new Et(ce.EXCHANGE_SDP_FAILED,n.toString())}}async updateSendParameters(t,r){let n=this.peerConnection.getSenders().filter(i=>{var o;return((o=i.track)===null||o===void 0?void 0:o.id)===t});n.length===1&&await this.applySendEncodings(n,[r])}setStatsRemoteVideoIsReady(t,r){this.statsFilter.setVideoIsReady2(t,r)}async replaceTrack(t,r){let n=this.peerConnection.getSenders().find(i=>{var o;return((o=i.track)===null||o===void 0?void 0:o.id)===r});n&&await n.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,r){throw new Et(ce.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Et(ce.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,L.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Se("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){let r={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?r.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&(Kg(t.turnServer.servers)?r.iceServers=t.turnServer.servers:(r.iceServers&&r.iceServers.push(...Uv.turnServerConfigToIceServers(t.turnServer.servers)),Se("USE_TURN_SERVER_OF_GATEWAY")&&r.iceServers&&t.turnServer.serversFromGateway&&r.iceServers.push(...Uv.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(n=>{n.forceturn&&(r.iceTransportPolicy="relay")}))),r}static turnServerConfigToIceServers(t){let r=[];return t.forEach(n=>{n.security?n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turns:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}):(n.udpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.udpport,"?transport=udp")}),n.tcpport&&r.push({username:n.username,credential:n.password,credentialType:"password",urls:"turn:".concat(n.turnServerURL,":").concat(n.tcpport,"?transport=tcp")}))}),r}async updateRtpSenderEncodings(t,r){var n;if(r||(r=this.peerConnection.getSenders().find(m=>{var _;return((_=m.track)===null||_===void 0?void 0:_.id)===t._mediaStreamTrack.id})),!r)return L.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!rn().supportSetRtpSenderParameters)return L.warn("Browser not support set rtp-sender parameters");let i={},o={};if(t instanceof xn)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(Se("DSCP_TYPE")&&wu()){var l;let m=Se("DSCP_TYPE");Qt(l=["very-low","low","medium","high"]).call(l,m)&&(o.networkPriority=m)}let u=r.getParameters(),h=(n=u.encodings)===null||n===void 0?void 0:n[0];h&&Object.assign(h,o),Object.assign(u,i),L.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(u.encodings))),await r.setParameters(u)}async applySendEncodings(t,r){try{if(!rn().supportSetRtpSenderParameters||t.length!==r.length)return;for(let n=0;n<t.length;n++){let i=t[n],o=r[n];i&&o&&await this.updateRtpSenderEncodings(o,i)}}catch{L.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,r){let n=ao(t);return r.forEach((i,o)=>{let l=i._mediaStreamTrack,u=n.mediaDescriptions.find(h=>h.attributes.mid===l.kind);u&&vE(u,i)}),zd(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var r;(r=this.onFirstAudioReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var r;(r=this.onFirstVideoReceived)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var r;(r=this.onFirstAudioDecoded)===null||r===void 0||r.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,r,n)=>{var i;(i=this.onFirstVideoDecoded)===null||i===void 0||i.call(this,t,r,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,r)=>{var n;(n=this.onSelectedLocalCandidateChanged)===null||n===void 0||n.call(this,t,r)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,r)=>{var n;(n=this.onSelectedRemoteCandidateChanged)===null||n===void 0||n.call(this,t,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");let r=this.remoteSDP.batchSend(t).map((o,l)=>{let{id:u,mslabel:h}=o,{kind:m}=t[l];return new tr((_,R)=>{let A=setTimeout(()=>{R(new Error("Cannot receive track, id: ".concat(u)))},1e4),D=J=>{let V=$r();if(V.name==="Safari"&&Number(V.version)===11&&J.track.id!==u&&J.streams[0].id===h){var K;let se=J.streams[0].getTracks()[0];return(K=this.remoteSDP)===null||K===void 0||K.updateTrackLabel(m,u,J.track.id),this.peerConnection.removeEventListener("track",D),clearTimeout(A),void _({track:se,id:u})}if(J.track.id===u)return this.peerConnection.removeEventListener("track",D),clearTimeout(A),void _({track:J.track,id:u})};this.peerConnection.addEventListener("track",D)})}),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});let i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await tr.all(r)}catch(r){throw new Et(ce.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(r.toString()))}}async getRemoteSSRC(t){return this.remoteSDP?this.remoteSDP.getSSRC(t)?.[0].ssrcId:void 0}setConfiguration(t){if(rn().supportPCSetConfiguration){let r=Uv.resolvePCConfiguration(t);this.peerConnection.setConfiguration(r)}}},_r(Sn.prototype,"connect",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"connect"),Sn.prototype),_r(Sn.prototype,"stopSending",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"stopSending"),Sn.prototype),_r(Sn.prototype,"receive",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"receive"),Sn.prototype),_r(Sn.prototype,"stopReceiving",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"stopReceiving"),Sn.prototype),_r(Sn.prototype,"muteRemote",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"muteRemote"),Sn.prototype),_r(Sn.prototype,"unmuteRemote",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"unmuteRemote"),Sn.prototype),_r(Sn.prototype,"muteLocal",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"muteLocal"),Sn.prototype),_r(Sn.prototype,"unmuteLocal",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"unmuteLocal"),Sn.prototype),_r(Sn.prototype,"close",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"close"),Sn.prototype),_r(Sn.prototype,"updateEncoderConfig",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"updateEncoderConfig"),Sn.prototype),_r(Sn.prototype,"updateSendParameters",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"updateSendParameters"),Sn.prototype),_r(Sn.prototype,"replaceTrack",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"replaceTrack"),Sn.prototype),_r(Sn.prototype,"getRemoteSSRC",[vs],Object.getOwnPropertyDescriptor(Sn.prototype,"getRemoteSSRC"),Sn.prototype),Sn);function vs(e,t,r){let n=e[t];if(typeof n!="function")throw new Error("Cannot use mutex on object property.");return r.value=async function(){let i=this.mutex,o=await i.lock("Locking from P2PConnection.".concat(t));try{for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return await n.apply(this,u)}finally{o()}},r}let H8={name:"PlanBConnection",create:function(e){let{store:t,spec:r}=e;return new G8(r,t)}},W8={interceptLocalAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!rn().supportWebRTCEncodedTransform)return void L.warning("browser not support audio encoded transform");if(cR.has(e)||!e.track)return;let r={track:e.track};if(Nu()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(l){return void L.error("create audio-encoded-streams error",l&&l.message)}let o=new TransformStream({transform(l,u){r.controller||(r.controller=u),e.track&&e.track.id!==r.track.id&&(L.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n));let h=t.metadata&&t.metadata();h?function(m,_){let{chunk:R,controller:A}=_,D=Se("ENABLE_AUDIO_PTS_METADATA")?ku.AUDIO_64_BIT_PTS:ku.METADATA;R.data=function(J,V,K){let se=K.byteLength,ue=se+BA+jk,De=xA+jA+ue,ze=new ArrayBuffer(J.byteLength+De),Ke=new DataView(ze);Ke.setUint8(0,xk),Ke.setUint16(1,ue),Ke.setUint8(3,V),Ke.setUint16(4,se);for(let _t=0;_t<se;_t++)Ke.setUint8(6+_t,K[_t]);let Ve=new Uint8Array(Ke.buffer);return Ve.set(new Uint8Array(J),De),Ve.buffer}(R.data,D,m),A.enqueue(R)}(h,{chunk:l,controller:u}):u.enqueue(l)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if(ra()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");let i=sR(),o=new MessageChannel;await new tr(u=>i.onmessage=h=>{h.data==="registered"&&u(void 0)});let l=new RTCRtpScriptTransform(i,{name:"audio-metadata-tx",port:o.port2},[o.port2]);e.transform=l,await new tr(u=>i.onmessage=h=>{h.data==="started"&&u(void 0)}),o.port1.onmessage=u=>{var h;if(u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==r.track.id)L.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n);else if(u.data.getMetadata){let m=t.metadata&&t.metadata();m&&o.port1.postMessage({metadata:m})}},r.worker=i}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}let i=cR.get(e);if(i){cR.delete(e);try{var o,l;(o=i.controller)===null||o===void 0||o.terminate(),(l=i.worker)===null||l===void 0||l.terminate()}catch(u){L.warning(u&&u.message)}}}cR.set(e,r),e.track.addEventListener("ended",n)},interceptRemoteAudioFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!rn().supportWebRTCEncodedTransform)return void L.warning("browser not support audio encoded transform");if(fR.has(e))return;let r={track:e.track,onMetadata:t.onMetadata};if(Nu()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");ZI(an.CHROME,87,116)||(t.enableTopn=!1);let i=null;try{i=e.createEncodedStreams()}catch(l){return void L.error("create audio-encoded-streams error",l&&l.message)}let o=new TransformStream({transform(l,u){r.controller||(r.controller=u),e.track&&e.track.id!==r.track.id&&(L.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n)),t.enableTopn?function(h,m,_){var R;let A=Bk(new DataView(m.data));if(!A)return _.enqueue(m);let D=h.track.id;CF.set(D,h.track);let J=(R=A.tlv.find(ze=>ze.tag===ku.AUDIO_LEVEL))===null||R===void 0?void 0:R.value,V=0;typeof J=="number"&&(V=127-J);let K=Math.round(Math.pow(10,V/60)-1),{selected:se,speaker:ue}=function(ze,Ke){let Ve=hE.get(ze);if(Ve||(Ve=function(_t){let Vt=new Fk;return hE.set(_t,Vt),Bc||(Bc=new SF(Se("TOPN_SILENCE_THRESHOLD")||500),Bc.on("ActiveSpeakerChanged",ar=>{ar!=null&&(dR=ar)})),Bc.addSpeakers([Vt]),Vt}(ze)),hE.size<=Gk)return{selected:!0,speaker:Ve};if(!Bc)throw new Error("no active speaker detector");return Bc.levelChanged(Ve.id,Ke),Pp=Bc.loudest.map(_t=>_t.id),dR&&!Qt(Pp).call(Pp,dR)&&Pp.length>=Gk&&Pp.pop(),{selected:Qt(Pp).call(Pp,Ve.id)||Ve.id===dR,speaker:Ve}}(h,K),De=function(ze,Ke,Ve){let _t=Vc.get(ze)||new RF(ze,Ke);return _t.score=Ve,Vc.set(ze,_t),function(Vt){if(hR.set(Vt,!0),!pR)return void(pR=Date.now());let ar=Date.now();ar-pR>1e3&&(hR.get(Vt)?hR.set(Vt,!1):(Hk(Vt),hR.delete(Vt)),pR=ar)}(ze),_t}(D,h.track,ue.energyScore);De.addSample(se),De.active&&(m.data=A.frame.buffer,_.enqueue(m))}(e,l,u):t.enableMetadata?function(h,m,_){let R=Bk(new DataView(h.data));if(!R)return m.enqueue(h);let A=R.tlv.find(D=>D.tag===ku.METADATA||D.tag===ku.AUDIO_64_BIT_PTS);A&&_&&A.value instanceof Uint8Array&&_(A.value),h.data=R.frame.buffer,m.enqueue(h)}(l,u,t.onMetadata):u.enqueue(l)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if(ra()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");let i=sR(),o=new MessageChannel;await new tr(u=>i.onmessage=h=>{h.data==="registered"&&u(void 0)});let l=new RTCRtpScriptTransform(i,{name:"audio-metadata-rx",port:o.port2},[o.port2]);e.transform=l,await new tr(u=>i.onmessage=h=>{h.data==="started"&&u(void 0)}),o.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==r.track.id?(L.debug("audio track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n)):u.data.metadata&&r.onMetadata&&r.onMetadata(u.data.metadata)},r.worker=i}function n(){e.track.removeEventListener("ended",n),function(i){let o=fR.get(i);if(o){(function(h){let m=hE.get(h);m&&(hE.delete(h),Bc&&(Bc.removeSpeakers([m]),hE.size===0&&(Bc.destroy(),Bc=null)))})(i),Hk(i.track.id),fR.delete(i);try{var l,u;(l=o.controller)===null||l===void 0||l.terminate(),(u=o.worker)===null||u===void 0||u.terminate()}catch(h){L.warning(h&&h.message)}}}(e)}fR.set(e,r),e.track.addEventListener("ended",n)},interceptLocalVideoFrame:async function(e,t){if(!rn().supportWebRTCEncodedTransform)return void L.warning("browser not support video encoded transform");if(mR.has(e)||!e.track)return;let r={track:e.track};if(Nu()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(u){return void L.error("create video-encoded-streams error",u&&u.message)}let o=[];t.on("sei-to-send",u=>{o.push(u)});let l=new TransformStream({transform(u,h){r.controller||(r.controller=h),e.track&&e.track.id!==r.track.id&&(L.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n));let m=o.shift();m&&(u.data=function(_,R){let A=function(ue){let De=ue.length,ze=[],Ke=0;for(;Ke<De;)Ke+2<De&&ue[Ke]===0&&ue[Ke+1]===0&&(ue[Ke+2]===0||ue[Ke+2]===1||ue[Ke+2]===2||ue[Ke+2]===3)?(ze.push(ue[Ke],ue[Ke+1],3,ue[Ke+2]),Ke+=3):(ze.push(ue[Ke]),Ke++);return new Uint8Array(ze)}(R),D=A.length,J=Math.floor(D/255),V=D%255,K=new Uint8Array(6+J+1+D+_.byteLength);K[0]=0,K[1]=0,K[2]=0,K[3]=1,K[4]=6,K[5]=101;let se=0;for(;se<J;)K[6+se]=255,se++;return K[6+se]=V,se++,K.set(A,6+se),K.set(new Uint8Array(_),6+se+D),K.buffer}(u.data,m)),h.enqueue(u)}});i.readable.pipeThrough(l).pipeTo(i.writable)}else{if(!ra())return;{if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");let i=sR(),o=new MessageChannel;await new tr(u=>i.onmessage=h=>{h.data==="registered"&&u(void 0)});let l=new RTCRtpScriptTransform(i,{name:"sei-tx",port:o.port2},[o.port2]);e.transform=l,await new tr(u=>i.onmessage=h=>{h.data==="started"&&u(void 0)}),t.on("sei-to-send",u=>{o.port1.postMessage({sei:u})}),o.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==r.track.id&&(L.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n))},r.worker=i}}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}let i=mR.get(e);if(i){mR.delete(e);try{var o,l;(o=i.controller)===null||o===void 0||o.terminate(),(l=i.worker)===null||l===void 0||l.terminate()}catch(u){L.warning(u&&u.message)}}}mR.set(e,r),e.track.addEventListener("ended",n)},interceptRemoteVideoFrame:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!rn().supportWebRTCEncodedTransform)return void L.warning("browser not support video encoded transform");if(!e.track)return;if(Qg.has(e)){let i=Qg.get(e);return void(i&&(i.onSei=t.onSei))}let r={track:e.track,onSei:t.onSei};if(Nu()){if(!e.createEncodedStreams)return void L.warning("browser not support createEncodedStreams() API");let i=null;try{i=e.createEncodedStreams()}catch(l){return void L.error("create video-encoded-streams error",l&&l.message)}let o=new TransformStream({transform(l,u){r.controller||(r.controller=u),e.track&&e.track.id!==r.track.id&&(L.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n));let h=function(m){let _=new DataView(m.data),R=0;for(;R+4<m.data.byteLength;){if(_.getUint8(R+0)===0&&_.getUint8(R+1)===0&&_.getUint8(R+2)===0&&_.getUint8(R+3)===1&&_.getUint8(R+4)===6){let A=R+6,D=0,J=0;for(;(J=_.getUint8(A++))===255;)D+=255;D+=J;let V=IF(m.data,A,D);return new Uint8Array(V)}R++}return null}(l);h&&r.onSei&&r.onSei(h),u.enqueue(l)}});i.readable.pipeThrough(o).pipeTo(i.writable)}else if(ra()){if(typeof RTCRtpScriptTransform>"u")return void L.warning("browser not support RTCRtpScriptTransform");let i=sR(),o=new MessageChannel;await new tr(u=>i.onmessage=h=>{h.data==="registered"&&u(void 0)});let l=new RTCRtpScriptTransform(i,{name:"sei-rx",port:o.port2},[o.port2]);e.transform=l,await new tr(u=>i.onmessage=h=>{h.data==="started"&&u(void 0)}),o.port1.onmessage=u=>{var h;u.data.transformed&&e.track&&((h=e.track)===null||h===void 0?void 0:h.id)!==r.track.id?(L.debug("video track changed: ".concat(r.track.id," => ").concat(e.track.id)),r.track.removeEventListener("ended",n),r.track=e.track,r.track.addEventListener("ended",n)):u.data.sei&&r.onSei&&r.onSei(u.data.sei)},r.worker=i}function n(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",n)}(function(i){let o=Qg.get(i);if(o){Qg.delete(i);try{var l,u;(l=o.controller)===null||l===void 0||l.terminate(),(u=o.worker)===null||u===void 0||u.terminate()}catch(h){L.warning(h&&h.message)}}})(e)}Qg.set(e,r),e.track.addEventListener("ended",n)}},K8={name:"InterceptFrame",create:()=>W8};EA(),pn("PROCESS_ID","process-".concat(On(8,""),"-").concat(On(4,""),"-").concat(On(4,""),"-").concat(On(4,""),"-").concat(On(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void L.error("Error loading sdk config",t.message)}if(e)try{let t=JSON.parse(window.atob(e)),r=Date.now();L.debug("Loading global parameters from cache",t),Object.keys(t).forEach(n=>{if(Object.prototype.hasOwnProperty.call(Un,n)){let{value:i,expires:o}=t[n];if(o&&o<=r)return;jc[n]=i,Un[n]=i}})}catch(t){L.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(jc.AREAS)&&jc.AREAS.length>0&&sb(jc.AREAS,!0);let qx=(e,t,r)=>{L.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),pn(e,t,r)};Qd(f8,!1),Qd(_8,!1),Qd(JG,!1),Qd(O8,!1),Qd(d8,!1),Qd(V8,!1),Qd(H8,!1),Qd(K8,!1);let Ti=function(e){let t=new zn,r=e,n={getListeners:t.getListeners.bind(t),on:(i,o)=>(function(l,u){l===Ul.SECURITY_POLICY_VIOLATION&&AU(u,!0)}(i,o),t.on.bind(t)(i,o)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return IU(IU({},r),n)}({__TRACK_LIST__:rE,VERSION:hs,BUILD:vA,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:qx,getParameter:Se,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection,r=await async function(n){let i;return rn().supportUnifiedPlan?(n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"}),i=(await n.createOffer()).sdp):i=(await n.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,i}(t);if(!r)return e;t.close(),t=null,e=function(n){let i={video:[],audio:[]};return n.match(/ VP8/i)&&i.video.push("VP8"),n.match(/ VP9/i)&&i.video.push("VP9"),n.match(/ AV1/i)&&i.video.push("AV1"),n.match(/ H264/i)&&i.video.push("H264"),n.match(/ H265/i)&&i.video.push("H265"),n.match(/ opus/i)&&i.audio.push("OPUS"),n.match(/ PCMU/i)&&i.audio.push("PCMU"),n.match(/ PCMA/i)&&i.audio.push("PCMA"),n.match(/ G722/i)&&i.audio.push("G722"),i}(r)}catch(t){throw new at(ce.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){let e=gr.reportApiInvoke(null,{name:gi.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Jn.TRACER}),t=!1;try{let o=window.RTCPeerConnection,l=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,u=window.WebSocket;t=!!(o&&l&&u),t&&tA()&&q1(75)&&new o().close()}catch(o){return L.error("check system requirement failed: ",o),!1}let r=!1,n=$r();n.name===an.CHROME&&Number(n.version)>=58&&(Uc.engine.name!=="WebKit"||function(){let o=$r();if(WS()){if(o.os===Di.MAC_OS)return!0;if(o.os===Di.IOS){let l=Uc.os.version&&Uc.os.version.split(".");if(l&&Number(l[0])===14&&l[1]&&Number(l[1])>=3||l&&Number(l[0])>14)return!0}}return!1}())&&(r=!0),(n.name===an.FIREFOX&&Number(n.version)>=56||n.name===an.OPERA&&Number(n.version)>=45||n.name===an.SAFARI&&Number(n.version)>=11||n.name==="WebKit"&&(Pa()||zs())&&n.osVersion&&Number(n.osVersion.split(".")[0])>=11||$1()||$r().name===an.QQ)&&(r=!0),L.debug("checkSystemRequirements, api:",t,"browser",r);let i=t&&r;return e.onSuccess(i),i},getDevices:function(e){return Vo.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return Vo.getRecordingDevices(e)},getCameras:function(e){return Vo.getCamerasDevices(e)},getElectronScreenSources:qP,getPlaybackDevices:function(e){return Vo.getSpeakers(e)},createClient:function(){var e;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"},r=On(5,"client-"),n=gr.reportApiInvoke(null,{id:r,name:gi.CREATE_CLIENT,options:[t],tag:Jn.TRACER});try{(function(i){bi(i.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),bi(i.mode,"config.mode",["rtc","live","p2p"]),i.audioCodec!==void 0&&bi(i.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),i.proxyServer!==void 0&&qi(i.proxyServer,"config.proxyServer",1,1e4),i.turnServer!==void 0&&sP(i.turnServer),i.httpRetryConfig!==void 0&&oP(i.httpRetryConfig),i.websocketRetryConfig!==void 0&&oP(i.websocketRetryConfig)})(t)}catch(i){throw n.onError(i),i}return(X1(16,0)||J1(16,0,!0))&&(t.codec==="vp9"&&(t.codec="vp8",L.debug("browser not support vp9, force use vp8")),pn("UNSUPPORTED_VIDEO_CODEC",["vp9"])),t.audioCodec===void 0&&(t.audioCodec="opus"),n.onSuccess(),new ZG(ec(ec({forceWaitGatewayResponse:!0},t),{},{role:Qt(e=["rtc","p2p"]).call(e,t.mode)?"host":t.role||"audience"}),r)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Se("CAMERA_CAPTURE_CONFIG"),r=On(8,"track-cam-"),n=gr.reportApiInvoke(null,{id:r,tag:Jn.TRACER,name:gi.CREATE_CAM_VIDEO_TRACK,options:[Wn({},e),t]});t&&(e.encoderConfig=t);let i=aR(e),o=null;L.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{o=(await Bo({video:i},r)).getVideoTracks()[0]||null}catch(u){throw n.onError(u),u}if(!o){let u=new Et(ce.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(u),u.throw(L)}e.optimizationMode&&UA(r,o,e,Ll(e.encoderConfig));let l=new MA(o,e,i,e.scalabiltyMode?tR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return n.onSuccess(l.getTrackId()),L.info("create camera video success, trackId:",r),l},createCustomVideoTrack:function(e){let t=On(8,"track-cus-"),r=gr.reportApiInvoke(null,{id:t,tag:Jn.TRACER,name:gi.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new xn(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?tR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,t,[Nn.CUSTOM_TRACK]);return r.onSuccess(n.getTrackId()),L.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable",r=typeof t=="object"?function(A){return nL(A)}(t):void 0;r&&(t="auto");let n=On(8,"track-scr-v-"),i=gr.reportApiInvoke(null,{id:n,tag:Jn.TRACER,name:gi.CREATE_SCREEN_VIDEO_TRACK,options:[Wn({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";let o=function(A){let D={};A.screenSourceType&&(D.mediaSource=A.screenSourceType),A.extensionId&&Nu()&&(D.extensionId=A.extensionId);let{displaySurface:J,selfBrowserSurface:V,surfaceSwitching:K,systemAudio:se,preferCurrentTab:ue}=A;(Fg(107)||QI(107)||$I(93))&&(J&&(bi(J,"displaySurface",["browser","window","monitor"]),D.displaySurface=J),V?(bi(V,"selfBrowserSurface",["exclude","include"]),D.selfBrowserSurface=V):D.selfBrowserSurface="include",K&&(bi(K,"surfaceSwitching",["exclude","include"]),D.surfaceSwitching=K)),(Fg(105)||QI(105)||$I(91))&&se&&(bi(se,"systemAudio",["exclude","include"]),D.systemAudio=se),(Fg(94)||QI(94)||$I(80))&&ue&&(D.preferCurrentTab=!0),A.electronScreenSourceId&&(D.sourceId=A.electronScreenSourceId);let De=A.encoderConfig?CA(A.encoderConfig):null;return D.mandatory={chromeMediaSource:"desktop",maxWidth:De?De.width:void 0,maxHeight:De?De.height:void 0},De&&(De.frameRate&&(typeof De.frameRate=="number"?(D.mandatory.maxFrameRate=De.frameRate,D.mandatory.minFrameRate=De.frameRate):(D.mandatory.maxFrameRate=De.frameRate.max||De.frameRate.ideal||De.frameRate.exact||void 0,D.mandatory.minFrameRate=De.frameRate.min||De.frameRate.ideal||De.frameRate.exact||void 0),D.frameRate=De.frameRate),De.width&&(D.width=De.width),De.height&&(D.height=De.height)),D}(e),l=null,u=null,h=rn();if(!h.supportShareAudio&&t==="enable"){let A=new Et(ce.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return i.onError(A),A.throw(L)}L.info("start create screen video track with config",e,"withAudio",t,"trackId",n);let m=h.supportShareAudio&&t!=="disable";try{let A=await Bo({screen:o,screenAudio:m?r||!0:void 0},n);l=A.getVideoTracks()[0]||null,u=A.getAudioTracks()[0]||null}catch(A){throw i.onError(A),A}if(!l){let A=new Et(ce.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(A),A.throw(L)}if(!u&&t==="enable"){l&&l.stop();let A=new Et(ce.SHARE_AUDIO_NOT_ALLOWED);return i.onError(A),A.throw(L)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(UA(n,l,e,e.encoderConfig&&CA(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));let _=new xn(l,e.encoderConfig?CA(e.encoderConfig):{},e.scalabiltyMode?tR(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,n,[Nn.SCREEN_TRACK]);if(!u)return i.onSuccess(_.getTrackId()),L.info("create screen video track success","video:",_.getTrackId()),_;let R=new ei(u,void 0,On(8,"track-scr-a-"),!1);return i.onSuccess([_.getTrackId(),R.getTrackId()]),L.info("create screen video track success","video:",_.getTrackId(),"audio:",R.getTrackId()),[_,R]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=Se("CAMERA_CAPTURE_CONFIG"),n=On(8,"track-mic-"),i=On(8,"track-cam-"),o=gr.reportApiInvoke(null,{id:"".concat(n,"-").concat(i),tag:Jn.TRACER,name:gi.CREATE_MIC_AND_CAM_TRACKS,options:[e,t,r]});r&&(t.encoderConfig=r);let l=aR(t),u=iL(e),h=null,m=null;L.info("start create camera video track(".concat(i,") and microphone audio track(").concat(n,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{let A=await Bo({audio:u,video:l},"".concat(n,"-").concat(i));h=A.getAudioTracks()[0],m=A.getVideoTracks()[0]}catch(A){throw o.onError(A),A}if(!h||!m){let A=new Et(ce.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(A),A.throw(L)}t.optimizationMode&&UA(i,m,t,Ll(t.encoderConfig));let _=new oR(h,e,u,n),R=new MA(m,t,l,t.scalabiltyMode?tR(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return o.onSuccess([_.getTrackId(),R.getTrackId()]),L.info("create camera video track(".concat(i,") and microphone audio track(").concat(n,") success")),[_,R]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=On(8,"track-mic-"),r=gr.reportApiInvoke(null,{id:t,tag:Jn.TRACER,name:gi.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=iL(e),i=null;L.info("start create microphone audio track with config",JSON.stringify(e),"trackId",t);try{i=(await Bo({audio:n},t)).getAudioTracks()[0]||null}catch(l){throw r.onError(l),l}if(!i){let l=new Et(ce.UNEXPECTED_ERROR,"can not find track in media stream");return r.onError(l),l.throw(L)}let o=new oR(i,e,n,t);return r.onSuccess(o.getTrackId()),L.info("create microphone audio track success, trackId:",t),o},createCustomAudioTrack:function(e){let t=On(8,"track-cus-"),r=gr.reportApiInvoke(null,{id:t,tag:Jn.TRACER,name:gi.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new ei(e.mediaStreamTrack,e.encoderConfig?rR(e.encoderConfig):{},t,!1);return L.info("create custom audio track success with config",e,"trackId",n.getTrackId()),r.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){var t;let{cacheOnlineFile:r,encoderConfig:n}=e,{source:i}=e,o={source:i instanceof AudioBuffer?"AudioBuffer":i instanceof File?(t=File.name)!==null&&t!==void 0?t:"File":i,cacheOnlineFile:r,encoderConfig:n},l=On(8,"track-buf-"),u=gr.reportApiInvoke(null,{id:l,tag:Jn.TRACER,name:gi.CREATE_BUFFER_AUDIO_TRACK,options:[o]});if(Se("DISABLE_WEBAUDIO"))throw new Et(ce.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");L.info("start create buffer source audio track with config",JSON.stringify(o),"trackId",l);let h=i;if(!(i instanceof AudioBuffer))try{i=await async function(R,A){let D=null;if(typeof R=="string"){let V=WL.get(R);if(V)return L.debug("use cached audio resource: ",R),V;try{D=(await xc(()=>Ha.get(R,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(K){throw new Et(ce.FETCH_AUDIO_FILE_FAILED,K.toString())}}else D=await new tr((V,K)=>{let se=new FileReader;se.onload=ue=>{ue.target?V(ue.target.result):K(new Et(ce.READ_LOCAL_AUDIO_FILE_ERROR))},se.onerror=()=>{K(new Et(ce.READ_LOCAL_AUDIO_FILE_ERROR))},se.readAsArrayBuffer(R)});let J=await function(V){let K=cE();return new tr((se,ue)=>{K.decodeAudioData(V,De=>{se(De)},De=>{ue(new Et(ce.DECODE_AUDIO_FILE_FAILED,De.toString()))})})}(D);return typeof R=="string"&&A&&WL.set(R,J),J}(i,r)}catch(R){return u.onError(R),R.throw(L)}let m=new _F(i),_=new EF(h,m,n?rR(n):{},l);return L.info("create buffer source audio track success, trackId:",l),u.onSuccess(_.getTrackId()),_},setAppType:function(e){if(L.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw L.debug("Invalid appType"),new at(ce.INVALID_PARAMS,"invalid app type",e);pn("APP_TYPE",Math.floor(e))},setLogLevel:function(e){L.setLogLevel(e)},enableLogUpload:function(){Se("USE_NEW_LOG")?pn("UPLOAD_LOG",!0):L.enableLogUpload()},disableLogUpload:function(){Se("USE_NEW_LOG")?pn("UPLOAD_LOG",!1):L.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new WM},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=gr.reportApiInvoke(null,{tag:Jn.TRACER,name:gi.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof ei||e instanceof dE)){let h=new at(ce.INVALID_TRACK,"the parameter is not a audio track");return r.onError(h),h.throw()}t&&t<1e3&&(t=1e3);let n=e instanceof ei?e.getTrackLabel():"remote_track",i=e.getVolumeLevel(),o=i,l=i,u=Date.now();return new tr(h=>{let m=setInterval(()=>{let _=e.getVolumeLevel();o=_>o?_:o,l=_<l?_:l;let R=o-l>1e-4,A=Date.now()-u;if(R||A>t){clearInterval(m);let D=R,J={duration:A,deviceLabel:n,maxVolumeLevel:o,result:D};L.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(J))),r.onSuccess(J),h(D)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3,r=gr.reportApiInvoke(null,{tag:Jn.TRACER,name:gi.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof xn||e instanceof uE)){let R=new at(ce.INVALID_TRACK,"the parameter is not a video track");return r.onError(R),R.throw()}t&&t<1e3&&(t=1e3);let n=e instanceof xn?e.getTrackLabel():"remote_track",i=e.getMediaStreamTrack(!0),o=document.createElement("video");o.style.width="1px",o.style.height="1px",o.setAttribute("muted",""),o.muted=!0,o.setAttribute("playsinline",""),o.controls=!1,(ra()||WS())&&(o.style.opacity="0.01",o.style.position="fixed",o.style.left="0",o.style.top="0",document.body.appendChild(o)),o.srcObject=new MediaStream([i]),o.play();let l=document.createElement("canvas");l.width=160,l.height=120;let u=0,h=0;try{let R=Date.now();u=await function(A,D,J,V){let K,se=0,ue=null;return new tr((De,ze)=>{function Ke(){se>V&&K&&(K(),De(se));let Ve=J.getContext("2d");if(!Ve){let ar=new at(ce.UNEXPECTED_ERROR,"can not get canvas 2d context.");return L.error(ar.toString()),void ze(ar)}Ve.drawImage(A,0,0,160,120);let _t=Ve.getImageData(0,0,J.width,J.height),Vt=Math.floor(_t.data.length/3);if(ue){for(let ar=0;ar<Vt;ar+=3)if(_t.data[ar]!==ue[ar])return se+=1,void(ue=_t.data);ue=_t.data}else ue=_t.data}setTimeout(()=>{K&&(K(),De(se))},D),K=NA(()=>{Ke()},30)})}(o,t,l,4),h=Date.now()-R}catch(R){throw r.onError(R),R}UG===an.SAFARI&&(o.pause(),o.remove()),o.srcObject=null;let m=u>4,_={duration:h,changedPicNum:u,deviceLabel:n,result:m};return L.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(_))),r.onSuccess(_),m},setArea:sb,audioElementPlayCenter:Wa,resumeAudioContext:function(){Wa.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){$G.processExternalMediaAEC(e)},registerExtensions:function(e){let t=Se("PLUGIN_INFO")||[];e.forEach(r=>{"name"in r&&!Qt(t).call(t,r.name)&&t.push(r.name);let n=r;n.__registered__=!0,n.logger.hookLog=L.extLog,n.reporter.hookApiInvoke=gr.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(i=>{n.parameters[i]=Se(i)})}),qx("PLUGIN_INFO",t)},ChannelMediaRelayError:fE,ChannelMediaRelayEvent:Uu,ChannelMediaRelayState:oo,RemoteStreamFallbackType:lF,RemoteStreamType:cF,ConnectionDisconnectedReason:cn,AudienceLatencyLevelType:B6,AREAS:on,preload:async function(e,t,r,n){return _2(e,t,r,n)}});return Object.defineProperties(Ti,{onAudioAutoplayFailed:{get:()=>Fo.onAudioAutoplayFailed,set:e=>{Fo.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Fo.onAutoplayFailed,set:e=>{Fo.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>Ti._onSecurityPolicyViolation,set(e){Ti._onSecurityPolicyViolation=e,AU(e)}},__CLIENT_LIST__:{get:()=>Se("SHOW_GLOBAL_CLIENT_LIST")?Lp:[]}}),Vo.on(Np.CAMERA_DEVICE_CHANGED,e=>{L.info("camera device changed",JSON.stringify(e)),Ti.onCameraChanged&&Ti.onCameraChanged(e),Ti.safeEmit(Ul.CAMERA_CHANGED,e)}),Vo.on(Np.RECORDING_DEVICE_CHANGED,e=>{L.info("microphone device changed",JSON.stringify(e)),Ti.onMicrophoneChanged&&Ti.onMicrophoneChanged(e),Ti.safeEmit(Ul.MICROPHONE_CHANGED,e)}),Vo.on(Np.PLAYOUT_DEVICE_CHANGED,e=>{L.debug("playout device changed",JSON.stringify(e)),Ti.onPlaybackDeviceChanged&&Ti.onPlaybackDeviceChanged(e),Ti.safeEmit(Ul.PLAYBACK_DEVICE_CHANGED,e)}),Wa.onAutoplayFailed=()=>{L.info("detect audio element autoplay failed"),Fo.onAudioAutoplayFailed&&Fo.onAudioAutoplayFailed()},fn.on("autoplay-failed",()=>{L.info("detect webaudio autoplay failed"),Fo.onAudioAutoplayFailed&&Fo.onAudioAutoplayFailed(),Ti.safeEmit(Ul.AUTOPLAY_FAILED)}),fn.on(Ji.STATE_CHANGE,(e,t)=>{L.info("audio context state changed: ".concat(t," => ").concat(e)),Ti.onAudioContextStateChanged&&Ti.onAudioContextStateChanged(e,t),Ti.safeEmit(Ul.AUDIO_CONTEXT_STATE_CHANGED,e,t)}),pi.on(Jm.NETWORK_STATE_CHANGE,(e,t)=>{L.info("[network-indicator] network state changed, ".concat(t," => ").concat(e))}),window&&(window.__ARTC__=Ti),Ti})}),x3={};D9(x3,{AgoraRTCProvider:()=>SO,AgoraRTCReactError:()=>Ro,AgoraRTCScreenShareProvider:()=>G9,LocalAudioTrack:()=>W3,LocalUser:()=>Y3,LocalVideoTrack:()=>DO,RemoteAudioTrack:()=>X3,RemoteUser:()=>PO,RemoteVideoTrack:()=>J3,TrackBoundary:()=>eW,VERSION:()=>aW,default:()=>LO,useAutoPlayAudioTrack:()=>NO,useAutoPlayVideoTrack:()=>OO,useClientEvent:()=>B9,useConnectionState:()=>W9,useCurrentUID:()=>K9,useIsConnected:()=>hh,useJoin:()=>RO,useLocalCameraTrack:()=>F3,useLocalMicrophoneTrack:()=>IO,useLocalScreenTrack:()=>H3,useNetworkQuality:()=>z9,usePublish:()=>CO,useRTCClient:()=>qc,useRTCScreenShareClient:()=>H9,useRemoteAudioTracks:()=>G3,useRemoteUserTrack:()=>hO,useRemoteUsers:()=>AO,useRemoteVideoTracks:()=>Z9,useTrackEvent:()=>V9,useVolumeLevel:()=>Y9});var L9=ef(tf());function po(G,me,be){return G.on(me,be),()=>G.off(me,be)}function k9(G){try{return G()}catch(me){console.error(me)}}function rf(G){return()=>G.forEach(k9)}function M9(G,me){let be=setInterval(G,me);return()=>clearInterval(be)}function v0(G,me){let be=setTimeout(G,me);return()=>clearTimeout(be)}function yO(){let G,me,be;function de(){if(me){let p=me;me=void 0,p()}}async function fe(){if(be){let p=be;be=void 0;try{await p()}catch(f){console.error(f)}}}async function We(p){G=!0,await fe();try{be=await p()}catch(f){console.error(f)}G=!1,de()}async function O(){G=!0,await fe(),G=!1,de()}function j(p){G?me=()=>We(p):We(p)}function c(){G?me=O:O()}return{run:j,dispose:c}}var T0=typeof document<"u"?ot.useLayoutEffect:ot.useEffect;function U9(G){return G!=null&&typeof G.then=="function"}function dh(){let G=ot.useRef(!1);return ot.useEffect(()=>(G.current=!1,()=>{G.current=!0}),[]),G}function x9(){let G=dh();function me(be,de){return new Promise(async(fe,We)=>{try{let O=await be;G.current||fe(O)}catch(O){G.current?de&&de(O):We(O)}})}return ot.useCallback(me,[G])}function j3(G){let me=x9(),[be,de]=ot.useState();return T0(()=>{U9(G)?me(G).then(de):de(G)},[G,me]),be}function nf(G,me){let be=ot.useRef();ot.useEffect(()=>{let{run:de,dispose:fe}=be.current||=yO();return de(G),fe},me)}function j9(G,me){let be=G.split("."),de=me.split("."),fe=Math.max(be.length,de.length);for(let We=0;We<fe;We++){let O=parseInt(be[We]||"0"),j=parseInt(de[We]||"0");if(O>j)return 1;if(O<j)return-1}return 0}function B9(G,me,be){let de=ot.useRef(be);T0(()=>{de.current=be},[be]),ot.useEffect(()=>{if(G)return po(G,me,(...fe)=>{de.current&&de.current(...fe)})},[me,G])}function V9(G,me,be){let de=ot.useRef(be);T0(()=>{de.current=be},[be]),ot.useEffect(()=>{if(G)return po(G,me,(...fe)=>{de.current&&de.current(...fe)})},[me,G])}var B3=ot.createContext(null);function SO({client:G,children:me}){return st.jsx(B3.Provider,{value:G,children:me})}function F9(G){let me=ot.useContext(B3);return G||me}function qc(G){let me=F9(G);if(!me)throw new Error("Agora RTC client not found. Should be wrapped in <AgoraRTCProvider value={client} />");return me}var V3=ot.createContext(null);function G9({client:G,children:me}){return st.jsx(V3.Provider,{value:G,children:me})}function H9(G){let me=ot.useContext(V3);return G||me}function W9(G){let me=qc(G),[be,de]=ot.useState(me?me.connectionState:"DISCONNECTED");return ot.useEffect(()=>{if(me){de(me.connectionState);let fe;return rf([po(me,"connection-state-change",We=>{fe?.(),We==="CONNECTED"?fe=v0(()=>de(We),0):de(We)}),()=>fe?.()])}else de("DISCONNECTED")},[me]),be}function hh(G){let me=qc(G),[be,de]=ot.useState(me?me.connectionState==="CONNECTED":!1);return ot.useEffect(()=>{if(me){de(me.connectionState==="CONNECTED");let fe;return rf([po(me,"connection-state-change",We=>{fe?.(),fe=v0(()=>de(We==="CONNECTED"),0)}),()=>fe?.()])}else de(!1)},[me]),be}function K9(G){let me=qc(G),[be,de]=ot.useState(me?.uid);return ot.useEffect(()=>{if(me)return po(me,"connection-state-change",fe=>{if(fe==="CONNECTED")return v0(()=>de(me.uid),0);fe==="DISCONNECTED"&&de(void 0)})},[me]),be}var Ro=class extends Error{rtcMethod;rtcError;name="AgoraRTCReactException";constructor(G,me){typeof me=="string"?super(me):super(me.message),this.rtcMethod=G,this.rtcError=me}log(G){console[G](this)}};function RO(G,me=!0,be){let de=qc(be),fe=hh(be),We=ot.useRef(),[O,j]=ot.useState(!1),[c,p]=ot.useState(0),[f,T]=ot.useState(null),v=dh();return nf(async()=>{if(v.current||(T(null),p(0),j(!1)),me&&de){try{v.current||j(!0);let{appid:y,channel:E,token:N,uid:C}=typeof G=="function"?await G():G,U=await de.join(y,E,N,C);v.current||p(U)}catch(y){console.error(y),v.current||T(new Ro("IAgoraRTCClient.join",y))}v.current||j(!1);let S=We.current||=yO();return rf([()=>{S.dispose()},()=>{S.run(()=>de.unpublish(de.localTracks))},()=>{for(let y of de.localTracks)y.isPlaying&&y.stop(),y.close();S.run(()=>de.leave())}])}},[me,be]),{data:c,isLoading:O,isConnected:fe,error:f}}var u3=()=>({uplinkNetworkQuality:0,downlinkNetworkQuality:0,delay:0});function z9(G){let me=qc(G),[be,de]=ot.useState(u3);return ot.useEffect(()=>{if(me)return po(me,"network-quality",fe=>de({uplinkNetworkQuality:fe.uplinkNetworkQuality,downlinkNetworkQuality:fe.downlinkNetworkQuality,delay:me.getRTCStats().RTT??0}));de(u3())},[me]),be}var q9=ef(tf());function CO(G,me=!0,be){let de=qc(be),fe=hh(be),We=ot.useRef([]),[O,j]=ot.useState(!1),[c,p]=ot.useState(null),f=dh();return nf(async()=>{if(f.current||(j(!1),p(null)),!de||!fe||!me)return;let T=G.filter(Boolean),v=E=>{let N=j9(q9.default.VERSION,"4.18.2")>=0;return N||new Ro("usePublish","please check your agora-rtc-sdk-ng version in package.json, it's recommend upgrade to >= 4.18.2").log("warn"),N?de.mode!=="live"||de.role!=="audience":!0},S=E=>We.current.some(N=>N&&N.getTrackId()===E.getTrackId()),y=E=>v()&&E.enabled&&me&&!S(E);for(let E=0;E<T.length;E++){let N=T[E];if(N&&y(N)){await de.unpublish(We.current.filter(C=>C?.trackMediaType===N.trackMediaType));try{f.current||j(!0),await de.publish(N)}catch(C){console.error(C),f.current||p(new Ro("IAgoraRTCClient.publish",C))}f.current||j(!1)}}We.current=T},[fe,me,de,G]),{isLoading:O,error:c}}function Y9(G){let[me,be]=ot.useState(0);return ot.useEffect(()=>{if(G)return M9(()=>{be(G.getVolumeLevel())},1e3)},[G]),me}var X9=ef(tf());function IO(G=!0,me={ANS:!0,AEC:!0}){let[be,de]=ot.useState(null),[fe,We]=ot.useState(!1),[O,j]=ot.useState(null),c=dh();return nf(async()=>{if(c.current||(We(!1),j(null)),G&&!be){try{c.current||We(!0);let p=await X9.default.createMicrophoneAudioTrack(me);c.current||de(p)}catch(p){console.error(p),c.current||j(new Ro("IAgoraRTC.createMicrophoneAudioTrack",p))}c.current||We(!1)}},[G]),{localMicrophoneTrack:be,isLoading:fe,error:O}}var J9=ef(tf());function F3(G=!0,me){let[be,de]=ot.useState(null),[fe,We]=ot.useState(!1),[O,j]=ot.useState(null),c=dh();return nf(async()=>{if(c.current||(We(!1),j(null)),G&&!be){try{c.current||We(!0);let p=await J9.default.createCameraVideoTrack(me);c.current||de(p)}catch(p){console.error(p),c.current||j(new Ro("IAgoraRTC.createCameraVideoTrack",p))}c.current||We(!1)}},[G]),{localCameraTrack:be,isLoading:fe,error:O}}function G3(G,me){let be=qc(me),[de,fe]=ot.useState([]),We=hh(),O=ot.useRef([]),[j,c]=ot.useState(!1),[p,f]=ot.useState(null),T=dh();return nf(async()=>{if(T.current||f(null),!Array.isArray(G)||!We)return;let v=async E=>{if(!E.audioTrack&&G.some(({uid:N})=>E.uid===N)){try{T.current||c(!0),await be.subscribe(E,"audio")}catch(N){console.error(N),T.current||f(new Ro("IAgoraRTCClient.subscribe",N))}E.audioTrack&&!O.current.some(N=>N.getUserId()===E.uid)&&O.current.push(E.audioTrack),O.current=O.current.map(N=>E.audioTrack&&N.getUserId()===E.uid&&N.getTrackId()!==E.audioTrack.getTrackId()?E.audioTrack:N),T.current||(fe([...O.current]),c(!1))}},S=async E=>{if(G.some(({uid:N})=>E.uid===N)){T.current||(O.current=O.current.filter(N=>N.getUserId()!==E.uid),fe([...O.current]));try{T.current||c(!0),await be.unsubscribe(E,"audio")}catch(N){console.error(N),T.current||f(new Ro("IAgoraRTCClient.unsubscribe",N))}T.current||c(!1)}};G.map(E=>{!E.audioTrack&&E.hasAudio&&v(E)});let y=[];for(let E=0;E<O.current.length;E++){let N=O.current[E];if(!G.some(C=>C.uid===N.getUserId())){let C=be.remoteUsers.find(U=>U.uid===N.getUserId());C&&y.push({user:C,mediaType:"audio"}),O.current.splice(E,1),E--}}if(y.length>0){try{T.current||c(!0),await be.massUnsubscribe(y)}catch(E){console.error(E),T.current||f(new Ro("IAgoraRTCClient.massUnsubscribe",E))}T.current||(fe(O.current.slice()),c(!1))}return rf([po(be,"user-published",(E,N)=>{G.find(C=>C.uid===E.uid)&&N==="audio"&&v(E)}),po(be,"user-unpublished",(E,N)=>{G.find(C=>C.uid===E.uid)&&N==="audio"&&S(E)})])},[We,be,G]),{audioTracks:de,isLoading:j,error:p}}function Z9(G,me){let be=qc(me),[de,fe]=ot.useState([]),We=hh(),O=ot.useRef([]),[j,c]=ot.useState(!1),[p,f]=ot.useState(null),T=dh();return nf(async()=>{if(T.current||f(null),!Array.isArray(G)||!We)return;let v=async E=>{if(!E.videoTrack&&G.some(({uid:N})=>E.uid===N)){try{T.current||c(!0),await be.subscribe(E,"video")}catch(N){console.error(N),T.current||f(new Ro("IAgoraRTCClient.subscribe",N))}E.videoTrack&&!O.current.some(N=>N.getUserId()===E.uid)&&O.current.push(E.videoTrack),O.current=O.current.map(N=>E.videoTrack&&N.getUserId()===E.uid&&N.getTrackId()!==E.videoTrack.getTrackId()?E.videoTrack:N),T.current||(fe([...O.current]),c(!1))}},S=async E=>{if(G.some(({uid:N})=>E.uid===N)){T.current||(O.current=O.current.filter(N=>N.getUserId()!==E.uid),fe([...O.current]));try{T.current||c(!0),await be.unsubscribe(E,"video")}catch(N){console.error(N),T.current||f(new Ro("IAgoraRTCClient.unsubscribe",N))}T.current||c(!1)}};G.map(E=>{!E.videoTrack&&E.hasVideo&&v(E)});let y=[];for(let E=0;E<O.current.length;E++){let N=O.current[E];if(!G.some(C=>C.uid===N.getUserId())){let C=be.remoteUsers.find(U=>U.uid===N.getUserId());C&&y.push({user:C,mediaType:"video"}),O.current.splice(E,1),E--}}if(y.length>0){try{T.current||c(!0),await be.massUnsubscribe(y)}catch(E){console.error(E),T.current||f(new Ro("IAgoraRTCClient.massUnsubscribe",E))}T.current||(fe(O.current.slice()),c(!1))}return rf([po(be,"user-published",(E,N)=>{G.find(C=>C.uid===E.uid)&&N==="video"&&v(E)}),po(be,"user-unpublished",(E,N)=>{G.find(C=>C.uid===E.uid)&&N==="video"&&S(E)})])},[We,be,G]),{videoTracks:de,isLoading:j,error:p}}function hO(G,me,be){let de=qc(be),fe=me==="audio"?"audioTrack":"videoTrack",[We,O]=ot.useState(G&&G[fe]),j=hh(),c=ot.useRef(),[p,f]=ot.useState(!1),[T,v]=ot.useState(null);return ot.useEffect(()=>{if(!G||!j)return;let S=!1;S||v(null);let y=me==="audio"?"hasAudio":"hasVideo",E=G.uid,N=async(M,x)=>{if(M[fe]&&de.remoteUsers.some(({uid:P})=>M.uid===P))try{S||f(!0),await de.unsubscribe(M,x)}catch(P){S||v(new Ro("IAgoraRTCClient.unsubscribe",P)),console.error(P)}S||(O(void 0),f(!1))},C=async(M,x)=>{try{!M[fe]&&de.remoteUsers.some(({uid:P})=>M.uid===P)&&(S||f(!0),await de.subscribe(M,x)),S||O(M[fe])}catch(P){S||v(new Ro("IAgoraRTCClient.subscribe",P)),console.error(P)}S||f(!1)},U=c.current||=yO();return!G[fe]&&G[y]?U.run(()=>C(G,me)):O(G[fe]),rf([()=>{S=!0,U.dispose()},po(de,"user-published",(M,x)=>{M.uid===E&&x===me&&U.run(()=>C(M,me))}),po(de,"user-unpublished",(M,x)=>{M.uid===E&&x===me&&U.run(()=>N(M,me))})])},[j,de,G,me,fe]),{track:We,isLoading:p,error:T}}function AO(G){let me=qc(G),[be,de]=ot.useState(me?me.remoteUsers:[]);return ot.useEffect(()=>{if(me){let fe=()=>de(me.remoteUsers.slice());return rf([po(me,"user-joined",fe),po(me,"user-left",fe),po(me,"user-published",fe),po(me,"user-unpublished",fe)])}},[me]),be}var Q9=ef(tf());function H3(G=!0,me,be){let[de,fe]=ot.useState(null),[We,O]=ot.useState(!1),[j,c]=ot.useState(null),p=dh();return nf(async()=>{if(p.current||(O(!1),c(null)),G&&!de){try{p.current||O(!0);let f=await Q9.default.createScreenVideoTrack(me,be);p.current||fe(f)}catch(f){console.error(f),p.current||c(new Ro("IAgoraRTC.createScreenVideoTrack",f))}p.current||O(!1)}},[G]),{screenTrack:de,isLoading:We,error:j}}function $9(){let G=new Map,me=1500;return{onMount:be=>{let de=G.get(be);de&&(de(),G.delete(be))},onUnmount:be=>{let de=G.get(be);de&&de(),G.set(be,v0(()=>{be.isPlaying&&be.stop(),G.delete(be)},me))},dispose:()=>{for(let[be,de]of G)be.isPlaying&&be.stop(),de&&de();G.clear()}}}var bO=ot.createContext(void 0);function eW({children:G}){let[me]=ot.useState($9);return ot.useEffect(()=>me.dispose,[me]),st.jsx(bO.Provider,{value:me,children:G})}function OO(G,me,be,de){let fe=ot.useContext(bO);ot.useEffect(()=>{if(G)return de&&me?G.play(de,be||void 0):G.stop(),fe?(fe.onMount(G),()=>fe.onUnmount(G)):()=>{G.isPlaying&&G.stop()}},[G,de,me,fe,be])}function NO(G,me){let be=ot.useContext(bO);T0(()=>{if(G)return me?G.play():G.stop(),be?(be.onMount(G),()=>be.onUnmount(G)):()=>{G.isPlaying&&G.stop()}},[G,me,be])}function W3({track:G,play:me=!1,volume:be,disabled:de,muted:fe,children:We}){let O=j3(G);return NO(O,me),ot.useEffect(()=>{O&&be!=null&&O.setVolume(be)},[O,be]),ot.useEffect(()=>{O&&de!=null&&O.setEnabled(!de).catch(console.warn)},[de,O]),ot.useEffect(()=>{O&&fe!=null&&O.setMuted(fe).catch(console.warn)},[fe,O]),We?st.jsx(st.Fragment,{children:We}):null}var K3={position:"relative",width:"100%",height:"100%",overflow:"hidden",background:"#000"},z3={width:"100%",height:"100%"},wO={position:"absolute",top:0,left:0,width:"100%",height:"100%",overflow:"hidden",zIndex:2},y0=(G,me)=>ot.useMemo(()=>({...G,...me}),[G,me]);function DO({track:G,play:me,disabled:be,muted:de,style:fe,videoPlayerConfig:We,...O}){let j=y0(z3,fe),[c,p]=ot.useState(null),f=j3(G);return OO(f,me,We,c),ot.useEffect(()=>{f&&be!=null&&f.setEnabled(!be).catch(console.warn)},[be,f]),ot.useEffect(()=>{f&&de!=null&&f.setMuted(de).catch(console.warn)},[de,f]),st.jsx("div",{...O,ref:p,style:j})}var tW={width:"100%",height:"100%",background:"#1a1e21 center/cover no-repeat",filter:"blur(16px) brightness(0.4)"},rW={position:"absolute",top:"50%",left:"50%",maxWidth:"50%",maxHeight:"50%",aspectRatio:"1",transform:"translate(-50%, -50%)",borderRadius:"50%",overflow:"hidden",objectFit:"cover"};function q3({cover:G}){return st.jsx("div",{style:wO,children:typeof G=="string"?st.jsxs(st.Fragment,{children:[st.jsx("div",{style:{...tW,backgroundImage:`url(${G})`}}),st.jsx("img",{src:G,style:rW})]}):G()})}function Y3({micOn:G,cameraOn:me,audioTrack:be,videoTrack:de,playAudio:fe,playVideo:We,volume:O,cover:j,children:c,style:p,...f}){let T=y0(K3,p);return We=We??!!me,fe=fe??!!G,st.jsxs("div",{...f,style:T,children:[st.jsx(DO,{disabled:!me,play:We,track:de}),st.jsx(W3,{disabled:!G,play:fe,track:be,volume:O}),j&&!me&&st.jsx(q3,{cover:j}),st.jsx("div",{style:wO,children:c})]})}function X3({track:G,play:me=!1,playbackDeviceId:be,volume:de,children:fe}){return NO(G,me),ot.useEffect(()=>{G&&be!=null&&G.setPlaybackDevice(be).catch(console.warn)},[G,be]),ot.useEffect(()=>{G&&de!=null&&G.setVolume(de)},[G,de]),fe?st.jsx(st.Fragment,{children:fe}):null}function J3({track:G,play:me,style:be,videoPlayerConfig:de,...fe}){let We=y0(z3,be),[O,j]=ot.useState(null);return OO(G,me,de,O),st.jsx("div",{...fe,ref:j,style:We})}function PO({user:G,playVideo:me,playAudio:be,playbackDeviceId:de,volume:fe,cover:We,style:O,children:j,videoPlayerConfig:c,...p}){let f=y0(K3,O),{track:T}=hO(G,"video"),{track:v}=hO(G,"audio");return me=me??G?.hasVideo,be=be??G?.hasAudio,st.jsxs("div",{...p,style:f,children:[st.jsx(J3,{play:me,track:T,videoPlayerConfig:c}),st.jsx(X3,{play:be,playbackDeviceId:de,track:v,volume:fe}),We&&!me&&st.jsx(q3,{cover:We}),st.jsx("div",{style:wO,children:j})]})}var nW=ef(tf()),iW=class{appType=1001;constructor(){nW.default.setAppType(this.appType)}};new iW;var aW="2.4.0";P9(x3,ef(tf()));var LO=L9.default;const oW=()=>{const G=window.isSecureContext,me=!!navigator.mediaDevices;return{hasCamera:me,hasMicrophone:me,cameraPermission:"unknown",microphonePermission:"unknown",isSecureContext:G}},Z3=async(G={})=>{const{checkCamera:me=!0,checkMicrophone:be=!0}=G,de=oW();if(!de.hasCamera&&!de.hasMicrophone)return de;try{let fe="unknown";if(me&&de.hasCamera)try{const O=await navigator.mediaDevices.getUserMedia({video:!0});fe="granted",O.getTracks().forEach(j=>j.stop())}catch(O){O instanceof Error&&(O.name==="NotAllowedError"?fe="denied":O.name==="NotFoundError"&&(de.hasCamera=!1))}let We="unknown";if(be&&de.hasMicrophone)try{const O=await navigator.mediaDevices.getUserMedia({audio:!0});We="granted",O.getTracks().forEach(j=>j.stop())}catch(O){O instanceof Error&&(O.name==="NotAllowedError"?We="denied":O.name==="NotFoundError"&&(de.hasMicrophone=!1))}return{...de,cameraPermission:fe,microphonePermission:We}}catch(fe){return console.error("Error checking device permissions:",fe),de}},Q3=G=>{if(!G.isSecureContext)return"Media access requires a secure context (HTTPS or localhost). Please use HTTPS or run on localhost.";if(!G.hasCamera&&!G.hasMicrophone)return"No camera or microphone found. Please check your device connections.";const me=[];return G.cameraPermission!=="unknown"&&(G.hasCamera?G.cameraPermission==="denied"&&me.push("Camera permission denied"):me.push("Camera not available")),G.microphonePermission!=="unknown"&&(G.hasMicrophone?G.microphonePermission==="denied"&&me.push("Microphone permission denied"):me.push("Microphone not available")),me.length===0?null:`${me.join(", ")}. Please check your device permissions and try again.`};var lO={exports:{}},d3;function sW(){return d3||(d3=1,function(G,me){(function(be,de){G.exports=de()})(self,function(){return function(){var be={4537:function(O){O.exports=function(j,c){for(var p=new Array(arguments.length-1),f=0,T=2,v=!0;T<arguments.length;)p[f++]=arguments[T++];return new Promise(function(S,y){p[f]=function(E){if(v)if(v=!1,E)y(E);else{for(var N=new Array(arguments.length-1),C=0;C<N.length;)N[C++]=arguments[C];S.apply(null,N)}};try{j.apply(c||null,p)}catch(E){v&&(v=!1,y(E))}})}},7419:function(O,j){var c=j;c.length=function(S){var y=S.length;if(!y)return 0;for(var E=0;--y%4>1&&S.charAt(y)==="=";)++E;return Math.ceil(3*S.length)/4-E};for(var p=new Array(64),f=new Array(123),T=0;T<64;)f[p[T]=T<26?T+65:T<52?T+71:T<62?T-4:T-59|43]=T++;c.encode=function(S,y,E){for(var N,C=null,U=[],M=0,x=0;y<E;){var P=S[y++];switch(x){case 0:U[M++]=p[P>>2],N=(3&P)<<4,x=1;break;case 1:U[M++]=p[N|P>>4],N=(15&P)<<2,x=2;break;case 2:U[M++]=p[N|P>>6],U[M++]=p[63&P],x=0}M>8191&&((C||(C=[])).push(String.fromCharCode.apply(String,U)),M=0)}return x&&(U[M++]=p[N],U[M++]=61,x===1&&(U[M++]=61)),C?(M&&C.push(String.fromCharCode.apply(String,U.slice(0,M))),C.join("")):String.fromCharCode.apply(String,U.slice(0,M))};var v="invalid encoding";c.decode=function(S,y,E){for(var N,C=E,U=0,M=0;M<S.length;){var x=S.charCodeAt(M++);if(x===61&&U>1)break;if((x=f[x])===void 0)throw Error(v);switch(U){case 0:N=x,U=1;break;case 1:y[E++]=N<<2|(48&x)>>4,N=x,U=2;break;case 2:y[E++]=(15&N)<<4|(60&x)>>2,N=x,U=3;break;case 3:y[E++]=(3&N)<<6|x,U=0}}if(U===1)throw Error(v);return E-C},c.test=function(S){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(S)}},5124:function(O){function j(c,p){typeof c=="string"&&(p=c,c=void 0);var f=[];function T(S){if(typeof S!="string"){var y=v();if(j.verbose&&console.log("codegen: "+y),y="return "+y,S){for(var E=Object.keys(S),N=new Array(E.length+1),C=new Array(E.length),U=0;U<E.length;)N[U]=E[U],C[U]=S[E[U++]];return N[U]=y,Function.apply(null,N).apply(null,C)}return Function(y)()}for(var M=new Array(arguments.length-1),x=0;x<M.length;)M[x]=arguments[++x];if(x=0,S=S.replace(/%([%dfijs])/g,function(P,z){var Z=M[x++];switch(z){case"d":case"f":return String(Number(Z));case"i":return String(Math.floor(Z));case"j":return JSON.stringify(Z);case"s":return String(Z)}return"%"}),x!==M.length)throw Error("parameter count mismatch");return f.push(S),T}function v(S){return"function "+(S||p||"")+"("+(c&&c.join(",")||"")+`){
  `+f.join(`
  `)+`
}`}return T.toString=v,T}O.exports=j,j.verbose=!1},9211:function(O){function j(){this._listeners={}}O.exports=j,j.prototype.on=function(c,p,f){return(this._listeners[c]||(this._listeners[c]=[])).push({fn:p,ctx:f||this}),this},j.prototype.off=function(c,p){if(c===void 0)this._listeners={};else if(p===void 0)this._listeners[c]=[];else for(var f=this._listeners[c],T=0;T<f.length;)f[T].fn===p?f.splice(T,1):++T;return this},j.prototype.emit=function(c){var p=this._listeners[c];if(p){for(var f=[],T=1;T<arguments.length;)f.push(arguments[T++]);for(T=0;T<p.length;)p[T].fn.apply(p[T++].ctx,f)}return this}},9054:function(O,j,c){O.exports=T;var p=c(4537),f=c(7199)("fs");function T(v,S,y){return typeof S=="function"?(y=S,S={}):S||(S={}),y?!S.xhr&&f&&f.readFile?f.readFile(v,function(E,N){return E&&typeof XMLHttpRequest<"u"?T.xhr(v,S,y):E?y(E):y(null,S.binary?N:N.toString("utf8"))}):T.xhr(v,S,y):p(T,this,v,S)}T.xhr=function(v,S,y){var E=new XMLHttpRequest;E.onreadystatechange=function(){if(E.readyState===4){if(E.status!==0&&E.status!==200)return y(Error("status "+E.status));if(S.binary){var N=E.response;if(!N){N=[];for(var C=0;C<E.responseText.length;++C)N.push(255&E.responseText.charCodeAt(C))}return y(null,typeof Uint8Array<"u"?new Uint8Array(N):N)}return y(null,E.responseText)}},S.binary&&("overrideMimeType"in E&&E.overrideMimeType("text/plain; charset=x-user-defined"),E.responseType="arraybuffer"),E.open("GET",v),E.send()}},945:function(O){function j(v){return typeof Float32Array<"u"?function(){var S=new Float32Array([-0]),y=new Uint8Array(S.buffer),E=y[3]===128;function N(x,P,z){S[0]=x,P[z]=y[0],P[z+1]=y[1],P[z+2]=y[2],P[z+3]=y[3]}function C(x,P,z){S[0]=x,P[z]=y[3],P[z+1]=y[2],P[z+2]=y[1],P[z+3]=y[0]}function U(x,P){return y[0]=x[P],y[1]=x[P+1],y[2]=x[P+2],y[3]=x[P+3],S[0]}function M(x,P){return y[3]=x[P],y[2]=x[P+1],y[1]=x[P+2],y[0]=x[P+3],S[0]}v.writeFloatLE=E?N:C,v.writeFloatBE=E?C:N,v.readFloatLE=E?U:M,v.readFloatBE=E?M:U}():function(){function S(E,N,C,U){var M=N<0?1:0;if(M&&(N=-N),N===0)E(1/N>0?0:2147483648,C,U);else if(isNaN(N))E(2143289344,C,U);else if(N>34028234663852886e22)E((M<<31|2139095040)>>>0,C,U);else if(N<11754943508222875e-54)E((M<<31|Math.round(N/1401298464324817e-60))>>>0,C,U);else{var x=Math.floor(Math.log(N)/Math.LN2);E((M<<31|x+127<<23|8388607&Math.round(N*Math.pow(2,-x)*8388608))>>>0,C,U)}}function y(E,N,C){var U=E(N,C),M=2*(U>>31)+1,x=U>>>23&255,P=8388607&U;return x===255?P?NaN:M*(1/0):x===0?1401298464324817e-60*M*P:M*Math.pow(2,x-150)*(P+8388608)}v.writeFloatLE=S.bind(null,c),v.writeFloatBE=S.bind(null,p),v.readFloatLE=y.bind(null,f),v.readFloatBE=y.bind(null,T)}(),typeof Float64Array<"u"?function(){var S=new Float64Array([-0]),y=new Uint8Array(S.buffer),E=y[7]===128;function N(x,P,z){S[0]=x,P[z]=y[0],P[z+1]=y[1],P[z+2]=y[2],P[z+3]=y[3],P[z+4]=y[4],P[z+5]=y[5],P[z+6]=y[6],P[z+7]=y[7]}function C(x,P,z){S[0]=x,P[z]=y[7],P[z+1]=y[6],P[z+2]=y[5],P[z+3]=y[4],P[z+4]=y[3],P[z+5]=y[2],P[z+6]=y[1],P[z+7]=y[0]}function U(x,P){return y[0]=x[P],y[1]=x[P+1],y[2]=x[P+2],y[3]=x[P+3],y[4]=x[P+4],y[5]=x[P+5],y[6]=x[P+6],y[7]=x[P+7],S[0]}function M(x,P){return y[7]=x[P],y[6]=x[P+1],y[5]=x[P+2],y[4]=x[P+3],y[3]=x[P+4],y[2]=x[P+5],y[1]=x[P+6],y[0]=x[P+7],S[0]}v.writeDoubleLE=E?N:C,v.writeDoubleBE=E?C:N,v.readDoubleLE=E?U:M,v.readDoubleBE=E?M:U}():function(){function S(E,N,C,U,M,x){var P=U<0?1:0;if(P&&(U=-U),U===0)E(0,M,x+N),E(1/U>0?0:2147483648,M,x+C);else if(isNaN(U))E(0,M,x+N),E(2146959360,M,x+C);else if(U>17976931348623157e292)E(0,M,x+N),E((P<<31|2146435072)>>>0,M,x+C);else{var z;if(U<22250738585072014e-324)E((z=U/5e-324)>>>0,M,x+N),E((P<<31|z/4294967296)>>>0,M,x+C);else{var Z=Math.floor(Math.log(U)/Math.LN2);Z===1024&&(Z=1023),E(4503599627370496*(z=U*Math.pow(2,-Z))>>>0,M,x+N),E((P<<31|Z+1023<<20|1048576*z&1048575)>>>0,M,x+C)}}}function y(E,N,C,U,M){var x=E(U,M+N),P=E(U,M+C),z=2*(P>>31)+1,Z=P>>>20&2047,I=4294967296*(1048575&P)+x;return Z===2047?I?NaN:z*(1/0):Z===0?5e-324*z*I:z*Math.pow(2,Z-1075)*(I+4503599627370496)}v.writeDoubleLE=S.bind(null,c,0,4),v.writeDoubleBE=S.bind(null,p,4,0),v.readDoubleLE=y.bind(null,f,0,4),v.readDoubleBE=y.bind(null,T,4,0)}(),v}function c(v,S,y){S[y]=255&v,S[y+1]=v>>>8&255,S[y+2]=v>>>16&255,S[y+3]=v>>>24}function p(v,S,y){S[y]=v>>>24,S[y+1]=v>>>16&255,S[y+2]=v>>>8&255,S[y+3]=255&v}function f(v,S){return(v[S]|v[S+1]<<8|v[S+2]<<16|v[S+3]<<24)>>>0}function T(v,S){return(v[S]<<24|v[S+1]<<16|v[S+2]<<8|v[S+3])>>>0}O.exports=j(j)},7199:function(O,j,c){O.exports=function(p){try{var f=c(822)(p);if(f&&(f.length||Object.keys(f).length))return f}catch{}return null}},822:function(O){function j(c){var p=new Error("Cannot find module '"+c+"'");throw p.code="MODULE_NOT_FOUND",p}j.keys=function(){return[]},j.resolve=j,j.id=822,O.exports=j},8626:function(O,j){var c=j,p=c.isAbsolute=function(T){return/^(?:\/|\w+:)/.test(T)},f=c.normalize=function(T){var v=(T=T.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),S=p(T),y="";S&&(y=v.shift()+"/");for(var E=0;E<v.length;)v[E]===".."?E>0&&v[E-1]!==".."?v.splice(--E,2):S?v.splice(E,1):++E:v[E]==="."?v.splice(E,1):++E;return y+v.join("/")};c.resolve=function(T,v,S){return S||(v=f(v)),p(v)?v:(S||(T=f(T)),(T=T.replace(/(?:\/|^)[^/]+$/,"")).length?f(T+"/"+v):v)}},6662:function(O){O.exports=function(j,c,p){var f=p||8192,T=f>>>1,v=null,S=f;return function(y){if(y<1||y>T)return j(y);S+y>f&&(v=j(f),S=0);var E=c.call(v,S,S+=y);return 7&S&&(S=1+(7|S)),E}}},4997:function(O,j){var c=j;c.length=function(p){for(var f=0,T=0,v=0;v<p.length;++v)(T=p.charCodeAt(v))<128?f+=1:T<2048?f+=2:(64512&T)==55296&&(64512&p.charCodeAt(v+1))==56320?(++v,f+=4):f+=3;return f},c.read=function(p,f,T){if(T-f<1)return"";for(var v,S=null,y=[],E=0;f<T;)(v=p[f++])<128?y[E++]=v:v>191&&v<224?y[E++]=(31&v)<<6|63&p[f++]:v>239&&v<365?(v=((7&v)<<18|(63&p[f++])<<12|(63&p[f++])<<6|63&p[f++])-65536,y[E++]=55296+(v>>10),y[E++]=56320+(1023&v)):y[E++]=(15&v)<<12|(63&p[f++])<<6|63&p[f++],E>8191&&((S||(S=[])).push(String.fromCharCode.apply(String,y)),E=0);return S?(E&&S.push(String.fromCharCode.apply(String,y.slice(0,E))),S.join("")):String.fromCharCode.apply(String,y.slice(0,E))},c.write=function(p,f,T){for(var v,S,y=T,E=0;E<p.length;++E)(v=p.charCodeAt(E))<128?f[T++]=v:v<2048?(f[T++]=v>>6|192,f[T++]=63&v|128):(64512&v)==55296&&(64512&(S=p.charCodeAt(E+1)))==56320?(v=65536+((1023&v)<<10)+(1023&S),++E,f[T++]=v>>18|240,f[T++]=v>>12&63|128,f[T++]=v>>6&63|128,f[T++]=63&v|128):(f[T++]=v>>12|224,f[T++]=v>>6&63|128,f[T++]=63&v|128);return T-y}},4188:function(O,j,c){var p,f,T;(function(v){if(j!=null&&typeof j.nodeType!="number")O.exports=v();else if(c.amdO!=null)f=[],(T=typeof(p=v)=="function"?p.apply(j,f):p)===void 0||(O.exports=T);else{var S=v(),y=typeof self<"u"?self:$.global;typeof y.btoa!="function"&&(y.btoa=S.btoa),typeof y.atob!="function"&&(y.atob=S.atob)}})(function(){var v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function S(y){this.message=y}return S.prototype=new Error,S.prototype.name="InvalidCharacterError",{btoa:function(y){for(var E,N,C=String(y),U=0,M=v,x="";C.charAt(0|U)||(M="=",U%1);x+=M.charAt(63&E>>8-U%1*8)){if((N=C.charCodeAt(U+=.75))>255)throw new S("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");E=E<<8|N}return x},atob:function(y){var E=String(y).replace(/[=]+$/,"");if(E.length%4==1)throw new S("'atob' failed: The string to be decoded is not correctly encoded.");for(var N,C,U=0,M=0,x="";C=E.charAt(M++);~C&&(N=U%4?64*N+C:C,U++%4)?x+=String.fromCharCode(255&N>>(-2*U&6)):0)C=v.indexOf(C);return x}}})},9667:function(O,j,c){c.r(j),c.d(j,{addUsersToChatRoom:function(){return Y},addUsersToChatRoomAllowlist:function(){return pr},addUsersToChatRoomWhitelist:function(){return Gt},blockChatRoomMember:function(){return pt},blockChatRoomMembers:function(){return Ie},chatRoomBlockMulti:function(){return dt},chatRoomBlockSingle:function(){return Ye},createChatRoom:function(){return C},deleteChatRoomSharedFile:function(){return vt},destroyChatRoom:function(){return U},disableSendChatRoomMsg:function(){return jt},enableSendChatRoomMsg:function(){return Lt},fetchChatRoomAnnouncement:function(){return Zt},fetchChatRoomSharedFileList:function(){return zt},getChatRoomAdmin:function(){return H},getChatRoomAllowlist:function(){return Xt},getChatRoomAttributes:function(){return or},getChatRoomBlacklist:function(){return Pt},getChatRoomBlacklistNew:function(){return Tt},getChatRoomBlocklist:function(){return bt},getChatRoomDetails:function(){return M},getChatRoomMuteList:function(){return Ne},getChatRoomMuted:function(){return je},getChatRoomMutelist:function(){return Be},getChatRoomSharedFilelist:function(){return vr},getChatRoomWhitelist:function(){return yt},getChatRooms:function(){return N},getJoinedChatRooms:function(){return Xe},isChatRoomWhiteUser:function(){return Ir},isInChatRoomAllowlist:function(){return St},isInChatRoomMutelist:function(){return Wt},joinChatRoom:function(){return F},leaveChatRoom:function(){return W},listChatRoomMember:function(){return ne},listChatRoomMembers:function(){return ee},modifyChatRoom:function(){return x},muteChatRoomMember:function(){return Le},quitChatRoom:function(){return oe},removeChatRoomAdmin:function(){return ve},removeChatRoomAllowlistMember:function(){return er},removeChatRoomAttribute:function(){return le},removeChatRoomAttributes:function(){return Ae},removeChatRoomBlockMulti:function(){return qe},removeChatRoomBlockSingle:function(){return we},removeChatRoomMember:function(){return z},removeChatRoomMembers:function(){return I},removeChatRoomWhitelistMember:function(){return Ar},removeMultiChatRoomMember:function(){return Z},removeMuteChatRoomMember:function(){return Oe},removeSingleChatRoomMember:function(){return P},rmUsersFromChatRoomWhitelist:function(){return ir},setChatRoomAdmin:function(){return q},setChatRoomAttribute:function(){return ae},setChatRoomAttributes:function(){return mr},unblockChatRoomMember:function(){return ft},unblockChatRoomMembers:function(){return it},unmuteChatRoomMember:function(){return ge},updateChatRoomAnnouncement:function(){return Kt},uploadChatRoomSharedFile:function(){return At}}),c(1539),c(8674),c(8309),c(2526),c(1817),c(2222),c(9753),c(9600),c(1249),c(4916),c(3123),c(2165),c(6992),c(8783),c(3948);var p=c(5531),f=c(7252),T=c(4024),v=c(3246),S=c(7360),y=c(1595);function E(X){return E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(et){return typeof et}:function(et){return et&&typeof Symbol=="function"&&et.constructor===Symbol&&et!==Symbol.prototype?"symbol":typeof et},E(X)}function N(X){var et=this;if(typeof X.pagenum!="number"||typeof X.pagesize!="number")throw Error("Invalid parameter");if(!v.XZ.call(this)){var Me=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Me)}var He={pagenum:X.pagenum||1,pagesize:X.pagesize||20},Qe=this.context,ht=Qe.orgName,rt=Qe.appName,Ct=Qe.accessToken,xt={url:this.apiUrl+"/"+ht+"/"+rt+"/chatrooms",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Ct},data:He,success:function(Nt){typeof X.success=="function"&&X.success(Nt)},error:function(Nt){Nt.error&&Nt.error_description&&et.onError&&et.onError({type:p.E.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,message:Nt.error_description,data:Nt}),typeof X.error=="function"&&X.error(Nt)}};return S.kg.debug("Call getChatRooms",X),T.hj.call(this,xt,y.fI.GET_CHATROOM_LIST)}function C(X){if(typeof X.name!="string")throw Error("Invalid parameter");if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me={name:X.name,description:X.description,maxusers:X.maxusers,owner:this.user,members:X.members},He=this.context,Qe=He.orgName,ht=He.appName,rt=He.accessToken,Ct=He.jid,xt={url:"".concat(this.apiUrl,"/").concat(Qe,"/").concat(ht,"/chatrooms?resource=").concat(Ct.clientResource),dataType:"json",type:"POST",data:JSON.stringify(Me),headers:{Authorization:"Bearer "+(X.token||rt),"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call createChatRoom",X),T.hj.call(this,xt,y.fI.CREATE_CHATROOM)}function U(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error("Invalid parameter");if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(X.chatRoomId,"?resource=").concat(rt.clientResource,"&version=v3"),dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+(X.token||ht)},success:X.success,error:X.error};return S.kg.debug("Call destroyChatRoom",X),T.hj.call(this,Ct,y.fI.DESTROY_CHATROOM)}function M(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error("Invalid parameter");if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt={url:this.apiUrl+"/"+He+"/"+Qe+"/chatrooms/"+X.chatRoomId,dataType:"json",type:"GET",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call getChatRoomDetails",X),T.hj.call(this,rt,y.fI.GET_CHATROOM_DETAIL)}function x(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error("Invalid parameter");if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt={groupname:X.chatRoomName,description:X.description,maxusers:X.maxusers},Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"?resource=").concat(rt.clientResource),type:"PUT",data:JSON.stringify(xt),dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call modifyChatRoom",X),T.hj.call(this,Nt,y.fI.MODIFY_CHATROOM)}function P(X){if(typeof X.chatRoomId!="string"||X.chatRoomId===""||typeof X.username!="string")throw Error("Invalid parameter");if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt=X.username,Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/users/").concat(xt,"?resource=").concat(rt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call removeChatRoomMember",X),T.hj.call(this,Nt,y.fI.REMOVE_CHATROOM_MEMBER)}var z=P;function Z(X){if(typeof X.chatRoomId!="string"||X.chatRoomId===""||!Array.isArray(X.users))throw Error("Invalid parameter");if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=X.chatRoomId,He=X.users.join(","),Qe=this.context,ht=Qe.orgName,rt=Qe.appName,Ct=Qe.accessToken,xt=Qe.jid,Nt={url:"".concat(this.apiUrl,"/").concat(ht,"/").concat(rt,"/chatrooms/").concat(Me,"/users/").concat(He,"?resource=").concat(xt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ct,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call removeChatRoomMembers",X),T.hj.call(this,Nt,y.fI.MULTI_REMOVE_CHATROOM_MEMBER)}var I=Z;function Y(X){if(typeof X.chatRoomId!="string"||X.chatRoomId===""||!Array.isArray(X.users))throw Error("Invalid parameter");if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=X.chatRoomId,He={usernames:X.users},Qe=this.context,ht=Qe.orgName,rt=Qe.appName,Ct=Qe.accessToken,xt=Qe.jid,Nt={url:"".concat(this.apiUrl,"/").concat(ht,"/").concat(rt,"/chatrooms/").concat(Me,"/users?resource=").concat(xt.clientResource),type:"POST",data:JSON.stringify(He),dataType:"json",headers:{Authorization:"Bearer "+Ct,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call addUsersToChatRoom",X),T.hj.call(this,Nt,y.fI.ADD_USERS_TO_CHATROOM)}function F(X){var et=X.roomId,Me=X.message,He=Me===void 0?"":Me,Qe=X.ext,ht=Qe===void 0?"":Qe,rt=X.leaveOtherRooms,Ct=rt!==void 0&&rt,xt=X.success,Nt=X.error;if(typeof et!="string"||et==="")throw Error("Invalid parameter roomId");if(typeof ht!="string")throw Error("Invalid parameter ext");if(typeof Ct!="boolean")throw Error("Invalid parameter leaveOtherRooms");if(!v.XZ.call(this)){var yr=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(yr)}return S.kg.debug("Call joinChatRoom",X),this.logOut?Promise.reject({type:p.E.WEBIM_CONNECTION_CLOSED,message:"not login"}):this.mSync.handleChatRoom({roomId:et,ext:ht,leaveOtherRooms:Ct,message:He,success:xt,error:Nt},"join")}function oe(X){if(typeof X.roomId!="string"||X.roomId==="")throw Error("Invalid parameter");if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}return S.kg.debug("Call leaveChatRoom",X),this.logOut?Promise.reject({type:p.E.WEBIM_CONNECTION_CLOSED,message:"not login"}):this.mSync.handleChatRoom(X,"leave")}var W=oe;function ne(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(isNaN(X.pageNum)||X.pageNum<=0)throw Error('The parameter "pageNum" should be a positive number');if(isNaN(X.pageSize)||X.pageSize<=0)throw Error('The parameter "pageSize" should be a positive number');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me={pagenum:X.pageNum,pagesize:X.pageSize},He=this.context,Qe=He.orgName,ht=He.appName,rt=He.accessToken,Ct={url:this.apiUrl+"/"+Qe+"/"+ht+"/chatrooms/"+X.chatRoomId+"/users",dataType:"json",type:"GET",data:Me,headers:{Authorization:"Bearer "+rt,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call listChatRoomMembers",X),T.hj.call(this,Ct,y.fI.LIST_CHATROOM_MEMBERS)}var ee=ne;function H(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=X.chatRoomId,Ct={url:this.apiUrl+"/"+He+"/"+Qe+"/chatrooms/"+rt+"/admin",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call getChatRoomAdmin",X),T.hj.call(this,Ct,y.fI.GET_CHATROOM_ADMIN)}function q(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof X.username!="string"||X.username==="")throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt={newadmin:X.username},Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/admin?resource=").concat(rt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(xt),headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call setChatRoomAdmin",X),T.hj.call(this,Nt,y.fI.SET_CHATROOM_ADMIN)}function ve(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof X.username!="string"||X.username==="")throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt=X.username,Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/admin/").concat(xt,"?resource=").concat(rt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call removeChatRoomAdmin",X),T.hj.call(this,Nt,y.fI.REMOVE_CHATROOM_ADMIN)}function Le(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "groupId"');if(typeof X.username!="string"||X.username==="")throw Error('Invalid parameter: "username"');if(typeof X.muteDuration!="number")throw Error('Invalid parameter: "muteDuration"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt={usernames:[X.username],mute_duration:X.muteDuration},Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/mute?resource=").concat(rt.clientResource),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},data:JSON.stringify(xt),success:X.success,error:X.error};return S.kg.debug("Call muteChatRoomMember",X),T.hj.call(this,Nt,y.fI.MUTE_CHATROOM_MEMBER)}function Oe(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof X.username!="string"||X.username==="")throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt=X.username,Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/mute/").concat(xt,"?resource=").concat(rt.clientResource),dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call unmuteChatRoomMember",X),T.hj.call(this,Nt,y.fI.REMOVE_MUTE_CHATROOM_MEMBER)}var ge=Oe;function je(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=X.chatRoomId,Ct={url:this.apiUrl+"/"+He+"/"+Qe+"/chatrooms/"+rt+"/mute",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call getChatRoomMutelist",X),T.hj.call(this,Ct,y.fI.GET_MUTE_CHATROOM_MEMBERS)}var Ne=je,Be=je;function Ye(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof X.username!="string"||X.username==="")throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt=X.username,Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/blocks/users/").concat(xt,"?resource=").concat(rt.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call blockChatRoomMember",X),T.hj.call(this,Nt,y.fI.SET_CHATROOM_MEMBER_TO_BLACK)}var pt=Ye;function dt(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!Array.isArray(X.usernames))throw Error('Invalid parameter: "usernames"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt={usernames:X.usernames},Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/blocks/users?resource=").concat(rt.clientResource),data:JSON.stringify(xt),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Chat blockChatRoomMembers:",Nt),T.hj.call(this,Nt,y.fI.MULTI_SET_CHATROOM_MEMBER_TO_BLACK)}var Ie=dt;function we(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof X.username!="string"||X.username==="")throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt=X.username,Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/blocks/users/").concat(xt,"?resource=").concat(rt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call unblockChatRoomMember",X),T.hj.call(this,Nt,y.fI.REMOVE_CHATROOM_MEMBER_BLACK)}var ft=we;function qe(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!Array.isArray(X.usernames))throw Error('Invalid parameter: "usernames"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt=X.usernames.join(","),Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/blocks/users/").concat(xt,"?resource=").concat(rt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call unblockChatRoomMembers",X),T.hj.call(this,Nt,y.fI.MULTI_REMOVE_CHATROOM_MEMBER_BLACK)}var it=qe;function Tt(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=X.chatRoomId,Ct={url:this.apiUrl+"/"+He+"/"+Qe+"/chatrooms/"+rt+"/blocks/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call getChatRoomBlocklist",X),T.hj.call(this,Ct,y.fI.GET_CHATROOM_BLOCK_MEMBERS)}var Pt=Tt,bt=Tt;function jt(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/ban?resource=").concat(rt.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call disableSendChatRoomMsg",X),T.hj.call(this,xt,y.fI.DISABLED_CHATROOM_SEND_MSG)}function Lt(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/ban?resource=").concat(rt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call enableSendChatRoomMsg",X),T.hj.call(this,xt,y.fI.ENABLE_CHATROOM_SEND_MSG)}function Gt(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!Array.isArray(X.users))throw Error('Invalid parameter: "users"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt={usernames:X.users},Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/white/users?resource=").concat(rt.clientResource),type:"POST",data:JSON.stringify(xt),dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call addUsersToChatRoomWhitelist",X),T.hj.call(this,Nt,y.fI.ADD_USERS_TO_CHATROOM)}var pr=Gt;function ir(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof X.userName!="string"||X.userName==="")throw Error('Invalid parameter: "userName"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.chatRoomId,xt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/white/users/").concat(X.userName,"?resource=").concat(rt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call removeChatRoomAllowlistMember",X),T.hj.call(this,xt,y.fI.REMOVE_CHATROOM_WHITE_USERS)}var Ar=ir,er=ir;function yt(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=X.chatRoomId,Ct={url:this.apiUrl+"/"+He+"/"+Qe+"/chatrooms/"+rt+"/white/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call getChatRoomAllowlist",X),T.hj.call(this,Ct,y.fI.GET_CHATROOM_WHITE_USERS)}var Xt=yt;function Ir(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(typeof X.userName!="string"||X.userName==="")throw Error('Invalid parameter: "userName"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=X.chatRoomId,Ct={url:this.apiUrl+"/"+He+"/"+Qe+"/chatrooms/"+rt+"/white/users/"+X.userName,type:"GET",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call isInChatRoomAllowlist",X),T.hj.call(this,Ct,y.fI.CHECK_CHATROOM_WHITE_USER)}var St=Ir;function Wt(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error('Invalid parameter: "chatRoomId"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.userId,Ct={url:this.apiUrl+"/"+He+"/"+Qe+"/sdk/chatrooms/"+X.chatRoomId+"/mute/"+rt,dataType:"json",type:"GET",headers:{Authorization:"Bearer "+ht}};return S.kg.debug("Call isInChatRoomMutelist",X),T.hj.call(this,Ct).then(function(xt){return{type:xt.type,data:xt.data}})}function Zt(X){if(typeof X.roomId!="string"||X.roomId==="")throw Error('Invalid parameter: "roomId"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=X.roomId,Ct={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(rt,"/announcement"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call fetchChatRoomAnnouncement",X),T.hj.call(this,Ct,y.fI.GET_CHATROOM_ANN)}function Kt(X){if(typeof X.roomId!="string"||X.roomId==="")throw Error('Invalid parameter: "roomId"');if(typeof X.announcement!="string")throw Error('Invalid parameter: "announcement"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.roomId,xt={announcement:X.announcement},Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/announcement?resource=").concat(rt.clientResource),type:"POST",dataType:"json",data:JSON.stringify(xt),headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call updateChatRoomAnnouncement:",X),T.hj.call(this,Nt,y.fI.UPDATE_CHATROOM_ANN)}function At(X){if(typeof X.roomId!="string"||X.roomId==="")throw Error('Invalid parameter: "roomId"');if(E(X.file)!=="object")throw Error('Invalid parameter: "file"');if(v.XZ.call(this)){var et=this.context,Me=et.orgName,He=et.appName,Qe=et.accessToken,ht=et.jid,rt=X.roomId;T.cT.call(this,{uploadUrl:"".concat(this.apiUrl,"/").concat(Me,"/").concat(He,"/chatrooms/").concat(rt,"/share_files?resource=").concat(ht.clientResource),onFileUploadProgress:X.onFileUploadProgress,onFileUploadComplete:X.onFileUploadComplete,onFileUploadError:X.onFileUploadError,onFileUploadCanceled:X.onFileUploadCanceled,accessToken:Qe,apiUrl:this.apiUrl,file:X.file,appKey:this.context.appKey},y.fI.UPLOAD_CHATROOM_FILE),S.kg.debug("Call uploadChatRoomSharedFile",X)}}function vt(X){if(typeof X.roomId!="string"||X.roomId==="")throw Error('Invalid parameter: "roomId"');if(typeof X.fileId!="string"||X.fileId==="")throw Error('Invalid parameter: "fileId"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.jid,Ct=X.roomId,xt=X.fileId,Nt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(Ct,"/share_files/").concat(xt,"?resource=").concat(rt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"},success:X.success,error:X.error};return S.kg.debug("Call deleteChatRoomSharedFile",X),T.hj.call(this,Nt,y.fI.DELETE_CHATROOM_FILE)}function zt(X){if(typeof X.roomId!="string"||X.roomId==="")throw Error('Invalid parameter: "roomId"');if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=X.roomId,Ct={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/chatrooms/").concat(rt,"/share_files"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json",accept:"application/json"},success:X.success,error:X.error};return S.kg.debug("Call fetchChatRoomSharedFileList",X),T.hj.call(this,Ct,y.fI.GET_CHATROOM_FILES)}var vr=zt;function or(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error("Invalid parameter chatRoomId: "+X.chatRoomId);if(X.attributeKeys&&!Array.isArray(X.attributeKeys))throw Error('"Invalid parameter attributeKeys": '+X.attributeKeys);if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=(Me.jid,X.chatRoomId),Ct={keys:X.attributeKeys},xt={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/metadata/chatroom/").concat(rt),type:"POST",dataType:"json",data:JSON.stringify(Ct),headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"}};return S.kg.debug("Call getChatRoomAttributes:",X),T.hj.call(this,xt,y.fI.GET_CHATROOM_ATTR).then(function(Nt){return{data:Nt.data,type:Nt.type}})}function mr(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error("Invalid parameter chatRoomId: "+X.chatRoomId);if(E(X.attributes)!=="object")throw Error("Invalid parameter attributes: "+X.attributes);if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.userId,Ct=X.chatRoomId,xt=X.attributes,Nt=X.autoDelete,yr=Nt===void 0||Nt,w=X.isForced?"/forced":"",te={metaData:xt,autoDelete:yr?"DELETE":"NO_DELETE"},Re={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/metadata/chatroom/").concat(Ct,"/user/").concat(rt)+w,type:"PUT",dataType:"json",data:JSON.stringify(te),headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"}};return S.kg.debug("Call setChatRoomAttributes:",X),T.hj.call(this,Re,y.fI.SET_CHATROOM_ATTR).then(function(re){return(0,v._W)(re)})}function ae(X){var et;if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error("Invalid parameter chatRoomId: "+X.chatRoomId);if(typeof X.attributeKey!="string"||X.attributeKey==="")throw Error("Invalid parameter attributeKey: "+X.attributeKey);if(typeof X.attributeValue!="string"||X.attributeValue==="")throw Error("Invalid parameter attributeValue: "+X.attributeValue);if(!v.XZ.call(this)){var Me=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Me)}var He=this.context,Qe=He.orgName,ht=He.appName,rt=He.accessToken,Ct=He.userId,xt=X.chatRoomId,Nt=X.attributeKey,yr=X.attributeValue,w=X.autoDelete,te=w===void 0||w,Re=X.isForced?"/forced":"",re={metaData:(et={},et[Nt]=yr,et),autoDelete:te?"DELETE":"NO_DELETE"},Ee={url:"".concat(this.apiUrl,"/").concat(Qe,"/").concat(ht,"/metadata/chatroom/").concat(xt,"/user/").concat(Ct)+Re,type:"PUT",dataType:"json",data:JSON.stringify(re),headers:{Authorization:"Bearer "+rt,"Content-Type":"application/json"}};return S.kg.debug("Call setChatRoomAttribute:",X),T.hj.call(this,Ee,y.fI.SET_CHATROOM_ATTR).then(function(Ge){var he=(0,v.H7)(Ge);if(he)throw he})}function Ae(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error("Invalid parameter chatRoomId: "+X.chatRoomId);if(!Array.isArray(X.attributeKeys))throw Error('"Invalid parameter attributes": '+X.attributeKeys);if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.userId,Ct=X.chatRoomId,xt=X.attributeKeys,Nt=X.isForced?"/forced":"",yr={keys:xt},w={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/metadata/chatroom/").concat(Ct,"/user/").concat(rt)+Nt,type:"DELETE",dataType:"json",data:JSON.stringify(yr),headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"}};return S.kg.debug("Call removeChatRoomAttributes:",X),T.hj.call(this,w,y.fI.DELETE_CHATROOM_ATTR).then(function(te){return(0,v._W)(te)})}function le(X){if(typeof X.chatRoomId!="string"||X.chatRoomId==="")throw Error("Invalid parameter chatRoomId: "+X.chatRoomId);if(typeof X.attributeKey!="string"||X.attributeKey==="")throw Error('"Invalid parameter attributeKey": '+X.attributeKey);if(!v.XZ.call(this)){var et=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(et)}var Me=this.context,He=Me.orgName,Qe=Me.appName,ht=Me.accessToken,rt=Me.userId,Ct=X.chatRoomId,xt=X.attributeKey,Nt=X.isForced?"/forced":"",yr={keys:[xt]},w={url:"".concat(this.apiUrl,"/").concat(He,"/").concat(Qe,"/metadata/chatroom/").concat(Ct,"/user/").concat(rt)+Nt,type:"DELETE",dataType:"json",data:JSON.stringify(yr),headers:{Authorization:"Bearer "+ht,"Content-Type":"application/json"}};return S.kg.debug("Call removeChatRoomAttribute:",X),T.hj.call(this,w,y.fI.DELETE_CHATROOM_ATTR).then(function(te){var Re=(0,v.H7)(te);if(Re)throw Re})}function Xe(X){var et=this,Me=X||{},He=Me.pageNum,Qe=Me.pageSize;if(isNaN(He)||He<=0)throw Error("Invalid parameter pageNum:".concat(He));if(isNaN(Qe)||Qe<=0)throw Error("Invalid parameter pageSize:".concat(Qe));if(!v.XZ.call(this)){var ht=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ht)}var rt={pagenum:He,pagesize:Qe,detail:!0},Ct=this.context,xt=Ct.orgName,Nt=Ct.appName,yr=Ct.accessToken,w={url:"".concat(this.apiUrl,"/").concat(xt,"/").concat(Nt,"/users/").concat(this.user,"/joined_chatrooms"),dataType:"json",type:"GET",data:rt,headers:{Authorization:"Bearer "+yr,"Content-Type":"application/json"}};return S.kg.debug("Call getJoinedChatRooms",X),T.hj.call(this,w,y.fI.GET_USER_JOINED_CHATROOM).then(function(te){var Re=(te.data||[]).map(function(re){var Ee=re.id,Ge=re.title,he=re.owner,$e=re.created,ye=re.description,lt=re.max_users;return{id:Ee,name:Ge,owner:he.split("".concat(et.appKey,"_"))[1],created:$e,description:ye,maxusers:lt}});return{type:te.type,data:Re}})}},4363:function(O,j,c){c.d(j,{U:function(){return S},w:function(){return y}}),c(9601),c(2772),c(1249);var p=c(7360),f=c(8161),T=c(4024),v=function(){return v=Object.assign||function(E){for(var N,C=1,U=arguments.length;C<U;C++)for(var M in N=arguments[C])Object.prototype.hasOwnProperty.call(N,M)&&(E[M]=N[M]);return E},v.apply(this,arguments)},S={chat:"singleChat",chatroom:"chatRoom",groupchat:"groupChat",singleChat:"singleChat",chatRoom:"chatRoom",groupChat:"groupChat"};function y(E,N){var C,U,M,x=N||{},P=x.formatCustomExts,z=P===void 0||P,Z=x.formatChatType,I=Z!==void 0&&Z,Y=E.id,F=E.payload,oe=E.timestamp,W=E.to,ne=F.bodies&&F.bodies.length>0?F.bodies[0]:{},ee={},H={},q=F.type?F.type:W.indexOf("@conference.easemob.com")>-1?"groupChat":"singleChat";q=q==="chat"?"singleChat":q,I&&F.type&&(q=S[F.type]);var ve="";switch(ne.type){case"txt":if(Object.prototype.hasOwnProperty.call(ne,"subType")&&ne.subType==="sub_combine")ve=f.t.call(this,{remotePath:ne?.url,secret:ne?.secret}),ee={id:Y,type:"combine",chatType:q,to:F.to,from:F.from,ext:F.ext,time:oe,title:ne.title||"",summary:ne.summary||"",url:ve||"",secret:ne.secret||"",file_length:ne.file_length||0,filename:ne.filename||"",compatibleText:ne.msg,combineLevel:ne.combineLevel||0};else{var Le=(C=F?.meta)===null||C===void 0?void 0:C.edit_msg;if(ee={id:Y,type:"txt",chatType:q,msg:ne.msg||"",to:F.to||"",from:F.from,time:oe,ext:F.ext},Le){var Oe=Le.edit_time,ge=Le.operator,je=Le.count;ee.modifiedInfo={operationTime:Oe,operatorId:ge,operationCount:je}}}break;case"img":ve=this.useOwnUploadFun?ne?.url:f.t.call(this,{remotePath:ne?.url,secret:ne?.secret}),ee={id:Y,type:"img",chatType:q,to:F.to,from:F.from,time:oe,ext:F.ext,width:((U=ne.size)===null||U===void 0?void 0:U.width)||0,height:((M=ne.size)===null||M===void 0?void 0:M.height)||0,thumb:this.useOwnUploadFun?"":"".concat(ve,"&thumbnail=true"),thumb_secret:ne.secret,secret:ne.secret||"",url:ve||"",file_length:ne.file_length||0,file:{}};break;case"video":ve=this.useOwnUploadFun?ne?.url:f.t.call(this,{remotePath:ne?.url,secret:ne?.secret}),ee={id:Y,type:"video",chatType:q,from:F.from,to:F.to,thumb:T.P6.formatAttachUrl.call(this,ne.thumb),thumb_secret:ne.thumb_secret||"",url:ve||"",secret:ne.secret||"",filename:ne.filename,length:ne.length||0,file:{},file_length:ne.file_length||0,filetype:F.ext.file_type||"",ext:F.ext,time:oe};break;case"loc":ee={id:Y,type:"loc",chatType:q,from:F.from,to:F.to,buildingName:ne.buildingName||"",addr:ne.addr,lat:ne.lat,lng:ne.lng,ext:F.ext,time:oe};break;case"audio":ve=this.useOwnUploadFun?ne?.url:f.t.call(this,{remotePath:ne?.url,secret:ne?.secret}),ee={id:Y,type:"audio",chatType:q,from:F.from,to:F.to,secret:ne.secret||"",ext:F.ext,time:oe,url:ve||"",file:{},filename:ne.filename,length:ne.length||0,file_length:ne.file_length||0,filetype:F.ext.file_type||""};break;case"file":ve=this.useOwnUploadFun?ne?.url:f.t.call(this,{remotePath:ne?.url,secret:ne?.secret}),ee={id:Y,type:"file",chatType:q,from:F.from,to:F.to,ext:F.ext,time:oe,url:ve||"",secret:ne.secret||"",file:{},filename:ne.filename||"",file_length:ne.file_length||0,filetype:F.ext.file_type||""};break;case"cmd":ee={id:Y,type:"cmd",chatType:q,from:F.from,to:F.to,ext:F.ext,time:oe,action:ne.action||""};break;case"custom":var Ne=ne.customExts||{};z&&ne.customExts&&(Ne={},ne.customExts.map(function(Ye){Ne=v(v({},Ne),Ye)})),ee={id:Y,type:"custom",chatType:q,from:F.from,to:F.to,ext:F.ext,time:oe,customEvent:ne.customEvent||"",customExts:Ne};break;case"combine":ve=f.t.call(this,{remotePath:ne?.url,secret:ne?.secret}),ee={id:Y,type:"combine",chatType:q,msg:ne.msg||"",to:F.to||"",from:F.from,time:oe,ext:F.ext,title:ne.title||"",summary:ne.summary||"",url:ve||"",compatibleText:ne.text,combineLevel:ne.combineLevel||0,secret:ne.secret||"",filename:ne.filename||"",file_length:ne.file_length||0};break;default:p.kg.error("unexpected message: ".concat(E))}if(F.msgConfig&&(H.msgConfig=F.msgConfig),F?.meta){var Be=F.meta;Be.thread&&(H.chatThread={messageId:Be.thread.msg_parent_id,parentId:Be.thread.muc_parent_id,chatThreadName:Be.thread.thread_name}),Be.reaction&&(H.reactions=Be.reaction),Be.translations&&(H.translations=Be.translations)}return v(v({},ee),H)}},2856:function(O,j,c){c.r(j),c.d(j,{acceptGroupInvite:function(){return Pt},acceptGroupJoinRequest:function(){return ft},addUsersToGroupAllowlist:function(){return Me},addUsersToGroupWhitelist:function(){return et},agreeInviteIntoGroup:function(){return Tt},agreeJoinGroup:function(){return we},blockGroup:function(){return x},blockGroupMember:function(){return Kt},blockGroupMembers:function(){return vt},blockGroupMessages:function(){return P},changeGroupOwner:function(){return oe},changeOwner:function(){return F},createGroup:function(){return M},createGroupNew:function(){return U},deleteGroupSharedFile:function(){return Ge},destroyGroup:function(){return Ne},disableSendGroupMsg:function(){return Xe},dissolveGroup:function(){return je},downloadGroupSharedFile:function(){return ye},enableSendGroupMsg:function(){return X},fetchGroupAnnouncement:function(){return Re},fetchGroupSharedFileList:function(){return he},getGroup:function(){return I},getGroupAdmin:function(){return q},getGroupAllowlist:function(){return Ct},getGroupBlacklist:function(){return Ae},getGroupBlacklistNew:function(){return ae},getGroupBlocklist:function(){return le},getGroupInfo:function(){return W},getGroupMemberAttributes:function(){return Ze},getGroupMembersAttributes:function(){return Dt},getGroupMsgReadUser:function(){return te},getGroupMuteList:function(){return St},getGroupMutelist:function(){return Wt},getGroupSharedFilelist:function(){return $e},getGroupWhitelist:function(){return rt},getJoinedGroups:function(){return Y},getMuted:function(){return Ir},getPublicGroups:function(){return Z},groupBlockMulti:function(){return At},groupBlockSingle:function(){return Zt},inviteToGroup:function(){return pt},inviteUsersToGroup:function(){return dt},isGroupWhiteUser:function(){return xt},isInGroupAllowlist:function(){return yr},isInGroupMutelist:function(){return w},isInGroupWhiteList:function(){return Nt},joinGroup:function(){return Ie},leaveGroup:function(){return Ye},listGroupMember:function(){return ee},listGroupMembers:function(){return H},listGroups:function(){return z},modifyGroup:function(){return ne},mute:function(){return Ar},muteGroupMember:function(){return er},quitGroup:function(){return Be},rejectGroupInvite:function(){return jt},rejectGroupJoinRequest:function(){return it},rejectInviteIntoGroup:function(){return bt},rejectJoinGroup:function(){return qe},removeAdmin:function(){return Oe},removeGroupAdmin:function(){return ge},removeGroupAllowlistMember:function(){return ht},removeGroupBlockMulti:function(){return or},removeGroupBlockSingle:function(){return zt},removeGroupMember:function(){return Gt},removeGroupMembers:function(){return ir},removeGroupWhitelistMember:function(){return Qe},removeMultiGroupMember:function(){return pr},removeMute:function(){return yt},removeSingleGroupMember:function(){return Lt},rmUsersFromGroupWhitelist:function(){return He},setAdmin:function(){return ve},setGroupAdmin:function(){return Le},setGroupMemberAttributes:function(){return lt},unblockGroupMember:function(){return vr},unblockGroupMembers:function(){return mr},unmuteGroupMember:function(){return Xt},updateGroupAnnouncement:function(){return re},uploadGroupSharedFile:function(){return Ee}}),c(1539),c(8674),c(2526),c(1817),c(2165),c(6992),c(8783),c(3948),c(2222),c(6699),c(2023),c(9554),c(4747),c(8309),c(9753),c(9600);var p=c(5531),f=c(7252),T=c(4024),v=c(3246),S=c(7360),y=c(1595);function E(Q){return E=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Te){return typeof Te}:function(Te){return Te&&typeof Symbol=="function"&&Te.constructor===Symbol&&Te!==Symbol.prototype?"symbol":typeof Te},E(Q)}var N=function(Q,Te,pe,Ue){return new(pe||(pe=Promise))(function(xe,Fe){function Je(mt){try{kt(Ue.next(mt))}catch(Jt){Fe(Jt)}}function ct(mt){try{kt(Ue.throw(mt))}catch(Jt){Fe(Jt)}}function kt(mt){var Jt;mt.done?xe(mt.value):(Jt=mt.value,Jt instanceof pe?Jt:new pe(function(Rr){Rr(Jt)})).then(Je,ct)}kt((Ue=Ue.apply(Q,[])).next())})},C=function(Q,Te){var pe,Ue,xe,Fe,Je={label:0,sent:function(){if(1&xe[0])throw xe[1];return xe[1]},trys:[],ops:[]};return Fe={next:ct(0),throw:ct(1),return:ct(2)},typeof Symbol=="function"&&(Fe[Symbol.iterator]=function(){return this}),Fe;function ct(kt){return function(mt){return function(Jt){if(pe)throw new TypeError("Generator is already executing.");for(;Je;)try{if(pe=1,Ue&&(xe=2&Jt[0]?Ue.return:Jt[0]?Ue.throw||((xe=Ue.return)&&xe.call(Ue),0):Ue.next)&&!(xe=xe.call(Ue,Jt[1])).done)return xe;switch(Ue=0,xe&&(Jt=[2&Jt[0],xe.value]),Jt[0]){case 0:case 1:xe=Jt;break;case 4:return Je.label++,{value:Jt[1],done:!1};case 5:Je.label++,Ue=Jt[1],Jt=[0];continue;case 7:Jt=Je.ops.pop(),Je.trys.pop();continue;default:if(!((xe=(xe=Je.trys).length>0&&xe[xe.length-1])||Jt[0]!==6&&Jt[0]!==2)){Je=0;continue}if(Jt[0]===3&&(!xe||Jt[1]>xe[0]&&Jt[1]<xe[3])){Je.label=Jt[1];break}if(Jt[0]===6&&Je.label<xe[1]){Je.label=xe[1],xe=Jt;break}if(xe&&Je.label<xe[2]){Je.label=xe[2],Je.ops.push(Jt);break}xe[2]&&Je.ops.pop(),Je.trys.pop();continue}Jt=Te.call(Q,Je)}catch(Rr){Jt=[6,Rr],Ue=0}finally{pe=xe=0}if(5&Jt[0])throw Jt[1];return{value:Jt[0]?Jt[1]:void 0,done:!0}}([kt,mt])}}};function U(Q){if(!Q||!Q.data)throw Error("Invalid parameter");if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups?resource=").concat(Je.clientResource),dataType:"json",type:"POST",data:JSON.stringify({owner:this.user,groupname:Q.data.groupname,desc:Q.data.desc,members:Q.data.members,public:Q.data.public,approval:Q.data.approval,allowinvites:Q.data.allowinvites,invite_need_confirm:Q.data.inviteNeedConfirm,maxusers:Q.data.maxusers,custom:Q.data.ext}),headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:function(kt){Q.success&&Q.success(kt)},error:Q.error};return S.kg.debug("Call createGroup:",Q),T.hj.call(this,ct,y.fI.CREATE_GROUP)}var M=U;function x(Q){var Te;if(typeof Q.groupId!="string"||Q.groupId==="")throw Error("Invalid parameter");if(!v.XZ.call(this)){var pe=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(pe)}var Ue=this.context,xe=Ue.orgName,Fe=Ue.appName,Je=Ue.accessToken,ct=Ue.jid,kt={entities:[(Te={},Te["notification_ignore_"+Q.groupId]=!0,Te)]},mt={type:"PUT",url:"".concat(this.apiUrl,"/").concat(xe,"/").concat(Fe,"/users/").concat(this.user,"?resource=").concat(ct.clientResource),data:JSON.stringify(kt),dataType:"json",headers:{Authorization:"Bearer "+Je,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call blockGroupMessages",Q),T.hj.call(this,mt,y.fI.BLOCK_GROUP)}var P=x;function z(Q){if(typeof Q.limit!="number")throw Error("Invalid parameter");if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je={limit:Q.limit,cursor:Q.cursor};Q.cursor||delete Je.cursor;var ct={url:this.apiUrl+"/"+Ue+"/"+xe+"/publicchatgroups",type:"GET",dataType:"json",data:Je,headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call listGroups",Q),T.hj.call(this,ct,y.fI.LIST_GROUP)}var Z=z;function I(Q){if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je={url:this.apiUrl+"/"+Ue+"/"+xe+"/users/"+this.user+"/joined_chatgroups",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q&&Q?.success,error:Q&&Q?.error};return S.kg.debug("Call getJoinedGroups",Q),T.hj.call(this,Je,y.fI.GET_USER_GROUP)}function Y(Q){if(typeof Q.pageNum!="number"||typeof Q.pageSize!="number")throw Error('Invalid parameter: "pageNum or pageSize"');if(Q.pageNum<0||Q.pageSize<0)throw Error('"pageNum" should >= 0 and "pageSize" should >= 0');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=Q.needAffiliations||Q.needRole?"/chatgroups/user/".concat(this.user,"?pagenum=").concat(Q.pageNum,"&pagesize=").concat(Q.pageSize,"&needAffiliations=").concat(Q.needAffiliations,"&needRole=").concat(Q.needRole):"/users/".concat(this.user,"/joined_chatgroups?pagenum=").concat(Q.pageNum,"&pagesize=").concat(Q.pageSize),ct={url:this.apiUrl+"/"+Ue+"/"+xe+Je,dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q&&Q?.success,error:Q&&Q?.error};return S.kg.debug("Call getGroup",Q),T.hj.call(this,ct,y.fI.GET_USER_GROUP).then(function(kt){var mt=kt.uri,Jt=kt.entities,Rr=[];return mt.includes("joined_chatgroups")||(Jt.forEach(function(Or){var It={affiliationsCount:Or.affiliations_count,groupName:Or.name,groupId:Or.groupId,role:Or.permission,disabled:Or.disabled,approval:Or.membersonly,allowInvites:Or.allowinvites,description:Or.description,maxUsers:Or.maxusers,public:Or.public};Rr.push(It)}),kt.entities=Rr),kt})}function F(Q){if(typeof Q.groupId!="string"||typeof Q.newOwner!="string")throw Error("Invalid parameter");if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe={newowner:Q.newOwner},Ue=this.context,xe=Ue.orgName,Fe=Ue.appName,Je=Ue.accessToken,ct=Ue.jid,kt={url:"".concat(this.apiUrl,"/").concat(xe,"/").concat(Fe,"/chatgroups/").concat(Q.groupId,"?resource=").concat(ct.clientResource),type:"PUT",dataType:"json",headers:{Authorization:"Bearer "+Je,"Content-Type":"application/json"},data:JSON.stringify(pe),success:Q.success,error:Q.error};return S.kg.debug("Call changeOwner",Q),T.hj.call(this,kt,y.fI.CHANGE_OWNER)}var oe=F;function W(Q){if(typeof Q.groupId!="string"&&!Array.isArray(Q.groupId))throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je={url:this.apiUrl+"/"+Ue+"/"+xe+"/chatgroups/"+Q.groupId+"?joined_time=true",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call getGroupInfo",Q),T.hj.call(this,Je,y.fI.GET_GROUP_INFO)}function ne(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error("Invalid parameter");if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={groupname:Q.groupName,description:Q.description,custom:Q.ext},mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"?resource=").concat(Je.clientResource),type:"PUT",data:JSON.stringify(kt),dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call modifyGroup",Q),T.hj.call(this,mt,y.fI.MODIFY_GROUP)}function ee(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(isNaN(Q.pageNum)||Q.pageNum<=0)throw Error('The parameter "pageNum" should be a positive number');if(isNaN(Q.pageSize)||Q.pageSize<=0)throw Error('The parameter "pageSize" should be a positive number');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe={pagenum:Q.pageNum,pagesize:Q.pageSize},Ue=this.context,xe=Ue.orgName,Fe=Ue.appName,Je=Ue.accessToken,ct={url:this.apiUrl+"/"+xe+"/"+Fe+"/chatgroups/"+Q.groupId+"/users",dataType:"json",type:"GET",data:pe,headers:{Authorization:"Bearer "+Je,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call listGroupMember",Q),T.hj.call(this,ct,y.fI.LIST_GROUP_MEMBER)}var H=ee;function q(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=Q.groupId,ct={url:this.apiUrl+"/"+Ue+"/"+xe+"/chatgroups/"+Je+"/admin",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call getGroupAdmin",Q),T.hj.call(this,ct,y.fI.GET_GROUP_ADMIN)}function ve(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.username!="string"||Q.username==="")throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={newadmin:Q.username},mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/admin?resource=").concat(Je.clientResource),type:"POST",dataType:"json",data:JSON.stringify(kt),headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call setGroupAdmin",Q),T.hj.call(this,mt,y.fI.SET_GROUP_ADMIN)}var Le=ve;function Oe(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.username!="string"||Q.username==="")throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt=Q.username,mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/admin/").concat(kt,"?resource=").concat(Je.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call removeAdmin",Q),T.hj.call(this,mt,y.fI.REMOVE_GROUP_ADMIN)}var ge=Oe;function je(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"?version=v3&resource=").concat(Je.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call destroyGroup",Q),T.hj.call(this,kt,y.fI.DISSOLVE_GROUP)}var Ne=je;function Be(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/quit?resource=").concat(Je.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call quitGroup",Q),T.hj.call(this,kt,y.fI.QUIT_GROUP)}var Ye=Be;function pt(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(Q.users))throw Error('Invalid parameter: "users"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=Q.groupId,Ue={usernames:Q.users},xe=this.context,Fe=xe.orgName,Je=xe.appName,ct=xe.accessToken,kt=xe.jid,mt={url:"".concat(this.apiUrl,"/").concat(Fe,"/").concat(Je,"/chatgroups/").concat(pe,"/invite?resource=").concat(kt.clientResource),type:"POST",data:JSON.stringify(Ue),dataType:"json",headers:{Authorization:"Bearer "+ct,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call inviteUsersToGroup",Q),T.hj.call(this,mt,y.fI.INVITE_TO_GROUP)}var dt=pt;function Ie(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(Q.groupId,"/apply?resource=").concat(Je.clientResource),type:"POST",dataType:"json",data:JSON.stringify({message:Q.message||""}),headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call joinGroup",Q),T.hj.call(this,ct,y.fI.JOIN_GROUP)}function we(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.applicant!="string"||Q.applicant==="")throw Error('Invalid parameter: "applicant"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={applicant:Q.applicant,verifyResult:!0,reason:"no clue"},mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/apply_verify?resource=").concat(Je.clientResource),type:"POST",dataType:"json",data:JSON.stringify(kt),headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call agreeJoinGroup",Q),T.hj.call(this,mt,y.fI.AGREE_JOIN_GROUP)}var ft=we;function qe(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.applicant!="string"||Q.applicant==="")throw Error('Invalid parameter: "applicant"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={applicant:Q.applicant,verifyResult:!1,reason:Q.reason||""},mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/apply_verify?resource=").concat(Je.clientResource),type:"POST",dataType:"json",data:JSON.stringify(kt),headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call rejectGroupJoinRequest",Q),T.hj.call(this,mt,y.fI.REJECT_JOIN_GROUP)}var it=qe;function Tt(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.invitee!="string"||Q.invitee==="")throw Error('Invalid parameter: "invitee"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={invitee:Q.invitee,verifyResult:!0},mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/invite_verify?resource=").concat(Je.clientResource),type:"POST",dataType:"json",data:JSON.stringify(kt),headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call acceptGroupInvite",Q),T.hj.call(this,mt,y.fI.AGREE_INVITE_GROUP)}var Pt=Tt;function bt(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.invitee!="string"||Q.invitee==="")throw Error('Invalid parameter: "invitee"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={invitee:Q.invitee,verifyResult:!1},mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/invite_verify?resource=").concat(Je.clientResource),type:"POST",dataType:"json",data:JSON.stringify(kt),headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call rejectGroupInvite",Q),T.hj.call(this,mt,y.fI.REJECT_INVITE_GROUP)}var jt=bt;function Lt(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.username!="string"||Q.username==="")throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=Q.groupId,Ue=Q.username,xe=this.context,Fe=xe.orgName,Je=xe.appName,ct=xe.accessToken,kt=xe.jid,mt={url:"".concat(this.apiUrl,"/").concat(Fe,"/").concat(Je,"/chatgroups/").concat(pe,"/users/").concat(Ue,"?resource=").concat(kt.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ct,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call removeGroupMember",Q),T.hj.call(this,mt,y.fI.REMOVE_GROUP_MEMBER)}var Gt=Lt;function pr(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(Q.users))throw Error('Invalid parameter: "users"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt=Q.users.join(","),mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/users/").concat(kt,"?resource=").concat(Je.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call removeGroupMembers",Q),T.hj.call(this,mt,y.fI.MULTI_REMOVE_GROUP_MEMBER)}var ir=pr;function Ar(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!(Array.isArray(Q.username)||typeof Q.username=="string"&&Q.username!==""))throw Error('Invalid parameter: "username"');if(typeof Q.muteDuration!="number")throw Error('Invalid parameter: "muteDuration"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={usernames:typeof Q.username=="string"?[Q.username]:Q.username,mute_duration:Q.muteDuration},mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/mute?resource=").concat(Je.clientResource),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},data:JSON.stringify(kt),success:Q.success,error:Q.error};return S.kg.debug("Call muteGroupMember",Q),T.hj.call(this,mt,y.fI.MUTE_GROUP_MEMBER)}var er=Ar;function yt(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!(Array.isArray(Q.username)||typeof Q.username=="string"&&Q.username!==""))throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt=Q.username,mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/mute/").concat(kt,"?resource=").concat(Je.clientResource),dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call unmuteGroupMember",Q),T.hj.call(this,mt,y.fI.UNMUTE_GROUP_MEMBER)}var Xt=yt;function Ir(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=Q.groupId,ct={url:this.apiUrl+"/"+Ue+"/"+xe+"/chatgroups/"+Je+"/mute",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call getGroupMuteList",Q),T.hj.call(this,ct,y.fI.GET_GROUP_MUTE_LIST)}var St=Ir,Wt=Ir;function Zt(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.username!="string"||Q.username==="")throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt=Q.username,mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/blocks/users/").concat(kt,"?resource=").concat(Je.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call blockGroupMember",Q),T.hj.call(this,mt,y.fI.BLOCK_GROUP_MEMBER)}var Kt=Zt;function At(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(Q.usernames))throw Error('Invalid parameter: "usernames"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={usernames:Q.usernames},mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/blocks/users?resource=").concat(Je.clientResource),data:JSON.stringify(kt),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call blockGroupMembers",Q),T.hj.call(this,mt,y.fI.BLOCK_GROUP_MEMBERS)}var vt=At;function zt(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.username!="string"||Q.username==="")throw Error('Invalid parameter: "username"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt=Q.username,mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/blocks/users/").concat(kt,"?resource=").concat(Je.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call unblockGroupMember",Q),T.hj.call(this,mt,y.fI.UNBLOCK_GROUP_MEMBER)}var vr=zt;function or(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(Q.usernames))throw Error('Invalid parameter: "usernames"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt=Q.usernames.join(","),mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/blocks/users/").concat(kt,"?resource=").concat(Je.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call unblockGroupMembers",Q),T.hj.call(this,mt,y.fI.UNBLOCK_GROUP_MEMBERS)}var mr=or;function ae(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=Q.groupId,ct={url:this.apiUrl+"/"+Ue+"/"+xe+"/chatgroups/"+Je+"/blocks/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call getGroupBlacklist",Q),T.hj.call(this,ct,y.fI.GET_GROUP_BLACK_LIST)}var Ae=ae,le=ae;function Xe(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/ban?resource=").concat(Je.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call disableSendGroupMsg",Q),T.hj.call(this,kt,y.fI.DISABLED_SEND_GROUP_MSG)}function X(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/ban?resource=").concat(Je.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call enableSendGroupMsg",Q),T.hj.call(this,kt,y.fI.ENABLE_SEND_GROUP_MSG)}function et(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(Q.users))throw Error('Invalid parameter: "users"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={usernames:Q.users},mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/white/users?resource=").concat(Je.clientResource),type:"POST",data:JSON.stringify(kt),dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call addUsersToGroupWhitelist",Q),T.hj.call(this,mt,y.fI.ADD_USERS_TO_GROUP_WHITE)}var Me=et;function He(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.userName!="string"||Q.userName==="")throw Error('Invalid parameter: "userName"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/white/users/").concat(Q.userName,"?resource=").concat(Je.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call removeGroupAllowlistMember",Q),T.hj.call(this,kt,y.fI.REMOVE_GROUP_WHITE_MEMBER)}var Qe=He,ht=He;function rt(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=Q.groupId,ct={url:this.apiUrl+"/"+Ue+"/"+xe+"/chatgroups/"+Je+"/white/users",type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call getGroupAllowlist",Q),T.hj.call(this,ct,y.fI.GET_GROUP_WHITE_LIST)}var Ct=rt;function xt(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.userName!="string"||Q.userName==="")throw Error('Invalid parameter: "userName"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=Q.groupId,ct={url:this.apiUrl+"/"+Ue+"/"+xe+"/chatgroups/"+Je+"/white/users/"+Q.userName,type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call isInGroupAllowlist",Q),T.hj.call(this,ct,y.fI.IS_IN_GROUP_WHITE_LIST)}var Nt=xt,yr=xt;function w(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.userId,ct={url:this.apiUrl+"/"+Ue+"/"+xe+"/sdk/chatgroups/"+Q.groupId+"/mute/"+Je,dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Fe}};return S.kg.debug("Call isInGroupMutelist",Q),T.hj.call(this,ct).then(function(kt){return{type:kt.type,data:kt.data}})}function te(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.msgId!="string"||Q.msgId==="")throw Error('Invalid parameter: "msgId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je={url:this.apiUrl+"/"+Ue+"/"+xe+"/chatgroups/"+Q.groupId+"/acks/"+Q.msgId,dataType:"json",type:"GET",data:{limit:500,key:void 0},headers:{Authorization:"Bearer "+Fe},success:Q.success,error:Q.error};return S.kg.debug("Call getGroupMsgReadUser",Q),T.hj.call(this,Je,y.fI.GET_GROUP_MSG_READ_USER)}function Re(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=Q.groupId,ct={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(Je,"/announcement"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call fetchGroupAnnouncement",Q),T.hj.call(this,ct,y.fI.GET_GROUP_ANN)}function re(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.announcement!="string")throw Error('Invalid parameter: "announcement"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt={announcement:Q.announcement},mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/announcement?resource=").concat(Je.clientResource),type:"POST",dataType:"json",data:JSON.stringify(kt),headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call updateGroupAnnouncement",Q),T.hj.call(this,mt,y.fI.UPDATE_GROUP_ANN)}function Ee(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(E(Q.file)!=="object")throw Error('Invalid parameter: "file"');if(v.XZ.call(this)){var Te=this.context,pe=Te.orgName,Ue=Te.appName,xe=Te.accessToken,Fe=Te.jid,Je=Q.groupId;T.cT.call(this,{uploadUrl:"".concat(this.apiUrl,"/").concat(pe,"/").concat(Ue,"/chatgroups/").concat(Je,"/share_files?resource=").concat(Fe.clientResource),onFileUploadProgress:Q.onFileUploadProgress,onFileUploadComplete:Q.onFileUploadComplete,onFileUploadError:Q.onFileUploadError,onFileUploadCanceled:Q.onFileUploadCanceled,accessToken:xe,apiUrl:this.apiUrl,file:Q.file,appKey:this.context.appKey},y.fI.UPLOAD_GROUP_FILE),S.kg.debug("Call uploadGroupSharedFile",Q)}}function Ge(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(typeof Q.fileId!="string"||Q.fileId==="")throw Error('Invalid parameter: "file"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=pe.jid,ct=Q.groupId,kt=Q.fileId,mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(ct,"/share_files/").concat(kt,"?resource=").concat(Je.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call deleteGroupSharedFile",Q),T.hj.call(this,mt,y.fI.DELETE_GROUP_FILE)}function he(Q){if(typeof Q.groupId!="string"||Q.groupId==="")throw Error('Invalid parameter: "groupId"');if(!v.XZ.call(this)){var Te=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Te)}var pe=this.context,Ue=pe.orgName,xe=pe.appName,Fe=pe.accessToken,Je=Q.pageNum||1,ct=Q.pageSize||10,kt=Q.groupId,mt={url:"".concat(this.apiUrl,"/").concat(Ue,"/").concat(xe,"/chatgroups/").concat(kt,"/share_files?pagenum=").concat(Je,"&pagesize=").concat(ct),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Fe,"Content-Type":"application/json"},success:Q.success,error:Q.error};return S.kg.debug("Call getGroupSharedFilelist",Q),T.hj.call(this,mt,y.fI.GET_GROUP_FILE_LIST)}var $e=he;function ye(Q){var Te=this.context,pe=Te.orgName,Ue=Te.appName,xe=Te.accessToken,Fe=this.apiUrl,Je=Q.groupId,ct=Q.fileId;T.LR.call(this,{url:"".concat(Fe,"/").concat(pe,"/").concat(Ue,"/chatgroups/").concat(Je,"/share_files/").concat(ct),onFileDownloadComplete:Q.onFileDownloadComplete,onFileDownloadError:Q.onFileDownloadError,accessToken:xe,id:ct,secret:Q.secret},y.fI.DOWN_GROUP_FILE),S.kg.debug("Call downloadGroupSharedFile",Q)}function lt(Q){return N(this,void 0,void 0,function(){var Te,pe,Ue,xe,Fe,Je,ct,kt,mt,Jt,Rr;return C(this,function(Or){switch(Or.label){case 0:if(Te=Q.groupId,pe=Q.userId,Ue=Q.memberAttributes,typeof Te!="string"||Te==="")throw Error('Invalid parameter: "groupId"');if(typeof pe!="string"||pe==="")throw Error('Invalid parameter: "userId"');if(E(Ue)!=="object")throw Error('Invalid parameter: "memberAttributes"');return v.XZ.call(this)?(Fe=this.context,Je=Fe.orgName,ct=Fe.appName,kt=Fe.accessToken,mt=Fe.jid,Jt={metaData:Ue},Rr={url:"".concat(this.apiUrl,"/").concat(Je,"/").concat(ct,"/sdk/metadata/chatgroup/").concat(Te,"/user/").concat(pe,"?resource=").concat(mt.clientResource),type:"PUT",dataType:"json",data:JSON.stringify(Jt),headers:{Authorization:"Bearer "+kt,"Content-Type":"application/json"}},S.kg.debug("Call setGroupMemberAttributes",Q),[4,T.hj.call(this,Rr,y.fI.SET_GROUP_MEMBER_ATTRS)]):(xe=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(xe)]);case 1:return Or.sent(),[2]}})})}function Ze(Q){var Te=Q.groupId,pe=Q.userId;return Dt.call(this,{groupId:Te,userIds:[pe]}).then(function(Ue){var xe;return{type:Ue.type,data:(xe=Ue.data)===null||xe===void 0?void 0:xe[pe]}})}function Dt(Q){var Te=Q.groupId,pe=Q.userIds,Ue=Q.keys,xe=Ue===void 0?[]:Ue;if(typeof Te!="string"||Te==="")throw Error('Invalid parameter: "groupId"');if(!Array.isArray(pe)||pe?.length<=0)throw Error('Invalid parameter: "userIds"');if(!Array.isArray(xe))throw Error('Invalid parameter: "keys"');if(!v.XZ.call(this)){var Fe=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Fe)}var Je=this.context,ct=Je.orgName,kt=Je.appName,mt=Je.accessToken,Jt={targets:pe,properties:xe},Rr={url:"".concat(this.apiUrl,"/").concat(ct,"/").concat(kt,"/sdk/metadata/chatgroup/").concat(Te,"/get"),type:"POST",dataType:"json",data:JSON.stringify(Jt),headers:{Authorization:"Bearer "+mt,"Content-Type":"application/json"}};return S.kg.debug("Call getGroupMembersAttributes",Q),T.hj.call(this,Rr,y.fI.GET_GROUP_MEMBER_ATTR).then(function(Or){return{type:Or.type,data:Or?.data||{}}})}},7479:function(O,j,c){c.r(j),c.d(j,{acceptContactInvite:function(){return bt},acceptInvitation:function(){return Pt},addContact:function(){return qe},addConversationMark:function(){return et},addReaction:function(){return St},addToBlackList:function(){return Gt},addUsersToBlacklist:function(){return pr},addUsersToBlocklist:function(){return ir},declineContactInvite:function(){return Lt},declineInvitation:function(){return jt},deleteAllMessagesAndConversations:function(){return ht},deleteContact:function(){return Tt},deleteConversation:function(){return je},deleteReaction:function(){return Wt},deleteSession:function(){return ge},fetchHistoryMessages:function(){return Ie},fetchUserInfoById:function(){return Ye},getAllContacts:function(){return le},getBlacklist:function(){return oe},getBlocklist:function(){return W},getContacts:function(){return ee},getContactsWithCursor:function(){return Xe},getConversationlist:function(){return Le},getHistoryMessages:function(){return ft},getReactionDetail:function(){return At},getReactionList:function(){return Zt},getReactionlist:function(){return Kt},getRoster:function(){return ne},getSelfIdsOnOtherPlatform:function(){return Qe},getServerConversations:function(){return vr},getServerConversationsByFilter:function(){return He},getServerPinnedConversations:function(){return mr},getServerPinnedMessages:function(){return Nt},getSessionList:function(){return ve},getTokenExpireTimestamp:function(){return dt},modifyMessage:function(){return Ir},pinConversation:function(){return ae},pinMessage:function(){return Ct},recallMessage:function(){return Xt},removeConversationMark:function(){return Me},removeFromBlackList:function(){return Ar},removeHistoryMessages:function(){return zt},removeRoster:function(){return it},removeUserFromBlackList:function(){return er},removeUserFromBlocklist:function(){return yt},reportMessage:function(){return vt},setContactRemark:function(){return Ae},unbindPushToken:function(){return yr},unpinMessage:function(){return xt},updateCurrentUserNick:function(){return pt},updateOwnUserInfo:function(){return Ne},updateUserInfo:function(){return Be},uploadPushToken:function(){return q},uploadToken:function(){return H}}),c(9601),c(1539),c(8674),c(2526),c(1817),c(2165),c(6992),c(8783),c(3948),c(9554),c(4747),c(2222),c(7941),c(6699),c(3710),c(9714),c(9600),c(5069),c(561),c(9753),c(8309),c(1249),c(7327);var p=c(3246),f=c(5531),T=c(7252),v=c(4024),S=c(9937),y=c(8161),E=c(4188),N=c.n(E),C=c(7360),U=c(1595),M=c(4363),x=c(7288),P=c(9743),z=c(6801),Z=function(){return Z=Object.assign||function(w){for(var te,Re=1,re=arguments.length;Re<re;Re++)for(var Ee in te=arguments[Re])Object.prototype.hasOwnProperty.call(te,Ee)&&(w[Ee]=te[Ee]);return w},Z.apply(this,arguments)},I=function(w,te,Re,re){return new(Re||(Re=Promise))(function(Ee,Ge){function he(lt){try{ye(re.next(lt))}catch(Ze){Ge(Ze)}}function $e(lt){try{ye(re.throw(lt))}catch(Ze){Ge(Ze)}}function ye(lt){var Ze;lt.done?Ee(lt.value):(Ze=lt.value,Ze instanceof Re?Ze:new Re(function(Dt){Dt(Ze)})).then(he,$e)}ye((re=re.apply(w,[])).next())})},Y=function(w,te){var Re,re,Ee,Ge,he={label:0,sent:function(){if(1&Ee[0])throw Ee[1];return Ee[1]},trys:[],ops:[]};return Ge={next:$e(0),throw:$e(1),return:$e(2)},typeof Symbol=="function"&&(Ge[Symbol.iterator]=function(){return this}),Ge;function $e(ye){return function(lt){return function(Ze){if(Re)throw new TypeError("Generator is already executing.");for(;he;)try{if(Re=1,re&&(Ee=2&Ze[0]?re.return:Ze[0]?re.throw||((Ee=re.return)&&Ee.call(re),0):re.next)&&!(Ee=Ee.call(re,Ze[1])).done)return Ee;switch(re=0,Ee&&(Ze=[2&Ze[0],Ee.value]),Ze[0]){case 0:case 1:Ee=Ze;break;case 4:return he.label++,{value:Ze[1],done:!1};case 5:he.label++,re=Ze[1],Ze=[0];continue;case 7:Ze=he.ops.pop(),he.trys.pop();continue;default:if(!((Ee=(Ee=he.trys).length>0&&Ee[Ee.length-1])||Ze[0]!==6&&Ze[0]!==2)){he=0;continue}if(Ze[0]===3&&(!Ee||Ze[1]>Ee[0]&&Ze[1]<Ee[3])){he.label=Ze[1];break}if(Ze[0]===6&&he.label<Ee[1]){he.label=Ee[1],Ee=Ze;break}if(Ee&&he.label<Ee[2]){he.label=Ee[2],he.ops.push(Ze);break}Ee[2]&&he.ops.pop(),he.trys.pop();continue}Ze=te.call(w,he)}catch(Dt){Ze=[6,Dt],re=0}finally{Re=Ee=0}if(5&Ze[0])throw Ze[1];return{value:Ze[0]?Ze[1]:void 0,done:!0}}([ye,lt])}}},F={singleChat:"chat",chatRoom:"chatroom",groupChat:"groupchat"};function oe(w){if(!p.XZ.call(this)){var te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(te)}var Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he={url:this.apiUrl+"/"+re+"/"+Ee+"/users/"+this.user+"/blocks/users",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Ge},success:function($e){$e.data.forEach(function(ye){}),typeof w?.success=="function"&&w.success($e)},error:function($e){typeof w?.error=="function"&&w.error($e)}};return C.kg.debug("Call getBlocklist"),v.hj.call(this,he,U.fI.GET_BLACK_LIST)}var W=oe,ne=ee;function ee(w){var te=this;if(!p.XZ.call(this)){var Re=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Re)}var re=this.context,Ee=re.orgName,Ge=re.appName,he=re.accessToken,$e={url:this.apiUrl+"/"+Ee+"/"+Ge+"/users/"+this.user+"/contacts/users",dataType:"json",type:"GET",headers:{Authorization:"Bearer "+he},success:function(ye){var lt=[];ye.data.forEach(function(Ze){lt.push({name:Ze,subscription:"both",jid:te.context.jid})}),typeof w?.success=="function"&&w.success(lt)},error:function(ye){typeof w?.error=="function"&&w.error(ye)}};return C.kg.debug("Call getContacts"),v.hj.call(this,$e,U.fI.GET_CONTACTS)}function H(w){return C.kg.debug("Call uploadPushToken"),z.r.call(this,w)}var q=H;function ve(w){if(!p.XZ.call(this)){var te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(te)}var Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he={url:"".concat(this.apiUrl,"/").concat(re,"/").concat(Ee,"/users/").concat(this.user,"/user_channels"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Ge,"Content-Type":"application/json"},success:w&&w?.success,error:w&&w?.error};return C.kg.debug("Call getSessionList"),v.hj.call(this,he,U.fI.GET_SESSION_LIST)}function Le(w){var te=this;if(!p.XZ.call(this)){var Re=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Re)}var re=this.context,Ee=re.orgName,Ge=re.appName,he=re.accessToken,$e=!!(w&&typeof w.pageNum=="number"&&typeof w.pageSize=="number"&&w.pageNum>0&&w.pageSize>0),ye={url:"".concat(this.apiUrl,"/").concat(Ee,"/").concat(Ge,"/users/").concat(this.user,"/user_channels").concat($e?"/page":""),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+he,"Content-Type":"application/json"},success:w&&w?.success,error:w&&w?.error};return $e&&(ye.data={pageNum:w.pageNum,pageSize:w.pageSize}),C.kg.debug("Call getConversationlist"),v.hj.call(this,ye,U.fI.GET_SESSION_LIST).then(function(lt){return Oe.call(te,lt)})}function Oe(w){var te=this,Re=w.data.channel_infos;return Re?.forEach(function(re){re.meta&&JSON.stringify(re.meta)!=="{}"?(re.meta.payload=JSON.parse(re.meta.payload),re.lastMessage=M.w.call(te,re.meta,{formatCustomExts:!1})):re.lastMessage=re.meta,delete re.meta}),w}function ge(w){if(w&&typeof w.channel!="string")throw Error("Invalid parameter channel: ".concat(w.channel));if(w&&w.chatType!=="singleChat"&&w.chatType!=="groupChat")throw Error("Invalid parameter chatType: ".concat(w.chatType));if(w&&typeof w.deleteRoam!="boolean")throw Error("Invalid parameter deleteRoam: ".concat(w.deleteRoam));if(!p.XZ.call(this)){var te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(te)}var Re,re=this.context,Ee=re.orgName,Ge=re.appName,he=re.accessToken,$e=re.jid;Re=w.chatType==="singleChat"?"chat":"groupChat";var ye={url:"".concat(this.apiUrl,"/").concat(Ee,"/").concat(Ge,"/user/").concat(this.user,"/user_channel?resource=").concat($e.clientResource),dataType:"json",type:"DELETE",data:JSON.stringify({channel:w.channel,type:Re,delete_roam:w.deleteRoam}),headers:{Authorization:"Bearer "+he,"Content-Type":"application/json"},success:w.success,error:w.error};return C.kg.debug("Call deleteSession",w),v.hj.call(this,ye,U.fI.DELETE_SESSION)}var je=ge;function Ne(w,te){if(!p.XZ.call(this)){var Re=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Re)}var re=this.context,Ee=re.orgName,Ge=re.appName,he=re.accessToken,$e=["nickname","avatarurl","mail","phone","gender","sign","birth","ext"],ye={},lt=v.P6.getEnvInfo();if(lt.platform==="wx"||lt.platform==="qq")if(typeof w=="string"&&te!==void 0){if(!$e.includes(w))throw new Error("illegal key, only these keys: nickname, avatarurl, mail, phone, gender, sign, birth, ext are allowed");ye[w]=te}else{if(Object.prototype.toString.call(w)!=="[object Object]")throw new Error("illegal params");$e.forEach(function(Q){$e.includes(Q)&&w[Q]!==void 0&&(ye[Q]=w[Q])})}else if(typeof w=="string"){if(!$e.includes(w))throw new Error("illegal key, only these keys: nickname, avatarurl, mail, phone, gender, sign, birth, ext are allowed");ye=w+"="+te}else{if(Object.prototype.toString.call(w)!=="[object Object]")throw new Error("illegal params");var Ze=[];$e.forEach(function(Q){if($e.includes(Q)&&w[Q]!==void 0){var Te=encodeURIComponent(Q),pe=encodeURIComponent(w[Q]);Ze.push(Te+"="+pe)}}),ye=Ze.join("&")}var Dt={url:"".concat(this.apiUrl,"/").concat(Ee,"/").concat(Ge,"/metadata/user/").concat(this.user),type:"PUT",data:ye,dataType:"json",headers:{Authorization:"Bearer "+he,"Content-Type":"application/x-www-form-urlencoded"}};return C.kg.debug("Call updateOwnUserInfo",w),v.hj.call(this,Dt,U.fI.UPDATE_USER_INFO)}var Be=Ne;function Ye(w,te){if(!p.XZ.call(this)){var Re=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Re)}var re,Ee=this.context,Ge=Ee.orgName,he=Ee.appName,$e=Ee.accessToken,ye=[];if(typeof w=="string")ye=[w];else{if(Object.prototype.toString.call(w)!=="[object Array]")throw new Error("illegal params");ye=w}re=typeof te=="string"?[te]:te&&Object.prototype.toString.call(te)==="[object Array]"?te:["nickname","avatarurl","mail","phone","gender","sign","birth","ext"];var lt={url:"".concat(this.apiUrl,"/").concat(Ge,"/").concat(he,"/metadata/user/get"),type:"POST",data:JSON.stringify({targets:ye,properties:re}),dataType:"json",headers:{Authorization:"Bearer "+$e,"Content-Type":"application/json"}};return C.kg.debug("Call fetchUserInfoById",w),v.hj.call(this,lt,U.fI.GET_USER_INFO)}function pt(w){if(!p.XZ.call(this)){var te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(te)}var Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he={url:"".concat(this.apiUrl,"/").concat(re,"/").concat(Ee,"/users/").concat(this.user),type:"PUT",dataType:"json",data:JSON.stringify({nickname:w}),headers:{Authorization:"Bearer "+Ge,"Content-Type":"application/json"}};return C.kg.debug("Call updateCurrentUserNick",w),v.hj.call(this,he)}function dt(w){if(typeof w!="string"||w==="")throw Error('Invalid parameter: "token"');var te=this.context,Re=te.orgName,re=te.appName,Ee={url:"".concat(this.apiUrl,"/").concat(Re,"/").concat(re,"/sdk/users/").concat(this.user,"/token/expires"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+w,"Content-Type":"application/json"}};return C.kg.debug("Call getTokenExpireTimestamp",w),v.hj.call(this,Ee,U.fI.SDK_INTERNAL)}function Ie(w){var te=this;return new Promise(function(Re,re){if(!w.queue)throw Error('Invalid parameter: "specified"');if(!p.XZ.call(te)){var Ee=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ee)}(function Ge(he){var $e=this,ye=he.count||20;we.call(this,{count:ye,isGroup:!!he.isGroup,queue:he.queue,start:he.start,format:he.format,success:function(lt){if(lt.msgs.length>=ye||lt.is_last){var Ze=lt.msgs.splice(0,ye).reverse();he.success&&he.success(Ze),Re(Ze)}else Ge.call($e,Z(Z({},he),{start:null}))},fail:function(lt){re(lt),he.fail&&he.fail(lt)}})}).call(te,w),C.kg.debug("Call fetchHistoryMessages",w)})}function we(w){var te=this,Re=w.queue,re=this.mr_cache[Re]||(this.mr_cache[Re]={msgs:[]}),Ee=this.context.userId,Ge=w.start||-1,he=w.count||20;if(re.msgs.length>=he||re.is_last)typeof w.success=="function"&&w.success(re);else{re&&re.next_key&&(Ge=re.next_key),w.start&&(Ge=w.start);var $e={queue:Re+(w.isGroup?"@conference.easemob.com":"@easemob.com"),start:Ge,end:-1},ye=this.context,lt=ye.orgName,Ze=ye.appName,Dt={url:"".concat(this.apiUrl,"/").concat(lt,"/").concat(Ze,"/users/").concat(Ee,"/messageroaming"),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"},data:JSON.stringify($e),success:function(Q){return I(te,void 0,void 0,function(){var Te,pe,Ue,xe,Fe,Je,ct=this;return Y(this,function(kt){switch(kt.label){case 0:if(Te=Q?.data,!Q.data.msgs)return typeof w.success=="function"&&w.success(re),re.is_last=!0,re.next_key="",[2];pe=Te.msgs,Ue=pe.length,re.is_last=Te.is_last,re.next_key=Te.next_key,xe=function(mt){return I(ct,void 0,void 0,function(){var Jt,Rr,Or,It,Sr;return Y(this,function(Yr){switch(Yr.label){case 0:for(Jt=[],mt=N().atob(mt),Rr=0,Or=mt.length;Rr<Or;++Rr)Jt.push(mt.charCodeAt(Rr));return It=(It=this.context.root.lookup("easemob.pb.Meta")).decode(Jt),Sr={errorCode:0,reason:""},It.ns!==1?[3,2]:[4,y.Z.call(this,It,Sr,!0,w.format)];case 1:return[2,Yr.sent()];case 2:return[2]}})})},Fe=0,kt.label=1;case 1:return Fe<Ue?[4,xe(pe[Fe].msg)]:[3,4];case 2:(Je=kt.sent())&&re.msgs.push(Je),kt.label=3;case 3:return Fe++,[3,1];case 4:return typeof w.success=="function"&&w.success(re),[2]}})})},error:function(Q){if(Q.error&&Q.error_description){var Te=T.Z.create({type:f.E.WEBIM_CONNCTION_AJAX_ERROR,message:"fetch history messages error",data:Q});te.onError&&te.onError(Te)}}};v.hj.call(this,Dt,U.fI.GET_HISTORY_MSG).catch(function(Q){typeof w.fail=="function"&&w.fail(Q)})}}function ft(w){var te=this;return new Promise(function(Re,re){var Ee=w.targetId,Ge=w.cursor,he=Ge===void 0?-1:Ge,$e=w.pageSize,ye=$e===void 0?20:$e,lt=w.chatType,Ze=w.searchDirection,Dt=w.searchOptions,Q=Dt===void 0?{}:Dt,Te=Q.msgTypes,pe=Te===void 0?[]:Te,Ue=Q.startTime,xe=Ue===void 0?null:Ue,Fe=Q.endTime,Je=Fe===void 0?null:Fe,ct=Q.from,kt=ct===void 0?null:ct;if(typeof Ee!="string"||Ee==="")throw Error('"Invalid parameter": "targetId"');if(kt&&typeof kt!="string")throw Error('"Invalid parameter": "searchOptions.from"');if(pe&&!Array.isArray(pe))throw Error('"Invalid parameter": "searchOptions.msgTypes"');if(xe&&typeof xe!="number")throw Error('"Invalid parameter": "searchOptions.startTime"');if(Je&&typeof xe!="number")throw Error('"Invalid parameter": "searchOptions.endTime"');if(!p.XZ.call(te)){var mt=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return re(mt)}var Jt=te.context,Rr=Jt.orgName,Or=Jt.appName,It=Jt.userId,Sr=w.chatType==="singleChat"?"@easemob.com":"@conference.easemob.com",Yr={queue:"".concat(Ee).concat(Sr),start:he,pull_number:ye,is_positive:Ze==="down",msgType:pe.join(",")||"",end:-1,startTime:xe,endTime:Je,userId:lt==="singleChat"?null:kt},xr={url:"".concat(te.apiUrl,"/").concat(Rr,"/").concat(Or,"/users/").concat(It,"/messageroaming"),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+te.token,"Content-Type":"application/json"},data:JSON.stringify(Yr),success:function(Tn){return I(te,void 0,void 0,function(){var Cn,Oi,li,Zr,ma,Co,mn,ys,Wo=this;return Y(this,function(Ko){switch(Ko.label){case 0:Cn=Tn?.data,Oi=Cn.msgs||[],li=function(Wi){return I(Wo,void 0,void 0,function(){var zo,qo,Ss,ja,ic;return Y(this,function(Tr){switch(Tr.label){case 0:for(zo=[],Wi=N().atob(Wi),qo=0,Ss=Wi.length;qo<Ss;++qo)zo.push(Wi.charCodeAt(qo));return ja=(ja=this.context.root.lookup("easemob.pb.Meta")).decode(zo),ic={errorCode:0,reason:""},ja.ns!==1?[3,2]:[4,y.Z.call(this,ja,ic,!0,!0)];case 1:return[2,Tr.sent()];case 2:return[2]}})})},Zr=[],ma=0,Ko.label=1;case 1:return ma<Oi.length?[4,li(Oi[ma].msg)]:[3,4];case 2:(Co=Ko.sent())&&Zr.push(Co),Ko.label=3;case 3:return ma++,[3,1];case 4:return Cn.msgs=Zr,mn={cursor:Cn.next_key,messages:Zr,isLast:Cn.is_last},(ys=w.success)===null||ys===void 0||ys.call(w,mn),Re(mn),[2]}})})},error:w.fail};v.hj.call(te,xr).catch(function(Tn){re(Tn)}),C.kg.debug("Call getHistoryMessages",w)})}function qe(w,te){return I(this,void 0,void 0,function(){var Re,re,Ee,Ge,he,$e,ye;return Y(this,function(lt){switch(lt.label){case 0:if(!p.XZ.call(this))return Re=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(Re)];if(typeof w!="string"||w==="")throw Error('"Invalid parameter": "to"');return C.kg.debug("Call addContact",w,te),re=this.context,Ee=re.orgName,Ge=re.appName,he=re.accessToken,$e=re.jid,ye={url:"".concat(this.apiUrl,"/").concat(Ee,"/").concat(Ge,"/users/").concat(this.user,"/contacts/apply?resource=").concat($e.clientResource),type:"POST",dataType:"json",data:JSON.stringify({usernames:[w],reason:te}),headers:{Authorization:"Bearer "+he,"Content-Type":"application/json"}},[4,v.hj.call(this,ye,U.fI.ROSTER_ADD)];case 1:return lt.sent(),[2]}})})}var it=Tt;function Tt(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e;return Y(this,function(ye){switch(ye.label){case 0:if(!p.XZ.call(this))return te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)];if(typeof w!="string"||w==="")throw Error('"Invalid parameter": "to"');return C.kg.debug("Call deleteContact",w),Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he=Re.jid,$e={url:"".concat(this.apiUrl,"/").concat(re,"/").concat(Ee,"/users/").concat(this.user,"/contacts/users/").concat(w,"?resource=").concat(he.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ge,"Content-Type":"application/json"}},[4,v.hj.call(this,$e,U.fI.ROSTER_REMOVE)];case 1:return ye.sent(),[2]}})})}function Pt(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e;return Y(this,function(ye){switch(ye.label){case 0:if(!p.XZ.call(this))return te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)];if(typeof w!="string"||w==="")throw Error('"Invalid parameter": "to"');return C.kg.debug("Call acceptInvitation",w),Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he=Re.jid,$e={url:"".concat(this.apiUrl,"/").concat(re,"/").concat(Ee,"/users/").concat(this.user,"/contacts/accept/users/").concat(w,"?resource=").concat(he.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Ge,"Content-Type":"application/json"}},[4,v.hj.call(this,$e,U.fI.ROSTER_ACCEPT)];case 1:return ye.sent(),[2]}})})}var bt=Pt;function jt(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e;return Y(this,function(ye){switch(ye.label){case 0:if(!p.XZ.call(this))return te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)];if(typeof w!="string"||w==="")throw Error('"Invalid parameter": "to"');return C.kg.debug("Call declineInvitation",w),Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he=Re.jid,$e={url:"".concat(this.apiUrl,"/").concat(re,"/").concat(Ee,"/users/").concat(this.user,"/contacts/decline/users/").concat(w,"?resource=").concat(he.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Ge,"Content-Type":"application/json"}},[4,v.hj.call(this,$e,U.fI.ROSTER_DECLINE)];case 1:return ye.sent(),[2]}})})}var Lt=jt;function Gt(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e,ye,lt;return Y(this,function(Ze){switch(Ze.label){case 0:if(!p.XZ.call(this))return te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)];if(Re=w.name,re=[],typeof Re=="string"){if(Re==="")throw Error('"Invalid parameter": "name"');re=[Re]}else{if(!Array.isArray(Re))throw Error('"Invalid parameter": "name"');re=Re}return C.kg.debug("Call addToBlockList",w),Ee=this.context,Ge=Ee.orgName,he=Ee.appName,$e=Ee.accessToken,ye=Ee.jid,lt={url:"".concat(this.apiUrl,"/").concat(Ge,"/").concat(he,"/sdk/user/").concat(this.user,"/blocks?resource=").concat(ye.clientResource),type:"POST",dataType:"json",data:JSON.stringify({usernames:re}),headers:{Authorization:"Bearer "+$e,"Content-Type":"application/json"}},[4,v.hj.call(this,lt,U.fI.ROSTER_BAN).then(function(Dt){return{type:Dt.type,data:{userIds:Dt?.data||[]}}})];case 1:return[2,Ze.sent()]}})})}var pr=Gt,ir=Gt;function Ar(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e,ye,lt;return Y(this,function(Ze){switch(Ze.label){case 0:if(!p.XZ.call(this))return te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)];if(Re=w.name,re=[],typeof Re=="string"){if(Re==="")throw Error('"Invalid parameter": "name"');re=[Re]}else{if(!Array.isArray(Re))throw Error('"Invalid parameter": "name"');re=Re}return C.kg.debug("Call removeFromBlockList",w),Ee=this.context,Ge=Ee.orgName,he=Ee.appName,$e=Ee.accessToken,ye=Ee.jid,lt={url:"".concat(this.apiUrl,"/").concat(Ge,"/").concat(he,"/sdk/user/").concat(this.user,"/blocks?resource=").concat(ye.clientResource),type:"DELETE",dataType:"json",data:JSON.stringify({usernames:re}),headers:{Authorization:"Bearer "+$e,"Content-Type":"application/json"}},[4,v.hj.call(this,lt,U.fI.ROSTER_ALLOW)];case 1:return Ze.sent(),[2]}})})}var er=Ar,yt=Ar;function Xt(w){var te=this,Re=w?.ext||"";if(typeof Re!="string")throw Error('"Invalid parameter": "ext"',Re);var re=this.getUniqueId(),Ee={id:re,to:w.to};this._msgHash[re]=Z({},Ee);var Ge="";w.chatType!==void 0?Ge=w.chatType:w.type!==void 0&&(Ge=w.type==="chat"?"singleChat":w.type);var he={id:re,type:"recall",chatType:Ge,ackId:w.mid,to:w.to,isChatThread:w.isChatThread||!1,metaExt:Re,success:function($e){return I(te,void 0,void 0,function(){var ye,lt,Ze,Dt,Q,Te,pe,Ue,xe;return Y(this,function(Fe){switch(Fe.label){case 0:return Fe.trys.push([0,5,,6]),Ge!=="singleChat"&&Ge!=="groupChat"?[3,4]:[4,(Ze=(lt=this._localCache)===null||lt===void 0?void 0:lt.getInstance())===null||Ze===void 0?void 0:Ze.removeMsgByServerMsgId(w.mid)];case 1:return Fe.sent(),[4,(Q=(Dt=this._localCache)===null||Dt===void 0?void 0:Dt.getInstance())===null||Q===void 0?void 0:Q.getConversationLastMessage(w.to,Ge)];case 2:return ye=Fe.sent(),[4,(pe=(Te=this._localCache)===null||Te===void 0?void 0:Te.getInstance())===null||pe===void 0?void 0:pe.updateLocalConversation((0,P.MQ)({conversationId:w.to,conversationType:Ge}),{lastMessageId:ye?.serverMsgId})];case 3:Fe.sent(),Fe.label=4;case 4:return(Ue=w?.success)===null||Ue===void 0||Ue.call(w,$e),[3,6];case 5:return Fe.sent(),(xe=w?.success)===null||xe===void 0||xe.call(w,$e),[3,6];case 6:return[2]}})})},fail:w.fail};return C.kg.debug("Call recallMessage",w),this.mSync.send(he,this)}function Ir(w){var te=w||{},Re=te.messageId,re=te.modifiedMessage;if(C.kg.debug("Call modifyMessage",Re,re),Re==="")throw Error('Invalid parameter: "messageId"');if(re.type!=="txt")throw Error('Invalid parameter: "modifiedMessage.type"');return this.mSync.send(Z({editMessageId:Re},re))}function St(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e,ye,lt;return Y(this,function(Ze){switch(Ze.label){case 0:if(typeof w.messageId!="string"||!w.messageId)throw Error("Invalid parameter messageId: ".concat(w.messageId));if(typeof w.reaction!="string"||!w.reaction)throw Error("Invalid parameter reaction: ".concat(w.reaction));return p.XZ.call(this)?(Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he=w.reaction,$e=w.messageId,ye={msgId:$e,message:he},lt={url:"".concat(this.apiUrl,"/").concat(re,"/").concat(Ee,"/reaction/user/").concat(this.user),type:"POST",data:JSON.stringify(ye),dataType:"json",headers:{Authorization:"Bearer "+Ge,"Content-Type":"application/json"}},[4,v.hj.call(this,lt)]):(te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)]);case 1:return Ze.sent(),[2]}})})}function Wt(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e,ye;return Y(this,function(lt){switch(lt.label){case 0:if(typeof w.reaction!="string"||!w.reaction)throw Error("Invalid parameter reactionId: ".concat(w.reaction));return p.XZ.call(this)?(Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he=w.messageId,$e=w.reaction,ye={url:"".concat(this.apiUrl,"/").concat(re,"/").concat(Ee,"/reaction/user/").concat(this.user,"?msgId=").concat(he,"&message=").concat($e),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+Ge,"Content-Type":"application/json"}},[4,v.hj.call(this,ye)]):(te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)]);case 1:return lt.sent(),[2]}})})}function Zt(w){if(typeof w.chatType!="string"||!w.chatType)throw Error("Invalid parameter chatType: ".concat(w.chatType));if(!w.messageId)throw Error("Invalid parameter messageId: ".concat(w.messageId));if(!p.XZ.call(this)){var te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(te)}var Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he=w.chatType,$e=w.messageId,ye={msgIdList:typeof $e=="string"?[$e]:$e,msgType:he==="singleChat"?"chat":"groupchat",groupId:w.groupId||null},lt={url:"".concat(this.apiUrl,"/").concat(re,"/").concat(Ee,"/reaction/user/").concat(this.user),type:"GET",data:ye,dataType:"json",headers:{Authorization:"Bearer "+Ge,"Content-Type":"application/json"}};return v.hj.call(this,lt).then(function(Ze){var Dt=Ze.data;return Dt?.forEach(function(Q){Q?.reactionList.forEach(function(Te){Te.isAddedBySelf=Te.state,delete Te.state,delete Te.reactionId})}),Ze})}var Kt=Zt;function At(w){if(typeof w.reaction!="string"||!w.reaction)throw Error("Invalid parameter reaction: ".concat(w.reaction));if(typeof w.messageId!="string"||!w.messageId)throw Error("Invalid parameter messageId: ".concat(w.messageId));if(!p.XZ.call(this)){var te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(te)}var Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he=w.cursor,$e=w.pageSize,ye={msgId:w.messageId,message:w.reaction,currentPage:he||null,pageSize:$e||20},lt={url:"".concat(this.apiUrl,"/").concat(re,"/").concat(Ee,"/reaction/user/").concat(this.user,"/detail"),type:"GET",data:ye,dataType:"json",headers:{Authorization:"Bearer "+Ge,"Content-Type":"application/json"}};return v.hj.call(this,lt).then(function(Ze){return Ze.data.isAddedBySelf=Ze.data.state,delete Ze.data.state,delete Ze.data.reactionId,Ze})}function vt(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e,ye,lt,Ze,Dt;return Y(this,function(Q){switch(Q.label){case 0:if(typeof w.reportType!="string"||!w.reportType)throw Error("Invalid parameter reportType: ".concat(w.reportType));if(typeof w.messageId!="string"||!w.messageId)throw Error("Invalid parameter messageId: ".concat(w.messageId));if(typeof w.reportReason!="string"||!w.reportReason)throw Error("Invalid parameter messageId: ".concat(w.reportReason));return p.XZ.call(this)?(Re=this.context,re=Re.orgName,Ee=Re.appName,Ge=Re.accessToken,he=w.reportType,$e=w.reportReason,ye=w.messageId,lt={username:this.user,reportType:he,reportReason:$e},Ze="".concat(this.apiUrl,"/").concat(re,"/").concat(Ee,"/user/").concat(this.user,"/moderation/report/message/").concat(ye),Dt={url:Ze,type:"POST",data:JSON.stringify(lt),dataType:"json",headers:{Authorization:"Bearer "+Ge,"Content-Type":"application/json"}},[4,v.hj.call(this,Dt)]):(te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)]);case 1:return Q.sent(),[2]}})})}function zt(w){var te;return I(this,void 0,void 0,function(){var Re,re,Ee,Ge,he,$e,ye,lt,Ze;return Y(this,function(Dt){switch(Dt.label){case 0:if(typeof w.targetId!="string"||w.targetId==="")throw Error('"Invalid parameter targetId": '+w.targetId);if(!["singleChat","groupChat","chatRoom"].includes(w.chatType))throw Error('"Invalid parameter chatType": '+w.chatType);if(w.beforeTimeStamp&&(typeof w.beforeTimeStamp!="number"||w.beforeTimeStamp<0||((te=w.beforeTimeStamp)===null||te===void 0?void 0:te.toString().length)>18))throw Error('"Invalid parameter beforeTimeStamp": '+w.beforeTimeStamp);if(w.messageIds&&!(Array.isArray(w.messageIds)&&w.messageIds.length>0&&w.messageIds.length<=20))throw Error('"Invalid parameter messageIds": '+w.messageIds);if(!w.messageIds&&!w.beforeTimeStamp)throw Error("messageIds or beforeTimeStamp field is required.");return p.XZ.call(this)?(re=this.context,Ee=re.orgName,Ge=re.appName,he=re.userId,$e=w.chatType==="singleChat"?"userId":"groupId",ye=w.chatType==="singleChat"?"chat":"group",lt=w.messageIds?"".concat(this.apiUrl,"/").concat(Ee,"/").concat(Ge,"/sdk/message/roaming/").concat(ye,"/user/").concat(he,"?").concat($e,"=").concat(w.targetId,"&msgIdList=").concat(w.messageIds,"&resource=").concat(this.clientResource):"".concat(this.apiUrl,"/").concat(Ee,"/").concat(Ge,"/sdk/message/roaming/").concat(ye,"/user/").concat(he,"/time?").concat($e,"=").concat(w.targetId,"&delTime=").concat(w.beforeTimeStamp,"&&resource=").concat(this.clientResource),Ze={url:lt,dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"}},C.kg.debug("Call removeHistoryMessages",w),[4,v.hj.call(this,Ze)]):(Re=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(Re)]);case 1:return Dt.sent(),[2]}})})}function vr(w){var te=this;if(!p.XZ.call(this)){var Re=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Re)}if(w?.pageSize&&typeof w.pageSize!="number")throw Error("Invalid parameter pageSize: ".concat(w.pageSize));if(w?.cursor&&typeof w.cursor!="string")throw Error("Invalid parameter cursor: ".concat(w.cursor));var re=this.context,Ee=re.orgName,Ge=re.appName,he=re.accessToken,$e={url:"".concat(this.apiUrl,"/").concat(Ee,"/").concat(Ge,"/sdk/user/").concat(this.user,"/user_channels/list?"),type:"GET",dataType:"json",data:{limit:w?.pageSize||20,cursor:w?.cursor||"",need_mark:!0},headers:{Authorization:"Bearer "+he,"Content-Type":"application/json"}};return C.kg.debug("Call getServerConversations",w),new Promise(function(ye,lt){v.hj.call(te,$e,U.fI.GET_SESSION_LIST).then(function(Ze){return I(te,void 0,void 0,function(){var Dt,Q,Te=this;return Y(this,function(pe){switch(pe.label){case 0:return Dt=or.call(this,Ze),this._localCache?(Q=Dt.data.conversations.map(function(Ue){return I(Te,void 0,void 0,function(){var xe,Fe,Je,ct;return Y(this,function(kt){switch(kt.label){case 0:return[4,(Fe=(xe=this._localCache)===null||xe===void 0?void 0:xe.getInstance())===null||Fe===void 0?void 0:Fe.storeMessage(Ue.lastMessage,x.r.SUCCESS,!0)];case 1:return kt.sent(),[4,(ct=(Je=this._localCache)===null||Je===void 0?void 0:Je.getInstance())===null||ct===void 0?void 0:ct.updateLocalConversation((0,P.MQ)({conversationId:Ue.conversationId,conversationType:Ue.conversationType}),{unReadCount:Ue.unReadCount})];case 2:return kt.sent(),[2]}})})}),[4,Promise.all(Q)]):[3,2];case 1:pe.sent(),pe.label=2;case 2:return ye(Dt),[2]}})})}).catch(function(Ze){lt(Ze)})})}function or(w){var te=this,Re=w.data,re=Re.cursor,Ee=Re.channel_infos,Ge=[];Ee?.forEach(function($e){var ye=null;$e?.meta&&JSON.stringify($e.meta)!=="{}"&&($e.meta.payload=JSON.parse($e.meta.payload),(ye=M.w.call(te,$e.meta)).type!=="delivery"&&ye.type!=="read"&&ye.type!=="channel"&&(ye.chatType=M.U[ye.chatType]));var lt={conversationId:$e.session_to,conversationType:$e.session_type==="chat"?"singleChat":"groupChat",isPinned:$e.is_top,pinnedTime:$e.is_top?$e.update_top_status_time:0,unReadCount:$e.unread_num,lastMessage:ye};$e.marks&&(lt.marks=$e.marks.map(function(Ze){return S.Z[Ze]})),Ge.push(lt)});var he={conversations:Ge,cursor:re||""};return{type:w.type,data:he}}function mr(w){var te=this;if(!p.XZ.call(this)){var Re=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Re)}if(w?.pageSize&&typeof w.pageSize!="number")throw Error("Invalid parameter pageSize: ".concat(w.pageSize));if(w?.cursor&&typeof w.cursor!="string")throw Error("Invalid parameter cursor: ".concat(w.cursor));var re=this.context,Ee=re.orgName,Ge=re.appName,he=re.accessToken,$e={url:"".concat(this.apiUrl,"/").concat(Ee,"/").concat(Ge,"/sdk/user/").concat(this.user,"/user_channels/list?"),type:"GET",dataType:"json",data:{limit:w?.pageSize||20,cursor:w?.cursor||"",is_top:!0,need_mark:!0},headers:{Authorization:"Bearer "+he,"Content-Type":"application/json"}};return C.kg.debug("Call getServerPinnedConversations",w),v.hj.call(this,$e,U.fI.GET_SESSION_LIST).then(function(ye){return or.call(te,ye)})}function ae(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e,ye,lt,Ze,Dt,Q,Te,pe;return Y(this,function(Ue){if(!p.XZ.call(this))return te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)];if(Re=w.conversationId,re=w.conversationType,Ee=w.isPinned,Ge=re==="singleChat"?"chat":"groupChat",typeof Re!="string"||Re==="")throw Error("Invalid parameter conversationId: ".concat(Re));if(!["singleChat","groupChat"].includes(re))throw Error("Invalid parameter conversationType: ".concat(re));if(typeof Ee!="boolean")throw Error("Invalid parameter isPinned: ".concat(Ee));return he=this.context,$e=he.orgName,ye=he.appName,lt=he.accessToken,Ze=he.jid,Dt={type:Ge,to:Re},Q=Ee?"":"type=".concat(Ge,"&to=").concat(Re,"&"),Te="".concat(this.apiUrl,"/").concat($e,"/").concat(ye,"/sdk/user/").concat(this.user,"/user_channel/top?").concat(Q,"resource=").concat(Ze.clientResource),pe={url:Te,type:Ee?"POST":"DELETE",dataType:"json",headers:{Authorization:"Bearer "+lt,"Content-Type":"application/json"}},Ee&&(pe.data=JSON.stringify(Dt)),C.kg.debug("Call pinConversation",w),[2,v.hj.call(this,pe,U.fI.PIN_CONVERSATION).then(function(xe){var Fe=xe.type,Je=xe.data;return{type:Fe,data:{isPinned:Je.is_top||!1,pinnedTime:Je.is_top?Je.update_top_status_time:0}}})]})})}function Ae(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e,ye,lt,Ze;return Y(this,function(Dt){switch(Dt.label){case 0:if(te=w.userId,Re=w.remark,!p.XZ.call(this))return re=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(re)];if(typeof te!="string"||te==="")throw Error('Invalid parameter: "userId"');if(typeof Re!="string")throw Error('Invalid parameter: "remark"');return C.kg.debug("Call setContactRemark",w),Ee=this.context,Ge=Ee.orgName,he=Ee.appName,$e=Ee.accessToken,ye=Ee.jid,lt="".concat(this.apiUrl,"/").concat(Ge,"/").concat(he,"/users/").concat(this.context.userId,"/contacts/users/").concat(te,"?resource=").concat(ye.clientResource),Ze={url:lt,type:"PUT",data:JSON.stringify({remark:Re}),dataType:"json",headers:{Authorization:"Bearer "+$e,"Content-Type":"application/json"}},[4,v.hj.call(this,Ze,U.fI.ROSTER_SET_CONTACT_REMARK)];case 1:return Dt.sent(),[2]}})})}function le(){if(!p.XZ.call(this)){var w=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(w)}var te=this.context,Re=te.orgName,re=te.appName,Ee=te.accessToken,Ge={url:"".concat(this.apiUrl,"/").concat(Re,"/").concat(re,"/users/").concat(this.user,"/contacts/users?needReturnRemark=true"),dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Ee}};return C.kg.debug("Call getAllContacts"),v.hj.call(this,Ge,U.fI.ROSTER_GET_ALL_CONTACTS_REMARKS).then(function(he){var $e=(he?.entities||[]).map(function(ye){return{userId:ye.username,remark:ye.remark}});return{type:he.type,data:$e}})}function Xe(w){if(!p.XZ.call(this)){var te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(te)}C.kg.debug("Call getContactsWithCursor",w);var Re=w||{},re=Re.pageSize,Ee=re===void 0?20:re,Ge=Re.cursor,he=Ge===void 0?"":Ge;if(Ee&&typeof Ee!="number")throw Error("Invalid parameter pageSize: ".concat(w.pageSize));var $e=this.context,ye=$e.orgName,lt=$e.appName,Ze=$e.accessToken,Dt={url:"".concat(this.apiUrl,"/").concat(ye,"/").concat(lt,"/users/").concat(this.user,"/contacts?needReturnRemark=true&limit=").concat(Ee,"&cursor=").concat(he),dataType:"json",type:"GET",headers:{Authorization:"Bearer "+Ze}};return v.hj.call(this,Dt,U.fI.ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE).then(function(Q){var Te,pe,Ue=((Te=Q?.data)===null||Te===void 0?void 0:Te.contacts)||[],xe=((pe=Q?.data)===null||pe===void 0?void 0:pe.cursor)||"",Fe=Ue.map(function(Je){return{userId:Je.username,remark:Je.remark}});return{type:Q.type,data:{cursor:xe,contacts:Fe}}})}function X(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e,ye,lt,Ze,Dt,Q,Te,pe,Ue;return Y(this,function(xe){switch(xe.label){case 0:if(!p.XZ.call(this))return te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)];if(C.kg.debug("Call markConversation",w),re=(Re=w||{}).conversations,Ee=re===void 0?[]:re,Ge=Re.mark,he=Re.isMarked,!Array.isArray(Ee))throw Error("Invalid parameter conversations");if($e=Ee.map(function(Fe){if(!Fe.conversationId||!["singleChat","groupChat"].includes(Fe.conversationType))throw Error("Invalid parameter conversations");return{to:Fe.conversationId,type:F[Fe.conversationType]}}),typeof he!="boolean")throw Error("Invalid parameter isMarked: ".concat(he));if(typeof Ge!="number")throw Error("Invalid parameter mark: ".concat(Ge));return ye=this.context,lt=ye.orgName,Ze=ye.appName,Dt=ye.accessToken,Q=ye.userId,Te=ye.jid,pe={mark:S.Z[Ge],targets:$e},Ue={url:"".concat(this.apiUrl,"/").concat(lt,"/").concat(Ze,"/sdk/user/").concat(Q,"/user_channels/mark?resource=").concat(Te.clientResource),dataType:"json",data:JSON.stringify(pe),type:he?"Post":"Delete",headers:{Authorization:"Bearer "+Dt}},[4,v.hj.call(this,Ue,U.fI.MARK_CONVERSATION).then(function(Fe){var Je,ct=((Je=Fe.data)===null||Je===void 0?void 0:Je.ignore)||[];ct&&Array.isArray(ct)&&ct.length>0&&C.kg.debug("markConversation has ignored conversations",ct.map(function(kt){return{conversationId:kt.to,conversationType:M.U[kt.type]}}))})];case 1:return xe.sent(),[2]}})})}function et(w){return I(this,void 0,void 0,function(){var te,Re;return Y(this,function(re){return C.kg.debug("Call addConversationMark",w),te=w.conversations,Re=w.mark,[2,X.call(this,{conversations:te,mark:Re,isMarked:!0})]})})}function Me(w){return I(this,void 0,void 0,function(){var te,Re;return Y(this,function(re){return C.kg.debug("Call removeConversationMark",w),te=w.conversations,Re=w.mark,[2,X.call(this,{conversations:te,mark:Re,isMarked:!1})]})})}function He(w){var te,Re,re=this;if(!p.XZ.call(this)){var Ee=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Ee)}if(C.kg.debug("Call getServerConversationsByFilter",w),w?.pageSize&&typeof w.pageSize!="number")throw Error("Invalid parameter pageSize: ".concat(w.pageSize));if(w?.cursor&&typeof w.cursor!="string")throw Error("Invalid parameter cursor: ".concat(w.cursor));if(typeof((te=w?.filter)===null||te===void 0?void 0:te.mark)!="number")throw Error("Invalid parameter mark: ".concat((Re=w?.filter)===null||Re===void 0?void 0:Re.mark));var Ge=this.context,he=Ge.orgName,$e=Ge.appName,ye=Ge.accessToken,lt="".concat(this.apiUrl,"/").concat(he,"/").concat($e,"/sdk/user/").concat(this.user,"/user_channels/mark/search?"),Ze=w.pageSize,Dt=w.cursor,Q=(w?.filter||{}).mark,Te={url:lt,type:"GET",dataType:"json",data:{limit:Ze||10,cursor:Dt||"",need_mark:!0,mark:S.Z[Q]},headers:{Authorization:"Bearer "+ye,"Content-Type":"application/json"}};return v.hj.call(this,Te,U.fI.GET_SESSION_LIST).then(function(pe){return or.call(re,pe)})}function Qe(){if(!p.XZ.call(this)){var w=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(w)}C.kg.debug("Call getSelfIdsOnOtherPlatform");var te=this.context,Re=te.orgName,re=te.appName,Ee=te.accessToken,Ge=te.userId,he=te.jid,$e={url:"".concat(this.apiUrl,"/").concat(Re,"/").concat(re,"/users/").concat(Ge,"/resources"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+Ee,"Content-Type":"application/json"}};return v.hj.call(this,$e,U.fI.USER_LOGGEDIN_OTHER_PLATFORM).then(function(ye){var lt,Ze=(lt=ye.data)===null||lt===void 0?void 0:lt.filter(function(Q){return Q.res!==he.clientResource}),Dt=Ze?.map(function(Q){return"".concat(Ge,"/").concat(Q.res)});return{type:ye.type,data:Dt}})}function ht(){var w,te,Re,re,Ee,Ge;return I(this,void 0,void 0,function(){var he,$e,ye,lt,Ze,Dt,Q,Te,pe;return Y(this,function(Ue){switch(Ue.label){case 0:return p.XZ.call(this)?(C.kg.debug("Call deleteAllMessagesAndConversations"),$e=this.context,ye=$e.orgName,lt=$e.appName,Ze=$e.accessToken,Dt=$e.userId,Q=$e.jid,Te="".concat(this.apiUrl,"/").concat(ye,"/").concat(lt,"/sdk/message/roaming/user/").concat(Dt,"/delete/all?resource=").concat(Q.clientResource),pe={url:Te,type:"POST",dataType:"json",headers:{Authorization:"Bearer "+Ze,"Content-Type":"application/json"}},[4,v.hj.call(this,pe,U.fI.REST_DELETE_MESSAGES_CONVERSATIONS)]):(he=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(he)]);case 1:return Ue.sent(),(te=(w=this._localCache)===null||w===void 0?void 0:w.getInstance())===null||te===void 0||te.clearConversationMap(),[4,(re=(Re=this._localCache)===null||Re===void 0?void 0:Re.getInstance())===null||re===void 0?void 0:re.clearStoreData("conversationList")];case 2:return Ue.sent(),[4,(Ge=(Ee=this._localCache)===null||Ee===void 0?void 0:Ee.getInstance())===null||Ge===void 0?void 0:Ge.clearStoreData("message")];case 3:return Ue.sent(),[2]}})})}function rt(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e,ye,lt,Ze,Dt,Q,Te,pe,Ue;return Y(this,function(xe){switch(xe.label){case 0:if(!p.XZ.call(this))return te=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(te)];if(C.kg.debug("Call setMessagePinStatus",w),re=(Re=w||{}).conversationId,Ee=re===void 0?"":re,Ge=Re.conversationType,he=Re.messageId,$e=Re.isPinned,typeof Ee!="string"||Ee==="")throw Error("Invalid parameter conversationId");if(typeof he!="string"||he==="")throw Error("Invalid parameter messageId");if(typeof $e!="boolean")throw Error("Invalid parameter isPinned");return ye=this.context,lt=ye.orgName,Ze=ye.appName,Dt=ye.accessToken,Q=ye.userId,Te=ye.jid,pe={to:Ee,type:F[Ge],pin_msg_id:he},Ue={url:"".concat(this.apiUrl,"/").concat(lt,"/").concat(Ze,"/sdk/user/").concat(Q,"/user_channel/pin?resource=").concat(Te.clientResource),dataType:"json",data:JSON.stringify(pe),type:$e?"Post":"Delete",headers:{Authorization:"Bearer "+Dt}},[4,v.hj.call(this,Ue,U.fI.REST_PIN_MESSAGE)];case 1:return xe.sent(),[2]}})})}function Ct(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee;return Y(this,function(Ge){return C.kg.debug("Call pinMessage",w),Re=(te=w||{}).conversationType,re=te.conversationId,Ee=te.messageId,[2,rt.call(this,{conversationId:re,conversationType:Re,messageId:Ee,isPinned:!0})]})})}function xt(w){return I(this,void 0,void 0,function(){var te,Re,re,Ee;return Y(this,function(Ge){return C.kg.debug("Call unpinMessage",w),Re=(te=w||{}).conversationType,re=te.conversationId,Ee=te.messageId,[2,rt.call(this,{conversationId:re,conversationType:Re,messageId:Ee,isPinned:!1})]})})}function Nt(w){var te=this;if(!p.XZ.call(this)){var Re=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Re)}C.kg.debug("Call getServerPinnedMessages",w);var re=w.conversationId,Ee=w.conversationType,Ge=w.pageSize,he=w.cursor;if(typeof re!="string"||re==="")throw Error("Invalid parameter conversationId");if(Ge&&typeof Ge!="number")throw Error("Invalid parameter pageSize: ".concat(Ge));if(he&&typeof he!="string")throw Error("Invalid parameter cursor: ".concat(he));var $e=this.context,ye=$e.orgName,lt=$e.appName,Ze=$e.accessToken,Dt={url:"".concat(this.apiUrl,"/").concat(ye,"/").concat(lt,"/sdk/user/").concat(this.user,"/user_channel/pin"),type:"GET",dataType:"json",data:{to:re,type:F[Ee],limit:Ge||10,cursor:he||""},headers:{Authorization:"Bearer "+Ze,"Content-Type":"application/json"}};return v.hj.call(this,Dt,U.fI.GET_SESSION_LIST).then(function(Q){return{type:0,data:{list:Q.data.msg_infos.map(function(Te){Te.message.payload=JSON.parse(Te.message.payload);var pe=Te.message,Ue=Te.pin_opt_at,xe=Te.pin_operator;return{message:M.w.call(te,pe,{formatChatType:!0}),pinTime:Ue,operatorId:xe}}),cursor:Q.data.cursor||""}}})}function yr(){var w=this;C.kg.debug("Call unbindPushToken");var te={deviceId:this.clientResource,deviceToken:"",notifierName:this.pushCertificateName};return z.r.call(this,te).then(function(Re){return w.isRegisterPush=!1,Re})}},3770:function(O,j,c){c.r(j),c.d(j,{getPresenceStatus:function(){return P},getSubscribedPresenceList:function(){return M},getSubscribedPresencelist:function(){return x},publishPresence:function(){return N},subscribePresence:function(){return C},unsubscribePresence:function(){return U}}),c(1539),c(8674),c(2526),c(1817),c(2165),c(6992),c(8783),c(3948),c(2222),c(9753);var p=c(4024),f=c(3246),T=c(7252),v=c(5531),S=c(7360),y=function(z,Z,I,Y){return new(I||(I=Promise))(function(F,oe){function W(H){try{ee(Y.next(H))}catch(q){oe(q)}}function ne(H){try{ee(Y.throw(H))}catch(q){oe(q)}}function ee(H){var q;H.done?F(H.value):(q=H.value,q instanceof I?q:new I(function(ve){ve(q)})).then(W,ne)}ee((Y=Y.apply(z,[])).next())})},E=function(z,Z){var I,Y,F,oe,W={label:0,sent:function(){if(1&F[0])throw F[1];return F[1]},trys:[],ops:[]};return oe={next:ne(0),throw:ne(1),return:ne(2)},typeof Symbol=="function"&&(oe[Symbol.iterator]=function(){return this}),oe;function ne(ee){return function(H){return function(q){if(I)throw new TypeError("Generator is already executing.");for(;W;)try{if(I=1,Y&&(F=2&q[0]?Y.return:q[0]?Y.throw||((F=Y.return)&&F.call(Y),0):Y.next)&&!(F=F.call(Y,q[1])).done)return F;switch(Y=0,F&&(q=[2&q[0],F.value]),q[0]){case 0:case 1:F=q;break;case 4:return W.label++,{value:q[1],done:!1};case 5:W.label++,Y=q[1],q=[0];continue;case 7:q=W.ops.pop(),W.trys.pop();continue;default:if(!((F=(F=W.trys).length>0&&F[F.length-1])||q[0]!==6&&q[0]!==2)){W=0;continue}if(q[0]===3&&(!F||q[1]>F[0]&&q[1]<F[3])){W.label=q[1];break}if(q[0]===6&&W.label<F[1]){W.label=F[1],F=q;break}if(F&&W.label<F[2]){W.label=F[2],W.ops.push(q);break}F[2]&&W.ops.pop(),W.trys.pop();continue}q=Z.call(z,W)}catch(ve){q=[6,ve],Y=0}finally{I=F=0}if(5&q[0])throw q[1];return{value:q[0]?q[1]:void 0,done:!0}}([ee,H])}}};function N(z){return y(this,void 0,void 0,function(){var Z,I,Y,F,oe,W,ne,ee,H;return E(this,function(q){switch(q.label){case 0:if(typeof z.description!="string")throw Error('Invalid parameter: "description"');return f.XZ.call(this)?(I=this.context,Y=I.accessToken,F=I.orgName,oe=I.appName,W=I.userId,ne=this.context.jid.clientResource,ee={ext:z.description},H={url:"".concat(this.apiUrl,"/").concat(F,"/").concat(oe,"/users/").concat(W,"/presence/").concat(ne,"/1"),type:"POST",dataType:"json",data:JSON.stringify(ee),headers:{Authorization:"Bearer "+Y,"Content-Type":"application/json"},success:z.success,error:z.error},S.kg.debug("Call publishPresence:",z),[4,p.hj.call(this,H)]):(Z=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(Z)]);case 1:return q.sent(),[2]}})})}function C(z){if(!Array.isArray(z.usernames))throw Error('Invalid parameter: "usernames"');if(!z.usernames.length)throw Error('"usernames" can not be empty');if(typeof z.expiry!="number")throw Error('Invalid parameter: "expiry"');if(!f.XZ.call(this)){var Z=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Z)}var I=this.context,Y=I.orgName,F=I.appName,oe=I.userId,W=I.accessToken,ne={usernames:z.usernames},ee={url:"".concat(this.apiUrl,"/").concat(Y,"/").concat(F,"/users/").concat(oe,"/presence/").concat(z.expiry),type:"POST",dataType:"json",data:JSON.stringify(ne),headers:{Authorization:"Bearer "+W,"Content-Type":"application/json"},success:z.success,error:z.error};return S.kg.debug("Call subscribePresence:",z),p.hj.call(this,ee).then(function(H){return H.data={result:H?.result},H})}function U(z){return y(this,void 0,void 0,function(){var Z,I,Y,F,oe,W,ne;return E(this,function(ee){switch(ee.label){case 0:if(!Array.isArray(z.usernames))throw Error('Invalid parameter: "usernames"');if(!z.usernames.length)throw Error('"usernames" can not be empty');return f.XZ.call(this)?(I=this.context,Y=I.orgName,F=I.appName,oe=I.userId,W=I.accessToken,ne={url:"".concat(this.apiUrl,"/").concat(Y,"/").concat(F,"/users/").concat(oe,"/presence"),type:"DELETE",dataType:"json",data:JSON.stringify(z.usernames),headers:{Authorization:"Bearer "+W,"Content-Type":"application/json"},success:z.success,error:z.error},S.kg.debug("Call unsubscribePresence:",z),[4,p.hj.call(this,ne)]):(Z=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(Z)]);case 1:return ee.sent(),[2]}})})}function M(z){if(typeof z.pageNum!="number"||typeof z.pageSize!="number")throw Error('Invalid parameter: "pageNum or pageSize"');if(z.pageNum<0||z.pageSize<0)throw Error('"pageNum" should >= 0 and "pageSize" should >= 0');if(!f.XZ.call(this)){var Z=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Z)}var I=this.context,Y=I.orgName,F=I.appName,oe=I.userId,W=I.accessToken,ne={url:"".concat(this.apiUrl,"/").concat(Y,"/").concat(F,"/users/").concat(oe,"/presence/sublist?pageNum=").concat(z.pageNum,"&pageSize=").concat(z.pageSize),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+W,"Content-Type":"application/json"},success:z.success,error:z.error};return S.kg.debug("Call getSubscribedPresenceList:",z),p.hj.call(this,ne).then(function(ee){return ee.data={result:ee?.result},ee})}var x=M;function P(z){if(!Array.isArray(z.usernames))throw Error('Invalid parameter: "usernames"');if(!z.usernames.length)throw Error('"usernames" can not be empty');if(!f.XZ.call(this)){var Z=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(Z)}var I={usernames:z.usernames},Y=this.context,F=Y.orgName,oe=Y.appName,W=Y.userId,ne=Y.accessToken,ee={url:"".concat(this.apiUrl,"/").concat(F,"/").concat(oe,"/users/").concat(W,"/presence"),type:"POST",dataType:"json",data:JSON.stringify(I),headers:{Authorization:"Bearer "+ne,"Content-Type":"application/json"},success:z.success,error:z.error};return S.kg.debug("Call getPresenceStatus:",z),p.hj.call(this,ee).then(function(H){return H.data={result:H?.result},H})}},6801:function(O,j,c){c.d(j,{r:function(){return E}}),c(1539),c(8674),c(2222),c(4812);var p=c(3246),f=c(5531),T=c(7252),v=c(4024),S=c(7360),y=c(1595);function E(N){if(typeof N.deviceId!="string"||N.deviceId==="")throw Error('Invalid parameter: "deviceId"');if(!p.XZ.call(this)){var C=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(C)}var U=this.context,M=U.orgName,x=U.appName,P=U.accessToken,z={url:"".concat(this.apiUrl,"/").concat(M,"/").concat(x,"/users/").concat(this.user),type:"PUT",data:JSON.stringify({device_id:N.deviceId,device_token:N.deviceToken,notifier_name:N.notifierName}),dataType:"json",headers:{Authorization:"Bearer "+P,"Content-Type":"application/json"},success:N.success,error:N.error};S.kg.debug("Call uploadPushTokenToServer",N);var Z=v.hj.bind(this,z,y.fI.UPLOAD_PUSH_TOKEN);return v.P6.retryPromise(Z).then(function(I){var Y=I.entities[0]||{};return{type:I.type,data:Y}})}},1735:function(O,j,c){c.r(j),c.d(j,{clearRemindTypeForConversation:function(){return C},getPushPerformLanguage:function(){return P},getSilentModeForAll:function(){return E},getSilentModeForConversation:function(){return U},getSilentModeForConversations:function(){return M},getSilentModeRemindTypeConversations:function(){return z},setPushPerformLanguage:function(){return x},setSilentModeForAll:function(){return y},setSilentModeForConversation:function(){return N}}),c(7941),c(1539),c(8674),c(2222),c(9753),c(9554),c(4747),c(9600),c(1249);var p=c(4024),f=c(3246),T=c(7252),v=c(5531),S=c(7360);function y(Z){if(!(Z.options instanceof Object))throw Error('Invalid parameter: "options"');var I=Z.options.paramType;if(typeof I!="number"||I<0||I>2)throw Error('Invalid parameter: "options of paramType"');if(I===0){if(typeof Z.options.remindType!="string")throw Error('Invalid parameter: "options of remindType"')}else if(I===1){if(typeof Z.options.duration!="number")throw Error('Invalid parameter: "options of duration"')}else if(I===2){var Y=Z.options,F=Y.startTime,oe=Y.endTime;if(!(F instanceof Object&&Object.keys(F).length))throw Error('Invalid parameter: "options of startTime"');if(!F.hours||typeof F.hours!="number"||!F.minutes||typeof F.minutes!="number")throw Error('Invalid parameter: "options of startTime of hours or minutes"');if(!(oe instanceof Object&&Object.keys(oe).length))throw Error('Invalid parameter: "options of endTime"');if(!oe.hours||typeof oe.hours!="number"||!oe.minutes||typeof oe.minutes!="number")throw Error('Invalid parameter: "options of endTime of hours or minutes"')}if(!f.XZ.call(this)){var W=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(W)}var ne=this.context,ee=ne.accessToken,H=ne.orgName,q=ne.appName,ve=ne.userId,Le=ne.jid,Oe={};switch(I){case 0:Oe={type:Z.options.remindType};break;case 1:Oe={ignoreDuration:Z.options.duration};break;case 2:var ge=Z.options;F=ge.startTime,oe=ge.endTime,Oe={ignoreInterval:"".concat(F.hours,":").concat(F.minutes,"-").concat(oe.hours,":").concat(oe.minutes)}}var je={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/users/").concat(ve,"/notification/user/").concat(ve,"?resource=").concat(Le.clientResource),type:"PUT",dataType:"json",data:JSON.stringify(Oe),headers:{Authorization:"Bearer "+ee,"Content-Type":"application/json"},success:Z.success,error:Z.error};return S.kg.debug("Call setSilentModeForAll:",Z),p.hj.call(this,je)}function E(Z){if(!f.XZ.call(this)){var I=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(I)}var Y=this.context,F=Y.accessToken,oe=Y.orgName,W=Y.appName,ne=Y.userId,ee={url:"".concat(this.apiUrl,"/").concat(oe,"/").concat(W,"/users/").concat(ne,"/notification/user/").concat(ne),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+F,"Content-Type":"application/json"},success:Z?.success,error:Z?.error};return S.kg.debug("Call getSilentModeForAll:",Z),p.hj.call(this,ee)}function N(Z){if(typeof Z.conversationId!="string"||!Z.conversationId)throw Error('Invalid parameter: "conversationId"');if(typeof Z.type!="string"||!Z.type)throw Error('Invalid parameter: "type"');if(!(Z.options instanceof Object))throw Error('Invalid parameter: "options"');var I=Z.options.paramType;if(typeof I!="number"||I<0||I>2)throw Error('Invalid parameter: "options of paramType"');if(I===0){if(typeof Z.options.remindType!="string")throw Error('Invalid parameter: "options of remindType"')}else if(I===1){if(typeof Z.options.duration!="number")throw Error('Invalid parameter: "options of duration"')}else if(I===2){var Y=Z.options,F=Y.startTime,oe=Y.endTime;if(!(F instanceof Object&&Object.keys(F).length))throw Error('Invalid parameter: "options of startTime"');if(!F.hours||typeof F.hours!="number"||!F.minutes||typeof F.minutes!="number")throw Error('Invalid parameter: "options of startTime of hours or minutes"');if(!(oe instanceof Object&&Object.keys(oe).length))throw Error('Invalid parameter: "options of endTime"');if(!oe.hours||typeof oe.hours!="number"||!oe.minutes||typeof oe.minutes!="number")throw Error('Invalid parameter: "options of endTime of hours or minutes"')}if(!f.XZ.call(this)){var W=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(W)}var ne=this.context,ee=ne.accessToken,H=ne.orgName,q=ne.appName,ve=ne.userId,Le=ne.jid,Oe="chatgroup",ge={};switch(I){case 0:ge={type:Z.options.remindType};break;case 1:ge={ignoreDuration:Z.options.duration};break;case 2:var je=Z.options;F=je.startTime,oe=je.endTime,ge={ignoreInterval:"".concat(F.hours,":").concat(F.minutes,"-").concat(oe.hours,":").concat(oe.minutes)}}Z.type==="singleChat"&&(Oe="user");var Ne={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/users/").concat(ve,"/notification/").concat(Oe,"/").concat(Z.conversationId,"?resource=").concat(Le.clientResource),type:"PUT",dataType:"json",data:JSON.stringify(ge),headers:{Authorization:"Bearer "+ee,"Content-Type":"application/json"},success:Z.success,error:Z.error};return S.kg.debug("Call setSilentModeForConversation:",Z),p.hj.call(this,Ne)}function C(Z){if(typeof Z.conversationId!="string"||!Z.conversationId)throw Error('Invalid parameter: "conversationId"');if(typeof Z.type!="string"||!Z.type)throw Error('Invalid parameter: "type"');if(!f.XZ.call(this)){var I=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(I)}var Y=this.context,F=Y.accessToken,oe=Y.orgName,W=Y.appName,ne=Y.userId,ee=Y.jid,H="chatgroup";Z.type==="singleChat"&&(H="user");var q={url:"".concat(this.apiUrl,"/").concat(oe,"/").concat(W,"/users/").concat(ne,"/notification/").concat(H,"/").concat(Z.conversationId,"?resource=").concat(ee.clientResource),type:"PUT",dataType:"json",data:JSON.stringify({type:"DEFAULT"}),headers:{Authorization:"Bearer "+F,"Content-Type":"application/json"},success:Z.success,error:Z.error};return S.kg.debug("Call clearRemindTypeForConversation:",Z),p.hj.call(this,q)}function U(Z){if(typeof Z.conversationId!="string"||!Z.conversationId)throw Error('Invalid parameter: "conversationId"');if(typeof Z.type!="string"||!Z.type)throw Error('Invalid parameter: "type"');if(!f.XZ.call(this)){var I=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(I)}var Y=this.context,F=Y.accessToken,oe=Y.orgName,W=Y.appName,ne=Y.userId,ee="chatgroup";Z.type==="singleChat"&&(ee="user");var H={url:"".concat(this.apiUrl,"/").concat(oe,"/").concat(W,"/users/").concat(ne,"/notification/").concat(ee,"/").concat(Z.conversationId),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+F,"Content-Type":"application/json"},success:Z.success,error:Z.error};return S.kg.debug("Call getSilentModeForConversation:",Z),p.hj.call(this,H)}function M(Z){if(!Array.isArray(Z.conversationList))throw Error('Invalid parameter: "conversationList"');if(!f.XZ.call(this)){var I=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(I)}var Y=this.context,F=Y.accessToken,oe=Y.orgName,W=Y.appName,ne=Y.userId,ee=[],H=[];Z.conversationList.forEach(function(Oe){Oe.type==="singleChat"?ee.push(Oe.id):H.push(Oe.id)});var q=ee.length?ee.join(","):"",ve=H.length?H.join(","):"",Le={url:"".concat(this.apiUrl,"/").concat(oe,"/").concat(W,"/users/").concat(ne,"/notification?user=").concat(q,"&group=").concat(ve),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+F,"Content-Type":"application/json"},success:Z.success,error:Z.error};return S.kg.debug("Call getSilentModeForConversations:",Z),p.hj.call(this,Le)}function x(Z){if(typeof Z.language!="string"||!Z.language)throw Error('Invalid parameter: "language"');if(!f.XZ.call(this)){var I=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(I)}var Y={translationLanguage:Z.language},F=this.context,oe=F.accessToken,W=F.orgName,ne=F.appName,ee=F.userId,H={url:"".concat(this.apiUrl,"/").concat(W,"/").concat(ne,"/users/").concat(ee,"/notification/language"),type:"PUT",dataType:"json",data:JSON.stringify(Y),headers:{Authorization:"Bearer "+oe,"Content-Type":"application/json"},success:Z.success,error:Z.error};return S.kg.debug("Call setPushPerformLanguage:",Z),p.hj.call(this,H)}function P(Z){if(!f.XZ.call(this)){var I=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(I)}var Y=this.context,F=Y.accessToken,oe=Y.orgName,W=Y.appName,ne=Y.userId,ee={url:"".concat(this.apiUrl,"/").concat(oe,"/").concat(W,"/users/").concat(ne,"/notification/language"),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+F,"Content-Type":"application/json"},success:Z?.success,error:Z?.error};return S.kg.debug("Call getPushPerformLanguage:",Z),p.hj.call(this,ee)}function z(Z){if(!f.XZ.call(this)){var I=T.Z.create({type:v.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(I)}if(typeof Z.pageSize!="number")throw Error('Invalid parameter: "pageSize"');var Y=this.context,F=Y.accessToken,oe=Y.orgName,W=Y.appName,ne=Y.userId,ee={limit:Z.pageSize||10,cursor:Z.cursor};Z.cursor||delete ee.cursor;var H={url:"".concat(this.apiUrl,"/").concat(oe,"/").concat(W,"/users/").concat(ne,"/notification/mute/type"),type:"GET",dataType:"json",data:ee,headers:{Authorization:"Bearer "+F,"Content-Type":"application/json"}};return S.kg.debug("Call getSilentModeRemindTypeConversations:",Z),p.hj.call(this,H).then(function(q){return q.data?{data:{conversations:q.data.map(function(ve){return"user"in ve?{conversationId:ve.user,type:"singleChat",remindType:ve.value}:{conversationId:ve.group,type:"groupChat",remindType:ve.value}}),cursor:q.cursor},type:q.type}:q})}},7384:function(O,j,c){c.r(j),c.d(j,{changeChatThreadName:function(){return x},createChatThread:function(){return N},destroyChatThread:function(){return M},getChatThreadDetail:function(){return oe},getChatThreadLastMessage:function(){return Y},getChatThreadMembers:function(){return P},getChatThreads:function(){return I},getJoinedChatThreads:function(){return Z},joinChatThread:function(){return C},leaveChatThread:function(){return U},removeChatThreadMember:function(){return z}}),c(1539),c(8674),c(2526),c(1817),c(2165),c(6992),c(8783),c(3948),c(8309),c(2222),c(9554),c(4747),c(9753);var p=c(5531),f=c(7252),T=c(4024),v=c(3246),S=c(4363),y=function(W,ne,ee,H){return new(ee||(ee=Promise))(function(q,ve){function Le(je){try{ge(H.next(je))}catch(Ne){ve(Ne)}}function Oe(je){try{ge(H.throw(je))}catch(Ne){ve(Ne)}}function ge(je){var Ne;je.done?q(je.value):(Ne=je.value,Ne instanceof ee?Ne:new ee(function(Be){Be(Ne)})).then(Le,Oe)}ge((H=H.apply(W,[])).next())})},E=function(W,ne){var ee,H,q,ve,Le={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return ve={next:Oe(0),throw:Oe(1),return:Oe(2)},typeof Symbol=="function"&&(ve[Symbol.iterator]=function(){return this}),ve;function Oe(ge){return function(je){return function(Ne){if(ee)throw new TypeError("Generator is already executing.");for(;Le;)try{if(ee=1,H&&(q=2&Ne[0]?H.return:Ne[0]?H.throw||((q=H.return)&&q.call(H),0):H.next)&&!(q=q.call(H,Ne[1])).done)return q;switch(H=0,q&&(Ne=[2&Ne[0],q.value]),Ne[0]){case 0:case 1:q=Ne;break;case 4:return Le.label++,{value:Ne[1],done:!1};case 5:Le.label++,H=Ne[1],Ne=[0];continue;case 7:Ne=Le.ops.pop(),Le.trys.pop();continue;default:if(!((q=(q=Le.trys).length>0&&q[q.length-1])||Ne[0]!==6&&Ne[0]!==2)){Le=0;continue}if(Ne[0]===3&&(!q||Ne[1]>q[0]&&Ne[1]<q[3])){Le.label=Ne[1];break}if(Ne[0]===6&&Le.label<q[1]){Le.label=q[1],q=Ne;break}if(q&&Le.label<q[2]){Le.label=q[2],Le.ops.push(Ne);break}q[2]&&Le.ops.pop(),Le.trys.pop();continue}Ne=ne.call(W,Le)}catch(Be){Ne=[6,Be],H=0}finally{ee=q=0}if(5&Ne[0])throw Ne[1];return{value:Ne[0]?Ne[1]:void 0,done:!0}}([ge,je])}}};function N(W){if(typeof W.name!="string"||W.name==="")throw Error("Invalid parameter name: ".concat(W.name));if(typeof W.messageId!="string"||W.messageId==="")throw Error("Invalid parameter messageId: ".concat(W.messageId));if(typeof W.parentId!="string"||W.parentId==="")throw Error("Invalid parameter parentId: ".concat(W.parentId));if(!v.XZ.call(this)){var ne=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ne)}var ee=this.context,H=ee.orgName,q=ee.appName,ve=ee.accessToken,Le=ee.jid,Oe={name:W.name,msg_id:W.messageId,group_id:W.parentId,owner:this.user},ge={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/thread?resource=").concat(Le.clientResource),type:"POST",dataType:"json",data:JSON.stringify(Oe),headers:{Authorization:"Bearer "+ve,"Content-Type":"application/json"}};return T.hj.call(this,ge).then(function(je){var Ne=je.data.thread_id;return je.data={chatThreadId:Ne},je})}function C(W){if(typeof W.chatThreadId!="string"||W.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(W.chatThreadId));if(!v.XZ.call(this)){var ne=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ne)}var ee=this.context,H=ee.orgName,q=ee.appName,ve=ee.accessToken,Le=ee.jid,Oe={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/thread/").concat(W.chatThreadId,"/user/").concat(this.user,"/join?resource=").concat(Le.clientResource),type:"POST",dataType:"json",headers:{Authorization:"Bearer "+ve,"Content-Type":"application/json"}};return T.hj.call(this,Oe).then(function(ge){var je=ge.data.detail;return je.messageId=je.msgId,je.parentId=je.groupId,delete je.msgId,delete je.groupId,ge})}function U(W){return y(this,void 0,void 0,function(){var ne,ee,H,q,ve,Le,Oe;return E(this,function(ge){switch(ge.label){case 0:if(typeof W.chatThreadId!="string"||W.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(W.chatThreadId));return v.XZ.call(this)?(ee=this.context,H=ee.orgName,q=ee.appName,ve=ee.accessToken,Le=ee.jid,Oe={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/thread/").concat(W.chatThreadId,"/user/").concat(this.user,"/quit?resource=").concat(Le.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ve,"Content-Type":"application/json"}},[4,T.hj.call(this,Oe)]):(ne=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(ne)]);case 1:return ge.sent(),[2]}})})}function M(W){return y(this,void 0,void 0,function(){var ne,ee,H,q,ve,Le,Oe;return E(this,function(ge){switch(ge.label){case 0:if(typeof W.chatThreadId!="string"||W.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(W.chatThreadId));return v.XZ.call(this)?(ee=this.context,H=ee.orgName,q=ee.appName,ve=ee.accessToken,Le=ee.jid,Oe={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/thread/").concat(W.chatThreadId,"?resource=").concat(Le.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ve,"Content-Type":"application/json"}},[4,T.hj.call(this,Oe)]):(ne=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"}),[2,Promise.reject(ne)]);case 1:return ge.sent(),[2]}})})}function x(W){if(typeof W.chatThreadId!="string"||W.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(W.chatThreadId));if(typeof W.name!="string"||W.name==="")throw Error("Invalid parameter name: ".concat(W.name));if(!v.XZ.call(this)){var ne=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ne)}var ee=this.context,H=ee.orgName,q=ee.appName,ve=ee.accessToken,Le=ee.jid,Oe={name:W.name},ge={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/thread/").concat(W.chatThreadId,"?resource=").concat(Le.clientResource),type:"PUT",dataType:"json",data:JSON.stringify(Oe),headers:{Authorization:"Bearer "+ve,"Content-Type":"application/json"}};return T.hj.call(this,ge)}function P(W){if(typeof W.chatThreadId!="string"||W.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(W.chatThreadId));if(!v.XZ.call(this)){var ne=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ne)}var ee=this.context,H=ee.orgName,q=ee.appName,ve=ee.accessToken,Le={limit:W.pageSize||20,cursor:W.cursor||""},Oe={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/thread/").concat(W.chatThreadId,"/users"),type:"GET",dataType:"json",data:Le,headers:{Authorization:"Bearer "+ve,"Content-Type":"application/json"}};return T.hj.call(this,Oe)}function z(W){if(typeof W.chatThreadId!="string"||W.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(W.chatThreadId));if(typeof W.username!="string"||W.username==="")throw Error("Invalid parameter username: ".concat(W.username));if(!v.XZ.call(this)){var ne=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ne)}var ee=this.context,H=ee.orgName,q=ee.appName,ve=ee.accessToken,Le=ee.jid,Oe={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/thread/").concat(W.chatThreadId,"/users/").concat(W.username,"?resource=").concat(Le.clientResource),type:"DELETE",dataType:"json",headers:{Authorization:"Bearer "+ve,"Content-Type":"application/json"}};return T.hj.call(this,Oe)}function Z(W){if(!v.XZ.call(this)){var ne=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ne)}var ee=this.context,H=ee.orgName,q=ee.appName,ve=ee.accessToken,Le={limit:W.pageSize||20,cursor:W.cursor||""},Oe={url:W.parentId?"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/threads/chatgroups/").concat(W.parentId,"/user/").concat(this.user):"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/threads/user/").concat(this.user),type:"GET",dataType:"json",data:Le,headers:{Authorization:"Bearer "+ve,"Content-Type":"application/json"}};return T.hj.call(this,Oe).then(function(ge){var je=ge.entities;return je?.forEach(function(Ne){Ne.parentId=Ne.groupId,Ne.messageId=Ne.msgId,delete Ne.groupId,delete Ne.msgId}),ge})}function I(W){if(typeof W.parentId!="string"||W.parentId==="")throw Error("Invalid parameter parentId: ".concat(W.parentId));if(!v.XZ.call(this)){var ne=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ne)}var ee=this.context,H=ee.orgName,q=ee.appName,ve=ee.accessToken,Le={cursor:W.cursor||"",limit:W.pageSize||20},Oe={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/threads/chatgroups/").concat(W.parentId),type:"GET",dataType:"json",data:Le,headers:{Authorization:"Bearer "+ve,"Content-Type":"application/json"}};return T.hj.call(this,Oe).then(function(ge){var je=ge.entities;return je?.forEach(function(Ne){Ne.parentId=Ne.groupId,Ne.messageId=Ne.msgId,delete Ne.groupId,delete Ne.msgId}),ge})}function Y(W){var ne=this;if(!Array.isArray(W.chatThreadIds))throw Error("Invalid parameter chatThreadIds: ".concat(W.chatThreadIds));if(!v.XZ.call(this)){var ee=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ee)}var H=this.context,q=H.orgName,ve=H.appName,Le=H.accessToken,Oe={threadIds:W.chatThreadIds},ge={url:"".concat(this.apiUrl,"/").concat(q,"/").concat(ve,"/thread/message"),type:"POST",dataType:"json",data:JSON.stringify(Oe),headers:{Authorization:"Bearer "+Le,"Content-Type":"application/json"}};return T.hj.call(this,ge).then(function(je){return F.call(ne,je)})}function F(W){var ne=this,ee=W.entities;return ee?.forEach(function(H){H.chatThreadId=H.thread_id,H.last_message&&JSON.stringify(H.last_message)!=="{}"?H.lastMessage=S.w.call(ne,H.last_message):H.lastMessage=H.last_message,delete H.thread_id,delete H.last_message}),W}function oe(W){if(typeof W.chatThreadId!="string"||W.chatThreadId==="")throw Error("Invalid parameter chatThreadId: ".concat(W.chatThreadId));if(!v.XZ.call(this)){var ne=f.Z.create({type:p.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(ne)}var ee=this.context,H=ee.orgName,q=ee.appName,ve=ee.accessToken,Le={url:"".concat(this.apiUrl,"/").concat(H,"/").concat(q,"/thread/").concat(W.chatThreadId),type:"GET",dataType:"json",headers:{Authorization:"Bearer "+ve,"Content-Type":"application/json"}};return T.hj.call(this,Le).then(function(Oe){return Oe.data.affiliationsCount=Oe.data.affiliations_count,Oe.data.messageId=Oe.data.msgId,Oe.data.parentId=Oe.data.groupId,delete Oe.data.affiliations_count,delete Oe.data.msgId,delete Oe.data.groupId,Oe})}},70:function(O,j,c){c.r(j),c.d(j,{getSupportedLanguages:function(){return y},translateMessage:function(){return E}}),c(1539),c(8674),c(2222),c(9753);var p=c(3246),f=c(5531),T=c(7252),v=c(7360),S=c(4024);function y(){if(!p.XZ.call(this)){var N=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(N)}var C=this.context,U=C.orgName,M=C.appName,x=C.accessToken,P={url:"".concat(this.apiUrl,"/").concat(U,"/").concat(M,"/users/").concat(this.user,"/translate/support/language"),dataType:"json",type:"GET",headers:{Authorization:"Bearer "+x}};return v.kg.debug("Call getSupportedLanguages"),S.hj.call(this,P)}function E(N){if(typeof N.text!="string"||N.text==="")throw Error('Invalid parameter: "text"');if(!Array.isArray(N.languages))throw Error('Invalid parameter: "language"');if(!p.XZ.call(this)){var C=T.Z.create({type:f.E.REST_PARAMS_STATUS,message:"appkey or token error"});return Promise.reject(C)}var U=this.context,M=U.orgName,x=U.appName,P=U.accessToken,z="".concat(this.apiUrl,"/").concat(M,"/").concat(x,"/users/").concat(this.user,"/translate"),Z={text:N.text,to:N.languages},I={url:z,dataType:"json",type:"POST",data:JSON.stringify(Z),headers:{Authorization:"Bearer "+P}};return v.kg.debug("Call translateMessage"),S.hj.call(this,I)}},3246:function(O,j,c){c.d(j,{H7:function(){return N},XZ:function(){return y},_W:function(){return E}}),c(7941),c(9554),c(1539),c(4747),c(6699),c(2023);var p=c(5531),f=c(7252),T=c(7360);function v(){var C=this.context.appName,U=this.context.orgName;return!(!C||!U)||(this.onError&&this.onError({type:p.E.WEBIM_CONNCTION_AUTH_ERROR,message:"appName or orgName is illegal"}),!1)}function S(){var C,U=this.context.accessToken;if(!U){var M=f.Z.create({type:p.E.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR,message:"token not assign error"});return T.kg.debug("token not assign error",U),this.onError&&this.onError(M),(C=this.eventHandler)===null||C===void 0||C.dispatch("onError",M),!1}return!0}function y(){return S.call(this)&&v.call(this)}function E(C){var U=C.data,M=C.type;return{data:{status:Object.keys(U.errorKeys).length>0?"fail":"success",errorKeys:U.errorKeys,successKeys:U.successKeys},type:M}}function N(C){var U=C.data,M=void 0;return Object.keys(U.errorKeys).length>0&&Object.keys(U.errorKeys).forEach(function(x){var P=U.errorKeys[x];M=P.includes("is not part of you")?f.Z.create({type:p.E.NO_PERMISSION,message:P}):P.includes("size of metadata for this single chatroom exceeds the user defined limit")||P.includes("total size of chatroom metadata for this app exceeds the user defined limit")||P.includes("is exceeding maximum limit")?f.Z.create({type:p.E.MAX_LIMIT,message:P}):P.includes("is not Legal")?f.Z.create({type:p.E.REQUEST_PARAMETER_ERROR,message:P}):P.includes("Failed to update userMetadata. Concurrent updates not allowed")?f.Z.create({type:p.E.OPERATION_NOT_ALLOWED,message:P}):f.Z.create({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,message:P})}),M}},2071:function(O,j,c){c.d(j,{$x:function(){return S},F3:function(){return y},TJ:function(){return f},Tp:function(){return C},Wc:function(){return p},el:function(){return T},iB:function(){return E},iO:function(){return v},yK:function(){return N}}),c(6992),c(1532),c(1539),c(8783),c(3948);var p=7,f=new Map,T="im",v=new Map,S="32f24ab2ddb74f508aa9286c356cec84",y=1e3,E={INIT:9674,API:9675},N="direct",C=-1},1595:function(O,j,c){var p,f,T,v,S,y;c.d(j,{C8:function(){return p},aC:function(){return y},c:function(){return T},dd:function(){return S},fI:function(){return f},td:function(){return v}}),function(E){E[E.UNKNOWOPERATION=-1]="UNKNOWOPERATION",E[E.REST_GET_SESSION_LIST=1]="REST_GET_SESSION_LIST",E[E.REST_DEL_SESSION=2]="REST_DEL_SESSION",E[E.REST_GET_HISTORY_MESSAGE=3]="REST_GET_HISTORY_MESSAGE",E[E.REST_PIN_CONVERSATION=4]="REST_PIN_CONVERSATION",E[E.REST_MARK_CONVERSATION=5]="REST_MARK_CONVERSATION",E[E.REST_UPLOAD_FILE_IN_PARTS=6]="REST_UPLOAD_FILE_IN_PARTS",E[E.REST_DELETE_MESSAGES_CONVERSATIONS=7]="REST_DELETE_MESSAGES_CONVERSATIONS",E[E.REST_PIN_MESSAGE=8]="REST_PIN_MESSAGE",E[E.REST_FETCH_PINMESSAGES=9]="REST_FETCH_PINMESSAGES",E[E.REST_OPERATE=100]="REST_OPERATE",E[E.MSYNC_SENDMESSAGE=101]="MSYNC_SENDMESSAGE",E[E.MSYNC_RECALLMESSAGE=102]="MSYNC_RECALLMESSAGE",E[E.MSYNC_MODIFYMESSAGE=103]="MSYNC_MODIFYMESSAGE",E[E.MSYNC_OPERATE=200]="MSYNC_OPERATE",E[E.ROSTER_ADD=201]="ROSTER_ADD",E[E.ROSTER_REMOVE=202]="ROSTER_REMOVE",E[E.ROSTER_ACCEPT=203]="ROSTER_ACCEPT",E[E.ROSTER_DECLINE=204]="ROSTER_DECLINE",E[E.ROSTER_BAN=205]="ROSTER_BAN",E[E.ROSTER_ALLOW=206]="ROSTER_ALLOW",E[E.ROSTER_BLACKLIST=207]="ROSTER_BLACKLIST",E[E.ROSTER_CONTACTS=208]="ROSTER_CONTACTS",E[E.ROSTER_GET_ALL_CONTACTS_REMARKS=209]="ROSTER_GET_ALL_CONTACTS_REMARKS",E[E.ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE=210]="ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE",E[E.ROSTER_SET_CONTACT_REMARK=211]="ROSTER_SET_CONTACT_REMARK",E[E.ROSTER_OPERATE=300]="ROSTER_OPERATE",E[E.USER_LOGIN=301]="USER_LOGIN",E[E.USER_CREATE=302]="USER_CREATE",E[E.USER_UPDATE_USERINFO=303]="USER_UPDATE_USERINFO",E[E.USER_FETCH_USERINFO=304]="USER_FETCH_USERINFO",E[E.USER_UPDATE_NICK=305]="USER_UPDATE_NICK",E[E.USER_UPLOAD_PUSH_TOKEN=306]="USER_UPLOAD_PUSH_TOKEN",E[E.USER_LOGGEDIN_OTHER_PLATFORM=307]="USER_LOGGEDIN_OTHER_PLATFORM",E[E.USER_OPERATE=400]="USER_OPERATE",E[E.GROUP_CREATEGROUP=401]="GROUP_CREATEGROUP",E[E.GROUP_BLOCK_MESSAGE=402]="GROUP_BLOCK_MESSAGE",E[E.GROUP_FETCH_PUBLICGROUPS_WITHCURSOR=403]="GROUP_FETCH_PUBLICGROUPS_WITHCURSOR",E[E.GROUP_FETCH_USERS_GROUP=404]="GROUP_FETCH_USERS_GROUP",E[E.GROUP_CHANGE_OWNER=405]="GROUP_CHANGE_OWNER",E[E.GROUP_FETCH_SPECIFICATION=406]="GROUP_FETCH_SPECIFICATION",E[E.GROUP_CHANGE_GROUPATTRIBUTE=407]="GROUP_CHANGE_GROUPATTRIBUTE",E[E.GROUP_FETCH_MEMEBERS=408]="GROUP_FETCH_MEMEBERS",E[E.GROUP_GET_ADMIN=409]="GROUP_GET_ADMIN",E[E.GROUP_SET_ADMIN=410]="GROUP_SET_ADMIN",E[E.GROUP_REMOVE_ADMIN=411]="GROUP_REMOVE_ADMIN",E[E.GROUP_DESTOTYGROUP=412]="GROUP_DESTOTYGROUP",E[E.GROUP_LEAVEGROUP=413]="GROUP_LEAVEGROUP",E[E.GROUP_INVITE_TO_GROUP=414]="GROUP_INVITE_TO_GROUP",E[E.GROUP_JOIN_PUBLICGROUP=415]="GROUP_JOIN_PUBLICGROUP",E[E.GROUP_ACCEPT_JOINPUBLICGROUPAPPL=416]="GROUP_ACCEPT_JOINPUBLICGROUPAPPL",E[E.GROUP_DECLINE_JOINPUBLICGROUPAPPL=417]="GROUP_DECLINE_JOINPUBLICGROUPAPPL",E[E.GROUP_ACCEPT_INVITATION=418]="GROUP_ACCEPT_INVITATION",E[E.GROUP_DECLINE_INVITATION=419]="GROUP_DECLINE_INVITATION",E[E.GROUP_REMOVE_MEMBER=420]="GROUP_REMOVE_MEMBER",E[E.GROUP_REMOVE_MEMBERS=421]="GROUP_REMOVE_MEMBERS",E[E.GROUP_MUTE_MEMBERS=422]="GROUP_MUTE_MEMBERS",E[E.GROUP_UNMUTE_MEMBERS=423]="GROUP_UNMUTE_MEMBERS",E[E.GROUP_FETCH_MUTES=424]="GROUP_FETCH_MUTES",E[E.GROUP_BLOCK_MEMBER=425]="GROUP_BLOCK_MEMBER",E[E.GROUP_BLOCK_MEMBERS=426]="GROUP_BLOCK_MEMBERS",E[E.GROUP_UNBLOCK_MEMBER=427]="GROUP_UNBLOCK_MEMBER",E[E.GROUP_UNBLOCK_MEMBERS=428]="GROUP_UNBLOCK_MEMBERS",E[E.GROUP_GET_BLOCK_LIST=429]="GROUP_GET_BLOCK_LIST",E[E.GROUP_MUTE_ALLMEMBERS=430]="GROUP_MUTE_ALLMEMBERS",E[E.GROUP_UNMUTE_ALLMEMBERS=431]="GROUP_UNMUTE_ALLMEMBERS",E[E.GROUP_ADD_WHITELIST=432]="GROUP_ADD_WHITELIST",E[E.GROUP_REMOVE_WHITELIST=433]="GROUP_REMOVE_WHITELIST",E[E.GROUP_FETCH_WHITELIST=434]="GROUP_FETCH_WHITELIST",E[E.GROUP_IS_IN_WHITELIST=435]="GROUP_IS_IN_WHITELIST",E[E.GROUP_GET_READ_USERS=436]="GROUP_GET_READ_USERS",E[E.GROUP_FETCH_ANNOUNCEMENT=437]="GROUP_FETCH_ANNOUNCEMENT",E[E.GROUP_UPDATE_ANNOUNCEMENT=438]="GROUP_UPDATE_ANNOUNCEMENT",E[E.GROUP_UPLOAD_SHAREDFILE=439]="GROUP_UPLOAD_SHAREDFILE",E[E.GROUP_DELETE_SHAREDFILE=440]="GROUP_DELETE_SHAREDFILE",E[E.GROUP_FETCH_SHAREDFILE=441]="GROUP_FETCH_SHAREDFILE",E[E.GROUP_DOWNLOAD_SHAREDFILE=442]="GROUP_DOWNLOAD_SHAREDFILE",E[E.GROUP_MEMBER_SET_META_DATA=443]="GROUP_MEMBER_SET_META_DATA",E[E.GROUP_MEMBER_FETCH_META_DATA=444]="GROUP_MEMBER_FETCH_META_DATA",E[E.GROUP_OPERATE=500]="GROUP_OPERATE",E[E.CHATROOM_FETCH_CHATROOMSWITHPAGE=501]="CHATROOM_FETCH_CHATROOMSWITHPAGE",E[E.CHATROOM_CREATECHATROOM=502]="CHATROOM_CREATECHATROOM",E[E.CHATROOM_DESTORYCHATROOM=503]="CHATROOM_DESTORYCHATROOM",E[E.CHATROOM_FETCH_SPECIFICATION=504]="CHATROOM_FETCH_SPECIFICATION",E[E.CHATROOM_CHANGE_ATTRIBUTE=505]="CHATROOM_CHANGE_ATTRIBUTE",E[E.CHATROOM_REMOVE_MEMBER=506]="CHATROOM_REMOVE_MEMBER",E[E.CHATROOM_REMOVE_MEMBERS=507]="CHATROOM_REMOVE_MEMBERS",E[E.CHATROOM_ADD_MEMBERS=508]="CHATROOM_ADD_MEMBERS",E[E.CHATROOM_JOINCAHTROOM=509]="CHATROOM_JOINCAHTROOM",E[E.CHATROOM_LEAVECAHTROOM=510]="CHATROOM_LEAVECAHTROOM",E[E.CHATROOM_FETCH_MEMBERS=511]="CHATROOM_FETCH_MEMBERS",E[E.CHATROOM_GET_ADMIN=512]="CHATROOM_GET_ADMIN",E[E.CHATROOM_SET_ADMIN=513]="CHATROOM_SET_ADMIN",E[E.CHATROOM_REMOVE_ADMIN=514]="CHATROOM_REMOVE_ADMIN",E[E.CHATROOM_MUTE_USER=515]="CHATROOM_MUTE_USER",E[E.CHATROOM_UNMUTE_USER=516]="CHATROOM_UNMUTE_USER",E[E.CHATROOM_FETCH_MUTES=517]="CHATROOM_FETCH_MUTES",E[E.CHATROOM_BLOCK_USER=518]="CHATROOM_BLOCK_USER",E[E.CHATROOM_BLOCK_USERS=519]="CHATROOM_BLOCK_USERS",E[E.CHATROOM_UNBLOCK_USER=520]="CHATROOM_UNBLOCK_USER",E[E.CHATROOM_UNBLOCK_USERS=521]="CHATROOM_UNBLOCK_USERS",E[E.CHATROOM_FETCH_BANS=522]="CHATROOM_FETCH_BANS",E[E.CHATROOM_MUTE_ALLMEMEBERS=523]="CHATROOM_MUTE_ALLMEMEBERS",E[E.CHATROOM_UNMUTE_ALLMEMEBERS=524]="CHATROOM_UNMUTE_ALLMEMEBERS",E[E.CHATROOM_ADD_WHITELIST=525]="CHATROOM_ADD_WHITELIST",E[E.CHATROOM_REMOVE_WHITELIST=526]="CHATROOM_REMOVE_WHITELIST",E[E.CHATROOM_FETCH_WHITELIST=527]="CHATROOM_FETCH_WHITELIST",E[E.CHATROOM_FETCH_MEMBERIN_WHITELIST=528]="CHATROOM_FETCH_MEMBERIN_WHITELIST",E[E.CHATROOM_FETCH_ANNOUNCEMENT=529]="CHATROOM_FETCH_ANNOUNCEMENT",E[E.CHATROOM_UPDATE_ANNOUNCEMENT=530]="CHATROOM_UPDATE_ANNOUNCEMENT",E[E.CHATROOM_REMOVE_SHARE_FILE=531]="CHATROOM_REMOVE_SHARE_FILE",E[E.CHATROOM_GET_SHARE_FILE_LIST=532]="CHATROOM_GET_SHARE_FILE_LIST",E[E.CHATROOM_UPLOAD_FILE=533]="CHATROOM_UPLOAD_FILE",E[E.CHATROOM_SET_META_DATA=534]="CHATROOM_SET_META_DATA",E[E.CHATROOM_DELETE_META_DATA=535]="CHATROOM_DELETE_META_DATA",E[E.CHATROOM_FETCH_META_DATA=536]="CHATROOM_FETCH_META_DATA",E[E.CHATROOM_FETCH_USER_JOINED_CHATROOM=537]="CHATROOM_FETCH_USER_JOINED_CHATROOM",E[E.CHATROOM_OPERATE=600]="CHATROOM_OPERATE"}(p||(p={})),function(E){E.SDK_INTERNAL="SDK_INTERNAL",E.LOGIN="USER_LOGIN",E.REGISTER="USER_CREATE",E.GET_CHATROOM_LIST="CHATROOM_FETCH_CHATROOMSWITHPAGE",E.CREATE_CHATROOM="CHATROOM_CREATECHATROOM",E.DESTROY_CHATROOM="CHATROOM_DESTORYCHATROOM",E.GET_CHATROOM_DETAIL="CHATROOM_FETCH_SPECIFICATION",E.MODIFY_CHATROOM="CHATROOM_CHANGE_ATTRIBUTE",E.REMOVE_CHATROOM_MEMBER="CHATROOM_REMOVE_MEMBER",E.MULTI_REMOVE_CHATROOM_MEMBER="CHATROOM_REMOVE_MEMBERS",E.ADD_USERS_TO_CHATROOM="CHATROOM_ADD_MEMBERS",E.JOIN_CHATROOM="CHATROOM_JOINCAHTROOM",E.QUIT_CHATROOM="CHATROOM_LEAVECAHTROOM",E.LIST_CHATROOM_MEMBERS="CHATROOM_FETCH_MEMBERS",E.GET_CHATROOM_ADMIN="CHATROOM_GET_ADMIN",E.SET_CHATROOM_ADMIN="CHATROOM_SET_ADMIN",E.REMOVE_CHATROOM_ADMIN="CHATROOM_REMOVE_ADMIN",E.MUTE_CHATROOM_MEMBER="CHATROOM_MUTE_USER",E.REMOVE_MUTE_CHATROOM_MEMBER="CHATROOM_UNMUTE_USER",E.GET_MUTE_CHATROOM_MEMBERS="CHATROOM_FETCH_MUTES",E.SET_CHATROOM_MEMBER_TO_BLACK="CHATROOM_BLOCK_USER",E.MULTI_SET_CHATROOM_MEMBER_TO_BLACK="CHATROOM_BLOCK_USERS",E.REMOVE_CHATROOM_MEMBER_BLACK="CHATROOM_UNBLOCK_USER",E.MULTI_REMOVE_CHATROOM_MEMBER_BLACK="CHATROOM_UNBLOCK_USERS",E.GET_CHATROOM_BLOCK_MEMBERS="CHATROOM_FETCH_BANS",E.DISABLED_CHATROOM_SEND_MSG="CHATROOM_MUTE_ALLMEMEBERS",E.ENABLE_CHATROOM_SEND_MSG="CHATROOM_UNMUTE_ALLMEMEBERS",E.ADD_CHATROOM_WHITE_USERS="CHATROOM_ADD_WHITELIST",E.REMOVE_CHATROOM_WHITE_USERS="CHATROOM_REMOVE_WHITELIST",E.GET_CHATROOM_WHITE_USERS="CHATROOM_FETCH_WHITELIST",E.CHECK_CHATROOM_WHITE_USER="CHATROOM_FETCH_MEMBERIN_WHITELIST",E.GET_CHATROOM_ANN="CHATROOM_FETCH_ANNOUNCEMENT",E.UPDATE_CHATROOM_ANN="CHATROOM_UPDATE_ANNOUNCEMENT",E.DELETE_CHATROOM_FILE="CHATROOM_REMOVE_SHARE_FILE",E.GET_CHATROOM_FILES="CHATROOM_GET_SHARE_FILE_LIST",E.UPLOAD_CHATROOM_FILE="CHATROOM_UPLOAD_FILE",E.SET_CHATROOM_ATTR="CHATROOM_SET_META_DATA",E.DELETE_CHATROOM_ATTR="CHATROOM_DELETE_META_DATA",E.GET_CHATROOM_ATTR="CHATROOM_FETCH_META_DATA",E.GET_USER_JOINED_CHATROOM="CHATROOM_FETCH_USER_JOINED_CHATROOM",E.CREATE_GROUP="GROUP_CREATEGROUP",E.BLOCK_GROUP="GROUP_BLOCK_MESSAGE",E.LIST_GROUP="GROUP_FETCH_PUBLICGROUPS_WITHCURSOR",E.GET_USER_GROUP="GROUP_FETCH_USERS_GROUP",E.CHANGE_OWNER="GROUP_CHANGE_OWNER",E.GET_GROUP_INFO="GROUP_FETCH_SPECIFICATION",E.MODIFY_GROUP="GROUP_CHANGE_GROUPATTRIBUTE",E.LIST_GROUP_MEMBER="GROUP_FETCH_MEMEBERS",E.GET_GROUP_ADMIN="GROUP_GET_ADMIN",E.SET_GROUP_ADMIN="GROUP_SET_ADMIN",E.REMOVE_GROUP_ADMIN="GROUP_REMOVE_ADMIN",E.DISSOLVE_GROUP="GROUP_DESTOTYGROUP",E.QUIT_GROUP="GROUP_LEAVEGROUP",E.INVITE_TO_GROUP="GROUP_INVITE_TO_GROUP",E.JOIN_GROUP="GROUP_JOIN_PUBLICGROUP",E.AGREE_JOIN_GROUP="GROUP_ACCEPT_JOINPUBLICGROUPAPPL",E.REJECT_JOIN_GROUP="GROUP_DECLINE_JOINPUBLICGROUPAPPL",E.AGREE_INVITE_GROUP="GROUP_ACCEPT_INVITATION",E.REJECT_INVITE_GROUP="GROUP_DECLINE_INVITATION",E.REMOVE_GROUP_MEMBER="GROUP_REMOVE_MEMBER",E.MULTI_REMOVE_GROUP_MEMBER="GROUP_REMOVE_MEMBERS",E.MUTE_GROUP_MEMBER="GROUP_MUTE_MEMBERS",E.UNMUTE_GROUP_MEMBER="GROUP_UNMUTE_MEMBERS",E.GET_GROUP_MUTE_LIST="GROUP_FETCH_MUTES",E.BLOCK_GROUP_MEMBER="GROUP_BLOCK_MEMBER",E.BLOCK_GROUP_MEMBERS="GROUP_BLOCK_MEMBERS",E.UNBLOCK_GROUP_MEMBER="GROUP_UNBLOCK_MEMBER",E.UNBLOCK_GROUP_MEMBERS="GROUP_UNBLOCK_MEMBERS",E.GET_GROUP_BLACK_LIST="GROUP_GET_BLOCK_LIST",E.DISABLED_SEND_GROUP_MSG="GROUP_MUTE_ALLMEMBERS",E.ENABLE_SEND_GROUP_MSG="GROUP_UNMUTE_ALLMEMBERS",E.ADD_USERS_TO_GROUP_WHITE="GROUP_ADD_WHITELIST",E.REMOVE_GROUP_WHITE_MEMBER="GROUP_REMOVE_WHITELIST",E.GET_GROUP_WHITE_LIST="GROUP_FETCH_WHITELIST",E.IS_IN_GROUP_WHITE_LIST="GROUP_IS_IN_WHITELIST",E.GET_GROUP_MSG_READ_USER="GROUP_GET_READ_USERS",E.GET_GROUP_ANN="GROUP_FETCH_ANNOUNCEMENT",E.UPDATE_GROUP_ANN="GROUP_UPDATE_ANNOUNCEMENT",E.UPLOAD_GROUP_FILE="GROUP_UPLOAD_SHAREDFILE",E.DELETE_GROUP_FILE="GROUP_DELETE_SHAREDFILE",E.GET_GROUP_FILE_LIST="GROUP_FETCH_SHAREDFILE",E.DOWN_GROUP_FILE="GROUP_DOWNLOAD_SHAREDFILE",E.SET_GROUP_MEMBER_ATTRS="GROUP_MEMBER_SET_META_DATA",E.GET_GROUP_MEMBER_ATTR="GROUP_MEMBER_FETCH_META_DATA",E.GET_SESSION_LIST="REST_GET_SESSION_LIST",E.DELETE_SESSION="REST_DEL_SESSION",E.GET_HISTORY_MSG="REST_GET_HISTORY_MESSAGE",E.PIN_CONVERSATION="REST_PIN_CONVERSATION",E.REST_UPLOAD_FILE_IN_PARTS="REST_UPLOAD_FILE_IN_PARTS",E.REST_DELETE_MESSAGES_CONVERSATIONS="REST_DELETE_MESSAGES_CONVERSATIONS",E.MARK_CONVERSATION="REST_MARK_CONVERSATION",E.REST_FETCH_PINMESSAGES="REST_FETCH_PINMESSAGES",E.REST_PIN_MESSAGE="REST_PIN_MESSAGE",E.UPDATE_USER_INFO="USER_UPDATE_USERINFO",E.GET_USER_INFO="USER_FETCH_USERINFO",E.UPDATE_USER_NICK="USER_UPDATE_NICK",E.UPLOAD_PUSH_TOKEN="USER_UPLOAD_PUSH_TOKEN",E.USER_LOGGEDIN_OTHER_PLATFORM="USER_LOGGEDIN_OTHER_PLATFORM",E.GET_BLACK_LIST="ROSTER_BLACKLIST",E.GET_CONTACTS="ROSTER_CONTACTS",E.ROSTER_GET_ALL_CONTACTS_REMARKS="ROSTER_GET_ALL_CONTACTS_REMARKS",E.ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE="ROSTER_GET_ALL_CONTACTS_REMARKS_FROM_SERVER_BY_PAGE",E.ROSTER_SET_CONTACT_REMARK="ROSTER_SET_CONTACT_REMARK",E.ROSTER_ADD="ROSTER_ADD",E.ROSTER_REMOVE="ROSTER_REMOVE",E.ROSTER_ACCEPT="ROSTER_ACCEPT",E.ROSTER_DECLINE="ROSTER_DECLINE",E.ROSTER_BAN="ROSTER_BAN",E.ROSTER_ALLOW="ROSTER_ALLOW",E.SEND_MSG="MSYNC_SENDMESSAGE",E.UPLOAD_MSG_ATTACH="UPLOAD_MSG_ATTACH",E.SEND_RECALL_MSG="MSYNC_RECALLMESSAGE",E.MODIFY_MESSAGE="MSYNC_MODIFYMESSAGE"}(f||(f={})),function(E){E.GET_DNS="REST_DNSLIST",E.LOGIN_BY_AGORA_TOKEN="LOGIN_BY_AGORA_TOKEN",E.LOGIN_BY_PWD="LOGIN_BY_PWD",E.RESISTER="REGISTER",E.REST_INIT_UPLOAD_TASK_IN_PARTS="REST_INIT_UPLOAD_TASK_IN_PARTS",E.REST_UPLOAD_PART="REST_UPLOAD_PART",E.REST_COMPLETE_UPLOAD_PART="REST_COMPLETE_UPLOAD_PART",E.REST_ABORT_UPLOAD_PART="REST_ABORT_UPLOAD_PART"}(T||(T={})),function(E){E[E["5G"]=7]="5G",E[E["4G"]=7]="4G",E[E["3G"]=7]="3G",E[E["2G"]=7]="2G",E[E["SLOW-2G"]=7]="SLOW-2G",E[E.WIFI=2]="WIFI",E[E.LAN=1]="LAN",E[E.DISCONNECTED=0]="DISCONNECTED",E[E.NONE=0]="NONE",E[E.UNKNOWN=-1]="UNKNOWN",E[E["WEBIM UNABLE TO GET"]=-2]="WEBIM UNABLE TO GET"}(v||(v={})),function(E){E[E.success=200]="success",E[E.failed=500]="failed",E[E.disconnect=-1]="disconnect",E[E.notFound=404]="notFound",E[E.reachLimit=429]="reachLimit"}(S||(S={})),function(E){E[E.web=0]="web",E[E.native=1]="native"}(y||(y={}))},6424:function(O,j,c){c.d(j,{gA:function(){return pt},ZP:function(){return yr}}),c(9601),c(1539),c(8674),c(2526),c(1817),c(2165),c(6992),c(8783),c(3948),c(7042),c(2222),c(3710),c(7941),c(9714),c(3843),c(8309),c(2772),c(5212),c(7327),c(5827),c(9826),c(4553),c(561),c(9653),c(1038),c(2564),c(9575),c(2472),c(2990),c(8927),c(3105),c(5035),c(4345),c(7174),c(2846),c(4731),c(7209),c(6319),c(8867),c(7789),c(3739),c(9368),c(4483),c(2056),c(3462),c(678),c(7462),c(3824),c(5021),c(2974),c(5016),c(6699),c(2023),c(3161),c(4048),c(9753),c(9554),c(4747),c(285),c(1637),c(8145),c(1249),c(4812);var p=c(4188),f=c.n(p),T=c(3720),v=c.n(T),S=c(5531),y=c(8161),E=c(7360),N=["public","members_only","allow_user_invites","invite_need_confirm"],C={name:"name",title:"name",description:"description",public:"public",members_only:"approval",allow_user_invites:"allowInvites",max_users:"maxUsers",invite_need_confirm:"inviteNeedConfirm",custom:"ext",last_modified:"lastModified"};function U(w,te){var Re,re,Ee,Ge,he,$e,ye=this,lt=this.context,Ze=lt.userId,Dt=lt.jid,Q=te.from.name===Ze&&Dt.clientResource!==te.from.clientResource;return te.isThread?(Ee={id:te.mucId.name,name:te.mucName,operation:"",parentId:te.mucParentId.name,operator:te.from.name,userName:te.to.length?te.to[0].name:""},Ge={chatThreadId:te.mucId.name,chatThreadName:te.mucName,operation:"",parentId:te.mucParentId.name}):(re={type:"",owner:te.from.name,gid:te.mucId.name,from:te.from.name,fromJid:te.from,to:te.to.length?te.to[0].name:"",toJid:te.to,chatroom:te.isChatroom,status:te.status},he={operation:"",id:te.mucId.name,from:te.from.name},te.isChatroom&&(!((Re=te?.eventInfo)===null||Re===void 0)&&Re.ext)&&($e=JSON.parse(te.eventInfo.ext))),({45:function(){var Te,pe,Ue;he.operation="memberAttributesUpdate";var xe=JSON.parse((Te=te?.eventInfo)===null||Te===void 0?void 0:Te.ext)||{};he.attributes=xe.properties||{},he.userId=xe.username||"",Q?(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onMultiDeviceEvent",he):(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onGroupEvent",he)},44:function(){var Te;he.operation="removeChatRoomAttributes",he.attributes=$e.result.successKeys,$e.result.successKeys.length>0&&((Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomEvent",he))},43:function(){var Te;he.operation="updateChatRoomAttributes";var pe={};$e.result.successKeys.forEach(function(Ue){pe[Ue]=$e.properties[Ue]}),he.attributes=pe,$e.result.successKeys.length>0&&((Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomEvent",he))},42:function(){},41:function(){},40:function(){},39:function(){},38:function(){var Te;Ge.operation="chatThreadNameUpdate",(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onMultiDeviceEvent",Ge)},37:function(){var Te;Ee.operation="userRemove",(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatThreadChange",Ee)},36:function(){var Te;Ge.operation="chatThreadLeave",(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onMultiDeviceEvent",Ge)},35:function(){var Te;Ge.operation="chatThreadJoin",(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onMultiDeviceEvent",Ge)},34:function(){var Te;Ge.operation="chatThreadDestroy",(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onMultiDeviceEvent",Ge)},33:function(){var Te;Ge.operation="chatThreadCreate",(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onMultiDeviceEvent",Ge)},32:function(){var Te,pe,Ue,xe;re.type=te.isChatroom?"rmChatRoomMute":"rmGroupMute",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="unmuteAllMembers",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},31:function(){var Te,pe,Ue,xe;re.type=te.isChatroom?"muteChatRoom":"muteGroup",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="muteAllMembers",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},30:function(){var Te,pe,Ue,xe;re.type=te.isChatroom?"rmUserFromChatRoomWhiteList":"rmUserFromGroupWhiteList",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="removeAllowlistMember",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},29:function(){var Te,pe,Ue,xe;re.type=te.isChatroom?"addUserToChatRoomWhiteList":"addUserToGroupWhiteList",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="addUserToAllowlist",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},28:function(){var Te,pe,Ue,xe;re.type="deleteFile",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="deleteFile",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},27:function(){var Te,pe,Ue,xe;re.type="uploadFile",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="uploadFile",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},26:function(){var Te,pe,Ue,xe;re.type="deleteAnnouncement",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="deleteAnnouncement",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},25:function(){var Te,pe,Ue,xe;re.type="updateAnnouncement",re.announcement=te.reason,ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="updateAnnouncement",he.announcement=te.reason,te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},24:function(){var Te,pe,Ue,xe;re.type="removeMute",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="unmuteMember",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},23:function(){var Te,pe,Ue,xe;re.type="addMute",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="muteMember",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},22:function(){var Te,pe,Ue,xe;re.type="removeAdmin",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="removeAdmin",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},21:function(){var Te,pe,Ue,xe;re.type="addAdmin",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="setAdmin",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},20:function(){var Te,pe,Ue,xe;re.type="changeOwner",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="changeOwner",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},19:function(){var Te,pe,Ue,xe;re.type="direct_joined",re.groupName=te.mucName,ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="directJoined",he.name=te.mucName,te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},18:function(){var Te,pe,Ue,xe;re.type=te.isChatroom?"leaveChatRoom":"leaveGroup",ye.onPresence&&ye.onPresence(re);var Fe=te.mucMemberCount;Fe&&(he.memberCount=Fe),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="memberAbsence",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},17:function(){var Te,pe,Ue,xe;te.isChatroom&&te.ext&&(he.ext=te.ext,re.ext=te.ext),re.type=te.isChatroom?"memberJoinChatRoomSuccess":"memberJoinPublicGroupSuccess",ye.onPresence&&ye.onPresence(re);var Fe=te.mucMemberCount;te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="memberPresence",Fe&&(he.memberCount=Fe),te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},16:function(){var Te,pe;re.type="unblock",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re)},15:function(){var Te,pe;re.type="block",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re)},14:function(){var Te,pe,Ue,xe,Fe,Je=te.isChatroom;if(!Je){var ct=JSON.parse(((Te=te?.eventInfo)===null||Te===void 0?void 0:Te.ext)||"{}",function(kt,mt){return kt==="last_modified"?Number(mt):N.includes(kt)?mt==="true"||mt===!0:mt});he.detail=re.detail={},Object.keys(ct).forEach(function(kt){var mt=C[kt];if(mt){var Jt=ct[kt];he.detail&&(he.detail[mt]=Jt),re.detail&&(re.detail[mt]=Jt)}})}re.type="update",ye.onPresence&&ye.onPresence(re),Je?(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onChatroomChange",re):(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onGroupChange",re),he.operation="updateInfo",Je?(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onChatroomEvent",he):(Fe=ye.eventHandler)===null||Fe===void 0||Fe.dispatch("onGroupEvent",he)},13:function(){var Te,pe,Ue,xe;re.type="allow",re.reason=te.reason,ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),te.reason&&(he.reason=te.reason),he.operation="unblockMember",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},12:function(){var Te,pe;re.type="ban",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re)},11:function(){var Te,pe;re.type="getBlackList",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re)},10:function(){var Te,pe,Ue,xe;re.type="removedFromGroup",re.kicked=re.to,ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="removeMember",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},9:function(){var Te,pe,Ue,xe;re.type="invite_decline",re.kicked=re.to,ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="rejectInvite",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},8:function(){var Te,pe,Ue,xe;re.type="invite_accept",re.kicked=re.to,ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="acceptInvite",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},7:function(){var Te,pe,Ue,xe;re.type="invite",re.kicked=re.to,re.groupName=te.mucName,ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="inviteToJoin",he.name=te.mucName,te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},6:function(){var Te,pe,Ue,xe;re.type="joinPublicGroupDeclined",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="joinPublicGroupDeclined",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(he.userId=te.to.length?te.to[0].name:"",(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he))},5:function(){var Te,pe,Ue,xe;re.type="joinPublicGroupSuccess",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="acceptRequest",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},4:function(){var Te,pe,Ue,xe;re.type="joinGroupNotifications",re.reason=te.reason,ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),te.reason&&(he.reason=te.reason),he.operation="requestToJoin",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},3:function(){var Te,pe;re.type="leave",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re)},2:function(){var Te,pe;re.type="join",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re)},1:function(){var Te,pe,Ue,xe;re.type="deleteGroupChat",ye.onPresence&&ye.onPresence(re),te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomChange",re):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupChange",re),he.operation="destroy",te.isChatroom?(Ue=ye.eventHandler)===null||Ue===void 0||Ue.dispatch("onChatroomEvent",he):(xe=ye.eventHandler)===null||xe===void 0||xe.dispatch("onGroupEvent",he)},0:function(){var Te,pe;he.operation="create",te.isChatroom?(Te=ye.eventHandler)===null||Te===void 0||Te.dispatch("onChatroomEvent",he):(pe=ye.eventHandler)===null||pe===void 0||pe.dispatch("onGroupEvent",he)}}[w]||function(){console.error("No match operation ".concat(w))})()}var M=function(w){var te=this.root.lookup("easemob.pb.MUCBody").decode(w.payload),Re=te.operation;E.kg.debug("onMucMessage",te),U.call(this,Re,te)},x={handleRosterMsg:function(w){var te,Re,re,Ee,Ge,he,$e=this.root.lookup("easemob.pb.RosterBody").decode(w.payload),ye={type:"",to:$e.to[0].name,from:$e.from.name,status:$e.reason};switch($e.operation){case 2:ye.type="subscribe",this.onContactInvited&&this.onContactInvited(ye),(te=this.eventHandler)===null||te===void 0||te.dispatch("onContactInvited",ye);break;case 3:ye.type="unsubscribed",this.onContactDeleted&&this.onContactDeleted(ye),(Re=this.eventHandler)===null||Re===void 0||Re.dispatch("onContactDeleted",ye);break;case 4:ye.type="subscribed",this.onContactAdded&&this.onContactAdded(ye),(re=this.eventHandler)===null||re===void 0||re.dispatch("onContactAdded",ye);break;case 5:ye.type="unsubscribed",this.onContactRefuse&&this.onContactRefuse(ye),(Ee=this.eventHandler)===null||Ee===void 0||Ee.dispatch("onContactRefuse",ye);break;case 6:case 7:break;case 8:ye.type="subscribed",this.onContactAgreed&&this.onContactAgreed(ye),(Ge=this.eventHandler)===null||Ge===void 0||Ge.dispatch("onContactAgreed",ye);break;case 9:ye.type="unsubscribed",this.onContactRefuse&&this.onContactRefuse(ye),(he=this.eventHandler)===null||he===void 0||he.dispatch("onContactRefuse",ye);break;default:E.kg.error("handleRosterMsg:",$e)}this.onPresence&&ye.type&&this.onPresence(ye)}},P=c(7252),z=function(w){var te,Re,re,Ee,Ge,he,$e=this.root.lookup("easemob.pb.StatisticsBody").decode(w.payload),ye=$e.operation,lt=$e.reason;switch(ye){case 0:this.onStatisticMessage&&this.onStatisticMessage($e),(te=this.eventHandler)===null||te===void 0||te.dispatch("onStatisticMessage",$e);break;case 1:he=P.Z.create({type:S.E.WEBIM_CONNCTION_USER_REMOVED,message:"user has been removed"}),this.disconnectedReason=he,this.logOut=!0,this.onError&&this.onError(he),(Re=this.eventHandler)===null||Re===void 0||Re.dispatch("onError",he);break;case 2:he=P.Z.create({type:S.E.WEBIM_CONNCTION_USER_LOGIN_ANOTHER_DEVICE,message:"the user is already logged on another device"}),lt&&(he.data={loginInfoCustomExt:$e.reason}),this.disconnectedReason=he,this.logOut=!0,this.onError&&this.onError(he),(re=this.eventHandler)===null||re===void 0||re.dispatch("onError",he);break;case 3:he=P.Z.create({type:S.E.WEBIM_CONNCTION_USER_KICKED_BY_CHANGE_PASSWORD,message:"the user was kicked by changing password"}),this.disconnectedReason=he,this.logOut=!0,this.onError&&this.onError(he),(Ee=this.eventHandler)===null||Ee===void 0||Ee.dispatch("onError",he);break;case 4:he=P.Z.create({type:S.E.WEBIM_CONNCTION_USER_KICKED_BY_OTHER_DEVICE,message:"the user was kicked by other device"}),this.disconnectedReason=he,this.logOut=!0,this.onError&&this.onError(he),(Ge=this.eventHandler)===null||Ge===void 0||Ge.dispatch("onError",he);break;default:E.kg.error("handleStatisticsMsg:",$e)}},Z=(c(9720),c(4024)),I=c(4363),Y=c(9937);function F(w){var te,Re=[],re=[],Ee=w.data;Ee&&Ee.values&&Ee.values.forEach(function(Ge){Object.entries(Ge.status).forEach(function(he){re.push({device:he[0],status:Number(he[1])})}),Re.push({userId:Ge.uid,lastTime:Number(Ge.last_time),expire:Number(Ge.expiry),ext:Ge.ext,statusDetails:re})}),this.onPresenceStatusChange&&this.onPresenceStatusChange(Re),(te=this.eventHandler)===null||te===void 0||te.dispatch("onPresenceStatusChange",Re)}function oe(w){var te=this;w.data.forEach(function(Re){var re,Ee={from:Re.from,to:Re.to,chatType:Re.channel_type==="chat"?"singleChat":"groupChat",messageId:Re.messageId,reactions:Re.reactions,ts:Re.ts};(re=te.eventHandler)===null||re===void 0||re.dispatch("onReactionChange",Ee)})}function W(w){var te,Re,re,Ee;if(w.data){var Ge=w.data,he={id:Ge.id||"",name:Ge.name||"",parentId:Ge.muc_parent_id||"",messageId:Ge.msg_parent_id||"",timestamp:Ge.timestamp||0,operator:Ge.from||"",operation:""};switch(Ge.operation){case"create":he.operation="create",he.createTimestamp=he.timestamp,he.messageCount=0,(te=this.eventHandler)===null||te===void 0||te.dispatch("onChatThreadChange",he);break;case"update_msg":he.operation="update",he.messageCount=Ge.message_count,Ge.last_message&&JSON.stringify(Ge.last_message)!=="{}"?he.lastMessage=I.w.call(this,Ge.last_message):JSON.stringify(Ge.last_message)==="{}"&&(he.lastMessage={}),(Re=this.eventHandler)===null||Re===void 0||Re.dispatch("onChatThreadChange",he);break;case"update":he.operation="update",he.messageCount=Ge.message_count,(re=this.eventHandler)===null||re===void 0||re.dispatch("onChatThreadChange",he);break;case"delete":he.operation="destroy",(Ee=this.eventHandler)===null||Ee===void 0||Ee.dispatch("onChatThreadChange",he)}}}function ne(w){var te,Re=w.data;if(Re.resource!==this.clientResource){var re={operation:"deleteRoaming",conversationId:Re.to,chatType:Re.chatType==="chat"?"singleChat":"groupChat",resource:Re.resource};(te=this.eventHandler)===null||te===void 0||te.dispatch("onMultiDeviceEvent",re)}}function ee(w){var te,Re,re=w.data,Ee="";if(this.clientResource!==re.res){switch(re.op){case"del":Ee="deleteConversation";break;case"top":Ee="pinnedConversation";break;case"not_top":Ee="unpinnedConversation";break;case"mark":Ee="markConversation";break;case"mark_delete":Ee="unMarkConversation";break;case"pin":Ee="pin";break;case"pin_delete":Ee="unpin";break;default:return void E.kg.error("unexpected conversation op:",re.op)}if(Ee!=="pin"&&Ee!=="unpin"){var Ge={operation:Ee,conversationId:re.id,conversationType:re.type==="chat"?"singleChat":"groupChat",timestamp:re.ts};Ge.operation!=="markConversation"&&Ge.operation!=="unMarkConversation"||re.ext&&(Ge.conversationMark=Y.Z[re.ext]),(Re=this.eventHandler)===null||Re===void 0||Re.dispatch("onMultiDeviceEvent",Ge)}else{var he=re.ext,$e=re.from,ye=re.id,lt=re.type,Ze=re.ts,Dt={messageId:he||"",conversationId:$e===this.user?ye:$e,conversationType:I.U[lt],operation:Ee,operatorId:$e,time:Ze};(te=this.eventHandler)===null||te===void 0||te.dispatch("onMessagePinEvent",Dt)}}}function H(w){var te,Re=this;(te=w.values)===null||te===void 0||te.forEach(function(re){var Ee,Ge,he,$e,ye;if(re.operator_resource!==Re.clientResource)if("ignoreInterval"in re.data){var lt={operation:"setSilentModeForUser",resource:re.operator_resource,data:re.data};(Ee=Re.eventHandler)===null||Ee===void 0||Ee.dispatch("onMultiDeviceEvent",lt)}else"group"in re?(lt={operation:Object.keys((Ge=re.data)!==null&&Ge!==void 0?Ge:{}).length===0?"removeSilentModeForConversation":"setSilentModeForConversation",resource:re.operator_resource,conversationId:re.group,type:"groupChat",data:re.data},(he=Re.eventHandler)===null||he===void 0||he.dispatch("onMultiDeviceEvent",lt)):(lt={operation:Object.keys(($e=re.data)!==null&&$e!==void 0?$e:{}).length===0?"removeSilentModeForConversation":"setSilentModeForConversation",resource:re.operator_resource,conversationId:re.user,type:"singleChat",data:re.data},(ye=Re.eventHandler)===null||ye===void 0||ye.dispatch("onMultiDeviceEvent",lt))})}var q=function(w){var te=Z.P6.parseNotify(w.payload);switch(te.type){case"presence":F.call(this,te);break;case"reaction":oe.call(this,te);break;case"thread":W.call(this,te);break;case"roaming_delete":ne.call(this,te);break;case"conv":ee.call(this,te);break;case"user_notification_mute":H.call(this,te);break;default:E.kg.error("unexpected notify type: ".concat(te.type))}},ve=c(7288),Le=c(9743),Oe=2,ge=c(4998),je=c(6801),Ne=c(2071),Be=c(1595);function Ye(w){return Ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(te){return typeof te}:function(te){return te&&typeof Symbol=="function"&&te.constructor===Symbol&&te!==Symbol.prototype?"symbol":typeof te},Ye(w)}var pt,dt,Ie,we=function(){return we=Object.assign||function(w){for(var te,Re=1,re=arguments.length;Re<re;Re++)for(var Ee in te=arguments[Re])Object.prototype.hasOwnProperty.call(te,Ee)&&(w[Ee]=te[Ee]);return w},we.apply(this,arguments)},ft=function(w,te,Re,re){return new(Re||(Re=Promise))(function(Ee,Ge){function he(lt){try{ye(re.next(lt))}catch(Ze){Ge(Ze)}}function $e(lt){try{ye(re.throw(lt))}catch(Ze){Ge(Ze)}}function ye(lt){var Ze;lt.done?Ee(lt.value):(Ze=lt.value,Ze instanceof Re?Ze:new Re(function(Dt){Dt(Ze)})).then(he,$e)}ye((re=re.apply(w,[])).next())})},qe=function(w,te){var Re,re,Ee,Ge,he={label:0,sent:function(){if(1&Ee[0])throw Ee[1];return Ee[1]},trys:[],ops:[]};return Ge={next:$e(0),throw:$e(1),return:$e(2)},typeof Symbol=="function"&&(Ge[Symbol.iterator]=function(){return this}),Ge;function $e(ye){return function(lt){return function(Ze){if(Re)throw new TypeError("Generator is already executing.");for(;he;)try{if(Re=1,re&&(Ee=2&Ze[0]?re.return:Ze[0]?re.throw||((Ee=re.return)&&Ee.call(re),0):re.next)&&!(Ee=Ee.call(re,Ze[1])).done)return Ee;switch(re=0,Ee&&(Ze=[2&Ze[0],Ee.value]),Ze[0]){case 0:case 1:Ee=Ze;break;case 4:return he.label++,{value:Ze[1],done:!1};case 5:he.label++,re=Ze[1],Ze=[0];continue;case 7:Ze=he.ops.pop(),he.trys.pop();continue;default:if(!((Ee=(Ee=he.trys).length>0&&Ee[Ee.length-1])||Ze[0]!==6&&Ze[0]!==2)){he=0;continue}if(Ze[0]===3&&(!Ee||Ze[1]>Ee[0]&&Ze[1]<Ee[3])){he.label=Ze[1];break}if(Ze[0]===6&&he.label<Ee[1]){he.label=Ee[1],Ee=Ze;break}if(Ee&&he.label<Ee[2]){he.label=Ee[2],he.ops.push(Ze);break}Ee[2]&&he.ops.pop(),he.trys.pop();continue}Ze=te.call(w,he)}catch(Dt){Ze=[6,Dt],re=0}finally{Re=Ee=0}if(5&Ze[0])throw Ze[1];return{value:Ze[0]?Ze[1]:void 0,done:!0}}([ye,lt])}}},it=function(w,te,Re){for(var re,Ee=0,Ge=te.length;Ee<Ge;Ee++)!re&&Ee in te||(re||(re=Array.prototype.slice.call(te,0,Ee)),re[Ee]=te[Ee]);return w.concat(re||Array.prototype.slice.call(te))};(function(w){w[w.NORMAL=0]="NORMAL",w[w.SINGLECHAT=1]="SINGLECHAT",w[w.GROUPCHAT=2]="GROUPCHAT",w[w.CHATROOM=3]="CHATROOM",w[w.READ_ACK=4]="READ_ACK",w[w.DELIVER_ACK=5]="DELIVER_ACK",w[w.RECALL=6]="RECALL",w[w.CHANNEL_ACK=7]="CHANNEL_ACK",w[w.EDIT=8]="EDIT"})(pt||(pt={})),function(w){w[w.APNs=0]="APNs",w[w.FCM=1]="FCM",w[w.HMSPUSH=2]="HMSPUSH",w[w.MIPUSH=3]="MIPUSH",w[w.MEIZUPUSH=4]="MEIZUPUSH",w[w.VIVOPUSH=5]="VIVOPUSH",w[w.OPPOPUSH=6]="OPPOPUSH",w[w.HONORPUSH=7]="HONORPUSH"}(dt||(dt={})),function(w){w[w.OK=0]="OK",w[w.FAIL=1]="FAIL",w[w.UNAUTHORIZED=2]="UNAUTHORIZED",w[w.MISSING_PARAMETER=3]="MISSING_PARAMETER",w[w.WRONG_PARAMETER=4]="WRONG_PARAMETER",w[w.REDIRECT=5]="REDIRECT",w[w.TOKEN_EXPIRED=6]="TOKEN_EXPIRED",w[w.PERMISSION_DENIED=7]="PERMISSION_DENIED",w[w.NO_ROUTE=8]="NO_ROUTE",w[w.UNKNOWN_COMMAND=9]="UNKNOWN_COMMAND",w[w.PB_PARSER_ERROR=10]="PB_PARSER_ERROR",w[w.BIND_ANOTHER_DEVICE=11]="BIND_ANOTHER_DEVICE",w[w.IM_FORBIDDEN=12]="IM_FORBIDDEN",w[w.TOO_MANY_DEVICES=13]="TOO_MANY_DEVICES",w[w.PLATFORM_LIMIT=14]="PLATFORM_LIMIT",w[w.USER_MUTED=15]="USER_MUTED",w[w.ENCRYPT_DISABLE=16]="ENCRYPT_DISABLE",w[w.ENCRYPT_ENABLE=17]="ENCRYPT_ENABLE",w[w.DECRYPT_FAILURE=18]="DECRYPT_FAILURE",w[w.PERMISSION_DENIED_EXTERNAL=19]="PERMISSION_DENIED_EXTERNAL"}(Ie||(Ie={}));var Tt=["txt","img","video","audio","file","loc","custom","cmd","combine"],Pt=Z.P6.getEnvInfo();function bt(){var w="webim",te="",Re="",re=[],Ee=new Date().valueOf(),Ge=Z.P6.getDevicePlatform(Pt);if(this.isFixedDeviceId){var he=Z.P6.getLocalDeviceInfo();if(he){var $e=JSON.parse(he);w=$e.deviceId,te=$e.deviceName,Re=$e.deviceUuid}else this.deviceId==="webim"?(Re="".concat(Ge,"_").concat(Ee.toString()),w="".concat(this.deviceId,"_").concat(Re),te=this.deviceId):w=te=Re="webim_".concat(Ge,"_").concat(this.deviceId),Z.P6.setLocalDeviceInfo(JSON.stringify({deviceId:w,deviceName:te,deviceUuid:Re}))}else this.deviceId==="webim"?(Re="random_".concat(Ge,"_").concat(Ee.toString()),w="".concat(this.deviceId,"_").concat(Re),te=this.deviceId):w=te=Re="webim_".concat(Ge,"_").concat(this.deviceId);this.context.jid&&(this.context.jid.clientResource=w);var ye=this.root.lookup("easemob.pb.Provision"),lt=ye.decode(re);lt.compressType=this.compressType,lt.encryptType=this.encryptType,lt.osType=this.osType,lt.version=this.version,lt.deviceName=te,lt.resource=w,lt.deviceUuid=Re,lt.authToken='{"token":"$t$'+this.token+'"}',lt.sessionId=Date.now().toString()+":",this.loginInfoCustomExt&&(lt.reason=this.loginInfoCustomExt),E.kg.debug("provision info",{version:this.version,resource:w,isFixedDeviceId:this.isFixedDeviceId,loginInfoCustomExt:!!this.loginInfoCustomExt,token:!!this.token}),lt.actionVersion="v5.0",lt=ye.encode(lt).finish();var Ze=this.root.lookup("easemob.pb.MSync"),Dt=Ze.decode(re);return Dt.version=this.version,Dt.guid=this.context.jid,Dt.auth="$t$"+this.token,Dt.command=3,Dt.deviceId=te,Dt.serviceId=this.dataReport.getServiceId(),Dt.encryptType=this.encryptType,Dt.payload=lt,Ze.encode(Dt).finish()}function jt(w,te){var Re=this,re=Z.P6.getEnvInfo();if(re.platform==="web"||re.platform==="zfb"||re.platform==="dd"){for(var Ee="",Ge=0;Ge<w.length;Ge++)Ee+=String.fromCharCode(w[Ge]);return Ee=f().btoa(Ee),re.platform==="web"?Ee:{data:Ee,isBuffer:!1,complete:function(){},fail:function($e){$e.errMsg!=="sendSocketMessage:fail taskID not exist"&&$e.errMsg!=="SocketTast.send:fail SocketTask.readyState is not OPEN"||(E.kg.debug("send message fail and reconnect"),Re.reconnecting||Re.reconnect()),te&&Re._msgHash&&Re._msgHash[te]&&Re._msgHash[te].fail({id:te})}}}var he=w;return{data:he.buffer.slice(he.byteOffset,he.byteOffset+he.byteLength),fail:function($e){$e.errMsg!=="sendSocketMessage:fail taskID not exist"&&$e.errMsg!=="SocketTast.send:fail SocketTask.readyState is not OPEN"||Re.reconnecting||Re.reconnect(),te&&Re._msgHash&&Re._msgHash[te]&&Re._msgHash[te].fail({id:te})}}}function Lt(w,te){var Re;return ft(this,void 0,void 0,function(){var re,Ee,Ge,he,$e,ye;return qe(this,function(lt){switch(lt.label){case 0:for(E.kg.debug("distributeMeta, metas length: ",w.length),re=[],Ee=function(Ze){var Dt=w[Ze],Q=new(v())(Dt.id.low,Dt.id.high,Dt.id.unsigned).toString(),Te=Dt.from.name,pe=Dt.to?Dt.to.name:"",Ue=!!Dt.to&&Dt.to.domain.indexOf("conference")!==-1;if(Ge._load_msg_cache.some(function(xe){return xe.msgId===Q}))return"continue";switch(Ge._load_msg_cache.length<=Ge.max_cache_length||Ge._load_msg_cache.shift(),Ge._load_msg_cache.push({msgId:Q,from:Te,to:pe,isGroup:Ue}),Dt.ns){case 0:z.call(Ge,Dt);break;case 1:re.push(y.Z.call(Ge,Dt,te,!1,!0,!0));break;case 2:M.call(Ge,Dt);break;case 3:x.handleRosterMsg.call(Ge,Dt);break;case 4:Ge.registerConfrIQHandler&&Ge.registerConfrIQHandler(Dt,te,Ge);break;case 5:q.call(Ge,Dt);break;default:E.kg.error("distributeMeta",Dt)}},Ge=this,he=0;he<w.length;he++)Ee(he);return[4,Promise.all(re)];case 1:return $e=lt.sent(),(ye=$e.filter(function(Ze){return Ze&&Ze.type!=="cmd"})).length>0&&((Re=this.eventHandler)===null||Re===void 0||Re.dispatch("onMessage",ye)),[2]}})})}function Gt(w,te){Lt.call(this,w,te)}function pr(w){var te;this._offlineMessagePullState===ge.a.SYNC_INIT&&(this._offlineMessagePullState=ge.a.SYNC_START,this._offlineMessagePullQueue=w.unread.reduce(function(Re,re){return Re.find(function(Ee){return Ee.name===re.queue.name})||Re.push(re.queue),Re},[]),(te=this.eventHandler)===null||te===void 0||te.dispatch("onOfflineMessageSyncStart"))}function ir(w){var te;if(this._offlineMessagePullState===ge.a.SYNC_START){var Re=this._offlineMessagePullQueue.findIndex(function(re){return re.name===w.queue.name});Re>-1&&this._offlineMessagePullQueue.splice(Re,1),this._offlineMessagePullQueue.length===0&&(this._offlineMessagePullState=ge.a.SYNC_FINISH,(te=this.eventHandler)===null||te===void 0||te.dispatch("onOfflineMessageSyncFinish"))}}function Ar(w){var te=this.root.lookup("easemob.pb.CommUnreadDL");te=te.decode(w.payload);var Re=new(v())(te.timestamp.low,te.timestamp.high,te.timestamp.unsigned).toString();if(this.expirationTime&&this.compareTokenExpireTime(Number(Re),this.expirationTime),te.unread.length===0)vt.call(this);else{pr.call(this,te),E.kg.debug("pull unread message",te.unread);for(var re=0;re<te.unread.length;re++){var Ee=ae(this._queues,te.unread[re].queue),Ge=ae(this.unSyncQueue,te.unread[re].queue);Ee||Ge?E.kg.warn("receive unread message and already in queue"):this.unSyncQueue.push(te.unread[re].queue)}for(re=0;re<this.unSyncQueue.length;re++)this.unSyncQueue[re].hasSync||Xt.call(this,this.unSyncQueue[re]),this.unSyncQueue[re].hasSync=!0}vt.call(this)}function er(){var w=[],te=this.root.lookup("easemob.pb.StatisticsBody"),Re=te.decode(w);Re.operation=0,Re=te.encode(Re).finish();var re=this.root.lookup("easemob.pb.Meta").decode(w);re.id=new Date().valueOf(),re.ns=0,re.payload=Re;var Ee=this.root.lookup("easemob.pb.CommSyncUL"),Ge=Ee.decode(w);Ge.meta=re,Ge=Ee.encode(Ge).finish();var he=this.root.lookup("easemob.pb.MSync"),$e=he.decode(w);return $e.version=this.version,$e.encryptType=[0],$e.command=0,$e.payload=Ge,he.encode($e).finish()}function yt(w){var te=[],Re=this.root.lookup("easemob.pb.CommSyncUL"),re=Re.decode(te);re.queue=w,re=Re.encode(re).finish();var Ee=this.root.lookup("easemob.pb.MSync"),Ge=Ee.decode(te);return Ge.version=this.version,Ge.encryptType=this.encryptType,Ge.command=0,Ge.payload=re,Ee.encode(Ge).finish()}function Xt(w){E.kg.debug("sendBackqueue");var te=yt.call(this,w);Nt.call(this,te)}function Ir(w,te){var Re=[],re=this.root.lookup("easemob.pb.CommSyncUL"),Ee=re.decode(Re);Ee.queue=te,Ee.key=new(v())(w.low,w.high,w.unsigned).toString(),Ee=re.encode(Ee).finish();var Ge=this.root.lookup("easemob.pb.MSync"),he=Ge.decode(Re);return he.version=this.version,he.encryptType=this.encryptType,he.command=0,he.payload=Ee,Ge.encode(he).finish()}function St(){var w=this;this.uniPush&&this.isRegisterPush===!1&&(this.isRegisterPush=!0,this.uniPush.onRegister(function(te){E.kg.debug("push token onRegister",te);var Re=w.uniPushConfig||{},re=Re.APNsCertificateName,Ee=re===void 0?"":re,Ge=Re.HMSCertificateName,he=Ge===void 0?"":Ge,$e=Re.HONORCertificateName,ye=$e===void 0?"":$e,lt=Re.MEIZUCertificateName,Ze=lt===void 0?"":lt,Dt=Re.MICertificateName,Q=Dt===void 0?"":Dt,Te=Re.OPPOCertificateName,pe=Te===void 0?"":Te,Ue=Re.VIVOCertificateName,xe=Ue===void 0?"":Ue;switch(te.push_type){case dt.APNs:w.pushCertificateName=Ee;break;case dt.HMSPUSH:w.pushCertificateName=he;break;case dt.HONORPUSH:w.pushCertificateName=ye;break;case dt.MEIZUPUSH:w.pushCertificateName=Ze;break;case dt.MIPUSH:w.pushCertificateName=Q;break;case dt.OPPOPUSH:w.pushCertificateName=pe;break;case dt.VIVOPUSH:w.pushCertificateName=xe;break;default:E.kg.error("unexpected push type",te.push_type)}w.pushCertificateName&&te.push_token&&je.r.call(w,{deviceId:w.clientResource,deviceToken:te.push_token,notifierName:w.pushCertificateName}).then(function(){E.kg.debug("uploadPushToken success")}).catch(function(Fe){E.kg.debug("uploadPushToken failed",Fe)})}))}function Wt(){var w;this._offlineMessagePullState=ge.a.SYNC_INIT,this._offlineMessagePullQueue=[],this.times=1,this.autoReconnectNumTotal=0,this.onOpened&&this.onOpened(),St.call(this),(w=this.eventHandler)===null||w===void 0||w.dispatch("onConnected"),At.call(this),vr.call(this),zt.call(this),vt.call(this)}function Zt(w,te){E.kg.debug("sendLastSession",w);var Re=Ir.call(this,w,te);Nt.call(this,Re)}function Kt(w){var te,Re,re,Ee,Ge,he,$e,ye=this,lt=this.root.lookup("easemob.pb.Provision").decode(w.payload);if(this.context.jid&&(this.context.jid.clientResource=lt.resource),this.clientResource=lt.resource,lt.status.errorCode===Ie.OK){if(this.disconnectedReason=void 0,lt.authToken){var Ze=JSON.parse(lt.authToken).expires_in;if(!this.tokenExpiredTimer&&!this.tokenWillExpireTimer){var Dt=Date.now();this.expirationTime=Ze;var Q=this.expirationTime-Dt;this.expiresIn=Q<0?0:Q,this.tokenExpireTimeCountDown(this.expiresIn)}}this.reconnecting=!1,this.logOut=!1,Pt.platform!=="zfb"&&Pt.platform!=="dd"||(this.sock.readyState=1),this._localCache?!((te=this._localCache)===null||te===void 0)&&te.getInstance()?Wt.call(this):this._localCache&&new this._localCache({user:this.user,dbName:"cache_".concat(Math.abs((0,Le.un)(this.appKey)),"_").concat(this.user),version:Oe,onInit:function(){return ft(ye,void 0,void 0,function(){return qe(this,function(Fe){return E.kg.debug("localCache init success"),Wt.call(this),[2]})})}}):Wt.call(this)}else{var Te=void 0,pe=lt.status,Ue=pe.reason,xe=pe.errorCode;switch(E.kg.debug("provision errorCode: ",xe),E.kg.debug("provision reason: ",Ue),xe){case Ie.FAIL:Te=Ue==="Sorry, user register limit"?P.Z.create({type:S.E.MAX_LIMIT,message:"Sorry, the number of user registrations limit has been reached"}):Ue==="Sorry, user register rate limit"?P.Z.create({type:S.E.MAX_LIMIT,message:"Sorry, user register rate limit"}):Ue==="Sorry, token expired"?P.Z.create({type:S.E.WEBIM_TOKEN_EXPIRED,message:"Sorry, token expired"}):Ue==="Sorry, token or password does not match login info"?P.Z.create({type:S.E.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR,message:"INVALID_TOKEN"}):Ue==="Sorry, user not found"?P.Z.create({type:S.E.USER_NOT_FOUND,message:"User not found"}):P.Z.create({type:S.E.WEBIM_CONNCTION_AUTH_ERROR,message:"Auth failed"}),(Re=this.eventHandler)===null||Re===void 0||Re.dispatch("onError",Te);break;case Ie.WRONG_PARAMETER:Te=P.Z.create({type:S.E.REQUEST_PARAMETER_ERROR,message:"Invalid parameter"}),(re=this.eventHandler)===null||re===void 0||re.dispatch("onError",Te);break;case Ie.UNAUTHORIZED:Te=P.Z.create({type:S.E.WEBIM_CONNCTION_AUTH_ERROR,message:"Auth failed"}),(Ee=this.eventHandler)===null||Ee===void 0||Ee.dispatch("onError",Te);break;case Ie.IM_FORBIDDEN:Te=P.Z.create({type:S.E.WEBIM_SERVER_SERVING_DISABLED,message:"Server serving disabled."}),(Ge=this.eventHandler)===null||Ge===void 0||Ge.dispatch("onError",Te);break;case Ie.PERMISSION_DENIED:Te=Ue==="Sorry, the app month live count limit"?P.Z.create({type:S.E.MAX_LIMIT,message:"Sorry, the monthly active user limit for this app has been reached"}):Ue==="Sorry, the app day live count limit"?P.Z.create({type:S.E.MAX_LIMIT,message:"Sorry, the daily active user limit for this app has been reached"}):Ue==="Sorry, the app online count limit"?P.Z.create({type:S.E.MAX_LIMIT,message:"Sorry, the maximum number limit of online users for this app has been reached"}):P.Z.create({type:S.E.WEBIM_CONNCTION_AUTH_ERROR,message:"Auth failed"}),(he=this.eventHandler)===null||he===void 0||he.dispatch("onError",Te);break;default:Te=P.Z.create({type:S.E.WEBIM_CONNCTION_AUTH_ERROR,message:Ue}),($e=this.eventHandler)===null||$e===void 0||$e.dispatch("onError",Te)}this.disconnectedReason=Te}}function At(){var w,te;if(((w=this.unMSyncSendMsgMap)===null||w===void 0?void 0:w.size)>0){for(var Re=Array.from(this.unMSyncSendMsgMap.keys()),re=0;re<Re.length;re++){var Ee=this.unMSyncSendMsgMap.get(Re[re]);Nt.call(this,Ee,Re[re])}(te=this.unMSyncSendMsgMap)===null||te===void 0||te.clear()}}function vt(){var w=er.call(this);Nt.call(this,w)}function zt(){E.kg.debug("sendUnreadDeal");var w=mr.call(this);Nt.call(this,w)}function vr(){var w=this;or.call(this),this.heartBeatID=setInterval(function(){(Date.now()-w.lastHeartbeat)/1e3>=30&&(E.kg.debug("send heart beat"),zt.call(w),w.lastHeartbeat=Date.now())},this.heartBeatWait)}function or(){clearInterval(this.heartBeatID)}function mr(){var w=this.root.lookup("easemob.pb.MSync"),te=w.decode([]);return te.version=this.version,te.encryptType=this.encryptType,te.command=1,w.encode(te).finish()}function ae(w,te){return w.some(function(Re){return Re.name===te.name})}function Ae(w){var te=this.root.lookup("easemob.pb.CommNotice"),Re=te.decode(w.payload),re=ae(this._queues,Re.queue);E.kg.debug("receive notice",te,this._queues);var Ee=ae(this.unSyncQueue,Re.queue);re||Ee||this.clientResource===Re.queue.clientResource&&Re.queue.name===this.context.userId||(this._queues.push(Re.queue),this._queues.length===1&&Xt.call(this,Re.queue))}function le(w){return ft(this,void 0,void 0,function(){var te,Re,re,Ee,Ge,he,$e,ye;return qe(this,function(lt){if(te=Z.P6.getEnvInfo(),Re=this.root.lookup("easemob.pb.MSync"),this.name==="miniCore"){try{Ee=new Uint8Array(w.data),re=Re.decode(Ee)}catch{throw new Error("decode message fail.")}return[2,re]}if(te.platform==="web"||te.platform==="zfb"||te.platform==="dd"){for(Ge=f().atob(w.data),he=[],$e=0,ye=Ge.length;$e<ye;++$e)he.push(Ge.charCodeAt($e));return[2,Re.decode(he)]}try{re=Re.decode(w.data)}catch{throw new Error("decode message fail.")}return[2,re]})})}function Xe(w){var te=this;this.lastHeartbeat=Date.now(),w.then(function(Re){if(Re)switch(Re.command){case 0:X.call(te,Re);break;case 1:Ar.call(te,Re);break;case 2:Ae.call(te,Re);break;case 3:Kt.call(te,Re);break;default:E.kg.error("unexpected msync command: ".concat(Re.command))}else E.kg.error("unexpected msync result: ".concat(Re))})}function X(w){var te,Re,re,Ee,Ge,he,$e,ye,lt,Ze,Dt,Q,Te,pe,Ue,xe,Fe,Je,ct,kt,mt,Jt,Rr,Or,It,Sr,Yr,xr,Tn,Cn,Oi,li,Zr,ma,Co,mn,ys,Wo,Ko,Wi,zo,qo,Ss,ja,ic;return ft(this,void 0,void 0,function(){var Tr,yn,nr,Jl,Rs,Zl,Yu,Ql,Yc,$l,Cs,Yo,ac,ph,Xu,Is,Xc,Io,Ju,Ao,Xo,Zu,oc,As,sc,eu,fh,Ta,Ea,Ui,cc,Fn,Jc,tu,ui,Jo,Si,Qi,lc,Qu,ru,nu,bs,mh=this;return qe(this,function(xi){switch(xi.label){case 0:if(Tr=(Tr=this.root.lookup("easemob.pb.CommSyncDL")).decode(w.payload),yn=new(v())(Tr.serverId.low,Tr.serverId.high,Tr.serverId.unsigned).toString(),nr=new(v())(Tr.metaId.low,Tr.metaId.high,Tr.metaId.unsigned).toString(),!(Number(nr)>0))return[3,23];if(!Tr.status)return[3,22];if(Tr.status.errorCode!==0)return[3,21];if((Jl=this._msgHash[nr])!=null&&Jl.isHandleChatroom){try{Rs=((te=this._msgHash[nr])===null||te===void 0?void 0:te.operation)==="join",((Re=this._msgHash[nr])===null||Re===void 0?void 0:Re.resolve)instanceof Function&&Rs&&this._msgHash[nr].resolve({type:0,data:{action:"apply",id:this._msgHash[nr].roomId,result:!0,user:this.context.userId}}),((re=this._msgHash[nr])===null||re===void 0?void 0:re.success)instanceof Function&&Rs&&this._msgHash[nr].success({type:0,data:{action:"apply",id:this._msgHash[nr].roomId,result:!0,user:this.context.userId}}),((Ee=this._msgHash[nr])===null||Ee===void 0?void 0:Ee.resolve)instanceof Function&&!Rs&&this._msgHash[nr].resolve({type:0,data:{result:!0}}),((Ge=this._msgHash[nr])===null||Ge===void 0?void 0:Ge.success)instanceof Function&&!Rs&&this._msgHash[nr].success({type:0,data:{result:!0}}),Ne.iO.has(nr)&&(Zl=Ne.iO.get(nr),ui=Zl.rpt,Jo=Zl.requestName,ui({isEndApi:!0,data:{isSuccess:1,requestName:Jo,requestMethod:"WEBSOCKET",requestUrl:this.url,code:Be.dd.success}}),Ne.iO.delete(nr))}catch(ji){Ne.iO.has(nr)&&(Yu=Ne.iO.get(nr),ui=Yu.rpt,Jo=Yu.requestName,ui({isEndApi:!0,data:{isSuccess:0,requestName:Jo,requestMethod:"WEBSOCKET",requestUrl:this.url,code:Be.dd.failed,codeDesc:"when executing success function error"}}),Ne.iO.delete(nr)),Qi=P.Z.create({type:S.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,message:"when executing success function error",data:ji}),this.onError&&this.onError(Qi),(he=this.eventHandler)===null||he===void 0||he.dispatch("onError",Qi)}delete this._msgHash[nr]}return!Jl||Jl.isHandleChatroom?[3,20]:(Ql=null,Yc="",$l=0,Cs=null,this._msgHash[nr].thirdMessage?(this._msgHash[nr].thirdMessage.id=Tr.serverId,this._msgHash[nr].thirdMessage.timestamp=Tr.timestamp,[4,y.Z.call(this,this._msgHash[nr].thirdMessage,Tr.status,!0,!0)]):[3,2]);case 1:Cs=xi.sent(),xi.label=2;case 2:if(Tr.metas.length===0)return[3,13];xi.label=3;case 3:switch(xi.trys.push([3,12,,13]),Yo=Tr.metas[0],ac=Tr.status,Yo.ns){case 1:return[3,4];case 5:return[3,9]}return[3,10];case 4:return this.useReplacedMessageContents?[4,y.Z.call(this,Yo,ac,!0,!0)]:[3,8];case 5:return Cs=xi.sent(),[4,(ye=($e=this._localCache)===null||$e===void 0?void 0:$e.getInstance())===null||ye===void 0?void 0:ye.getMessageByServerMsgId(nr)];case 6:return(ph=xi.sent())?[4,(Ze=(lt=this._localCache)===null||lt===void 0?void 0:lt.getInstance())===null||Ze===void 0?void 0:Ze.putMessageToDB(we(we(we({},ph),Cs),{id:nr}))]:[3,8];case 7:xi.sent(),xi.label=8;case 8:return[3,11];case 9:return(Xu=Z.P6.parseNotify(Tr.metas[0].payload)).edit_msg&&(Is=Xu.edit_msg,Xc=Is.count,Io=Is.operator,Ju=Is.edit_time,Ao=Is.sender,Xo=Is.send_time,Ql={operationTime:Ju,operatorId:Io,operationCount:Xc},Yc=Ao,$l=Number(Xo)),[3,11];case 10:return E.kg.error("decode local meta error",Yo),[3,11];case 11:return[3,13];case 12:return Zu=xi.sent(),Qi=P.Z.create({type:S.E.WEBIM_LOAD_MSG_ERROR,message:"decode local meta message error",data:Zu}),this.onError&&this.onError(Qi),(Dt=this.eventHandler)===null||Dt===void 0||Dt.dispatch("onError",Qi),[3,13];case 13:Ne.TJ.has(nr)&&(Ne.TJ.get(nr).rpt({isEndApi:!0,data:{isSuccess:1,requestMethod:"WEBSOCKET",requestUrl:this.url,code:Be.dd.success,msgId:yn}}),Ne.TJ.delete(nr)),xi.label=14;case 14:return xi.trys.push([14,18,,19]),oc={localMsgId:nr,serverMsgId:yn},Ql&&(this._msgHash[nr].modifiedInfo=Ql,As=this._msgHash[nr],sc=As.editMessageId,Fn=As.type,eu=As.chatType,fh=As.msg,Ta=As.to,Ea=As.translations,Ui={id:sc,type:Fn,chatType:eu,msg:fh,modifiedInfo:Ql,to:Ta,from:Yc,time:Number($l)},Ea&&(Ui.translations=Ea),oc.message=Ui,(pe=(Te=(Q=this._localCache)===null||Q===void 0?void 0:Q.getInstance())===null||Te===void 0?void 0:Te.getMessageByServerMsgId(sc))===null||pe===void 0||pe.then(function(ji){var Ja,Eh;ji&&ji.type==="txt"&&((Eh=(Ja=mh._localCache)===null||Ja===void 0?void 0:Ja.getInstance())===null||Eh===void 0||Eh.putMessageToDB(we(we({},ji),{msg:Ui.msg,modifiedInfo:Ui.modifiedInfo,translations:Ui.translations})))})),Cs&&(oc.message=Cs),[4,(xe=(Ue=this._localCache)===null||Ue===void 0?void 0:Ue.getInstance())===null||xe===void 0?void 0:xe.updateLocalMessage(nr,{serverMsgId:yn,status:ve.r.SUCCESS})];case 15:return xi.sent(),((Fe=this._msgHash[nr])===null||Fe===void 0?void 0:Fe.success)instanceof Function?[4,this._msgHash[nr].success(nr,yn)]:[3,17];case 16:xi.sent(),xi.label=17;case 17:return((Je=this._msgHash[nr])===null||Je===void 0?void 0:Je.resolve)instanceof Function&&this._msgHash[nr].resolve(oc),[3,19];case 18:return cc=xi.sent(),Qi=P.Z.create({type:S.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,message:"when executing success function error",data:cc}),this.onError&&this.onError(Qi),(ct=this.eventHandler)===null||ct===void 0||ct.dispatch("onError",Qi),[3,19];case 19:this.onReceivedMessage&&this.onReceivedMessage({id:nr,mid:yn,to:this._msgHash[nr].to,time:0}),(kt=this.eventHandler)===null||kt===void 0||kt.dispatch("onReceivedMessage",{id:nr,mid:yn,to:this._msgHash[nr].to}),delete this._msgHash[nr],xi.label=20;case 20:return[3,22];case 21:if(Tr.status.errorCode===15)((mt=this._msgHash[nr])===null||mt===void 0?void 0:mt.fail)instanceof Function&&this._msgHash[nr].fail({type:S.E.SERVICE_NOT_ALLOW_MESSAGING_MUTE,reason:"you were muted"}),this._msgHash[nr].reject instanceof Function&&this._msgHash[nr].reject({type:S.E.SERVICE_NOT_ALLOW_MESSAGING_MUTE,reason:"you were muted"}),(Rr=(Jt=this._localCache)===null||Jt===void 0?void 0:Jt.getInstance())===null||Rr===void 0||Rr.updateLocalMessage(nr,{serverMsgId:yn,status:ve.r.FAIL});else if(Tr.status.errorCode===1){switch(Fn=void 0,Tr.status.reason){case"blocked":Fn=S.E.PERMISSION_DENIED;break;case"group not found":Fn=S.E.GROUP_NOT_EXIST;break;case"not in group or chatroom":Fn=S.E.GROUP_NOT_JOINED;break;case"exceed recall time limit":Fn=S.E.MESSAGE_RECALL_TIME_LIMIT;break;case"message recall disabled":Fn=S.E.SERVICE_NOT_ENABLED;break;case"not in group or chatroom white list":Fn=S.E.SERVICE_NOT_ALLOW_MESSAGING;break;case"nonroster":Fn=S.E.USER_NOT_FRIEND,Tr.status.reason="not contact";break;case"group is disabled":Fn=S.E.GROUP_IS_DISABLED,Tr.status.reason="group is disabled";break;case"limit directed users":Fn=S.E.MAX_LIMIT;break;case"Sorry, edit limit reached":Fn=S.E.MAX_LIMIT,Tr.status.reason="Modify message limit reached";break;case"Sorry, message does not exist":Fn=S.E.MODIFY_MESSAGE_NOT_EXIST,Tr.status.reason="The message does not exist.";break;case"Sorry, You do not have permission":Fn=S.E.PERMISSION_DENIED,Tr.status.reason="You do not have the modified permission.";break;case"Sorry, format is incorrect":Fn=S.E.MODIFY_MESSAGE_FORMAT_ERROR,Tr.status.reason="The modify messaged format error.";break;case"Sorry, edit is not available":Fn=S.E.SERVICE_NOT_ENABLED,Tr.status.reason="The message modify function is not activated.";break;case"Sorry, edit fail":Fn=S.E.MODIFY_MESSAGE_FAILED,Tr.status.reason="Modify message failed.";break;default:Tr.status.reason.includes("grpID")&&Tr.status.reason.includes("does not exist!")?(Fn=S.E.CHATROOM_NOT_EXIST,Tr.status.reason="The chat room dose not exist."):Tr.status.reason.includes("username")&&Tr.status.reason.includes("doesn't exist!")?Fn=S.E.USER_NOT_FOUND:Tr.status.reason==="group member list is full!"?Fn=S.E.CHATROOM_MEMBERS_FULL:Tr.status.reason.includes("can not join this group")&&Tr.status.reason.includes("is in the blacklist")?(Fn=S.E.PERMISSION_DENIED,Tr.status.reason="permission denied"):Tr.status.reason==="can not operate this group, reason: group is disabled"?Fn=S.E.GROUP_IS_DISABLED:Tr.status.reason.includes("moderation")?Fn=S.E.MESSAGE_MODERATION_BLOCKED:Tr.status.reason.includes("group ID illegal, please check it")?(Fn=S.E.REQUEST_PARAMETER_ERROR,Tr.status.reason="Invalid parameter"):Fn=Tr.status.reason.includes("has create too many chatrooms")||Tr.status.reason.includes("has joined too many chatrooms")?S.E.MAX_LIMIT:Tr.status.reason.includes("auto create failed")?S.E.SERVER_BUSY:S.E.SERVER_UNKNOWN_ERROR}this._msgHash[nr]&&(!((Or=this._msgHash[nr])===null||Or===void 0)&&Or.isHandleChatroom?(Si=P.Z.create({type:Fn,message:Tr.status.reason||"",data:""}),this._msgHash[nr].reject instanceof Function&&this._msgHash[nr].reject(Si),this._msgHash[nr].error instanceof Function&&this._msgHash[nr].error(Si),Ne.iO.has(nr)&&(Jc=Be.dd.failed,Fn===S.E.CHATROOM_NOT_EXIST?Jc=Be.dd.notFound:Fn===S.E.CHATROOM_MEMBERS_FULL&&(Jc=Be.dd.reachLimit),tu=Ne.iO.get(nr),ui=tu.rpt,Jo=tu.requestName,ui({isEndApi:!0,data:{isSuccess:0,requestName:Jo,requestMethod:"WEBSOCKET",requestUrl:this.url,code:Jc,codeDesc:Tr.status.reason}}),Ne.iO.delete(nr))):(Si=P.Z.create({type:Fn,message:Tr.status.reason||"",data:{id:nr,mid:yn}}),this._msgHash[nr].reject instanceof Function&&this._msgHash[nr].reject(Si),this._msgHash[nr].fail instanceof Function&&this._msgHash[nr].fail({type:Fn,reason:Tr.status.reason?Tr.status.reason:"",data:{id:nr,mid:yn}}),(Sr=(It=this._localCache)===null||It===void 0?void 0:It.getInstance())===null||Sr===void 0||Sr.updateLocalMessage(nr,{serverMsgId:yn,status:ve.r.FAIL})),delete this._msgHash[nr])}else if(Tr.status.errorCode===7)Tr.status.reason==="sensitive words"&&this._msgHash[nr]?(Si=P.Z.create({type:S.E.MESSAGE_INCLUDE_ILLEGAL_CONTENT,message:"sensitive words",data:{id:nr,mid:yn}}),this._msgHash[nr].reject instanceof Function&&this._msgHash[nr].reject(Si),this._msgHash[nr].fail instanceof Function&&this._msgHash[nr].fail({type:S.E.MESSAGE_INCLUDE_ILLEGAL_CONTENT,data:{id:nr,mid:yn,reason:"sensitive words"}}),(xr=(Yr=this._localCache)===null||Yr===void 0?void 0:Yr.getInstance())===null||xr===void 0||xr.updateLocalMessage(nr,{serverMsgId:yn,status:ve.r.FAIL})):Tr.status.reason==="blocked by mod_antispam"&&this._msgHash[nr]?(Si=P.Z.create({type:S.E.MESSAGE_INCLUDE_ILLEGAL_CONTENT,message:"blocked by mod_antispam",data:{id:nr,mid:yn}}),this._msgHash[nr].reject instanceof Function&&this._msgHash[nr].reject(Si),this._msgHash[nr].fail instanceof Function&&this._msgHash[nr].fail({type:S.E.MESSAGE_INCLUDE_ILLEGAL_CONTENT,data:{id:nr,mid:yn,reason:"blocked by mod_antispam"}}),(Cn=(Tn=this._localCache)===null||Tn===void 0?void 0:Tn.getInstance())===null||Cn===void 0||Cn.updateLocalMessage(nr,{serverMsgId:yn,status:ve.r.FAIL})):Tr.status.reason==="user is mute"&&this._msgHash[nr]?(Si=P.Z.create({type:S.E.USER_MUTED_BY_ADMIN,message:"user is mute",data:{id:nr,mid:yn}}),this._msgHash[nr].reject instanceof Function&&this._msgHash[nr].reject(Si),this._msgHash[nr].fail instanceof Function&&this._msgHash[nr].fail(Si),(li=(Oi=this._localCache)===null||Oi===void 0?void 0:Oi.getInstance())===null||li===void 0||li.updateLocalMessage(nr,{serverMsgId:yn,status:ve.r.FAIL})):Tr.status.reason==="traffic limit"&&this._msgHash[nr]?(Si=P.Z.create({type:S.E.MESSAGE_CURRENT_LIMITING,message:"traffic limit",data:{id:nr,mid:yn}}),this._msgHash[nr].reject instanceof Function&&this._msgHash[nr].reject(Si),this._msgHash[nr].fail instanceof Function&&this._msgHash[nr].fail(Si),(ma=(Zr=this._localCache)===null||Zr===void 0?void 0:Zr.getInstance())===null||ma===void 0||ma.updateLocalMessage(nr,{serverMsgId:yn,status:ve.r.FAIL})):Tr.status.reason==="Sorry, data is too large"&&this._msgHash[nr]&&(Si=P.Z.create({type:S.E.MESSAGE_SIZE_LIMIT,message:"Sorry, data is too large",data:{id:nr,mid:yn}}),this._msgHash[nr].reject instanceof Function&&this._msgHash[nr].reject(Si),this._msgHash[nr].fail instanceof Function&&this._msgHash[nr].fail(Si),(mn=(Co=this._localCache)===null||Co===void 0?void 0:Co.getInstance())===null||mn===void 0||mn.updateLocalMessage(nr,{serverMsgId:yn,status:ve.r.FAIL}));else if(Tr.status.errorCode===19)this._msgHash[nr]&&(Ne.TJ.has(nr)&&(Ne.TJ.get(nr).rpt({isEndApi:!0,data:{isSuccess:0,requestMethod:"WEBSOCKET",requestUrl:this.url,code:S.E.MESSAGE_EXTERNAL_LOGIC_BLOCKED,codeDesc:Tr.status.reason||"",msgId:yn}}),Ne.TJ.delete(nr)),Si=P.Z.create({type:S.E.MESSAGE_EXTERNAL_LOGIC_BLOCKED,message:Tr.status.reason||"",data:{id:nr,mid:yn}}),this._msgHash[nr].reject instanceof Function&&this._msgHash[nr].reject(Si),this._msgHash[nr].fail instanceof Function&&this._msgHash[nr].fail({type:S.E.MESSAGE_EXTERNAL_LOGIC_BLOCKED,data:{id:nr,mid:yn,reason:Tr.status.reason}}),(Wo=(ys=this._localCache)===null||ys===void 0?void 0:ys.getInstance())===null||Wo===void 0||Wo.updateLocalMessage(nr,{serverMsgId:yn,status:ve.r.FAIL}));else if(this._msgHash[nr]){Ne.TJ.has(nr)&&(Ne.TJ.get(nr).rpt({isEndApi:!0,data:{isSuccess:0,requestMethod:"WEBSOCKET",requestUrl:this.url,code:S.E.WEBIM_LOAD_MSG_ERROR,codeDesc:((Ko=Tr.status)===null||Ko===void 0?void 0:Ko.reason)||"",msgId:yn}}),Ne.TJ.delete(nr));try{Si=P.Z.create({type:S.E.WEBIM_LOAD_MSG_ERROR,message:((Wi=Tr.status)===null||Wi===void 0?void 0:Wi.reason)||"",data:{id:nr,mid:yn,reason:Tr.status&&Tr.status.reason}}),this._msgHash[nr].reject instanceof Function&&this._msgHash[nr].reject(Si),(qo=(zo=this._localCache)===null||zo===void 0?void 0:zo.getInstance())===null||qo===void 0||qo.updateLocalMessage(nr,{serverMsgId:yn,status:ve.r.FAIL}),this._msgHash[nr].fail instanceof Function&&this._msgHash[nr].fail({type:S.E.WEBIM_LOAD_MSG_ERROR,data:{errorCode:Tr.status&&Tr.status.errorCode,reason:Tr.status&&Tr.status.reason}})}catch(ji){Qi=P.Z.create({type:S.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,message:"when executing fail function error",data:ji}),this.onError&&this.onError(Qi),(Ss=this.eventHandler)===null||Ss===void 0||Ss.dispatch("onError",Qi)}delete this._msgHash[nr]}else Ne.TJ.has(nr)&&(Ne.TJ.get(nr).rpt({isEndApi:!0,data:{isSuccess:0,requestMethod:"WEBSOCKET",requestUrl:this.url,code:S.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,codeDesc:"on message error",msgId:yn}}),Ne.TJ.delete(nr)),Qi=P.Z.create({type:S.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,message:"on message error"}),this.onError&&this.onError(Qi),(ja=this.eventHandler)===null||ja===void 0||ja.dispatch("onError",Qi);xi.label=22;case 22:return[2];case 23:if(Tr.metas&&Tr.metas.length!==0)try{Gt.call(this,Tr.metas,Tr.status)}catch(ji){Qi=P.Z.create({type:S.E.WEBIM_LOAD_MSG_ERROR,message:"decode message error",data:ji}),E.kg.error("decode message error",ji),this.onError&&this.onError(Qi),(ic=this.eventHandler)===null||ic===void 0||ic.dispatch("onError",Qi)}finally{Tr.isLast?(E.kg.debug("metas & CommSyncDLMessage.isLast",Tr.isLast),lc=-1,this._queues.some(function(ji,Ja){return ji.name===Tr.name&&(lc=Ja,!0)})&&lc>0&&this._queues.splice(lc,1),this._queues.length>0&&Xt.call(this,this._queues[0]),Qu=-1,this.unSyncQueue.some(function(ji,Ja){return ji.name===Tr.queue.name&&(Qu=Ja,!0)})&&this.unSyncQueue.splice(Qu,1),ir.call(this,Tr)):Tr.nextKey&&(bs=new(v())(Tr.nextKey.low,Tr.nextKey.high,Tr.nextKey.unsigned).toString(),E.kg.debug("nexKey:",bs,"this.nextKey:",this.nexKey),bs!==this.nexKey&&(this.nexKey=bs,Zt.call(this,Tr.nextKey,Tr.queue)))}else Tr.isLast?(E.kg.debug("CommSyncDLMessage.isLast",Tr.isLast),ru=-1,this._queues.some(function(ji,Ja){return ji.name===Tr.queue.name&&(ru=Ja,!0)})&&this._queues.splice(ru,1),this._queues.length>0&&Xt.call(this,this._queues[0]),nu=-1,this.unSyncQueue.some(function(ji,Ja){return ji.name===Tr.queue.name&&(nu=Ja,!0)})&&this.unSyncQueue.splice(nu,1),ir.call(this,Tr)):Tr.nextKey&&(bs=new(v())(Tr.nextKey.low,Tr.nextKey.high,Tr.nextKey.unsigned).toString(),E.kg.debug("nexKey:",bs,"this.nextKey:",this.nexKey),bs!==this.nexKey&&(this.nexKey=bs,Zt.call(this,Tr.nextKey,Tr.queue)));return[2]}})})}function et(w){var te=[],Re=this.root.lookup("easemob.pb.KeyValue"),re=[];for(var Ee in w){var Ge=Re.decode(te);if(Ge.key=Ee,w[Ee]!==void 0){if(Ye(w[Ee])==="object")Ge.type=8,Ge.stringValue=JSON.stringify(w[Ee]);else if(typeof w[Ee]=="string")Ge.type=7,Ge.stringValue=w[Ee];else if(typeof w[Ee]=="boolean")Ge.type=1,Ge.varintValue=w[Ee]===!0?1:0;else if(Number.isInteger(w[Ee]))Ge.type=2,Ge.varintValue=w[Ee];else if(typeof w[Ee]=="bigint"||Ye(w[Ee])==="symbol"||typeof w[Ee]=="function"||Number.isNaN(w[Ee]))Ge.type=7,Ge.stringValue=w[Ee].toString();else{if(typeof w[Ee]!="number"||Number.isInteger(w[Ee]))continue;Ge.type=6,Ge.doubleValue=w[Ee]}re.push(Ge)}}return re}function Me(w){var te,Re,re,Ee=[];if(this.root){var Ge,he=this.root.lookup("easemob.pb.MessageBody.Content").decode(Ee);switch(Ge=!w.group&&((te=w?.chatType)===null||te===void 0?void 0:te.toLowerCase())!=="groupchat"||w.roomType?w.group&&w.roomType||((Re=w?.chatType)===null||Re===void 0?void 0:Re.toLowerCase())==="chatroom"?"chatRoom":"singleChat":"groupChat",w.type){case"txt":he.type=0,he.text=w.msg;break;case"img":he.type=1,w.body?(he.displayName=w.body.filename,he.remotePath=w.body.url,he.secretKey=w.body.secret,he.fileLength=w.body.file_length,he.size=w.body.size,he.thumbnailDisplayName=w.body.filename):w.file?(he.displayName=w.file.filename,he.remotePath=w.file.url,he.secretKey=w.file.secret,he.fileLength=w.file.file_length,he.size=w.file.size,he.thumbnailDisplayName=w.file.filename):(he.displayName=w.filename,he.remotePath=w.url,he.secretKey=w.secret,he.fileLength=w.file_length,he.size=w.size,he.thumbnailDisplayName=w.filename),w.isBuildCombinedMsg&&(he.remotePath=w.url,he.secretKey=w.secret,he.size={height:w.height,width:w.width});break;case"video":he.type=2,w.body?(he.displayName=w.body.filename,he.remotePath=w.body.url,he.secretKey=w.body.secret,he.fileLength=w.body.file_length,he.duration=w.body.length,he.thumbnailDisplayName=w.body.filename,he.thumbnailRemotePath=this.useOwnUploadFun?"":"".concat(w.body.url,"?vframe=true"),he.thumbnailSecretKey=this.useOwnUploadFun?"":w.body.secret):w.isBuildCombinedMsg&&(he.displayName=w.filename,he.remotePath=w.url,he.secretKey=w.secret,he.fileLength=w.file_length,he.duration=w.length,he.thumbnailDisplayName=w.filename,he.thumbnailRemotePath=w.thumb,he.thumbnailSecretKey=w.thumb_secret);break;case"loc":he.type=3,he.latitude=w.lat,he.longitude=w.lng,he.address=w.addr,he.buildingName=w.buildingName,he.latitude=w.lat;break;case"audio":he.type=4,w.body?(he.displayName=w.body.filename,he.remotePath=w.body.url,he.secretKey=w.body.secret,he.fileLength=w.body.file_length,he.duration=w.body.length,he.thumbnailDisplayName=w.body.filename):w.isBuildCombinedMsg&&(he.displayName=w.filename,he.remotePath=w.url,he.secretKey=w.secret,he.fileLength=w.file_length,he.duration=w.length,he.thumbnailDisplayName=w.filename);break;case"file":he.type=5,w.body?(he.displayName=w.body.filename,he.remotePath=w.body.url,he.secretKey=w.body.secret,he.fileLength=w.body.file_length,he.thumbnailDisplayName=w.body.filename):w.isBuildCombinedMsg&&(he.displayName=w.filename,he.remotePath=w.url,he.secretKey=w.secret,he.fileLength=w.file_length,he.thumbnailDisplayName=w.filename);break;case"cmd":he.type=6,he.action=w.action;break;case"custom":he.type=7,he.customEvent=w.customEvent,he.customExts=et.call(this,w.customExts);break;case"combine":he.type=0,he.subType=0,he.text=w.compatibleText,he.displayName=w.filename,he.remotePath=w.url,he.secretKey=w.secret,he.fileLength=w.file_length,he.title=w.title,he.summary=w.summary,he.combineLevel=w.combineLevel}var $e=[];w.ext&&($e=et.call(this,w.ext));var ye=this.root.lookup("easemob.pb.MessageBody"),lt=ye.decode(Ee),Ze=w.from||this.context.jid.name;lt.from={name:w.isBuildCombinedMsg?Ze:this.context.jid.name};var Dt=w.to.indexOf("/"),Q=Dt>-1?w.to.substring(0,Dt):w.to;if(lt.to={name:Q},w.type==="channel")lt.type=pt.CHANNEL_ACK;else if(w.type==="recall")lt.type=pt.RECALL,lt.ackMessageId=w.ackId;else if(w.type==="delivery")lt.type=pt.DELIVER_ACK,lt.ackMessageId=w.ackId;else if(w.type==="read")lt.type=pt.READ_ACK,lt.ackMessageId=w.ackId,Ge==="groupChat"&&(lt.msgConfig={allowGroupAck:!0},lt.ackContent=w.ackContent);else if(Ge==="chatRoom")lt.type=pt.CHATROOM;else if(Ge==="groupChat"){if(lt.type=pt.GROUPCHAT,w.msgConfig){var Te=w.msgConfig.allowGroupAck;lt.msgConfig={allowGroupAck:!!Te}}}else Ge==="singleChat"&&(lt.type=pt.SINGLECHAT);w.editMessageId&&(lt.type=pt.EDIT,lt.editMessageId=w.editMessageId),lt.contents=[he],lt.ext=$e;var pe=function(Jt){var Rr={};return"translations"in Jt&&(Rr.translations=Jt.translations),"isChatThread"in Jt&&Jt.isChatThread&&(Rr.thread={}),Object.keys(Rr).length>0?JSON.stringify(Rr):""}(w);pe&&(lt.meta=pe),lt=ye.encode(lt).finish();var Ue=this.root.lookup("easemob.pb.Meta"),xe=Ue.decode(Ee);xe.id=w.id;var Fe="easemob.com";if(Ge!=="chatRoom"&&Ge!=="groupChat"||(Fe="conference.easemob.com"),xe.to={appKey:this.appKey,name:Q,domain:Fe},Dt>-1&&(xe.to.clientResource=w.to.substring(Dt+1,w.to.length)),Ge==="chatRoom"&&(xe.ext=et.call(this,function(Jt){return{chatroom_msg_tag:Jt.priority==="high"?0:Jt.priority==="low"?2:1}}(w))),w.type==="recall"&&w.metaExt&&(xe.ext=et.call(this,{recallMessageExtensionInfo:w.metaExt})),xe.ns=1,xe.payload=lt,xe.routetype=w.deliverOnlineOnly?1:0,Ge!=="singleChat"&&Array.isArray(w.receiverList)&&((re=w.receiverList)===null||re===void 0?void 0:re.length)>0&&(xe.directedUsers=w.receiverList,xe.routetype=2),w.isBuildCombinedMsg)return xe.timestamp=v().fromValue(w.time),Ue.encode(xe).finish();var Je=this.root.lookup("easemob.pb.CommSyncUL"),ct=Je.decode(Ee);ct.meta=xe,Qe.call(this,w,xe),ct=Je.encode(ct).finish();var kt=this.root.lookup("easemob.pb.MSync"),mt=kt.decode(Ee);return mt.version=this.version,mt.encryptType=this.encryptType,mt.command=0,mt.payload=ct,kt.encode(mt).finish()}w.fail&&w.fail({type:S.E.WEBIM_CONNCTION_CLIENT_OFFLINE,message:"Not logged in"})}function He(w){var te,Re,re=this,Ee=we({},w);if(w.file)return Ee.accessToken=this.token,Ee.appKey=this.appKey,Ee.apiUrl=this.apiUrl,Ee.body&&Ee.body.url?Me.call(this,Ee):new Promise(function(ye,lt){var Ze=Ee.onFileUploadComplete;Ee.onFileUploadComplete=function(Dt){var Q,Te,pe,Ue,xe,Fe;if(Dt.entities[0]["file-metadata"]){var Je=Dt.entities[0]["file-metadata"]["content-length"];Ee.file_length=Je,Ee.filetype=Dt.entities[0]["file-metadata"]["content-type"],Je>204800&&(Ee.thumbnail=!0)}var ct="".concat(re.apiUrl,"/").concat(re.orgName,"/").concat(re.appName,"/chatfiles/").concat(Dt.entities[0].uuid);Ee.body={type:Ee.type||"file",secret:Dt.entities[0]["share-secret"],filename:Ee.file.filename||Ee.filename,url:ct,length:Ee.length||0,filetype:Ee.filetype||Ee.file.filetype,file_length:((Te=(Q=Ee.file)===null||Q===void 0?void 0:Q.data)===null||Te===void 0?void 0:Te.size)||0,size:{width:Ee.width||0,height:Ee.height||0}},Ee.file.url=Dt.uri,w.secret=Dt.entities[0]["share-secret"],Dt.url=w.url="".concat(ct,"?em-redirect=true&share-secret=").concat(Dt.entities[0]["share-secret"]),w.file_length=Ee.file_length=((Ue=(pe=Ee.file)===null||pe===void 0?void 0:pe.data)===null||Ue===void 0?void 0:Ue.size)||0,Ee.type==="img"&&(w.thumb="".concat(w.url,"&thumbnail=true"),Dt.thumb="".concat(Dt.url,"&thumbnail=true")),Ee.type==="video"&&(w.thumb="".concat(w.url,"&vframe=true"),w.thumb_secret=Dt.entities[0]["share-secret"],Dt.thumb="".concat(Dt.url,"&vframe=true")),Ze instanceof Function&&Ze(Dt,Ee.id);var kt=Me.call(re,Ee);Ne.TJ.size<=Ne.F3&&Ne.TJ.set(Ee.id,{rpt:re.dataReport.geOperateFun({operationName:Be.fI.SEND_MSG})}),(Fe=(xe=re._localCache)===null||xe===void 0?void 0:xe.getInstance())===null||Fe===void 0||Fe.storeMessage(w,ve.r.INPROGRESS),Nt.call(re,kt)},Z.P6.uploadFile.call(re,Ee,Be.fI.UPLOAD_MSG_ATTACH)});if(w.type==="combine"){Ee.accessToken=this.token,Ee.appKey=this.appKey,Ee.apiUrl=this.apiUrl;var Ge=Ee.onFileUploadComplete,he=Ee.onFileUploadError;return new Promise(function(ye,lt){var Ze,Dt,Q,Te;if(((Ze=w.messageList)===null||Ze===void 0?void 0:Ze.length)>300||((Dt=w.messageList)===null||Dt===void 0?void 0:Dt.length)===0)return re._msgHash[Ee.id].reject({type:S.E.MAX_LIMIT,message:"The number of combined messages exceeded the limit."});var pe=it([],w.messageList),Ue=0;if(pe.forEach(function(Rr){Rr?.combineLevel>Ue&&(Ue=Rr?.combineLevel)}),Ee.combineLevel=Ue+1,Ee.combineLevel>10)return re._msgHash[Ee.id].reject({type:S.E.MAX_LIMIT,message:"The level of the merged message exceeded the limit."});var xe=ht.call(re,pe),Fe=function(Rr,Or){var It,Sr,Yr,xr,Tn,Cn,Oi="".concat(re.apiUrl,"/").concat(re.orgName,"/").concat(re.appName,"/chatfiles/").concat(Rr.entities[0].uuid),li=(It=Rr.entities[0])===null||It===void 0?void 0:It["share-secret"],Zr=Oi+"?em-redirect=true";li&&(Zr="".concat(Zr,"&share-secret=").concat(li)),Ge instanceof Function&&Ge({url:Zr,secret:li}),w.url=Zr,w.secret=li,Ee.url=Zr,Ee.secret=Rr.entities[0]["share-secret"],Ee.filename=((Sr=Ee.file)===null||Sr===void 0?void 0:Sr.filename)||Or?.fileName,Ee.file_length=((xr=(Yr=Ee.file)===null||Yr===void 0?void 0:Yr.data)===null||xr===void 0?void 0:xr.size)||Or?.fileLength||0,(Cn=(Tn=re._localCache)===null||Tn===void 0?void 0:Tn.getInstance())===null||Cn===void 0||Cn.storeMessage(w,ve.r.INPROGRESS);var ma=Me.call(re,Ee);Nt.call(re,ma)},Je=Z.P6.getEnvInfo();if(Je.platform!=="web"&&Je.platform!=="node"&&Je.platform!=="quick_app"&&(!((Te=(Q=Je.global)===null||Q===void 0?void 0:Q.canIUse)===null||Te===void 0)&&Te.call(Q,"getFileSystemManager"))){var ct=Je.global.getFileSystemManager(),kt="".concat(re.apiUrl,"/").concat(re.orgName,"/").concat(re.appName,"/chatfiles");ct.writeFile({filePath:"".concat(Je.global.env.USER_DATA_PATH,"/combine"),data:xe.buffer,encoding:"binary",success:function(Rr){Je.global.uploadFile({url:kt,filePath:"".concat(Je.global.env.USER_DATA_PATH,"/combine"),name:"file",header:{"Content-Type":"multipart/form-data",Authorization:"Bearer "+Ee.accessToken},success:function(Or){if(Or.statusCode===200){E.kg.debug("upload success",Or);var It=JSON.parse(Or.data);Fe(It,{fileName:"combine",fileLength:xe.length})}else E.kg.debug("upload fail"),Ee.onFileUploadError instanceof Function&&Ee.onFileUploadError(Or),this._msgHash[Ee.id].reject({type:S.E.WEBIM_UPLOADFILE_ERROR,message:"Failed to upload the merge message.Please try again",data:Or})},fail:function(Or){E.kg.debug("upload fail"),Ee.onFileUploadError instanceof Function&&Ee.onFileUploadError(Rr),this._msgHash[Ee.id].reject({type:S.E.WEBIM_UPLOADFILE_ERROR,message:"Failed to upload the merge message.Please try again",data:Or})}})},fail:function(Rr){E.kg.debug("write file fail",Rr),this._msgHash[Ee.id].reject({type:S.E.WEBIM_UPLOADFILE_ERROR,message:"Failed to upload the merge message.Please try again",data:Rr})}})}else{var mt=new File([xe],"combine",{type:"application/octet-stream"}),Jt={url:URL.createObjectURL(mt),filename:Ee.id,data:mt};Ee.file=Jt,Ee.onFileUploadComplete=function(Rr){Fe(Rr)},Ee.onFileUploadError=function(Rr){he instanceof Function&&he(Rr),re._msgHash[Ee.id].reject({type:S.E.WEBIM_UPLOADFILE_ERROR,message:"Failed to upload the merge message.Please try again",data:Rr})},Z.P6.uploadFile.call(re,Ee,Be.fI.UPLOAD_MSG_ATTACH)}})}w.type==="img"&&(Ee.body||(Ee.body=we(we({},Ee),{size:{width:Ee.width||0,height:Ee.height||0}}))),(Re=(te=this._localCache)===null||te===void 0?void 0:te.getInstance())===null||Re===void 0||Re.storeMessage(w,ve.r.INPROGRESS);var $e=Me.call(this,Ee);Nt.call(this,$e)}function Qe(w,te){w.editMessageId||Tt.includes(w.type)&&(this._msgHash[w.id].thirdMessage=te)}function ht(w){for(var te=Uint8Array.from("cm",function(Q){return Q.charCodeAt(0)}),Re=0;Re<w.length;Re++){for(var re=w[Re],Ee=we(we({},re),{isBuildCombinedMsg:!0}),Ge=this.mSync.encodeChatMsg.call(this,Ee),he=Ge.length,$e=new Uint8Array(4),ye=0;ye<4;ye++)$e[ye]=he>>8*(3-ye)&255;E.kg.debug("message length:",$e);var lt=new Uint8Array(te.length+$e.length+Ge.length);lt.set(te),lt.set($e,te.length),lt.set(Ge,te.length+$e.length),te=lt}var Ze=new Uint8Array(te.length+1),Dt=0;for(Re=2;Re<te.length;Re++)Re%2==1&&(Dt^=te[Re]);return Ze.set(te),E.kg.debug("checkResult:",Dt),Ze[te.length]=Dt,Ze}function rt(w,te,Re){var re=[],Ee=this.root.lookup("easemob.pb.MUCBody"),Ge=w.roomId,he=w.ext,$e=he===void 0?"":he,ye=w.leaveOtherRooms,lt=ye!==void 0&&ye,Ze=Ee.decode(re);Ze.mucId={appKey:this.appKey,name:Ge,domain:"conference.easemob.com"},Ze.operation=Re==="join"?2:3,Ze.from={name:this.context.userId},Ze.isChatroom=!0,Re==="join"&&(Ze.ext=$e,Ze.leaveOtherRooms=lt),Ze=Ee.encode(Ze).finish();var Dt=this.root.lookup("easemob.pb.Meta").decode(re);Dt.id=te,Dt.from={appKey:this.appKey,name:this.context.userId,domain:"easemob.com",client_resource:this.context.jid.clientResource},Dt.to={domain:"easemob.com"},Dt.ns=2,Dt.payload=Ze;var Q=this.root.lookup("easemob.pb.CommSyncUL"),Te=Q.decode(re);Te.meta=Dt,Te=Q.encode(Te).finish();var pe=this.root.lookup("easemob.pb.MSync"),Ue=pe.decode(re);return Ue.version=this.version,Ue.encryptType=this.encryptType,Ue.command=0,Ue.payload=Te,pe.encode(Ue).finish()}function Ct(w,te){var Re=Z.P6.getUniqueId(),re=rt.call(this,w,Re,te),Ee=te==="join"?Be.fI.JOIN_CHATROOM:Be.fI.QUIT_CHATROOM,Ge=this.dataReport.geOperateFun({operationName:Ee});return Ne.iO.size<=Ne.F3&&Ne.iO.set(Re,{rpt:Ge,requestName:Ee}),Nt.call(this,we(we({},w),{isHandleChatroom:!0,joinMsg:re,id:Re,operation:te}),Re)}function xt(w){var te=this;return new Promise(function(Re,re){var Ee,Ge,he,$e,ye,lt;if(E.kg.debug("call send"),te.logOut)return E.kg.debug("send message failed",S.E.WEBIM_CONNECTION_CLOSED),re({type:S.E.WEBIM_CONNECTION_CLOSED,message:"not login"});if(!w.id||typeof w.id!="string"||w.id==="")return re({type:S.E.MESSAGE_PARAMETER_ERROR,message:'Missing required parameter: "id"'});if(!w.to||typeof w.to!="string"||w.to==="")return re({type:S.E.MESSAGE_PARAMETER_ERROR,message:'Missing required parameter: "to"'});var Ze=w.type==="file"||w.type==="img"||w.type==="audio"||w.type==="video",Dt=w.type==="delivery"||w.type==="read"||w.type==="channel",Q=w.type==="cmd",Te=w.type==="recall",pe=w?.editMessageId,Ue=!(Dt||Te||Q||pe);if(w.id){if(!Ze&&!Dt||Ze&&te.useOwnUploadFun){var xe=w.type==="recall"?Be.fI.SEND_RECALL_MSG:Be.fI.SEND_MSG;pe&&(xe=Be.fI.MODIFY_MESSAGE),Ne.TJ.size<=Ne.F3&&Ne.TJ.set(w.id,{rpt:te.dataReport.geOperateFun({operationName:xe})})}Ue&&((Ge=(Ee=te._localCache)===null||Ee===void 0?void 0:Ee.getInstance())===null||Ge===void 0||Ge.storeMessage(w,ve.r.CREATE)),te._msgHash[w.id]=we(we({},w),{resolve:Re,reject:re})}if(Ze||w.type==="combine")return He.call(te,w);if(w.type==="txt"&&(!((he=w.msgConfig)===null||he===void 0)&&he.languages)&&Array.isArray(($e=w.msgConfig)===null||$e===void 0?void 0:$e.languages)&&w.msgConfig.languages.length>0){var Fe=te.translateMessage||te.translation.translateMessage;if(!Fe)throw new Error("there is no method to translate message");Fe.call(te,{text:w.msg,languages:w.msgConfig.languages}).then(function(ct){var kt,mt,Jt,Rr=(kt=ct.data[0])===null||kt===void 0?void 0:kt.translations;Rr=Rr.map(function(It){return{code:It.to,text:It.text}}),w.translations=Rr,te._msgHash[w.id].translations=Rr,(Jt=(mt=te._localCache)===null||mt===void 0?void 0:mt.getInstance())===null||Jt===void 0||Jt.storeMessage(w,ve.r.INPROGRESS);var Or=Me.call(te,w);Nt.call(te,Or,w.id)}).catch(function(ct){re(ct)})}else{Ue&&((lt=(ye=te._localCache)===null||ye===void 0?void 0:ye.getInstance())===null||lt===void 0||lt.storeMessage(w,ve.r.INPROGRESS));var Je=Me.call(te,w);Nt.call(te,Je,w.id)}})}function Nt(w,te){var Re,re,Ee=this;if(w.isHandleChatroom){if(!this.isOpened()){var Ge={data:"",type:S.E.WEBIM_CONNCTION_DISCONNECTED,message:"websocket has been disconnected"};if(Ne.iO.has(w.id)){var he=Ne.iO.get(w.id);(0,he.rpt)({isEndApi:!0,data:{isSuccess:0,requestName:he.requestName,requestMethod:"WEBSOCKET",requestUrl:this.url,code:Be.dd.disconnect,codeDesc:"websocket has been disconnected"}}),Ne.iO.delete(w.id)}return Promise.reject(Ge)}return new Promise(function($e,ye){var lt;Ee._msgHash[w.id]=we(we({},w),{resolve:$e,reject:ye}),lt=Ee.name==="miniCore"?w.joinMsg:jt.call(Ee,w.joinMsg,te),Ee.sock.send(lt)})}if(!this.isOpened())return(Re=this.unMSyncSendMsgMap)===null||Re===void 0||Re.set(te,w),!this.logOut&&this.autoReconnectNumTotal<this.autoReconnectNumMax&&(E.kg.debug("need to reconnect",this.autoReconnectNumTotal,this.autoReconnectNumMax),this.offLineSendConnecting=!0,this.reconnecting||this.reconnect()),void(this.onError&&this.onError({type:S.E.WEBIM_CONNCTION_DISCONNECTED,message:"websocket has been disconnected"}));re=this.name==="miniCore"?w:jt.call(this,w,te),this.sock.send(re)}var yr=function(w,te){return w.send=xt,w.sendMsg=xt,E.kg.debug("init Msync by ".concat(w.name)),{generateProvision:bt.bind(w),base64transform:jt.bind(w),distributeMeta:Lt.bind(w),decodeMeta:Gt.bind(w),decodeUnreadDL:Ar.bind(w),_rebuild:er.bind(w),_lastsession:Ir.bind(w),receiveProvision:Kt.bind(w),isInQueue:ae.bind(w),decodeNotice:Ae.bind(w),decodeMSync:le.bind(w),distributeMSync:Xe.bind(w),encodeChatMsg:Me.bind(w),upLoadFile:He.bind(w),send:xt.bind(w),stopHeartBeat:or.bind(w),handleChatRoom:Ct.bind(w)}}},7252:function(O,j){var c=function(){function p(f){this.type=f.type,this.message=f.message,this.data=f.data}return p.create=function(f){return new p(f)},p}();j.Z=c},8161:function(O,j,c){c.d(j,{t:function(){return Z}}),c(9601),c(1539),c(8674),c(2526),c(1817),c(2165),c(6992),c(8783),c(3948),c(7941),c(3710),c(9714),c(9653),c(6699),c(2023),c(2222),c(8309),c(9554),c(4747),c(2772);var p=c(3720),f=c.n(p),T=c(4363),v=c(4024),S=c(6424),y=c(9743),E=c(7360),N=c(2449),C=c(7288),U=function(){return U=Object.assign||function(W){for(var ne,ee=1,H=arguments.length;ee<H;ee++)for(var q in ne=arguments[ee])Object.prototype.hasOwnProperty.call(ne,q)&&(W[q]=ne[q]);return W},U.apply(this,arguments)},M=function(W,ne,ee,H){return new(ee||(ee=Promise))(function(q,ve){function Le(je){try{ge(H.next(je))}catch(Ne){ve(Ne)}}function Oe(je){try{ge(H.throw(je))}catch(Ne){ve(Ne)}}function ge(je){var Ne;je.done?q(je.value):(Ne=je.value,Ne instanceof ee?Ne:new ee(function(Be){Be(Ne)})).then(Le,Oe)}ge((H=H.apply(W,[])).next())})},x=function(W,ne){var ee,H,q,ve,Le={label:0,sent:function(){if(1&q[0])throw q[1];return q[1]},trys:[],ops:[]};return ve={next:Oe(0),throw:Oe(1),return:Oe(2)},typeof Symbol=="function"&&(ve[Symbol.iterator]=function(){return this}),ve;function Oe(ge){return function(je){return function(Ne){if(ee)throw new TypeError("Generator is already executing.");for(;Le;)try{if(ee=1,H&&(q=2&Ne[0]?H.return:Ne[0]?H.throw||((q=H.return)&&q.call(H),0):H.next)&&!(q=q.call(H,Ne[1])).done)return q;switch(H=0,q&&(Ne=[2&Ne[0],q.value]),Ne[0]){case 0:case 1:q=Ne;break;case 4:return Le.label++,{value:Ne[1],done:!1};case 5:Le.label++,H=Ne[1],Ne=[0];continue;case 7:Ne=Le.ops.pop(),Le.trys.pop();continue;default:if(!((q=(q=Le.trys).length>0&&q[q.length-1])||Ne[0]!==6&&Ne[0]!==2)){Le=0;continue}if(Ne[0]===3&&(!q||Ne[1]>q[0]&&Ne[1]<q[3])){Le.label=Ne[1];break}if(Ne[0]===6&&Le.label<q[1]){Le.label=q[1],q=Ne;break}if(q&&Le.label<q[2]){Le.label=q[2],Le.ops.push(Ne);break}q[2]&&Le.ops.pop(),Le.trys.pop();continue}Ne=ne.call(W,Le)}catch(Be){Ne=[6,Be],H=0}finally{ee=q=0}if(5&Ne[0])throw Ne[1];return{value:Ne[0]?Ne[1]:void 0,done:!0}}([ge,je])}}},P={0:"TEXT",1:"IMAGE",2:"VIDEO",3:"LOCATION",4:"VOICE",5:"FILE",6:"COMMAND",7:"CUSTOM",8:"COMBINE"};function z(W){for(var ne={},ee=0;ee<W.length;ee++)if(W[ee].type===8)ne[W[ee].key]=JSON.parse(W[ee].stringValue);else if(W[ee].type===7)ne[W[ee].key]=W[ee].stringValue;else if(W[ee].type===6)ne[W[ee].key]=W[ee].doubleValue;else if(W[ee].type===5)ne[W[ee].key]=W[ee].floatValue;else if(W[ee].type===1){var H=W[ee].varintValue,q=new(f())(H.low,H.high,H.unsigned).toString();ne[W[ee].key]=Number(q)!==0}else W[ee].type!==2&&W[ee].type!==3&&W[ee].type!==4||(H=W[ee].varintValue,q=new(f())(H.low,H.high,H.unsigned).toString(),ne[W[ee].key]=Number(q));return ne}function Z(W){var ne="";return W.remotePath&&(ne=v.P6.formatAttachUrl.call(this,W.remotePath),W.remotePath.includes("?em-redirect")||(ne="".concat(ne,"?em-redirect=true"),W.secretKey&&(ne="".concat(ne,"&share-secret=").concat(W.secretKey)))),ne}function I(W,ne){var ee,H,q=ne.from&&ne.from.name;if(q===this.context.userId){var ve=(ee=W?.from)===null||ee===void 0?void 0:ee.clientResource;q===((H=ne?.to)===null||H===void 0?void 0:H.name)&&ve&&ve!==this.clientResource&&(q="".concat(q,"/").concat(ve))}return q}function Y(W,ne){var ee,H=ne.to&&ne.to.name;return!((ee=W?.to)===null||ee===void 0)&&ee.clientResource&&(H="".concat(H,"/").concat(W.to.clientResource)),H}function F(W){var ne,ee,H,q,ve,Le,Oe,ge,je,Ne,Be,Ye,pt,dt,Ie,we,ft,qe,it,Tt,Pt,bt,jt,Lt,Gt,pr,ir;return M(this,void 0,void 0,function(){var Ar,er,yt,Xt,Ir,St,Wt,Zt,Kt,At,vt,zt,vr,or,mr,ae,Ae,le,Xe,X,et,Me,He,Qe,ht,rt,Ct,xt,Nt,yr,w,te,Re,re,Ee,Ge,he,$e,ye,lt,Ze,Dt,Q,Te,pe,Ue,xe,Fe,Je,ct,kt,mt;return x(this,function(Jt){switch(Jt.label){case 0:switch(Ar=W.status,er=W.thirdMessage,yt=W.msgBody,Xt=W.msgId,Ir=W.type,St=W.from,Wt=W.to,Zt=W.time,Kt=W.onlineState,At=W.chatType,vt=W.ignoreCallback,zt=W.priority,vr=W.format,or=W.broadcast,mr=or!==void 0&&or,ae=W.isContentReplaced,Ae=ae!==void 0&&ae,le={},Xe={},X=Ar.errorCode>0,et=Ar.errorCode,Me=Ar.reason,He={},Qe=[],ht=[],rt={},Ct="",xt=0,Nt=null,yr=null,er.ext&&(He=z(er.ext)),er.meta&&typeof er.meta=="string"&&((te=JSON.parse(er.meta)).reaction&&(Qe=te.reaction).forEach(function(Rr){Rr.isAddedBySelf=Rr.state,delete Rr.state}),te.translations&&(ht=te.translations),te.edit_msg&&(Re=te.edit_msg,re=Re.count,Ee=Re.operator,Ge=Re.edit_time,he=Re.sender,$e=Re.send_time,rt={operationTime:Ge,operatorId:Ee,operationCount:re},Ct=he,xt=$e),te.thread&&JSON.stringify(te.thread)!=="{}"&&(Nt={messageId:te.thread.msg_parent_id,parentId:te.thread.muc_parent_id,chatThreadName:te.thread.thread_name}),te.thread_overview&&JSON.stringify(te.thread_overview)!=="{}"&&(yr={id:te.thread_overview.id,parentId:te.thread_overview.muc_parent_id,name:te.thread_overview.name,lastMessage:te.thread_overview.last_message&&JSON.stringify(te.thread_overview.last_message)!=="{}"?T.w.call(this,te.thread_overview.last_message):null,createTimestamp:te.thread_overview.create_timestamp,updateTimestamp:te.thread_overview.update_timestamp,messageCount:te.thread_overview.message_count||0})),yt.type){case 0:return[3,1];case 1:return[3,7];case 2:return[3,10];case 3:return[3,13];case 4:return[3,16];case 5:return[3,19];case 6:return[3,22];case 7:return[3,23];case 8:return[3,26]}return[3,27];case 1:return Object.prototype.hasOwnProperty.call(yt,"subType")&&yt.subType===0?(w=Z.call(this,yt),ye={id:Xt,type:"combine",chatType:At,to:Wt,from:St,ext:He,time:Number(Zt),onlineState:Kt,title:yt.title||"",summary:yt.summary||"",url:w||"",secret:yt.secretKey||"",file_length:yt.fileLength||0,filename:yt.displayName||"",compatibleText:yt.text,combineLevel:yt.combineLevel||0},le.msgConfig&&(ye.msgConfig=le.msgConfig),Qe.length>0&&(ye.reactions=Qe),Nt&&(ye.chatThread=Nt),yr&&(ye.chatThreadOverview=yr),At==="chatRoom"&&(ye.priority=zt,ye.broadcast=mr),Ae&&(ye.isContentReplaced=Ae),Xe=ye,vt?[3,3]:[4,(ee=(ne=this._localCache)===null||ne===void 0?void 0:ne.getInstance())===null||ee===void 0?void 0:ee.storeMessage(ye,C.r.SUCCESS)]):[3,4];case 2:Jt.sent(),(H=this.eventHandler)===null||H===void 0||H.dispatch("onCombineMessage",ye),Jt.label=3;case 3:return[3,28];case 4:return!(le={id:Xt,type:Ir,contentsType:P[yt.type],from:St,to:Wt,data:yt.text,ext:He,sourceMsg:yt.text,time:Zt,msgConfig:er.msgConfig,onlineState:Kt}).msgConfig&&delete er.msgConfig,le.error=X,le.errorText=Me,le.errorCode=et,!vt&&this.onTextMessage&&this.onTextMessage(le),lt={id:Xt,type:"txt",chatType:At,msg:yt.text,to:Wt,from:St,ext:He,time:Number(Zt),onlineState:Kt},le.msgConfig&&(lt.msgConfig=le.msgConfig),Qe.length>0&&(lt.reactions=Qe),Nt&&(lt.chatThread=Nt),yr&&(lt.chatThreadOverview=yr),ht.length>0&&(lt.translations=ht),rt.operationCount>0&&(lt.modifiedInfo=rt,er.type===S.gA.EDIT&&(lt.from=Ct,lt.time=xt)),At==="chatRoom"&&(lt.priority=zt,lt.broadcast=mr),Ae&&(lt.isContentReplaced=Ae),Xe=lt,vt?[3,6]:[4,(ve=(q=this._localCache)===null||q===void 0?void 0:q.getInstance())===null||ve===void 0?void 0:ve.storeMessage(lt,C.r.SUCCESS)];case 5:Jt.sent(),(Le=this.eventHandler)===null||Le===void 0||Le.dispatch("onTextMessage",lt),Jt.label=6;case 6:return[3,28];case 7:return Ze=((Oe=yt?.size)===null||Oe===void 0?void 0:Oe.width)||0,Dt=((ge=yt?.size)===null||ge===void 0?void 0:ge.height)||0,w=this.useOwnUploadFun?yt.remotePath:Z.call(this,yt),!(le={id:Xt,type:Ir,contentsType:P[yt.type],from:St,to:Wt,url:w,secret:yt.secretKey,filename:yt.displayName,thumb:this.useOwnUploadFun?"":"".concat(w,"&thumbnail=true"),thumb_secret:yt.secretKey,file_length:yt.fileLength||"",width:Ze,height:Dt,filetype:yt.filetype||"",accessToken:this.token,ext:He,time:Zt,msgConfig:er.msgConfig,onlineState:Kt}).delay&&delete le.delay,!le.msgConfig&&delete er.msgConfig,le.error=X,le.errorText=Me,le.errorCode=et,!vt&&this.onPictureMessage&&this.onPictureMessage(le),Q={id:Xt,type:"img",chatType:At,from:St,to:Wt,url:w||"",width:Ze,height:Dt,secret:yt.secretKey||"",thumb:this.useOwnUploadFun?"":"".concat(w,"&thumbnail=true"),thumb_secret:yt.secretKey,file_length:yt.fileLength||0,ext:He,time:Number(Zt),onlineState:Kt},le.msgConfig&&(Q.msgConfig=le.msgConfig),Qe.length>0&&(Q.reactions=Qe),Nt&&(Q.chatThread=Nt),yr&&(Q.chatThreadOverview=yr),At==="chatRoom"&&(Q.priority=zt,Q.broadcast=mr),Ae&&(Q.isContentReplaced=Ae),Xe=Q,vt?[3,9]:[4,(Ne=(je=this._localCache)===null||je===void 0?void 0:je.getInstance())===null||Ne===void 0?void 0:Ne.storeMessage(Q,C.r.SUCCESS)];case 8:Jt.sent(),(Be=this.eventHandler)===null||Be===void 0||Be.dispatch("onImageMessage",Q),Jt.label=9;case 9:return[3,28];case 10:return w=this.useOwnUploadFun?yt.remotePath:Z.call(this,yt),!(le={id:Xt,type:Ir,contentsType:P[yt.type],from:St,to:Wt,url:w,secret:yt.secretKey,filename:yt.displayName,length:yt.duration||"",file_length:yt.fileLength||"",filetype:yt.filetype||"",accessToken:this.token||"",ext:He,time:Zt,msgConfig:er.msgConfig,onlineState:Kt}).delay&&delete le.delay,!le.msgConfig&&delete er.msgConfig,le.error=X,le.errorText=Me,le.errorCode=et,!vt&&this.onVideoMessage&&this.onVideoMessage(le),Te={id:Xt,type:"video",chatType:At,from:St,to:Wt,url:w,secret:yt.secretKey,thumb:v.P6.formatAttachUrl.call(this,yt.thumbnailRemotePath),thumb_secret:yt.thumbnailSecretKey,filename:yt.displayName,length:yt.duration||0,file:{},file_length:yt.fileLength||0,filetype:yt.filetype||"",accessToken:this.token||"",ext:He,time:Number(Zt),onlineState:Kt},le.msgConfig&&(Te.msgConfig=le.msgConfig),Qe.length>0&&(Te.reactions=Qe),Nt&&(Te.chatThread=Nt),yr&&(Te.chatThreadOverview=yr),At==="chatRoom"&&(Te.priority=zt,Te.broadcast=mr),Ae&&(Te.isContentReplaced=Ae),Xe=Te,vt?[3,12]:[4,(pt=(Ye=this._localCache)===null||Ye===void 0?void 0:Ye.getInstance())===null||pt===void 0?void 0:pt.storeMessage(Te,C.r.SUCCESS)];case 11:Jt.sent(),(dt=this.eventHandler)===null||dt===void 0||dt.dispatch("onVideoMessage",Te),Jt.label=12;case 12:return[3,28];case 13:return!(le={id:Xt,type:Ir,contentsType:P[yt.type],from:St,to:Wt,addr:yt.address,buildingName:yt.buildingName,lat:yt.latitude,lng:yt.longitude,ext:He,time:Zt,msgConfig:er.msgConfig,onlineState:Kt}).delay&&delete le.delay,!le.msgConfig&&delete er.msgConfig,le.error=X,le.errorText=Me,le.errorCode=et,!vt&&this.onLocationMessage&&this.onLocationMessage(le),pe={id:Xt,type:"loc",chatType:At,from:St,to:Wt,buildingName:yt.buildingName,addr:yt.address,lat:yt.latitude,lng:yt.longitude,ext:He,time:Number(Zt),onlineState:Kt},le.msgConfig&&(pe.msgConfig=le.msgConfig),Qe.length>0&&(pe.reactions=Qe),Nt&&(pe.chatThread=Nt),yr&&(pe.chatThreadOverview=yr),At==="chatRoom"&&(pe.priority=zt,pe.broadcast=mr),Ae&&(pe.isContentReplaced=Ae),Xe=pe,vt?[3,15]:[4,(we=(Ie=this._localCache)===null||Ie===void 0?void 0:Ie.getInstance())===null||we===void 0?void 0:we.storeMessage(pe,C.r.SUCCESS)];case 14:Jt.sent(),(ft=this.eventHandler)===null||ft===void 0||ft.dispatch("onLocationMessage",pe),Jt.label=15;case 15:return[3,28];case 16:return w=this.useOwnUploadFun?yt.remotePath:Z.call(this,yt),!(le={id:Xt,type:Ir,contentsType:P[yt.type],from:St,to:Wt,url:w,secret:yt.secretKey,filename:yt.displayName,file_length:yt.fileLength||"",accessToken:this.token||"",ext:He,length:yt.duration,time:Zt,msgConfig:er.msgConfig,onlineState:Kt}).delay&&delete le.delay,!le.msgConfig&&delete er.msgConfig,le.error=X,le.errorText=Me,le.errorCode=et,!vt&&this.onAudioMessage&&this.onAudioMessage(le),Ue={id:Xt,type:"audio",chatType:At,from:St,to:Wt,url:w,secret:yt.secretKey,file:{},filename:yt.displayName,length:yt.duration||0,file_length:yt.fileLength||0,filetype:yt.filetype||"",accessToken:this.token||"",ext:He,time:Number(Zt),onlineState:Kt},le.msgConfig&&(Ue.msgConfig=le.msgConfig),Qe.length>0&&(Ue.reactions=Qe),Nt&&(Ue.chatThread=Nt),yr&&(Ue.chatThreadOverview=yr),At==="chatRoom"&&(Ue.priority=zt,Ue.broadcast=mr),Ae&&(Ue.isContentReplaced=Ae),Xe=Ue,vt?[3,18]:[4,(it=(qe=this._localCache)===null||qe===void 0?void 0:qe.getInstance())===null||it===void 0?void 0:it.storeMessage(Ue,C.r.SUCCESS)];case 17:Jt.sent(),(Tt=this.eventHandler)===null||Tt===void 0||Tt.dispatch("onAudioMessage",Ue),Jt.label=18;case 18:return[3,28];case 19:return w=this.useOwnUploadFun?yt.remotePath:Z.call(this,yt),!(le={id:Xt,type:Ir,contentsType:P[yt.type],from:St,to:Wt,url:w,secret:yt.secretKey,filename:yt.displayName,file_length:yt.fileLength,accessToken:this.token||"",ext:He,time:Zt,msgConfig:er.msgConfig,onlineState:Kt}).delay&&delete le.delay,!le.msgConfig&&delete er.msgConfig,le.error=X,le.errorText=Me,le.errorCode=et,!vt&&this.onFileMessage&&this.onFileMessage(le),xe={id:Xt,type:"file",chatType:At,from:St,to:Wt,url:w,secret:yt.secretKey,file:{},filename:yt.displayName,length:yt.duration||0,file_length:yt.fileLength||0,filetype:yt.filetype||"",accessToken:this.token||"",ext:He,time:Number(Zt),onlineState:Kt},le.msgConfig&&(xe.msgConfig=le.msgConfig),Qe.length>0&&(xe.reactions=Qe),Nt&&(xe.chatThread=Nt),yr&&(xe.chatThreadOverview=yr),At==="chatRoom"&&(xe.priority=zt,xe.broadcast=mr),Ae&&(xe.isContentReplaced=Ae),Xe=xe,vt?[3,21]:[4,(bt=(Pt=this._localCache)===null||Pt===void 0?void 0:Pt.getInstance())===null||bt===void 0?void 0:bt.storeMessage(xe,C.r.SUCCESS)];case 20:Jt.sent(),(jt=this.eventHandler)===null||jt===void 0||jt.dispatch("onFileMessage",xe),Jt.label=21;case 21:return[3,28];case 22:return!(le={id:Xt,type:Ir,contentsType:P[yt.type],from:St,to:Wt,action:yt.action,ext:He,time:Zt,msgConfig:er.msgConfig,onlineState:Kt}).msgConfig&&delete er.msgConfig,le.error=X,le.errorText=Me,le.errorCode=et,!vt&&this.onCmdMessage&&this.onCmdMessage(le),Fe={id:Xt,type:"cmd",chatType:At,from:St,to:Wt,action:yt.action,ext:He,time:Number(Zt),onlineState:Kt},le.msgConfig&&(Fe.msgConfig=le.msgConfig),Qe.length>0&&(Fe.reactions=Qe),Nt&&(Fe.chatThread=Nt),yr&&(Fe.chatThreadOverview=yr),At==="chatRoom"&&(Fe.priority=zt,Fe.broadcast=mr),Ae&&(Fe.isContentReplaced=Ae),Xe=Fe,vt||(Lt=this.eventHandler)===null||Lt===void 0||Lt.dispatch("onCmdMessage",Fe),[3,28];case 23:return Je={},ct={},er.contents[0].customExts&&(Je=z(er.contents[0].customExts)),er.contents[0].params&&(ct=z(er.contents[0].params)),le={id:Xt,type:Ir,contentsType:P[yt.type],from:St,to:Wt,customEvent:yt.customEvent,params:ct,customExts:Je,ext:He,time:Zt,onlineState:Kt},!vt&&this.onCustomMessage&&this.onCustomMessage(le),kt={id:Xt,type:"custom",chatType:At,from:St,to:Wt,customEvent:yt.customEvent,params:ct,customExts:Je,ext:He,time:Number(Zt),onlineState:Kt},le.msgConfig&&(kt.msgConfig=le.msgConfig),Qe.length>0&&(kt.reactions=Qe),Nt&&(kt.chatThread=Nt),yr&&(kt.chatThreadOverview=yr),rt.operationCount>0&&(kt.modifiedInfo=rt,er.type===S.gA.EDIT&&(kt.from=Ct,kt.time=xt)),At==="chatRoom"&&(kt.priority=zt,kt.broadcast=mr),Ae&&(kt.isContentReplaced=Ae),Xe=kt,vt?[3,25]:[4,(pr=(Gt=this._localCache)===null||Gt===void 0?void 0:Gt.getInstance())===null||pr===void 0?void 0:pr.storeMessage(kt,C.r.SUCCESS)];case 24:Jt.sent(),(ir=this.eventHandler)===null||ir===void 0||ir.dispatch("onCustomMessage",kt),Jt.label=25;case 25:return[3,28];case 26:return w=Z.call(this,yt),mt={id:Xt,type:"combine",chatType:At,to:Wt,from:St,ext:He,time:Number(Zt),onlineState:Kt,title:yt.title||"",summary:yt.summary||"",url:w||"",secret:yt.secretKey||"",file_length:yt.fileLength||0,filename:yt.displayName||"",compatibleText:yt.text,combineLevel:yt.combineLevel||0},le.msgConfig&&(mt.msgConfig=le.msgConfig),Qe.length>0&&(mt.reactions=Qe),Nt&&(mt.chatThread=Nt),yr&&(mt.chatThreadOverview=yr),At==="chatRoom"&&(mt.priority=zt,mt.broadcast=mr),Ae&&(mt.isContentReplaced=Ae),Xe=mt,!vt&&this.eventHandler&&this.eventHandler.dispatch("onCombineMessage",mt),[3,28];case 27:return E.kg.error("Unknow message type, message:",yt),[3,28];case 28:return vr?[2,Xe]:[2,le]}})})}function oe(W,ne,ee){if(this.delivery&&W!==ne){var H=this.getUniqueId(),q=new N.Message("delivery",H);q.set({ackId:ee,to:W}),E.kg.debug("send delivery ack"),this.send(q.body)}}j.Z=function(W,ne,ee,H,q){var ve,Le,Oe,ge,je,Ne,Be,Ye,pt,dt,Ie,we,ft,qe,it,Tt,Pt,bt,jt,Lt,Gt,pr,ir,Ar,er,yt;return M(this,void 0,void 0,function(){var Xt,Ir,St,Wt,Zt,Kt,At,vt,zt,vr,or,mr,ae,Ae,le,Xe,X,et,Me,He,Qe,ht,rt,Ct,xt,Nt,yr,w,te,Re,re,Ee,Ge,he,$e,ye,lt,Ze,Dt,Q;return x(this,function(Te){switch(Te.label){case 0:if(Xt=new(f())(W.timestamp.low,W.timestamp.high,W.timestamp.unsigned).toString(),Ir=this.root.lookup("easemob.pb.MessageBody"),St=Ir.decode(W.payload),Wt=3,Zt=!1,Kt=new(f())(W.id.low,W.id.high,W.id.unsigned).toString(),q&&W.from&&W.from.name===this.context.userId&&W.from.clientResource===this.clientResource&&St.type===S.gA.CHATROOM)return[2,E.kg.debug("Discard your own chat room message:",Kt)];if(W.meta&&W.meta.length){if(At=v.P6.parseNotify(W.meta),vt=At.is_online,zt=At.callback_replace,this.useReplacedMessageContents&&zt&&(Zt=!0),vt||vt===0)switch(vt){case 0:Wt=0;break;case 1:Wt=1;break;default:Wt=2}}else Wt=3;switch(vr=St.ackMessageId?new(f())(St.ackMessageId.low,St.ackMessageId.high,St.ackMessageId.unsigned).toString():"",or="",mr=I.call(this,W,St),ae=Y.call(this,W,St),E.kg.debug("meta thirdMessage:",{metaId:Kt,metaNs:W.ns,type:St.type,from:mr,to:ae,contentType:(Le=(ve=St.contents)===null||ve===void 0?void 0:ve[0])===null||Le===void 0?void 0:Le.type,contentLen:(Oe=St.contents)===null||Oe===void 0?void 0:Oe.length}),St.type){case S.gA.SINGLECHAT:return[3,1];case S.gA.GROUPCHAT:return[3,2];case S.gA.CHATROOM:return[3,3];case S.gA.READ_ACK:return[3,4];case S.gA.DELIVER_ACK:return[3,5];case S.gA.RECALL:return[3,6];case S.gA.CHANNEL_ACK:return[3,15];case S.gA.EDIT:return[3,16]}return[3,20];case 1:return or="chat",this.grantType==="agoraToken"&&(or="singleChat"),this.delivery&&!ee&&mr!==this.context.userId&&oe.call(this,mr,ae,Kt),[3,21];case 2:return or="groupchat",this.grantType==="agoraToken"&&(or="groupChat"),[3,21];case 3:return or="chatroom",this.grantType==="agoraToken"&&(or="chatRoom"),Wt=1,[3,21];case 4:return or="read_ack",Ae=void 0,St.ext[0]&&JSON.parse(St.ext[0].stringValue)?(Ae={id:Kt,type:"read",from:mr,to:ae,mid:vr,groupReadCount:St.ext[0]&&JSON.parse(St.ext[0].stringValue),ackContent:St.ackContent,onlineState:Wt},this.onReadMessage&&this.onReadMessage(Ae),(ge=this.eventHandler)===null||ge===void 0||ge.dispatch("onReadMessage",Ae),[2]):(Ae={id:Kt,type:"read",from:mr,to:ae,mid:vr,onlineState:Wt},this.onReadMessage&&this.onReadMessage(Ae),(je=this.eventHandler)===null||je===void 0||je.dispatch("onReadMessage",Ae),[2]);case 5:return or="deliver_ack",this.onDeliveredMessage&&this.onDeliveredMessage({id:Kt,type:"delivery",from:mr,to:ae,mid:vr,onlineState:Wt}),le={id:Kt,type:"delivery",from:mr,to:ae,mid:vr,onlineState:Wt},(Ne=this.eventHandler)===null||Ne===void 0||Ne.dispatch("onDeliveredMessage",le),[2];case 6:return or="recall",Xe="",W.ext&&(Xe=((Be=z(W.ext))===null||Be===void 0?void 0:Be.recallMessageExtensionInfo)||""),X={id:Kt,from:mr||"admin",to:ae,mid:vr,ext:Xe,onlineState:Wt},et=ae===this.user?mr:ae,[4,(pt=(Ye=this._localCache)===null||Ye===void 0?void 0:Ye.getInstance())===null||pt===void 0?void 0:pt.getMessageByServerMsgId(X.mid)];case 7:return(Me=Te.sent())?[4,(Ie=(dt=this._localCache)===null||dt===void 0?void 0:dt.getInstance())===null||Ie===void 0?void 0:Ie.removeMsgByServerMsgId(X.mid)]:[3,9];case 8:Te.sent(),Te.label=9;case 9:return Me?.chatType!=="singleChat"&&Me?.chatType!=="groupChat"?[3,14]:(He=Me?.from===this.user||Me?.from==="",[4,(ft=(we=this._localCache)===null||we===void 0?void 0:we.getInstance())===null||ft===void 0?void 0:ft.getConversationLastMessage(et,Me.chatType)]);case 10:return Qe=Te.sent(),[4,(it=(qe=this._localCache)===null||qe===void 0?void 0:qe.getInstance())===null||it===void 0?void 0:it.getConversationBySessionId((0,y.MQ)({conversationId:et,conversationType:Me.chatType}))];case 11:return(ht=Te.sent())?[4,(Pt=(Tt=this._localCache)===null||Tt===void 0?void 0:Tt.getInstance())===null||Pt===void 0?void 0:Pt.updateLocalConversation((0,y.MQ)({conversationId:et,conversationType:Me.chatType}),{lastMessageId:Qe?.serverMsgId,unReadCount:(0,y.E7)({conversation:ht,isRecallSelfMsg:He,recalledMsgTime:Me.time})})]:[3,13];case 12:Te.sent(),Te.label=13;case 13:Te.label=14;case 14:return this.onRecallMessage&&this.onRecallMessage(X),(bt=this.eventHandler)===null||bt===void 0||bt.dispatch("onRecallMessage",X),[2];case 15:return this.onChannelMessage&&this.onChannelMessage({id:Kt,type:"channel",chatType:"singleChat",from:mr,to:ae,time:Number(Xt),onlineState:Wt}),rt={id:Kt,type:"channel",chatType:"singleChat",from:mr,to:ae,time:Number(Xt),onlineState:Wt},(jt=this.eventHandler)===null||jt===void 0||jt.dispatch("onChannelMessage",rt),[2];case 16:return Ct={errorCode:0,reason:""},[4,F.call(this,{status:Ct,thirdMessage:St,msgBody:St.contents[0],msgId:Kt,type:or,from:mr,to:ae,time:Xt,onlineState:Wt,ignoreCallback:!0,format:!0,isContentReplaced:Zt})];case 17:return xt=Te.sent(),Nt=!!W.to&&W.to.domain.indexOf("conference")!==-1,xt.chatType=Nt?"groupChat":"singleChat",yr=St.editMessageId&&new(f())(St.editMessageId.low,St.editMessageId.high,St.editMessageId.unsigned).toString(),w={},xt.type==="txt"?(te=xt.type,Re=xt.chatType,re=xt.to,Ee=xt.from,Ge=xt.time,he=xt.modifiedInfo,w={id:yr,type:te,chatType:Re,to:re,from:Ee,time:Ge,modifiedInfo:he,msg:xt.msg},xt.translations&&(w.translations=xt.translations)):xt.type==="custom"&&((w=xt).id=yr,delete w.onlineState),w?[4,(Gt=(Lt=this._localCache)===null||Lt===void 0?void 0:Lt.getInstance())===null||Gt===void 0?void 0:Gt.getMessageByServerMsgId(yr)]:[3,19];case 18:(($e=Te.sent())==null?void 0:$e.type)==="txt"&&w.type==="txt"?(ir=(pr=this._localCache)===null||pr===void 0?void 0:pr.getInstance())===null||ir===void 0||ir.putMessageToDB(U(U({},$e),{msg:w.msg,modifiedInfo:w.modifiedInfo,translations:w.translations})):$e?.type==="custom"&&w.type==="custom"&&((er=(Ar=this._localCache)===null||Ar===void 0?void 0:Ar.getInstance())===null||er===void 0||er.putMessageToDB(U(U({},$e),{modifiedInfo:w.modifiedInfo,customEvent:w.customEvent,customExts:w.customExts,ext:w.ext}))),Te.label=19;case 19:return xt.type!=="txt"&&xt.type!=="custom"||(yt=this.eventHandler)===null||yt===void 0||yt.dispatch("onModifiedMessage",w),[2];case 20:return E.kg.error("unexpected message type: ".concat(St.type)),[2];case 21:ye="normal",Ze=!1,or.toLowerCase()==="chat"||or==="singleChat"?lt="singleChat":or.toLowerCase()==="groupchat"||or==="groupChat"?lt="groupChat":(lt="chatRoom",Wt=1,W.ext&&(Dt=z(W.ext),Ze=!!Dt?.is_broadcast,ye=Dt.chatroom_msg_tag===0?"high":Dt.chatroom_msg_tag===2?"low":"normal")),Q=0,Te.label=22;case 22:return Q<St.contents.length?[4,F.call(this,{status:ne,thirdMessage:St,msgBody:St.contents[Q],msgId:Kt,type:or,from:mr,to:ae,time:Xt,onlineState:Wt,chatType:lt,ignoreCallback:ee,priority:ye,format:H,broadcast:Ze,isContentReplaced:Zt})]:[3,25];case 23:return[2,Te.sent()];case 24:return Q++,[3,22];case 25:return[2]}})})}},7288:function(O,j,c){var p;c.d(j,{r:function(){return p}}),function(f){f[f.CREATE=0]="CREATE",f[f.FAIL=1]="FAIL",f[f.INPROGRESS=2]="INPROGRESS",f[f.SUCCESS=3]="SUCCESS"}(p||(p={}))},9743:function(O,j,c){c.d(j,{E7:function(){return f},MQ:function(){return p},un:function(){return T}}),c(2222);var p=function(v){return"".concat(v.conversationType,"-").concat(v.conversationId)},f=function(v){var S=v.isRecallSelfMsg,y=v.conversation,E=v.recalledMsgTime,N=y.unReadCount,C=N===void 0?0:N,U=y.unreadCountClearTimestamp;return S||(U===void 0?0:U)>E?C:C&&C>0?C-1:0},T=function(v){var S,y=0;if(v.length===0)return y;for(S=0;S<v.length;S++)y=(y<<5)-y+v.charCodeAt(S),y|=0;return y}},7360:function(O,j,c){function p(){console.log&&(console.log.apply?console.log.apply(console,Array.prototype.slice.call(arguments)):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}c.d(j,{kg:function(){return M}}),c(1539),c(8674),c(2526),c(1817),c(2165),c(6992),c(8783),c(3948),c(7042),c(2222),c(8309),c(9600),c(2564),c(285),c(1637),c(4812),c(3710),c(9554),c(2772),c(4916);var f=typeof window<"u"&&window.navigator!==void 0&&/Trident\/|MSIE /.test(window.navigator.userAgent),T=c(4024);function v(x){return v=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(P){return typeof P}:function(P){return P&&typeof Symbol=="function"&&P.constructor===Symbol&&P!==Symbol.prototype?"symbol":typeof P},v(x)}var S,y=function(){},E={};(function(x){x[x.TRACE=0]="TRACE",x[x.DEBUG=1]="DEBUG",x[x.INFO=2]="INFO",x[x.WARN=3]="WARN",x[x.ERROR=4]="ERROR",x[x.SILENT=5]="SILENT"})(S||(S={}));var N=function(){function x(P,z,Z){this.name=P||"defaultLogger",this.currentLevel=0,this.useCookiePersist=!1,this.storageLogLevelKey="loglevel",this.levels=S,this.consoleLogVisibility=!0,this.logMethods=["trace","debug","info","warn","error"],this.methodFactory=Z||this.defaultMethodFactory,this.report=!1;var I=this._getPersistedLevel();I==null&&(I=z===null?"WARN":z),this.logs=[],this.reportLogs=[],this.reportInterval=3e5,this.timer=null,this.config={useCache:!1,maxCache:3145728,color:"",background:""},this.logBytes=0,this.setLevel(I,!1,"")}return x.prototype.reportLog=function(){var P,z,Z,I,Y,F,oe;return I=this,Y=void 0,oe=function(){var W,ne,ee,H,q,ve,Le,Oe;return function(ge,je){var Ne,Be,Ye,pt,dt={label:0,sent:function(){if(1&Ye[0])throw Ye[1];return Ye[1]},trys:[],ops:[]};return pt={next:Ie(0),throw:Ie(1),return:Ie(2)},typeof Symbol=="function"&&(pt[Symbol.iterator]=function(){return this}),pt;function Ie(we){return function(ft){return function(qe){if(Ne)throw new TypeError("Generator is already executing.");for(;dt;)try{if(Ne=1,Be&&(Ye=2&qe[0]?Be.return:qe[0]?Be.throw||((Ye=Be.return)&&Ye.call(Be),0):Be.next)&&!(Ye=Ye.call(Be,qe[1])).done)return Ye;switch(Be=0,Ye&&(qe=[2&qe[0],Ye.value]),qe[0]){case 0:case 1:Ye=qe;break;case 4:return dt.label++,{value:qe[1],done:!1};case 5:dt.label++,Be=qe[1],qe=[0];continue;case 7:qe=dt.ops.pop(),dt.trys.pop();continue;default:if(!((Ye=(Ye=dt.trys).length>0&&Ye[Ye.length-1])||qe[0]!==6&&qe[0]!==2)){dt=0;continue}if(qe[0]===3&&(!Ye||qe[1]>Ye[0]&&qe[1]<Ye[3])){dt.label=qe[1];break}if(qe[0]===6&&dt.label<Ye[1]){dt.label=Ye[1],Ye=qe;break}if(Ye&&dt.label<Ye[2]){dt.label=Ye[2],dt.ops.push(qe);break}Ye[2]&&dt.ops.pop(),dt.trys.pop();continue}qe=je.call(ge,dt)}catch(it){qe=[6,it],Be=0}finally{Ne=Ye=0}if(5&qe[0])throw qe[1];return{value:qe[0]?qe[1]:void 0,done:!0}}([we,ft])}}}(this,function(ge){switch(ge.label){case 0:if(((P=this.reportLogs)===null||P===void 0?void 0:P.length)===0)return[2];for(W=2097152,ne=this.reportLogs.join(`
`)+`
`,ee=ne.length,H=[];ee>W;)H.push(ne.substring(0,W)),ee-=W,ne=ne.substring(W);H.push(ne),q=0,ve=H,ge.label=1;case 1:if(!(q<ve.length))return[3,8];if(Le=ve[q],this.reportLogs=[],!(!((Z=(z=this.connection)===null||z===void 0?void 0:z.context)===null||Z===void 0)&&Z.accessToken))return[2];ge.label=2;case 2:return ge.trys.push([2,4,,5]),[4,this.reportData(Le)];case 3:return((Oe=ge.sent())==null?void 0:Oe.status)!=="ok"&&this.reportLogs.unshift(Le),[3,5];case 4:return ge.sent(),this.reportLogs.unshift(Le),[3,5];case 5:return[4,T.P6.delay(3e3)];case 6:ge.sent(),ge.label=7;case 7:return q++,[3,1];case 8:return[2]}})},new((F=void 0)||(F=Promise))(function(W,ne){function ee(ve){try{q(oe.next(ve))}catch(Le){ne(Le)}}function H(ve){try{q(oe.throw(ve))}catch(Le){ne(Le)}}function q(ve){var Le;ve.done?W(ve.value):(Le=ve.value,Le instanceof F?Le:new F(function(Oe){Oe(Le)})).then(ee,H)}q((oe=oe.apply(I,Y||[])).next())})},x.prototype.reportData=function(P){var z,Z=this;if(this.connection){var I=this.connection.context||{},Y=I.orgName,F=I.appName,oe=I.accessToken,W=I.userId,ne={url:"".concat((z=this.connection)===null||z===void 0?void 0:z.apiUrl,"/").concat(Y,"/").concat(F,"/sdk/users/").concat(W,"/client/logs"),type:"POST",data:JSON.stringify({resource:this.connection.clientResource,logContent:P}),dataType:"json",headers:{Authorization:"Bearer "+oe,"Content-Type":"application/json"}};return T.hj.call(this.connection,ne).then(function(ee){return Z.log("report log success",ee),ee}).catch(function(ee){Z.error("report log error",ee)})}this.error("report log error","connection is null")},x.prototype._regularlyReportLogs=function(){var P,z=this;this.timer&&clearInterval(this.timer),((P=this.reportInterval)!==null&&P!==void 0?P:0)<6e4&&(this.reportInterval=6e4),this.timer=setInterval(function(){z.reportLog()},this.reportInterval||3e5)},x.prototype._stopReportLogs=function(){this.reportLog(),clearInterval(this.timer)},x.prototype.setConfig=function(P){this.config=P},x.prototype.getLevel=function(){return this.currentLevel},x.prototype.setLevel=function(P,z,Z){if(typeof P=="string"&&(P=S[P]),P===void 0&&(P=0),!(typeof P=="number"&&P>=0&&P<=this.levels.SILENT))throw Error("log.setLevel() called with invalid level: "+P);if(this.currentLevel=P,z!==!1&&this._persistLevel(P),this.replaceLoggingMethods(P,Z||""),typeof console>"u"&&P<S.SILENT)throw Error("No console available for logging")},x.prototype.setDefaultLevel=function(P){this._getPersistedLevel()||this.setLevel(P,!1,"")},x.prototype.enableAll=function(P){this.setLevel(this.levels.TRACE,!0,"")},x.prototype.disableAll=function(P){this.setLevel(this.levels.SILENT,!0,"")},x.prototype.getLogs=function(){return this.logs},x.prototype.download=function(){if(typeof window<"u"&&typeof document<"u"){var P=this.getLogs().join(`
`),z=new Blob([P],{type:"text/plain;charset=UTF-8"}),Z=window.URL.createObjectURL(z),I=document.createElement("a");I.style.display="none",I.href=Z,I.setAttribute("download","sdklog"),document.body.appendChild(I),I.click()}},x.prototype.setConsoleLogVisibility=function(P){this.consoleLogVisibility=P},x.prototype._bindMethod=function(P,z,Z){var I=this,Y=P[z],F=this.getTime();if(Z)return this._cacheLog;if(typeof Y.bind=="function")return function(){for(var oe=[],W=0;W<arguments.length;W++)oe[W]=arguments[W];var ne=I.getTime();I.consoleLogVisibility&&Y.call.apply(Y,function(ee,H,q){if(arguments.length===2)for(var ve,Le=0,Oe=H.length;Le<Oe;Le++)!ve&&Le in H||(ve||(ve=Array.prototype.slice.call(H,0,Le)),ve[Le]=H[Le]);return ee.concat(ve||Array.prototype.slice.call(H))}([P,"".concat(ne," IM SDK [").concat(z==="log"?"debug":z,"]: ")],oe,!1)),I.onLog&&I.onLog({time:ne,level:z==="log"?"debug":z,logs:oe}),I._cacheReportLogs.apply(I,oe)};try{return Function.prototype.bind.call(Y,P,"".concat(F," IM SDK [").concat(z==="log"?"debug":z,"]: "))}catch{return function(){return Function.prototype.apply.apply(Y,[P,arguments])}}},x.prototype.getTime=function(){var P=new Date;return P.toTimeString().split(" ")[0]+":"+P.getMilliseconds()},x.prototype._cacheLog=function(){for(var P=[],z=0;z<arguments.length;z++)P[z]=arguments[z];var Z=new Date().toLocaleString()+": ",I="";P.forEach(function(Y){v(Y)==="object"?I+=JSON.stringify(Y)+" ":I+=Y+" "}),this._cacheLogCall(Z+I),this._cacheReportLogs.apply(this,P)},x.prototype._cacheLogCall=function(P){var z=P.length,Z=this.logBytes+z,I=this.config.maxCache;if(!(z>=I)){if(Z<I)this.logBytes+=z;else for(var Y=Z-I,F=0;F<Y;){var oe=this.logs.shift();oe!==void 0&&(F+=oe.length)}this.logs.push(P)}},x.prototype._cacheReportLogs=function(){for(var P=[],z=0;z<arguments.length;z++)P[z]=arguments[z];if(this.report){var Z=new Date().toLocaleString()+": ",I="";P.forEach(function(Y){v(Y)==="object"?I+=JSON.stringify(Y)+" ":I+=Y+" "}),this.reportLogs.push(Z+I)}},x.prototype._getPersistedLevel=function(){var P;if(typeof window>"u")return 5;if((P=window&&window.localStorage&&window.localStorage[this.storageLogLevelKey])==="undefined"){var z=window.document.cookie,Z=z.indexOf(encodeURIComponent(this.storageLogLevelKey));Z!==-1&&(P=/^([^;]+)/.exec(z.slice(Z))[1])}return P||5},x.prototype._persistLevel=function(P){var z=this.logMethods[P]||"SILENT";typeof window<"u"&&(window.localStorage&&(window.localStorage[this.storageLogLevelKey]=z),this.useCookiePersist&&(window.document.cookie=encodeURIComponent(this.storageLogLevelKey)+"="+z+";"))},x.prototype.replaceLoggingMethods=function(P,z){for(var Z=this,I=0;I<this.logMethods.length;I++){var Y=this.logMethods[I];this[Y]=I<P?function(){for(var F=[],oe=0;oe<arguments.length;oe++)F[oe]=arguments[oe];Z.report&&Z._cacheReportLogs.apply(Z,F)}:this.methodFactory(Y,P,z)}this.log=this.debug},x.prototype.defaultMethodFactory=function(P,z,Z){return this.realMethod(P)||this.enableLoggingWhenConsoleArrives.apply(this,[P,z,Z])},x.prototype.realMethod=function(P){return P==="debug"&&(P="log"),typeof console<"u"&&(P==="trace"&&f?p:console[P]!==void 0?this._bindMethod(console,P,this.config.useCache):console.log!==void 0?this._bindMethod(console,"log",this.config.useCache):y)},x.prototype.enableLoggingWhenConsoleArrives=function(P,z,Z){return(function(){typeof console<"u"&&(this.replaceLoggingMethods.call(this,z,Z),this[P].apply(this,arguments))}).bind(this)},x}(),C=new N;C.getLogger=function(x){if(typeof x!="string"||x==="")throw new TypeError("You must supply a name when creating a logger.");return this};var U=typeof window<"u"?window.log:void 0;C.noConflict=function(){return typeof window<"u"&&window.log===C&&(window.log=U),C},C.getLoggers=function(){return E},C.initReport=function(x){var P=x.report,z=x.reportInterval,Z=x.connection;C.report=P,C.reportInterval=z,C.connection=Z,P&&C._regularlyReportLogs()};var M=C},2449:function(O,j,c){c.d(j,{Message:function(){return z}});var p=c(4024),f=function(){function Z(I){var Y=I.id;this.id=Y,this.type=I.type}return Z.prototype.set=function(I){this.body={id:this.id,ackId:I.id,type:"read",to:I.to,from:I.from||"",chatType:I.chatType}},Z.create=function(I){return{id:p.P6.getUniqueId(),chatType:I.chatType,ackId:I.id,type:"read",to:I.to,from:I.from||"",ackContent:I.ackContent,isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly}},Z}(),T=function(){function Z(I){this.id=I.id,this.type=I.type}return Z.prototype.set=function(I){this.body={id:this.id,ackId:I.ackId,type:"delivery",to:I.to,from:I.from||""}},Z.create=function(I){return{id:p.P6.getUniqueId(),ackId:I.ackId,type:"delivery",to:I.to,from:I.from||"",isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly}},Z}(),v=(c(3843),c(3710),function(){function Z(I){var Y=I.type,F=I.id;this.id=F,this.type=Y}return Z.prototype.set=function(I){this.body={id:this.id,chatType:I.chatType||"singleChat",type:"channel",to:I.to,from:I.from||"",time:Date.now()}},Z.prototype.setChatType=function(I){return!!this.body&&(this.body.chatType=I,!0)},Z.prototype.setGroup=function(I){return!!this.body&&(this.body.group=I,!0)},Z.create=function(I){return{id:p.P6.getUniqueId(),type:"channel",chatType:I.chatType||"singleChat",to:I.to,from:I.from||"",time:Date.now(),isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly}},Z}()),S=(c(9753),function(){function Z(I){var Y=I.type,F=I.id||p.P6.getUniqueId();this.id=F,this.type=Y,this.value=""}return Z.prototype.set=function(I){this.body={id:this.id,chatType:I.chatType||"singleChat",type:"txt",to:I.to,msg:I.msg,from:I.from,roomType:I.roomType,success:I.success,fail:I.fail,ext:I.ext,time:Date.now(),isChatThread:I.isChatThread},this.value=I.msg},Z.prototype.setChatType=function(I){return!!this.body&&(this.body.chatType=I,!0)},Z.prototype.setGroup=function(I){return!!this.body&&(this.body.group=I,!0)},Z.create=function(I){var Y,F;return!((Y=I.msgConfig)===null||Y===void 0)&&Y.languages&&Array.isArray((F=I.msgConfig)===null||F===void 0?void 0:F.languages),{type:"txt",id:p.P6.getUniqueId(),msg:I.msg,to:I.to,from:I.from||"",chatType:I.chatType,ext:I.ext,time:Date.now(),msgConfig:I.msgConfig,isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly,receiverList:I.receiverList}},Z}()),y=function(){function Z(I){var Y=I.type,F=I.id;this.id=F||p.P6.getUniqueId(),this.type=Y}return Z.prototype.set=function(I){this.body={id:this.id,chatType:I.chatType||"singleChat",type:"cmd",to:I.to,action:I.action,from:I.from,roomType:I.roomType,success:I.success,fail:I.fail,ext:I.ext,time:Date.now()}},Z.prototype.setChatType=function(I){return!!this.body&&(this.body.chatType=I,!0)},Z.prototype.setGroup=function(I){return!!this.body&&(this.body.group=I,!0)},Z.create=function(I){return{id:p.P6.getUniqueId(),type:"cmd",to:I.to,from:I.from||"",chatType:I.chatType||"singleChat",action:I.action,time:Date.now(),ext:I.ext,msgConfig:I.msgConfig,isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly,receiverList:I.receiverList}},Z}(),E=function(){function Z(I){var Y=I.type,F=I.id||p.P6.getUniqueId();this.id=F,this.type=Y}return Z.prototype.set=function(I){this.body={id:this.id,chatType:I.chatType||"singleChat",type:"custom",to:I.to,customEvent:I.customEvent,customExts:I.customExts,from:I.from,roomType:I.roomType,success:I.success,fail:I.fail,ext:I.ext,time:Date.now()}},Z.prototype.setChatType=function(I){return!!this.body&&(this.body.chatType=I,!0)},Z.prototype.setGroup=function(I){return!!this.body&&(this.body.group=I,!0)},Z.create=function(I){return{id:p.P6.getUniqueId(),chatType:I.chatType||"singleChat",type:"custom",to:I.to,customEvent:I.customEvent,customExts:I.customExts,from:I.from||"",ext:I.ext,time:Date.now(),msgConfig:I.msgConfig,isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly,receiverList:I.receiverList}},Z}(),N=function(){function Z(I){var Y=I.type,F=I.id;this.id=F||p.P6.getUniqueId(),this.type=Y}return Z.prototype.set=function(I){this.body={id:this.id,chatType:I.chatType||"singleChat",type:"loc",to:I.to,addr:I.addr,buildingName:I.buildingName,lat:I.lat,lng:I.lng,from:I.from,roomType:I.roomType,success:I.success,fail:I.fail,ext:I.ext,time:Date.now()}},Z.prototype.setChatType=function(I){return!!this.body&&(this.body.chatType=I,!0)},Z.prototype.setGroup=function(I){return!!this.body&&(this.body.group=I,!0)},Z.create=function(I){return{id:p.P6.getUniqueId(),chatType:I.chatType||"singleChat",type:"loc",to:I.to,addr:I.addr,buildingName:I.buildingName,lat:I.lat,lng:I.lng,from:I.from||"",ext:I.ext,time:Date.now(),msgConfig:I.msgConfig,isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly,receiverList:I.receiverList}},Z}(),C=function(){function Z(I){var Y=I.type,F=I.id||p.P6.getUniqueId();this.id=F,this.type=Y}return Z.prototype.set=function(I){I.file=I.file||I.fileInputId&&p.P6.getFileUrl(I.fileInputId),this.body={id:this.id,chatType:I.chatType||"singleChat",type:"img",file:I.file,width:I.width,height:I.height,to:I.to,from:I.from||"",roomType:I.roomType,success:I.success,fail:I.fail,ext:I.ext,time:Date.now(),onFileUploadError:I.onFileUploadError,onFileUploadComplete:I.onFileUploadComplete,onFileUploadProgress:I.onFileUploadProgress,body:I.body,isChatThread:I.isChatThread}},Z.prototype.setChatType=function(I){return!!this.body&&(this.body.chatType=I,!0)},Z.prototype.setGroup=function(I){return!!this.body&&(this.body.group=I,!0)},Z.create=function(I){return{id:p.P6.getUniqueId(),chatType:I.chatType,type:"img",url:I.url,width:I.width,height:I.height,file:I.file,to:I.to,from:I.from||"",ext:I.ext,time:Date.now(),msgConfig:I.msgConfig,file_length:I.file_length,onFileUploadError:I.onFileUploadError,onFileUploadComplete:I.onFileUploadComplete,onFileUploadProgress:I.onFileUploadProgress,isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly,receiverList:I.receiverList,thumbnailWidth:I.thumbnailWidth,thumbnailHeight:I.thumbnailHeight}},Z}(),U=function(){function Z(I){var Y=I.type,F=I.id||p.P6.getUniqueId();this.id=F,this.type=Y}return Z.prototype.set=function(I){I.file=I.file||I.fileInputId&&p.P6.getFileUrl(I.fileInputId),this.body={id:this.id,chatType:I.chatType||"singleChat",type:"audio",file:I.file,filename:I.filename,length:I.length,file_length:I.file_length,fileInputId:I.fileInputId,to:I.to,from:I.from,roomType:I.roomType,success:I.success,fail:I.fail,ext:I.ext,time:Date.now(),onFileUploadError:I.onFileUploadError,onFileUploadComplete:I.onFileUploadComplete,onFileUploadProgress:I.onFileUploadProgress,body:I.body,isChatThread:I.isChatThread}},Z.prototype.setChatType=function(I){return!!this.body&&(this.body.chatType=I,!0)},Z.prototype.setGroup=function(I){return!!this.body&&(this.body.group=I,!0)},Z.create=function(I){return{id:p.P6.getUniqueId(),chatType:I.chatType,type:"audio",filename:I.filename,length:I.length,file:I.file,to:I.to,from:I.from||"",ext:I.ext,time:Date.now(),onFileUploadError:I.onFileUploadError,onFileUploadComplete:I.onFileUploadComplete,onFileUploadProgress:I.onFileUploadProgress,body:I.body,file_length:I.file_length,msgConfig:I.msgConfig,isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly,receiverList:I.receiverList}},Z}(),M=function(){function Z(I){var Y=I.type,F=I.id;this.id=F,this.type=Y}return Z.prototype.set=function(I){I.file=I.file||I.fileInputId&&p.P6.getFileUrl(I.fileInputId),this.body={id:this.id,chatType:I.chatType||"singleChat",type:"video",file:I.file,filename:I.filename,length:I.length,file_length:I.file_length,fileInputId:I.fileInputId,to:I.to,from:I.from,roomType:I.roomType,success:I.success,fail:I.fail,ext:I.ext,time:Date.now(),apiUrl:I.apiUrl,onFileUploadError:I.onFileUploadError,onFileUploadComplete:I.onFileUploadComplete,onFileUploadProgress:I.onFileUploadProgress,body:I.body,isChatThread:I.isChatThread}},Z.prototype.setChatType=function(I){return!!this.body&&(this.body.chatType=I,!0)},Z.prototype.setGroup=function(I){return!!this.body&&(this.body.group=I,!0)},Z.create=function(I){return{id:p.P6.getUniqueId(),chatType:I.chatType||"singleChat",type:"video",file:I.file,filename:I.filename,length:I.length,file_length:I.file_length,fileInputId:I.fileInputId,to:I.to,from:I.from||"",ext:I.ext,time:Date.now(),onFileUploadError:I.onFileUploadError,onFileUploadComplete:I.onFileUploadComplete,onFileUploadProgress:I.onFileUploadProgress,body:I.body,msgConfig:I.msgConfig,isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly,receiverList:I.receiverList}},Z}(),x=function(){function Z(I){var Y=I.type,F=I.id;this.id=F,this.type=Y}return Z.prototype.set=function(I){I.file=I.file||I.fileInputId&&p.P6.getFileUrl(I.fileInputId),this.body={id:this.id,chatType:I.chatType||"singleChat",type:"file",file:I.file,filename:I.filename,fileInputId:I.fileInputId,to:I.to,from:I.from,roomType:I.roomType,success:I.success,fail:I.fail,ext:I.ext,time:Date.now(),onFileUploadError:I.onFileUploadError,onFileUploadComplete:I.onFileUploadComplete,onFileUploadProgress:I.onFileUploadProgress,body:I.body,isChatThread:I.isChatThread}},Z.prototype.setChatType=function(I){return!!this.body&&(this.body.chatType=I,!0)},Z.prototype.setGroup=function(I){return!!this.body&&(this.body.group=I,!0)},Z.create=function(I){return{id:p.P6.getUniqueId(),chatType:I.chatType||"singleChat",type:"file",file:I.file,filename:I.filename,fileInputId:I.fileInputId,file_length:I.file_length,to:I.to,from:I.from||"",ext:I.ext,onFileUploadError:I.onFileUploadError,onFileUploadComplete:I.onFileUploadComplete,onFileUploadProgress:I.onFileUploadProgress,body:I.body,time:Date.now(),msgConfig:I.msgConfig,isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly,receiverList:I.receiverList}},Z}(),P=function(){function Z(I){var Y=I.type,F=I.id||p.P6.getUniqueId();this.id=F,this.type=Y,this.value=""}return Z.create=function(I){return{type:"combine",id:p.P6.getUniqueId(),to:I.to,from:I.from||"",chatType:I.chatType,ext:I.ext,time:Date.now(),msgConfig:I.msgConfig,isChatThread:I.isChatThread,priority:I.priority,deliverOnlineOnly:I.deliverOnlineOnly,receiverList:I.receiverList,compatibleText:I.compatibleText,title:I.title,summary:I.summary,messageList:I.messageList,onFileUploadError:I.onFileUploadError,onFileUploadComplete:I.onFileUploadComplete}},Z}(),z=function(){function Z(I,Y){return this.type=I,this.id=Y||p.P6.getUniqueId(),Z.createOldMsg({type:I,id:this.id})}return Z.createOldMsg=function(I){switch(I.type){case"read":return new f({type:"read",id:I.id});case"delivery":return new T({type:"delivery",id:I.id});case"channel":return new v({type:"channel",id:I.id});case"txt":return new S({type:"txt",id:I.id});case"cmd":return new y({type:"cmd",id:I.id});case"custom":return new E({type:"custom",id:I.id});case"loc":return new N({type:"loc",id:I.id});case"img":return new C({type:"img",id:I.id});case"audio":return new U({type:"audio",id:I.id});case"video":return new M({type:"video",id:I.id});case"file":return new x({type:"file",id:I.id})}},Z.create=function(I){return(Y=I).type!=="txt"||"version"in Y?function(F){return F.type==="img"&&!("version"in F)}(I)?C.create(I):function(F){return F.type==="cmd"&&!("version"in F)}(I)?y.create(I):function(F){return F.type==="file"&&!("version"in F)}(I)?x.create(I):function(F){return F.type==="audio"&&!("version"in F)}(I)?U.create(I):function(F){return F.type==="video"&&!("version"in F)}(I)?M.create(I):function(F){return F.type==="custom"&&!("version"in F)}(I)?E.create(I):function(F){return F.type==="loc"&&!("version"in F)}(I)?N.create(I):function(F){return F.type==="channel"&&!("version"in F)}(I)?v.create(I):function(F){return F.type==="delivery"&&!("version"in F)}(I)?T.create(I):function(F){return F.type==="read"&&!("version"in F)}(I)?f.create(I):function(F){return F.type==="combine"&&!("version"in F)}(I)?P.create(I):{}:S.create(I);var Y},Z.prototype.set=function(I){},Z.getFileUrl=p.P6.getFileUrl,Z}()},5531:function(O,j,c){var p;c.d(j,{E:function(){return p}}),function(f){f[f.REQUEST_SUCCESS=0]="REQUEST_SUCCESS",f[f.REQUEST_TIMEOUT=-1]="REQUEST_TIMEOUT",f[f.REQUEST_UNKNOWN=-2]="REQUEST_UNKNOWN",f[f.REQUEST_PARAMETER_ERROR=-3]="REQUEST_PARAMETER_ERROR",f[f.REQUEST_ABORT=-4]="REQUEST_ABORT",f[f.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR=0]="WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR",f[f.WEBIM_CONNCTION_OPEN_ERROR=1]="WEBIM_CONNCTION_OPEN_ERROR",f[f.WEBIM_CONNCTION_AUTH_ERROR=2]="WEBIM_CONNCTION_AUTH_ERROR",f[f.WEBIM_CONNCTION_OPEN_USERGRID_ERROR=3]="WEBIM_CONNCTION_OPEN_USERGRID_ERROR",f[f.WEBIM_CONNCTION_ATTACH_ERROR=4]="WEBIM_CONNCTION_ATTACH_ERROR",f[f.WEBIM_CONNCTION_ATTACH_USERGRID_ERROR=5]="WEBIM_CONNCTION_ATTACH_USERGRID_ERROR",f[f.WEBIM_CONNCTION_REOPEN_ERROR=6]="WEBIM_CONNCTION_REOPEN_ERROR",f[f.WEBIM_CONNCTION_SERVER_CLOSE_ERROR=7]="WEBIM_CONNCTION_SERVER_CLOSE_ERROR",f[f.WEBIM_CONNCTION_SERVER_ERROR=8]="WEBIM_CONNCTION_SERVER_ERROR",f[f.WEBIM_CONNCTION_IQ_ERROR=9]="WEBIM_CONNCTION_IQ_ERROR",f[f.WEBIM_CONNCTION_PING_ERROR=10]="WEBIM_CONNCTION_PING_ERROR",f[f.WEBIM_CONNCTION_NOTIFYVERSION_ERROR=11]="WEBIM_CONNCTION_NOTIFYVERSION_ERROR",f[f.WEBIM_CONNCTION_GETROSTER_ERROR=12]="WEBIM_CONNCTION_GETROSTER_ERROR",f[f.WEBIM_CONNCTION_CROSSDOMAIN_ERROR=13]="WEBIM_CONNCTION_CROSSDOMAIN_ERROR",f[f.WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES=14]="WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES",f[f.WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR=15]="WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR",f[f.WEBIM_CONNCTION_DISCONNECTED=16]="WEBIM_CONNCTION_DISCONNECTED",f[f.WEBIM_CONNCTION_AJAX_ERROR=17]="WEBIM_CONNCTION_AJAX_ERROR",f[f.WEBIM_CONNCTION_JOINROOM_ERROR=18]="WEBIM_CONNCTION_JOINROOM_ERROR",f[f.WEBIM_CONNCTION_GETROOM_ERROR=19]="WEBIM_CONNCTION_GETROOM_ERROR",f[f.WEBIM_CONNCTION_GETROOMINFO_ERROR=20]="WEBIM_CONNCTION_GETROOMINFO_ERROR",f[f.WEBIM_CONNCTION_GETROOMMEMBER_ERROR=21]="WEBIM_CONNCTION_GETROOMMEMBER_ERROR",f[f.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR=22]="WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR",f[f.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR=23]="WEBIM_CONNCTION_LOAD_CHATROOM_ERROR",f[f.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR=24]="WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR",f[f.WEBIM_CONNCTION_JOINCHATROOM_ERROR=25]="WEBIM_CONNCTION_JOINCHATROOM_ERROR",f[f.WEBIM_CONNCTION_QUITCHATROOM_ERROR=26]="WEBIM_CONNCTION_QUITCHATROOM_ERROR",f[f.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR=27]="WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR",f[f.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR=28]="WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR",f[f.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR=29]="WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR",f[f.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR=30]="WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR",f[f.WEBIM_CONNCTION_CALLBACK_INNER_ERROR=31]="WEBIM_CONNCTION_CALLBACK_INNER_ERROR",f[f.WEBIM_CONNCTION_CLIENT_OFFLINE=32]="WEBIM_CONNCTION_CLIENT_OFFLINE",f[f.WEBIM_CONNCTION_CLIENT_LOGOUT=33]="WEBIM_CONNCTION_CLIENT_LOGOUT",f[f.WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR=34]="WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR",f[f.WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP=35]="WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP",f[f.WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP=36]="WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP",f[f.WEBIM_CONNECTION_ACCEPT_JOIN_GROUP=37]="WEBIM_CONNECTION_ACCEPT_JOIN_GROUP",f[f.WEBIM_CONNECTION_DECLINE_JOIN_GROUP=38]="WEBIM_CONNECTION_DECLINE_JOIN_GROUP",f[f.WEBIM_CONNECTION_CLOSED=39]="WEBIM_CONNECTION_CLOSED",f[f.WEBIM_CONNECTION_ERROR=40]="WEBIM_CONNECTION_ERROR",f[f.MAX_LIMIT=50]="MAX_LIMIT",f[f.MESSAGE_NOT_FOUND=51]="MESSAGE_NOT_FOUND",f[f.NO_PERMISSION=52]="NO_PERMISSION",f[f.OPERATION_UNSUPPORTED=53]="OPERATION_UNSUPPORTED",f[f.OPERATION_NOT_ALLOWED=54]="OPERATION_NOT_ALLOWED",f[f.WEBIM_TOKEN_EXPIRED=56]="WEBIM_TOKEN_EXPIRED",f[f.WEBIM_SERVER_SERVING_DISABLED=57]="WEBIM_SERVER_SERVING_DISABLED",f[f.WEBIM_UPLOADFILE_BROWSER_ERROR=100]="WEBIM_UPLOADFILE_BROWSER_ERROR",f[f.WEBIM_UPLOADFILE_ERROR=101]="WEBIM_UPLOADFILE_ERROR",f[f.WEBIM_UPLOADFILE_NO_LOGIN=102]="WEBIM_UPLOADFILE_NO_LOGIN",f[f.WEBIM_UPLOADFILE_NO_FILE=103]="WEBIM_UPLOADFILE_NO_FILE",f[f.WEBIM_DOWNLOADFILE_ERROR=200]="WEBIM_DOWNLOADFILE_ERROR",f[f.WEBIM_DOWNLOADFILE_NO_LOGIN=201]="WEBIM_DOWNLOADFILE_NO_LOGIN",f[f.WEBIM_DOWNLOADFILE_BROWSER_ERROR=202]="WEBIM_DOWNLOADFILE_BROWSER_ERROR",f[f.PARSE_FILE_ERROR=203]="PARSE_FILE_ERROR",f[f.USER_NOT_FOUND=204]="USER_NOT_FOUND",f[f.MESSAGE_PARAMETER_ERROR=205]="MESSAGE_PARAMETER_ERROR",f[f.WEBIM_CONNCTION_USER_LOGIN_ANOTHER_DEVICE=206]="WEBIM_CONNCTION_USER_LOGIN_ANOTHER_DEVICE",f[f.WEBIM_CONNCTION_USER_REMOVED=207]="WEBIM_CONNCTION_USER_REMOVED",f[f.WEBIM_CONNCTION_USER_KICKED_BY_CHANGE_PASSWORD=216]="WEBIM_CONNCTION_USER_KICKED_BY_CHANGE_PASSWORD",f[f.WEBIM_CONNCTION_USER_KICKED_BY_OTHER_DEVICE=217]="WEBIM_CONNCTION_USER_KICKED_BY_OTHER_DEVICE",f[f.USER_MUTED_BY_ADMIN=219]="USER_MUTED_BY_ADMIN",f[f.USER_NOT_FRIEND=221]="USER_NOT_FRIEND",f[f.WEBIM_MESSAGE_REC_TEXT=300]="WEBIM_MESSAGE_REC_TEXT",f[f.WEBIM_MESSAGE_REC_TEXT_ERROR=301]="WEBIM_MESSAGE_REC_TEXT_ERROR",f[f.WEBIM_MESSAGE_REC_EMOTION=302]="WEBIM_MESSAGE_REC_EMOTION",f[f.WEBIM_MESSAGE_REC_PHOTO=303]="WEBIM_MESSAGE_REC_PHOTO",f[f.SERVER_GET_DNSLIST_FAILED=304]="SERVER_GET_DNSLIST_FAILED",f[f.WEBIM_MESSAGE_REC_AUDIO_FILE=305]="WEBIM_MESSAGE_REC_AUDIO_FILE",f[f.WEBIM_MESSAGE_REC_VEDIO=306]="WEBIM_MESSAGE_REC_VEDIO",f[f.WEBIM_MESSAGE_REC_VEDIO_FILE=307]="WEBIM_MESSAGE_REC_VEDIO_FILE",f[f.WEBIM_MESSAGE_REC_FILE=308]="WEBIM_MESSAGE_REC_FILE",f[f.WEBIM_MESSAGE_SED_TEXT=309]="WEBIM_MESSAGE_SED_TEXT",f[f.WEBIM_MESSAGE_SED_EMOTION=310]="WEBIM_MESSAGE_SED_EMOTION",f[f.WEBIM_MESSAGE_SED_PHOTO=311]="WEBIM_MESSAGE_SED_PHOTO",f[f.WEBIM_MESSAGE_SED_AUDIO=312]="WEBIM_MESSAGE_SED_AUDIO",f[f.WEBIM_MESSAGE_SED_AUDIO_FILE=313]="WEBIM_MESSAGE_SED_AUDIO_FILE",f[f.WEBIM_MESSAGE_SED_VEDIO=314]="WEBIM_MESSAGE_SED_VEDIO",f[f.WEBIM_MESSAGE_SED_VEDIO_FILE=315]="WEBIM_MESSAGE_SED_VEDIO_FILE",f[f.WEBIM_MESSAGE_SED_FILE=316]="WEBIM_MESSAGE_SED_FILE",f[f.WEBIM_MESSAGE_SED_ERROR=317]="WEBIM_MESSAGE_SED_ERROR",f[f.STATUS_INIT=400]="STATUS_INIT",f[f.STATUS_DOLOGIN_USERGRID=401]="STATUS_DOLOGIN_USERGRID",f[f.STATUS_DOLOGIN_IM=402]="STATUS_DOLOGIN_IM",f[f.STATUS_OPENED=403]="STATUS_OPENED",f[f.STATUS_CLOSING=404]="STATUS_CLOSING",f[f.STATUS_CLOSED=405]="STATUS_CLOSED",f[f.STATUS_ERROR=406]="STATUS_ERROR",f[f.SERVER_BUSY=500]="SERVER_BUSY",f[f.MESSAGE_INCLUDE_ILLEGAL_CONTENT=501]="MESSAGE_INCLUDE_ILLEGAL_CONTENT",f[f.MESSAGE_EXTERNAL_LOGIC_BLOCKED=502]="MESSAGE_EXTERNAL_LOGIC_BLOCKED",f[f.SERVER_UNKNOWN_ERROR=503]="SERVER_UNKNOWN_ERROR",f[f.MESSAGE_RECALL_TIME_LIMIT=504]="MESSAGE_RECALL_TIME_LIMIT",f[f.SERVICE_NOT_ENABLED=505]="SERVICE_NOT_ENABLED",f[f.SERVICE_NOT_ALLOW_MESSAGING=506]="SERVICE_NOT_ALLOW_MESSAGING",f[f.SERVICE_NOT_ALLOW_MESSAGING_MUTE=507]="SERVICE_NOT_ALLOW_MESSAGING_MUTE",f[f.MESSAGE_MODERATION_BLOCKED=508]="MESSAGE_MODERATION_BLOCKED",f[f.MESSAGE_CURRENT_LIMITING=509]="MESSAGE_CURRENT_LIMITING",f[f.MESSAGE_WEBSOCKET_DISCONNECTED=510]="MESSAGE_WEBSOCKET_DISCONNECTED",f[f.MESSAGE_SIZE_LIMIT=511]="MESSAGE_SIZE_LIMIT",f[f.GROUP_NOT_EXIST=605]="GROUP_NOT_EXIST",f[f.GROUP_NOT_JOINED=602]="GROUP_NOT_JOINED",f[f.GROUP_MEMBERS_FULL=606]="GROUP_MEMBERS_FULL",f[f.PERMISSION_DENIED=603]="PERMISSION_DENIED",f[f.WEBIM_LOAD_MSG_ERROR=604]="WEBIM_LOAD_MSG_ERROR",f[f.GROUP_ALREADY_JOINED=601]="GROUP_ALREADY_JOINED",f[f.GROUP_MEMBERS_LIMIT=607]="GROUP_MEMBERS_LIMIT",f[f.GROUP_IS_DISABLED=608]="GROUP_IS_DISABLED",f[f.GROUP_MEMBER_ATTRIBUTES_SET_FAILED=609]="GROUP_MEMBER_ATTRIBUTES_SET_FAILED",f[f.REST_PARAMS_STATUS=700]="REST_PARAMS_STATUS",f[f.CHATROOM_NOT_JOINED=702]="CHATROOM_NOT_JOINED",f[f.CHATROOM_MEMBERS_FULL=704]="CHATROOM_MEMBERS_FULL",f[f.CHATROOM_NOT_EXIST=705]="CHATROOM_NOT_EXIST",f[f.LOCAL_DB_OPERATION_FAILED=800]="LOCAL_DB_OPERATION_FAILED",f[f.SDK_RUNTIME_ERROR=999]="SDK_RUNTIME_ERROR",f[f.PRESENCE_PARAM_EXCEED=1100]="PRESENCE_PARAM_EXCEED",f[f.REACTION_ALREADY_ADDED=1101]="REACTION_ALREADY_ADDED",f[f.REACTION_CREATING=1102]="REACTION_CREATING",f[f.REACTION_OPERATION_IS_ILLEGAL=1103]="REACTION_OPERATION_IS_ILLEGAL",f[f.TRANSLATION_NOT_VALID=1200]="TRANSLATION_NOT_VALID",f[f.TRANSLATION_TEXT_TOO_LONG=1201]="TRANSLATION_TEXT_TOO_LONG",f[f.TRANSLATION_FAILED=1204]="TRANSLATION_FAILED",f[f.THREAD_NOT_EXIST=1300]="THREAD_NOT_EXIST",f[f.THREAD_ALREADY_EXIST=1301]="THREAD_ALREADY_EXIST",f[f.MODIFY_MESSAGE_NOT_EXIST=1302]="MODIFY_MESSAGE_NOT_EXIST",f[f.MODIFY_MESSAGE_FORMAT_ERROR=1303]="MODIFY_MESSAGE_FORMAT_ERROR",f[f.MODIFY_MESSAGE_FAILED=1304]="MODIFY_MESSAGE_FAILED",f[f.CONVERSATION_NOT_EXIST=1400]="CONVERSATION_NOT_EXIST"}(p||(p={}))},4998:function(O,j,c){var p;c.d(j,{a:function(){return p}}),c(7252),function(f){f[f.SYNC_INIT=0]="SYNC_INIT",f[f.SYNC_START=1]="SYNC_START",f[f.SYNC_FINISH=2]="SYNC_FINISH"}(p||(p={}))},9937:function(O,j,c){var p;c.d(j,{Z:function(){return p}}),function(f){f[f.mark_0=0]="mark_0",f[f.mark_1=1]="mark_1",f[f.mark_2=2]="mark_2",f[f.mark_3=3]="mark_3",f[f.mark_4=4]="mark_4",f[f.mark_5=5]="mark_5",f[f.mark_6=6]="mark_6",f[f.mark_7=7]="mark_7",f[f.mark_8=8]="mark_8",f[f.mark_9=9]="mark_9",f[f.mark_10=10]="mark_10",f[f.mark_11=11]="mark_11",f[f.mark_12=12]="mark_12",f[f.mark_13=13]="mark_13",f[f.mark_14=14]="mark_14",f[f.mark_15=15]="mark_15",f[f.mark_16=16]="mark_16",f[f.mark_17=17]="mark_17",f[f.mark_18=18]="mark_18",f[f.mark_19=19]="mark_19"}(p||(p={}))},4024:function(O,j,c){c.d(j,{PU:function(){return W},iw:function(){return ve},hj:function(){return ne},LR:function(){return Be},cT:function(){return Ne},P6:function(){return dt}}),c(9601),c(1539),c(8674),c(3710),c(7941),c(6699),c(7042),c(2772),c(9714),c(9653),c(6992),c(8783),c(3948),c(285),c(1637),c(8309),c(4986),c(2222),c(4916),c(2564);var p=c(5531),f=(c(2023),function(){return f=Object.assign||function(Ie){for(var we,ft=1,qe=arguments.length;ft<qe;ft++)for(var it in we=arguments[ft])Object.prototype.hasOwnProperty.call(we,it)&&(Ie[it]=we[it]);return Ie},f.apply(this,arguments)}),T=function(Ie,we,ft,qe){var it,Tt,Pt,bt,jt,Lt,Gt,pr,ir,Ar,er,yt,Xt,Ir,St,Wt,Zt,Kt,At,vt,zt,vr,or,mr,ae=Ie.response;ae&&typeof ae=="string"&&(ae=JSON.parse(ae));var Ae=Ie.status,le={elapse:qe,httpCode:Ae,errDesc:ae?.error_description};if(Ae===400){if(ae.error_code===40002)return void we({type:p.E.THREAD_ALREADY_EXIST,message:ae?.error_description,extraInfo:le});if(ae.error_code===40009)return void we({type:p.E.OPERATION_UNSUPPORTED,message:ae?.error_description,extraInfo:le});if(ae.error_code===60005)return void we({type:p.E.GROUP_MEMBER_ATTRIBUTES_SET_FAILED,message:ae?.desc||ae?.error_description,extraInfo:le});if(ae.error_code===60010)return void(ae?.error_description.includes("exceeds chatgroup user metadata single value limit")?we({type:p.E.MAX_LIMIT,message:ae?.desc||ae.error_description,extraInfo:le}):we({type:p.E.NO_PERMISSION,message:ae?.desc||ae.error_description,extraInfo:le}));if(ae.error_code===60011)return void we({type:p.E.CHATROOM_NOT_JOINED,message:ae?.desc,extraInfo:le});if(ae.error_code===14403)return void we({type:p.E.WEBIM_UPLOADFILE_ERROR,message:ae?.error_description,data:ae,extraInfo:le});if(ae.error_code===60006||ae.error_code===60007||ae.error_code===60009||ae.error_code===60012)return void we({type:p.E.MAX_LIMIT,message:ae?.desc||ae?.error_description,extraInfo:le});if(ae.error_code===91104)return void we({type:p.E.NO_PERMISSION,message:ae?.error_description,extraInfo:le});if(!((it=ae.error_description)===null||it===void 0)&&it.includes("are not members of this group"))return!((Tt=Ie.responseURL)===null||Tt===void 0)&&Tt.includes("chatgroups")?we({type:p.E.GROUP_NOT_JOINED,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):we({type:p.E.CHATROOM_NOT_JOINED,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}),void ft({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,message:ae?.error_description,data:Ie.responseText,extraInfo:le});if(ae?.result==="the app not open presence")return void we({type:p.E.SERVICE_NOT_ENABLED,message:ae?.result,extraInfo:le});if(ae?.error_description.includes("remark length must less"))return void we({type:p.E.MAX_LIMIT,message:ae?.error_description,extraInfo:le});switch(ae?.error_description){case"the user is already operation this message":we({type:p.E.REACTION_ALREADY_ADDED,message:ae?.error_description,extraInfo:le});break;case"The quantity has exceeded the limit!":we({type:p.E.MAX_LIMIT,message:ae?.error_description,extraInfo:le});break;case"The user not in this group!":we({type:p.E.GROUP_NOT_JOINED,message:ae?.error_description,extraInfo:le});break;case"the user operation is illegal!":we({type:p.E.REACTION_OPERATION_IS_ILLEGAL,message:ae?.error_description,extraInfo:le});break;case"this appKey is not open reaction service!":case"this appKey not open message roaming":we({type:p.E.SERVICE_NOT_ENABLED,message:ae?.error_description,extraInfo:le});break;case"this message is creating reaction, please try again.":we({type:p.E.REACTION_CREATING,message:ae?.error_description,extraInfo:le});break;case"groupId can not be null!":we({type:p.E.GROUP_NOT_EXIST,message:ae?.error_description,extraInfo:le});break;case"The input text is too long.":we({type:p.E.TRANSLATION_TEXT_TOO_LONG,message:ae?.error_description,extraInfo:le});break;case"The target language is not valid.":we({type:p.E.TRANSLATION_NOT_VALID,message:ae?.error_description,extraInfo:le});break;case"report failed, get message by id failed":we({type:p.E.MESSAGE_NOT_FOUND,message:ae?.error_description,extraInfo:le});break;case"ext is too big ":we({type:p.E.PRESENCE_PARAM_EXCEED,message:ae?.error_description,extraInfo:le});break;case"Request body not readable.Please check content type is correct!":case"param mark must be not empty, please check!":case"param mark illegal, please check it!":case"param pin_msg_id illegal, please check it!":we({type:p.E.REQUEST_PARAMETER_ERROR,message:ae?.error_description,extraInfo:le});break;case"updateRemark | they are not friends, please add as a friend first.":we({type:p.E.USER_NOT_FRIEND,message:ae?.error_description,extraInfo:le});break;default:we({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,message:ae?.error_description,data:Ie.responseText,extraInfo:le}),ft({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,message:ae?.error_description,data:Ie.responseText,extraInfo:le})}}else if(Ae===401)ae.error_code===40001||ae.error_code===60001||ae.error_description==="Unable to authenticate (OAuth)"?we({type:p.E.NO_PERMISSION,message:ae?.error_description,extraInfo:le}):(ft({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Ie.responseText,message:Ie.responseText,extraInfo:le}),we({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Ie.responseText,message:Ie.responseText,extraInfo:le}));else if(Ae===403)ae.error_code===4e4||ae.error_code===60004||ae.error_code===15002?we({type:p.E.SERVICE_NOT_ENABLED,message:ae?.error_description,extraInfo:le}):ae.error_code===40003||ae.error_code===40004?we({type:p.E.THREAD_ALREADY_EXIST,message:ae?.error_description,extraInfo:le}):ae.error_code===40005||ae.error_code===40007||ae.error_code===91002?we({type:p.E.MAX_LIMIT,message:ae?.error_description,extraInfo:le}):ae.error_code===60002?we({type:p.E.PERMISSION_DENIED,message:ae?.error_description,extraInfo:le}):ae.error_code===91101?we({type:p.E.MAX_LIMIT,message:ae?.error_description,extraInfo:le}):ae.error_code===91102&&we({type:p.E.REQUEST_PARAMETER_ERROR,message:ae.error_description,extraInfo:le}),ae.error_description==="group member list is full!"?!((Pt=Ie.responseURL)===null||Pt===void 0)&&Pt.includes("chatgroups")?we({type:p.E.GROUP_MEMBERS_FULL,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):we({type:p.E.CHATROOM_MEMBERS_FULL,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):!((bt=ae.error_description)===null||bt===void 0)&&bt.includes(ae.error_description.includes("already in group"))?!((jt=Ie.responseURL)===null||jt===void 0)&&jt.includes("chatgroups")&&we({type:p.E.GROUP_ALREADY_JOINED,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):!((Lt=ae.error_description)===null||Lt===void 0)&&Lt.includes("are not members of this group")?!((Gt=Ie.responseURL)===null||Gt===void 0)&&Gt.includes("chatgroups")?we({type:p.E.GROUP_NOT_JOINED,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):we({type:p.E.CHATROOM_NOT_JOINED,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):!((pr=ae.error_description)===null||pr===void 0)&&pr.includes("service not open!")||!((ir=ae.error_description)===null||ir===void 0)&&ir.includes("message report not open")||!((Ar=ae.error_description)===null||Ar===void 0)&&Ar.includes("messageroaming function not open")?we({type:p.E.SERVICE_NOT_ENABLED,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):!((er=ae.error_description)===null||er===void 0)&&er.includes("members size is greater than max user size !")?we({type:p.E.GROUP_MEMBERS_LIMIT,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):!((yt=ae.error_description)===null||yt===void 0)&&yt.includes("can not operate this group, reason: group is disabled")?we({type:p.E.GROUP_IS_DISABLED,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):!((Xt=ae.error_description)===null||Xt===void 0)&&Xt.includes("Invitee's contact max count")||!((Ir=ae.error_description)===null||Ir===void 0)&&Ir.includes("Inviter's contact max count")?we({type:p.E.MAX_LIMIT,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):we({type:p.E.PERMISSION_DENIED,data:Ie.response||Ie.responseText,message:"permission denied",extraInfo:f(f({},le),{errDesc:"permission denied"})}),ft({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Ie.responseText,message:Ie.responseText,extraInfo:le});else if(Ae===404)ae.error_code===40011?we({type:p.E.THREAD_NOT_EXIST,message:ae?.error_description,extraInfo:le}):ae.error_code===40012?we({type:p.E.NO_PERMISSION,message:ae?.error_description,extraInfo:le}):ae.error_code===60003||ae.error_code===20004?we({type:p.E.GROUP_NOT_JOINED,message:ae?.error_description,extraInfo:le}):ae.error_code===91001&&we({type:p.E.CONVERSATION_NOT_EXIST,message:ae?.error_description,extraInfo:le}),!((St=ae.error_description)===null||St===void 0)&&St.includes("do not find this group")||!((Wt=ae.error_description)===null||Wt===void 0)&&Wt.includes("does not exist")?!((Zt=Ie.responseURL)===null||Zt===void 0)&&Zt.includes("chatgroups")?we({type:p.E.GROUP_NOT_EXIST,data:Ie.response||Ie.responseText,message:"The chat room dose not exist.",extraInfo:f(f({},le),{errDesc:"The chat room dose not exist."})}):we({type:p.E.CHATROOM_NOT_EXIST,data:Ie.response||Ie.responseText,message:"The chat room dose not exist.",extraInfo:f(f({},le),{errDesc:"The chat room dose not exist."})}):!((Kt=ae.error_description)===null||Kt===void 0)&&Kt.includes("username")&&(!((At=ae.error_description)===null||At===void 0)&&At.includes("doesn't exist!'"))||!((vt=ae.error_description)===null||vt===void 0)&&vt.includes("user not found")||!((zt=ae.error_description)===null||zt===void 0)&&zt.includes("Service resource not found")&&ae?.exception==="UserNotFoundException"?we({type:p.E.USER_NOT_FOUND,data:Ie.response||Ie.responseText,message:ae.error_description,extraInfo:le}):ae.error_description.includes("user session pin message not exist")?we({type:p.E.MESSAGE_NOT_FOUND,message:ae.error_description,extraInfo:le}):we({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Ie.response||Ie.responseText,message:Ie.responseText,extraInfo:le}),ft({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Ie.response||Ie.responseText,message:Ie.responseText,extraInfo:le});else if(Ae===406)ae.error_code===90004&&we({type:p.E.OPERATION_NOT_ALLOWED,message:ae?.error_description,extraInfo:le});else if(Ae===429||Ae===503){if(!((vr=ae.error_description)===null||vr===void 0)&&vr.includes("The request has reached the maximum limit"))return void we({type:p.E.MAX_LIMIT,message:Ie.responseText,extraInfo:le});if(!((or=ae.error_description)===null||or===void 0)&&or.includes("upload client logs reached limit"))return void we({type:p.E.MAX_LIMIT,message:Ie.responseText});we({type:p.E.SERVER_BUSY,data:Ie.response||Ie.responseText,message:"Server is busy.",extraInfo:f(f({},le),{errDesc:"Server is busy."})}),ft({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Ie.responseText,message:"Server is busy.",extraInfo:f(f({},le),{errDesc:"Server is busy."})})}else if(Ae===500){if(ae.error_code===40006||ae.error_code===40008||ae.error_code===40010)return void we({type:p.E.SERVER_UNKNOWN_ERROR,message:ae?.error_description,extraInfo:le});if(ae.error_code===90005||ae.error_code===99999)return void we({type:p.E.REQUEST_UNKNOWN,message:ae?.error_description,extraInfo:le});if(!((mr=ae.error_description)===null||mr===void 0)&&mr.includes("translte failed!"))return void we({type:p.E.TRANSLATION_FAILED,message:Ie.responseText,extraInfo:le});we({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Ie.responseText,message:"",extraInfo:le}),ft({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Ie.responseText,message:"",extraInfo:le})}else we({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Ie.responseText,message:Ie.responseText,extraInfo:f(f({},le),{errDesc:"ajax error"})}),ft({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Ie.responseText,message:Ie.responseText,extraInfo:f(f({},le),{errDesc:"ajax error"})})},v=c(1595),S=c(2071),y=c(7360),E=5242880,N=5242880,C={size:0},U=(c(2526),c(1817),c(2165),c(5827),c(4553),c(561),function(){return U=Object.assign||function(Ie){for(var we,ft=1,qe=arguments.length;ft<qe;ft++)for(var it in we=arguments[ft])Object.prototype.hasOwnProperty.call(we,it)&&(Ie[it]=we[it]);return Ie},U.apply(this,arguments)});function M(){var Ie=this.context,we=Ie.orgName,ft=Ie.appName,qe=Ie.accessToken,it={url:"".concat(this.apiUrl,"/").concat(we,"/").concat(ft,"/sdk/chatfiles/part-upload"),dataType:"json",type:"POST",headers:{Authorization:"Bearer "+qe}};return y.kg.debug("Call multipartInit"),ne.call(this,it,v.fI.SDK_INTERNAL).then(function(Tt){var Pt=Tt.entities[0];return{data:{fileMaxSize:Pt.file_upper_limit,partMinSize:Pt.part_lower_limit,uuid:Pt.uuid},extraInfo:Tt.extraInfo,type:Tt.type}})}function x(Ie){var we=this;return new Promise(function(ft,qe){var it,Tt,Pt=new Date().getTime(),bt=we.context,jt=bt.orgName,Lt=bt.appName,Gt=bt.accessToken,pr=Ie.uuid,ir=Ie.partNumber,Ar=Ie.part,er=Ie.onProgress,yt="".concat(we.apiUrl,"/").concat(jt,"/").concat(Lt,"/sdk/chatfiles/part-upload/").concat(pr),Xt=new XMLHttpRequest;y.kg.debug("Call multipartUpload"),Xt.upload&&((Tt=(it=Xt.upload).addEventListener)===null||Tt===void 0||Tt.call(it,"progress",function(St){er?.(St)},!1)),Xt.addEventListener("abort",function(){qe({type:p.E.REQUEST_ABORT,message:"Request Abort",errorType:"onabort",xhr:Xt,extraInfo:{elapse:new Date().getTime()-Pt,httpCode:Xt.status||-1,errDesc:"Request Abort",url:yt}})},!1),Xt.addEventListener("error",function(){qe({type:p.E.WEBIM_UPLOADFILE_ERROR,data:Xt,extraInfo:{elapse:new Date().getTime()-Pt,httpCode:Xt.status||-1,errDesc:"request error",url:yt}})},!1),Xt.addEventListener("load",function(){try{var St=JSON.parse(Xt.responseText);if(Xt.status!==200)return qe({type:p.E.WEBIM_UPLOADFILE_ERROR,data:St,extraInfo:{elapse:new Date().getTime()-Pt,httpCode:Xt.status||-1,errDesc:"part upload failed",url:yt}}),!1;try{ft(U(U({},St),{extraInfo:{elapse:new Date().getTime()-Pt,httpCode:Xt.status||-1,url:yt}}))}catch(Wt){qe({type:p.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:Wt,extraInfo:{elapse:new Date().getTime()-Pt,httpCode:Xt.status||-1,errDesc:"part upload failed",url:yt}})}}catch{qe({type:p.E.WEBIM_UPLOADFILE_ERROR,data:Xt.responseText,extraInfo:{elapse:new Date().getTime()-Pt,httpCode:Xt.status||-1,errDesc:"part upload failed",url:yt}})}},!1);var Ir=new FormData;Ir.append("part_file",Ar),Ir.append("part_number",ir),Xt.open("PUT",yt),Xt.setRequestHeader("restrict-access","true"),Xt.setRequestHeader("Accept","*/*"),Xt.setRequestHeader("Authorization","Bearer "+Gt),Xt.send(Ir)})}function P(Ie){var we=Ie.uuid,ft=Ie.thumbnailHeight,qe=Ie.thumbnailWidth,it=this.context,Tt=it.orgName,Pt=it.appName,bt=it.accessToken,jt="".concat(this.apiUrl,"/").concat(Tt,"/").concat(Pt,"/sdk/chatfiles/part-upload/").concat(we,"?restrict-access=true");qe&&(jt+="&thumbnail-width=".concat(qe)),ft&&(jt+="&thumbnail-height=".concat(ft));var Lt={url:jt,dataType:"json",type:"POST",headers:{Authorization:"Bearer "+bt}};return y.kg.debug("Call multipartComplete"),ne.call(this,Lt,v.fI.SDK_INTERNAL)}function z(Ie){var we=Ie.uuid,ft=this.context,qe=ft.orgName,it=ft.appName,Tt=ft.accessToken,Pt={url:"".concat(this.apiUrl,"/").concat(qe,"/").concat(it,"/sdk/chatfiles/part-upload/").concat(we),dataType:"json",type:"DELETE",headers:{Authorization:"Bearer "+Tt}};return y.kg.debug("Call multipartAbort"),ne.call(this,Pt,v.fI.SDK_INTERNAL)}var Z=function(Ie,we,ft,qe){return new(ft||(ft=Promise))(function(it,Tt){function Pt(Lt){try{jt(qe.next(Lt))}catch(Gt){Tt(Gt)}}function bt(Lt){try{jt(qe.throw(Lt))}catch(Gt){Tt(Gt)}}function jt(Lt){var Gt;Lt.done?it(Lt.value):(Gt=Lt.value,Gt instanceof ft?Gt:new ft(function(pr){pr(Gt)})).then(Pt,bt)}jt((qe=qe.apply(Ie,[])).next())})},I=function(Ie,we){var ft,qe,it,Tt,Pt={label:0,sent:function(){if(1&it[0])throw it[1];return it[1]},trys:[],ops:[]};return Tt={next:bt(0),throw:bt(1),return:bt(2)},typeof Symbol=="function"&&(Tt[Symbol.iterator]=function(){return this}),Tt;function bt(jt){return function(Lt){return function(Gt){if(ft)throw new TypeError("Generator is already executing.");for(;Pt;)try{if(ft=1,qe&&(it=2&Gt[0]?qe.return:Gt[0]?qe.throw||((it=qe.return)&&it.call(qe),0):qe.next)&&!(it=it.call(qe,Gt[1])).done)return it;switch(qe=0,it&&(Gt=[2&Gt[0],it.value]),Gt[0]){case 0:case 1:it=Gt;break;case 4:return Pt.label++,{value:Gt[1],done:!1};case 5:Pt.label++,qe=Gt[1],Gt=[0];continue;case 7:Gt=Pt.ops.pop(),Pt.trys.pop();continue;default:if(!((it=(it=Pt.trys).length>0&&it[it.length-1])||Gt[0]!==6&&Gt[0]!==2)){Pt=0;continue}if(Gt[0]===3&&(!it||Gt[1]>it[0]&&Gt[1]<it[3])){Pt.label=Gt[1];break}if(Gt[0]===6&&Pt.label<it[1]){Pt.label=it[1],it=Gt;break}if(it&&Pt.label<it[2]){Pt.label=it[2],Pt.ops.push(Gt);break}it[2]&&Pt.ops.pop(),Pt.trys.pop();continue}Gt=we.call(Ie,Pt)}catch(pr){Gt=[6,pr],qe=0}finally{ft=it=0}if(5&Gt[0])throw Gt[1];return{value:Gt[0]?Gt[1]:void 0,done:!0}}([jt,Lt])}}},Y=function(){function Ie(we,ft){var qe=this;this.handleUploadProgress=function(it,Tt){var Pt,bt;if(it.total){qe.progressArr[Tt]=it.loaded;var jt=qe.progressArr.reduce(function(Lt,Gt){return Lt+Gt},0);(bt=(Pt=qe.options).onFileUploadProgress)===null||bt===void 0||bt.call(Pt,{isTrusted:it.isTrusted,type:it.type,loaded:jt>qe.file.size?qe.file.size:jt,total:qe.file.size,lengthComputable:it.lengthComputable})}},this.uuid="",this.pool=[],this.progressArr=[],this.connection=we,this.options=ft,this.partSize=E,this.file=ft.file,this.init(),this.rpt=this.connection.dataReport.geOperateFun({operationName:v.fI.REST_UPLOAD_FILE_IN_PARTS})}return Ie.prototype.init=function(){var we,ft,qe,it;return Z(this,void 0,void 0,function(){var Tt,Pt,bt,jt,Lt,Gt,pr,ir,Ar,er,yt,Xt,Ir,St,Wt;return I(this,function(Zt){switch(Zt.label){case 0:return Zt.trys.push([0,4,,6]),[4,M.call(this.connection)];case 1:return Tt=Zt.sent(),Pt=Tt.data||{},bt=Pt.fileMaxSize,jt=bt===void 0?0:bt,Lt=Pt.partMinSize,Gt=Lt===void 0?E:Lt,pr=Pt.uuid,ir=pr===void 0?"":pr,Ar=Tt.extraInfo,Xt=Ar.elapse,Ir=Ar.httpCode,Wt=Ar.url,this.partSize=Gt,this.uuid=ir,C.size=Gt,y.kg.debug("multipartInit success","uuid: ".concat(ir),"fileMaxSize: ".concat(jt),"partMinSize: ".concat(Gt)),this.file.size>jt?[4,this.multipartAbort()]:[3,3];case 2:return Zt.sent(),(ft=(we=this.options).onFileUploadError)===null||ft===void 0||ft.call(we,{code:p.E.WEBIM_UPLOADFILE_ERROR,message:"The file size exceeds the maximum limit"}),[2];case 3:return this.rpt({data:{requestUrl:Wt,requestName:v.c.REST_INIT_UPLOAD_TASK_IN_PARTS,requestElapse:Xt,requestMethod:"POST",isSuccess:1,code:Ir}}),this.upload(),[3,6];case 4:return er=Zt.sent(),yt=er?.extraInfo||{},Xt=yt.elapse,Ir=yt.httpCode,St=yt.errDesc,Wt=yt.url,this.rpt({data:{requestUrl:Wt,requestName:v.c.REST_INIT_UPLOAD_TASK_IN_PARTS,requestElapse:Xt,requestMethod:"POST",isSuccess:0,codeDesc:St,code:Ir}}),[4,this.multipartAbort()];case 5:return Zt.sent(),(it=(qe=this.options)===null||qe===void 0?void 0:qe.onInitFail)===null||it===void 0||it.call(qe),[3,6];case 6:return[2]}})})},Ie.prototype.upload=function(){var we,ft,qe;return Z(this,void 0,void 0,function(){var it,Tt,Pt,bt,jt,Lt,Gt=this;return I(this,function(pr){switch(pr.label){case 0:new FileReader().readAsArrayBuffer(this.file),it=this.file.size,Tt=Math.ceil(it/this.partSize),pr.label=1;case 1:pr.trys.push([1,7,,9]),Pt=function(ir){var Ar,er,yt,Xt;return I(this,function(Ir){switch(Ir.label){case 0:return Ar=ir*bt.partSize,er=Math.min(it,Ar+bt.partSize),yt=(we=bt.file)===null||we===void 0?void 0:we.slice(Ar,er),(Xt=x.call(bt.connection,{uuid:bt.uuid,partNumber:"".concat(ir+1),part:yt,onProgress:function(St){Gt.handleUploadProgress(St,ir)}})).then(function(St){var Wt=St?.extraInfo||{},Zt=Wt.elapse,Kt=Wt.httpCode,At=Wt.url;Gt.rpt({data:{requestUrl:At,requestName:v.c.REST_UPLOAD_PART,requestElapse:Zt,isSuccess:1,requestMethod:"PUT",code:Kt}}),Gt.handleTask(Xt)}),Xt.catch(function(St){var Wt=St?.extraInfo||{},Zt=Wt.elapse,Kt=Wt.httpCode,At=Wt.url,vt=Wt.errDesc;Gt.rpt({data:{requestUrl:At,requestName:v.c.REST_UPLOAD_PART,requestElapse:Zt,isSuccess:0,requestMethod:"PUT",code:Kt,codeDesc:vt}}),delete St.extraInfo}),bt.pool.push(Xt),bt.pool.length!==4?[3,2]:[4,Promise.race(bt.pool)];case 1:Ir.sent(),Ir.label=2;case 2:return[2]}})},bt=this,jt=0,pr.label=2;case 2:return jt<Tt?[5,Pt(jt)]:[3,5];case 3:pr.sent(),pr.label=4;case 4:return jt++,[3,2];case 5:return[4,Promise.all(this.pool)];case 6:return pr.sent(),this.multipartComplete(),[3,9];case 7:return Lt=pr.sent(),[4,this.multipartAbort()];case 8:return pr.sent(),this.rpt({data:{isLastApi:1,isSuccess:0}}),(qe=(ft=this.options).onFileUploadError)===null||qe===void 0||qe.call(ft,Lt),[3,9];case 9:return[2]}})})},Ie.prototype.multipartComplete=function(){var we,ft,qe,it;return Z(this,void 0,void 0,function(){var Tt,Pt,bt,jt,Lt,Gt,pr,ir,Ar,er,yt;return I(this,function(Xt){switch(Xt.label){case 0:return Xt.trys.push([0,2,,3]),Tt=this.options.thumbnailInfo||{},Pt=Tt.width,bt=Tt.height,[4,P.call(this.connection,{uuid:this.uuid,thumbnailHeight:bt,thumbnailWidth:Pt})];case 1:return jt=Xt.sent(),Lt=jt?.extraInfo||{},ir=Lt.elapse,Ar=Lt.httpCode,yt=Lt.url,this.rpt({data:{requestUrl:yt,requestName:v.c.REST_COMPLETE_UPLOAD_PART,requestElapse:ir,requestMethod:"POST",isSuccess:1,code:Ar}}),this.rpt({data:{isLastApi:1,isSuccess:1}}),(ft=(we=this.options).onFileUploadComplete)===null||ft===void 0||ft.call(we,jt),[3,3];case 2:return Gt=Xt.sent(),pr=Gt?.extraInfo||{},ir=pr.elapse,Ar=pr.httpCode,er=pr.errDesc,yt=pr.url,this.rpt({data:{requestUrl:yt,requestName:v.c.REST_COMPLETE_UPLOAD_PART,requestElapse:ir,requestMethod:"POST",isSuccess:0,codeDesc:er,code:Ar}}),this.rpt({data:{isLastApi:1,isSuccess:0}}),(it=(qe=this.options).onFileUploadError)===null||it===void 0||it.call(qe,Gt),[3,3];case 3:return[2]}})})},Ie.prototype.multipartAbort=function(){return Z(this,void 0,void 0,function(){var we,ft,qe,it,Tt,Pt,bt,jt;return I(this,function(Lt){switch(Lt.label){case 0:if(!this.uuid)return[2];Lt.label=1;case 1:return Lt.trys.push([1,3,,4]),[4,z.call(this.connection,{uuid:this.uuid})];case 2:return we=Lt.sent(),ft=we?.extraInfo||{},Tt=ft.elapse,Pt=ft.httpCode,jt=ft.url,this.rpt({data:{requestUrl:jt,requestName:v.c.REST_ABORT_UPLOAD_PART,requestElapse:Tt,requestMethod:"DELETE",isSuccess:1,code:Pt}}),[3,4];case 3:return qe=Lt.sent(),it=qe?.extraInfo||{},Tt=it.elapse,Pt=it.httpCode,bt=it.errDesc,jt=it.url,this.rpt({data:{requestUrl:jt,requestName:v.c.REST_ABORT_UPLOAD_PART,requestElapse:Tt,requestMethod:"DELETE",isSuccess:0,codeDesc:bt,code:Pt}}),[3,4];case 4:return[2]}})})},Ie.prototype.handleTask=function(we){var ft=this.pool.findIndex(function(qe){return qe===we});this.pool.splice(ft,1)},Ie}(),F=function(Ie){var we,ft,qe=this,it=new Date().getTime(),Tt=Ie.apiUrl,Pt=Ie.orgName,bt=Ie.appName,jt=Ie.operateName,Lt=Ie.accessToken,Gt=Ie.uploadUrl||"".concat(Tt,"/").concat(Pt,"/").concat(bt,"/chatfiles"),pr=function(er){var yt=new Date().getTime()-it;qe.dataReport&&jt&&[v.fI.UPLOAD_MSG_ATTACH,v.fI.UPLOAD_CHATROOM_FILE,v.fI.UPLOAD_GROUP_FILE].includes(jt)&&qe.dataReport.geOperateFun({operationName:jt})({isEndApi:!0,data:{isSuccess:0,requestMethod:"POST",requestName:jt,requestElapse:yt,requestUrl:Gt,code:ir?.status||0,codeDesc:"upload file error"}}),Ie.onFileUploadError&&Ie.onFileUploadError(er)},ir=new XMLHttpRequest;ir.upload&&((ft=(we=ir.upload).addEventListener)===null||ft===void 0||ft.call(we,"progress",Ie.onFileUploadProgress||W,!1)),ir.addEventListener("abort",Ie.onFileUploadCanceled||W,!1),ir.addEventListener("error",function(er){pr({type:p.E.WEBIM_UPLOADFILE_ERROR,data:ir})},!1),ir.addEventListener("load",function(er){try{var yt=JSON.parse(ir.responseText);if(ir.status===400)return pr({type:p.E.WEBIM_UPLOADFILE_ERROR,data:yt}),!1;try{(function(Xt){var Ir=new Date().getTime()-it;qe.dataReport&&jt&&[v.fI.UPLOAD_MSG_ATTACH,v.fI.UPLOAD_CHATROOM_FILE,v.fI.UPLOAD_GROUP_FILE].includes(jt)&&qe.dataReport.geOperateFun({operationName:jt})({isEndApi:!0,data:{isSuccess:Xt?.error?0:1,requestMethod:"POST",requestName:jt,requestElapse:Ir,requestUrl:Gt,code:ir.status,codeDesc:Xt?.error_description||""}}),Ie.onFileUploadComplete&&Ie.onFileUploadComplete(Xt)})(yt)}catch(Xt){pr({type:p.E.WEBIM_CONNCTION_CALLBACK_INNER_ERROR,data:Xt})}}catch{pr({type:p.E.WEBIM_UPLOADFILE_ERROR,data:ir.responseText})}},!1),ir.open("POST",Gt),ir.setRequestHeader("restrict-access","true"),ir.setRequestHeader("Accept","*/*"),ir.setRequestHeader("Authorization","Bearer "+Lt);var Ar=new FormData;Ar.append("file",Ie.file.data),Ie.thumbnailWidth&&Ar.append("thumbnail-width",Ie.thumbnailWidth+""),Ie.thumbnailHeight&&Ar.append("thumbnail-height",Ie.thumbnailHeight+""),ir.send(Ar)},oe=function(){return oe=Object.assign||function(Ie){for(var we,ft=1,qe=arguments.length;ft<qe;ft++)for(var it in we=arguments[ft])Object.prototype.hasOwnProperty.call(we,it)&&(Ie[it]=we[it]);return Ie},oe.apply(this,arguments)},W=function(){};function ne(Ie,we){var ft,qe=this;return ge().platform===ve.WEB?new Promise(function(it,Tt){var Pt=Ie.dataType||"text",bt=Ie.success||W,jt=Ie.error||W,Lt=new XMLHttpRequest;Lt.ontimeout=function(){Tt({type:p.E.REQUEST_TIMEOUT,message:"Request Timeout",errorType:"timeout_error",xhr:Lt})},Lt.onerror=function(){Tt({type:p.E.REQUEST_UNKNOWN,message:"Request Unknow Error",errorType:"onerror",xhr:Lt})},Lt.onabort=function(){Tt({type:p.E.REQUEST_ABORT,message:"Request Abort",errorType:"onabort",xhr:Lt})},Lt.onreadystatechange=function(){if(Lt.readyState===4){var Xt=new Date().getTime()-ft,Ir=Lt.status||0,St={elapse:Xt,httpCode:Ir};if(Ir===200){dt.ajaxUnconventionalErrorTimes=0;try{switch(Pt){case"text":return bt(Lt.responseText),void it(Lt.responseText);case"json":var Wt=JSON.parse(Lt.responseText);return Wt.extraInfo=St,bt(Wt),void it(Wt);case"xml":return Lt.responseXML&&Lt.responseXML.documentElement?(bt(Lt.responseXML.documentElement),void it(Lt.responseXML.documentElement)):(jt({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Lt.responseText,message:"XHR.responseXML is null or XHR.responseXML.documentElement is null"}),void Tt({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Lt.responseText,message:"XHR.responseXML is null or XHR.responseXML.documentElement is null"}));default:jt({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Lt.responseText,message:"Invalid dataType"}),Tt({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Lt.responseText,message:"Invalid dataType"})}return it(Lt.response||Lt.responseText),void bt(Lt.response||Lt.responseText,Lt)}catch(Zt){Tt(Zt)}return}[400,401,403,404,429,500,503].includes(Ir)||(y.kg.debug("rest api request fail status:",Ir),dt.ajaxUnconventionalErrorTimes++),T(Lt,Tt,jt,Xt)}Lt.readyState===0&&(jt({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Lt.responseText,message:"Request not initialized"}),Tt({type:p.E.WEBIM_CONNCTION_AJAX_ERROR,data:Lt.responseText,message:"Request not initialized"}))},Ie.responseType&&Lt.responseType&&(Lt.responseType=Ie.responseType),Ie.mimeType&&Lt.overrideMimeType(Ie.mimeType);var Gt=Ie.type||"POST",pr=Ie.data||null,ir="";if(Gt.toLowerCase()==="get"&&pr){for(var Ar in pr)pr.hasOwnProperty(Ar)&&(ir+=Ar+"="+pr[Ar]+"&");ir=ir&&ir.slice(0,-1),Ie.url+=(Ie.url.indexOf("?")>0?"&":"?")+(ir&&ir+"&")+"_v="+new Date().getTime(),pr=null,ir=""}ft=new Date().getTime(),Lt.open(Gt,Ie.url);var er=Ie.headers||{};for(var yt in er["Content-Type"]||(er["Content-Type"]="application/json"),er)er.hasOwnProperty(yt)&&Lt.setRequestHeader(yt,er[yt]);Lt.send(pr)}).then(function(it){return qe.dataReport&&we&&we!==v.fI.SDK_INTERNAL&&qe.dataReport.geOperateFun({operationName:we})({isEndApi:!0,data:oe({isSuccess:1,requestUrl:Ie.url,requestName:we,requestMethod:Ie.type},Ye(it.extraInfo))}),we===v.fI.SDK_INTERNAL&&(it.extraInfo.url=Ie.url),we!==v.fI.SDK_INTERNAL&&delete it.extraInfo,ee(it)==="Object"?oe(oe({},it),{type:p.E.REQUEST_SUCCESS}):{data:it,type:p.E.REQUEST_SUCCESS}}).catch(function(it){throw qe.dataReport&&we&&we!==v.fI.SDK_INTERNAL&&qe.dataReport.geOperateFun({operationName:we})({isEndApi:!0,data:oe({isSuccess:0,requestUrl:Ie.url,requestName:we,requestMethod:Ie.type},Ye(it.extraInfo))}),we===v.fI.SDK_INTERNAL&&(it.extraInfo.url=Ie.url),we!==v.fI.SDK_INTERNAL&&delete it.extraInfo,it}):H.call(this,Ie,we)}function ee(Ie){return Object.prototype.toString.call(Ie).slice(8,-1)}function H(Ie,we){var ft=this;return new Promise(function(qe,it){var Tt=Ie.success||W,Pt=Ie.error||W,bt=Ie.type||"POST",jt=Ie.data||null,Lt="",Gt=new Date().getTime(),pr=dt.getEnvInfo();if(bt.toLowerCase()==="get"&&jt){for(var ir in jt)jt.hasOwnProperty(ir)&&(Lt+=ir+"="+jt[ir]+"&");Lt=Lt&&Lt.slice(0,-1),Ie.url+=(Ie.url.indexOf("?")>0?"&":"?")+(Lt&&Lt+"&")+"_v="+new Date().getTime(),jt=null,Lt=""}var Ar={url:Ie.url,data:Ie.data,method:bt,headers:{},success:function(er){var yt,Xt,Ir,St,Wt,Zt={elapse:new Date().getTime()-Gt,httpCode:Number(((yt=er.statusCode)===null||yt===void 0?void 0:yt.toString())||((Xt=er.status)===null||Xt===void 0?void 0:Xt.toString())),errDesc:((Ir=er?.data)===null||Ir===void 0?void 0:Ir.error_description)||""};if(((St=er.statusCode)===null||St===void 0?void 0:St.toString())==="200"||((Wt=er.status)===null||Wt===void 0?void 0:Wt.toString())==="200"){er.data.extraInfo=Zt;var Kt=er.data;Tt(Kt),qe(Kt)}else er.extraInfo=Zt,Pt(Kt=er),it(Kt),y.kg.debug(we,"reject reason: ",Kt)},complete:function(){},fail:function(er){var yt={elapse:new Date().getTime()-Gt,httpCode:S.Tp,errDesc:"request:fail"};er.extraInfo=yt,er.data={error:"request:fail",error_description:"request:fail"},Pt(er),it(er),y.kg.debug(we,"fail reason:",er)}};if(pr.platform==="zfb"||pr.platform==="dd"?Ar.headers=Ie.headers:Ar.header=Ie.headers,pr.platform==="dd")return dd.httpRequest(Ar);pr.global.request(Ar)}).then(function(qe){return ft.dataReport&&we&&we!==v.fI.SDK_INTERNAL&&ft.dataReport.geOperateFun({operationName:we})({isEndApi:!0,data:oe({isSuccess:1,requestUrl:Ie.url,requestName:we,requestMethod:Ie.type},Ye(qe.extraInfo))}),we!==v.fI.SDK_INTERNAL&&delete qe.extraInfo,ee(qe)==="Object"?oe(oe({},qe),{type:p.E.REQUEST_SUCCESS}):{data:qe,type:p.E.REQUEST_SUCCESS}}).catch(function(qe){throw ft.dataReport&&we&&we!==v.fI.SDK_INTERNAL&&ft.dataReport.geOperateFun({operationName:we})({isEndApi:!0,data:oe({isSuccess:0,requestUrl:Ie.url,requestName:we,requestMethod:Ie.type},Ye(qe.extraInfo))}),we!==v.fI.SDK_INTERNAL&&delete qe.extraInfo,qe})}function q(Ie,we){var ft;return function(){for(var qe=[],it=0;it<arguments.length;it++)qe[it]=arguments[it];if(!Ie)return ft;ft=Ie.apply(void 0,qe),Ie=null}}var ve,Le=q(function(Ie,we){var ft=ge();if(ft.platform!==ve.WEB){var qe=ft.global,it=function(Tt){Tt.isConnected?Ie():we()};qe.offNetworkStatusChange&&qe.offNetworkStatusChange(it),qe.onNetworkStatusChange&&qe.onNetworkStatusChange(it)}else typeof addEventListener<"u"&&(window.addEventListener("online",Ie),window.addEventListener("offline",we))}),Oe=q(function(Ie,we){var ft,qe,it=ge();if(it.platform===ve.WEB)document&&document.addEventListener("visibilitychange",function(){document.hidden?we?.():Ie?.()},!1);else{var Tt=it.global;Tt.onAppShow&&((ft=Tt.onAppShow)===null||ft===void 0||ft.call(Tt,Ie)),Tt.onAppHide&&((qe=Tt.onAppHide)===null||qe===void 0||qe.call(Tt,we))}});function ge(){return typeof swan<"u"&&je(swan)?{platform:ve.BAIDU,global:swan}:typeof tt<"u"&&je(tt)?{platform:ve.TT,global:tt}:typeof dd<"u"&&je(dd)?{platform:ve.DD,global:dd}:typeof my<"u"&&je(my)?{platform:ve.ZFB,global:my}:typeof wx<"u"&&je(wx)?{platform:ve.WX,global:wx}:typeof qq<"u"&&je(qq)?{platform:ve.QQ,global:qq}:typeof uni<"u"&&je(uni)?{platform:ve.UNI,global:uni}:typeof window<"u"&&window.WebSocket?{platform:ve.WEB,global:window}:{platform:ve.NODE,global:c.g||{}}}function je(Ie){for(var we=["canIUse","getSystemInfo"],ft=0,qe=we.length;ft<qe;ft++)if(!Ie[we[ft]])return!1;return!0}function Ne(Ie,we){var ft,qe,it,Tt=this,Pt=Ie.accessToken,bt=Ie.appKey,jt=(qe=(ft=Ie?.file)===null||ft===void 0?void 0:ft.data)===null||qe===void 0?void 0:qe.size,Lt=[],Gt="",pr="";if(Pt)if(bt&&(Lt=bt.split("#"),Gt=Lt[0],pr=Lt[1]),Gt||pr)if(jt<=0)Ie.onFileUploadError&&Ie.onFileUploadError({type:p.E.WEBIM_UPLOADFILE_ERROR,message:"fileSize must be greater than 0"});else if(Ie.uploadUrl)F.call(this,oe(oe({},Ie),{orgName:Gt,appName:pr,operateName:we}));else{var ir=C.size||N;this.uploadPartEnable&&jt>1.5*ir?new Y(this,{file:(it=Ie?.file)===null||it===void 0?void 0:it.data,onFileUploadProgress:Ie.onFileUploadProgress||W,onFileUploadComplete:Ie.onFileUploadComplete||W,onFileUploadError:Ie.onFileUploadError||W,onFileUploadCanceled:Ie.onFileUploadCanceled||W,onInitFail:function(){F.call(Tt,oe(oe({},Ie),{orgName:Gt,appName:pr,operateName:we}))},thumbnailInfo:{width:Ie.thumbnailWidth,height:Ie.thumbnailHeight}}):F.call(this,oe(oe({},Ie),{orgName:Gt,appName:pr,operateName:we}))}else Ie.onFileUploadError&&Ie.onFileUploadError({type:p.E.WEBIM_UPLOADFILE_ERROR,message:"AppKey illegal"});else Ie.onFileUploadError&&Ie.onFileUploadError({type:p.E.WEBIM_UPLOADFILE_NO_LOGIN,message:"AccessToken cannot be empty"})}function Be(Ie,we){Ie.onFileDownloadComplete=Ie.onFileDownloadComplete||W,Ie.onFileDownloadError=Ie.onFileDownloadError||W;var ft=new Date().getTime(),qe=new XMLHttpRequest,it=this;qe.addEventListener("load",function(pr){var ir=new Date().getTime()-ft;it.dataReport&&we&&we===v.fI.DOWN_GROUP_FILE&&it.dataReport.geOperateFun({operationName:we})({isEndApi:!0,data:{isSuccess:qe.status===200?1:0,requestMethod:"POST",requestName:we,requestElapse:ir,requestUrl:Ie?.url,code:qe.status,codeDesc:qe.status===200?"":"download file error"}}),Ie.onFileDownloadComplete&&Ie.onFileDownloadComplete(qe.response)},!1),qe.addEventListener("error",function(pr){var ir=new Date().getTime()-ft;it.dataReport&&we&&we===v.fI.DOWN_GROUP_FILE&&it.dataReport.geOperateFun({operationName:we})({isEndApi:!0,data:{isSuccess:0,requestMethod:"POST",requestName:we,requestElapse:ir,requestUrl:Ie?.url,code:qe?.status||0,codeDesc:"download file error"}}),Ie.onFileDownloadError&&Ie.onFileDownloadError({type:p.E.WEBIM_DOWNLOADFILE_ERROR,id:Ie.id,xhr:qe})},!1);var Tt=Ie.method||"GET",Pt=Ie.responseType||"blob",bt=Ie.mimeType||"text/plain; charset=x-user-defined";qe.open(Tt,Ie.url),typeof Blob<"u"?qe.responseType=Pt:qe.overrideMimeType(bt);var jt={"X-Requested-With":"XMLHttpRequest",Accept:"application/octet-stream","share-secret":Ie.secret,Authorization:"Bearer "+this.context.accessToken},Lt=Ie.headers||{};for(var Gt in Lt)jt[Gt]=Lt[Gt];for(var Gt in jt)jt[Gt]&&qe.setRequestHeader(Gt,jt[Gt]);qe.send(null)}function Ye(Ie){Ie===void 0&&(Ie={});var we=Ie.elapse,ft=we===void 0?0:we,qe=Ie.httpCode,it=qe===void 0?0:qe,Tt=Ie.errDesc;return{requestElapse:ft,code:it,codeDesc:Tt===void 0?"":Tt}}(function(Ie){Ie.WEB="web",Ie.WX="wx",Ie.QQ="qq",Ie.ZFB="zfb",Ie.DD="dd",Ie.TT="tt",Ie.BAIDU="baidu",Ie.QUICK_APP="quick_app",Ie.UNI="uni",Ie.NODE="node"})(ve||(ve={}));var pt="localDeviceInfo",dt={autoIncrement:0,ajaxUnconventionalErrorTimes:0,ajax:ne,getUniqueId:function(){this.autoIncrement?this.autoIncrement++:this.autoIncrement=1;var Ie=new Date,we=new Date(2010,1,1);return(Ie.getTime()-we.getTime()+this.autoIncrement).toString()},getFileUrl:function(Ie){var we={url:"",filename:"",filetype:"",data:{}},ft=typeof Ie=="string"?document.getElementById(Ie):Ie;if(window.URL.createObjectURL){if(!ft.files)throw Error("this is not HTMLInputElement");var qe=ft.files;if(qe.length>0){var it=qe.item(0);we.data=it,we.url=window.URL.createObjectURL(it),we.filename=it?.name||""}}else{if(typeof Ie!="string")throw Error("in IE fileInputId must be string");it=document.getElementById(Ie).value,we.url=it;var Tt=it.lastIndexOf("/"),Pt=it.lastIndexOf("\\"),bt=Math.max(Tt,Pt);we.filename=bt<0?it:it.substring(bt+1)}var jt=we.filename.lastIndexOf(".");return jt!==-1&&(we.filetype=we.filename.substring(jt+1).toLowerCase()),we},uploadFile:Ne,flow:function(Ie){for(var we=Ie.length,ft=we;ft--;)if(typeof Ie[ft]!="function")throw new TypeError("Expected a function");return function(){for(var qe=[],it=0;it<arguments.length;it++)qe[it]=arguments[it];for(var Tt=0,Pt=we?Ie[Tt].apply(this,qe):qe[0];++Tt<we;)Pt=Ie[Tt].call(this,Pt);return Pt}},listenNetwork:Le,listenBrowserVisibility:Oe,getEnvInfo:ge,wxRequest:H,parseDownloadResponse:function(Ie){if(!window||!window.URL)throw Error("parseDownloadResponse can be used in broswer only");return Ie&&Ie.type&&Ie.type==="application/json"||0>Object.prototype.toString.call(Ie).indexOf("Blob")?this.url+"?token=":window.URL.createObjectURL(Ie)},download:Be,parseNotify:function(Ie){for(var we="",ft=0;ft<Ie.length;ft++)we+="%"+Ie[ft].toString(16);return JSON.parse(decodeURIComponent(we))},getExtraData:Ye,retryPromise:function(Ie,we,ft){return new Promise(function(qe,it){(function Tt(Pt){Ie().then(qe).catch(function(bt){Pt>0?setTimeout(function(){Tt(Pt-1)},ft||1e3):it(bt)})})(we||3)})},formatAttachUrl:function(Ie){return Ie&&typeof Ie=="string"?"".concat(this.apiUrl).concat(Ie.substr(Ie.indexOf("/",9))):""},Uint8ArrayToString:function(Ie){for(var we="",ft=0;ft<Ie.length;ft++)we+=String.fromCharCode(Ie[ft]);return we},getLocalDeviceInfo:function(){return function(Ie){var we,ft=dt.getEnvInfo(),qe=ft.platform,it="";qe!==ve.NODE&&qe!==ve.QUICK_APP||(it="");try{qe===ve.WEB?it=localStorage.getItem(Ie)||"":qe===ve.WX||qe===ve.QQ||qe===ve.TT||qe===ve.BAIDU||qe===ve.UNI?it=ft.global.getStorageSync(Ie)||"":qe!==ve.ZFB&&qe!==ve.DD||(it=((we=ft.global.getStorageSync({key:Ie}))===null||we===void 0?void 0:we.data)||"")}catch(Tt){y.kg.debug("get local ".concat(Ie," failed: "),Tt)}return y.kg.debug("".concat(Ie," "),it),it}(pt)},setLocalDeviceInfo:function(Ie){var we,ft,qe,it;we=pt,ft=Ie,(it=(qe=dt.getEnvInfo()).platform)!==ve.NODE&&it!==ve.QUICK_APP&&(it===ve.WEB?localStorage.setItem(we,ft):qe.global.setStorage({key:we,data:ft,success:function(Tt){y.kg.debug("set local ".concat(we," success: "),Tt)},fail:function(Tt){y.kg.error("set local ".concat(we," failed: "),Tt)}}))},detectBrowser:function(){if(typeof navigator>"u")return"unknown";var Ie=navigator.userAgent;return/MicroMessenger/i.test(Ie)?"WeChat":/QQBrowser/i.test(Ie)?"QQ":!/Chrome/i.test(Ie)||/Edg/i.test(Ie)||/OPR/i.test(Ie)?!/Safari/i.test(Ie)||/Chrome/i.test(Ie)||/CriOS/i.test(Ie)?/Firefox/i.test(Ie)?"Firefox":/MSIE/i.test(Ie)||/Trident/i.test(Ie)?"IE":/Edg/i.test(Ie)?"Edge":"unknown":"Safari":"Chrome"},getDevicePlatform:function(Ie){return Ie.platform===ve.WX&&typeof uni<"u"&&je(uni)?ve.UNI:Ie.platform},delay:function(Ie){return new Promise(function(we){return setTimeout(we,Ie)})}}},9662:function(O,j,c){var p=c(614),f=c(6330),T=TypeError;O.exports=function(v){if(p(v))return v;throw T(f(v)+" is not a function")}},9483:function(O,j,c){var p=c(4411),f=c(6330),T=TypeError;O.exports=function(v){if(p(v))return v;throw T(f(v)+" is not a constructor")}},6077:function(O,j,c){var p=c(614),f=String,T=TypeError;O.exports=function(v){if(typeof v=="object"||p(v))return v;throw T("Can't set "+f(v)+" as a prototype")}},1223:function(O,j,c){var p=c(5112),f=c(30),T=c(3070).f,v=p("unscopables"),S=Array.prototype;S[v]==null&&T(S,v,{configurable:!0,value:f(null)}),O.exports=function(y){S[v][y]=!0}},1530:function(O,j,c){var p=c(8710).charAt;O.exports=function(f,T,v){return T+(v?p(f,T).length:1)}},5787:function(O,j,c){var p=c(7976),f=TypeError;O.exports=function(T,v){if(p(v,T))return T;throw f("Incorrect invocation")}},9670:function(O,j,c){var p=c(111),f=String,T=TypeError;O.exports=function(v){if(p(v))return v;throw T(f(v)+" is not an object")}},3013:function(O){O.exports=typeof ArrayBuffer<"u"&&typeof DataView<"u"},7556:function(O,j,c){var p=c(7293);O.exports=p(function(){if(typeof ArrayBuffer=="function"){var f=new ArrayBuffer(8);Object.isExtensible(f)&&Object.defineProperty(f,"a",{value:8})}})},260:function(O,j,c){var p,f,T,v=c(3013),S=c(9781),y=c(7854),E=c(614),N=c(111),C=c(2597),U=c(648),M=c(6330),x=c(8880),P=c(8052),z=c(7045),Z=c(7976),I=c(9518),Y=c(7674),F=c(5112),oe=c(9711),W=c(9909),ne=W.enforce,ee=W.get,H=y.Int8Array,q=H&&H.prototype,ve=y.Uint8ClampedArray,Le=ve&&ve.prototype,Oe=H&&I(H),ge=q&&I(q),je=Object.prototype,Ne=y.TypeError,Be=F("toStringTag"),Ye=oe("TYPED_ARRAY_TAG"),pt="TypedArrayConstructor",dt=v&&!!Y&&U(y.opera)!=="Opera",Ie=!1,we={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},ft={BigInt64Array:8,BigUint64Array:8},qe=function(Tt){var Pt=I(Tt);if(N(Pt)){var bt=ee(Pt);return bt&&C(bt,pt)?bt[pt]:qe(Pt)}},it=function(Tt){if(!N(Tt))return!1;var Pt=U(Tt);return C(we,Pt)||C(ft,Pt)};for(p in we)(T=(f=y[p])&&f.prototype)?ne(T)[pt]=f:dt=!1;for(p in ft)(T=(f=y[p])&&f.prototype)&&(ne(T)[pt]=f);if((!dt||!E(Oe)||Oe===Function.prototype)&&(Oe=function(){throw Ne("Incorrect invocation")},dt))for(p in we)y[p]&&Y(y[p],Oe);if((!dt||!ge||ge===je)&&(ge=Oe.prototype,dt))for(p in we)y[p]&&Y(y[p].prototype,ge);if(dt&&I(Le)!==ge&&Y(Le,ge),S&&!C(ge,Be))for(p in Ie=!0,z(ge,Be,{configurable:!0,get:function(){return N(this)?this[Ye]:void 0}}),we)y[p]&&x(y[p],Ye,p);O.exports={NATIVE_ARRAY_BUFFER_VIEWS:dt,TYPED_ARRAY_TAG:Ie&&Ye,aTypedArray:function(Tt){if(it(Tt))return Tt;throw Ne("Target is not a typed array")},aTypedArrayConstructor:function(Tt){if(E(Tt)&&(!Y||Z(Oe,Tt)))return Tt;throw Ne(M(Tt)+" is not a typed array constructor")},exportTypedArrayMethod:function(Tt,Pt,bt,jt){if(S){if(bt)for(var Lt in we){var Gt=y[Lt];if(Gt&&C(Gt.prototype,Tt))try{delete Gt.prototype[Tt]}catch{try{Gt.prototype[Tt]=Pt}catch{}}}ge[Tt]&&!bt||P(ge,Tt,bt?Pt:dt&&q[Tt]||Pt,jt)}},exportTypedArrayStaticMethod:function(Tt,Pt,bt){var jt,Lt;if(S){if(Y){if(bt){for(jt in we)if((Lt=y[jt])&&C(Lt,Tt))try{delete Lt[Tt]}catch{}}if(Oe[Tt]&&!bt)return;try{return P(Oe,Tt,bt?Pt:dt&&Oe[Tt]||Pt)}catch{}}for(jt in we)!(Lt=y[jt])||Lt[Tt]&&!bt||P(Lt,Tt,Pt)}},getTypedArrayConstructor:qe,isView:function(Tt){if(!N(Tt))return!1;var Pt=U(Tt);return Pt==="DataView"||C(we,Pt)||C(ft,Pt)},isTypedArray:it,TypedArray:Oe,TypedArrayPrototype:ge}},3331:function(O,j,c){var p=c(7854),f=c(1702),T=c(9781),v=c(3013),S=c(6530),y=c(8880),E=c(7045),N=c(9190),C=c(7293),U=c(5787),M=c(9303),x=c(7466),P=c(7067),z=c(1179),Z=c(9518),I=c(7674),Y=c(8006).f,F=c(1285),oe=c(1589),W=c(8003),ne=c(9909),ee=S.PROPER,H=S.CONFIGURABLE,q="ArrayBuffer",ve="DataView",Le="prototype",Oe="Wrong index",ge=ne.getterFor(q),je=ne.getterFor(ve),Ne=ne.set,Be=p[q],Ye=Be,pt=Ye&&Ye[Le],dt=p[ve],Ie=dt&&dt[Le],we=Object.prototype,ft=p.Array,qe=p.RangeError,it=f(F),Tt=f([].reverse),Pt=z.pack,bt=z.unpack,jt=function(vt){return[255&vt]},Lt=function(vt){return[255&vt,vt>>8&255]},Gt=function(vt){return[255&vt,vt>>8&255,vt>>16&255,vt>>24&255]},pr=function(vt){return vt[3]<<24|vt[2]<<16|vt[1]<<8|vt[0]},ir=function(vt){return Pt(vt,23,4)},Ar=function(vt){return Pt(vt,52,8)},er=function(vt,zt,vr){E(vt[Le],zt,{configurable:!0,get:function(){return vr(this)[zt]}})},yt=function(vt,zt,vr,or){var mr=P(vr),ae=je(vt);if(mr+zt>ae.byteLength)throw qe(Oe);var Ae=ae.bytes,le=mr+ae.byteOffset,Xe=oe(Ae,le,le+zt);return or?Xe:Tt(Xe)},Xt=function(vt,zt,vr,or,mr,ae){var Ae=P(vr),le=je(vt);if(Ae+zt>le.byteLength)throw qe(Oe);for(var Xe=le.bytes,X=Ae+le.byteOffset,et=or(+mr),Me=0;Me<zt;Me++)Xe[X+Me]=et[ae?Me:zt-Me-1]};if(v){var Ir=ee&&Be.name!==q;if(C(function(){Be(1)})&&C(function(){new Be(-1)})&&!C(function(){return new Be,new Be(1.5),new Be(NaN),Be.length!=1||Ir&&!H}))Ir&&H&&y(Be,"name",q);else{(Ye=function(vt){return U(this,pt),new Be(P(vt))})[Le]=pt;for(var St,Wt=Y(Be),Zt=0;Wt.length>Zt;)(St=Wt[Zt++])in Ye||y(Ye,St,Be[St]);pt.constructor=Ye}I&&Z(Ie)!==we&&I(Ie,we);var Kt=new dt(new Ye(2)),At=f(Ie.setInt8);Kt.setInt8(0,2147483648),Kt.setInt8(1,2147483649),!Kt.getInt8(0)&&Kt.getInt8(1)||N(Ie,{setInt8:function(vt,zt){At(this,vt,zt<<24>>24)},setUint8:function(vt,zt){At(this,vt,zt<<24>>24)}},{unsafe:!0})}else pt=(Ye=function(vt){U(this,pt);var zt=P(vt);Ne(this,{type:q,bytes:it(ft(zt),0),byteLength:zt}),T||(this.byteLength=zt,this.detached=!1)})[Le],Ie=(dt=function(vt,zt,vr){U(this,Ie),U(vt,pt);var or=ge(vt),mr=or.byteLength,ae=M(zt);if(ae<0||ae>mr)throw qe("Wrong offset");if(ae+(vr=vr===void 0?mr-ae:x(vr))>mr)throw qe("Wrong length");Ne(this,{type:ve,buffer:vt,byteLength:vr,byteOffset:ae,bytes:or.bytes}),T||(this.buffer=vt,this.byteLength=vr,this.byteOffset=ae)})[Le],T&&(er(Ye,"byteLength",ge),er(dt,"buffer",je),er(dt,"byteLength",je),er(dt,"byteOffset",je)),N(Ie,{getInt8:function(vt){return yt(this,1,vt)[0]<<24>>24},getUint8:function(vt){return yt(this,1,vt)[0]},getInt16:function(vt){var zt=yt(this,2,vt,arguments.length>1?arguments[1]:void 0);return(zt[1]<<8|zt[0])<<16>>16},getUint16:function(vt){var zt=yt(this,2,vt,arguments.length>1?arguments[1]:void 0);return zt[1]<<8|zt[0]},getInt32:function(vt){return pr(yt(this,4,vt,arguments.length>1?arguments[1]:void 0))},getUint32:function(vt){return pr(yt(this,4,vt,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(vt){return bt(yt(this,4,vt,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(vt){return bt(yt(this,8,vt,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(vt,zt){Xt(this,1,vt,jt,zt)},setUint8:function(vt,zt){Xt(this,1,vt,jt,zt)},setInt16:function(vt,zt){Xt(this,2,vt,Lt,zt,arguments.length>2?arguments[2]:void 0)},setUint16:function(vt,zt){Xt(this,2,vt,Lt,zt,arguments.length>2?arguments[2]:void 0)},setInt32:function(vt,zt){Xt(this,4,vt,Gt,zt,arguments.length>2?arguments[2]:void 0)},setUint32:function(vt,zt){Xt(this,4,vt,Gt,zt,arguments.length>2?arguments[2]:void 0)},setFloat32:function(vt,zt){Xt(this,4,vt,ir,zt,arguments.length>2?arguments[2]:void 0)},setFloat64:function(vt,zt){Xt(this,8,vt,Ar,zt,arguments.length>2?arguments[2]:void 0)}});W(Ye,q),W(dt,ve),O.exports={ArrayBuffer:Ye,DataView:dt}},1048:function(O,j,c){var p=c(7908),f=c(1400),T=c(6244),v=c(5117),S=Math.min;O.exports=[].copyWithin||function(y,E){var N=p(this),C=T(N),U=f(y,C),M=f(E,C),x=arguments.length>2?arguments[2]:void 0,P=S((x===void 0?C:f(x,C))-M,C-U),z=1;for(M<U&&U<M+P&&(z=-1,M+=P-1,U+=P-1);P-- >0;)M in N?N[U]=N[M]:v(N,U),U+=z,M+=z;return N}},1285:function(O,j,c){var p=c(7908),f=c(1400),T=c(6244);O.exports=function(v){for(var S=p(this),y=T(S),E=arguments.length,N=f(E>1?arguments[1]:void 0,y),C=E>2?arguments[2]:void 0,U=C===void 0?y:f(C,y);U>N;)S[N++]=v;return S}},8533:function(O,j,c){var p=c(2092).forEach,f=c(9341)("forEach");O.exports=f?[].forEach:function(T){return p(this,T,arguments.length>1?arguments[1]:void 0)}},7745:function(O,j,c){var p=c(6244);O.exports=function(f,T){for(var v=0,S=p(T),y=new f(S);S>v;)y[v]=T[v++];return y}},8457:function(O,j,c){var p=c(9974),f=c(6916),T=c(7908),v=c(3411),S=c(7659),y=c(4411),E=c(6244),N=c(6135),C=c(4121),U=c(1246),M=Array;O.exports=function(x){var P=T(x),z=y(this),Z=arguments.length,I=Z>1?arguments[1]:void 0,Y=I!==void 0;Y&&(I=p(I,Z>2?arguments[2]:void 0));var F,oe,W,ne,ee,H,q=U(P),ve=0;if(!q||this===M&&S(q))for(F=E(P),oe=z?new this(F):M(F);F>ve;ve++)H=Y?I(P[ve],ve):P[ve],N(oe,ve,H);else for(ee=(ne=C(P,q)).next,oe=z?new this:[];!(W=f(ee,ne)).done;ve++)H=Y?v(ne,I,[W.value,ve],!0):W.value,N(oe,ve,H);return oe.length=ve,oe}},1318:function(O,j,c){var p=c(5656),f=c(1400),T=c(6244),v=function(S){return function(y,E,N){var C,U=p(y),M=T(U),x=f(N,M);if(S&&E!=E){for(;M>x;)if((C=U[x++])!=C)return!0}else for(;M>x;x++)if((S||x in U)&&U[x]===E)return S||x||0;return!S&&-1}};O.exports={includes:v(!0),indexOf:v(!1)}},2092:function(O,j,c){var p=c(9974),f=c(1702),T=c(8361),v=c(7908),S=c(6244),y=c(5417),E=f([].push),N=function(C){var U=C==1,M=C==2,x=C==3,P=C==4,z=C==6,Z=C==7,I=C==5||z;return function(Y,F,oe,W){for(var ne,ee,H=v(Y),q=T(H),ve=p(F,oe),Le=S(q),Oe=0,ge=W||y,je=U?ge(Y,Le):M||Z?ge(Y,0):void 0;Le>Oe;Oe++)if((I||Oe in q)&&(ee=ve(ne=q[Oe],Oe,H),C))if(U)je[Oe]=ee;else if(ee)switch(C){case 3:return!0;case 5:return ne;case 6:return Oe;case 2:E(je,ne)}else switch(C){case 4:return!1;case 7:E(je,ne)}return z?-1:x||P?P:je}};O.exports={forEach:N(0),map:N(1),filter:N(2),some:N(3),every:N(4),find:N(5),findIndex:N(6),filterReject:N(7)}},6583:function(O,j,c){var p=c(2104),f=c(5656),T=c(9303),v=c(6244),S=c(9341),y=Math.min,E=[].lastIndexOf,N=!!E&&1/[1].lastIndexOf(1,-0)<0,C=S("lastIndexOf"),U=N||!C;O.exports=U?function(M){if(N)return p(E,this,arguments)||0;var x=f(this),P=v(x),z=P-1;for(arguments.length>1&&(z=y(z,T(arguments[1]))),z<0&&(z=P+z);z>=0;z--)if(z in x&&x[z]===M)return z||0;return-1}:E},1194:function(O,j,c){var p=c(7293),f=c(5112),T=c(7392),v=f("species");O.exports=function(S){return T>=51||!p(function(){var y=[];return(y.constructor={})[v]=function(){return{foo:1}},y[S](Boolean).foo!==1})}},9341:function(O,j,c){var p=c(7293);O.exports=function(f,T){var v=[][f];return!!v&&p(function(){v.call(null,T||function(){return 1},1)})}},3671:function(O,j,c){var p=c(9662),f=c(7908),T=c(8361),v=c(6244),S=TypeError,y=function(E){return function(N,C,U,M){p(C);var x=f(N),P=T(x),z=v(x),Z=E?z-1:0,I=E?-1:1;if(U<2)for(;;){if(Z in P){M=P[Z],Z+=I;break}if(Z+=I,E?Z<0:z<=Z)throw S("Reduce of empty array with no initial value")}for(;E?Z>=0:z>Z;Z+=I)Z in P&&(M=C(M,P[Z],Z,x));return M}};O.exports={left:y(!1),right:y(!0)}},3658:function(O,j,c){var p=c(9781),f=c(3157),T=TypeError,v=Object.getOwnPropertyDescriptor,S=p&&!function(){if(this!==void 0)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(y){return y instanceof TypeError}}();O.exports=S?function(y,E){if(f(y)&&!v(y,"length").writable)throw T("Cannot set read only .length");return y.length=E}:function(y,E){return y.length=E}},1589:function(O,j,c){var p=c(1400),f=c(6244),T=c(6135),v=Array,S=Math.max;O.exports=function(y,E,N){for(var C=f(y),U=p(E,C),M=p(N===void 0?C:N,C),x=v(S(M-U,0)),P=0;U<M;U++,P++)T(x,P,y[U]);return x.length=P,x}},206:function(O,j,c){var p=c(1702);O.exports=p([].slice)},4362:function(O,j,c){var p=c(1589),f=Math.floor,T=function(y,E){var N=y.length,C=f(N/2);return N<8?v(y,E):S(y,T(p(y,0,C),E),T(p(y,C),E),E)},v=function(y,E){for(var N,C,U=y.length,M=1;M<U;){for(C=M,N=y[M];C&&E(y[C-1],N)>0;)y[C]=y[--C];C!==M++&&(y[C]=N)}return y},S=function(y,E,N,C){for(var U=E.length,M=N.length,x=0,P=0;x<U||P<M;)y[x+P]=x<U&&P<M?C(E[x],N[P])<=0?E[x++]:N[P++]:x<U?E[x++]:N[P++];return y};O.exports=T},7475:function(O,j,c){var p=c(3157),f=c(4411),T=c(111),v=c(5112)("species"),S=Array;O.exports=function(y){var E;return p(y)&&(E=y.constructor,(f(E)&&(E===S||p(E.prototype))||T(E)&&(E=E[v])===null)&&(E=void 0)),E===void 0?S:E}},5417:function(O,j,c){var p=c(7475);O.exports=function(f,T){return new(p(f))(T===0?0:T)}},3411:function(O,j,c){var p=c(9670),f=c(9212);O.exports=function(T,v,S,y){try{return y?v(p(S)[0],S[1]):v(S)}catch(E){f(T,"throw",E)}}},7072:function(O,j,c){var p=c(5112)("iterator"),f=!1;try{var T=0,v={next:function(){return{done:!!T++}},return:function(){f=!0}};v[p]=function(){return this},Array.from(v,function(){throw 2})}catch{}O.exports=function(S,y){if(!y&&!f)return!1;var E=!1;try{var N={};N[p]=function(){return{next:function(){return{done:E=!0}}}},S(N)}catch{}return E}},4326:function(O,j,c){var p=c(1702),f=p({}.toString),T=p("".slice);O.exports=function(v){return T(f(v),8,-1)}},648:function(O,j,c){var p=c(1694),f=c(614),T=c(4326),v=c(5112)("toStringTag"),S=Object,y=T(function(){return arguments}())=="Arguments";O.exports=p?T:function(E){var N,C,U;return E===void 0?"Undefined":E===null?"Null":typeof(C=function(M,x){try{return M[x]}catch{}}(N=S(E),v))=="string"?C:y?T(N):(U=T(N))=="Object"&&f(N.callee)?"Arguments":U}},5631:function(O,j,c){var p=c(30),f=c(7045),T=c(9190),v=c(9974),S=c(5787),y=c(8554),E=c(408),N=c(1656),C=c(6178),U=c(6340),M=c(9781),x=c(2423).fastKey,P=c(9909),z=P.set,Z=P.getterFor;O.exports={getConstructor:function(I,Y,F,oe){var W=I(function(ve,Le){S(ve,ne),z(ve,{type:Y,index:p(null),first:void 0,last:void 0,size:0}),M||(ve.size=0),y(Le)||E(Le,ve[oe],{that:ve,AS_ENTRIES:F})}),ne=W.prototype,ee=Z(Y),H=function(ve,Le,Oe){var ge,je,Ne=ee(ve),Be=q(ve,Le);return Be?Be.value=Oe:(Ne.last=Be={index:je=x(Le,!0),key:Le,value:Oe,previous:ge=Ne.last,next:void 0,removed:!1},Ne.first||(Ne.first=Be),ge&&(ge.next=Be),M?Ne.size++:ve.size++,je!=="F"&&(Ne.index[je]=Be)),ve},q=function(ve,Le){var Oe,ge=ee(ve),je=x(Le);if(je!=="F")return ge.index[je];for(Oe=ge.first;Oe;Oe=Oe.next)if(Oe.key==Le)return Oe};return T(ne,{clear:function(){for(var ve=ee(this),Le=ve.index,Oe=ve.first;Oe;)Oe.removed=!0,Oe.previous&&(Oe.previous=Oe.previous.next=void 0),delete Le[Oe.index],Oe=Oe.next;ve.first=ve.last=void 0,M?ve.size=0:this.size=0},delete:function(ve){var Le=this,Oe=ee(Le),ge=q(Le,ve);if(ge){var je=ge.next,Ne=ge.previous;delete Oe.index[ge.index],ge.removed=!0,Ne&&(Ne.next=je),je&&(je.previous=Ne),Oe.first==ge&&(Oe.first=je),Oe.last==ge&&(Oe.last=Ne),M?Oe.size--:Le.size--}return!!ge},forEach:function(ve){for(var Le,Oe=ee(this),ge=v(ve,arguments.length>1?arguments[1]:void 0);Le=Le?Le.next:Oe.first;)for(ge(Le.value,Le.key,this);Le&&Le.removed;)Le=Le.previous},has:function(ve){return!!q(this,ve)}}),T(ne,F?{get:function(ve){var Le=q(this,ve);return Le&&Le.value},set:function(ve,Le){return H(this,ve===0?0:ve,Le)}}:{add:function(ve){return H(this,ve=ve===0?0:ve,ve)}}),M&&f(ne,"size",{configurable:!0,get:function(){return ee(this).size}}),W},setStrong:function(I,Y,F){var oe=Y+" Iterator",W=Z(Y),ne=Z(oe);N(I,Y,function(ee,H){z(this,{type:oe,target:ee,state:W(ee),kind:H,last:void 0})},function(){for(var ee=ne(this),H=ee.kind,q=ee.last;q&&q.removed;)q=q.previous;return ee.target&&(ee.last=q=q?q.next:ee.state.first)?C(H=="keys"?q.key:H=="values"?q.value:[q.key,q.value],!1):(ee.target=void 0,C(void 0,!0))},F?"entries":"values",!F,!0),U(Y)}}},7710:function(O,j,c){var p=c(2109),f=c(7854),T=c(1702),v=c(4705),S=c(8052),y=c(2423),E=c(408),N=c(5787),C=c(614),U=c(8554),M=c(111),x=c(7293),P=c(7072),z=c(8003),Z=c(9587);O.exports=function(I,Y,F){var oe=I.indexOf("Map")!==-1,W=I.indexOf("Weak")!==-1,ne=oe?"set":"add",ee=f[I],H=ee&&ee.prototype,q=ee,ve={},Le=function(Ye){var pt=T(H[Ye]);S(H,Ye,Ye=="add"?function(dt){return pt(this,dt===0?0:dt),this}:Ye=="delete"?function(dt){return!(W&&!M(dt))&&pt(this,dt===0?0:dt)}:Ye=="get"?function(dt){return W&&!M(dt)?void 0:pt(this,dt===0?0:dt)}:Ye=="has"?function(dt){return!(W&&!M(dt))&&pt(this,dt===0?0:dt)}:function(dt,Ie){return pt(this,dt===0?0:dt,Ie),this})};if(v(I,!C(ee)||!(W||H.forEach&&!x(function(){new ee().entries().next()}))))q=F.getConstructor(Y,I,oe,ne),y.enable();else if(v(I,!0)){var Oe=new q,ge=Oe[ne](W?{}:-0,1)!=Oe,je=x(function(){Oe.has(1)}),Ne=P(function(Ye){new ee(Ye)}),Be=!W&&x(function(){for(var Ye=new ee,pt=5;pt--;)Ye[ne](pt,pt);return!Ye.has(-0)});Ne||((q=Y(function(Ye,pt){N(Ye,H);var dt=Z(new ee,Ye,q);return U(pt)||E(pt,dt[ne],{that:dt,AS_ENTRIES:oe}),dt})).prototype=H,H.constructor=q),(je||Be)&&(Le("delete"),Le("has"),oe&&Le("get")),(Be||ge)&&Le(ne),W&&H.clear&&delete H.clear}return ve[I]=q,p({global:!0,constructor:!0,forced:q!=ee},ve),z(q,I),W||F.setStrong(q,I,oe),q}},9920:function(O,j,c){var p=c(2597),f=c(3887),T=c(1236),v=c(3070);O.exports=function(S,y,E){for(var N=f(y),C=v.f,U=T.f,M=0;M<N.length;M++){var x=N[M];p(S,x)||E&&p(E,x)||C(S,x,U(y,x))}}},4964:function(O,j,c){var p=c(5112)("match");O.exports=function(f){var T=/./;try{"/./"[f](T)}catch{try{return T[p]=!1,"/./"[f](T)}catch{}}return!1}},8544:function(O,j,c){var p=c(7293);O.exports=!p(function(){function f(){}return f.prototype.constructor=null,Object.getPrototypeOf(new f)!==f.prototype})},6178:function(O){O.exports=function(j,c){return{value:j,done:c}}},8880:function(O,j,c){var p=c(9781),f=c(3070),T=c(9114);O.exports=p?function(v,S,y){return f.f(v,S,T(1,y))}:function(v,S,y){return v[S]=y,v}},9114:function(O){O.exports=function(j,c){return{enumerable:!(1&j),configurable:!(2&j),writable:!(4&j),value:c}}},6135:function(O,j,c){var p=c(4948),f=c(3070),T=c(9114);O.exports=function(v,S,y){var E=p(S);E in v?f.f(v,E,T(0,y)):v[E]=y}},7045:function(O,j,c){var p=c(6339),f=c(3070);O.exports=function(T,v,S){return S.get&&p(S.get,v,{getter:!0}),S.set&&p(S.set,v,{setter:!0}),f.f(T,v,S)}},8052:function(O,j,c){var p=c(614),f=c(3070),T=c(6339),v=c(3072);O.exports=function(S,y,E,N){N||(N={});var C=N.enumerable,U=N.name!==void 0?N.name:y;if(p(E)&&T(E,U,N),N.global)C?S[y]=E:v(y,E);else{try{N.unsafe?S[y]&&(C=!0):delete S[y]}catch{}C?S[y]=E:f.f(S,y,{value:E,enumerable:!1,configurable:!N.nonConfigurable,writable:!N.nonWritable})}return S}},9190:function(O,j,c){var p=c(8052);O.exports=function(f,T,v){for(var S in T)p(f,S,T[S],v);return f}},3072:function(O,j,c){var p=c(7854),f=Object.defineProperty;O.exports=function(T,v){try{f(p,T,{value:v,configurable:!0,writable:!0})}catch{p[T]=v}return v}},5117:function(O,j,c){var p=c(6330),f=TypeError;O.exports=function(T,v){if(!delete T[v])throw f("Cannot delete property "+p(v)+" of "+p(T))}},9781:function(O,j,c){var p=c(7293);O.exports=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7})},4154:function(O){var j=typeof document=="object"&&document.all,c=j===void 0&&j!==void 0;O.exports={all:j,IS_HTMLDDA:c}},317:function(O,j,c){var p=c(7854),f=c(111),T=p.document,v=f(T)&&f(T.createElement);O.exports=function(S){return v?T.createElement(S):{}}},7207:function(O){var j=TypeError;O.exports=function(c){if(c>9007199254740991)throw j("Maximum allowed index exceeded");return c}},8324:function(O){O.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},8509:function(O,j,c){var p=c(317)("span").classList,f=p&&p.constructor&&p.constructor.prototype;O.exports=f===Object.prototype?void 0:f},8886:function(O,j,c){var p=c(8113).match(/firefox\/(\d+)/i);O.exports=!!p&&+p[1]},7871:function(O,j,c){var p=c(3823),f=c(5268);O.exports=!p&&!f&&typeof window=="object"&&typeof document=="object"},9363:function(O){O.exports=typeof Bun=="function"&&Bun&&typeof Bun.version=="string"},3823:function(O){O.exports=typeof Deno=="object"&&Deno&&typeof Deno.version=="object"},256:function(O,j,c){var p=c(8113);O.exports=/MSIE|Trident/.test(p)},1528:function(O,j,c){var p=c(8113);O.exports=/ipad|iphone|ipod/i.test(p)&&typeof Pebble<"u"},6833:function(O,j,c){var p=c(8113);O.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(p)},5268:function(O,j,c){var p=c(4326);O.exports=typeof process<"u"&&p(process)=="process"},1036:function(O,j,c){var p=c(8113);O.exports=/web0s(?!.*chrome)/i.test(p)},8113:function(O){O.exports=typeof navigator<"u"&&String(navigator.userAgent)||""},7392:function(O,j,c){var p,f,T=c(7854),v=c(8113),S=T.process,y=T.Deno,E=S&&S.versions||y&&y.version,N=E&&E.v8;N&&(f=(p=N.split("."))[0]>0&&p[0]<4?1:+(p[0]+p[1])),!f&&v&&(!(p=v.match(/Edge\/(\d+)/))||p[1]>=74)&&(p=v.match(/Chrome\/(\d+)/))&&(f=+p[1]),O.exports=f},8008:function(O,j,c){var p=c(8113).match(/AppleWebKit\/(\d+)\./);O.exports=!!p&&+p[1]},748:function(O){O.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},2109:function(O,j,c){var p=c(7854),f=c(1236).f,T=c(8880),v=c(8052),S=c(3072),y=c(9920),E=c(4705);O.exports=function(N,C){var U,M,x,P,z,Z=N.target,I=N.global,Y=N.stat;if(U=I?p:Y?p[Z]||S(Z,{}):(p[Z]||{}).prototype)for(M in C){if(P=C[M],x=N.dontCallGetSet?(z=f(U,M))&&z.value:U[M],!E(I?M:Z+(Y?".":"#")+M,N.forced)&&x!==void 0){if(typeof P==typeof x)continue;y(P,x)}(N.sham||x&&x.sham)&&T(P,"sham",!0),v(U,M,P,N)}}},7293:function(O){O.exports=function(j){try{return!!j()}catch{return!0}}},7007:function(O,j,c){c(4916);var p=c(1470),f=c(8052),T=c(2261),v=c(7293),S=c(5112),y=c(8880),E=S("species"),N=RegExp.prototype;O.exports=function(C,U,M,x){var P=S(C),z=!v(function(){var F={};return F[P]=function(){return 7},""[C](F)!=7}),Z=z&&!v(function(){var F=!1,oe=/a/;return C==="split"&&((oe={}).constructor={},oe.constructor[E]=function(){return oe},oe.flags="",oe[P]=/./[P]),oe.exec=function(){return F=!0,null},oe[P](""),!F});if(!z||!Z||M){var I=p(/./[P]),Y=U(P,""[C],function(F,oe,W,ne,ee){var H=p(F),q=oe.exec;return q===T||q===N.exec?z&&!ee?{done:!0,value:I(oe,W,ne)}:{done:!0,value:H(W,oe,ne)}:{done:!1}});f(String.prototype,C,Y[0]),f(N,P,Y[1])}x&&y(N[P],"sham",!0)}},6677:function(O,j,c){var p=c(7293);O.exports=!p(function(){return Object.isExtensible(Object.preventExtensions({}))})},2104:function(O,j,c){var p=c(4374),f=Function.prototype,T=f.apply,v=f.call;O.exports=typeof Reflect=="object"&&Reflect.apply||(p?v.bind(T):function(){return v.apply(T,arguments)})},9974:function(O,j,c){var p=c(1470),f=c(9662),T=c(4374),v=p(p.bind);O.exports=function(S,y){return f(S),y===void 0?S:T?v(S,y):function(){return S.apply(y,arguments)}}},4374:function(O,j,c){var p=c(7293);O.exports=!p(function(){var f=(function(){}).bind();return typeof f!="function"||f.hasOwnProperty("prototype")})},7065:function(O,j,c){var p=c(1702),f=c(9662),T=c(111),v=c(2597),S=c(206),y=c(4374),E=Function,N=p([].concat),C=p([].join),U={};O.exports=y?E.bind:function(M){var x=f(this),P=x.prototype,z=S(arguments,1),Z=function(){var I=N(z,S(arguments));return this instanceof Z?function(Y,F,oe){if(!v(U,F)){for(var W=[],ne=0;ne<F;ne++)W[ne]="a["+ne+"]";U[F]=E("C,a","return new C("+C(W,",")+")")}return U[F](Y,oe)}(x,I.length,I):x.apply(M,I)};return T(P)&&(Z.prototype=P),Z}},6916:function(O,j,c){var p=c(4374),f=Function.prototype.call;O.exports=p?f.bind(f):function(){return f.apply(f,arguments)}},6530:function(O,j,c){var p=c(9781),f=c(2597),T=Function.prototype,v=p&&Object.getOwnPropertyDescriptor,S=f(T,"name"),y=S&&(function(){}).name==="something",E=S&&(!p||p&&v(T,"name").configurable);O.exports={EXISTS:S,PROPER:y,CONFIGURABLE:E}},5668:function(O,j,c){var p=c(1702),f=c(9662);O.exports=function(T,v,S){try{return p(f(Object.getOwnPropertyDescriptor(T,v)[S]))}catch{}}},1470:function(O,j,c){var p=c(4326),f=c(1702);O.exports=function(T){if(p(T)==="Function")return f(T)}},1702:function(O,j,c){var p=c(4374),f=Function.prototype,T=f.call,v=p&&f.bind.bind(T,T);O.exports=p?v:function(S){return function(){return T.apply(S,arguments)}}},5005:function(O,j,c){var p=c(7854),f=c(614);O.exports=function(T,v){return arguments.length<2?(S=p[T],f(S)?S:void 0):p[T]&&p[T][v];var S}},1246:function(O,j,c){var p=c(648),f=c(8173),T=c(8554),v=c(7497),S=c(5112)("iterator");O.exports=function(y){if(!T(y))return f(y,S)||f(y,"@@iterator")||v[p(y)]}},4121:function(O,j,c){var p=c(6916),f=c(9662),T=c(9670),v=c(6330),S=c(1246),y=TypeError;O.exports=function(E,N){var C=arguments.length<2?S(E):N;if(f(C))return T(p(C,E));throw y(v(E)+" is not iterable")}},8044:function(O,j,c){var p=c(1702),f=c(3157),T=c(614),v=c(4326),S=c(1340),y=p([].push);O.exports=function(E){if(T(E))return E;if(f(E)){for(var N=E.length,C=[],U=0;U<N;U++){var M=E[U];typeof M=="string"?y(C,M):typeof M!="number"&&v(M)!="Number"&&v(M)!="String"||y(C,S(M))}var x=C.length,P=!0;return function(z,Z){if(P)return P=!1,Z;if(f(this))return Z;for(var I=0;I<x;I++)if(C[I]===z)return Z}}}},8173:function(O,j,c){var p=c(9662),f=c(8554);O.exports=function(T,v){var S=T[v];return f(S)?void 0:p(S)}},7854:function(O,j,c){var p=function(f){return f&&f.Math==Math&&f};O.exports=p(typeof globalThis=="object"&&globalThis)||p(typeof window=="object"&&window)||p(typeof self=="object"&&self)||p(typeof c.g=="object"&&c.g)||function(){return this}()||this||Function("return this")()},2597:function(O,j,c){var p=c(1702),f=c(7908),T=p({}.hasOwnProperty);O.exports=Object.hasOwn||function(v,S){return T(f(v),S)}},3501:function(O){O.exports={}},842:function(O){O.exports=function(j,c){try{arguments.length==1?console.error(j):console.error(j,c)}catch{}}},490:function(O,j,c){var p=c(5005);O.exports=p("document","documentElement")},4664:function(O,j,c){var p=c(9781),f=c(7293),T=c(317);O.exports=!p&&!f(function(){return Object.defineProperty(T("div"),"a",{get:function(){return 7}}).a!=7})},1179:function(O){var j=Array,c=Math.abs,p=Math.pow,f=Math.floor,T=Math.log,v=Math.LN2;O.exports={pack:function(S,y,E){var N,C,U,M=j(E),x=8*E-y-1,P=(1<<x)-1,z=P>>1,Z=y===23?p(2,-24)-p(2,-77):0,I=S<0||S===0&&1/S<0?1:0,Y=0;for((S=c(S))!=S||S===1/0?(C=S!=S?1:0,N=P):(N=f(T(S)/v),S*(U=p(2,-N))<1&&(N--,U*=2),(S+=N+z>=1?Z/U:Z*p(2,1-z))*U>=2&&(N++,U/=2),N+z>=P?(C=0,N=P):N+z>=1?(C=(S*U-1)*p(2,y),N+=z):(C=S*p(2,z-1)*p(2,y),N=0));y>=8;)M[Y++]=255&C,C/=256,y-=8;for(N=N<<y|C,x+=y;x>0;)M[Y++]=255&N,N/=256,x-=8;return M[--Y]|=128*I,M},unpack:function(S,y){var E,N=S.length,C=8*N-y-1,U=(1<<C)-1,M=U>>1,x=C-7,P=N-1,z=S[P--],Z=127&z;for(z>>=7;x>0;)Z=256*Z+S[P--],x-=8;for(E=Z&(1<<-x)-1,Z>>=-x,x+=y;x>0;)E=256*E+S[P--],x-=8;if(Z===0)Z=1-M;else{if(Z===U)return E?NaN:z?-1/0:1/0;E+=p(2,y),Z-=M}return(z?-1:1)*E*p(2,Z-y)}}},8361:function(O,j,c){var p=c(1702),f=c(7293),T=c(4326),v=Object,S=p("".split);O.exports=f(function(){return!v("z").propertyIsEnumerable(0)})?function(y){return T(y)=="String"?S(y,""):v(y)}:v},9587:function(O,j,c){var p=c(614),f=c(111),T=c(7674);O.exports=function(v,S,y){var E,N;return T&&p(E=S.constructor)&&E!==y&&f(N=E.prototype)&&N!==y.prototype&&T(v,N),v}},2788:function(O,j,c){var p=c(1702),f=c(614),T=c(5465),v=p(Function.toString);f(T.inspectSource)||(T.inspectSource=function(S){return v(S)}),O.exports=T.inspectSource},2423:function(O,j,c){var p=c(2109),f=c(1702),T=c(3501),v=c(111),S=c(2597),y=c(3070).f,E=c(8006),N=c(1156),C=c(2050),U=c(9711),M=c(6677),x=!1,P=U("meta"),z=0,Z=function(Y){y(Y,P,{value:{objectID:"O"+z++,weakData:{}}})},I=O.exports={enable:function(){I.enable=function(){},x=!0;var Y=E.f,F=f([].splice),oe={};oe[P]=1,Y(oe).length&&(E.f=function(W){for(var ne=Y(W),ee=0,H=ne.length;ee<H;ee++)if(ne[ee]===P){F(ne,ee,1);break}return ne},p({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:N.f}))},fastKey:function(Y,F){if(!v(Y))return typeof Y=="symbol"?Y:(typeof Y=="string"?"S":"P")+Y;if(!S(Y,P)){if(!C(Y))return"F";if(!F)return"E";Z(Y)}return Y[P].objectID},getWeakData:function(Y,F){if(!S(Y,P)){if(!C(Y))return!0;if(!F)return!1;Z(Y)}return Y[P].weakData},onFreeze:function(Y){return M&&x&&C(Y)&&!S(Y,P)&&Z(Y),Y}};T[P]=!0},9909:function(O,j,c){var p,f,T,v=c(4811),S=c(7854),y=c(111),E=c(8880),N=c(2597),C=c(5465),U=c(6200),M=c(3501),x="Object already initialized",P=S.TypeError,z=S.WeakMap;if(v||C.state){var Z=C.state||(C.state=new z);Z.get=Z.get,Z.has=Z.has,Z.set=Z.set,p=function(Y,F){if(Z.has(Y))throw P(x);return F.facade=Y,Z.set(Y,F),F},f=function(Y){return Z.get(Y)||{}},T=function(Y){return Z.has(Y)}}else{var I=U("state");M[I]=!0,p=function(Y,F){if(N(Y,I))throw P(x);return F.facade=Y,E(Y,I,F),F},f=function(Y){return N(Y,I)?Y[I]:{}},T=function(Y){return N(Y,I)}}O.exports={set:p,get:f,has:T,enforce:function(Y){return T(Y)?f(Y):p(Y,{})},getterFor:function(Y){return function(F){var oe;if(!y(F)||(oe=f(F)).type!==Y)throw P("Incompatible receiver, "+Y+" required");return oe}}}},7659:function(O,j,c){var p=c(5112),f=c(7497),T=p("iterator"),v=Array.prototype;O.exports=function(S){return S!==void 0&&(f.Array===S||v[T]===S)}},3157:function(O,j,c){var p=c(4326);O.exports=Array.isArray||function(f){return p(f)=="Array"}},4067:function(O,j,c){var p=c(648);O.exports=function(f){var T=p(f);return T=="BigInt64Array"||T=="BigUint64Array"}},614:function(O,j,c){var p=c(4154),f=p.all;O.exports=p.IS_HTMLDDA?function(T){return typeof T=="function"||T===f}:function(T){return typeof T=="function"}},4411:function(O,j,c){var p=c(1702),f=c(7293),T=c(614),v=c(648),S=c(5005),y=c(2788),E=function(){},N=[],C=S("Reflect","construct"),U=/^\s*(?:class|function)\b/,M=p(U.exec),x=!U.exec(E),P=function(Z){if(!T(Z))return!1;try{return C(E,N,Z),!0}catch{return!1}},z=function(Z){if(!T(Z))return!1;switch(v(Z)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return x||!!M(U,y(Z))}catch{return!0}};z.sham=!0,O.exports=!C||f(function(){var Z;return P(P.call)||!P(Object)||!P(function(){Z=!0})||Z})?z:P},4705:function(O,j,c){var p=c(7293),f=c(614),T=/#|\.prototype\./,v=function(C,U){var M=y[S(C)];return M==N||M!=E&&(f(U)?p(U):!!U)},S=v.normalize=function(C){return String(C).replace(T,".").toLowerCase()},y=v.data={},E=v.NATIVE="N",N=v.POLYFILL="P";O.exports=v},5988:function(O,j,c){var p=c(111),f=Math.floor;O.exports=Number.isInteger||function(T){return!p(T)&&isFinite(T)&&f(T)===T}},8554:function(O){O.exports=function(j){return j==null}},111:function(O,j,c){var p=c(614),f=c(4154),T=f.all;O.exports=f.IS_HTMLDDA?function(v){return typeof v=="object"?v!==null:p(v)||v===T}:function(v){return typeof v=="object"?v!==null:p(v)}},1913:function(O){O.exports=!1},7850:function(O,j,c){var p=c(111),f=c(4326),T=c(5112)("match");O.exports=function(v){var S;return p(v)&&((S=v[T])!==void 0?!!S:f(v)=="RegExp")}},2190:function(O,j,c){var p=c(5005),f=c(614),T=c(7976),v=c(3307),S=Object;O.exports=v?function(y){return typeof y=="symbol"}:function(y){var E=p("Symbol");return f(E)&&T(E.prototype,S(y))}},408:function(O,j,c){var p=c(9974),f=c(6916),T=c(9670),v=c(6330),S=c(7659),y=c(6244),E=c(7976),N=c(4121),C=c(1246),U=c(9212),M=TypeError,x=function(z,Z){this.stopped=z,this.result=Z},P=x.prototype;O.exports=function(z,Z,I){var Y,F,oe,W,ne,ee,H,q=I&&I.that,ve=!(!I||!I.AS_ENTRIES),Le=!(!I||!I.IS_RECORD),Oe=!(!I||!I.IS_ITERATOR),ge=!(!I||!I.INTERRUPTED),je=p(Z,q),Ne=function(Ye){return Y&&U(Y,"normal",Ye),new x(!0,Ye)},Be=function(Ye){return ve?(T(Ye),ge?je(Ye[0],Ye[1],Ne):je(Ye[0],Ye[1])):ge?je(Ye,Ne):je(Ye)};if(Le)Y=z.iterator;else if(Oe)Y=z;else{if(!(F=C(z)))throw M(v(z)+" is not iterable");if(S(F)){for(oe=0,W=y(z);W>oe;oe++)if((ne=Be(z[oe]))&&E(P,ne))return ne;return new x(!1)}Y=N(z,F)}for(ee=Le?z.next:Y.next;!(H=f(ee,Y)).done;){try{ne=Be(H.value)}catch(Ye){U(Y,"throw",Ye)}if(typeof ne=="object"&&ne&&E(P,ne))return ne}return new x(!1)}},9212:function(O,j,c){var p=c(6916),f=c(9670),T=c(8173);O.exports=function(v,S,y){var E,N;f(v);try{if(!(E=T(v,"return"))){if(S==="throw")throw y;return y}E=p(E,v)}catch(C){N=!0,E=C}if(S==="throw")throw y;if(N)throw E;return f(E),y}},3061:function(O,j,c){var p=c(3383).IteratorPrototype,f=c(30),T=c(9114),v=c(8003),S=c(7497),y=function(){return this};O.exports=function(E,N,C,U){var M=N+" Iterator";return E.prototype=f(p,{next:T(+!U,C)}),v(E,M,!1,!0),S[M]=y,E}},1656:function(O,j,c){var p=c(2109),f=c(6916),T=c(1913),v=c(6530),S=c(614),y=c(3061),E=c(9518),N=c(7674),C=c(8003),U=c(8880),M=c(8052),x=c(5112),P=c(7497),z=c(3383),Z=v.PROPER,I=v.CONFIGURABLE,Y=z.IteratorPrototype,F=z.BUGGY_SAFARI_ITERATORS,oe=x("iterator"),W="keys",ne="values",ee="entries",H=function(){return this};O.exports=function(q,ve,Le,Oe,ge,je,Ne){y(Le,ve,Oe);var Be,Ye,pt,dt=function(Pt){if(Pt===ge&&it)return it;if(!F&&Pt in ft)return ft[Pt];switch(Pt){case W:case ne:case ee:return function(){return new Le(this,Pt)}}return function(){return new Le(this)}},Ie=ve+" Iterator",we=!1,ft=q.prototype,qe=ft[oe]||ft["@@iterator"]||ge&&ft[ge],it=!F&&qe||dt(ge),Tt=ve=="Array"&&ft.entries||qe;if(Tt&&(Be=E(Tt.call(new q)))!==Object.prototype&&Be.next&&(T||E(Be)===Y||(N?N(Be,Y):S(Be[oe])||M(Be,oe,H)),C(Be,Ie,!0,!0),T&&(P[Ie]=H)),Z&&ge==ne&&qe&&qe.name!==ne&&(!T&&I?U(ft,"name",ne):(we=!0,it=function(){return f(qe,this)})),ge)if(Ye={values:dt(ne),keys:je?it:dt(W),entries:dt(ee)},Ne)for(pt in Ye)(F||we||!(pt in ft))&&M(ft,pt,Ye[pt]);else p({target:ve,proto:!0,forced:F||we},Ye);return T&&!Ne||ft[oe]===it||M(ft,oe,it,{name:ge}),P[ve]=it,Ye}},3383:function(O,j,c){var p,f,T,v=c(7293),S=c(614),y=c(111),E=c(30),N=c(9518),C=c(8052),U=c(5112),M=c(1913),x=U("iterator"),P=!1;[].keys&&("next"in(T=[].keys())?(f=N(N(T)))!==Object.prototype&&(p=f):P=!0),!y(p)||v(function(){var z={};return p[x].call(z)!==z})?p={}:M&&(p=E(p)),S(p[x])||C(p,x,function(){return this}),O.exports={IteratorPrototype:p,BUGGY_SAFARI_ITERATORS:P}},7497:function(O){O.exports={}},6244:function(O,j,c){var p=c(7466);O.exports=function(f){return p(f.length)}},6339:function(O,j,c){var p=c(1702),f=c(7293),T=c(614),v=c(2597),S=c(9781),y=c(6530).CONFIGURABLE,E=c(2788),N=c(9909),C=N.enforce,U=N.get,M=String,x=Object.defineProperty,P=p("".slice),z=p("".replace),Z=p([].join),I=S&&!f(function(){return x(function(){},"length",{value:8}).length!==8}),Y=String(String).split("String"),F=O.exports=function(oe,W,ne){P(M(W),0,7)==="Symbol("&&(W="["+z(M(W),/^Symbol\(([^)]*)\)/,"$1")+"]"),ne&&ne.getter&&(W="get "+W),ne&&ne.setter&&(W="set "+W),(!v(oe,"name")||y&&oe.name!==W)&&(S?x(oe,"name",{value:W,configurable:!0}):oe.name=W),I&&ne&&v(ne,"arity")&&oe.length!==ne.arity&&x(oe,"length",{value:ne.arity});try{ne&&v(ne,"constructor")&&ne.constructor?S&&x(oe,"prototype",{writable:!1}):oe.prototype&&(oe.prototype=void 0)}catch{}var ee=C(oe);return v(ee,"source")||(ee.source=Z(Y,typeof W=="string"?W:"")),oe};Function.prototype.toString=F(function(){return T(this)&&U(this).source||E(this)},"toString")},4758:function(O){var j=Math.ceil,c=Math.floor;O.exports=Math.trunc||function(p){var f=+p;return(f>0?c:j)(f)}},5948:function(O,j,c){var p,f,T,v,S,y=c(7854),E=c(9974),N=c(1236).f,C=c(261).set,U=c(8572),M=c(6833),x=c(1528),P=c(1036),z=c(5268),Z=y.MutationObserver||y.WebKitMutationObserver,I=y.document,Y=y.process,F=y.Promise,oe=N(y,"queueMicrotask"),W=oe&&oe.value;if(!W){var ne=new U,ee=function(){var H,q;for(z&&(H=Y.domain)&&H.exit();q=ne.get();)try{q()}catch(ve){throw ne.head&&p(),ve}H&&H.enter()};M||z||P||!Z||!I?!x&&F&&F.resolve?((v=F.resolve(void 0)).constructor=F,S=E(v.then,v),p=function(){S(ee)}):z?p=function(){Y.nextTick(ee)}:(C=E(C,y),p=function(){C(ee)}):(f=!0,T=I.createTextNode(""),new Z(ee).observe(T,{characterData:!0}),p=function(){T.data=f=!f}),W=function(H){ne.head||p(),ne.add(H)}}O.exports=W},8523:function(O,j,c){var p=c(9662),f=TypeError,T=function(v){var S,y;this.promise=new v(function(E,N){if(S!==void 0||y!==void 0)throw f("Bad Promise constructor");S=E,y=N}),this.resolve=p(S),this.reject=p(y)};O.exports.f=function(v){return new T(v)}},3929:function(O,j,c){var p=c(7850),f=TypeError;O.exports=function(T){if(p(T))throw f("The method doesn't accept regular expressions");return T}},1574:function(O,j,c){var p=c(9781),f=c(1702),T=c(6916),v=c(7293),S=c(1956),y=c(5181),E=c(5296),N=c(7908),C=c(8361),U=Object.assign,M=Object.defineProperty,x=f([].concat);O.exports=!U||v(function(){if(p&&U({b:1},U(M({},"a",{enumerable:!0,get:function(){M(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var P={},z={},Z=Symbol(),I="abcdefghijklmnopqrst";return P[Z]=7,I.split("").forEach(function(Y){z[Y]=Y}),U({},P)[Z]!=7||S(U({},z)).join("")!=I})?function(P,z){for(var Z=N(P),I=arguments.length,Y=1,F=y.f,oe=E.f;I>Y;)for(var W,ne=C(arguments[Y++]),ee=F?x(S(ne),F(ne)):S(ne),H=ee.length,q=0;H>q;)W=ee[q++],p&&!T(oe,ne,W)||(Z[W]=ne[W]);return Z}:U},30:function(O,j,c){var p,f=c(9670),T=c(6048),v=c(748),S=c(3501),y=c(490),E=c(317),N=c(6200),C="prototype",U="script",M=N("IE_PROTO"),x=function(){},P=function(I){return"<"+U+">"+I+"</"+U+">"},z=function(I){I.write(P("")),I.close();var Y=I.parentWindow.Object;return I=null,Y},Z=function(){try{p=new ActiveXObject("htmlfile")}catch{}var I,Y,F;Z=typeof document<"u"?document.domain&&p?z(p):(Y=E("iframe"),F="java"+U+":",Y.style.display="none",y.appendChild(Y),Y.src=String(F),(I=Y.contentWindow.document).open(),I.write(P("document.F=Object")),I.close(),I.F):z(p);for(var oe=v.length;oe--;)delete Z[C][v[oe]];return Z()};S[M]=!0,O.exports=Object.create||function(I,Y){var F;return I!==null?(x[C]=f(I),F=new x,x[C]=null,F[M]=I):F=Z(),Y===void 0?F:T.f(F,Y)}},6048:function(O,j,c){var p=c(9781),f=c(3353),T=c(3070),v=c(9670),S=c(5656),y=c(1956);j.f=p&&!f?Object.defineProperties:function(E,N){v(E);for(var C,U=S(N),M=y(N),x=M.length,P=0;x>P;)T.f(E,C=M[P++],U[C]);return E}},3070:function(O,j,c){var p=c(9781),f=c(4664),T=c(3353),v=c(9670),S=c(4948),y=TypeError,E=Object.defineProperty,N=Object.getOwnPropertyDescriptor,C="enumerable",U="configurable",M="writable";j.f=p?T?function(x,P,z){if(v(x),P=S(P),v(z),typeof x=="function"&&P==="prototype"&&"value"in z&&M in z&&!z[M]){var Z=N(x,P);Z&&Z[M]&&(x[P]=z.value,z={configurable:U in z?z[U]:Z[U],enumerable:C in z?z[C]:Z[C],writable:!1})}return E(x,P,z)}:E:function(x,P,z){if(v(x),P=S(P),v(z),f)try{return E(x,P,z)}catch{}if("get"in z||"set"in z)throw y("Accessors not supported");return"value"in z&&(x[P]=z.value),x}},1236:function(O,j,c){var p=c(9781),f=c(6916),T=c(5296),v=c(9114),S=c(5656),y=c(4948),E=c(2597),N=c(4664),C=Object.getOwnPropertyDescriptor;j.f=p?C:function(U,M){if(U=S(U),M=y(M),N)try{return C(U,M)}catch{}if(E(U,M))return v(!f(T.f,U,M),U[M])}},1156:function(O,j,c){var p=c(4326),f=c(5656),T=c(8006).f,v=c(1589),S=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];O.exports.f=function(y){return S&&p(y)=="Window"?function(E){try{return T(E)}catch{return v(S)}}(y):T(f(y))}},8006:function(O,j,c){var p=c(6324),f=c(748).concat("length","prototype");j.f=Object.getOwnPropertyNames||function(T){return p(T,f)}},5181:function(O,j){j.f=Object.getOwnPropertySymbols},9518:function(O,j,c){var p=c(2597),f=c(614),T=c(7908),v=c(6200),S=c(8544),y=v("IE_PROTO"),E=Object,N=E.prototype;O.exports=S?E.getPrototypeOf:function(C){var U=T(C);if(p(U,y))return U[y];var M=U.constructor;return f(M)&&U instanceof M?M.prototype:U instanceof E?N:null}},2050:function(O,j,c){var p=c(7293),f=c(111),T=c(4326),v=c(7556),S=Object.isExtensible,y=p(function(){});O.exports=y||v?function(E){return!!f(E)&&(!v||T(E)!="ArrayBuffer")&&(!S||S(E))}:S},7976:function(O,j,c){var p=c(1702);O.exports=p({}.isPrototypeOf)},6324:function(O,j,c){var p=c(1702),f=c(2597),T=c(5656),v=c(1318).indexOf,S=c(3501),y=p([].push);O.exports=function(E,N){var C,U=T(E),M=0,x=[];for(C in U)!f(S,C)&&f(U,C)&&y(x,C);for(;N.length>M;)f(U,C=N[M++])&&(~v(x,C)||y(x,C));return x}},1956:function(O,j,c){var p=c(6324),f=c(748);O.exports=Object.keys||function(T){return p(T,f)}},5296:function(O,j){var c={}.propertyIsEnumerable,p=Object.getOwnPropertyDescriptor,f=p&&!c.call({1:2},1);j.f=f?function(T){var v=p(this,T);return!!v&&v.enumerable}:c},7674:function(O,j,c){var p=c(5668),f=c(9670),T=c(6077);O.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var v,S=!1,y={};try{(v=p(Object.prototype,"__proto__","set"))(y,[]),S=y instanceof Array}catch{}return function(E,N){return f(E),T(N),S?v(E,N):E.__proto__=N,E}}():void 0)},4699:function(O,j,c){var p=c(9781),f=c(1702),T=c(1956),v=c(5656),S=f(c(5296).f),y=f([].push),E=function(N){return function(C){for(var U,M=v(C),x=T(M),P=x.length,z=0,Z=[];P>z;)U=x[z++],p&&!S(M,U)||y(Z,N?[U,M[U]]:M[U]);return Z}};O.exports={entries:E(!0),values:E(!1)}},288:function(O,j,c){var p=c(1694),f=c(648);O.exports=p?{}.toString:function(){return"[object "+f(this)+"]"}},2140:function(O,j,c){var p=c(6916),f=c(614),T=c(111),v=TypeError;O.exports=function(S,y){var E,N;if(y==="string"&&f(E=S.toString)&&!T(N=p(E,S))||f(E=S.valueOf)&&!T(N=p(E,S))||y!=="string"&&f(E=S.toString)&&!T(N=p(E,S)))return N;throw v("Can't convert object to primitive value")}},3887:function(O,j,c){var p=c(5005),f=c(1702),T=c(8006),v=c(5181),S=c(9670),y=f([].concat);O.exports=p("Reflect","ownKeys")||function(E){var N=T.f(S(E)),C=v.f;return C?y(N,C(E)):N}},857:function(O,j,c){var p=c(7854);O.exports=p},2534:function(O){O.exports=function(j){try{return{error:!1,value:j()}}catch(c){return{error:!0,value:c}}}},3702:function(O,j,c){var p=c(7854),f=c(2492),T=c(614),v=c(4705),S=c(2788),y=c(5112),E=c(7871),N=c(3823),C=c(1913),U=c(7392),M=f&&f.prototype,x=y("species"),P=!1,z=T(p.PromiseRejectionEvent),Z=v("Promise",function(){var I=S(f),Y=I!==String(f);if(!Y&&U===66||C&&(!M.catch||!M.finally))return!0;if(!U||U<51||!/native code/.test(I)){var F=new f(function(W){W(1)}),oe=function(W){W(function(){},function(){})};if((F.constructor={})[x]=oe,!(P=F.then(function(){})instanceof oe))return!0}return!Y&&(E||N)&&!z});O.exports={CONSTRUCTOR:Z,REJECTION_EVENT:z,SUBCLASSING:P}},2492:function(O,j,c){var p=c(7854);O.exports=p.Promise},9478:function(O,j,c){var p=c(9670),f=c(111),T=c(8523);O.exports=function(v,S){if(p(v),f(S)&&S.constructor===v)return S;var y=T.f(v);return(0,y.resolve)(S),y.promise}},612:function(O,j,c){var p=c(2492),f=c(7072),T=c(3702).CONSTRUCTOR;O.exports=T||!f(function(v){p.all(v).then(void 0,function(){})})},8572:function(O){var j=function(){this.head=null,this.tail=null};j.prototype={add:function(c){var p={item:c,next:null},f=this.tail;f?f.next=p:this.head=p,this.tail=p},get:function(){var c=this.head;if(c)return(this.head=c.next)===null&&(this.tail=null),c.item}},O.exports=j},7651:function(O,j,c){var p=c(6916),f=c(9670),T=c(614),v=c(4326),S=c(2261),y=TypeError;O.exports=function(E,N){var C=E.exec;if(T(C)){var U=p(C,E,N);return U!==null&&f(U),U}if(v(E)==="RegExp")return p(S,E,N);throw y("RegExp#exec called on incompatible receiver")}},2261:function(O,j,c){var p,f,T=c(6916),v=c(1702),S=c(1340),y=c(7066),E=c(2999),N=c(2309),C=c(30),U=c(9909).get,M=c(9441),x=c(7168),P=N("native-string-replace",String.prototype.replace),z=RegExp.prototype.exec,Z=z,I=v("".charAt),Y=v("".indexOf),F=v("".replace),oe=v("".slice),W=(f=/b*/g,T(z,p=/a/,"a"),T(z,f,"a"),p.lastIndex!==0||f.lastIndex!==0),ne=E.BROKEN_CARET,ee=/()??/.exec("")[1]!==void 0;(W||ee||ne||M||x)&&(Z=function(H){var q,ve,Le,Oe,ge,je,Ne,Be=this,Ye=U(Be),pt=S(H),dt=Ye.raw;if(dt)return dt.lastIndex=Be.lastIndex,q=T(Z,dt,pt),Be.lastIndex=dt.lastIndex,q;var Ie=Ye.groups,we=ne&&Be.sticky,ft=T(y,Be),qe=Be.source,it=0,Tt=pt;if(we&&(ft=F(ft,"y",""),Y(ft,"g")===-1&&(ft+="g"),Tt=oe(pt,Be.lastIndex),Be.lastIndex>0&&(!Be.multiline||Be.multiline&&I(pt,Be.lastIndex-1)!==`
`)&&(qe="(?: "+qe+")",Tt=" "+Tt,it++),ve=new RegExp("^(?:"+qe+")",ft)),ee&&(ve=new RegExp("^"+qe+"$(?!\\s)",ft)),W&&(Le=Be.lastIndex),Oe=T(z,we?ve:Be,Tt),we?Oe?(Oe.input=oe(Oe.input,it),Oe[0]=oe(Oe[0],it),Oe.index=Be.lastIndex,Be.lastIndex+=Oe[0].length):Be.lastIndex=0:W&&Oe&&(Be.lastIndex=Be.global?Oe.index+Oe[0].length:Le),ee&&Oe&&Oe.length>1&&T(P,Oe[0],ve,function(){for(ge=1;ge<arguments.length-2;ge++)arguments[ge]===void 0&&(Oe[ge]=void 0)}),Oe&&Ie)for(Oe.groups=je=C(null),ge=0;ge<Ie.length;ge++)je[(Ne=Ie[ge])[0]]=Oe[Ne[1]];return Oe}),O.exports=Z},7066:function(O,j,c){var p=c(9670);O.exports=function(){var f=p(this),T="";return f.hasIndices&&(T+="d"),f.global&&(T+="g"),f.ignoreCase&&(T+="i"),f.multiline&&(T+="m"),f.dotAll&&(T+="s"),f.unicode&&(T+="u"),f.unicodeSets&&(T+="v"),f.sticky&&(T+="y"),T}},4706:function(O,j,c){var p=c(6916),f=c(2597),T=c(7976),v=c(7066),S=RegExp.prototype;O.exports=function(y){var E=y.flags;return E!==void 0||"flags"in S||f(y,"flags")||!T(S,y)?E:p(v,y)}},2999:function(O,j,c){var p=c(7293),f=c(7854).RegExp,T=p(function(){var y=f("a","y");return y.lastIndex=2,y.exec("abcd")!=null}),v=T||p(function(){return!f("a","y").sticky}),S=T||p(function(){var y=f("^r","gy");return y.lastIndex=2,y.exec("str")!=null});O.exports={BROKEN_CARET:S,MISSED_STICKY:v,UNSUPPORTED_Y:T}},9441:function(O,j,c){var p=c(7293),f=c(7854).RegExp;O.exports=p(function(){var T=f(".","s");return!(T.dotAll&&T.exec(`
`)&&T.flags==="s")})},7168:function(O,j,c){var p=c(7293),f=c(7854).RegExp;O.exports=p(function(){var T=f("(?<a>b)","g");return T.exec("b").groups.a!=="b"||"b".replace(T,"$<a>c")!=="bc"})},4488:function(O,j,c){var p=c(8554),f=TypeError;O.exports=function(T){if(p(T))throw f("Can't call method on "+T);return T}},7152:function(O,j,c){var p,f=c(7854),T=c(2104),v=c(614),S=c(9363),y=c(8113),E=c(206),N=c(8053),C=f.Function,U=/MSIE .\./.test(y)||S&&((p=f.Bun.version.split(".")).length<3||p[0]==0&&(p[1]<3||p[1]==3&&p[2]==0));O.exports=function(M,x){var P=x?2:1;return U?function(z,Z){var I=N(arguments.length,1)>P,Y=v(z)?z:C(z),F=I?E(arguments,P):[],oe=I?function(){T(Y,this,F)}:Y;return x?M(oe,Z):M(oe)}:M}},6340:function(O,j,c){var p=c(5005),f=c(7045),T=c(5112),v=c(9781),S=T("species");O.exports=function(y){var E=p(y);v&&E&&!E[S]&&f(E,S,{configurable:!0,get:function(){return this}})}},8003:function(O,j,c){var p=c(3070).f,f=c(2597),T=c(5112)("toStringTag");O.exports=function(v,S,y){v&&!y&&(v=v.prototype),v&&!f(v,T)&&p(v,T,{configurable:!0,value:S})}},6200:function(O,j,c){var p=c(2309),f=c(9711),T=p("keys");O.exports=function(v){return T[v]||(T[v]=f(v))}},5465:function(O,j,c){var p=c(7854),f=c(3072),T="__core-js_shared__",v=p[T]||f(T,{});O.exports=v},2309:function(O,j,c){var p=c(1913),f=c(5465);(O.exports=function(T,v){return f[T]||(f[T]=v!==void 0?v:{})})("versions",[]).push({version:"3.30.2",mode:p?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"})},6707:function(O,j,c){var p=c(9670),f=c(9483),T=c(8554),v=c(5112)("species");O.exports=function(S,y){var E,N=p(S).constructor;return N===void 0||T(E=p(N)[v])?y:f(E)}},8710:function(O,j,c){var p=c(1702),f=c(9303),T=c(1340),v=c(4488),S=p("".charAt),y=p("".charCodeAt),E=p("".slice),N=function(C){return function(U,M){var x,P,z=T(v(U)),Z=f(M),I=z.length;return Z<0||Z>=I?C?"":void 0:(x=y(z,Z))<55296||x>56319||Z+1===I||(P=y(z,Z+1))<56320||P>57343?C?S(z,Z):x:C?E(z,Z,Z+2):P-56320+(x-55296<<10)+65536}};O.exports={codeAt:N(!1),charAt:N(!0)}},3197:function(O,j,c){var p=c(1702),f=2147483647,T=/[^\0-\u007E]/,v=/[.\u3002\uFF0E\uFF61]/g,S="Overflow: input needs wider integers to process",y=RangeError,E=p(v.exec),N=Math.floor,C=String.fromCharCode,U=p("".charCodeAt),M=p([].join),x=p([].push),P=p("".replace),z=p("".split),Z=p("".toLowerCase),I=function(oe){return oe+22+75*(oe<26)},Y=function(oe,W,ne){var ee=0;for(oe=ne?N(oe/700):oe>>1,oe+=N(oe/W);oe>455;)oe=N(oe/35),ee+=36;return N(ee+36*oe/(oe+38))},F=function(oe){var W=[];oe=function(we){for(var ft=[],qe=0,it=we.length;qe<it;){var Tt=U(we,qe++);if(Tt>=55296&&Tt<=56319&&qe<it){var Pt=U(we,qe++);(64512&Pt)==56320?x(ft,((1023&Tt)<<10)+(1023&Pt)+65536):(x(ft,Tt),qe--)}else x(ft,Tt)}return ft}(oe);var ne,ee,H=oe.length,q=128,ve=0,Le=72;for(ne=0;ne<oe.length;ne++)(ee=oe[ne])<128&&x(W,C(ee));var Oe=W.length,ge=Oe;for(Oe&&x(W,"-");ge<H;){var je=f;for(ne=0;ne<oe.length;ne++)(ee=oe[ne])>=q&&ee<je&&(je=ee);var Ne=ge+1;if(je-q>N((f-ve)/Ne))throw y(S);for(ve+=(je-q)*Ne,q=je,ne=0;ne<oe.length;ne++){if((ee=oe[ne])<q&&++ve>f)throw y(S);if(ee==q){for(var Be=ve,Ye=36;;){var pt=Ye<=Le?1:Ye>=Le+26?26:Ye-Le;if(Be<pt)break;var dt=Be-pt,Ie=36-pt;x(W,C(I(pt+dt%Ie))),Be=N(dt/Ie),Ye+=36}x(W,C(I(Be))),Le=Y(ve,Ne,ge==Oe),ve=0,ge++}}ve++,q++}return M(W,"")};O.exports=function(oe){var W,ne,ee=[],H=z(P(Z(oe),v,"."),".");for(W=0;W<H.length;W++)ne=H[W],x(ee,E(T,ne)?"xn--"+F(ne):ne);return M(ee,".")}},3111:function(O,j,c){var p=c(1702),f=c(4488),T=c(1340),v=c(1361),S=p("".replace),y=RegExp("^["+v+"]+"),E=RegExp("(^|[^"+v+"])["+v+"]+$"),N=function(C){return function(U){var M=T(f(U));return 1&C&&(M=S(M,y,"")),2&C&&(M=S(M,E,"$1")),M}};O.exports={start:N(1),end:N(2),trim:N(3)}},6293:function(O,j,c){var p=c(7392),f=c(7293),T=c(7854).String;O.exports=!!Object.getOwnPropertySymbols&&!f(function(){var v=Symbol();return!T(v)||!(Object(v)instanceof Symbol)||!Symbol.sham&&p&&p<41})},6532:function(O,j,c){var p=c(6916),f=c(5005),T=c(5112),v=c(8052);O.exports=function(){var S=f("Symbol"),y=S&&S.prototype,E=y&&y.valueOf,N=T("toPrimitive");y&&!y[N]&&v(y,N,function(C){return p(E,this)},{arity:1})}},2015:function(O,j,c){var p=c(6293);O.exports=p&&!!Symbol.for&&!!Symbol.keyFor},261:function(O,j,c){var p,f,T,v,S=c(7854),y=c(2104),E=c(9974),N=c(614),C=c(2597),U=c(7293),M=c(490),x=c(206),P=c(317),z=c(8053),Z=c(6833),I=c(5268),Y=S.setImmediate,F=S.clearImmediate,oe=S.process,W=S.Dispatch,ne=S.Function,ee=S.MessageChannel,H=S.String,q=0,ve={},Le="onreadystatechange";U(function(){p=S.location});var Oe=function(Be){if(C(ve,Be)){var Ye=ve[Be];delete ve[Be],Ye()}},ge=function(Be){return function(){Oe(Be)}},je=function(Be){Oe(Be.data)},Ne=function(Be){S.postMessage(H(Be),p.protocol+"//"+p.host)};Y&&F||(Y=function(Be){z(arguments.length,1);var Ye=N(Be)?Be:ne(Be),pt=x(arguments,1);return ve[++q]=function(){y(Ye,void 0,pt)},f(q),q},F=function(Be){delete ve[Be]},I?f=function(Be){oe.nextTick(ge(Be))}:W&&W.now?f=function(Be){W.now(ge(Be))}:ee&&!Z?(v=(T=new ee).port2,T.port1.onmessage=je,f=E(v.postMessage,v)):S.addEventListener&&N(S.postMessage)&&!S.importScripts&&p&&p.protocol!=="file:"&&!U(Ne)?(f=Ne,S.addEventListener("message",je,!1)):f=Le in P("script")?function(Be){M.appendChild(P("script"))[Le]=function(){M.removeChild(this),Oe(Be)}}:function(Be){setTimeout(ge(Be),0)}),O.exports={set:Y,clear:F}},863:function(O,j,c){var p=c(1702);O.exports=p(1 .valueOf)},1400:function(O,j,c){var p=c(9303),f=Math.max,T=Math.min;O.exports=function(v,S){var y=p(v);return y<0?f(y+S,0):T(y,S)}},4599:function(O,j,c){var p=c(7593),f=TypeError;O.exports=function(T){var v=p(T,"number");if(typeof v=="number")throw f("Can't convert number to bigint");return BigInt(v)}},7067:function(O,j,c){var p=c(9303),f=c(7466),T=RangeError;O.exports=function(v){if(v===void 0)return 0;var S=p(v),y=f(S);if(S!==y)throw T("Wrong length or index");return y}},5656:function(O,j,c){var p=c(8361),f=c(4488);O.exports=function(T){return p(f(T))}},9303:function(O,j,c){var p=c(4758);O.exports=function(f){var T=+f;return T!=T||T===0?0:p(T)}},7466:function(O,j,c){var p=c(9303),f=Math.min;O.exports=function(T){return T>0?f(p(T),9007199254740991):0}},7908:function(O,j,c){var p=c(4488),f=Object;O.exports=function(T){return f(p(T))}},4590:function(O,j,c){var p=c(3002),f=RangeError;O.exports=function(T,v){var S=p(T);if(S%v)throw f("Wrong offset");return S}},3002:function(O,j,c){var p=c(9303),f=RangeError;O.exports=function(T){var v=p(T);if(v<0)throw f("The argument can't be less than 0");return v}},7593:function(O,j,c){var p=c(6916),f=c(111),T=c(2190),v=c(8173),S=c(2140),y=c(5112),E=TypeError,N=y("toPrimitive");O.exports=function(C,U){if(!f(C)||T(C))return C;var M,x=v(C,N);if(x){if(U===void 0&&(U="default"),M=p(x,C,U),!f(M)||T(M))return M;throw E("Can't convert object to primitive value")}return U===void 0&&(U="number"),S(C,U)}},4948:function(O,j,c){var p=c(7593),f=c(2190);O.exports=function(T){var v=p(T,"string");return f(v)?v:v+""}},1694:function(O,j,c){var p={};p[c(5112)("toStringTag")]="z",O.exports=String(p)==="[object z]"},1340:function(O,j,c){var p=c(648),f=String;O.exports=function(T){if(p(T)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return f(T)}},6330:function(O){var j=String;O.exports=function(c){try{return j(c)}catch{return"Object"}}},9843:function(O,j,c){var p=c(2109),f=c(7854),T=c(6916),v=c(9781),S=c(3832),y=c(260),E=c(3331),N=c(5787),C=c(9114),U=c(8880),M=c(5988),x=c(7466),P=c(7067),z=c(4590),Z=c(4948),I=c(2597),Y=c(648),F=c(111),oe=c(2190),W=c(30),ne=c(7976),ee=c(7674),H=c(8006).f,q=c(7321),ve=c(2092).forEach,Le=c(6340),Oe=c(7045),ge=c(3070),je=c(1236),Ne=c(9909),Be=c(9587),Ye=Ne.get,pt=Ne.set,dt=Ne.enforce,Ie=ge.f,we=je.f,ft=Math.round,qe=f.RangeError,it=E.ArrayBuffer,Tt=it.prototype,Pt=E.DataView,bt=y.NATIVE_ARRAY_BUFFER_VIEWS,jt=y.TYPED_ARRAY_TAG,Lt=y.TypedArray,Gt=y.TypedArrayPrototype,pr=y.aTypedArrayConstructor,ir=y.isTypedArray,Ar="BYTES_PER_ELEMENT",er="Wrong length",yt=function(Kt,At){pr(Kt);for(var vt=0,zt=At.length,vr=new Kt(zt);zt>vt;)vr[vt]=At[vt++];return vr},Xt=function(Kt,At){Oe(Kt,At,{configurable:!0,get:function(){return Ye(this)[At]}})},Ir=function(Kt){var At;return ne(Tt,Kt)||(At=Y(Kt))=="ArrayBuffer"||At=="SharedArrayBuffer"},St=function(Kt,At){return ir(Kt)&&!oe(At)&&At in Kt&&M(+At)&&At>=0},Wt=function(Kt,At){return At=Z(At),St(Kt,At)?C(2,Kt[At]):we(Kt,At)},Zt=function(Kt,At,vt){return At=Z(At),!(St(Kt,At)&&F(vt)&&I(vt,"value"))||I(vt,"get")||I(vt,"set")||vt.configurable||I(vt,"writable")&&!vt.writable||I(vt,"enumerable")&&!vt.enumerable?Ie(Kt,At,vt):(Kt[At]=vt.value,Kt)};v?(bt||(je.f=Wt,ge.f=Zt,Xt(Gt,"buffer"),Xt(Gt,"byteOffset"),Xt(Gt,"byteLength"),Xt(Gt,"length")),p({target:"Object",stat:!0,forced:!bt},{getOwnPropertyDescriptor:Wt,defineProperty:Zt}),O.exports=function(Kt,At,vt){var zt=Kt.match(/\d+/)[0]/8,vr=Kt+(vt?"Clamped":"")+"Array",or="get"+Kt,mr="set"+Kt,ae=f[vr],Ae=ae,le=Ae&&Ae.prototype,Xe={},X=function(Me,He){Ie(Me,He,{get:function(){return function(Qe,ht){var rt=Ye(Qe);return rt.view[or](ht*zt+rt.byteOffset,!0)}(this,He)},set:function(Qe){return function(ht,rt,Ct){var xt=Ye(ht);vt&&(Ct=(Ct=ft(Ct))<0?0:Ct>255?255:255&Ct),xt.view[mr](rt*zt+xt.byteOffset,Ct,!0)}(this,He,Qe)},enumerable:!0})};bt?S&&(Ae=At(function(Me,He,Qe,ht){return N(Me,le),Be(F(He)?Ir(He)?ht!==void 0?new ae(He,z(Qe,zt),ht):Qe!==void 0?new ae(He,z(Qe,zt)):new ae(He):ir(He)?yt(Ae,He):T(q,Ae,He):new ae(P(He)),Me,Ae)}),ee&&ee(Ae,Lt),ve(H(ae),function(Me){Me in Ae||U(Ae,Me,ae[Me])}),Ae.prototype=le):(Ae=At(function(Me,He,Qe,ht){N(Me,le);var rt,Ct,xt,Nt=0,yr=0;if(F(He)){if(!Ir(He))return ir(He)?yt(Ae,He):T(q,Ae,He);rt=He,yr=z(Qe,zt);var w=He.byteLength;if(ht===void 0){if(w%zt||(Ct=w-yr)<0)throw qe(er)}else if((Ct=x(ht)*zt)+yr>w)throw qe(er);xt=Ct/zt}else xt=P(He),rt=new it(Ct=xt*zt);for(pt(Me,{buffer:rt,byteOffset:yr,byteLength:Ct,length:xt,view:new Pt(rt)});Nt<xt;)X(Me,Nt++)}),ee&&ee(Ae,Lt),le=Ae.prototype=W(Gt)),le.constructor!==Ae&&U(le,"constructor",Ae),dt(le).TypedArrayConstructor=Ae,jt&&U(le,jt,vr);var et=Ae!=ae;Xe[vr]=Ae,p({global:!0,constructor:!0,forced:et,sham:!bt},Xe),Ar in Ae||U(Ae,Ar,zt),Ar in le||U(le,Ar,zt),Le(vr)}):O.exports=function(){}},3832:function(O,j,c){var p=c(7854),f=c(7293),T=c(7072),v=c(260).NATIVE_ARRAY_BUFFER_VIEWS,S=p.ArrayBuffer,y=p.Int8Array;O.exports=!v||!f(function(){y(1)})||!f(function(){new y(-1)})||!T(function(E){new y,new y(null),new y(1.5),new y(E)},!0)||f(function(){return new y(new S(2),1,void 0).length!==1})},3074:function(O,j,c){var p=c(7745),f=c(6304);O.exports=function(T,v){return p(f(T),v)}},7321:function(O,j,c){var p=c(9974),f=c(6916),T=c(9483),v=c(7908),S=c(6244),y=c(4121),E=c(1246),N=c(7659),C=c(4067),U=c(260).aTypedArrayConstructor,M=c(4599);O.exports=function(x){var P,z,Z,I,Y,F,oe,W,ne=T(this),ee=v(x),H=arguments.length,q=H>1?arguments[1]:void 0,ve=q!==void 0,Le=E(ee);if(Le&&!N(Le))for(W=(oe=y(ee,Le)).next,ee=[];!(F=f(W,oe)).done;)ee.push(F.value);for(ve&&H>2&&(q=p(q,arguments[2])),z=S(ee),Z=new(U(ne))(z),I=C(Z),P=0;z>P;P++)Y=ve?q(ee[P],P):ee[P],Z[P]=I?M(Y):+Y;return Z}},6304:function(O,j,c){var p=c(260),f=c(6707),T=p.aTypedArrayConstructor,v=p.getTypedArrayConstructor;O.exports=function(S){return T(f(S,v(S)))}},9711:function(O,j,c){var p=c(1702),f=0,T=Math.random(),v=p(1 .toString);O.exports=function(S){return"Symbol("+(S===void 0?"":S)+")_"+v(++f+T,36)}},5143:function(O,j,c){var p=c(7293),f=c(5112),T=c(9781),v=c(1913),S=f("iterator");O.exports=!p(function(){var y=new URL("b?a=1&b=2&c=3","http://a"),E=y.searchParams,N="";return y.pathname="c%20d",E.forEach(function(C,U){E.delete("b"),N+=U+C}),v&&!y.toJSON||!E.size&&(v||!T)||!E.sort||y.href!=="http://a/c%20d?a=1&c=3"||E.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!E[S]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||N!=="a1c3"||new URL("http://x",void 0).host!=="x"})},3307:function(O,j,c){var p=c(6293);O.exports=p&&!Symbol.sham&&typeof Symbol.iterator=="symbol"},3353:function(O,j,c){var p=c(9781),f=c(7293);O.exports=p&&f(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42})},8053:function(O){var j=TypeError;O.exports=function(c,p){if(c<p)throw j("Not enough arguments");return c}},4811:function(O,j,c){var p=c(7854),f=c(614),T=p.WeakMap;O.exports=f(T)&&/native code/.test(String(T))},6800:function(O,j,c){var p=c(857),f=c(2597),T=c(6061),v=c(3070).f;O.exports=function(S){var y=p.Symbol||(p.Symbol={});f(y,S)||v(y,S,{value:T.f(S)})}},6061:function(O,j,c){var p=c(5112);j.f=p},5112:function(O,j,c){var p=c(7854),f=c(2309),T=c(2597),v=c(9711),S=c(6293),y=c(3307),E=p.Symbol,N=f("wks"),C=y?E.for||E:E&&E.withoutSetter||v;O.exports=function(U){return T(N,U)||(N[U]=S&&T(E,U)?E[U]:C("Symbol."+U)),N[U]}},1361:function(O){O.exports=`	
\v\f\r                　\u2028\u2029\uFEFF`},9575:function(O,j,c){var p=c(2109),f=c(1470),T=c(7293),v=c(3331),S=c(9670),y=c(1400),E=c(7466),N=c(6707),C=v.ArrayBuffer,U=v.DataView,M=U.prototype,x=f(C.prototype.slice),P=f(M.getUint8),z=f(M.setUint8);p({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:T(function(){return!new C(2).slice(1,void 0).byteLength})},{slice:function(Z,I){if(x&&I===void 0)return x(S(this),Z);for(var Y=S(this).byteLength,F=y(Z,Y),oe=y(I===void 0?Y:I,Y),W=new(N(this,C))(E(oe-F)),ne=new U(this),ee=new U(W),H=0;F<oe;)z(ee,H++,P(ne,F++));return W}})},2222:function(O,j,c){var p=c(2109),f=c(7293),T=c(3157),v=c(111),S=c(7908),y=c(6244),E=c(7207),N=c(6135),C=c(5417),U=c(1194),M=c(5112),x=c(7392),P=M("isConcatSpreadable"),z=x>=51||!f(function(){var I=[];return I[P]=!1,I.concat()[0]!==I}),Z=function(I){if(!v(I))return!1;var Y=I[P];return Y!==void 0?!!Y:T(I)};p({target:"Array",proto:!0,arity:1,forced:!z||!U("concat")},{concat:function(I){var Y,F,oe,W,ne,ee=S(this),H=C(ee,0),q=0;for(Y=-1,oe=arguments.length;Y<oe;Y++)if(Z(ne=Y===-1?ee:arguments[Y]))for(W=y(ne),E(q+W),F=0;F<W;F++,q++)F in ne&&N(H,q,ne[F]);else E(q+1),N(H,q++,ne);return H.length=q,H}})},7327:function(O,j,c){var p=c(2109),f=c(2092).filter;p({target:"Array",proto:!0,forced:!c(1194)("filter")},{filter:function(T){return f(this,T,arguments.length>1?arguments[1]:void 0)}})},4553:function(O,j,c){var p=c(2109),f=c(2092).findIndex,T=c(1223),v="findIndex",S=!0;v in[]&&Array(1)[v](function(){S=!1}),p({target:"Array",proto:!0,forced:S},{findIndex:function(y){return f(this,y,arguments.length>1?arguments[1]:void 0)}}),T(v)},9826:function(O,j,c){var p=c(2109),f=c(2092).find,T=c(1223),v="find",S=!0;v in[]&&Array(1)[v](function(){S=!1}),p({target:"Array",proto:!0,forced:S},{find:function(y){return f(this,y,arguments.length>1?arguments[1]:void 0)}}),T(v)},9554:function(O,j,c){var p=c(2109),f=c(8533);p({target:"Array",proto:!0,forced:[].forEach!=f},{forEach:f})},1038:function(O,j,c){var p=c(2109),f=c(8457);p({target:"Array",stat:!0,forced:!c(7072)(function(T){Array.from(T)})},{from:f})},6699:function(O,j,c){var p=c(2109),f=c(1318).includes,T=c(7293),v=c(1223);p({target:"Array",proto:!0,forced:T(function(){return!Array(1).includes()})},{includes:function(S){return f(this,S,arguments.length>1?arguments[1]:void 0)}}),v("includes")},2772:function(O,j,c){var p=c(2109),f=c(1470),T=c(1318).indexOf,v=c(9341),S=f([].indexOf),y=!!S&&1/S([1],1,-0)<0;p({target:"Array",proto:!0,forced:y||!v("indexOf")},{indexOf:function(E){var N=arguments.length>1?arguments[1]:void 0;return y?S(this,E,N)||0:T(this,E,N)}})},9753:function(O,j,c){c(2109)({target:"Array",stat:!0},{isArray:c(3157)})},6992:function(O,j,c){var p=c(5656),f=c(1223),T=c(7497),v=c(9909),S=c(3070).f,y=c(1656),E=c(6178),N=c(1913),C=c(9781),U="Array Iterator",M=v.set,x=v.getterFor(U);O.exports=y(Array,"Array",function(z,Z){M(this,{type:U,target:p(z),index:0,kind:Z})},function(){var z=x(this),Z=z.target,I=z.kind,Y=z.index++;return!Z||Y>=Z.length?(z.target=void 0,E(void 0,!0)):E(I=="keys"?Y:I=="values"?Z[Y]:[Y,Z[Y]],!1)},"values");var P=T.Arguments=T.Array;if(f("keys"),f("values"),f("entries"),!N&&C&&P.name!=="values")try{S(P,"name",{value:"values"})}catch{}},9600:function(O,j,c){var p=c(2109),f=c(1702),T=c(8361),v=c(5656),S=c(9341),y=f([].join);p({target:"Array",proto:!0,forced:T!=Object||!S("join",",")},{join:function(E){return y(v(this),E===void 0?",":E)}})},4986:function(O,j,c){var p=c(2109),f=c(6583);p({target:"Array",proto:!0,forced:f!==[].lastIndexOf},{lastIndexOf:f})},1249:function(O,j,c){var p=c(2109),f=c(2092).map;p({target:"Array",proto:!0,forced:!c(1194)("map")},{map:function(T){return f(this,T,arguments.length>1?arguments[1]:void 0)}})},5827:function(O,j,c){var p=c(2109),f=c(3671).left,T=c(9341),v=c(7392);p({target:"Array",proto:!0,forced:!c(5268)&&v>79&&v<83||!T("reduce")},{reduce:function(S){var y=arguments.length;return f(this,S,y,y>1?arguments[1]:void 0)}})},5069:function(O,j,c){var p=c(2109),f=c(1702),T=c(3157),v=f([].reverse),S=[1,2];p({target:"Array",proto:!0,forced:String(S)===String(S.reverse())},{reverse:function(){return T(this)&&(this.length=this.length),v(this)}})},7042:function(O,j,c){var p=c(2109),f=c(3157),T=c(4411),v=c(111),S=c(1400),y=c(6244),E=c(5656),N=c(6135),C=c(5112),U=c(1194),M=c(206),x=U("slice"),P=C("species"),z=Array,Z=Math.max;p({target:"Array",proto:!0,forced:!x},{slice:function(I,Y){var F,oe,W,ne=E(this),ee=y(ne),H=S(I,ee),q=S(Y===void 0?ee:Y,ee);if(f(ne)&&(F=ne.constructor,(T(F)&&(F===z||f(F.prototype))||v(F)&&(F=F[P])===null)&&(F=void 0),F===z||F===void 0))return M(ne,H,q);for(oe=new(F===void 0?z:F)(Z(q-H,0)),W=0;H<q;H++,W++)H in ne&&N(oe,W,ne[H]);return oe.length=W,oe}})},5212:function(O,j,c){var p=c(2109),f=c(2092).some;p({target:"Array",proto:!0,forced:!c(9341)("some")},{some:function(T){return f(this,T,arguments.length>1?arguments[1]:void 0)}})},561:function(O,j,c){var p=c(2109),f=c(7908),T=c(1400),v=c(9303),S=c(6244),y=c(3658),E=c(7207),N=c(5417),C=c(6135),U=c(5117),M=c(1194)("splice"),x=Math.max,P=Math.min;p({target:"Array",proto:!0,forced:!M},{splice:function(z,Z){var I,Y,F,oe,W,ne,ee=f(this),H=S(ee),q=T(z,H),ve=arguments.length;for(ve===0?I=Y=0:ve===1?(I=0,Y=H-q):(I=ve-2,Y=P(x(v(Z),0),H-q)),E(H+I-Y),F=N(ee,Y),oe=0;oe<Y;oe++)(W=q+oe)in ee&&C(F,oe,ee[W]);if(F.length=Y,I<Y){for(oe=q;oe<H-Y;oe++)ne=oe+I,(W=oe+Y)in ee?ee[ne]=ee[W]:U(ee,ne);for(oe=H;oe>H-Y+I;oe--)U(ee,oe-1)}else if(I>Y)for(oe=H-Y;oe>q;oe--)ne=oe+I-1,(W=oe+Y-1)in ee?ee[ne]=ee[W]:U(ee,ne);for(oe=0;oe<I;oe++)ee[oe+q]=arguments[oe+2];return y(ee,H-Y+I),F}})},3843:function(O,j,c){var p=c(2109),f=c(1702),T=Date,v=f(T.prototype.getTime);p({target:"Date",stat:!0},{now:function(){return v(new T)}})},3710:function(O,j,c){var p=c(1702),f=c(8052),T=Date.prototype,v="Invalid Date",S="toString",y=p(T[S]),E=p(T.getTime);String(new Date(NaN))!=v&&f(T,S,function(){var N=E(this);return N==N?y(this):v})},4812:function(O,j,c){var p=c(2109),f=c(7065);p({target:"Function",proto:!0,forced:Function.bind!==f},{bind:f})},8309:function(O,j,c){var p=c(9781),f=c(6530).EXISTS,T=c(1702),v=c(7045),S=Function.prototype,y=T(S.toString),E=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,N=T(E.exec);p&&!f&&v(S,"name",{configurable:!0,get:function(){try{return N(E,y(this))[1]}catch{return""}}})},8862:function(O,j,c){var p=c(2109),f=c(5005),T=c(2104),v=c(6916),S=c(1702),y=c(7293),E=c(614),N=c(2190),C=c(206),U=c(8044),M=c(6293),x=String,P=f("JSON","stringify"),z=S(/./.exec),Z=S("".charAt),I=S("".charCodeAt),Y=S("".replace),F=S(1 .toString),oe=/[\uD800-\uDFFF]/g,W=/^[\uD800-\uDBFF]$/,ne=/^[\uDC00-\uDFFF]$/,ee=!M||y(function(){var Le=f("Symbol")();return P([Le])!="[null]"||P({a:Le})!="{}"||P(Object(Le))!="{}"}),H=y(function(){return P("\uDF06\uD834")!=='"\\udf06\\ud834"'||P("\uDEAD")!=='"\\udead"'}),q=function(Le,Oe){var ge=C(arguments),je=U(Oe);if(E(je)||Le!==void 0&&!N(Le))return ge[1]=function(Ne,Be){if(E(je)&&(Be=v(je,this,x(Ne),Be)),!N(Be))return Be},T(P,null,ge)},ve=function(Le,Oe,ge){var je=Z(ge,Oe-1),Ne=Z(ge,Oe+1);return z(W,Le)&&!z(ne,Ne)||z(ne,Le)&&!z(W,je)?"\\u"+F(I(Le,0),16):Le};P&&p({target:"JSON",stat:!0,arity:3,forced:ee||H},{stringify:function(Le,Oe,ge){var je=C(arguments),Ne=T(ee?q:P,null,je);return H&&typeof Ne=="string"?Y(Ne,oe,ve):Ne}})},9098:function(O,j,c){c(7710)("Map",function(p){return function(){return p(this,arguments.length?arguments[0]:void 0)}},c(5631))},1532:function(O,j,c){c(9098)},9653:function(O,j,c){var p=c(2109),f=c(1913),T=c(9781),v=c(7854),S=c(857),y=c(1702),E=c(4705),N=c(2597),C=c(9587),U=c(7976),M=c(2190),x=c(7593),P=c(7293),z=c(8006).f,Z=c(1236).f,I=c(3070).f,Y=c(863),F=c(3111).trim,oe="Number",W=v[oe],ne=S[oe],ee=W.prototype,H=v.TypeError,q=y("".slice),ve=y("".charCodeAt),Le=E(oe,!W(" 0o1")||!W("0b1")||W("+0x1")),Oe=function(je){var Ne,Be=arguments.length<1?0:W(function(Ye){var pt=x(Ye,"number");return typeof pt=="bigint"?pt:function(dt){var Ie,we,ft,qe,it,Tt,Pt,bt,jt=x(dt,"number");if(M(jt))throw H("Cannot convert a Symbol value to a number");if(typeof jt=="string"&&jt.length>2){if(jt=F(jt),(Ie=ve(jt,0))===43||Ie===45){if((we=ve(jt,2))===88||we===120)return NaN}else if(Ie===48){switch(ve(jt,1)){case 66:case 98:ft=2,qe=49;break;case 79:case 111:ft=8,qe=55;break;default:return+jt}for(Tt=(it=q(jt,2)).length,Pt=0;Pt<Tt;Pt++)if((bt=ve(it,Pt))<48||bt>qe)return NaN;return parseInt(it,ft)}}return+jt}(pt)}(je));return U(ee,Ne=this)&&P(function(){Y(Ne)})?C(Object(Be),this,Oe):Be};Oe.prototype=ee,Le&&!f&&(ee.constructor=Oe),p({global:!0,constructor:!0,wrap:!0,forced:Le},{Number:Oe});var ge=function(je,Ne){for(var Be,Ye=T?z(Ne):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),pt=0;Ye.length>pt;pt++)N(Ne,Be=Ye[pt])&&!N(je,Be)&&I(je,Be,Z(Ne,Be))};f&&ne&&ge(S[oe],ne),(Le||f)&&ge(S[oe],W)},3161:function(O,j,c){c(2109)({target:"Number",stat:!0},{isInteger:c(5988)})},4048:function(O,j,c){c(2109)({target:"Number",stat:!0},{isNaN:function(p){return p!=p}})},9601:function(O,j,c){var p=c(2109),f=c(1574);p({target:"Object",stat:!0,arity:2,forced:Object.assign!==f},{assign:f})},9070:function(O,j,c){var p=c(2109),f=c(9781),T=c(3070).f;p({target:"Object",stat:!0,forced:Object.defineProperty!==T,sham:!f},{defineProperty:T})},9720:function(O,j,c){var p=c(2109),f=c(4699).entries;p({target:"Object",stat:!0},{entries:function(T){return f(T)}})},9660:function(O,j,c){var p=c(2109),f=c(6293),T=c(7293),v=c(5181),S=c(7908);p({target:"Object",stat:!0,forced:!f||T(function(){v.f(1)})},{getOwnPropertySymbols:function(y){var E=v.f;return E?E(S(y)):[]}})},7941:function(O,j,c){var p=c(2109),f=c(7908),T=c(1956);p({target:"Object",stat:!0,forced:c(7293)(function(){T(1)})},{keys:function(v){return T(f(v))}})},1539:function(O,j,c){var p=c(1694),f=c(8052),T=c(288);p||f(Object.prototype,"toString",T,{unsafe:!0})},821:function(O,j,c){var p=c(2109),f=c(6916),T=c(9662),v=c(8523),S=c(2534),y=c(408);p({target:"Promise",stat:!0,forced:c(612)},{all:function(E){var N=this,C=v.f(N),U=C.resolve,M=C.reject,x=S(function(){var P=T(N.resolve),z=[],Z=0,I=1;y(E,function(Y){var F=Z++,oe=!1;I++,f(P,N,Y).then(function(W){oe||(oe=!0,z[F]=W,--I||U(z))},M)}),--I||U(z)});return x.error&&M(x.value),C.promise}})},4164:function(O,j,c){var p=c(2109),f=c(1913),T=c(3702).CONSTRUCTOR,v=c(2492),S=c(5005),y=c(614),E=c(8052),N=v&&v.prototype;if(p({target:"Promise",proto:!0,forced:T,real:!0},{catch:function(U){return this.then(void 0,U)}}),!f&&y(v)){var C=S("Promise").prototype.catch;N.catch!==C&&E(N,"catch",C,{unsafe:!0})}},3401:function(O,j,c){var p,f,T,v=c(2109),S=c(1913),y=c(5268),E=c(7854),N=c(6916),C=c(8052),U=c(7674),M=c(8003),x=c(6340),P=c(9662),z=c(614),Z=c(111),I=c(5787),Y=c(6707),F=c(261).set,oe=c(5948),W=c(842),ne=c(2534),ee=c(8572),H=c(9909),q=c(2492),ve=c(3702),Le=c(8523),Oe="Promise",ge=ve.CONSTRUCTOR,je=ve.REJECTION_EVENT,Ne=ve.SUBCLASSING,Be=H.getterFor(Oe),Ye=H.set,pt=q&&q.prototype,dt=q,Ie=pt,we=E.TypeError,ft=E.document,qe=E.process,it=Le.f,Tt=it,Pt=!!(ft&&ft.createEvent&&E.dispatchEvent),bt="unhandledrejection",jt=function(St){var Wt;return!(!Z(St)||!z(Wt=St.then))&&Wt},Lt=function(St,Wt){var Zt,Kt,At,vt=Wt.value,zt=Wt.state==1,vr=zt?St.ok:St.fail,or=St.resolve,mr=St.reject,ae=St.domain;try{vr?(zt||(Wt.rejection===2&&er(Wt),Wt.rejection=1),vr===!0?Zt=vt:(ae&&ae.enter(),Zt=vr(vt),ae&&(ae.exit(),At=!0)),Zt===St.promise?mr(we("Promise-chain cycle")):(Kt=jt(Zt))?N(Kt,Zt,or,mr):or(Zt)):mr(vt)}catch(Ae){ae&&!At&&ae.exit(),mr(Ae)}},Gt=function(St,Wt){St.notified||(St.notified=!0,oe(function(){for(var Zt,Kt=St.reactions;Zt=Kt.get();)Lt(Zt,St);St.notified=!1,Wt&&!St.rejection&&ir(St)}))},pr=function(St,Wt,Zt){var Kt,At;Pt?((Kt=ft.createEvent("Event")).promise=Wt,Kt.reason=Zt,Kt.initEvent(St,!1,!0),E.dispatchEvent(Kt)):Kt={promise:Wt,reason:Zt},!je&&(At=E["on"+St])?At(Kt):St===bt&&W("Unhandled promise rejection",Zt)},ir=function(St){N(F,E,function(){var Wt,Zt=St.facade,Kt=St.value;if(Ar(St)&&(Wt=ne(function(){y?qe.emit("unhandledRejection",Kt,Zt):pr(bt,Zt,Kt)}),St.rejection=y||Ar(St)?2:1,Wt.error))throw Wt.value})},Ar=function(St){return St.rejection!==1&&!St.parent},er=function(St){N(F,E,function(){var Wt=St.facade;y?qe.emit("rejectionHandled",Wt):pr("rejectionhandled",Wt,St.value)})},yt=function(St,Wt,Zt){return function(Kt){St(Wt,Kt,Zt)}},Xt=function(St,Wt,Zt){St.done||(St.done=!0,Zt&&(St=Zt),St.value=Wt,St.state=2,Gt(St,!0))},Ir=function(St,Wt,Zt){if(!St.done){St.done=!0,Zt&&(St=Zt);try{if(St.facade===Wt)throw we("Promise can't be resolved itself");var Kt=jt(Wt);Kt?oe(function(){var At={done:!1};try{N(Kt,Wt,yt(Ir,At,St),yt(Xt,At,St))}catch(vt){Xt(At,vt,St)}}):(St.value=Wt,St.state=1,Gt(St,!1))}catch(At){Xt({done:!1},At,St)}}};if(ge&&(Ie=(dt=function(St){I(this,Ie),P(St),N(p,this);var Wt=Be(this);try{St(yt(Ir,Wt),yt(Xt,Wt))}catch(Zt){Xt(Wt,Zt)}}).prototype,(p=function(St){Ye(this,{type:Oe,done:!1,notified:!1,parent:!1,reactions:new ee,rejection:!1,state:0,value:void 0})}).prototype=C(Ie,"then",function(St,Wt){var Zt=Be(this),Kt=it(Y(this,dt));return Zt.parent=!0,Kt.ok=!z(St)||St,Kt.fail=z(Wt)&&Wt,Kt.domain=y?qe.domain:void 0,Zt.state==0?Zt.reactions.add(Kt):oe(function(){Lt(Kt,Zt)}),Kt.promise}),f=function(){var St=new p,Wt=Be(St);this.promise=St,this.resolve=yt(Ir,Wt),this.reject=yt(Xt,Wt)},Le.f=it=function(St){return St===dt||St===void 0?new f(St):Tt(St)},!S&&z(q)&&pt!==Object.prototype)){T=pt.then,Ne||C(pt,"then",function(St,Wt){var Zt=this;return new dt(function(Kt,At){N(T,Zt,Kt,At)}).then(St,Wt)},{unsafe:!0});try{delete pt.constructor}catch{}U&&U(pt,Ie)}v({global:!0,constructor:!0,wrap:!0,forced:ge},{Promise:dt}),M(dt,Oe,!1,!0),x(Oe)},8674:function(O,j,c){c(3401),c(821),c(4164),c(6027),c(683),c(6294)},6027:function(O,j,c){var p=c(2109),f=c(6916),T=c(9662),v=c(8523),S=c(2534),y=c(408);p({target:"Promise",stat:!0,forced:c(612)},{race:function(E){var N=this,C=v.f(N),U=C.reject,M=S(function(){var x=T(N.resolve);y(E,function(P){f(x,N,P).then(C.resolve,U)})});return M.error&&U(M.value),C.promise}})},683:function(O,j,c){var p=c(2109),f=c(6916),T=c(8523);p({target:"Promise",stat:!0,forced:c(3702).CONSTRUCTOR},{reject:function(v){var S=T.f(this);return f(S.reject,void 0,v),S.promise}})},6294:function(O,j,c){var p=c(2109),f=c(5005),T=c(1913),v=c(2492),S=c(3702).CONSTRUCTOR,y=c(9478),E=f("Promise"),N=T&&!S;p({target:"Promise",stat:!0,forced:T||S},{resolve:function(C){return y(N&&this===E?v:this,C)}})},4916:function(O,j,c){var p=c(2109),f=c(2261);p({target:"RegExp",proto:!0,forced:/./.exec!==f},{exec:f})},9714:function(O,j,c){var p=c(6530).PROPER,f=c(8052),T=c(9670),v=c(1340),S=c(7293),y=c(4706),E="toString",N=RegExp.prototype[E],C=S(function(){return N.call({source:"a",flags:"b"})!="/a/b"}),U=p&&N.name!=E;(C||U)&&f(RegExp.prototype,E,function(){var M=T(this);return"/"+v(M.source)+"/"+v(y(M))},{unsafe:!0})},2023:function(O,j,c){var p=c(2109),f=c(1702),T=c(3929),v=c(4488),S=c(1340),y=c(4964),E=f("".indexOf);p({target:"String",proto:!0,forced:!y("includes")},{includes:function(N){return!!~E(S(v(this)),S(T(N)),arguments.length>1?arguments[1]:void 0)}})},8783:function(O,j,c){var p=c(8710).charAt,f=c(1340),T=c(9909),v=c(1656),S=c(6178),y="String Iterator",E=T.set,N=T.getterFor(y);v(String,"String",function(C){E(this,{type:y,string:f(C),index:0})},function(){var C,U=N(this),M=U.string,x=U.index;return x>=M.length?S(void 0,!0):(C=p(M,x),U.index+=C.length,S(C,!1))})},3123:function(O,j,c){var p=c(2104),f=c(6916),T=c(1702),v=c(7007),S=c(9670),y=c(8554),E=c(7850),N=c(4488),C=c(6707),U=c(1530),M=c(7466),x=c(1340),P=c(8173),z=c(1589),Z=c(7651),I=c(2261),Y=c(2999),F=c(7293),oe=Y.UNSUPPORTED_Y,W=4294967295,ne=Math.min,ee=[].push,H=T(/./.exec),q=T(ee),ve=T("".slice),Le=!F(function(){var Oe=/(?:)/,ge=Oe.exec;Oe.exec=function(){return ge.apply(this,arguments)};var je="ab".split(Oe);return je.length!==2||je[0]!=="a"||je[1]!=="b"});v("split",function(Oe,ge,je){var Ne;return Ne="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||".".split(/()()/).length>1||"".split(/.?/).length?function(Be,Ye){var pt=x(N(this)),dt=Ye===void 0?W:Ye>>>0;if(dt===0)return[];if(Be===void 0)return[pt];if(!E(Be))return f(ge,pt,Be,dt);for(var Ie,we,ft,qe=[],it=(Be.ignoreCase?"i":"")+(Be.multiline?"m":"")+(Be.unicode?"u":"")+(Be.sticky?"y":""),Tt=0,Pt=new RegExp(Be.source,it+"g");(Ie=f(I,Pt,pt))&&!((we=Pt.lastIndex)>Tt&&(q(qe,ve(pt,Tt,Ie.index)),Ie.length>1&&Ie.index<pt.length&&p(ee,qe,z(Ie,1)),ft=Ie[0].length,Tt=we,qe.length>=dt));)Pt.lastIndex===Ie.index&&Pt.lastIndex++;return Tt===pt.length?!ft&&H(Pt,"")||q(qe,""):q(qe,ve(pt,Tt)),qe.length>dt?z(qe,0,dt):qe}:"0".split(void 0,0).length?function(Be,Ye){return Be===void 0&&Ye===0?[]:f(ge,this,Be,Ye)}:ge,[function(Be,Ye){var pt=N(this),dt=y(Be)?void 0:P(Be,Oe);return dt?f(dt,Be,pt,Ye):f(Ne,x(pt),Be,Ye)},function(Be,Ye){var pt=S(this),dt=x(Be),Ie=je(Ne,pt,dt,Ye,Ne!==ge);if(Ie.done)return Ie.value;var we=C(pt,RegExp),ft=pt.unicode,qe=(pt.ignoreCase?"i":"")+(pt.multiline?"m":"")+(pt.unicode?"u":"")+(oe?"g":"y"),it=new we(oe?"^(?:"+pt.source+")":pt,qe),Tt=Ye===void 0?W:Ye>>>0;if(Tt===0)return[];if(dt.length===0)return Z(it,dt)===null?[dt]:[];for(var Pt=0,bt=0,jt=[];bt<dt.length;){it.lastIndex=oe?0:bt;var Lt,Gt=Z(it,oe?ve(dt,bt):dt);if(Gt===null||(Lt=ne(M(it.lastIndex+(oe?bt:0)),dt.length))===Pt)bt=U(dt,bt,ft);else{if(q(jt,ve(dt,Pt,bt)),jt.length===Tt)return jt;for(var pr=1;pr<=Gt.length-1;pr++)if(q(jt,Gt[pr]),jt.length===Tt)return jt;bt=Pt=Lt}}return q(jt,ve(dt,Pt)),jt}]},!Le,oe)},4032:function(O,j,c){var p=c(2109),f=c(7854),T=c(6916),v=c(1702),S=c(1913),y=c(9781),E=c(6293),N=c(7293),C=c(2597),U=c(7976),M=c(9670),x=c(5656),P=c(4948),z=c(1340),Z=c(9114),I=c(30),Y=c(1956),F=c(8006),oe=c(1156),W=c(5181),ne=c(1236),ee=c(3070),H=c(6048),q=c(5296),ve=c(8052),Le=c(7045),Oe=c(2309),ge=c(6200),je=c(3501),Ne=c(9711),Be=c(5112),Ye=c(6061),pt=c(6800),dt=c(6532),Ie=c(8003),we=c(9909),ft=c(2092).forEach,qe=ge("hidden"),it="Symbol",Tt="prototype",Pt=we.set,bt=we.getterFor(it),jt=Object[Tt],Lt=f.Symbol,Gt=Lt&&Lt[Tt],pr=f.TypeError,ir=f.QObject,Ar=ne.f,er=ee.f,yt=oe.f,Xt=q.f,Ir=v([].push),St=Oe("symbols"),Wt=Oe("op-symbols"),Zt=Oe("wks"),Kt=!ir||!ir[Tt]||!ir[Tt].findChild,At=y&&N(function(){return I(er({},"a",{get:function(){return er(this,"a",{value:7}).a}})).a!=7})?function(le,Xe,X){var et=Ar(jt,Xe);et&&delete jt[Xe],er(le,Xe,X),et&&le!==jt&&er(jt,Xe,et)}:er,vt=function(le,Xe){var X=St[le]=I(Gt);return Pt(X,{type:it,tag:le,description:Xe}),y||(X.description=Xe),X},zt=function(le,Xe,X){le===jt&&zt(Wt,Xe,X),M(le);var et=P(Xe);return M(X),C(St,et)?(X.enumerable?(C(le,qe)&&le[qe][et]&&(le[qe][et]=!1),X=I(X,{enumerable:Z(0,!1)})):(C(le,qe)||er(le,qe,Z(1,{})),le[qe][et]=!0),At(le,et,X)):er(le,et,X)},vr=function(le,Xe){M(le);var X=x(Xe),et=Y(X).concat(Ae(X));return ft(et,function(Me){y&&!T(or,X,Me)||zt(le,Me,X[Me])}),le},or=function(le){var Xe=P(le),X=T(Xt,this,Xe);return!(this===jt&&C(St,Xe)&&!C(Wt,Xe))&&(!(X||!C(this,Xe)||!C(St,Xe)||C(this,qe)&&this[qe][Xe])||X)},mr=function(le,Xe){var X=x(le),et=P(Xe);if(X!==jt||!C(St,et)||C(Wt,et)){var Me=Ar(X,et);return!Me||!C(St,et)||C(X,qe)&&X[qe][et]||(Me.enumerable=!0),Me}},ae=function(le){var Xe=yt(x(le)),X=[];return ft(Xe,function(et){C(St,et)||C(je,et)||Ir(X,et)}),X},Ae=function(le){var Xe=le===jt,X=yt(Xe?Wt:x(le)),et=[];return ft(X,function(Me){!C(St,Me)||Xe&&!C(jt,Me)||Ir(et,St[Me])}),et};E||(Lt=function(){if(U(Gt,this))throw pr("Symbol is not a constructor");var le=arguments.length&&arguments[0]!==void 0?z(arguments[0]):void 0,Xe=Ne(le),X=function(et){this===jt&&T(X,Wt,et),C(this,qe)&&C(this[qe],Xe)&&(this[qe][Xe]=!1),At(this,Xe,Z(1,et))};return y&&Kt&&At(jt,Xe,{configurable:!0,set:X}),vt(Xe,le)},ve(Gt=Lt[Tt],"toString",function(){return bt(this).tag}),ve(Lt,"withoutSetter",function(le){return vt(Ne(le),le)}),q.f=or,ee.f=zt,H.f=vr,ne.f=mr,F.f=oe.f=ae,W.f=Ae,Ye.f=function(le){return vt(Be(le),le)},y&&(Le(Gt,"description",{configurable:!0,get:function(){return bt(this).description}}),S||ve(jt,"propertyIsEnumerable",or,{unsafe:!0}))),p({global:!0,constructor:!0,wrap:!0,forced:!E,sham:!E},{Symbol:Lt}),ft(Y(Zt),function(le){pt(le)}),p({target:it,stat:!0,forced:!E},{useSetter:function(){Kt=!0},useSimple:function(){Kt=!1}}),p({target:"Object",stat:!0,forced:!E,sham:!y},{create:function(le,Xe){return Xe===void 0?I(le):vr(I(le),Xe)},defineProperty:zt,defineProperties:vr,getOwnPropertyDescriptor:mr}),p({target:"Object",stat:!0,forced:!E},{getOwnPropertyNames:ae}),dt(),Ie(Lt,it),je[qe]=!0},1817:function(O,j,c){var p=c(2109),f=c(9781),T=c(7854),v=c(1702),S=c(2597),y=c(614),E=c(7976),N=c(1340),C=c(7045),U=c(9920),M=T.Symbol,x=M&&M.prototype;if(f&&y(M)&&(!("description"in x)||M().description!==void 0)){var P={},z=function(){var ne=arguments.length<1||arguments[0]===void 0?void 0:N(arguments[0]),ee=E(x,this)?new M(ne):ne===void 0?M():M(ne);return ne===""&&(P[ee]=!0),ee};U(z,M),z.prototype=x,x.constructor=z;var Z=String(M("test"))=="Symbol(test)",I=v(x.valueOf),Y=v(x.toString),F=/^Symbol\((.*)\)[^)]+$/,oe=v("".replace),W=v("".slice);C(x,"description",{configurable:!0,get:function(){var ne=I(this);if(S(P,ne))return"";var ee=Y(ne),H=Z?W(ee,7,-1):oe(ee,F,"$1");return H===""?void 0:H}}),p({global:!0,constructor:!0,forced:!0},{Symbol:z})}},763:function(O,j,c){var p=c(2109),f=c(5005),T=c(2597),v=c(1340),S=c(2309),y=c(2015),E=S("string-to-symbol-registry"),N=S("symbol-to-string-registry");p({target:"Symbol",stat:!0,forced:!y},{for:function(C){var U=v(C);if(T(E,U))return E[U];var M=f("Symbol")(U);return E[U]=M,N[M]=U,M}})},2165:function(O,j,c){c(6800)("iterator")},2526:function(O,j,c){c(4032),c(763),c(6620),c(8862),c(9660)},6620:function(O,j,c){var p=c(2109),f=c(2597),T=c(2190),v=c(6330),S=c(2309),y=c(2015),E=S("symbol-to-string-registry");p({target:"Symbol",stat:!0,forced:!y},{keyFor:function(N){if(!T(N))throw TypeError(v(N)+" is not a symbol");if(f(E,N))return E[N]}})},2990:function(O,j,c){var p=c(1702),f=c(260),T=p(c(1048)),v=f.aTypedArray;(0,f.exportTypedArrayMethod)("copyWithin",function(S,y){return T(v(this),S,y,arguments.length>2?arguments[2]:void 0)})},8927:function(O,j,c){var p=c(260),f=c(2092).every,T=p.aTypedArray;(0,p.exportTypedArrayMethod)("every",function(v){return f(T(this),v,arguments.length>1?arguments[1]:void 0)})},3105:function(O,j,c){var p=c(260),f=c(1285),T=c(4599),v=c(648),S=c(6916),y=c(1702),E=c(7293),N=p.aTypedArray,C=p.exportTypedArrayMethod,U=y("".slice);C("fill",function(M){var x=arguments.length;N(this);var P=U(v(this),0,3)==="Big"?T(M):+M;return S(f,this,P,x>1?arguments[1]:void 0,x>2?arguments[2]:void 0)},E(function(){var M=0;return new Int8Array(2).fill({valueOf:function(){return M++}}),M!==1}))},5035:function(O,j,c){var p=c(260),f=c(2092).filter,T=c(3074),v=p.aTypedArray;(0,p.exportTypedArrayMethod)("filter",function(S){var y=f(v(this),S,arguments.length>1?arguments[1]:void 0);return T(this,y)})},7174:function(O,j,c){var p=c(260),f=c(2092).findIndex,T=p.aTypedArray;(0,p.exportTypedArrayMethod)("findIndex",function(v){return f(T(this),v,arguments.length>1?arguments[1]:void 0)})},4345:function(O,j,c){var p=c(260),f=c(2092).find,T=p.aTypedArray;(0,p.exportTypedArrayMethod)("find",function(v){return f(T(this),v,arguments.length>1?arguments[1]:void 0)})},2846:function(O,j,c){var p=c(260),f=c(2092).forEach,T=p.aTypedArray;(0,p.exportTypedArrayMethod)("forEach",function(v){f(T(this),v,arguments.length>1?arguments[1]:void 0)})},8145:function(O,j,c){var p=c(3832);(0,c(260).exportTypedArrayStaticMethod)("from",c(7321),p)},4731:function(O,j,c){var p=c(260),f=c(1318).includes,T=p.aTypedArray;(0,p.exportTypedArrayMethod)("includes",function(v){return f(T(this),v,arguments.length>1?arguments[1]:void 0)})},7209:function(O,j,c){var p=c(260),f=c(1318).indexOf,T=p.aTypedArray;(0,p.exportTypedArrayMethod)("indexOf",function(v){return f(T(this),v,arguments.length>1?arguments[1]:void 0)})},6319:function(O,j,c){var p=c(7854),f=c(7293),T=c(1702),v=c(260),S=c(6992),y=c(5112)("iterator"),E=p.Uint8Array,N=T(S.values),C=T(S.keys),U=T(S.entries),M=v.aTypedArray,x=v.exportTypedArrayMethod,P=E&&E.prototype,z=!f(function(){P[y].call([1])}),Z=!!P&&P.values&&P[y]===P.values&&P.values.name==="values",I=function(){return N(M(this))};x("entries",function(){return U(M(this))},z),x("keys",function(){return C(M(this))},z),x("values",I,z||!Z,{name:"values"}),x(y,I,z||!Z,{name:"values"})},8867:function(O,j,c){var p=c(260),f=c(1702),T=p.aTypedArray,v=p.exportTypedArrayMethod,S=f([].join);v("join",function(y){return S(T(this),y)})},7789:function(O,j,c){var p=c(260),f=c(2104),T=c(6583),v=p.aTypedArray;(0,p.exportTypedArrayMethod)("lastIndexOf",function(S){var y=arguments.length;return f(T,v(this),y>1?[S,arguments[1]]:[S])})},3739:function(O,j,c){var p=c(260),f=c(2092).map,T=c(6304),v=p.aTypedArray;(0,p.exportTypedArrayMethod)("map",function(S){return f(v(this),S,arguments.length>1?arguments[1]:void 0,function(y,E){return new(T(y))(E)})})},4483:function(O,j,c){var p=c(260),f=c(3671).right,T=p.aTypedArray;(0,p.exportTypedArrayMethod)("reduceRight",function(v){var S=arguments.length;return f(T(this),v,S,S>1?arguments[1]:void 0)})},9368:function(O,j,c){var p=c(260),f=c(3671).left,T=p.aTypedArray;(0,p.exportTypedArrayMethod)("reduce",function(v){var S=arguments.length;return f(T(this),v,S,S>1?arguments[1]:void 0)})},2056:function(O,j,c){var p=c(260),f=p.aTypedArray,T=p.exportTypedArrayMethod,v=Math.floor;T("reverse",function(){for(var S,y=this,E=f(y).length,N=v(E/2),C=0;C<N;)S=y[C],y[C++]=y[--E],y[E]=S;return y})},3462:function(O,j,c){var p=c(7854),f=c(6916),T=c(260),v=c(6244),S=c(4590),y=c(7908),E=c(7293),N=p.RangeError,C=p.Int8Array,U=C&&C.prototype,M=U&&U.set,x=T.aTypedArray,P=T.exportTypedArrayMethod,z=!E(function(){var I=new Uint8ClampedArray(2);return f(M,I,{length:1,0:3},1),I[1]!==3}),Z=z&&T.NATIVE_ARRAY_BUFFER_VIEWS&&E(function(){var I=new C(2);return I.set(1),I.set("2",1),I[0]!==0||I[1]!==2});P("set",function(I){x(this);var Y=S(arguments.length>1?arguments[1]:void 0,1),F=y(I);if(z)return f(M,this,F,Y);var oe=this.length,W=v(F),ne=0;if(W+Y>oe)throw N("Wrong length");for(;ne<W;)this[Y+ne]=F[ne++]},!z||Z)},678:function(O,j,c){var p=c(260),f=c(6304),T=c(7293),v=c(206),S=p.aTypedArray;(0,p.exportTypedArrayMethod)("slice",function(y,E){for(var N=v(S(this),y,E),C=f(this),U=0,M=N.length,x=new C(M);M>U;)x[U]=N[U++];return x},T(function(){new Int8Array(1).slice()}))},7462:function(O,j,c){var p=c(260),f=c(2092).some,T=p.aTypedArray;(0,p.exportTypedArrayMethod)("some",function(v){return f(T(this),v,arguments.length>1?arguments[1]:void 0)})},3824:function(O,j,c){var p=c(7854),f=c(1470),T=c(7293),v=c(9662),S=c(4362),y=c(260),E=c(8886),N=c(256),C=c(7392),U=c(8008),M=y.aTypedArray,x=y.exportTypedArrayMethod,P=p.Uint16Array,z=P&&f(P.prototype.sort),Z=!(!z||T(function(){z(new P(2),null)})&&T(function(){z(new P(2),{})})),I=!!z&&!T(function(){if(C)return C<74;if(E)return E<67;if(N)return!0;if(U)return U<602;var Y,F,oe=new P(516),W=Array(516);for(Y=0;Y<516;Y++)F=Y%4,oe[Y]=515-Y,W[Y]=Y-2*F+3;for(z(oe,function(ne,ee){return(ne/4|0)-(ee/4|0)}),Y=0;Y<516;Y++)if(oe[Y]!==W[Y])return!0});x("sort",function(Y){return Y!==void 0&&v(Y),I?z(this,Y):S(M(this),function(F){return function(oe,W){return F!==void 0?+F(oe,W)||0:W!=W?-1:oe!=oe?1:oe===0&&W===0?1/oe>0&&1/W<0?1:-1:oe>W}}(Y))},!I||Z)},5021:function(O,j,c){var p=c(260),f=c(7466),T=c(1400),v=c(6304),S=p.aTypedArray;(0,p.exportTypedArrayMethod)("subarray",function(y,E){var N=S(this),C=N.length,U=T(y,C);return new(v(N))(N.buffer,N.byteOffset+U*N.BYTES_PER_ELEMENT,f((E===void 0?C:T(E,C))-U))})},2974:function(O,j,c){var p=c(7854),f=c(2104),T=c(260),v=c(7293),S=c(206),y=p.Int8Array,E=T.aTypedArray,N=T.exportTypedArrayMethod,C=[].toLocaleString,U=!!y&&v(function(){C.call(new y(1))});N("toLocaleString",function(){return f(C,U?S(E(this)):E(this),S(arguments))},v(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!v(function(){y.prototype.toLocaleString.call([1,2])}))},5016:function(O,j,c){var p=c(260).exportTypedArrayMethod,f=c(7293),T=c(7854),v=c(1702),S=T.Uint8Array,y=S&&S.prototype||{},E=[].toString,N=v([].join);f(function(){E.call({})})&&(E=function(){return N(this)});var C=y.toString!=E;p("toString",E,C)},2472:function(O,j,c){c(9843)("Uint8",function(p){return function(f,T,v){return p(this,f,T,v)}})},4747:function(O,j,c){var p=c(7854),f=c(8324),T=c(8509),v=c(8533),S=c(8880),y=function(N){if(N&&N.forEach!==v)try{S(N,"forEach",v)}catch{N.forEach=v}};for(var E in f)f[E]&&y(p[E]&&p[E].prototype);y(T)},3948:function(O,j,c){var p=c(7854),f=c(8324),T=c(8509),v=c(6992),S=c(8880),y=c(5112),E=y("iterator"),N=y("toStringTag"),C=v.values,U=function(x,P){if(x){if(x[E]!==C)try{S(x,E,C)}catch{x[E]=C}if(x[N]||S(x,N,P),f[P]){for(var z in v)if(x[z]!==v[z])try{S(x,z,v[z])}catch{x[z]=v[z]}}}};for(var M in f)U(p[M]&&p[M].prototype,M);U(T,"DOMTokenList")},6815:function(O,j,c){var p=c(2109),f=c(7854),T=c(7152)(f.setInterval,!0);p({global:!0,bind:!0,forced:f.setInterval!==T},{setInterval:T})},8417:function(O,j,c){var p=c(2109),f=c(7854),T=c(7152)(f.setTimeout,!0);p({global:!0,bind:!0,forced:f.setTimeout!==T},{setTimeout:T})},2564:function(O,j,c){c(6815),c(8417)},5556:function(O,j,c){c(6992);var p=c(2109),f=c(7854),T=c(6916),v=c(1702),S=c(9781),y=c(5143),E=c(8052),N=c(7045),C=c(9190),U=c(8003),M=c(3061),x=c(9909),P=c(5787),z=c(614),Z=c(2597),I=c(9974),Y=c(648),F=c(9670),oe=c(111),W=c(1340),ne=c(30),ee=c(9114),H=c(4121),q=c(1246),ve=c(8053),Le=c(5112),Oe=c(4362),ge=Le("iterator"),je="URLSearchParams",Ne=je+"Iterator",Be=x.set,Ye=x.getterFor(je),pt=x.getterFor(Ne),dt=Object.getOwnPropertyDescriptor,Ie=function(He){if(!S)return f[He];var Qe=dt(f,He);return Qe&&Qe.value},we=Ie("fetch"),ft=Ie("Request"),qe=Ie("Headers"),it=ft&&ft.prototype,Tt=qe&&qe.prototype,Pt=f.RegExp,bt=f.TypeError,jt=f.decodeURIComponent,Lt=f.encodeURIComponent,Gt=v("".charAt),pr=v([].join),ir=v([].push),Ar=v("".replace),er=v([].shift),yt=v([].splice),Xt=v("".split),Ir=v("".slice),St=/\+/g,Wt=Array(4),Zt=function(He){return Wt[He-1]||(Wt[He-1]=Pt("((?:%[\\da-f]{2}){"+He+"})","gi"))},Kt=function(He){try{return jt(He)}catch{return He}},At=function(He){var Qe=Ar(He,St," "),ht=4;try{return jt(Qe)}catch{for(;ht;)Qe=Ar(Qe,Zt(ht--),Kt);return Qe}},vt=/[!'()~]|%20/g,zt={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},vr=function(He){return zt[He]},or=function(He){return Ar(Lt(He),vt,vr)},mr=M(function(He,Qe){Be(this,{type:Ne,iterator:H(Ye(He).entries),kind:Qe})},"Iterator",function(){var He=pt(this),Qe=He.kind,ht=He.iterator.next(),rt=ht.value;return ht.done||(ht.value=Qe==="keys"?rt.key:Qe==="values"?rt.value:[rt.key,rt.value]),ht},!0),ae=function(He){this.entries=[],this.url=null,He!==void 0&&(oe(He)?this.parseObject(He):this.parseQuery(typeof He=="string"?Gt(He,0)==="?"?Ir(He,1):He:W(He)))};ae.prototype={type:je,bindURL:function(He){this.url=He,this.update()},parseObject:function(He){var Qe,ht,rt,Ct,xt,Nt,yr,w=q(He);if(w)for(ht=(Qe=H(He,w)).next;!(rt=T(ht,Qe)).done;){if(xt=(Ct=H(F(rt.value))).next,(Nt=T(xt,Ct)).done||(yr=T(xt,Ct)).done||!T(xt,Ct).done)throw bt("Expected sequence with length 2");ir(this.entries,{key:W(Nt.value),value:W(yr.value)})}else for(var te in He)Z(He,te)&&ir(this.entries,{key:te,value:W(He[te])})},parseQuery:function(He){if(He)for(var Qe,ht,rt=Xt(He,"&"),Ct=0;Ct<rt.length;)(Qe=rt[Ct++]).length&&(ht=Xt(Qe,"="),ir(this.entries,{key:At(er(ht)),value:At(pr(ht,"="))}))},serialize:function(){for(var He,Qe=this.entries,ht=[],rt=0;rt<Qe.length;)He=Qe[rt++],ir(ht,or(He.key)+"="+or(He.value));return pr(ht,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Ae=function(){P(this,le);var He=Be(this,new ae(arguments.length>0?arguments[0]:void 0));S||(this.length=He.entries.length)},le=Ae.prototype;if(C(le,{append:function(He,Qe){ve(arguments.length,2);var ht=Ye(this);ir(ht.entries,{key:W(He),value:W(Qe)}),S||this.length++,ht.updateURL()},delete:function(He){ve(arguments.length,1);for(var Qe=Ye(this),ht=Qe.entries,rt=W(He),Ct=0;Ct<ht.length;)ht[Ct].key===rt?yt(ht,Ct,1):Ct++;S||(this.length=ht.length),Qe.updateURL()},get:function(He){ve(arguments.length,1);for(var Qe=Ye(this).entries,ht=W(He),rt=0;rt<Qe.length;rt++)if(Qe[rt].key===ht)return Qe[rt].value;return null},getAll:function(He){ve(arguments.length,1);for(var Qe=Ye(this).entries,ht=W(He),rt=[],Ct=0;Ct<Qe.length;Ct++)Qe[Ct].key===ht&&ir(rt,Qe[Ct].value);return rt},has:function(He){ve(arguments.length,1);for(var Qe=Ye(this).entries,ht=W(He),rt=0;rt<Qe.length;)if(Qe[rt++].key===ht)return!0;return!1},set:function(He,Qe){ve(arguments.length,1);for(var ht,rt=Ye(this),Ct=rt.entries,xt=!1,Nt=W(He),yr=W(Qe),w=0;w<Ct.length;w++)(ht=Ct[w]).key===Nt&&(xt?yt(Ct,w--,1):(xt=!0,ht.value=yr));xt||ir(Ct,{key:Nt,value:yr}),S||(this.length=Ct.length),rt.updateURL()},sort:function(){var He=Ye(this);Oe(He.entries,function(Qe,ht){return Qe.key>ht.key?1:-1}),He.updateURL()},forEach:function(He){for(var Qe,ht=Ye(this).entries,rt=I(He,arguments.length>1?arguments[1]:void 0),Ct=0;Ct<ht.length;)rt((Qe=ht[Ct++]).value,Qe.key,this)},keys:function(){return new mr(this,"keys")},values:function(){return new mr(this,"values")},entries:function(){return new mr(this,"entries")}},{enumerable:!0}),E(le,ge,le.entries,{name:"entries"}),E(le,"toString",function(){return Ye(this).serialize()},{enumerable:!0}),S&&N(le,"size",{get:function(){return Ye(this).entries.length},configurable:!0,enumerable:!0}),U(Ae,je),p({global:!0,constructor:!0,forced:!y},{URLSearchParams:Ae}),!y&&z(qe)){var Xe=v(Tt.has),X=v(Tt.set),et=function(He){if(oe(He)){var Qe,ht=He.body;if(Y(ht)===je)return Qe=He.headers?new qe(He.headers):new qe,Xe(Qe,"content-type")||X(Qe,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),ne(He,{body:ee(0,W(ht)),headers:ee(0,Qe)})}return He};if(z(we)&&p({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(He){return we(He,arguments.length>1?et(arguments[1]):{})}}),z(ft)){var Me=function(He){return P(this,it),new ft(He,arguments.length>1?et(arguments[1]):{})};it.constructor=Me,Me.prototype=it,p({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:Me})}}O.exports={URLSearchParams:Ae,getState:Ye}},1637:function(O,j,c){c(5556)},8789:function(O,j,c){c(8783);var p,f=c(2109),T=c(9781),v=c(5143),S=c(7854),y=c(9974),E=c(1702),N=c(8052),C=c(7045),U=c(5787),M=c(2597),x=c(1574),P=c(8457),z=c(1589),Z=c(8710).codeAt,I=c(3197),Y=c(1340),F=c(8003),oe=c(8053),W=c(5556),ne=c(9909),ee=ne.set,H=ne.getterFor("URL"),q=W.URLSearchParams,ve=W.getState,Le=S.URL,Oe=S.TypeError,ge=S.parseInt,je=Math.floor,Ne=Math.pow,Be=E("".charAt),Ye=E(/./.exec),pt=E([].join),dt=E(1 .toString),Ie=E([].pop),we=E([].push),ft=E("".replace),qe=E([].shift),it=E("".split),Tt=E("".slice),Pt=E("".toLowerCase),bt=E([].unshift),jt="Invalid scheme",Lt="Invalid host",Gt="Invalid port",pr=/[a-z]/i,ir=/[\d+-.a-z]/i,Ar=/\d/,er=/^0x/i,yt=/^[0-7]+$/,Xt=/^\d+$/,Ir=/^[\da-f]+$/i,St=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Wt=/[\0\t\n\r #/:<>?@[\\\]^|]/,Zt=/^[\u0000-\u0020]+/,Kt=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,At=/[\t\n\r]/g,vt=function(Fe){var Je,ct,kt,mt;if(typeof Fe=="number"){for(Je=[],ct=0;ct<4;ct++)bt(Je,Fe%256),Fe=je(Fe/256);return pt(Je,".")}if(typeof Fe=="object"){for(Je="",kt=function(Jt){for(var Rr=null,Or=1,It=null,Sr=0,Yr=0;Yr<8;Yr++)Jt[Yr]!==0?(Sr>Or&&(Rr=It,Or=Sr),It=null,Sr=0):(It===null&&(It=Yr),++Sr);return Sr>Or&&(Rr=It,Or=Sr),Rr}(Fe),ct=0;ct<8;ct++)mt&&Fe[ct]===0||(mt&&(mt=!1),kt===ct?(Je+=ct?":":"::",mt=!0):(Je+=dt(Fe[ct],16),ct<7&&(Je+=":")));return"["+Je+"]"}return Fe},zt={},vr=x({},zt,{" ":1,'"':1,"<":1,">":1,"`":1}),or=x({},vr,{"#":1,"?":1,"{":1,"}":1}),mr=x({},or,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ae=function(Fe,Je){var ct=Z(Fe,0);return ct>32&&ct<127&&!M(Je,Fe)?Fe:encodeURIComponent(Fe)},Ae={ftp:21,file:null,http:80,https:443,ws:80,wss:443},le=function(Fe,Je){var ct;return Fe.length==2&&Ye(pr,Be(Fe,0))&&((ct=Be(Fe,1))==":"||!Je&&ct=="|")},Xe=function(Fe){var Je;return Fe.length>1&&le(Tt(Fe,0,2))&&(Fe.length==2||(Je=Be(Fe,2))==="/"||Je==="\\"||Je==="?"||Je==="#")},X=function(Fe){return Fe==="."||Pt(Fe)==="%2e"},et={},Me={},He={},Qe={},ht={},rt={},Ct={},xt={},Nt={},yr={},w={},te={},Re={},re={},Ee={},Ge={},he={},$e={},ye={},lt={},Ze={},Dt=function(Fe,Je,ct){var kt,mt,Jt,Rr=Y(Fe);if(Je){if(mt=this.parse(Rr))throw Oe(mt);this.searchParams=null}else{if(ct!==void 0&&(kt=new Dt(ct,!0)),mt=this.parse(Rr,null,kt))throw Oe(mt);(Jt=ve(new q)).bindURL(this),this.searchParams=Jt}};Dt.prototype={type:"URL",parse:function(Fe,Je,ct){var kt,mt,Jt,Rr,Or,It=this,Sr=Je||et,Yr=0,xr="",Tn=!1,Cn=!1,Oi=!1;for(Fe=Y(Fe),Je||(It.scheme="",It.username="",It.password="",It.host=null,It.port=null,It.path=[],It.query=null,It.fragment=null,It.cannotBeABaseURL=!1,Fe=ft(Fe,Zt,""),Fe=ft(Fe,Kt,"$1")),Fe=ft(Fe,At,""),kt=P(Fe);Yr<=kt.length;){switch(mt=kt[Yr],Sr){case et:if(!mt||!Ye(pr,mt)){if(Je)return jt;Sr=He;continue}xr+=Pt(mt),Sr=Me;break;case Me:if(mt&&(Ye(ir,mt)||mt=="+"||mt=="-"||mt=="."))xr+=Pt(mt);else{if(mt!=":"){if(Je)return jt;xr="",Sr=He,Yr=0;continue}if(Je&&(It.isSpecial()!=M(Ae,xr)||xr=="file"&&(It.includesCredentials()||It.port!==null)||It.scheme=="file"&&!It.host))return;if(It.scheme=xr,Je)return void(It.isSpecial()&&Ae[It.scheme]==It.port&&(It.port=null));xr="",It.scheme=="file"?Sr=re:It.isSpecial()&&ct&&ct.scheme==It.scheme?Sr=Qe:It.isSpecial()?Sr=xt:kt[Yr+1]=="/"?(Sr=ht,Yr++):(It.cannotBeABaseURL=!0,we(It.path,""),Sr=ye)}break;case He:if(!ct||ct.cannotBeABaseURL&&mt!="#")return jt;if(ct.cannotBeABaseURL&&mt=="#"){It.scheme=ct.scheme,It.path=z(ct.path),It.query=ct.query,It.fragment="",It.cannotBeABaseURL=!0,Sr=Ze;break}Sr=ct.scheme=="file"?re:rt;continue;case Qe:if(mt!="/"||kt[Yr+1]!="/"){Sr=rt;continue}Sr=Nt,Yr++;break;case ht:if(mt=="/"){Sr=yr;break}Sr=$e;continue;case rt:if(It.scheme=ct.scheme,mt==p)It.username=ct.username,It.password=ct.password,It.host=ct.host,It.port=ct.port,It.path=z(ct.path),It.query=ct.query;else if(mt=="/"||mt=="\\"&&It.isSpecial())Sr=Ct;else if(mt=="?")It.username=ct.username,It.password=ct.password,It.host=ct.host,It.port=ct.port,It.path=z(ct.path),It.query="",Sr=lt;else{if(mt!="#"){It.username=ct.username,It.password=ct.password,It.host=ct.host,It.port=ct.port,It.path=z(ct.path),It.path.length--,Sr=$e;continue}It.username=ct.username,It.password=ct.password,It.host=ct.host,It.port=ct.port,It.path=z(ct.path),It.query=ct.query,It.fragment="",Sr=Ze}break;case Ct:if(!It.isSpecial()||mt!="/"&&mt!="\\"){if(mt!="/"){It.username=ct.username,It.password=ct.password,It.host=ct.host,It.port=ct.port,Sr=$e;continue}Sr=yr}else Sr=Nt;break;case xt:if(Sr=Nt,mt!="/"||Be(xr,Yr+1)!="/")continue;Yr++;break;case Nt:if(mt!="/"&&mt!="\\"){Sr=yr;continue}break;case yr:if(mt=="@"){Tn&&(xr="%40"+xr),Tn=!0,Jt=P(xr);for(var li=0;li<Jt.length;li++){var Zr=Jt[li];if(Zr!=":"||Oi){var ma=ae(Zr,mr);Oi?It.password+=ma:It.username+=ma}else Oi=!0}xr=""}else if(mt==p||mt=="/"||mt=="?"||mt=="#"||mt=="\\"&&It.isSpecial()){if(Tn&&xr=="")return"Invalid authority";Yr-=P(xr).length+1,xr="",Sr=w}else xr+=mt;break;case w:case te:if(Je&&It.scheme=="file"){Sr=Ge;continue}if(mt!=":"||Cn){if(mt==p||mt=="/"||mt=="?"||mt=="#"||mt=="\\"&&It.isSpecial()){if(It.isSpecial()&&xr=="")return Lt;if(Je&&xr==""&&(It.includesCredentials()||It.port!==null))return;if(Rr=It.parseHost(xr))return Rr;if(xr="",Sr=he,Je)return;continue}mt=="["?Cn=!0:mt=="]"&&(Cn=!1),xr+=mt}else{if(xr=="")return Lt;if(Rr=It.parseHost(xr))return Rr;if(xr="",Sr=Re,Je==te)return}break;case Re:if(!Ye(Ar,mt)){if(mt==p||mt=="/"||mt=="?"||mt=="#"||mt=="\\"&&It.isSpecial()||Je){if(xr!=""){var Co=ge(xr,10);if(Co>65535)return Gt;It.port=It.isSpecial()&&Co===Ae[It.scheme]?null:Co,xr=""}if(Je)return;Sr=he;continue}return Gt}xr+=mt;break;case re:if(It.scheme="file",mt=="/"||mt=="\\")Sr=Ee;else{if(!ct||ct.scheme!="file"){Sr=$e;continue}if(mt==p)It.host=ct.host,It.path=z(ct.path),It.query=ct.query;else if(mt=="?")It.host=ct.host,It.path=z(ct.path),It.query="",Sr=lt;else{if(mt!="#"){Xe(pt(z(kt,Yr),""))||(It.host=ct.host,It.path=z(ct.path),It.shortenPath()),Sr=$e;continue}It.host=ct.host,It.path=z(ct.path),It.query=ct.query,It.fragment="",Sr=Ze}}break;case Ee:if(mt=="/"||mt=="\\"){Sr=Ge;break}ct&&ct.scheme=="file"&&!Xe(pt(z(kt,Yr),""))&&(le(ct.path[0],!0)?we(It.path,ct.path[0]):It.host=ct.host),Sr=$e;continue;case Ge:if(mt==p||mt=="/"||mt=="\\"||mt=="?"||mt=="#"){if(!Je&&le(xr))Sr=$e;else if(xr==""){if(It.host="",Je)return;Sr=he}else{if(Rr=It.parseHost(xr))return Rr;if(It.host=="localhost"&&(It.host=""),Je)return;xr="",Sr=he}continue}xr+=mt;break;case he:if(It.isSpecial()){if(Sr=$e,mt!="/"&&mt!="\\")continue}else if(Je||mt!="?")if(Je||mt!="#"){if(mt!=p&&(Sr=$e,mt!="/"))continue}else It.fragment="",Sr=Ze;else It.query="",Sr=lt;break;case $e:if(mt==p||mt=="/"||mt=="\\"&&It.isSpecial()||!Je&&(mt=="?"||mt=="#")){if((Or=Pt(Or=xr))===".."||Or==="%2e."||Or===".%2e"||Or==="%2e%2e"?(It.shortenPath(),mt=="/"||mt=="\\"&&It.isSpecial()||we(It.path,"")):X(xr)?mt=="/"||mt=="\\"&&It.isSpecial()||we(It.path,""):(It.scheme=="file"&&!It.path.length&&le(xr)&&(It.host&&(It.host=""),xr=Be(xr,0)+":"),we(It.path,xr)),xr="",It.scheme=="file"&&(mt==p||mt=="?"||mt=="#"))for(;It.path.length>1&&It.path[0]==="";)qe(It.path);mt=="?"?(It.query="",Sr=lt):mt=="#"&&(It.fragment="",Sr=Ze)}else xr+=ae(mt,or);break;case ye:mt=="?"?(It.query="",Sr=lt):mt=="#"?(It.fragment="",Sr=Ze):mt!=p&&(It.path[0]+=ae(mt,zt));break;case lt:Je||mt!="#"?mt!=p&&(mt=="'"&&It.isSpecial()?It.query+="%27":It.query+=mt=="#"?"%23":ae(mt,zt)):(It.fragment="",Sr=Ze);break;case Ze:mt!=p&&(It.fragment+=ae(mt,vr))}Yr++}},parseHost:function(Fe){var Je,ct,kt;if(Be(Fe,0)=="["){if(Be(Fe,Fe.length-1)!="]"||(Je=function(mt){var Jt,Rr,Or,It,Sr,Yr,xr,Tn=[0,0,0,0,0,0,0,0],Cn=0,Oi=null,li=0,Zr=function(){return Be(mt,li)};if(Zr()==":"){if(Be(mt,1)!=":")return;li+=2,Oi=++Cn}for(;Zr();){if(Cn==8)return;if(Zr()!=":"){for(Jt=Rr=0;Rr<4&&Ye(Ir,Zr());)Jt=16*Jt+ge(Zr(),16),li++,Rr++;if(Zr()=="."){if(Rr==0||(li-=Rr,Cn>6))return;for(Or=0;Zr();){if(It=null,Or>0){if(!(Zr()=="."&&Or<4))return;li++}if(!Ye(Ar,Zr()))return;for(;Ye(Ar,Zr());){if(Sr=ge(Zr(),10),It===null)It=Sr;else{if(It==0)return;It=10*It+Sr}if(It>255)return;li++}Tn[Cn]=256*Tn[Cn]+It,++Or!=2&&Or!=4||Cn++}if(Or!=4)return;break}if(Zr()==":"){if(li++,!Zr())return}else if(Zr())return;Tn[Cn++]=Jt}else{if(Oi!==null)return;li++,Oi=++Cn}}if(Oi!==null)for(Yr=Cn-Oi,Cn=7;Cn!=0&&Yr>0;)xr=Tn[Cn],Tn[Cn--]=Tn[Oi+Yr-1],Tn[Oi+--Yr]=xr;else if(Cn!=8)return;return Tn}(Tt(Fe,1,-1)),!Je))return Lt;this.host=Je}else if(this.isSpecial()){if(Fe=I(Fe),Ye(St,Fe)||(Je=function(mt){var Jt,Rr,Or,It,Sr,Yr,xr,Tn=it(mt,".");if(Tn.length&&Tn[Tn.length-1]==""&&Tn.length--,(Jt=Tn.length)>4)return mt;for(Rr=[],Or=0;Or<Jt;Or++){if((It=Tn[Or])=="")return mt;if(Sr=10,It.length>1&&Be(It,0)=="0"&&(Sr=Ye(er,It)?16:8,It=Tt(It,Sr==8?1:2)),It==="")Yr=0;else{if(!Ye(Sr==10?Xt:Sr==8?yt:Ir,It))return mt;Yr=ge(It,Sr)}we(Rr,Yr)}for(Or=0;Or<Jt;Or++)if(Yr=Rr[Or],Or==Jt-1){if(Yr>=Ne(256,5-Jt))return null}else if(Yr>255)return null;for(xr=Ie(Rr),Or=0;Or<Rr.length;Or++)xr+=Rr[Or]*Ne(256,3-Or);return xr}(Fe),Je===null))return Lt;this.host=Je}else{if(Ye(Wt,Fe))return Lt;for(Je="",ct=P(Fe),kt=0;kt<ct.length;kt++)Je+=ae(ct[kt],zt);this.host=Je}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme=="file"},includesCredentials:function(){return this.username!=""||this.password!=""},isSpecial:function(){return M(Ae,this.scheme)},shortenPath:function(){var Fe=this.path,Je=Fe.length;!Je||this.scheme=="file"&&Je==1&&le(Fe[0],!0)||Fe.length--},serialize:function(){var Fe=this,Je=Fe.scheme,ct=Fe.username,kt=Fe.password,mt=Fe.host,Jt=Fe.port,Rr=Fe.path,Or=Fe.query,It=Fe.fragment,Sr=Je+":";return mt!==null?(Sr+="//",Fe.includesCredentials()&&(Sr+=ct+(kt?":"+kt:"")+"@"),Sr+=vt(mt),Jt!==null&&(Sr+=":"+Jt)):Je=="file"&&(Sr+="//"),Sr+=Fe.cannotBeABaseURL?Rr[0]:Rr.length?"/"+pt(Rr,"/"):"",Or!==null&&(Sr+="?"+Or),It!==null&&(Sr+="#"+It),Sr},setHref:function(Fe){var Je=this.parse(Fe);if(Je)throw Oe(Je);this.searchParams.update()},getOrigin:function(){var Fe=this.scheme,Je=this.port;if(Fe=="blob")try{return new Q(Fe.path[0]).origin}catch{return"null"}return Fe!="file"&&this.isSpecial()?Fe+"://"+vt(this.host)+(Je!==null?":"+Je:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(Fe){this.parse(Y(Fe)+":",et)},getUsername:function(){return this.username},setUsername:function(Fe){var Je=P(Y(Fe));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var ct=0;ct<Je.length;ct++)this.username+=ae(Je[ct],mr)}},getPassword:function(){return this.password},setPassword:function(Fe){var Je=P(Y(Fe));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var ct=0;ct<Je.length;ct++)this.password+=ae(Je[ct],mr)}},getHost:function(){var Fe=this.host,Je=this.port;return Fe===null?"":Je===null?vt(Fe):vt(Fe)+":"+Je},setHost:function(Fe){this.cannotBeABaseURL||this.parse(Fe,w)},getHostname:function(){var Fe=this.host;return Fe===null?"":vt(Fe)},setHostname:function(Fe){this.cannotBeABaseURL||this.parse(Fe,te)},getPort:function(){var Fe=this.port;return Fe===null?"":Y(Fe)},setPort:function(Fe){this.cannotHaveUsernamePasswordPort()||((Fe=Y(Fe))==""?this.port=null:this.parse(Fe,Re))},getPathname:function(){var Fe=this.path;return this.cannotBeABaseURL?Fe[0]:Fe.length?"/"+pt(Fe,"/"):""},setPathname:function(Fe){this.cannotBeABaseURL||(this.path=[],this.parse(Fe,he))},getSearch:function(){var Fe=this.query;return Fe?"?"+Fe:""},setSearch:function(Fe){(Fe=Y(Fe))==""?this.query=null:(Be(Fe,0)=="?"&&(Fe=Tt(Fe,1)),this.query="",this.parse(Fe,lt)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var Fe=this.fragment;return Fe?"#"+Fe:""},setHash:function(Fe){(Fe=Y(Fe))!=""?(Be(Fe,0)=="#"&&(Fe=Tt(Fe,1)),this.fragment="",this.parse(Fe,Ze)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Q=function(Fe){var Je=U(this,Te),ct=oe(arguments.length,1)>1?arguments[1]:void 0,kt=ee(Je,new Dt(Fe,!1,ct));T||(Je.href=kt.serialize(),Je.origin=kt.getOrigin(),Je.protocol=kt.getProtocol(),Je.username=kt.getUsername(),Je.password=kt.getPassword(),Je.host=kt.getHost(),Je.hostname=kt.getHostname(),Je.port=kt.getPort(),Je.pathname=kt.getPathname(),Je.search=kt.getSearch(),Je.searchParams=kt.getSearchParams(),Je.hash=kt.getHash())},Te=Q.prototype,pe=function(Fe,Je){return{get:function(){return H(this)[Fe]()},set:Je&&function(ct){return H(this)[Je](ct)},configurable:!0,enumerable:!0}};if(T&&(C(Te,"href",pe("serialize","setHref")),C(Te,"origin",pe("getOrigin")),C(Te,"protocol",pe("getProtocol","setProtocol")),C(Te,"username",pe("getUsername","setUsername")),C(Te,"password",pe("getPassword","setPassword")),C(Te,"host",pe("getHost","setHost")),C(Te,"hostname",pe("getHostname","setHostname")),C(Te,"port",pe("getPort","setPort")),C(Te,"pathname",pe("getPathname","setPathname")),C(Te,"search",pe("getSearch","setSearch")),C(Te,"searchParams",pe("getSearchParams")),C(Te,"hash",pe("getHash","setHash"))),N(Te,"toJSON",function(){return H(this).serialize()},{enumerable:!0}),N(Te,"toString",function(){return H(this).serialize()},{enumerable:!0}),Le){var Ue=Le.createObjectURL,xe=Le.revokeObjectURL;Ue&&N(Q,"createObjectURL",y(Ue,Le)),xe&&N(Q,"revokeObjectURL",y(xe,Le))}F(Q,"URL"),f({global:!0,constructor:!0,forced:!v,sham:!T},{URL:Q})},285:function(O,j,c){c(8789)},5717:function(O){typeof Object.create=="function"?O.exports=function(j,c){c&&(j.super_=c,j.prototype=Object.create(c.prototype,{constructor:{value:j,enumerable:!1,writable:!0,configurable:!0}}))}:O.exports=function(j,c){if(c){j.super_=c;var p=function(){};p.prototype=c.prototype,j.prototype=new p,j.prototype.constructor=j}}},3720:function(O){O.exports=c;var j=null;try{j=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function c(H,q,ve){this.low=0|H,this.high=0|q,this.unsigned=!!ve}function p(H){return(H&&H.__isLong__)===!0}c.prototype.__isLong__,Object.defineProperty(c.prototype,"__isLong__",{value:!0}),c.isLong=p;var f={},T={};function v(H,q){var ve,Le,Oe;return q?(Oe=0<=(H>>>=0)&&H<256)&&(Le=T[H])?Le:(ve=y(H,(0|H)<0?-1:0,!0),Oe&&(T[H]=ve),ve):(Oe=-128<=(H|=0)&&H<128)&&(Le=f[H])?Le:(ve=y(H,H<0?-1:0,!1),Oe&&(f[H]=ve),ve)}function S(H,q){if(isNaN(H))return q?Z:z;if(q){if(H<0)return Z;if(H>=M)return W}else{if(H<=-x)return ne;if(H+1>=x)return oe}return H<0?S(-H,q).neg():y(H%U|0,H/U|0,q)}function y(H,q,ve){return new c(H,q,ve)}c.fromInt=v,c.fromNumber=S,c.fromBits=y;var E=Math.pow;function N(H,q,ve){if(H.length===0)throw Error("empty string");if(H==="NaN"||H==="Infinity"||H==="+Infinity"||H==="-Infinity")return z;if(typeof q=="number"?(ve=q,q=!1):q=!!q,(ve=ve||10)<2||36<ve)throw RangeError("radix");var Le;if((Le=H.indexOf("-"))>0)throw Error("interior hyphen");if(Le===0)return N(H.substring(1),q,ve).neg();for(var Oe=S(E(ve,8)),ge=z,je=0;je<H.length;je+=8){var Ne=Math.min(8,H.length-je),Be=parseInt(H.substring(je,je+Ne),ve);if(Ne<8){var Ye=S(E(ve,Ne));ge=ge.mul(Ye).add(S(Be))}else ge=(ge=ge.mul(Oe)).add(S(Be))}return ge.unsigned=q,ge}function C(H,q){return typeof H=="number"?S(H,q):typeof H=="string"?N(H,q):y(H.low,H.high,typeof q=="boolean"?q:H.unsigned)}c.fromString=N,c.fromValue=C;var U=4294967296,M=U*U,x=M/2,P=v(1<<24),z=v(0);c.ZERO=z;var Z=v(0,!0);c.UZERO=Z;var I=v(1);c.ONE=I;var Y=v(1,!0);c.UONE=Y;var F=v(-1);c.NEG_ONE=F;var oe=y(-1,2147483647,!1);c.MAX_VALUE=oe;var W=y(-1,-1,!0);c.MAX_UNSIGNED_VALUE=W;var ne=y(0,-2147483648,!1);c.MIN_VALUE=ne;var ee=c.prototype;ee.toInt=function(){return this.unsigned?this.low>>>0:this.low},ee.toNumber=function(){return this.unsigned?(this.high>>>0)*U+(this.low>>>0):this.high*U+(this.low>>>0)},ee.toString=function(H){if((H=H||10)<2||36<H)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(ne)){var q=S(H),ve=this.div(q),Le=ve.mul(q).sub(this);return ve.toString(H)+Le.toInt().toString(H)}return"-"+this.neg().toString(H)}for(var Oe=S(E(H,6),this.unsigned),ge=this,je="";;){var Ne=ge.div(Oe),Be=(ge.sub(Ne.mul(Oe)).toInt()>>>0).toString(H);if((ge=Ne).isZero())return Be+je;for(;Be.length<6;)Be="0"+Be;je=""+Be+je}},ee.getHighBits=function(){return this.high},ee.getHighBitsUnsigned=function(){return this.high>>>0},ee.getLowBits=function(){return this.low},ee.getLowBitsUnsigned=function(){return this.low>>>0},ee.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ne)?64:this.neg().getNumBitsAbs();for(var H=this.high!=0?this.high:this.low,q=31;q>0&&(H&1<<q)==0;q--);return this.high!=0?q+33:q+1},ee.isZero=function(){return this.high===0&&this.low===0},ee.eqz=ee.isZero,ee.isNegative=function(){return!this.unsigned&&this.high<0},ee.isPositive=function(){return this.unsigned||this.high>=0},ee.isOdd=function(){return(1&this.low)==1},ee.isEven=function(){return(1&this.low)==0},ee.equals=function(H){return p(H)||(H=C(H)),(this.unsigned===H.unsigned||this.high>>>31!=1||H.high>>>31!=1)&&this.high===H.high&&this.low===H.low},ee.eq=ee.equals,ee.notEquals=function(H){return!this.eq(H)},ee.neq=ee.notEquals,ee.ne=ee.notEquals,ee.lessThan=function(H){return this.comp(H)<0},ee.lt=ee.lessThan,ee.lessThanOrEqual=function(H){return this.comp(H)<=0},ee.lte=ee.lessThanOrEqual,ee.le=ee.lessThanOrEqual,ee.greaterThan=function(H){return this.comp(H)>0},ee.gt=ee.greaterThan,ee.greaterThanOrEqual=function(H){return this.comp(H)>=0},ee.gte=ee.greaterThanOrEqual,ee.ge=ee.greaterThanOrEqual,ee.compare=function(H){if(p(H)||(H=C(H)),this.eq(H))return 0;var q=this.isNegative(),ve=H.isNegative();return q&&!ve?-1:!q&&ve?1:this.unsigned?H.high>>>0>this.high>>>0||H.high===this.high&&H.low>>>0>this.low>>>0?-1:1:this.sub(H).isNegative()?-1:1},ee.comp=ee.compare,ee.negate=function(){return!this.unsigned&&this.eq(ne)?ne:this.not().add(I)},ee.neg=ee.negate,ee.add=function(H){p(H)||(H=C(H));var q=this.high>>>16,ve=65535&this.high,Le=this.low>>>16,Oe=65535&this.low,ge=H.high>>>16,je=65535&H.high,Ne=H.low>>>16,Be=0,Ye=0,pt=0,dt=0;return pt+=(dt+=Oe+(65535&H.low))>>>16,Ye+=(pt+=Le+Ne)>>>16,Be+=(Ye+=ve+je)>>>16,Be+=q+ge,y((pt&=65535)<<16|(dt&=65535),(Be&=65535)<<16|(Ye&=65535),this.unsigned)},ee.subtract=function(H){return p(H)||(H=C(H)),this.add(H.neg())},ee.sub=ee.subtract,ee.multiply=function(H){if(this.isZero())return z;if(p(H)||(H=C(H)),j)return y(j.mul(this.low,this.high,H.low,H.high),j.get_high(),this.unsigned);if(H.isZero())return z;if(this.eq(ne))return H.isOdd()?ne:z;if(H.eq(ne))return this.isOdd()?ne:z;if(this.isNegative())return H.isNegative()?this.neg().mul(H.neg()):this.neg().mul(H).neg();if(H.isNegative())return this.mul(H.neg()).neg();if(this.lt(P)&&H.lt(P))return S(this.toNumber()*H.toNumber(),this.unsigned);var q=this.high>>>16,ve=65535&this.high,Le=this.low>>>16,Oe=65535&this.low,ge=H.high>>>16,je=65535&H.high,Ne=H.low>>>16,Be=65535&H.low,Ye=0,pt=0,dt=0,Ie=0;return dt+=(Ie+=Oe*Be)>>>16,pt+=(dt+=Le*Be)>>>16,dt&=65535,pt+=(dt+=Oe*Ne)>>>16,Ye+=(pt+=ve*Be)>>>16,pt&=65535,Ye+=(pt+=Le*Ne)>>>16,pt&=65535,Ye+=(pt+=Oe*je)>>>16,Ye+=q*Be+ve*Ne+Le*je+Oe*ge,y((dt&=65535)<<16|(Ie&=65535),(Ye&=65535)<<16|(pt&=65535),this.unsigned)},ee.mul=ee.multiply,ee.divide=function(H){if(p(H)||(H=C(H)),H.isZero())throw Error("division by zero");var q,ve,Le;if(j)return this.unsigned||this.high!==-2147483648||H.low!==-1||H.high!==-1?y((this.unsigned?j.div_u:j.div_s)(this.low,this.high,H.low,H.high),j.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Z:z;if(this.unsigned){if(H.unsigned||(H=H.toUnsigned()),H.gt(this))return Z;if(H.gt(this.shru(1)))return Y;Le=Z}else{if(this.eq(ne))return H.eq(I)||H.eq(F)?ne:H.eq(ne)?I:(q=this.shr(1).div(H).shl(1)).eq(z)?H.isNegative()?I:F:(ve=this.sub(H.mul(q)),Le=q.add(ve.div(H)));if(H.eq(ne))return this.unsigned?Z:z;if(this.isNegative())return H.isNegative()?this.neg().div(H.neg()):this.neg().div(H).neg();if(H.isNegative())return this.div(H.neg()).neg();Le=z}for(ve=this;ve.gte(H);){q=Math.max(1,Math.floor(ve.toNumber()/H.toNumber()));for(var Oe=Math.ceil(Math.log(q)/Math.LN2),ge=Oe<=48?1:E(2,Oe-48),je=S(q),Ne=je.mul(H);Ne.isNegative()||Ne.gt(ve);)Ne=(je=S(q-=ge,this.unsigned)).mul(H);je.isZero()&&(je=I),Le=Le.add(je),ve=ve.sub(Ne)}return Le},ee.div=ee.divide,ee.modulo=function(H){return p(H)||(H=C(H)),j?y((this.unsigned?j.rem_u:j.rem_s)(this.low,this.high,H.low,H.high),j.get_high(),this.unsigned):this.sub(this.div(H).mul(H))},ee.mod=ee.modulo,ee.rem=ee.modulo,ee.not=function(){return y(~this.low,~this.high,this.unsigned)},ee.and=function(H){return p(H)||(H=C(H)),y(this.low&H.low,this.high&H.high,this.unsigned)},ee.or=function(H){return p(H)||(H=C(H)),y(this.low|H.low,this.high|H.high,this.unsigned)},ee.xor=function(H){return p(H)||(H=C(H)),y(this.low^H.low,this.high^H.high,this.unsigned)},ee.shiftLeft=function(H){return p(H)&&(H=H.toInt()),(H&=63)==0?this:H<32?y(this.low<<H,this.high<<H|this.low>>>32-H,this.unsigned):y(0,this.low<<H-32,this.unsigned)},ee.shl=ee.shiftLeft,ee.shiftRight=function(H){return p(H)&&(H=H.toInt()),(H&=63)==0?this:H<32?y(this.low>>>H|this.high<<32-H,this.high>>H,this.unsigned):y(this.high>>H-32,this.high>=0?0:-1,this.unsigned)},ee.shr=ee.shiftRight,ee.shiftRightUnsigned=function(H){if(p(H)&&(H=H.toInt()),(H&=63)==0)return this;var q=this.high;return H<32?y(this.low>>>H|q<<32-H,q>>>H,this.unsigned):y(H===32?q:q>>>H-32,0,this.unsigned)},ee.shru=ee.shiftRightUnsigned,ee.shr_u=ee.shiftRightUnsigned,ee.toSigned=function(){return this.unsigned?y(this.low,this.high,!1):this},ee.toUnsigned=function(){return this.unsigned?this:y(this.low,this.high,!0)},ee.toBytes=function(H){return H?this.toBytesLE():this.toBytesBE()},ee.toBytesLE=function(){var H=this.high,q=this.low;return[255&q,q>>>8&255,q>>>16&255,q>>>24,255&H,H>>>8&255,H>>>16&255,H>>>24]},ee.toBytesBE=function(){var H=this.high,q=this.low;return[H>>>24,H>>>16&255,H>>>8&255,255&H,q>>>24,q>>>16&255,q>>>8&255,255&q]},c.fromBytes=function(H,q,ve){return ve?c.fromBytesLE(H,q):c.fromBytesBE(H,q)},c.fromBytesLE=function(H,q){return new c(H[0]|H[1]<<8|H[2]<<16|H[3]<<24,H[4]|H[5]<<8|H[6]<<16|H[7]<<24,q)},c.fromBytesBE=function(H,q){return new c(H[4]<<24|H[5]<<16|H[6]<<8|H[7],H[0]<<24|H[1]<<16|H[2]<<8|H[3],q)}},3281:function(O,j,c){O.exports=c(9050)},2967:function(O){O.exports=p;var j,c=/\/|\./;function p(f,T){c.test(f)||(f="google/protobuf/"+f+".proto",T={nested:{google:{nested:{protobuf:{nested:T}}}}}),p[f]=T}p("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),p("duration",{Duration:j={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),p("timestamp",{Timestamp:j}),p("empty",{Empty:{fields:{}}}),p("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),p("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),p("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),p.get=function(f){return p[f]||null}},3996:function(O,j,c){var p=j,f=c(7025),T=c(9935);function v(y,E,N,C){if(E.resolvedType)if(E.resolvedType instanceof f){y("switch(d%s){",C);for(var U=E.resolvedType.values,M=Object.keys(U),x=0;x<M.length;++x)E.repeated&&U[M[x]]===E.typeDefault&&y("default:"),y("case%j:",M[x])("case %i:",U[M[x]])("m%s=%j",C,U[M[x]])("break");y("}")}else y('if(typeof d%s!=="object")',C)("throw TypeError(%j)",E.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",C,N,C);else{var P=!1;switch(E.type){case"double":case"float":y("m%s=Number(d%s)",C,C);break;case"uint32":case"fixed32":y("m%s=d%s>>>0",C,C);break;case"int32":case"sint32":case"sfixed32":y("m%s=d%s|0",C,C);break;case"uint64":P=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":y("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",C,C,P)('else if(typeof d%s==="string")',C)("m%s=parseInt(d%s,10)",C,C)('else if(typeof d%s==="number")',C)("m%s=d%s",C,C)('else if(typeof d%s==="object")',C)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",C,C,C,P?"true":"");break;case"bytes":y('if(typeof d%s==="string")',C)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",C,C,C)("else if(d%s.length)",C)("m%s=d%s",C,C);break;case"string":y("m%s=String(d%s)",C,C);break;case"bool":y("m%s=Boolean(d%s)",C,C)}}return y}function S(y,E,N,C){if(E.resolvedType)E.resolvedType instanceof f?y("d%s=o.enums===String?types[%i].values[m%s]:m%s",C,N,C,C):y("d%s=types[%i].toObject(m%s,o)",C,N,C);else{var U=!1;switch(E.type){case"double":case"float":y("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",C,C,C,C);break;case"uint64":U=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":y('if(typeof m%s==="number")',C)("d%s=o.longs===String?String(m%s):m%s",C,C,C)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",C,C,C,C,U?"true":"",C);break;case"bytes":y("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",C,C,C,C,C);break;default:y("d%s=m%s",C,C)}}return y}p.fromObject=function(y){var E=y.fieldsArray,N=T.codegen(["d"],y.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!E.length)return N("return new this.ctor");N("var m=new this.ctor");for(var C=0;C<E.length;++C){var U=E[C].resolve(),M=T.safeProp(U.name);U.map?(N("if(d%s){",M)('if(typeof d%s!=="object")',M)("throw TypeError(%j)",U.fullName+": object expected")("m%s={}",M)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",M),v(N,U,C,M+"[ks[i]]")("}")("}")):U.repeated?(N("if(d%s){",M)("if(!Array.isArray(d%s))",M)("throw TypeError(%j)",U.fullName+": array expected")("m%s=[]",M)("for(var i=0;i<d%s.length;++i){",M),v(N,U,C,M+"[i]")("}")("}")):(U.resolvedType instanceof f||N("if(d%s!=null){",M),v(N,U,C,M),U.resolvedType instanceof f||N("}"))}return N("return m")},p.toObject=function(y){var E=y.fieldsArray.slice().sort(T.compareFieldsById);if(!E.length)return T.codegen()("return {}");for(var N=T.codegen(["m","o"],y.name+"$toObject")("if(!o)")("o={}")("var d={}"),C=[],U=[],M=[],x=0;x<E.length;++x)E[x].partOf||(E[x].resolve().repeated?C:E[x].map?U:M).push(E[x]);if(C.length){for(N("if(o.arrays||o.defaults){"),x=0;x<C.length;++x)N("d%s=[]",T.safeProp(C[x].name));N("}")}if(U.length){for(N("if(o.objects||o.defaults){"),x=0;x<U.length;++x)N("d%s={}",T.safeProp(U[x].name));N("}")}if(M.length){for(N("if(o.defaults){"),x=0;x<M.length;++x){var P=M[x],z=T.safeProp(P.name);if(P.resolvedType instanceof f)N("d%s=o.enums===String?%j:%j",z,P.resolvedType.valuesById[P.typeDefault],P.typeDefault);else if(P.long)N("if(util.Long){")("var n=new util.Long(%i,%i,%j)",P.typeDefault.low,P.typeDefault.high,P.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",z)("}else")("d%s=o.longs===String?%j:%i",z,P.typeDefault.toString(),P.typeDefault.toNumber());else if(P.bytes){var Z="["+Array.prototype.slice.call(P.typeDefault).join(",")+"]";N("if(o.bytes===String)d%s=%j",z,String.fromCharCode.apply(String,P.typeDefault))("else{")("d%s=%s",z,Z)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",z,z)("}")}else N("d%s=%j",z,P.typeDefault)}N("}")}var I=!1;for(x=0;x<E.length;++x){P=E[x];var Y=y._fieldsArray.indexOf(P);z=T.safeProp(P.name),P.map?(I||(I=!0,N("var ks2")),N("if(m%s&&(ks2=Object.keys(m%s)).length){",z,z)("d%s={}",z)("for(var j=0;j<ks2.length;++j){"),S(N,P,Y,z+"[ks2[j]]")("}")):P.repeated?(N("if(m%s&&m%s.length){",z,z)("d%s=[]",z)("for(var j=0;j<m%s.length;++j){",z),S(N,P,Y,z+"[j]")("}")):(N("if(m%s!=null&&m.hasOwnProperty(%j)){",z,P.name),S(N,P,Y,z),P.partOf&&N("if(o.oneofs)")("d%s=%j",T.safeProp(P.partOf.name),P.name)),N("}")}return N("return d")}},5305:function(O,j,c){O.exports=function(S){var y=T.codegen(["r","l"],S.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(S.fieldsArray.filter(function(x){return x.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");S.group&&y("if((t&7)===4)")("break"),y("switch(t>>>3){");for(var E=0;E<S.fieldsArray.length;++E){var N=S._fieldsArray[E].resolve(),C=N.resolvedType instanceof p?"int32":N.type,U="m"+T.safeProp(N.name);y("case %i:",N.id),N.map?(y("if(%s===util.emptyObject)",U)("%s={}",U)("var c2 = r.uint32()+r.pos"),f.defaults[N.keyType]!==void 0?y("k=%j",f.defaults[N.keyType]):y("k=null"),f.defaults[C]!==void 0?y("value=%j",f.defaults[C]):y("value=null"),y("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",N.keyType)("case 2:"),f.basic[C]===void 0?y("value=types[%i].decode(r,r.uint32())",E):y("value=r.%s()",C),y("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),f.long[N.keyType]!==void 0?y('%s[typeof k==="object"?util.longToHash(k):k]=value',U):y("%s[k]=value",U)):N.repeated?(y("if(!(%s&&%s.length))",U,U)("%s=[]",U),f.packed[C]!==void 0&&y("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",U,C)("}else"),f.basic[C]===void 0?y(N.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",U,E):y("%s.push(r.%s())",U,C)):f.basic[C]===void 0?y(N.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",U,E):y("%s=r.%s()",U,C),y("break")}for(y("default:")("r.skipType(t&7)")("break")("}")("}"),E=0;E<S._fieldsArray.length;++E){var M=S._fieldsArray[E];M.required&&y("if(!m.hasOwnProperty(%j))",M.name)("throw util.ProtocolError(%j,{instance:m})",v(M))}return y("return m")};var p=c(7025),f=c(7063),T=c(9935);function v(S){return"missing required '"+S.name+"'"}},4928:function(O,j,c){O.exports=function(S){for(var y,E=T.codegen(["m","w"],S.name+"$encode")("if(!w)")("w=Writer.create()"),N=S.fieldsArray.slice().sort(T.compareFieldsById),C=0;C<N.length;++C){var U=N[C].resolve(),M=S._fieldsArray.indexOf(U),x=U.resolvedType instanceof p?"int32":U.type,P=f.basic[x];y="m"+T.safeProp(U.name),U.map?(E("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",y,U.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",y)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(U.id<<3|2)>>>0,8|f.mapKey[U.keyType],U.keyType),P===void 0?E("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",M,y):E(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|P,x,y),E("}")("}")):U.repeated?(E("if(%s!=null&&%s.length){",y,y),U.packed&&f.packed[x]!==void 0?E("w.uint32(%i).fork()",(U.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",y)("w.%s(%s[i])",x,y)("w.ldelim()"):(E("for(var i=0;i<%s.length;++i)",y),P===void 0?v(E,U,M,y+"[i]"):E("w.uint32(%i).%s(%s[i])",(U.id<<3|P)>>>0,x,y)),E("}")):(U.optional&&E("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",y,U.name),P===void 0?v(E,U,M,y):E("w.uint32(%i).%s(%s)",(U.id<<3|P)>>>0,x,y))}return E("return w")};var p=c(7025),f=c(7063),T=c(9935);function v(S,y,E,N){return y.resolvedType.group?S("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",E,N,(y.id<<3|3)>>>0,(y.id<<3|4)>>>0):S("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",E,N,(y.id<<3|2)>>>0)}},7025:function(O,j,c){O.exports=v;var p=c(3243);((v.prototype=Object.create(p.prototype)).constructor=v).className="Enum";var f=c(9313),T=c(9935);function v(S,y,E,N,C){if(p.call(this,S,E),y&&typeof y!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=N,this.comments=C||{},this.reserved=void 0,y)for(var U=Object.keys(y),M=0;M<U.length;++M)typeof y[U[M]]=="number"&&(this.valuesById[this.values[U[M]]=y[U[M]]]=U[M])}v.fromJSON=function(S,y){var E=new v(S,y.values,y.options,y.comment,y.comments);return E.reserved=y.reserved,E},v.prototype.toJSON=function(S){var y=!!S&&!!S.keepComments;return T.toObject(["options",this.options,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",y?this.comment:void 0,"comments",y?this.comments:void 0])},v.prototype.add=function(S,y,E){if(!T.isString(S))throw TypeError("name must be a string");if(!T.isInteger(y))throw TypeError("id must be an integer");if(this.values[S]!==void 0)throw Error("duplicate name '"+S+"' in "+this);if(this.isReservedId(y))throw Error("id "+y+" is reserved in "+this);if(this.isReservedName(S))throw Error("name '"+S+"' is reserved in "+this);if(this.valuesById[y]!==void 0){if(!this.options||!this.options.allow_alias)throw Error("duplicate id "+y+" in "+this);this.values[S]=y}else this.valuesById[this.values[S]=y]=S;return this.comments[S]=E||null,this},v.prototype.remove=function(S){if(!T.isString(S))throw TypeError("name must be a string");var y=this.values[S];if(y==null)throw Error("name '"+S+"' does not exist in "+this);return delete this.valuesById[y],delete this.values[S],delete this.comments[S],this},v.prototype.isReservedId=function(S){return f.isReservedId(this.reserved,S)},v.prototype.isReservedName=function(S){return f.isReservedName(this.reserved,S)}},3548:function(O,j,c){O.exports=E;var p=c(3243);((E.prototype=Object.create(p.prototype)).constructor=E).className="Field";var f,T=c(7025),v=c(7063),S=c(9935),y=/^required|optional|repeated$/;function E(N,C,U,M,x,P,z){if(S.isObject(M)?(z=x,P=M,M=x=void 0):S.isObject(x)&&(z=P,P=x,x=void 0),p.call(this,N,P),!S.isInteger(C)||C<0)throw TypeError("id must be a non-negative integer");if(!S.isString(U))throw TypeError("type must be a string");if(M!==void 0&&!y.test(M=M.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(x!==void 0&&!S.isString(x))throw TypeError("extend must be a string");M==="proto3_optional"&&(M="optional"),this.rule=M&&M!=="optional"?M:void 0,this.type=U,this.id=C,this.extend=x||void 0,this.required=M==="required",this.optional=!this.required,this.repeated=M==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!S.Long&&v.long[U]!==void 0,this.bytes=U==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=z}E.fromJSON=function(N,C){return new E(N,C.id,C.type,C.rule,C.extend,C.options,C.comment)},Object.defineProperty(E.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}}),E.prototype.setOption=function(N,C,U){return N==="packed"&&(this._packed=null),p.prototype.setOption.call(this,N,C,U)},E.prototype.toJSON=function(N){var C=!!N&&!!N.keepComments;return S.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",C?this.comment:void 0])},E.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=v.defaults[this.type])===void 0&&(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof f?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof T&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(this.options.packed!==!0&&(this.options.packed===void 0||!this.resolvedType||this.resolvedType instanceof T)||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=S.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var N;S.base64.test(this.typeDefault)?S.base64.decode(this.typeDefault,N=S.newBuffer(S.base64.length(this.typeDefault)),0):S.utf8.write(this.typeDefault,N=S.newBuffer(S.utf8.length(this.typeDefault)),0),this.typeDefault=N}return this.map?this.defaultValue=S.emptyObject:this.repeated?this.defaultValue=S.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof f&&(this.parent.ctor.prototype[this.name]=this.defaultValue),p.prototype.resolve.call(this)},E.d=function(N,C,U,M){return typeof C=="function"?C=S.decorateType(C).name:C&&typeof C=="object"&&(C=S.decorateEnum(C).name),function(x,P){S.decorateType(x.constructor).add(new E(P,N,C,U,{default:M}))}},E._configure=function(N){f=N}},8836:function(O,j,c){var p=O.exports=c(9482);p.build="light",p.load=function(f,T,v){return typeof T=="function"?(v=T,T=new p.Root):T||(T=new p.Root),T.load(f,v)},p.loadSync=function(f,T){return T||(T=new p.Root),T.loadSync(f)},p.encoder=c(4928),p.decoder=c(5305),p.verifier=c(4497),p.converter=c(3996),p.ReflectionObject=c(3243),p.Namespace=c(9313),p.Root=c(9424),p.Enum=c(7025),p.Type=c(7645),p.Field=c(3548),p.OneOf=c(7598),p.MapField=c(6039),p.Service=c(7513),p.Method=c(4429),p.Message=c(8368),p.wrappers=c(1667),p.types=c(7063),p.util=c(9935),p.ReflectionObject._configure(p.Root),p.Namespace._configure(p.Type,p.Service,p.Enum),p.Root._configure(p.Type),p.Field._configure(p.Type)},9482:function(O,j,c){var p=j;function f(){p.util._configure(),p.Writer._configure(p.BufferWriter),p.Reader._configure(p.BufferReader)}p.build="minimal",p.Writer=c(1173),p.BufferWriter=c(3155),p.Reader=c(1408),p.BufferReader=c(593),p.util=c(9693),p.rpc=c(5994),p.roots=c(5054),p.configure=f,f()},9050:function(O,j,c){var p=O.exports=c(8836);p.build="full",p.tokenize=c(626),p.parse=c(2228),p.common=c(2967),p.Root._configure(p.Type,p.parse,p.common)},6039:function(O,j,c){O.exports=v;var p=c(3548);((v.prototype=Object.create(p.prototype)).constructor=v).className="MapField";var f=c(7063),T=c(9935);function v(S,y,E,N,C,U){if(p.call(this,S,y,N,void 0,void 0,C,U),!T.isString(E))throw TypeError("keyType must be a string");this.keyType=E,this.resolvedKeyType=null,this.map=!0}v.fromJSON=function(S,y){return new v(S,y.id,y.keyType,y.type,y.options,y.comment)},v.prototype.toJSON=function(S){var y=!!S&&!!S.keepComments;return T.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",y?this.comment:void 0])},v.prototype.resolve=function(){if(this.resolved)return this;if(f.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return p.prototype.resolve.call(this)},v.d=function(S,y,E){return typeof E=="function"?E=T.decorateType(E).name:E&&typeof E=="object"&&(E=T.decorateEnum(E).name),function(N,C){T.decorateType(N.constructor).add(new v(C,S,y,E))}}},8368:function(O,j,c){O.exports=f;var p=c(9693);function f(T){if(T)for(var v=Object.keys(T),S=0;S<v.length;++S)this[v[S]]=T[v[S]]}f.create=function(T){return this.$type.create(T)},f.encode=function(T,v){return this.$type.encode(T,v)},f.encodeDelimited=function(T,v){return this.$type.encodeDelimited(T,v)},f.decode=function(T){return this.$type.decode(T)},f.decodeDelimited=function(T){return this.$type.decodeDelimited(T)},f.verify=function(T){return this.$type.verify(T)},f.fromObject=function(T){return this.$type.fromObject(T)},f.toObject=function(T,v){return this.$type.toObject(T,v)},f.prototype.toJSON=function(){return this.$type.toObject(this,p.toJSONOptions)}},4429:function(O,j,c){O.exports=T;var p=c(3243);((T.prototype=Object.create(p.prototype)).constructor=T).className="Method";var f=c(9935);function T(v,S,y,E,N,C,U,M,x){if(f.isObject(N)?(U=N,N=C=void 0):f.isObject(C)&&(U=C,C=void 0),S!==void 0&&!f.isString(S))throw TypeError("type must be a string");if(!f.isString(y))throw TypeError("requestType must be a string");if(!f.isString(E))throw TypeError("responseType must be a string");p.call(this,v,U),this.type=S||"rpc",this.requestType=y,this.requestStream=!!N||void 0,this.responseType=E,this.responseStream=!!C||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=M,this.parsedOptions=x}T.fromJSON=function(v,S){return new T(v,S.type,S.requestType,S.responseType,S.requestStream,S.responseStream,S.options,S.comment,S.parsedOptions)},T.prototype.toJSON=function(v){var S=!!v&&!!v.keepComments;return f.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",S?this.comment:void 0,"parsedOptions",this.parsedOptions])},T.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),p.prototype.resolve.call(this))}},9313:function(O,j,c){O.exports=C;var p=c(3243);((C.prototype=Object.create(p.prototype)).constructor=C).className="Namespace";var f,T,v,S=c(3548),y=c(7598),E=c(9935);function N(M,x){if(M&&M.length){for(var P={},z=0;z<M.length;++z)P[M[z].name]=M[z].toJSON(x);return P}}function C(M,x){p.call(this,M,x),this.nested=void 0,this._nestedArray=null}function U(M){return M._nestedArray=null,M}C.fromJSON=function(M,x){return new C(M,x.options).addJSON(x.nested)},C.arrayToJSON=N,C.isReservedId=function(M,x){if(M){for(var P=0;P<M.length;++P)if(typeof M[P]!="string"&&M[P][0]<=x&&M[P][1]>x)return!0}return!1},C.isReservedName=function(M,x){if(M){for(var P=0;P<M.length;++P)if(M[P]===x)return!0}return!1},Object.defineProperty(C.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=E.toArray(this.nested))}}),C.prototype.toJSON=function(M){return E.toObject(["options",this.options,"nested",N(this.nestedArray,M)])},C.prototype.addJSON=function(M){if(M)for(var x,P=Object.keys(M),z=0;z<P.length;++z)x=M[P[z]],this.add((x.fields!==void 0?f.fromJSON:x.values!==void 0?v.fromJSON:x.methods!==void 0?T.fromJSON:x.id!==void 0?S.fromJSON:C.fromJSON)(P[z],x));return this},C.prototype.get=function(M){return this.nested&&this.nested[M]||null},C.prototype.getEnum=function(M){if(this.nested&&this.nested[M]instanceof v)return this.nested[M].values;throw Error("no such enum: "+M)},C.prototype.add=function(M){if(!(M instanceof S&&M.extend!==void 0||M instanceof f||M instanceof v||M instanceof T||M instanceof C||M instanceof y))throw TypeError("object must be a valid nested object");if(this.nested){var x=this.get(M.name);if(x){if(!(x instanceof C&&M instanceof C)||x instanceof f||x instanceof T)throw Error("duplicate name '"+M.name+"' in "+this);for(var P=x.nestedArray,z=0;z<P.length;++z)M.add(P[z]);this.remove(x),this.nested||(this.nested={}),M.setOptions(x.options,!0)}}else this.nested={};return this.nested[M.name]=M,M.onAdd(this),U(this)},C.prototype.remove=function(M){if(!(M instanceof p))throw TypeError("object must be a ReflectionObject");if(M.parent!==this)throw Error(M+" is not a member of "+this);return delete this.nested[M.name],Object.keys(this.nested).length||(this.nested=void 0),M.onRemove(this),U(this)},C.prototype.define=function(M,x){if(E.isString(M))M=M.split(".");else if(!Array.isArray(M))throw TypeError("illegal path");if(M&&M.length&&M[0]==="")throw Error("path must be relative");for(var P=this;M.length>0;){var z=M.shift();if(P.nested&&P.nested[z]){if(!((P=P.nested[z])instanceof C))throw Error("path conflicts with non-namespace objects")}else P.add(P=new C(z))}return x&&P.addJSON(x),P},C.prototype.resolveAll=function(){for(var M=this.nestedArray,x=0;x<M.length;)M[x]instanceof C?M[x++].resolveAll():M[x++].resolve();return this.resolve()},C.prototype.lookup=function(M,x,P){if(typeof x=="boolean"?(P=x,x=void 0):x&&!Array.isArray(x)&&(x=[x]),E.isString(M)&&M.length){if(M===".")return this.root;M=M.split(".")}else if(!M.length)return this;if(M[0]==="")return this.root.lookup(M.slice(1),x);var z=this.get(M[0]);if(z){if(M.length===1){if(!x||x.indexOf(z.constructor)>-1)return z}else if(z instanceof C&&(z=z.lookup(M.slice(1),x,!0)))return z}else for(var Z=0;Z<this.nestedArray.length;++Z)if(this._nestedArray[Z]instanceof C&&(z=this._nestedArray[Z].lookup(M,x,!0)))return z;return this.parent===null||P?null:this.parent.lookup(M,x)},C.prototype.lookupType=function(M){var x=this.lookup(M,[f]);if(!x)throw Error("no such type: "+M);return x},C.prototype.lookupEnum=function(M){var x=this.lookup(M,[v]);if(!x)throw Error("no such Enum '"+M+"' in "+this);return x},C.prototype.lookupTypeOrEnum=function(M){var x=this.lookup(M,[f,v]);if(!x)throw Error("no such Type or Enum '"+M+"' in "+this);return x},C.prototype.lookupService=function(M){var x=this.lookup(M,[T]);if(!x)throw Error("no such Service '"+M+"' in "+this);return x},C._configure=function(M,x,P){f=M,T=x,v=P}},3243:function(O,j,c){O.exports=T,T.className="ReflectionObject";var p,f=c(9935);function T(v,S){if(!f.isString(v))throw TypeError("name must be a string");if(S&&!f.isObject(S))throw TypeError("options must be an object");this.options=S,this.parsedOptions=null,this.name=v,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(T.prototype,{root:{get:function(){for(var v=this;v.parent!==null;)v=v.parent;return v}},fullName:{get:function(){for(var v=[this.name],S=this.parent;S;)v.unshift(S.name),S=S.parent;return v.join(".")}}}),T.prototype.toJSON=function(){throw Error()},T.prototype.onAdd=function(v){this.parent&&this.parent!==v&&this.parent.remove(this),this.parent=v,this.resolved=!1;var S=v.root;S instanceof p&&S._handleAdd(this)},T.prototype.onRemove=function(v){var S=v.root;S instanceof p&&S._handleRemove(this),this.parent=null,this.resolved=!1},T.prototype.resolve=function(){return this.resolved||this.root instanceof p&&(this.resolved=!0),this},T.prototype.getOption=function(v){if(this.options)return this.options[v]},T.prototype.setOption=function(v,S,y){return y&&this.options&&this.options[v]!==void 0||((this.options||(this.options={}))[v]=S),this},T.prototype.setParsedOption=function(v,S,y){this.parsedOptions||(this.parsedOptions=[]);var E=this.parsedOptions;if(y){var N=E.find(function(M){return Object.prototype.hasOwnProperty.call(M,v)});if(N){var C=N[v];f.setProperty(C,y,S)}else(N={})[v]=f.setProperty({},y,S),E.push(N)}else{var U={};U[v]=S,E.push(U)}return this},T.prototype.setOptions=function(v,S){if(v)for(var y=Object.keys(v),E=0;E<y.length;++E)this.setOption(y[E],v[y[E]],S);return this},T.prototype.toString=function(){var v=this.constructor.className,S=this.fullName;return S.length?v+" "+S:v},T._configure=function(v){p=v}},7598:function(O,j,c){O.exports=v;var p=c(3243);((v.prototype=Object.create(p.prototype)).constructor=v).className="OneOf";var f=c(3548),T=c(9935);function v(y,E,N,C){if(Array.isArray(E)||(N=E,E=void 0),p.call(this,y,N),E!==void 0&&!Array.isArray(E))throw TypeError("fieldNames must be an Array");this.oneof=E||[],this.fieldsArray=[],this.comment=C}function S(y){if(y.parent)for(var E=0;E<y.fieldsArray.length;++E)y.fieldsArray[E].parent||y.parent.add(y.fieldsArray[E])}v.fromJSON=function(y,E){return new v(y,E.oneof,E.options,E.comment)},v.prototype.toJSON=function(y){var E=!!y&&!!y.keepComments;return T.toObject(["options",this.options,"oneof",this.oneof,"comment",E?this.comment:void 0])},v.prototype.add=function(y){if(!(y instanceof f))throw TypeError("field must be a Field");return y.parent&&y.parent!==this.parent&&y.parent.remove(y),this.oneof.push(y.name),this.fieldsArray.push(y),y.partOf=this,S(this),this},v.prototype.remove=function(y){if(!(y instanceof f))throw TypeError("field must be a Field");var E=this.fieldsArray.indexOf(y);if(E<0)throw Error(y+" is not a member of "+this);return this.fieldsArray.splice(E,1),(E=this.oneof.indexOf(y.name))>-1&&this.oneof.splice(E,1),y.partOf=null,this},v.prototype.onAdd=function(y){p.prototype.onAdd.call(this,y);for(var E=0;E<this.oneof.length;++E){var N=y.get(this.oneof[E]);N&&!N.partOf&&(N.partOf=this,this.fieldsArray.push(N))}S(this)},v.prototype.onRemove=function(y){for(var E,N=0;N<this.fieldsArray.length;++N)(E=this.fieldsArray[N]).parent&&E.parent.remove(E);p.prototype.onRemove.call(this,y)},v.d=function(){for(var y=new Array(arguments.length),E=0;E<arguments.length;)y[E]=arguments[E++];return function(N,C){T.decorateType(N.constructor).add(new v(C,y)),Object.defineProperty(N,C,{get:T.oneOfGetter(y),set:T.oneOfSetter(y)})}}},2228:function(O,j,c){O.exports=ee,ee.filename=null,ee.defaults={keepCase:!1};var p=c(626),f=c(9424),T=c(7645),v=c(3548),S=c(6039),y=c(7598),E=c(7025),N=c(7513),C=c(4429),U=c(7063),M=c(9935),x=/^[1-9][0-9]*$/,P=/^-?[1-9][0-9]*$/,z=/^0[x][0-9a-fA-F]+$/,Z=/^-?0[x][0-9a-fA-F]+$/,I=/^0[0-7]+$/,Y=/^-?0[0-7]+$/,F=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,oe=/^[a-zA-Z_][a-zA-Z_0-9]*$/,W=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,ne=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function ee(H,q,ve){q instanceof f||(ve=q,q=new f),ve||(ve=ee.defaults);var Le,Oe,ge,je,Ne,Be=ve.preferTrailingComment||!1,Ye=p(H,ve.alternateCommentMode||!1),pt=Ye.next,dt=Ye.push,Ie=Ye.peek,we=Ye.skip,ft=Ye.cmnt,qe=!0,it=!1,Tt=q,Pt=ve.keepCase?function(At){return At}:M.camelCase;function bt(At,vt,zt){var vr=ee.filename;return zt||(ee.filename=null),Error("illegal "+(vt||"token")+" '"+At+"' ("+(vr?vr+", ":"")+"line "+Ye.line+")")}function jt(){var At,vt=[];do{if((At=pt())!=='"'&&At!=="'")throw bt(At);vt.push(pt()),we(At),At=Ie()}while(At==='"'||At==="'");return vt.join("")}function Lt(At){var vt=pt();switch(vt){case"'":case'"':return dt(vt),jt();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return function(zt,vr){var or=1;switch(zt.charAt(0)==="-"&&(or=-1,zt=zt.substring(1)),zt){case"inf":case"INF":case"Inf":return or*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(x.test(zt))return or*parseInt(zt,10);if(z.test(zt))return or*parseInt(zt,16);if(I.test(zt))return or*parseInt(zt,8);if(F.test(zt))return or*parseFloat(zt);throw bt(zt,"number",!0)}(vt)}catch{if(W.test(vt))return vt;throw bt(vt,"value")}}function Gt(At,vt){var zt,vr;do!vt||(zt=Ie())!=='"'&&zt!=="'"?At.push([vr=pr(pt()),we("to",!0)?pr(pt()):vr]):At.push(jt());while(we(",",!0));we(";")}function pr(At,vt){switch(At){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!vt&&At.charAt(0)==="-")throw bt(At,"id");if(P.test(At))return parseInt(At,10);if(Z.test(At))return parseInt(At,16);if(Y.test(At))return parseInt(At,8);throw bt(At,"id")}function ir(){if(Le!==void 0)throw bt("package");if(Le=pt(),!W.test(Le))throw bt(Le,"name");Tt=Tt.define(Le),we(";")}function Ar(){var At,vt=Ie();switch(vt){case"weak":At=ge||(ge=[]),pt();break;case"public":pt();default:At=Oe||(Oe=[])}vt=jt(),we(";"),At.push(vt)}function er(){if(we("="),je=jt(),!(it=je==="proto3")&&je!=="proto2")throw bt(je,"syntax");we(";")}function yt(At,vt){switch(vt){case"option":return St(At,vt),we(";"),!0;case"message":return function(zt,vr){if(!oe.test(vr=pt()))throw bt(vr,"type name");var or=new T(vr);Xt(or,function(mr){if(!yt(or,mr))switch(mr){case"map":(function(ae){we("<");var Ae=pt();if(U.mapKey[Ae]===void 0)throw bt(Ae,"type");we(",");var le=pt();if(!W.test(le))throw bt(le,"type");we(">");var Xe=pt();if(!oe.test(Xe))throw bt(Xe,"name");we("=");var X=new S(Pt(Xe),pr(pt()),Ae,le);Xt(X,function(et){if(et!=="option")throw bt(et);St(X,et),we(";")},function(){Kt(X)}),ae.add(X)})(or);break;case"required":case"repeated":Ir(or,mr);break;case"optional":Ir(or,it?"proto3_optional":"optional");break;case"oneof":(function(ae,Ae){if(!oe.test(Ae=pt()))throw bt(Ae,"name");var le=new y(Pt(Ae));Xt(le,function(Xe){Xe==="option"?(St(le,Xe),we(";")):(dt(Xe),Ir(le,"optional"))}),ae.add(le)})(or,mr);break;case"extensions":Gt(or.extensions||(or.extensions=[]));break;case"reserved":Gt(or.reserved||(or.reserved=[]),!0);break;default:if(!it||!W.test(mr))throw bt(mr);dt(mr),Ir(or,"optional")}}),zt.add(or)}(At,vt),!0;case"enum":return function(zt,vr){if(!oe.test(vr=pt()))throw bt(vr,"name");var or=new E(vr);Xt(or,function(mr){switch(mr){case"option":St(or,mr),we(";");break;case"reserved":Gt(or.reserved||(or.reserved=[]),!0);break;default:(function(ae,Ae){if(!oe.test(Ae))throw bt(Ae,"name");we("=");var le=pr(pt(),!0),Xe={};Xt(Xe,function(X){if(X!=="option")throw bt(X);St(Xe,X),we(";")},function(){Kt(Xe)}),ae.add(Ae,le,Xe.comment)})(or,mr)}}),zt.add(or)}(At,vt),!0;case"service":return function(zt,vr){if(!oe.test(vr=pt()))throw bt(vr,"service name");var or=new N(vr);Xt(or,function(mr){if(!yt(or,mr)){if(mr!=="rpc")throw bt(mr);(function(ae,Ae){var le=ft(),Xe=Ae;if(!oe.test(Ae=pt()))throw bt(Ae,"name");var X,et,Me,He,Qe=Ae;if(we("("),we("stream",!0)&&(et=!0),!W.test(Ae=pt())||(X=Ae,we(")"),we("returns"),we("("),we("stream",!0)&&(He=!0),!W.test(Ae=pt())))throw bt(Ae);Me=Ae,we(")");var ht=new C(Qe,Xe,X,Me,et,He);ht.comment=le,Xt(ht,function(rt){if(rt!=="option")throw bt(rt);St(ht,rt),we(";")}),ae.add(ht)})(or,mr)}}),zt.add(or)}(At,vt),!0;case"extend":return function(zt,vr){if(!W.test(vr=pt()))throw bt(vr,"reference");var or=vr;Xt(null,function(mr){switch(mr){case"required":case"repeated":Ir(zt,mr,or);break;case"optional":Ir(zt,it?"proto3_optional":"optional",or);break;default:if(!it||!W.test(mr))throw bt(mr);dt(mr),Ir(zt,"optional",or)}})}(At,vt),!0}return!1}function Xt(At,vt,zt){var vr=Ye.line;if(At&&(typeof At.comment!="string"&&(At.comment=ft()),At.filename=ee.filename),we("{",!0)){for(var or;(or=pt())!=="}";)vt(or);we(";",!0)}else zt&&zt(),we(";"),At&&(typeof At.comment!="string"||Be)&&(At.comment=ft(vr)||At.comment)}function Ir(At,vt,zt){var vr=pt();if(vr!=="group"){if(!W.test(vr))throw bt(vr,"type");var or=pt();if(!oe.test(or))throw bt(or,"name");or=Pt(or),we("=");var mr=new v(or,pr(pt()),vr,vt,zt);if(Xt(mr,function(Ae){if(Ae!=="option")throw bt(Ae);St(mr,Ae),we(";")},function(){Kt(mr)}),vt==="proto3_optional"){var ae=new y("_"+or);mr.setOption("proto3_optional",!0),ae.add(mr),At.add(ae)}else At.add(mr);it||!mr.repeated||U.packed[vr]===void 0&&U.basic[vr]!==void 0||mr.setOption("packed",!1,!0)}else(function(Ae,le){var Xe=pt();if(!oe.test(Xe))throw bt(Xe,"name");var X=M.lcFirst(Xe);Xe===X&&(Xe=M.ucFirst(Xe)),we("=");var et=pr(pt()),Me=new T(Xe);Me.group=!0;var He=new v(X,et,Xe,le);He.filename=ee.filename,Xt(Me,function(Qe){switch(Qe){case"option":St(Me,Qe),we(";");break;case"required":case"repeated":Ir(Me,Qe);break;case"optional":Ir(Me,it?"proto3_optional":"optional");break;default:throw bt(Qe)}}),Ae.add(Me).add(He)})(At,vt)}function St(At,vt){var zt=we("(",!0);if(!W.test(vt=pt()))throw bt(vt,"name");var vr,or=vt,mr=or;zt&&(we(")"),mr=or="("+or+")",vt=Ie(),ne.test(vt)&&(vr=vt.substr(1),or+=vt,pt())),we("="),function(ae,Ae,le,Xe){ae.setParsedOption&&ae.setParsedOption(Ae,le,Xe)}(At,mr,Wt(At,or),vr)}function Wt(At,vt){if(we("{",!0)){for(var zt={};!we("}",!0);){if(!oe.test(Ne=pt()))throw bt(Ne,"name");var vr,or=Ne;Ie()==="{"?vr=Wt(At,vt+"."+Ne):(we(":"),Ie()==="{"?vr=Wt(At,vt+"."+Ne):(vr=Lt(),Zt(At,vt+"."+Ne,vr)));var mr=zt[or];mr&&(vr=[].concat(mr).concat(vr)),zt[or]=vr,we(",",!0)}return zt}var ae=Lt();return Zt(At,vt,ae),ae}function Zt(At,vt,zt){At.setOption&&At.setOption(vt,zt)}function Kt(At){if(we("[",!0)){do St(At,"option");while(we(",",!0));we("]")}return At}for(;(Ne=pt())!==null;)switch(Ne){case"package":if(!qe)throw bt(Ne);ir();break;case"import":if(!qe)throw bt(Ne);Ar();break;case"syntax":if(!qe)throw bt(Ne);er();break;case"option":St(Tt,Ne),we(";");break;default:if(yt(Tt,Ne)){qe=!1;continue}throw bt(Ne)}return ee.filename=null,{package:Le,imports:Oe,weakImports:ge,syntax:je,root:q}}},1408:function(O,j,c){O.exports=y;var p,f=c(9693),T=f.LongBits,v=f.utf8;function S(P,z){return RangeError("index out of range: "+P.pos+" + "+(z||1)+" > "+P.len)}function y(P){this.buf=P,this.pos=0,this.len=P.length}var E,N=typeof Uint8Array<"u"?function(P){if(P instanceof Uint8Array||Array.isArray(P))return new y(P);throw Error("illegal buffer")}:function(P){if(Array.isArray(P))return new y(P);throw Error("illegal buffer")},C=function(){return f.Buffer?function(P){return(y.create=function(z){return f.Buffer.isBuffer(z)?new p(z):N(z)})(P)}:N};function U(){var P=new T(0,0),z=0;if(!(this.len-this.pos>4)){for(;z<3;++z){if(this.pos>=this.len)throw S(this);if(P.lo=(P.lo|(127&this.buf[this.pos])<<7*z)>>>0,this.buf[this.pos++]<128)return P}return P.lo=(P.lo|(127&this.buf[this.pos++])<<7*z)>>>0,P}for(;z<4;++z)if(P.lo=(P.lo|(127&this.buf[this.pos])<<7*z)>>>0,this.buf[this.pos++]<128)return P;if(P.lo=(P.lo|(127&this.buf[this.pos])<<28)>>>0,P.hi=(P.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return P;if(z=0,this.len-this.pos>4){for(;z<5;++z)if(P.hi=(P.hi|(127&this.buf[this.pos])<<7*z+3)>>>0,this.buf[this.pos++]<128)return P}else for(;z<5;++z){if(this.pos>=this.len)throw S(this);if(P.hi=(P.hi|(127&this.buf[this.pos])<<7*z+3)>>>0,this.buf[this.pos++]<128)return P}throw Error("invalid varint encoding")}function M(P,z){return(P[z-4]|P[z-3]<<8|P[z-2]<<16|P[z-1]<<24)>>>0}function x(){if(this.pos+8>this.len)throw S(this,8);return new T(M(this.buf,this.pos+=4),M(this.buf,this.pos+=4))}y.create=C(),y.prototype._slice=f.Array.prototype.subarray||f.Array.prototype.slice,y.prototype.uint32=(E=4294967295,function(){if(E=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(E=(E|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(E=(E|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(E=(E|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(E=(E|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return E;if((this.pos+=5)>this.len)throw this.pos=this.len,S(this,10);return E}),y.prototype.int32=function(){return 0|this.uint32()},y.prototype.sint32=function(){var P=this.uint32();return P>>>1^-(1&P)|0},y.prototype.bool=function(){return this.uint32()!==0},y.prototype.fixed32=function(){if(this.pos+4>this.len)throw S(this,4);return M(this.buf,this.pos+=4)},y.prototype.sfixed32=function(){if(this.pos+4>this.len)throw S(this,4);return 0|M(this.buf,this.pos+=4)},y.prototype.float=function(){if(this.pos+4>this.len)throw S(this,4);var P=f.float.readFloatLE(this.buf,this.pos);return this.pos+=4,P},y.prototype.double=function(){if(this.pos+8>this.len)throw S(this,4);var P=f.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,P},y.prototype.bytes=function(){var P=this.uint32(),z=this.pos,Z=this.pos+P;if(Z>this.len)throw S(this,P);return this.pos+=P,Array.isArray(this.buf)?this.buf.slice(z,Z):z===Z?new this.buf.constructor(0):this._slice.call(this.buf,z,Z)},y.prototype.string=function(){var P=this.bytes();return v.read(P,0,P.length)},y.prototype.skip=function(P){if(typeof P=="number"){if(this.pos+P>this.len)throw S(this,P);this.pos+=P}else do if(this.pos>=this.len)throw S(this);while(128&this.buf[this.pos++]);return this},y.prototype.skipType=function(P){switch(P){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(P=7&this.uint32())!=4;)this.skipType(P);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+P+" at offset "+this.pos)}return this},y._configure=function(P){p=P,y.create=C(),p._configure();var z=f.Long?"toLong":"toNumber";f.merge(y.prototype,{int64:function(){return U.call(this)[z](!1)},uint64:function(){return U.call(this)[z](!0)},sint64:function(){return U.call(this).zzDecode()[z](!1)},fixed64:function(){return x.call(this)[z](!0)},sfixed64:function(){return x.call(this)[z](!1)}})}},593:function(O,j,c){O.exports=T;var p=c(1408);(T.prototype=Object.create(p.prototype)).constructor=T;var f=c(9693);function T(v){p.call(this,v)}T._configure=function(){f.Buffer&&(T.prototype._slice=f.Buffer.prototype.slice)},T.prototype.string=function(){var v=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+v,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+v,this.len))},T._configure()},9424:function(O,j,c){O.exports=C;var p=c(9313);((C.prototype=Object.create(p.prototype)).constructor=C).className="Root";var f,T,v,S=c(3548),y=c(7025),E=c(7598),N=c(9935);function C(P){p.call(this,"",P),this.deferred=[],this.files=[]}function U(){}C.fromJSON=function(P,z){return z||(z=new C),P.options&&z.setOptions(P.options),z.addJSON(P.nested)},C.prototype.resolvePath=N.path.resolve,C.prototype.fetch=N.fetch,C.prototype.load=function P(z,Z,I){typeof Z=="function"&&(I=Z,Z=void 0);var Y=this;if(!I)return N.asPromise(P,Y,z,Z);var F=I===U;function oe(Le,Oe){if(I){var ge=I;if(I=null,F)throw Le;ge(Le,Oe)}}function W(Le){var Oe=Le.lastIndexOf("google/protobuf/");if(Oe>-1){var ge=Le.substring(Oe);if(ge in v)return ge}return null}function ne(Le,Oe){try{if(N.isString(Oe)&&Oe.charAt(0)==="{"&&(Oe=JSON.parse(Oe)),N.isString(Oe)){T.filename=Le;var ge,je=T(Oe,Y,Z),Ne=0;if(je.imports)for(;Ne<je.imports.length;++Ne)(ge=W(je.imports[Ne])||Y.resolvePath(Le,je.imports[Ne]))&&ee(ge);if(je.weakImports)for(Ne=0;Ne<je.weakImports.length;++Ne)(ge=W(je.weakImports[Ne])||Y.resolvePath(Le,je.weakImports[Ne]))&&ee(ge,!0)}else Y.setOptions(Oe.options).addJSON(Oe.nested)}catch(Be){oe(Be)}F||H||oe(null,Y)}function ee(Le,Oe){if(!(Y.files.indexOf(Le)>-1))if(Y.files.push(Le),Le in v)F?ne(Le,v[Le]):(++H,setTimeout(function(){--H,ne(Le,v[Le])}));else if(F){var ge;try{ge=N.fs.readFileSync(Le).toString("utf8")}catch(je){return void(Oe||oe(je))}ne(Le,ge)}else++H,Y.fetch(Le,function(je,Ne){--H,I&&(je?Oe?H||oe(null,Y):oe(je):ne(Le,Ne))})}var H=0;N.isString(z)&&(z=[z]);for(var q,ve=0;ve<z.length;++ve)(q=Y.resolvePath("",z[ve]))&&ee(q);if(F)return Y;H||oe(null,Y)},C.prototype.loadSync=function(P,z){if(!N.isNode)throw Error("not supported");return this.load(P,z,U)},C.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(P){return"'extend "+P.extend+"' in "+P.parent.fullName}).join(", "));return p.prototype.resolveAll.call(this)};var M=/^[A-Z]/;function x(P,z){var Z=z.parent.lookup(z.extend);if(Z){var I=new S(z.fullName,z.id,z.type,z.rule,void 0,z.options);return I.declaringField=z,z.extensionField=I,Z.add(I),!0}return!1}C.prototype._handleAdd=function(P){if(P instanceof S)P.extend===void 0||P.extensionField||x(0,P)||this.deferred.push(P);else if(P instanceof y)M.test(P.name)&&(P.parent[P.name]=P.values);else if(!(P instanceof E)){if(P instanceof f)for(var z=0;z<this.deferred.length;)x(0,this.deferred[z])?this.deferred.splice(z,1):++z;for(var Z=0;Z<P.nestedArray.length;++Z)this._handleAdd(P._nestedArray[Z]);M.test(P.name)&&(P.parent[P.name]=P)}},C.prototype._handleRemove=function(P){if(P instanceof S){if(P.extend!==void 0)if(P.extensionField)P.extensionField.parent.remove(P.extensionField),P.extensionField=null;else{var z=this.deferred.indexOf(P);z>-1&&this.deferred.splice(z,1)}}else if(P instanceof y)M.test(P.name)&&delete P.parent[P.name];else if(P instanceof p){for(var Z=0;Z<P.nestedArray.length;++Z)this._handleRemove(P._nestedArray[Z]);M.test(P.name)&&delete P.parent[P.name]}},C._configure=function(P,z,Z){f=P,T=z,v=Z}},5054:function(O){O.exports={}},5994:function(O,j,c){j.Service=c(7948)},7948:function(O,j,c){O.exports=f;var p=c(9693);function f(T,v,S){if(typeof T!="function")throw TypeError("rpcImpl must be a function");p.EventEmitter.call(this),this.rpcImpl=T,this.requestDelimited=!!v,this.responseDelimited=!!S}(f.prototype=Object.create(p.EventEmitter.prototype)).constructor=f,f.prototype.rpcCall=function T(v,S,y,E,N){if(!E)throw TypeError("request must be specified");var C=this;if(!N)return p.asPromise(T,C,v,S,y,E);if(C.rpcImpl)try{return C.rpcImpl(v,S[C.requestDelimited?"encodeDelimited":"encode"](E).finish(),function(U,M){if(U)return C.emit("error",U,v),N(U);if(M!==null){if(!(M instanceof y))try{M=y[C.responseDelimited?"decodeDelimited":"decode"](M)}catch(x){return C.emit("error",x,v),N(x)}return C.emit("data",M,v),N(null,M)}C.end(!0)})}catch(U){return C.emit("error",U,v),void setTimeout(function(){N(U)},0)}else setTimeout(function(){N(Error("already ended"))},0)},f.prototype.end=function(T){return this.rpcImpl&&(T||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},7513:function(O,j,c){O.exports=S;var p=c(9313);((S.prototype=Object.create(p.prototype)).constructor=S).className="Service";var f=c(4429),T=c(9935),v=c(5994);function S(E,N){p.call(this,E,N),this.methods={},this._methodsArray=null}function y(E){return E._methodsArray=null,E}S.fromJSON=function(E,N){var C=new S(E,N.options);if(N.methods)for(var U=Object.keys(N.methods),M=0;M<U.length;++M)C.add(f.fromJSON(U[M],N.methods[U[M]]));return N.nested&&C.addJSON(N.nested),C.comment=N.comment,C},S.prototype.toJSON=function(E){var N=p.prototype.toJSON.call(this,E),C=!!E&&!!E.keepComments;return T.toObject(["options",N&&N.options||void 0,"methods",p.arrayToJSON(this.methodsArray,E)||{},"nested",N&&N.nested||void 0,"comment",C?this.comment:void 0])},Object.defineProperty(S.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=T.toArray(this.methods))}}),S.prototype.get=function(E){return this.methods[E]||p.prototype.get.call(this,E)},S.prototype.resolveAll=function(){for(var E=this.methodsArray,N=0;N<E.length;++N)E[N].resolve();return p.prototype.resolve.call(this)},S.prototype.add=function(E){if(this.get(E.name))throw Error("duplicate name '"+E.name+"' in "+this);return E instanceof f?(this.methods[E.name]=E,E.parent=this,y(this)):p.prototype.add.call(this,E)},S.prototype.remove=function(E){if(E instanceof f){if(this.methods[E.name]!==E)throw Error(E+" is not a member of "+this);return delete this.methods[E.name],E.parent=null,y(this)}return p.prototype.remove.call(this,E)},S.prototype.create=function(E,N,C){for(var U,M=new v.Service(E,N,C),x=0;x<this.methodsArray.length;++x){var P=T.lcFirst((U=this._methodsArray[x]).resolve().name).replace(/[^$\w_]/g,"");M[P]=T.codegen(["r","c"],T.isReserved(P)?P+"_":P)("return this.rpcCall(m,q,s,r,c)")({m:U,q:U.resolvedRequestType.ctor,s:U.resolvedResponseType.ctor})}return M}},626:function(O){O.exports=C;var j=/[\s{}=;:[\],'"()<>]/g,c=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,p=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,f=/^ *[*/]+ */,T=/^\s*\*?\/*/,v=/\n/g,S=/\s/,y=/\\(.?)/g,E={0:"\0",r:"\r",n:`
`,t:"	"};function N(U){return U.replace(y,function(M,x){switch(x){case"\\":case"":return x;default:return E[x]||""}})}function C(U,M){U=U.toString();var x=0,P=U.length,z=1,Z=null,I=null,Y=0,F=!1,oe=!1,W=[],ne=null;function ee(Ne){return Error("illegal "+Ne+" (line "+z+")")}function H(Ne){return U.charAt(Ne)}function q(Ne,Be,Ye){Z=U.charAt(Ne++),Y=z,F=!1,oe=Ye;var pt,dt=Ne-(M?2:3);do if(--dt<0||(pt=U.charAt(dt))===`
`){F=!0;break}while(pt===" "||pt==="	");for(var Ie=U.substring(Ne,Be).split(v),we=0;we<Ie.length;++we)Ie[we]=Ie[we].replace(M?T:f,"").trim();I=Ie.join(`
`).trim()}function ve(Ne){var Be=Le(Ne),Ye=U.substring(Ne,Be);return/^\s*\/{1,2}/.test(Ye)}function Le(Ne){for(var Be=Ne;Be<P&&H(Be)!==`
`;)Be++;return Be}function Oe(){if(W.length>0)return W.shift();if(ne)return function(){var qe=ne==="'"?p:c;qe.lastIndex=x-1;var it=qe.exec(U);if(!it)throw ee("string");return x=qe.lastIndex,ge(ne),ne=null,N(it[1])}();var Ne,Be,Ye,pt,dt,Ie=x===0;do{if(x===P)return null;for(Ne=!1;S.test(Ye=H(x));)if(Ye===`
`&&(Ie=!0,++z),++x===P)return null;if(H(x)==="/"){if(++x===P)throw ee("comment");if(H(x)==="/")if(M){if(pt=x,dt=!1,ve(x)){dt=!0;do{if((x=Le(x))===P)break;x++}while(ve(x))}else x=Math.min(P,Le(x)+1);dt&&q(pt,x,Ie),z++,Ne=!0}else{for(dt=H(pt=x+1)==="/";H(++x)!==`
`;)if(x===P)return null;++x,dt&&q(pt,x-1,Ie),++z,Ne=!0}else{if((Ye=H(x))!=="*")return"/";pt=x+1,dt=M||H(pt)==="*";do{if(Ye===`
`&&++z,++x===P)throw ee("comment");Be=Ye,Ye=H(x)}while(Be!=="*"||Ye!=="/");++x,dt&&q(pt,x-2,Ie),Ne=!0}}}while(Ne);var we=x;if(j.lastIndex=0,!j.test(H(we++)))for(;we<P&&!j.test(H(we));)++we;var ft=U.substring(x,x=we);return ft!=='"'&&ft!=="'"||(ne=ft),ft}function ge(Ne){W.push(Ne)}function je(){if(!W.length){var Ne=Oe();if(Ne===null)return null;ge(Ne)}return W[0]}return Object.defineProperty({next:Oe,peek:je,push:ge,skip:function(Ne,Be){var Ye=je();if(Ye===Ne)return Oe(),!0;if(!Be)throw ee("token '"+Ye+"', '"+Ne+"' expected");return!1},cmnt:function(Ne){var Be=null;return Ne===void 0?Y===z-1&&(M||Z==="*"||F)&&(Be=oe?I:null):(Y<Ne&&je(),Y!==Ne||F||!M&&Z!=="/"||(Be=oe?null:I)),Be}},"line",{get:function(){return z}})}C.unescape=N},7645:function(O,j,c){O.exports=I;var p=c(9313);((I.prototype=Object.create(p.prototype)).constructor=I).className="Type";var f=c(7025),T=c(7598),v=c(3548),S=c(6039),y=c(7513),E=c(8368),N=c(1408),C=c(1173),U=c(9935),M=c(4928),x=c(5305),P=c(4497),z=c(3996),Z=c(1667);function I(F,oe){p.call(this,F,oe),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function Y(F){return F._fieldsById=F._fieldsArray=F._oneofsArray=null,delete F.encode,delete F.decode,delete F.verify,F}Object.defineProperties(I.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var F=Object.keys(this.fields),oe=0;oe<F.length;++oe){var W=this.fields[F[oe]],ne=W.id;if(this._fieldsById[ne])throw Error("duplicate id "+ne+" in "+this);this._fieldsById[ne]=W}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=U.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=U.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=I.generateConstructor(this)())},set:function(F){var oe=F.prototype;oe instanceof E||((F.prototype=new E).constructor=F,U.merge(F.prototype,oe)),F.$type=F.prototype.$type=this,U.merge(F,E,!0),this._ctor=F;for(var W=0;W<this.fieldsArray.length;++W)this._fieldsArray[W].resolve();var ne={};for(W=0;W<this.oneofsArray.length;++W)ne[this._oneofsArray[W].resolve().name]={get:U.oneOfGetter(this._oneofsArray[W].oneof),set:U.oneOfSetter(this._oneofsArray[W].oneof)};W&&Object.defineProperties(F.prototype,ne)}}}),I.generateConstructor=function(F){for(var oe,W=U.codegen(["p"],F.name),ne=0;ne<F.fieldsArray.length;++ne)(oe=F._fieldsArray[ne]).map?W("this%s={}",U.safeProp(oe.name)):oe.repeated&&W("this%s=[]",U.safeProp(oe.name));return W("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},I.fromJSON=function(F,oe){var W=new I(F,oe.options);W.extensions=oe.extensions,W.reserved=oe.reserved;for(var ne=Object.keys(oe.fields),ee=0;ee<ne.length;++ee)W.add((oe.fields[ne[ee]].keyType!==void 0?S.fromJSON:v.fromJSON)(ne[ee],oe.fields[ne[ee]]));if(oe.oneofs)for(ne=Object.keys(oe.oneofs),ee=0;ee<ne.length;++ee)W.add(T.fromJSON(ne[ee],oe.oneofs[ne[ee]]));if(oe.nested)for(ne=Object.keys(oe.nested),ee=0;ee<ne.length;++ee){var H=oe.nested[ne[ee]];W.add((H.id!==void 0?v.fromJSON:H.fields!==void 0?I.fromJSON:H.values!==void 0?f.fromJSON:H.methods!==void 0?y.fromJSON:p.fromJSON)(ne[ee],H))}return oe.extensions&&oe.extensions.length&&(W.extensions=oe.extensions),oe.reserved&&oe.reserved.length&&(W.reserved=oe.reserved),oe.group&&(W.group=!0),oe.comment&&(W.comment=oe.comment),W},I.prototype.toJSON=function(F){var oe=p.prototype.toJSON.call(this,F),W=!!F&&!!F.keepComments;return U.toObject(["options",oe&&oe.options||void 0,"oneofs",p.arrayToJSON(this.oneofsArray,F),"fields",p.arrayToJSON(this.fieldsArray.filter(function(ne){return!ne.declaringField}),F)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",oe&&oe.nested||void 0,"comment",W?this.comment:void 0])},I.prototype.resolveAll=function(){for(var F=this.fieldsArray,oe=0;oe<F.length;)F[oe++].resolve();var W=this.oneofsArray;for(oe=0;oe<W.length;)W[oe++].resolve();return p.prototype.resolveAll.call(this)},I.prototype.get=function(F){return this.fields[F]||this.oneofs&&this.oneofs[F]||this.nested&&this.nested[F]||null},I.prototype.add=function(F){if(this.get(F.name))throw Error("duplicate name '"+F.name+"' in "+this);if(F instanceof v&&F.extend===void 0){if(this._fieldsById?this._fieldsById[F.id]:this.fieldsById[F.id])throw Error("duplicate id "+F.id+" in "+this);if(this.isReservedId(F.id))throw Error("id "+F.id+" is reserved in "+this);if(this.isReservedName(F.name))throw Error("name '"+F.name+"' is reserved in "+this);return F.parent&&F.parent.remove(F),this.fields[F.name]=F,F.message=this,F.onAdd(this),Y(this)}return F instanceof T?(this.oneofs||(this.oneofs={}),this.oneofs[F.name]=F,F.onAdd(this),Y(this)):p.prototype.add.call(this,F)},I.prototype.remove=function(F){if(F instanceof v&&F.extend===void 0){if(!this.fields||this.fields[F.name]!==F)throw Error(F+" is not a member of "+this);return delete this.fields[F.name],F.parent=null,F.onRemove(this),Y(this)}if(F instanceof T){if(!this.oneofs||this.oneofs[F.name]!==F)throw Error(F+" is not a member of "+this);return delete this.oneofs[F.name],F.parent=null,F.onRemove(this),Y(this)}return p.prototype.remove.call(this,F)},I.prototype.isReservedId=function(F){return p.isReservedId(this.reserved,F)},I.prototype.isReservedName=function(F){return p.isReservedName(this.reserved,F)},I.prototype.create=function(F){return new this.ctor(F)},I.prototype.setup=function(){for(var F=this.fullName,oe=[],W=0;W<this.fieldsArray.length;++W)oe.push(this._fieldsArray[W].resolve().resolvedType);this.encode=M(this)({Writer:C,types:oe,util:U}),this.decode=x(this)({Reader:N,types:oe,util:U}),this.verify=P(this)({types:oe,util:U}),this.fromObject=z.fromObject(this)({types:oe,util:U}),this.toObject=z.toObject(this)({types:oe,util:U});var ne=Z[F];if(ne){var ee=Object.create(this);ee.fromObject=this.fromObject,this.fromObject=ne.fromObject.bind(ee),ee.toObject=this.toObject,this.toObject=ne.toObject.bind(ee)}return this},I.prototype.encode=function(F,oe){return this.setup().encode(F,oe)},I.prototype.encodeDelimited=function(F,oe){return this.encode(F,oe&&oe.len?oe.fork():oe).ldelim()},I.prototype.decode=function(F,oe){return this.setup().decode(F,oe)},I.prototype.decodeDelimited=function(F){return F instanceof N||(F=N.create(F)),this.decode(F,F.uint32())},I.prototype.verify=function(F){return this.setup().verify(F)},I.prototype.fromObject=function(F){return this.setup().fromObject(F)},I.prototype.toObject=function(F,oe){return this.setup().toObject(F,oe)},I.d=function(F){return function(oe){U.decorateType(oe,F)}}},7063:function(O,j,c){var p=j,f=c(9935),T=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function v(S,y){var E=0,N={};for(y|=0;E<S.length;)N[T[E+y]]=S[E++];return N}p.basic=v([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),p.defaults=v([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",f.emptyArray,null]),p.long=v([0,0,0,1,1],7),p.mapKey=v([0,0,0,5,5,0,0,0,1,1,0,2],2),p.packed=v([1,5,0,0,0,5,5,0,0,0,1,1,0])},9935:function(O,j,c){var p,f,T=O.exports=c(9693),v=c(5054);T.codegen=c(5124),T.fetch=c(9054),T.path=c(8626),T.fs=T.inquire("fs"),T.toArray=function(C){if(C){for(var U=Object.keys(C),M=new Array(U.length),x=0;x<U.length;)M[x]=C[U[x++]];return M}return[]},T.toObject=function(C){for(var U={},M=0;M<C.length;){var x=C[M++],P=C[M++];P!==void 0&&(U[x]=P)}return U};var S=/\\/g,y=/"/g;T.isReserved=function(C){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(C)},T.safeProp=function(C){return!/^[$\w_]+$/.test(C)||T.isReserved(C)?'["'+C.replace(S,"\\\\").replace(y,'\\"')+'"]':"."+C},T.ucFirst=function(C){return C.charAt(0).toUpperCase()+C.substring(1)};var E=/_([a-z])/g;T.camelCase=function(C){return C.substring(0,1)+C.substring(1).replace(E,function(U,M){return M.toUpperCase()})},T.compareFieldsById=function(C,U){return C.id-U.id},T.decorateType=function(C,U){if(C.$type)return U&&C.$type.name!==U&&(T.decorateRoot.remove(C.$type),C.$type.name=U,T.decorateRoot.add(C.$type)),C.$type;p||(p=c(7645));var M=new p(U||C.name);return T.decorateRoot.add(M),M.ctor=C,Object.defineProperty(C,"$type",{value:M,enumerable:!1}),Object.defineProperty(C.prototype,"$type",{value:M,enumerable:!1}),M};var N=0;T.decorateEnum=function(C){if(C.$type)return C.$type;f||(f=c(7025));var U=new f("Enum"+N++,C);return T.decorateRoot.add(U),Object.defineProperty(C,"$type",{value:U,enumerable:!1}),U},T.setProperty=function(C,U,M){if(typeof C!="object")throw TypeError("dst must be an object");if(!U)throw TypeError("path must be specified");return function x(P,z,Z){var I=z.shift();if(I==="__proto__")return P;if(z.length>0)P[I]=x(P[I]||{},z,Z);else{var Y=P[I];Y&&(Z=[].concat(Y).concat(Z)),P[I]=Z}return P}(C,U=U.split("."),M)},Object.defineProperty(T,"decorateRoot",{get:function(){return v.decorated||(v.decorated=new(c(9424)))}})},1945:function(O,j,c){O.exports=f;var p=c(9693);function f(y,E){this.lo=y>>>0,this.hi=E>>>0}var T=f.zero=new f(0,0);T.toNumber=function(){return 0},T.zzEncode=T.zzDecode=function(){return this},T.length=function(){return 1};var v=f.zeroHash="\0\0\0\0\0\0\0\0";f.fromNumber=function(y){if(y===0)return T;var E=y<0;E&&(y=-y);var N=y>>>0,C=(y-N)/4294967296>>>0;return E&&(C=~C>>>0,N=~N>>>0,++N>4294967295&&(N=0,++C>4294967295&&(C=0))),new f(N,C)},f.from=function(y){if(typeof y=="number")return f.fromNumber(y);if(p.isString(y)){if(!p.Long)return f.fromNumber(parseInt(y,10));y=p.Long.fromString(y)}return y.low||y.high?new f(y.low>>>0,y.high>>>0):T},f.prototype.toNumber=function(y){if(!y&&this.hi>>>31){var E=1+~this.lo>>>0,N=~this.hi>>>0;return E||(N=N+1>>>0),-(E+4294967296*N)}return this.lo+4294967296*this.hi},f.prototype.toLong=function(y){return p.Long?new p.Long(0|this.lo,0|this.hi,!!y):{low:0|this.lo,high:0|this.hi,unsigned:!!y}};var S=String.prototype.charCodeAt;f.fromHash=function(y){return y===v?T:new f((S.call(y,0)|S.call(y,1)<<8|S.call(y,2)<<16|S.call(y,3)<<24)>>>0,(S.call(y,4)|S.call(y,5)<<8|S.call(y,6)<<16|S.call(y,7)<<24)>>>0)},f.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},f.prototype.zzEncode=function(){var y=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^y)>>>0,this.lo=(this.lo<<1^y)>>>0,this},f.prototype.zzDecode=function(){var y=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^y)>>>0,this.hi=(this.hi>>>1^y)>>>0,this},f.prototype.length=function(){var y=this.lo,E=(this.lo>>>28|this.hi<<4)>>>0,N=this.hi>>>24;return N===0?E===0?y<16384?y<128?1:2:y<2097152?3:4:E<16384?E<128?5:6:E<2097152?7:8:N<128?9:10}},9693:function(O,j,c){var p=j;function f(v,S,y){for(var E=Object.keys(S),N=0;N<E.length;++N)v[E[N]]!==void 0&&y||(v[E[N]]=S[E[N]]);return v}function T(v){function S(y,E){if(!(this instanceof S))return new S(y,E);Object.defineProperty(this,"message",{get:function(){return y}}),Error.captureStackTrace?Error.captureStackTrace(this,S):Object.defineProperty(this,"stack",{value:new Error().stack||""}),E&&f(this,E)}return(S.prototype=Object.create(Error.prototype)).constructor=S,Object.defineProperty(S.prototype,"name",{get:function(){return v}}),S.prototype.toString=function(){return this.name+": "+this.message},S}p.asPromise=c(4537),p.base64=c(7419),p.EventEmitter=c(9211),p.float=c(945),p.inquire=c(7199),p.utf8=c(4997),p.pool=c(6662),p.LongBits=c(1945),p.isNode=!!(c.g!==void 0&&c.g&&c.g.process&&c.g.process.versions&&c.g.process.versions.node),p.global=p.isNode&&c.g||typeof window<"u"&&window||typeof self<"u"&&self||this,p.emptyArray=Object.freeze?Object.freeze([]):[],p.emptyObject=Object.freeze?Object.freeze({}):{},p.isInteger=Number.isInteger||function(v){return typeof v=="number"&&isFinite(v)&&Math.floor(v)===v},p.isString=function(v){return typeof v=="string"||v instanceof String},p.isObject=function(v){return v&&typeof v=="object"},p.isset=p.isSet=function(v,S){var y=v[S];return!(y==null||!v.hasOwnProperty(S))&&(typeof y!="object"||(Array.isArray(y)?y.length:Object.keys(y).length)>0)},p.Buffer=function(){try{var v=p.inquire("buffer").Buffer;return v.prototype.utf8Write?v:null}catch{return null}}(),p._Buffer_from=null,p._Buffer_allocUnsafe=null,p.newBuffer=function(v){return typeof v=="number"?p.Buffer?p._Buffer_allocUnsafe(v):new p.Array(v):p.Buffer?p._Buffer_from(v):typeof Uint8Array>"u"?v:new Uint8Array(v)},p.Array=typeof Uint8Array<"u"?Uint8Array:Array,p.Long=p.global.dcodeIO&&p.global.dcodeIO.Long||p.global.Long||p.inquire("long"),p.key2Re=/^true|false|0|1$/,p.key32Re=/^-?(?:0|[1-9][0-9]*)$/,p.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,p.longToHash=function(v){return v?p.LongBits.from(v).toHash():p.LongBits.zeroHash},p.longFromHash=function(v,S){var y=p.LongBits.fromHash(v);return p.Long?p.Long.fromBits(y.lo,y.hi,S):y.toNumber(!!S)},p.merge=f,p.lcFirst=function(v){return v.charAt(0).toLowerCase()+v.substring(1)},p.newError=T,p.ProtocolError=T("ProtocolError"),p.oneOfGetter=function(v){for(var S={},y=0;y<v.length;++y)S[v[y]]=1;return function(){for(var E=Object.keys(this),N=E.length-1;N>-1;--N)if(S[E[N]]===1&&this[E[N]]!==void 0&&this[E[N]]!==null)return E[N]}},p.oneOfSetter=function(v){return function(S){for(var y=0;y<v.length;++y)v[y]!==S&&delete this[v[y]]}},p.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},p._configure=function(){var v=p.Buffer;v?(p._Buffer_from=v.from!==Uint8Array.from&&v.from||function(S,y){return new v(S,y)},p._Buffer_allocUnsafe=v.allocUnsafe||function(S){return new v(S)}):p._Buffer_from=p._Buffer_allocUnsafe=null}},4497:function(O,j,c){O.exports=function(y){var E=f.codegen(["m"],y.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),N={};y.oneofsArray.length&&E("var p={}");for(var C=0;C<y.fieldsArray.length;++C){var U=y._fieldsArray[C].resolve(),M="m"+f.safeProp(U.name);if(U.optional&&E("if(%s!=null&&m.hasOwnProperty(%j)){",M,U.name),U.map)E("if(!util.isObject(%s))",M)("return%j",T(U,"object"))("var k=Object.keys(%s)",M)("for(var i=0;i<k.length;++i){"),S(E,U,"k[i]"),v(E,U,C,M+"[k[i]]")("}");else if(U.repeated)E("if(!Array.isArray(%s))",M)("return%j",T(U,"array"))("for(var i=0;i<%s.length;++i){",M),v(E,U,C,M+"[i]")("}");else{if(U.partOf){var x=f.safeProp(U.partOf.name);N[U.partOf.name]===1&&E("if(p%s===1)",x)("return%j",U.partOf.name+": multiple values"),N[U.partOf.name]=1,E("p%s=1",x)}v(E,U,C,M)}U.optional&&E("}")}return E("return null")};var p=c(7025),f=c(9935);function T(y,E){return y.name+": "+E+(y.repeated&&E!=="array"?"[]":y.map&&E!=="object"?"{k:"+y.keyType+"}":"")+" expected"}function v(y,E,N,C){if(E.resolvedType)if(E.resolvedType instanceof p){y("switch(%s){",C)("default:")("return%j",T(E,"enum value"));for(var U=Object.keys(E.resolvedType.values),M=0;M<U.length;++M)y("case %i:",E.resolvedType.values[U[M]]);y("break")("}")}else y("{")("var e=types[%i].verify(%s);",N,C)("if(e)")("return%j+e",E.name+".")("}");else switch(E.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":y("if(!util.isInteger(%s))",C)("return%j",T(E,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":y("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",C,C,C,C)("return%j",T(E,"integer|Long"));break;case"float":case"double":y('if(typeof %s!=="number")',C)("return%j",T(E,"number"));break;case"bool":y('if(typeof %s!=="boolean")',C)("return%j",T(E,"boolean"));break;case"string":y("if(!util.isString(%s))",C)("return%j",T(E,"string"));break;case"bytes":y('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',C,C,C)("return%j",T(E,"buffer"))}return y}function S(y,E,N){switch(E.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":y("if(!util.key32Re.test(%s))",N)("return%j",T(E,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":y("if(!util.key64Re.test(%s))",N)("return%j",T(E,"integer|Long key"));break;case"bool":y("if(!util.key2Re.test(%s))",N)("return%j",T(E,"boolean key"))}return y}},1667:function(O,j,c){var p=j,f=c(8368);p[".google.protobuf.Any"]={fromObject:function(T){if(T&&T["@type"]){var v=T["@type"].substring(T["@type"].lastIndexOf("/")+1),S=this.lookup(v);if(S){var y=T["@type"].charAt(0)==="."?T["@type"].substr(1):T["@type"];return y.indexOf("/")===-1&&(y="/"+y),this.create({type_url:y,value:S.encode(S.fromObject(T)).finish()})}}return this.fromObject(T)},toObject:function(T,v){var S="",y="";if(v&&v.json&&T.type_url&&T.value){y=T.type_url.substring(T.type_url.lastIndexOf("/")+1),S=T.type_url.substring(0,T.type_url.lastIndexOf("/")+1);var E=this.lookup(y);E&&(T=E.decode(T.value))}if(!(T instanceof this.ctor)&&T instanceof f){var N=T.$type.toObject(T,v);return S===""&&(S="type.googleapis.com/"),y=S+(T.$type.fullName[0]==="."?T.$type.fullName.substr(1):T.$type.fullName),N["@type"]=y,N}return this.toObject(T,v)}}},1173:function(O,j,c){O.exports=C;var p,f=c(9693),T=f.LongBits,v=f.base64,S=f.utf8;function y(I,Y,F){this.fn=I,this.len=Y,this.next=void 0,this.val=F}function E(){}function N(I){this.head=I.head,this.tail=I.tail,this.len=I.len,this.next=I.states}function C(){this.len=0,this.head=new y(E,0,0),this.tail=this.head,this.states=null}var U=function(){return f.Buffer?function(){return(C.create=function(){return new p})()}:function(){return new C}};function M(I,Y,F){Y[F]=255&I}function x(I,Y){this.len=I,this.next=void 0,this.val=Y}function P(I,Y,F){for(;I.hi;)Y[F++]=127&I.lo|128,I.lo=(I.lo>>>7|I.hi<<25)>>>0,I.hi>>>=7;for(;I.lo>127;)Y[F++]=127&I.lo|128,I.lo=I.lo>>>7;Y[F++]=I.lo}function z(I,Y,F){Y[F]=255&I,Y[F+1]=I>>>8&255,Y[F+2]=I>>>16&255,Y[F+3]=I>>>24}C.create=U(),C.alloc=function(I){return new f.Array(I)},f.Array!==Array&&(C.alloc=f.pool(C.alloc,f.Array.prototype.subarray)),C.prototype._push=function(I,Y,F){return this.tail=this.tail.next=new y(I,Y,F),this.len+=Y,this},x.prototype=Object.create(y.prototype),x.prototype.fn=function(I,Y,F){for(;I>127;)Y[F++]=127&I|128,I>>>=7;Y[F]=I},C.prototype.uint32=function(I){return this.len+=(this.tail=this.tail.next=new x((I>>>=0)<128?1:I<16384?2:I<2097152?3:I<268435456?4:5,I)).len,this},C.prototype.int32=function(I){return I<0?this._push(P,10,T.fromNumber(I)):this.uint32(I)},C.prototype.sint32=function(I){return this.uint32((I<<1^I>>31)>>>0)},C.prototype.uint64=function(I){var Y=T.from(I);return this._push(P,Y.length(),Y)},C.prototype.int64=C.prototype.uint64,C.prototype.sint64=function(I){var Y=T.from(I).zzEncode();return this._push(P,Y.length(),Y)},C.prototype.bool=function(I){return this._push(M,1,I?1:0)},C.prototype.fixed32=function(I){return this._push(z,4,I>>>0)},C.prototype.sfixed32=C.prototype.fixed32,C.prototype.fixed64=function(I){var Y=T.from(I);return this._push(z,4,Y.lo)._push(z,4,Y.hi)},C.prototype.sfixed64=C.prototype.fixed64,C.prototype.float=function(I){return this._push(f.float.writeFloatLE,4,I)},C.prototype.double=function(I){return this._push(f.float.writeDoubleLE,8,I)};var Z=f.Array.prototype.set?function(I,Y,F){Y.set(I,F)}:function(I,Y,F){for(var oe=0;oe<I.length;++oe)Y[F+oe]=I[oe]};C.prototype.bytes=function(I){var Y=I.length>>>0;if(!Y)return this._push(M,1,0);if(f.isString(I)){var F=C.alloc(Y=v.length(I));v.decode(I,F,0),I=F}return this.uint32(Y)._push(Z,Y,I)},C.prototype.string=function(I){var Y=S.length(I);return Y?this.uint32(Y)._push(S.write,Y,I):this._push(M,1,0)},C.prototype.fork=function(){return this.states=new N(this),this.head=this.tail=new y(E,0,0),this.len=0,this},C.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new y(E,0,0),this.len=0),this},C.prototype.ldelim=function(){var I=this.head,Y=this.tail,F=this.len;return this.reset().uint32(F),F&&(this.tail.next=I.next,this.tail=Y,this.len+=F),this},C.prototype.finish=function(){for(var I=this.head.next,Y=this.constructor.alloc(this.len),F=0;I;)I.fn(I.val,Y,F),F+=I.len,I=I.next;return Y},C._configure=function(I){p=I,C.create=U(),p._configure()}},3155:function(O,j,c){O.exports=T;var p=c(1173);(T.prototype=Object.create(p.prototype)).constructor=T;var f=c(9693);function T(){p.call(this)}function v(S,y,E){S.length<40?f.utf8.write(S,y,E):y.utf8Write?y.utf8Write(S,E):y.write(S,E)}T._configure=function(){T.alloc=f._Buffer_allocUnsafe,T.writeBytesBuffer=f.Buffer&&f.Buffer.prototype instanceof Uint8Array&&f.Buffer.prototype.set.name==="set"?function(S,y,E){y.set(S,E)}:function(S,y,E){if(S.copy)S.copy(y,E,0,S.length);else for(var N=0;N<S.length;)y[E++]=S[N++]}},T.prototype.bytes=function(S){f.isString(S)&&(S=f._Buffer_from(S,"base64"));var y=S.length>>>0;return this.uint32(y),y&&this._push(T.writeBytesBuffer,y,S),this},T.prototype.string=function(S){var y=f.Buffer.byteLength(S);return this.uint32(y),y&&this._push(v,y,S),this},T._configure()},8e3:function(O,j,c){var p=c(7581);O.exports=c(3626)(p),"_sockjs_onload"in c.g&&setTimeout(c.g._sockjs_onload,1)},2530:function(O,j,c){var p=c(5717),f=c(685);function T(){f.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}p(T,f),O.exports=T},3212:function(O,j,c){var p=c(5717),f=c(3184);function T(){f.call(this)}p(T,f),T.prototype.removeAllListeners=function(v){v?delete this._listeners[v]:this._listeners={}},T.prototype.once=function(v,S){var y=this,E=!1;this.on(v,function N(){y.removeListener(v,N),E||(E=!0,S.apply(this,arguments))})},T.prototype.emit=function(){var v=arguments[0],S=this._listeners[v];if(S){for(var y=arguments.length,E=new Array(y-1),N=1;N<y;N++)E[N-1]=arguments[N];for(var C=0;C<S.length;C++)S[C].apply(this,E)}},T.prototype.on=T.prototype.addListener=f.prototype.addEventListener,T.prototype.removeListener=f.prototype.removeEventListener,O.exports.v=T},685:function(O){function j(c){this.type=c}j.prototype.initEvent=function(c,p,f){return this.type=c,this.bubbles=p,this.cancelable=f,this.timeStamp=+new Date,this},j.prototype.stopPropagation=function(){},j.prototype.preventDefault=function(){},j.CAPTURING_PHASE=1,j.AT_TARGET=2,j.BUBBLING_PHASE=3,O.exports=j},3184:function(O){function j(){this._listeners={}}j.prototype.addEventListener=function(c,p){c in this._listeners||(this._listeners[c]=[]);var f=this._listeners[c];f.indexOf(p)===-1&&(f=f.concat([p])),this._listeners[c]=f},j.prototype.removeEventListener=function(c,p){var f=this._listeners[c];if(f){var T=f.indexOf(p);T===-1||(f.length>1?this._listeners[c]=f.slice(0,T).concat(f.slice(T+1)):delete this._listeners[c])}},j.prototype.dispatchEvent=function(){var c=arguments[0],p=c.type,f=arguments.length===1?[c]:Array.apply(null,arguments);if(this["on"+p]&&this["on"+p].apply(this,f),p in this._listeners)for(var T=this._listeners[p],v=0;v<T.length;v++)T[v].apply(this,f)},O.exports=j},3326:function(O,j,c){var p=c(5717),f=c(685);function T(v){f.call(this),this.initEvent("message",!1,!1),this.data=v}p(T,f),O.exports=T},691:function(O,j,c){var p=c(3683);function f(T){this._transport=T,T.on("message",this._transportMessage.bind(this)),T.on("close",this._transportClose.bind(this))}f.prototype._transportClose=function(T,v){p.postMessage("c",JSON.stringify([T,v]))},f.prototype._transportMessage=function(T){p.postMessage("t",T)},f.prototype._send=function(T){this._transport.send(T)},f.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},O.exports=f},551:function(O,j,c){var p=c(273),f=c(7705),T=c(691),v=c(6311),S=c(3683),y=c(7486);O.exports=function(E,N){var C,U={};N.forEach(function(M){M.facadeTransport&&(U[M.facadeTransport.transportName]=M.facadeTransport)}),U[v.transportName]=v,E.bootstrap_iframe=function(){var M;S.currentWindowId=y.hash.slice(1),f.attachEvent("message",function(x){if(x.source===parent&&(C===void 0&&(C=x.origin),x.origin===C)){var P;try{P=JSON.parse(x.data)}catch{return void x.data}if(P.windowId===S.currentWindowId)switch(P.type){case"s":var z;try{z=JSON.parse(P.data)}catch{P.data;break}var Z=z[0],I=z[1],Y=z[2],F=z[3];if(Z!==E.version)throw new Error('Incompatible SockJS! Main site uses: "'+Z+'", the iframe: "'+E.version+'".');if(!p.isOriginEqual(Y,y.href)||!p.isOriginEqual(F,y.href))throw new Error("Can't connect to different domain from within an iframe. ("+y.href+", "+Y+", "+F+")");M=new T(new U[I](Y,F));break;case"m":M._send(P.data);break;case"c":M&&M._close(),M=null}}}),S.postMessage("s")}}},2550:function(O,j,c){var p=c(3212).v,f=c(5717),T=c(2217);function v(S,y){p.call(this);var E=this,N=+new Date;this.xo=new y("GET",S),this.xo.once("finish",function(C,U){var M,x;if(C===200){if(x=+new Date-N,U)try{M=JSON.parse(U)}catch{}T.isObject(M)||(M={})}E.emit("finish",M,x),E.removeAllListeners()})}f(v,p),v.prototype.close=function(){this.removeAllListeners(),this.xo.close()},O.exports=v},6311:function(O,j,c){var p=c(5717),f=c(3212).v,T=c(3515),v=c(2550);function S(y){var E=this;f.call(this),this.ir=new v(y,T),this.ir.once("finish",function(N,C){E.ir=null,E.emit("message",JSON.stringify([N,C]))})}p(S,f),S.transportName="iframe-info-receiver",S.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},O.exports=S},3616:function(O,j,c){var p=c(3212).v,f=c(5717),T=c(7705),v=c(5088),S=c(6311);function y(E,N){var C=this;p.call(this);var U=function(){var M=C.ifr=new v(S.transportName,N,E);M.once("message",function(x){if(x){var P;try{P=JSON.parse(x)}catch{return C.emit("finish"),void C.close()}var z=P[0],Z=P[1];C.emit("finish",z,Z)}C.close()}),M.once("close",function(){C.emit("finish"),C.close()})};c.g.document.body?U():T.attachEvent("load",U)}f(y,p),y.enabled=function(){return v.enabled()},y.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},O.exports=y},5172:function(O,j,c){var p=c(3212).v,f=c(5717),T=c(273),v=c(6073),S=c(9033),y=c(3515),E=c(7103),N=c(3616),C=c(2550);function U(M,x){var P=this;p.call(this),setTimeout(function(){P.doXhr(M,x)},0)}f(U,p),U._getReceiver=function(M,x,P){return P.sameOrigin?new C(x,y):S.enabled?new C(x,S):v.enabled&&P.sameScheme?new C(x,v):N.enabled()?new N(M,x):new C(x,E)},U.prototype.doXhr=function(M,x){var P=this,z=T.addPath(M,"/info");this.xo=U._getReceiver(M,z,x),this.timeoutRef=setTimeout(function(){P._cleanup(!1),P.emit("finish")},U.timeout),this.xo.once("finish",function(Z,I){P._cleanup(!0),P.emit("finish",Z,I)})},U.prototype._cleanup=function(M){clearTimeout(this.timeoutRef),this.timeoutRef=null,!M&&this.xo&&this.xo.close(),this.xo=null},U.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},U.timeout=8e3,O.exports=U},7486:function(O,j,c){O.exports=c.g.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}},3626:function(O,j,c){c(1247);var p,f=c(4564),T=c(5717),v=c(8915),S=c(8028),y=c(273),E=c(7705),N=c(5581),C=c(2217),U=c(8510),M=c(4886),x=c(685),P=c(3184),z=c(7486),Z=c(2530),I=c(3326),Y=c(5172);function F(W,ne,ee){if(!(this instanceof F))return new F(W,ne,ee);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");P.call(this),this.readyState=F.CONNECTING,this.extensions="",this.protocol="",(ee=ee||{}).protocols_whitelist&&M.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=ee.transports,this._transportOptions=ee.transportOptions||{},this._timeout=ee.timeout||0;var H=ee.sessionId||8;if(typeof H=="function")this._generateSessionId=H;else{if(typeof H!="number")throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return v.string(H)}}this._server=ee.server||v.numberString(1e3);var q=new f(W);if(!q.host||!q.protocol)throw new SyntaxError("The URL '"+W+"' is invalid");if(q.hash)throw new SyntaxError("The URL must not contain a fragment");if(q.protocol!=="http:"&&q.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+q.protocol+"' is not allowed.");var ve=q.protocol==="https:";if(z.protocol==="https:"&&!ve&&!y.isLoopbackAddr(q.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");ne?Array.isArray(ne)||(ne=[ne]):ne=[];var Le=ne.sort();Le.forEach(function(ge,je){if(!ge)throw new SyntaxError("The protocols entry '"+ge+"' is invalid.");if(je<Le.length-1&&ge===Le[je+1])throw new SyntaxError("The protocols entry '"+ge+"' is duplicated.")});var Oe=y.getOrigin(z.href);this._origin=Oe?Oe.toLowerCase():null,q.set("pathname",q.pathname.replace(/\/+$/,"")),this.url=q.href,this.url,this._urlInfo={nullOrigin:!U.hasDomain(),sameOrigin:y.isOriginEqual(this.url,z.href),sameScheme:y.isSchemeEqual(this.url,z.href)},this._ir=new Y(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function oe(W){return W===1e3||W>=3e3&&W<=4999}T(F,P),F.prototype.close=function(W,ne){if(W&&!oe(W))throw new Error("InvalidAccessError: Invalid code");if(ne&&ne.length>123)throw new SyntaxError("reason argument has an invalid length");this.readyState!==F.CLOSING&&this.readyState!==F.CLOSED&&this._close(W||1e3,ne||"Normal closure",!0)},F.prototype.send=function(W){if(typeof W!="string"&&(W=""+W),this.readyState===F.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===F.OPEN&&this._transport.send(S.quote(W))},F.version=c(2828),F.CONNECTING=0,F.OPEN=1,F.CLOSING=2,F.CLOSED=3,F.prototype._receiveInfo=function(W,ne){if(this._ir=null,W){this._rto=this.countRTO(ne),this._transUrl=W.base_url?W.base_url:this.url,W=C.extend(W,this._urlInfo);var ee=p.filterToEnabled(this._transportsWhitelist,W);this._transports=ee.main,this._transports.length,this._connect()}else this._close(1002,"Cannot connect to server")},F.prototype._connect=function(){for(var W=this._transports.shift();W;W=this._transports.shift()){if(W.transportName,W.needBody&&(!c.g.document.body||c.g.document.readyState!==void 0&&c.g.document.readyState!=="complete"&&c.g.document.readyState!=="interactive"))return this._transports.unshift(W),void E.attachEvent("load",this._connect.bind(this));var ne=Math.max(this._timeout,this._rto*W.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),ne);var ee=y.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),H=this._transportOptions[W.transportName],q=new W(ee,this._transUrl,H);return q.on("message",this._transportMessage.bind(this)),q.once("close",this._transportClose.bind(this)),q.transportName=W.transportName,void(this._transport=q)}this._close(2e3,"All transports failed",!1)},F.prototype._transportTimeout=function(){this.readyState===F.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},F.prototype._transportMessage=function(W){var ne,ee=this,H=W.slice(0,1),q=W.slice(1);switch(H){case"o":return void this._open();case"h":return this.dispatchEvent(new x("heartbeat")),void this.transport}if(q)try{ne=JSON.parse(q)}catch{}if(ne!==void 0)switch(H){case"a":Array.isArray(ne)&&ne.forEach(function(ve){ee.transport,ee.dispatchEvent(new I(ve))});break;case"m":this.transport,this.dispatchEvent(new I(ne));break;case"c":Array.isArray(ne)&&ne.length===2&&this._close(ne[0],ne[1],!0)}},F.prototype._transportClose=function(W,ne){this.transport,this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),oe(W)||W===2e3||this.readyState!==F.CONNECTING?this._close(W,ne):this._connect()},F.prototype._open=function(){this._transport&&this._transport.transportName,this.readyState,this.readyState===F.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=F.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new x("open")),this.transport):this._close(1006,"Server lost session")},F.prototype._close=function(W,ne,ee){this.transport,this.readyState;var H=!1;if(this._ir&&(H=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===F.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=F.CLOSING,setTimeout((function(){this.readyState=F.CLOSED,H&&this.dispatchEvent(new x("error"));var q=new Z("close");q.wasClean=ee||!1,q.code=W||1e3,q.reason=ne,this.dispatchEvent(q),this.onmessage=this.onclose=this.onerror=null}).bind(this),0)},F.prototype.countRTO=function(W){return W>100?4*W:300+W},O.exports=function(W){return p=N(W),c(551)(F,W),F}},1247:function(){var O,j=Array.prototype,c=Object.prototype,p=Function.prototype,f=String.prototype,T=j.slice,v=c.toString,S=function(W){return c.toString.call(W)==="[object Function]"},y=function(W){return v.call(W)==="[object String]"},E=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}();O=E?function(W,ne,ee,H){!H&&ne in W||Object.defineProperty(W,ne,{configurable:!0,enumerable:!1,writable:!0,value:ee})}:function(W,ne,ee,H){!H&&ne in W||(W[ne]=ee)};var N=function(W,ne,ee){for(var H in ne)c.hasOwnProperty.call(ne,H)&&O(W,H,ne[H],ee)},C=function(W){if(W==null)throw new TypeError("can't convert "+W+" to object");return Object(W)};function U(){}N(p,{bind:function(W){var ne=this;if(!S(ne))throw new TypeError("Function.prototype.bind called on incompatible "+ne);for(var ee=T.call(arguments,1),H=Math.max(0,ne.length-ee.length),q=[],ve=0;ve<H;ve++)q.push("$"+ve);var Le=Function("binder","return function ("+q.join(",")+"){ return binder.apply(this, arguments); }")(function(){if(this instanceof Le){var Oe=ne.apply(this,ee.concat(T.call(arguments)));return Object(Oe)===Oe?Oe:this}return ne.apply(W,ee.concat(T.call(arguments)))});return ne.prototype&&(U.prototype=ne.prototype,Le.prototype=new U,U.prototype=null),Le}}),N(Array,{isArray:function(W){return v.call(W)==="[object Array]"}});var M,x,P,z=Object("a"),Z=z[0]!=="a"||!(0 in z);N(j,{forEach:function(W){var ne=C(this),ee=Z&&y(this)?this.split(""):ne,H=arguments[1],q=-1,ve=ee.length>>>0;if(!S(W))throw new TypeError;for(;++q<ve;)q in ee&&W.call(H,ee[q],q,ne)}},(M=j.forEach,x=!0,P=!0,M&&(M.call("foo",function(W,ne,ee){typeof ee!="object"&&(x=!1)}),M.call([1],function(){P=typeof this=="string"},"x")),!(M&&x&&P)));var I=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;N(j,{indexOf:function(W){var ne=Z&&y(this)?this.split(""):C(this),ee=ne.length>>>0;if(!ee)return-1;var H,q=0;for(arguments.length>1&&((H=+arguments[1])!=H?H=0:H!==0&&H!==1/0&&H!==-1/0&&(H=(H>0||-1)*Math.floor(Math.abs(H))),q=H),q=q>=0?q:Math.max(0,ee+q);q<ee;q++)if(q in ne&&ne[q]===W)return q;return-1}},I);var Y,F=f.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?(Y=/()??/.exec("")[1]===void 0,f.split=function(W,ne){var ee=this;if(W===void 0&&ne===0)return[];if(v.call(W)!=="[object RegExp]")return F.call(this,W,ne);var H,q,ve,Le,Oe=[],ge=(W.ignoreCase?"i":"")+(W.multiline?"m":"")+(W.extended?"x":"")+(W.sticky?"y":""),je=0;for(W=new RegExp(W.source,ge+"g"),ee+="",Y||(H=new RegExp("^"+W.source+"$(?!\\s)",ge)),ne=ne===void 0?4294967295:ne>>>0;(q=W.exec(ee))&&!((ve=q.index+q[0].length)>je&&(Oe.push(ee.slice(je,q.index)),!Y&&q.length>1&&q[0].replace(H,function(){for(var Ne=1;Ne<arguments.length-2;Ne++)arguments[Ne]===void 0&&(q[Ne]=void 0)}),q.length>1&&q.index<ee.length&&j.push.apply(Oe,q.slice(1)),Le=q[0].length,je=ve,Oe.length>=ne));)W.lastIndex===q.index&&W.lastIndex++;return je===ee.length?!Le&&W.test("")||Oe.push(""):Oe.push(ee.slice(je)),Oe.length>ne?Oe.slice(0,ne):Oe}):"0".split(void 0,0).length&&(f.split=function(W,ne){return W===void 0&&ne===0?[]:F.call(this,W,ne)});var oe=f.substr;N(f,{substr:function(W,ne){return oe.call(this,W<0&&(W=this.length+W)<0?0:W,ne)}},"".substr&&"0b".substr(-1)!=="b")},7581:function(O,j,c){O.exports=[c(2412),c(9842),c(4620),c(3004),c(882)(c(3004)),c(5616),c(882)(c(5616)),c(2387),c(9998),c(882)(c(2387)),c(5375)]},2940:function(O,j,c){var p=c(3212).v,f=c(5717),T=c(7705),v=c(273),S=c.g.XMLHttpRequest;function y(C,U,M,x){var P=this;p.call(this),setTimeout(function(){P._start(C,U,M,x)},0)}f(y,p),y.prototype._start=function(C,U,M,x){var P=this;try{this.xhr=new S}catch{}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();U=v.addQuery(U,"t="+ +new Date),this.unloadRef=T.unloadAdd(function(){P._cleanup(!0)});try{this.xhr.open(C,U,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){P.emit("finish",0,""),P._cleanup(!1)})}catch{return this.emit("finish",0,""),void this._cleanup(!1)}if(x&&x.noCredentials||!y.supportsCORS||(this.xhr.withCredentials=!0),x&&x.headers)for(var z in x.headers)this.xhr.setRequestHeader(z,x.headers[z]);this.xhr.onreadystatechange=function(){if(P.xhr){var Z,I,Y=P.xhr;switch(Y.readyState,Y.readyState){case 3:try{I=Y.status,Z=Y.responseText}catch{}I===1223&&(I=204),I===200&&Z&&Z.length>0&&P.emit("chunk",I,Z);break;case 4:(I=Y.status)===1223&&(I=204),I!==12005&&I!==12029||(I=0),Y.responseText,P.emit("finish",I,Y.responseText),P._cleanup(!1)}}};try{P.xhr.send(M)}catch{P.emit("finish",0,""),P._cleanup(!1)}},y.prototype._cleanup=function(C){if(this.xhr){if(this.removeAllListeners(),T.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),C)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}},y.prototype.close=function(){this._cleanup(!0)},y.enabled=!!S;var E=["Active"].concat("Object").join("X");!y.enabled&&E in c.g&&(S=function(){try{return new c.g[E]("Microsoft.XMLHTTP")}catch{return null}},y.enabled=!!new S);var N=!1;try{N="withCredentials"in new S}catch{}y.supportsCORS=N,O.exports=y},3759:function(O,j,c){O.exports=c.g.EventSource},9334:function(O,j,c){var p=c.g.WebSocket||c.g.MozWebSocket;O.exports=p?function(f){return new p(f)}:void 0},3004:function(O,j,c){var p=c(5717),f=c(9395),T=c(6709),v=c(9033),S=c(3759);function y(E){if(!y.enabled())throw new Error("Transport created when disabled");f.call(this,E,"/eventsource",T,v)}p(y,f),y.enabled=function(){return!!S},y.transportName="eventsource",y.roundTrips=2,O.exports=y},5616:function(O,j,c){var p=c(5717),f=c(3608),T=c(3515),v=c(9395);function S(y){if(!f.enabled)throw new Error("Transport created when disabled");v.call(this,y,"/htmlfile",f,T)}p(S,v),S.enabled=function(y){return f.enabled&&y.sameOrigin},S.transportName="htmlfile",S.roundTrips=2,O.exports=S},5088:function(O,j,c){var p=c(5717),f=c(3212).v,T=c(2828),v=c(273),S=c(3683),y=c(7705),E=c(8915);function N(C,U,M){if(!N.enabled())throw new Error("Transport created when disabled");f.call(this);var x=this;this.origin=v.getOrigin(M),this.baseUrl=M,this.transUrl=U,this.transport=C,this.windowId=E.string(8);var P=v.addPath(M,"/iframe.html")+"#"+this.windowId;this.iframeObj=S.createIframe(P,function(z){x.emit("close",1006,"Unable to load an iframe ("+z+")"),x.close()}),this.onmessageCallback=this._message.bind(this),y.attachEvent("message",this.onmessageCallback)}p(N,f),N.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){y.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},N.prototype._message=function(C){if(C.data,!v.isOriginEqual(C.origin,this.origin))return C.origin,void this.origin;var U;try{U=JSON.parse(C.data)}catch{return void C.data}if(U.windowId!==this.windowId)return U.windowId,void this.windowId;switch(U.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([T,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",U.data);break;case"c":var M;try{M=JSON.parse(U.data)}catch{return void U.data}this.emit("close",M[0],M[1]),this.close()}},N.prototype.postMessage=function(C,U){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:C,data:U||""}),this.origin)},N.prototype.send=function(C){this.postMessage("m",C)},N.enabled=function(){return S.iframeEnabled},N.transportName="iframe",N.roundTrips=2,O.exports=N},5375:function(O,j,c){var p=c(5717),f=c(8347),T=c(514),v=c(771);function S(y){if(!S.enabled())throw new Error("Transport created when disabled");f.call(this,y,"/jsonp",v,T)}p(S,f),S.enabled=function(){return!!c.g.document},S.transportName="jsonp-polling",S.roundTrips=1,S.needBody=!0,O.exports=S},9395:function(O,j,c){var p=c(5717),f=c(273),T=c(8347);function v(S,y,E,N){T.call(this,S,y,function(C){return function(U,M,x){var P={};typeof M=="string"&&(P.headers={"Content-type":"text/plain"});var z=f.addPath(U,"/xhr_send"),Z=new C("POST",z,M,P);return Z.once("finish",function(I){if(Z=null,I!==200&&I!==204)return x(new Error("http status "+I));x()}),function(){Z.close(),Z=null;var I=new Error("Aborted");I.code=1e3,x(I)}}}(N),E,N)}p(v,T),O.exports=v},1851:function(O,j,c){var p=c(5717),f=c(3212).v;function T(v,S){f.call(this),this.sendBuffer=[],this.sender=S,this.url=v}p(T,f),T.prototype.send=function(v){this.sendBuffer.push(v),this.sendStop||this.sendSchedule()},T.prototype.sendScheduleWait=function(){var v,S=this;this.sendStop=function(){S.sendStop=null,clearTimeout(v)},v=setTimeout(function(){S.sendStop=null,S.sendSchedule()},25)},T.prototype.sendSchedule=function(){this.sendBuffer.length;var v=this;if(this.sendBuffer.length>0){var S="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,S,function(y){v.sendStop=null,y?(v.emit("close",y.code||1006,"Sending error: "+y),v.close()):v.sendScheduleWait()}),this.sendBuffer=[]}},T.prototype._cleanup=function(){this.removeAllListeners()},T.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},O.exports=T},882:function(O,j,c){var p=c(5717),f=c(5088),T=c(2217);O.exports=function(v){function S(y,E){f.call(this,v.transportName,y,E)}return p(S,f),S.enabled=function(y,E){if(!c.g.document)return!1;var N=T.extend({},E);return N.sameOrigin=!0,v.enabled(N)&&f.enabled()},S.transportName="iframe-"+v.transportName,S.needBody=!0,S.roundTrips=f.roundTrips+v.roundTrips-1,S.facadeTransport=v,S}},1265:function(O,j,c){var p=c(5717),f=c(3212).v;function T(v,S,y){f.call(this),this.Receiver=v,this.receiveUrl=S,this.AjaxObject=y,this._scheduleReceiver()}p(T,f),T.prototype._scheduleReceiver=function(){var v=this,S=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);S.on("message",function(y){v.emit("message",y)}),S.once("close",function(y,E){v.pollIsClosing,v.poll=S=null,v.pollIsClosing||(E==="network"?v._scheduleReceiver():(v.emit("close",y||1006,E),v.removeAllListeners()))})},T.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},O.exports=T},8347:function(O,j,c){var p=c(5717),f=c(273),T=c(1851),v=c(1265);function S(y,E,N,C,U){var M=f.addPath(y,E),x=this;T.call(this,y,N),this.poll=new v(C,M,U),this.poll.on("message",function(P){x.emit("message",P)}),this.poll.once("close",function(P,z){x.poll=null,x.emit("close",P,z),x.close()})}p(S,T),S.prototype.close=function(){T.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},O.exports=S},6709:function(O,j,c){var p=c(5717),f=c(3212).v,T=c(3759);function v(S){f.call(this);var y=this,E=this.es=new T(S);E.onmessage=function(N){N.data,y.emit("message",decodeURI(N.data))},E.onerror=function(N){E.readyState;var C=E.readyState!==2?"network":"permanent";y._cleanup(),y._close(C)}}p(v,f),v.prototype.abort=function(){this._cleanup(),this._close("user")},v.prototype._cleanup=function(){var S=this.es;S&&(S.onmessage=S.onerror=null,S.close(),this.es=null)},v.prototype._close=function(S){var y=this;setTimeout(function(){y.emit("close",null,S),y.removeAllListeners()},200)},O.exports=v},3608:function(O,j,c){var p=c(5717),f=c(3683),T=c(273),v=c(3212).v,S=c(8915);function y(N){v.call(this);var C=this;f.polluteGlobalNamespace(),this.id="a"+S.string(6),N=T.addQuery(N,"c="+decodeURIComponent(f.WPrefix+"."+this.id)),y.htmlfileEnabled;var U=y.htmlfileEnabled?f.createHtmlfile:f.createIframe;c.g[f.WPrefix][this.id]={start:function(){C.iframeObj.loaded()},message:function(M){C.emit("message",M)},stop:function(){C._cleanup(),C._close("network")}},this.iframeObj=U(N,function(){C._cleanup(),C._close("permanent")})}p(y,v),y.prototype.abort=function(){this._cleanup(),this._close("user")},y.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete c.g[f.WPrefix][this.id]},y.prototype._close=function(N){this.emit("close",null,N),this.removeAllListeners()},y.htmlfileEnabled=!1;var E=["Active"].concat("Object").join("X");if(E in c.g)try{y.htmlfileEnabled=!!new c.g[E]("htmlfile")}catch{}y.enabled=y.htmlfileEnabled||f.iframeEnabled,O.exports=y},514:function(O,j,c){var p=c(3683),f=c(8915),T=c(8510),v=c(273),S=c(5717),y=c(3212).v;function E(N){var C=this;y.call(this),p.polluteGlobalNamespace(),this.id="a"+f.string(6);var U=v.addQuery(N,"c="+encodeURIComponent(p.WPrefix+"."+this.id));c.g[p.WPrefix][this.id]=this._callback.bind(this),this._createScript(U),this.timeoutId=setTimeout(function(){C._abort(new Error("JSONP script loaded abnormally (timeout)"))},E.timeout)}S(E,y),E.prototype.abort=function(){if(c.g[p.WPrefix][this.id]){var N=new Error("JSONP user aborted read");N.code=1e3,this._abort(N)}},E.timeout=35e3,E.scriptErrorTimeout=1e3,E.prototype._callback=function(N){this._cleanup(),this.aborting||(N&&this.emit("message",N),this.emit("close",null,"network"),this.removeAllListeners())},E.prototype._abort=function(N){this._cleanup(),this.aborting=!0,this.emit("close",N.code,N.message),this.removeAllListeners()},E.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var N=this.script;N.parentNode.removeChild(N),N.onreadystatechange=N.onerror=N.onload=N.onclick=null,this.script=null}delete c.g[p.WPrefix][this.id]},E.prototype._scriptError=function(){var N=this;this.errorTimer||(this.errorTimer=setTimeout(function(){N.loadedOkay||N._abort(new Error("JSONP script loaded abnormally (onerror)"))},E.scriptErrorTimeout))},E.prototype._createScript=function(N){var C,U=this,M=this.script=c.g.document.createElement("script");if(M.id="a"+f.string(8),M.src=N,M.type="text/javascript",M.charset="UTF-8",M.onerror=this._scriptError.bind(this),M.onload=function(){U._abort(new Error("JSONP script loaded abnormally (onload)"))},M.onreadystatechange=function(){if(M.readyState,/loaded|closed/.test(M.readyState)){if(M&&M.htmlFor&&M.onclick){U.loadedOkay=!0;try{M.onclick()}catch{}}M&&U._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},M.async===void 0&&c.g.document.attachEvent)if(T.isOpera())(C=this.script2=c.g.document.createElement("script")).text="try{var a = document.getElementById('"+M.id+"'); if(a)a.onerror();}catch(x){};",M.async=C.async=!1;else{try{M.htmlFor=M.id,M.event="onclick"}catch{}M.async=!0}M.async!==void 0&&(M.async=!0);var x=c.g.document.getElementsByTagName("head")[0];x.insertBefore(M,x.firstChild),C&&x.insertBefore(C,x.firstChild)},O.exports=E},1044:function(O,j,c){var p=c(5717),f=c(3212).v;function T(v,S){f.call(this);var y=this;this.bufferPosition=0,this.xo=new S("POST",v,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(E,N){y._chunkHandler(E,N),y.xo=null;var C=E===200?"network":"permanent";y.emit("close",null,C),y._cleanup()})}p(T,f),T.prototype._chunkHandler=function(v,S){if(v===200&&S)for(var y=-1;;this.bufferPosition+=y+1){var E=S.slice(this.bufferPosition);if((y=E.indexOf(`
`))===-1)break;var N=E.slice(0,y);N&&this.emit("message",N)}},T.prototype._cleanup=function(){this.removeAllListeners()},T.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},O.exports=T},771:function(O,j,c){var p,f,T=c(8915),v=c(273);O.exports=function(S,y,E){p||((p=c.g.document.createElement("form")).style.display="none",p.style.position="absolute",p.method="POST",p.enctype="application/x-www-form-urlencoded",p.acceptCharset="UTF-8",(f=c.g.document.createElement("textarea")).name="d",p.appendChild(f),c.g.document.body.appendChild(p));var N="a"+T.string(8);p.target=N,p.action=v.addQuery(v.addPath(S,"/jsonp_send"),"i="+N);var C=function(M){try{return c.g.document.createElement('<iframe name="'+M+'">')}catch{var x=c.g.document.createElement("iframe");return x.name=M,x}}(N);C.id=N,C.style.display="none",p.appendChild(C);try{f.value=y}catch{}p.submit();var U=function(M){C.onerror&&(C.onreadystatechange=C.onerror=C.onload=null,setTimeout(function(){C.parentNode.removeChild(C),C=null},500),f.value="",E(M))};return C.onerror=function(){U()},C.onload=function(){U()},C.onreadystatechange=function(M){C.readyState,C.readyState==="complete"&&U()},function(){U(new Error("Aborted"))}}},6073:function(O,j,c){var p=c(3212).v,f=c(5717),T=c(7705),v=c(8510),S=c(273);function y(E,N,C){var U=this;p.call(this),setTimeout(function(){U._start(E,N,C)},0)}f(y,p),y.prototype._start=function(E,N,C){var U=this,M=new c.g.XDomainRequest;N=S.addQuery(N,"t="+ +new Date),M.onerror=function(){U._error()},M.ontimeout=function(){U._error()},M.onprogress=function(){M.responseText,U.emit("chunk",200,M.responseText)},M.onload=function(){U.emit("finish",200,M.responseText),U._cleanup(!1)},this.xdr=M,this.unloadRef=T.unloadAdd(function(){U._cleanup(!0)});try{this.xdr.open(E,N),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(C)}catch{this._error()}},y.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},y.prototype._cleanup=function(E){if(this.xdr){if(this.removeAllListeners(),T.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,E)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}},y.prototype.close=function(){this._cleanup(!0)},y.enabled=!(!c.g.XDomainRequest||!v.hasDomain()),O.exports=y},9033:function(O,j,c){var p=c(5717),f=c(2940);function T(v,S,y,E){f.call(this,v,S,y,E)}p(T,f),T.enabled=f.enabled&&f.supportsCORS,O.exports=T},7103:function(O,j,c){var p=c(3212).v;function f(){var T=this;p.call(this),this.to=setTimeout(function(){T.emit("finish",200,"{}")},f.timeout)}c(5717)(f,p),f.prototype.close=function(){clearTimeout(this.to)},f.timeout=2e3,O.exports=f},3515:function(O,j,c){var p=c(5717),f=c(2940);function T(v,S,y){f.call(this,v,S,y,{noCredentials:!0})}p(T,f),T.enabled=f.enabled,O.exports=T},2412:function(O,j,c){var p=c(7705),f=c(273),T=c(5717),v=c(3212).v,S=c(9334);function y(E,N,C){if(!y.enabled())throw new Error("Transport created when disabled");v.call(this);var U=this,M=f.addPath(E,"/websocket");M=M.slice(0,5)==="https"?"wss"+M.slice(5):"ws"+M.slice(4),this.url=M,this.ws=new S(this.url,[],C),this.ws.onmessage=function(x){x.data,U.emit("message",x.data)},this.unloadRef=p.unloadAdd(function(){U.ws.close()}),this.ws.onclose=function(x){x.code,x.reason,U.emit("close",x.code,x.reason),U._cleanup()},this.ws.onerror=function(x){U.emit("close",1006,"WebSocket connection broken"),U._cleanup()}}T(y,v),y.prototype.send=function(E){var N="["+E+"]";this.ws.send(N)},y.prototype.close=function(){var E=this.ws;this._cleanup(),E&&E.close()},y.prototype._cleanup=function(){var E=this.ws;E&&(E.onmessage=E.onclose=E.onerror=null),p.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},y.enabled=function(){return!!S},y.transportName="websocket",y.roundTrips=2,O.exports=y},9998:function(O,j,c){var p=c(5717),f=c(9395),T=c(4620),v=c(1044),S=c(6073);function y(E){if(!S.enabled)throw new Error("Transport created when disabled");f.call(this,E,"/xhr",v,S)}p(y,f),y.enabled=T.enabled,y.transportName="xdr-polling",y.roundTrips=2,O.exports=y},4620:function(O,j,c){var p=c(5717),f=c(9395),T=c(1044),v=c(6073);function S(y){if(!v.enabled)throw new Error("Transport created when disabled");f.call(this,y,"/xhr_streaming",T,v)}p(S,f),S.enabled=function(y){return!y.cookie_needed&&!y.nullOrigin&&v.enabled&&y.sameScheme},S.transportName="xdr-streaming",S.roundTrips=2,O.exports=S},2387:function(O,j,c){var p=c(5717),f=c(9395),T=c(1044),v=c(9033),S=c(3515);function y(E){if(!S.enabled&&!v.enabled)throw new Error("Transport created when disabled");f.call(this,E,"/xhr",T,v)}p(y,f),y.enabled=function(E){return!E.nullOrigin&&(!(!S.enabled||!E.sameOrigin)||v.enabled)},y.transportName="xhr-polling",y.roundTrips=2,O.exports=y},9842:function(O,j,c){var p=c(5717),f=c(9395),T=c(1044),v=c(9033),S=c(3515),y=c(8510);function E(N){if(!S.enabled&&!v.enabled)throw new Error("Transport created when disabled");f.call(this,N,"/xhr_streaming",T,v)}p(E,f),E.enabled=function(N){return!N.nullOrigin&&!y.isOpera()&&v.enabled},E.transportName="xhr-streaming",E.roundTrips=2,E.needBody=!!c.g.document,O.exports=E},2017:function(O,j,c){c.g.crypto&&c.g.crypto.getRandomValues?O.exports.randomBytes=function(p){var f=new Uint8Array(p);return c.g.crypto.getRandomValues(f),f}:O.exports.randomBytes=function(p){for(var f=new Array(p),T=0;T<p;T++)f[T]=Math.floor(256*Math.random());return f}},8510:function(O,j,c){O.exports={isOpera:function(){return c.g.navigator&&/opera/i.test(c.g.navigator.userAgent)},isKonqueror:function(){return c.g.navigator&&/konqueror/i.test(c.g.navigator.userAgent)},hasDomain:function(){if(!c.g.document)return!0;try{return!!c.g.document.domain}catch{return!1}}}},8028:function(O){var j,c=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g;O.exports={quote:function(p){var f=JSON.stringify(p);return c.lastIndex=0,c.test(f)?(j||(j=function(T){var v,S={},y=[];for(v=0;v<65536;v++)y.push(String.fromCharCode(v));return T.lastIndex=0,y.join("").replace(T,function(E){return S[E]="\\u"+("0000"+E.charCodeAt(0).toString(16)).slice(-4),""}),T.lastIndex=0,S}(c)),f.replace(c,function(T){return j[T]})):f}}},7705:function(O,j,c){var p=c(8915),f={},T=!1,v=c.g.chrome&&c.g.chrome.app&&c.g.chrome.app.runtime;O.exports={attachEvent:function(S,y){c.g.addEventListener!==void 0?c.g.addEventListener(S,y,!1):c.g.document&&c.g.attachEvent&&(c.g.document.attachEvent("on"+S,y),c.g.attachEvent("on"+S,y))},detachEvent:function(S,y){c.g.addEventListener!==void 0?c.g.removeEventListener(S,y,!1):c.g.document&&c.g.detachEvent&&(c.g.document.detachEvent("on"+S,y),c.g.detachEvent("on"+S,y))},unloadAdd:function(S){if(v)return null;var y=p.string(8);return f[y]=S,T&&setTimeout(this.triggerUnloadCallbacks,0),y},unloadDel:function(S){S in f&&delete f[S]},triggerUnloadCallbacks:function(){for(var S in f)f[S](),delete f[S]}},v||O.exports.attachEvent("unload",function(){T||(T=!0,O.exports.triggerUnloadCallbacks())})},3683:function(O,j,c){var p=c(7705),f=c(8510);O.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){O.exports.WPrefix in c.g||(c.g[O.exports.WPrefix]={})},postMessage:function(T,v){c.g.parent!==c.g&&c.g.parent.postMessage(JSON.stringify({windowId:O.exports.currentWindowId,type:T,data:v||""}),"*")},createIframe:function(T,v){var S,y,E=c.g.document.createElement("iframe"),N=function(){clearTimeout(S);try{E.onload=null}catch{}E.onerror=null},C=function(){E&&(N(),setTimeout(function(){E&&E.parentNode.removeChild(E),E=null},0),p.unloadDel(y))},U=function(M){E&&(C(),v(M))};return E.src=T,E.style.display="none",E.style.position="absolute",E.onerror=function(){U("onerror")},E.onload=function(){clearTimeout(S),S=setTimeout(function(){U("onload timeout")},2e3)},c.g.document.body.appendChild(E),S=setTimeout(function(){U("timeout")},15e3),y=p.unloadAdd(C),{post:function(M,x){setTimeout(function(){try{E&&E.contentWindow&&E.contentWindow.postMessage(M,x)}catch{}},0)},cleanup:C,loaded:N}},createHtmlfile:function(T,v){var S,y,E,N=["Active"].concat("Object").join("X"),C=new c.g[N]("htmlfile"),U=function(){clearTimeout(S),E.onerror=null},M=function(){C&&(U(),p.unloadDel(y),E.parentNode.removeChild(E),E=C=null,CollectGarbage())},x=function(z){C&&(M(),v(z))};C.open(),C.write('<html><script>document.domain="'+c.g.document.domain+'";<\/script></html>'),C.close(),C.parentWindow[O.exports.WPrefix]=c.g[O.exports.WPrefix];var P=C.createElement("div");return C.body.appendChild(P),E=C.createElement("iframe"),P.appendChild(E),E.src=T,E.onerror=function(){x("onerror")},S=setTimeout(function(){x("timeout")},15e3),y=p.unloadAdd(M),{post:function(z,Z){try{setTimeout(function(){E&&E.contentWindow&&E.contentWindow.postMessage(z,Z)},0)}catch{}},cleanup:M,loaded:U}}},O.exports.iframeEnabled=!1,c.g.document&&(O.exports.iframeEnabled=(typeof c.g.postMessage=="function"||typeof c.g.postMessage=="object")&&!f.isKonqueror())},4886:function(O,j,c){var p={};["log","debug","warn"].forEach(function(f){var T;try{T=c.g.console&&c.g.console[f]&&c.g.console[f].apply}catch{}p[f]=T?function(){return c.g.console[f].apply(c.g.console,arguments)}:f==="log"?function(){}:p.log}),O.exports=p},2217:function(O){O.exports={isObject:function(j){var c=typeof j;return c==="function"||c==="object"&&!!j},extend:function(j){if(!this.isObject(j))return j;for(var c,p,f=1,T=arguments.length;f<T;f++)for(p in c=arguments[f])Object.prototype.hasOwnProperty.call(c,p)&&(j[p]=c[p]);return j}}},8915:function(O,j,c){var p=c(2017);O.exports={string:function(f){for(var T=p.randomBytes(f),v=[],S=0;S<f;S++)v.push("abcdefghijklmnopqrstuvwxyz012345".substr(T[S]%32,1));return v.join("")},number:function(f){return Math.floor(Math.random()*f)},numberString:function(f){var T=(""+(f-1)).length;return(new Array(T+1).join("0")+this.number(f)).slice(-T)}}},5581:function(O){O.exports=function(j){return{filterToEnabled:function(c,p){var f={main:[],facade:[]};return c?typeof c=="string"&&(c=[c]):c=[],j.forEach(function(T){T&&(T.transportName==="websocket"&&p.websocket===!1||(c.length&&c.indexOf(T.transportName)===-1?T.transportName:T.enabled(p)?(T.transportName,f.main.push(T),T.facadeTransport&&f.facade.push(T.facadeTransport)):T.transportName))}),f}}}},273:function(O,j,c){var p=c(4564);O.exports={getOrigin:function(f){if(!f)return null;var T=new p(f);if(T.protocol==="file:")return null;var v=T.port;return v||(v=T.protocol==="https:"?"443":"80"),T.protocol+"//"+T.hostname+":"+v},isOriginEqual:function(f,T){return this.getOrigin(f)===this.getOrigin(T)},isSchemeEqual:function(f,T){return f.split(":")[0]===T.split(":")[0]},addPath:function(f,T){var v=f.split("?");return v[0]+T+(v[1]?"?"+v[1]:"")},addQuery:function(f,T){return f+(f.indexOf("?")===-1?"?"+T:"&"+T)},isLoopbackAddr:function(f){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(f)||/^\[::1\]$/.test(f)}}},2828:function(O){O.exports="1.6.1"},4564:function(O,j,c){var p=c(4058),f=c(8188),T=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,v=/[\n\r\t]/g,S=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,y=/:\d+$/,E=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,N=/^[a-zA-Z]:/;function C(I){return(I||"").toString().replace(T,"")}var U=[["#","hash"],["?","query"],function(I,Y){return P(Y.protocol)?I.replace(/\\/g,"/"):I},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],M={hash:1,query:1};function x(I){var Y,F=(typeof window<"u"?window:c.g!==void 0?c.g:typeof self<"u"?self:{}).location||{},oe={},W=typeof(I=I||F);if(I.protocol==="blob:")oe=new Z(unescape(I.pathname),{});else if(W==="string")for(Y in oe=new Z(I,{}),M)delete oe[Y];else if(W==="object"){for(Y in I)Y in M||(oe[Y]=I[Y]);oe.slashes===void 0&&(oe.slashes=S.test(I.href))}return oe}function P(I){return I==="file:"||I==="ftp:"||I==="http:"||I==="https:"||I==="ws:"||I==="wss:"}function z(I,Y){I=(I=C(I)).replace(v,""),Y=Y||{};var F,oe=E.exec(I),W=oe[1]?oe[1].toLowerCase():"",ne=!!oe[2],ee=!!oe[3],H=0;return ne?ee?(F=oe[2]+oe[3]+oe[4],H=oe[2].length+oe[3].length):(F=oe[2]+oe[4],H=oe[2].length):ee?(F=oe[3]+oe[4],H=oe[3].length):F=oe[4],W==="file:"?H>=2&&(F=F.slice(2)):P(W)?F=oe[4]:W?ne&&(F=F.slice(2)):H>=2&&P(Y.protocol)&&(F=oe[4]),{protocol:W,slashes:ne||P(W),slashesCount:H,rest:F}}function Z(I,Y,F){if(I=(I=C(I)).replace(v,""),!(this instanceof Z))return new Z(I,Y,F);var oe,W,ne,ee,H,q,ve=U.slice(),Le=typeof Y,Oe=this,ge=0;for(Le!=="object"&&Le!=="string"&&(F=Y,Y=null),F&&typeof F!="function"&&(F=f.parse),oe=!(W=z(I||"",Y=x(Y))).protocol&&!W.slashes,Oe.slashes=W.slashes||oe&&Y.slashes,Oe.protocol=W.protocol||Y.protocol||"",I=W.rest,(W.protocol==="file:"&&(W.slashesCount!==2||N.test(I))||!W.slashes&&(W.protocol||W.slashesCount<2||!P(Oe.protocol)))&&(ve[3]=[/(.*)/,"pathname"]);ge<ve.length;ge++)typeof(ee=ve[ge])!="function"?(ne=ee[0],q=ee[1],ne!=ne?Oe[q]=I:typeof ne=="string"?~(H=ne==="@"?I.lastIndexOf(ne):I.indexOf(ne))&&(typeof ee[2]=="number"?(Oe[q]=I.slice(0,H),I=I.slice(H+ee[2])):(Oe[q]=I.slice(H),I=I.slice(0,H))):(H=ne.exec(I))&&(Oe[q]=H[1],I=I.slice(0,H.index)),Oe[q]=Oe[q]||oe&&ee[3]&&Y[q]||"",ee[4]&&(Oe[q]=Oe[q].toLowerCase())):I=ee(I,Oe);F&&(Oe.query=F(Oe.query)),oe&&Y.slashes&&Oe.pathname.charAt(0)!=="/"&&(Oe.pathname!==""||Y.pathname!=="")&&(Oe.pathname=function(je,Ne){if(je==="")return Ne;for(var Be=(Ne||"/").split("/").slice(0,-1).concat(je.split("/")),Ye=Be.length,pt=Be[Ye-1],dt=!1,Ie=0;Ye--;)Be[Ye]==="."?Be.splice(Ye,1):Be[Ye]===".."?(Be.splice(Ye,1),Ie++):Ie&&(Ye===0&&(dt=!0),Be.splice(Ye,1),Ie--);return dt&&Be.unshift(""),pt!=="."&&pt!==".."||Be.push(""),Be.join("/")}(Oe.pathname,Y.pathname)),Oe.pathname.charAt(0)!=="/"&&P(Oe.protocol)&&(Oe.pathname="/"+Oe.pathname),p(Oe.port,Oe.protocol)||(Oe.host=Oe.hostname,Oe.port=""),Oe.username=Oe.password="",Oe.auth&&(~(H=Oe.auth.indexOf(":"))?(Oe.username=Oe.auth.slice(0,H),Oe.username=encodeURIComponent(decodeURIComponent(Oe.username)),Oe.password=Oe.auth.slice(H+1),Oe.password=encodeURIComponent(decodeURIComponent(Oe.password))):Oe.username=encodeURIComponent(decodeURIComponent(Oe.auth)),Oe.auth=Oe.password?Oe.username+":"+Oe.password:Oe.username),Oe.origin=Oe.protocol!=="file:"&&P(Oe.protocol)&&Oe.host?Oe.protocol+"//"+Oe.host:"null",Oe.href=Oe.toString()}Z.prototype={set:function(I,Y,F){var oe=this;switch(I){case"query":typeof Y=="string"&&Y.length&&(Y=(F||f.parse)(Y)),oe[I]=Y;break;case"port":oe[I]=Y,p(Y,oe.protocol)?Y&&(oe.host=oe.hostname+":"+Y):(oe.host=oe.hostname,oe[I]="");break;case"hostname":oe[I]=Y,oe.port&&(Y+=":"+oe.port),oe.host=Y;break;case"host":oe[I]=Y,y.test(Y)?(Y=Y.split(":"),oe.port=Y.pop(),oe.hostname=Y.join(":")):(oe.hostname=Y,oe.port="");break;case"protocol":oe.protocol=Y.toLowerCase(),oe.slashes=!F;break;case"pathname":case"hash":if(Y){var W=I==="pathname"?"/":"#";oe[I]=Y.charAt(0)!==W?W+Y:Y}else oe[I]=Y;break;case"username":case"password":oe[I]=encodeURIComponent(Y);break;case"auth":var ne=Y.indexOf(":");~ne?(oe.username=Y.slice(0,ne),oe.username=encodeURIComponent(decodeURIComponent(oe.username)),oe.password=Y.slice(ne+1),oe.password=encodeURIComponent(decodeURIComponent(oe.password))):oe.username=encodeURIComponent(decodeURIComponent(Y))}for(var ee=0;ee<U.length;ee++){var H=U[ee];H[4]&&(oe[H[1]]=oe[H[1]].toLowerCase())}return oe.auth=oe.password?oe.username+":"+oe.password:oe.username,oe.origin=oe.protocol!=="file:"&&P(oe.protocol)&&oe.host?oe.protocol+"//"+oe.host:"null",oe.href=oe.toString(),oe},toString:function(I){I&&typeof I=="function"||(I=f.stringify);var Y,F=this,oe=F.host,W=F.protocol;W&&W.charAt(W.length-1)!==":"&&(W+=":");var ne=W+(F.protocol&&F.slashes||P(F.protocol)?"//":"");return F.username?(ne+=F.username,F.password&&(ne+=":"+F.password),ne+="@"):F.password?(ne+=":"+F.password,ne+="@"):F.protocol!=="file:"&&P(F.protocol)&&!oe&&F.pathname!=="/"&&(ne+="@"),(oe[oe.length-1]===":"||y.test(F.hostname)&&!F.port)&&(oe+=":"),ne+=oe+F.pathname,(Y=typeof F.query=="object"?I(F.query):F.query)&&(ne+=Y.charAt(0)!=="?"?"?"+Y:Y),F.hash&&(ne+=F.hash),ne}},Z.extractProtocol=z,Z.location=x,Z.trimLeft=C,Z.qs=f,O.exports=Z},8188:function(O,j){var c=Object.prototype.hasOwnProperty;function p(T){try{return decodeURIComponent(T.replace(/\+/g," "))}catch{return null}}function f(T){try{return encodeURIComponent(T)}catch{return null}}j.stringify=function(T,v){v=v||"";var S,y,E=[];for(y in typeof v!="string"&&(v="?"),T)if(c.call(T,y)){if((S=T[y])||S!=null&&!isNaN(S)||(S=""),y=f(y),S=f(S),y===null||S===null)continue;E.push(y+"="+S)}return E.length?v+E.join("&"):""},j.parse=function(T){for(var v,S=/([^=?#&]+)=?([^&]*)/g,y={};v=S.exec(T);){var E=p(v[1]),N=p(v[2]);E===null||N===null||E in y||(y[E]=N)}return y}},4058:function(O){O.exports=function(j,c){if(c=c.split(":")[0],!(j=+j))return!1;switch(c){case"http":case"ws":return j!==80;case"https":case"wss":return j!==443;case"ftp":return j!==21;case"gopher":return j!==70;case"file":return!1}return j!==0}}},de={};function fe(O){var j=de[O];if(j!==void 0)return j.exports;var c=de[O]={exports:{}};return be[O].call(c.exports,c,c.exports,fe),c.exports}fe.amdO={},fe.n=function(O){var j=O&&O.__esModule?function(){return O.default}:function(){return O};return fe.d(j,{a:j}),j},fe.d=function(O,j){for(var c in j)fe.o(j,c)&&!fe.o(O,c)&&Object.defineProperty(O,c,{enumerable:!0,get:j[c]})},fe.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),fe.o=function(O,j){return Object.prototype.hasOwnProperty.call(O,j)},fe.r=function(O){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(O,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(O,"__esModule",{value:!0})};var We={};return function(){fe.r(We),fe.d(We,{default:function(){return mr}});var O=fe(8e3),j=fe.n(O),c=fe(3281),p=fe.n(c),f=fe(3720),T=fe.n(f),v=(fe(9601),fe(1539),fe(8674),fe(2526),fe(1817),fe(2165),fe(6992),fe(8783),fe(3948),fe(8309),fe(3843),fe(3710),fe(1532),fe(4812),fe(9070),fe(7941),fe(2222),fe(9653),fe(9575),fe(2472),fe(2990),fe(8927),fe(3105),fe(5035),fe(4345),fe(7174),fe(2846),fe(4731),fe(7209),fe(6319),fe(8867),fe(7789),fe(3739),fe(9368),fe(4483),fe(2056),fe(3462),fe(678),fe(7462),fe(3824),fe(5021),fe(2974),fe(5016),fe(5827),fe(2564),fe(9554),fe(4747),fe(7327),fe(561),fe(7252)),S=fe(4024),y=fe(4998),E=fe(5531),N=fe(6424),C=(fe(6699),fe(7360)),U=["onTextMessage","onFileMessage","onAudioMessage","onVideoMessage","onImageMessage","onLocationMessage","onCustomMessage","onCMDMessage"],M=function(){function ae(Ae,le,Xe){this.handlerData={},this.handlerData={},Ae.addEventHandler=this.addEventHandler.bind(this),Ae.removeEventHandler=this.removeEventHandler.bind(this)}return ae.prototype.addEventHandler=function(Ae,le){this.handlerData[Ae]=le},ae.prototype.removeEventHandler=function(Ae){delete this.handlerData[Ae]},ae.prototype.dispatch=function(Ae,le){for(var Xe in U.includes(Ae)&&le?C.kg.debug("dispatch event: "+Ae,{id:le.id,type:le.type,time:le.time,from:le.from,to:le.to,chatType:le.chatType}):Ae==="onMessage"?C.kg.debug("dispatch event: "+Ae,le?.length):C.kg.debug("dispatch event: "+Ae,le||""),this.handlerData){var X=this.handlerData[Xe][Ae];X&&X(le)}},ae}(),x=function(){};function P(ae){this.onOpened=ae.onOpened||x,this.onPresence=ae.onPresence||x,this.onTextMessage=ae.onTextMessage||x,this.onPictureMessage=ae.onPictureMessage||x,this.onAudioMessage=ae.onAudioMessage||x,this.onVideoMessage=ae.onVideoMessage||x,this.onFileMessage=ae.onFileMessage||x,this.onLocationMessage=ae.onLocationMessage||x,this.onCmdMessage=ae.onCmdMessage||x,this.onCustomMessage=ae.onCustomMessage||x,this.onReceivedMessage=ae.onReceivedMessage||x,this.onDeliveredMessage=ae.onDeliveredMessage||x,this.onReadMessage=ae.onReadMessage||x,this.onRecallMessage=ae.onRecallMessage||x,this.onChannelMessage=ae.onChannelMessage||x,this.onError=ae.onError||x,this.onOffline=ae.onOffline||x,this.onOnline=ae.onOnline||x,this.onStatisticMessage=ae.onStatisticMessage||x,this.onContactInvited=ae.onContactInvited||x,this.onContactAgreed=ae.onContactAgreed||x,this.onContactRefuse=ae.onContactRefuse||x,this.onContactDeleted=ae.onContactDeleted||x,this.onContactAdded=ae.onContactAdded||x,this.onTokenWillExpire=ae.onTokenWillExpire||x,this.onTokenExpired=ae.onTokenExpired||x,this.onClosed=ae.onClosed||x,this.onPresenceStatusChange=ae.onPresenceStatusChange||x}fe(2772);var z={biz:"",debug:!1,token:""},Z="https://data-reporting.agora.io/report",I="https://data-reporting.sh.agoralab.co/report",Y=(fe(2023),fe(2071)),F=fe(1595),oe=function(ae){var Ae=Number(F.C8[ae]);return Ae===F.C8.USER_LOGIN?"MANUALLOGIN":Ae===F.C8.MSYNC_SENDMESSAGE?"SENDMESSAGE":Ae>F.C8.UNKNOWOPERATION&&Ae<F.C8.REST_OPERATE?"REST":Ae>F.C8.REST_OPERATE&&Ae<F.C8.MSYNC_OPERATE?"MESSAGE":Ae>F.C8.MSYNC_OPERATE&&Ae<F.C8.ROSTER_OPERATE?"ROSTER":Ae>F.C8.ROSTER_OPERATE&&Ae<F.C8.USER_OPERATE?"USER":Ae>F.C8.USER_OPERATE&&Ae<F.C8.GROUP_OPERATE?"GROUP":Ae>F.C8.GROUP_OPERATE&&Ae<F.C8.CHATROOM_OPERATE?"CHATROOM":"OPERATION"},W=function(){return new Date().getTime()},ne=function(ae){return[S.iw.BAIDU,S.iw.WX,S.iw.DD,S.iw.ZFB,S.iw.TT,S.iw.QUICK_APP,S.iw.UNI].includes(ae.platform)},ee=function(){return ae=1,Ae=99999,ae=Math.ceil(ae),Ae=Math.floor(Ae),Math.floor(Math.random()*(Ae-ae))+ae;var ae,Ae},H={},q=(fe(1249),function(ae,Ae){var le={};for(var Xe in ae)Object.prototype.hasOwnProperty.call(ae,Xe)&&Ae.indexOf(Xe)<0&&(le[Xe]=ae[Xe]);if(ae!=null&&typeof Object.getOwnPropertySymbols=="function"){var X=0;for(Xe=Object.getOwnPropertySymbols(ae);X<Xe.length;X++)Ae.indexOf(Xe[X])<0&&Object.prototype.propertyIsEnumerable.call(ae,Xe[X])&&(le[Xe[X]]=ae[Xe[X]])}return le}),ve=1e3,Le=function(){function ae(Ae){this.eventQueue=[],this.stock=ve,this.config=Ae,this.governor()}return ae.prototype.add=function(Ae){this.stock<=0?console.warn("Event Report limit ".concat(ve," per minute")):(this.eventQueue.push(Ae),this.consume(),this.stock-=1)},ae.prototype.consume=function(){var Ae=this;this.eventQueue.length!==0&&(this.timer&&this.eventQueue.length<=10&&clearTimeout(this.timer),this.timer=setTimeout(function(){var le,Xe=Ae.eventQueue.splice(0,10),X=Xe.filter(function(Me){return Me.appId===Xe[0].appId}),et=Xe.filter(function(Me){return Me.appId!==Xe[0].appId});(le=Ae.eventQueue).unshift.apply(le,et),Ae.batchSend(X)},1e3))},ae.prototype.governor=function(){var Ae=this,le=setInterval(function(){Ae.stock=ve},6e4);typeof addEventListener<"u"&&addEventListener("beforeunload",function(){clearInterval(le)})},ae.prototype.batchSend=function(Ae){var le,Xe;if(Ae===void 0&&(Ae=[]),Ae.length!==0)try{var X=Ae.map(function(et){et.biz,et.appId;var Me=et.eventId,He=q(et,["biz","appId","eventId"]);return{eventId:Number(Me),body:He}});(function(et,Me){try{var He=Me.biz,Qe=Me.appId,ht=Me.data,rt=Me.debug,Ct=Me.onSuccess;if(!He)throw new Error("biz is not defined");H.global||(H=S.P6.getEnvInfo());var xt=H;if(ne(xt)){var Nt={url:rt?I:Z,data:ht,method:"POST",success:function(){Ct?.()},fail:function(){},complete:function(){}},yr={token:et,appid:Qe??"",sendts:"".concat(Math.floor(new Date().getTime()/1e3)),biz:He,debug:"".concat(rt)};if(xt.platform==="zfb"||xt.platform==="dd"?Nt.headers=yr:Nt.header=yr,xt.platform==="dd")return xt.global.httpRequest(Nt);xt.global.request(Nt)}else{var w=new XMLHttpRequest;w.onreadystatechange=function(){w.readyState===2&&Ct?.()},w.open("POST",rt?I:Z),w.setRequestHeader("Content-Type","application/json"),w.setRequestHeader("token",et),w.setRequestHeader("appid",Qe??""),w.setRequestHeader("sendts","".concat(Math.floor(new Date().getTime()/1e3))),w.setRequestHeader("biz",He),w.setRequestHeader("debug","".concat(rt)),w.send(JSON.stringify(ht))}}catch(te){console.error(te)}})(this.config.token,{biz:(le=Ae[0])===null||le===void 0?void 0:le.biz,appId:(Xe=Ae[0])===null||Xe===void 0?void 0:Xe.appId,data:X,debug:this.config.debug,onSuccess:this.consume.bind(this)})}catch(et){console.error(et)}},ae}(),Oe=function(){return Oe=Object.assign||function(ae){for(var Ae,le=1,Xe=arguments.length;le<Xe;le++)for(var X in Ae=arguments[le])Object.prototype.hasOwnProperty.call(Ae,X)&&(ae[X]=Ae[X]);return ae},Oe.apply(this,arguments)},ge=new(function(){function ae(Ae){this.inited=!1,this.appId="",this.biz="",this.eventQueue={},this.config=z,Ae&&this.init(Ae)}return ae.prototype.init=function(Ae){var le;if(Ae===void 0&&(Ae={}),!Ae.biz||!Ae.token)throw new Error("Event Report: biz or token is not defined");try{this.appId=(le=Ae.appId)!==null&&le!==void 0?le:"",this.biz=Ae.biz,this.config=Oe(Oe({},z),Ae),this.eventQueue=new Le(this.config),this.log(Ae),this.inited=!0}catch(Xe){console.error(Xe)}},ae.prototype.send=function(Ae,le,Xe){var X;if(le===void 0&&(le={}),this.inited){var et=Oe(Oe({},le),{eventId:Number(Ae),biz:this.biz,appId:(X=Xe?.appId)!==null&&X!==void 0?X:this.appId});this.eventQueue.add(et),this.log(et)}else console.error("Event Report: init is not called")},ae.prototype.log=function(Ae){try{if(this.config.debug){var le=Ae.payload,Xe=function(X,et){var Me={};for(var He in X)Object.prototype.hasOwnProperty.call(X,He)&&et.indexOf(He)<0&&(Me[He]=X[He]);if(X!=null&&typeof Object.getOwnPropertySymbols=="function"){var Qe=0;for(He=Object.getOwnPropertySymbols(X);Qe<He.length;Qe++)et.indexOf(He[Qe])<0&&Object.prototype.propertyIsEnumerable.call(X,He[Qe])&&(Me[He[Qe]]=X[He[Qe]])}return Me}(Ae,["payload"]);console.log("%c Event Report: ".concat(this.config.biz," "),"background: #8A97FC; color: #fff"),console.table(Xe),le&&(console.info("payload:"),console.table(le))}}catch(X){console.error(X)}},ae}()),je=function(){return je=Object.assign||function(ae){for(var Ae,le=1,Xe=arguments.length;le<Xe;le++)for(var X in Ae=arguments[le])Object.prototype.hasOwnProperty.call(Ae,X)&&(ae[X]=Ae[X]);return ae},je.apply(this,arguments)},Ne={requestName:"",subrequestid:"1",requestMethod:"GET",requestUrl:"",requestElapse:0,code:0,codeDesc:"",isLastApi:0,isSuccess:1},Be=function(){function ae(Ae){this.platform=S.P6.getEnvInfo(),this.isReportDt=Ae.isReport||!1,this.isCollectDt=!0,ne(this.platform)&&!this.isReportDt&&(this.isCollectDt=!1),this.eventQueue=[],this.accessChannel=Y.yK,this.options=function(le,Xe){Xe.platform||(Xe=S.P6.getEnvInfo());var X=le.org,et=le.appkey,Me=le.deviceId,He=le.sdkVersion,Qe=navigator?.userAgent||"".concat(Xe.platform,"_mini_program");return{org:X,appkey:et,deviceId:Me,sdkServiceId:"sid_".concat(S.P6.getUniqueId(),"_").concat(ee()),did:Qe,sdkVersion:He,os:Y.Wc,sdkProduct:F.aC.web}}(Ae,this.platform),this.sid=this.options.sdkServiceId,this.init(Ae)}return ae.getInstance=function(){return ae.instance},ae.prototype.getServiceId=function(){return this.sid||"sid_0"},ae.prototype.setIsReportDt=function(Ae){this.isReportDt=Ae,Ae&&this.rptEventQueue()},ae.prototype.setIsCollectDt=function(Ae){this.isCollectDt=Ae,Ae||(this.eventQueue=[])},ae.prototype.rptEventQueue=function(){var Ae=this;this.eventQueue.length&&this.eventQueue.forEach(function(le,Xe){ge.send(le.eventId,le.dt),Xe>=Ae.eventQueue.length-1&&(Ae.eventQueue=[])})},ae.prototype.init=function(Ae){ae.instance||(ae.instance=this,ge.init({biz:Y.el,token:Y.$x,appId:Ae.appkey,debug:!1}),this.reportInit())},ae.prototype.reportInit=function(){if(this.isCollectDt){var Ae=this.options,le=Ae.did,Xe=Ae.os,X=Ae.sdkVersion,et=Ae.deviceId;this.reportData(Y.iB.INIT,{did:le,os:Xe,sdkVersion:X,deviceId:et})}},ae.prototype.geOperateFun=function(Ae){var le=this;if(!this.isCollectDt)return function(){};var Xe=1,X=0,et="",Me=W(),He=Ae.uid,Qe=Ae.operationName;He&&(this.uid=He);var ht={uid:this.uid,operationId:"opr_".concat(S.P6.getUniqueId(),"_").concat(ee()),requestid:"req_".concat(S.P6.getUniqueId(),"_").concat(ee()),operationName:Qe};return function(rt){var Ct,xt,Nt,yr;if(rt.data.isSuccess?(X=0,et=""):(rt.data.code===0&&(rt.data.code=Y.Tp),X=(Ct=rt.data.code)!==null&&Ct!==void 0?Ct:X,et=(xt=rt.data.codeDesc)!==null&&xt!==void 0?xt:et),!((Nt=rt.data)===null||Nt===void 0)&&Nt.accessChannel&&(le.accessChannel=(yr=rt.data)===null||yr===void 0?void 0:yr.accessChannel),rt.isRetry?(Xe++,rt.data.subrequestid="".concat(Xe)):(ht.requestid="req_".concat(S.P6.getUniqueId(),"_").concat(ee()),Xe=1),rt.data.isLastApi){var w=W();rt.data.requestElapse=w-Me,rt.data.requestMethod="",rt.data.subrequestid="0",rt.data.code=X===200?0:X,rt.data.codeDesc=et}else rt.data.requestName||(rt.data.requestName=Qe);rt.data.requestElapse||(rt.data.requestElapse=W()-Me),le.reportData.call(le,Y.iB.API,je(je(je(je({},Ne),ht),rt.data),{accessChannel:le.accessChannel,operationType:oe(Qe)})),rt.isEndApi&&le.reportData.call(le,Y.iB.API,je(je(je({},ht),Ne),{isSuccess:rt.data.isSuccess,isLastApi:1,subrequestid:"0",requestMethod:"",code:X===200?0:X,codeDesc:et,requestElapse:rt.data.requestElapse,accessChannel:le.accessChannel,operationType:oe(Qe)}))}},ae.prototype.reportData=function(Ae,le){return Xe=this,X=void 0,Me=function(){var He,Qe,ht,rt,Ct,xt,Nt,yr;return function(w,te){var Re,re,Ee,Ge,he={label:0,sent:function(){if(1&Ee[0])throw Ee[1];return Ee[1]},trys:[],ops:[]};return Ge={next:$e(0),throw:$e(1),return:$e(2)},typeof Symbol=="function"&&(Ge[Symbol.iterator]=function(){return this}),Ge;function $e(ye){return function(lt){return function(Ze){if(Re)throw new TypeError("Generator is already executing.");for(;he;)try{if(Re=1,re&&(Ee=2&Ze[0]?re.return:Ze[0]?re.throw||((Ee=re.return)&&Ee.call(re),0):re.next)&&!(Ee=Ee.call(re,Ze[1])).done)return Ee;switch(re=0,Ee&&(Ze=[2&Ze[0],Ee.value]),Ze[0]){case 0:case 1:Ee=Ze;break;case 4:return he.label++,{value:Ze[1],done:!1};case 5:he.label++,re=Ze[1],Ze=[0];continue;case 7:Ze=he.ops.pop(),he.trys.pop();continue;default:if(!((Ee=(Ee=he.trys).length>0&&Ee[Ee.length-1])||Ze[0]!==6&&Ze[0]!==2)){he=0;continue}if(Ze[0]===3&&(!Ee||Ze[1]>Ee[0]&&Ze[1]<Ee[3])){he.label=Ze[1];break}if(Ze[0]===6&&he.label<Ee[1]){he.label=Ee[1],Ee=Ze;break}if(Ee&&he.label<Ee[2]){he.label=Ee[2],he.ops.push(Ze);break}Ee[2]&&he.ops.pop(),he.trys.pop();continue}Ze=te.call(w,he)}catch(Dt){Ze=[6,Dt],re=0}finally{Re=Ee=0}if(5&Ze[0])throw Ze[1];return{value:Ze[0]?Ze[1]:void 0,done:!0}}([ye,lt])}}}(this,function(w){switch(w.label){case 0:return w.trys.push([0,3,,4]),He=W(),Qe=0,Ae!==Y.iB.API?[3,2]:[4,(te=this.platform,new Promise(function(Re){var re;te.platform||(te=S.P6.getEnvInfo());var Ee="";if(te.platform===S.iw.WEB){var Ge=navigator.connection;Ge?.type?(Ge?.type,Ee=F.td.WIFI):Ge?.effectiveType&&(Ee=F.td[Ge.effectiveType.toLocaleUpperCase()]),Re(Ee)}else te.platform===S.iw.NODE?(Ee=F.td.UNKNOWN,Re(Ee)):(re=te.global)===null||re===void 0||re.getNetworkType({success:function(he){Ee=F.td[he.networkType.toLocaleUpperCase()],Re(Ee)}})}))];case 1:Qe=w.sent(),w.label=2;case 2:return ht=this.options,rt=ht.appkey,Ct=ht.sdkServiceId,xt=ht.sdkProduct,Nt=je({lts:He,net:Qe,appkey:rt,sdkServiceId:Ct,sdkProduct:xt},le),this.isReportDt?ge.send(Ae,Nt):this.isCollectDt&&this.eventQueue.push({eventId:Ae,dt:Nt}),[3,4];case 3:return yr=w.sent(),console.warn(yr),[3,4];case 4:return[2]}var te})},new((et=void 0)||(et=Promise))(function(He,Qe){function ht(xt){try{Ct(Me.next(xt))}catch(Nt){Qe(Nt)}}function rt(xt){try{Ct(Me.throw(xt))}catch(Nt){Qe(Nt)}}function Ct(xt){var Nt;xt.done?He(xt.value):(Nt=xt.value,Nt instanceof et?Nt:new et(function(yr){yr(Nt)})).then(ht,rt)}Ct((Me=Me.apply(Xe,X||[])).next())});var Xe,X,et,Me},ae}(),Ye=fe(7288),pt=fe(7479),dt=fe(2856),Ie=fe(9667),we=fe(3770),ft=fe(1735),qe=fe(7384),it=fe(70),Tt=fe(8161);function Pt(ae){return Pt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(Ae){return typeof Ae}:function(Ae){return Ae&&typeof Symbol=="function"&&Ae.constructor===Symbol&&Ae!==Symbol.prototype?"symbol":typeof Ae},Pt(ae)}var bt=function(){return bt=Object.assign||function(ae){for(var Ae,le=1,Xe=arguments.length;le<Xe;le++)for(var X in Ae=arguments[le])Object.prototype.hasOwnProperty.call(Ae,X)&&(ae[X]=Ae[X]);return ae},bt.apply(this,arguments)},jt=function(ae,Ae){var le,Xe,X,et,Me={label:0,sent:function(){if(1&X[0])throw X[1];return X[1]},trys:[],ops:[]};return et={next:He(0),throw:He(1),return:He(2)},typeof Symbol=="function"&&(et[Symbol.iterator]=function(){return this}),et;function He(Qe){return function(ht){return function(rt){if(le)throw new TypeError("Generator is already executing.");for(;Me;)try{if(le=1,Xe&&(X=2&rt[0]?Xe.return:rt[0]?Xe.throw||((X=Xe.return)&&X.call(Xe),0):Xe.next)&&!(X=X.call(Xe,rt[1])).done)return X;switch(Xe=0,X&&(rt=[2&rt[0],X.value]),rt[0]){case 0:case 1:X=rt;break;case 4:return Me.label++,{value:rt[1],done:!1};case 5:Me.label++,Xe=rt[1],rt=[0];continue;case 7:rt=Me.ops.pop(),Me.trys.pop();continue;default:if(!((X=(X=Me.trys).length>0&&X[X.length-1])||rt[0]!==6&&rt[0]!==2)){Me=0;continue}if(rt[0]===3&&(!X||rt[1]>X[0]&&rt[1]<X[3])){Me.label=rt[1];break}if(rt[0]===6&&Me.label<X[1]){Me.label=X[1],X=rt;break}if(X&&Me.label<X[2]){Me.label=X[2],Me.ops.push(rt);break}X[2]&&Me.ops.pop(),Me.trys.pop();continue}rt=Ae.call(ae,Me)}catch(Ct){rt=[6,Ct],Xe=0}finally{le=X=0}if(5&rt[0])throw rt[1];return{value:rt[0]?rt[1]:void 0,done:!0}}([Qe,ht])}}},Lt=S.P6.getEnvInfo(),Gt=Lt.platform==="web",pr=function(){},ir={CLOSED:3,CONNECTING:0,OPEN:1},Ar=function(){function ae(Ae){var le,Xe;if(this.name="connection",this.max_cache_length=100,this.enableReportLogs=!1,this._reportLogs=!1,this._reportInterval=3e5,this.unSyncQueue=[],this.lastHeartbeat=Date.now(),this.isDebug=Ae.isDebug||!1,this.isReport=!1,this.enableReportLogs=Ae.enableReportLogs||!1,this.uploadPartEnable=!0,this.isHttpDNS=Ae.isHttpDNS===void 0?Gt:Ae.isHttpDNS,this.heartBeatWait=Ae.heartBeatWait||3e4,this.autoReconnectNumMax=Ae.autoReconnectNumMax||5,this.refreshDNSIntervals=this.autoReconnectNumMax<5?this.autoReconnectNumMax:5,this.delivery=Ae.delivery||!1,this.disconnectedReason=void 0,this.loginInfoCustomExt=void 0,this.dnsArr=["https://rs.easemob.com","https://rs.chat.agora.io","http://59.110.89.59","http://39.97.193.190","http://39.97.193.187"],this.dnsIndex=0,this.dnsTotal=this.dnsArr.length,this.restHosts=[],this.restTotal=0,this.restIndex=0,this.hostIndex=0,this.socketHost=[],this.hostTotal=0,this.times=1,this.autoReconnectNumTotal=0,this.domain="easemob.com",this.appKey=Ae.appKey,this.appName="",this.orgName="",this.token="",this.grantType="",this.apiUrl=Ae.apiUrl||"",this.url=Ae.url||"",this.https=Ae.https||typeof window<"u"&&((le=window.location)===null||le===void 0?void 0:le.protocol)==="https:",this.version="1.3.1",this.deviceId=Ae.deviceId||"webim",this.isFixedDeviceId=(Xe=Ae.isFixedDeviceId)===null||Xe===void 0||Xe,this.osType=16,this.useOwnUploadFun=Ae.useOwnUploadFun||!1,this.compressType=[0],this.encryptType=[0],this.clientResource="",this.expiresIn=0,this.expirationTime=0,this.useReplacedMessageContents=Ae.useReplacedMessageContents||!1,this.logOut=!0,this.context={jid:{appKey:"",clientResource:"",domain:"easemob.com",name:""},userId:"",appKey:"",status:0,restTokenData:"",appName:"",orgName:"",root:{},accessToken:""},this._msgHash={},this._msgPromiseHash={},this._queues=[],this._load_msg_cache=[],this.unMSyncSendMsgMap=new Map,this.mr_cache={},this.reconnecting=!1,this._offlineMessagePullState=y.a.SYNC_INIT,this._offlineMessagePullQueue=[],this.uniPushConfig={},this.uniPush=null,this.isRegisterPush=!1,this.pushCertificateName="",typeof this.appKey!="string"||this.appKey.split("#").length!==2)throw Error("Illegal appKey: ".concat(this.appKey));this.devInfos=this.appKey.split("#"),this.orgName=this.devInfos[0],this.appName=this.devInfos[1],this.listen=P.bind(this),this.mSync=this.usePlugin(N.ZP),this.eventHandler=this.usePlugin(M),Object.assign(ae.prototype,pt),Object.assign(ae.prototype,dt),Object.assign(ae.prototype,Ie),Object.assign(ae.prototype,we),Object.assign(ae.prototype,ft),Object.assign(ae.prototype,qe),Object.assign(ae.prototype,it),this.dataReport=new Be({appkey:this.appKey,org:this.orgName,sdkVersion:this.version,deviceId:this.deviceId,isReport:this.isReport});var X=0,et=this;if(Object.defineProperty(S.P6,"ajaxUnconventionalErrorTimes",{set:function(He){He!==0&&(C.kg.debug("rest api request fail times: ".concat(He)),(X=He)%5==0&&et.isHttpDNS&&(C.kg.debug("refresh dns config when rest request fail."),Kt.call(et,"refresh",{},{})))},get:function(){return X}}),this.isFixedDeviceId){var Me=S.P6.getLocalDeviceInfo();Me&&(this.clientResource=JSON.parse(Me).deviceId)}C.kg.debug("init SDK: Conn ".concat(this.version," ").concat(Lt.platform))}return ae.prototype.usePlugin=function(Ae,le){if(le!=="push")return le?void(this[le]=new Ae(this)):new Ae(this);Ae.config&&Ae.emPush?(this.uniPushConfig=Ae.config,this.uniPush=Ae.emPush):C.kg.error("use push plugin failed","emPush",this.uniPush,"config",this.uniPushConfig)},ae.prototype.listen=function(Ae){},ae.prototype.addEventHandler=function(Ae,le){},ae.prototype.removeEventHandler=function(Ae){},ae.prototype.registerUser=function(Ae){var le=this;return new Promise(function(Xe,X){var et=le.dataReport.geOperateFun({uid:Ae.username,operationName:F.fI.REGISTER});if(le.isHttpDNS){le.dnsIndex=0;var Me=bt(bt({},Ae),{user:Ae.username,pwd:Ae.password,promise:{resolve:Xe,reject:X}});Kt.call(le,"signup",Me,{rpt:et})}else Me=bt(bt({},Ae),{promise:{resolve:Xe,reject:X}}),er.call(le,Me,{rpt:et})})},ae.prototype.open=function(Ae){var le=this;if(C.kg.debug("open",Ae.user),C.kg.debug("isLogout",this.logOut),Lt.platform==="web"){var Xe=S.P6.detectBrowser();C.kg.debug("browser",Xe)}return new Promise(function(X,et){var Me,He=Wt.call(le,Ae);if(He)return(Me=le.onError)===null||Me===void 0||Me.call(le,He),et(He);Ae.accessToken&&(le.token=Ae.accessToken);var Qe=bt(bt({},Ae),{promise:{resolve:X,reject:et}}),ht=le.dataReport.geOperateFun({uid:Ae.user,operationName:F.fI.LOGIN});if(le.isHttpDNS)le.dnsIndex=0,Kt.call(le,"login",Qe,{rpt:ht});else{if(Lt.platform!=="web"&&le.enableReportLogs)return le.dnsIndex=0,void le.getDNS().then(function(){yt.call(le,Qe,{rpt:ht})}).catch(function(rt){var Ct;Qe.promise.reject(rt),(Ct=Qe.error)===null||Ct===void 0||Ct.call(Qe,rt)});yt.call(le,Qe,{rpt:ht})}})},ae.prototype.getDNS=function(){var Ae=this,le=this.dnsIndex<this.dnsTotal?this.dnsIndex:0,Xe=this.dnsArr[le]+"/easemob/server.json";return new Promise(function(X,et){var Me=Ae;(function He(){var Qe={url:Xe,dataType:"json",type:"GET",data:{app_key:Me.appKey},success:function(ht){var rt=ht.enableReportLogs,Ct=ht.reportInterval;Me._reportLogs=rt==="true",Me._reportInterval=Number(Ct||3e5),X(ht)},error:function(ht){if(C.kg.debug("getHttpDNS fail: "+Me.dnsIndex),Me.dnsIndex++,Me.dnsIndex<Me.dnsTotal)He();else{var rt=v.Z.create({type:E.E.SERVER_GET_DNSLIST_FAILED,message:"get DNS failed",data:ht});et(rt)}}};S.P6.ajax(Qe).catch(function(ht){console.warn(ht)})})()})},ae.prototype.isOpened=function(){return this.sock&&this.sock.readyState===ir.OPEN||!1},ae.prototype.close=function(){var Ae,le,Xe;C.kg.debug("call close"),C.kg._stopReportLogs(),this.logOut=!0,this.disconnectedReason=void 0,this.reconnecting=!1,this.context.status=E.E.STATUS_CLOSING,this.sock&&this.sock.close(),(Ae=this.unMSyncSendMsgMap)===null||Ae===void 0||Ae.clear(),this.stopHeartBeat(),this.rejectMessage(),this.context.status=E.E.STATUS_CLOSED,this._load_msg_cache=[],this._queues=[],this.unSyncQueue=[],this._msgHash={},this.mr_cache={},this.token="",this.context.accessToken="",this.isRegisterPush=!1,this.clearTokenTimeout(),(Xe=(le=this==null?void 0:this._localCache)===null||le===void 0?void 0:le.getInstance())===null||Xe===void 0||Xe.close()},ae.prototype.downloadAndParseCombineMessage=function(Ae){var le=this,Xe=Ae.url,X=Ae.secret;return new Promise(function(et,Me){var He,Qe,ht=S.P6.getEnvInfo(),rt=ht.platform!=="web"&&ht.platform!=="node"&&ht.platform!=="quick_app"&&((Qe=(He=ht.global)===null||He===void 0?void 0:He.canIUse)===null||Qe===void 0?void 0:Qe.call(He,"getFileSystemManager")),Ct=function(Nt){var yr=function(Ee){Me({type:E.E.PARSE_FILE_ERROR,message:"Read file failed",data:Ee})},w=function(Ee){return Ge=le,he=void 0,ye=function(){var lt,Ze,Dt,Q,Te,pe,Ue,xe,Fe,Je,ct,kt,mt;return jt(this,function(Jt){switch(Jt.label){case 0:for(lt=rt?new Uint8Array(Ee.data):new Uint8Array(Ee.target.result),Ze=0,Dt=0,Q=2,Te=lt.subarray(Ze,Ze+Q),pe=S.P6.Uint8ArrayToString(Te),C.kg.debug("file header:",pe),Dt+=Q,Ue=0,xe=2;xe<lt.length-1;xe++)xe%2==1&&(Ue^=lt[xe]);if(Fe=lt.subarray(lt.length-1,lt.length),C.kg.debug("checkResult:",Ue,Fe[0]===Ue),Fe[0]!==Ue)return[2,Me({type:E.E.PARSE_FILE_ERROR,message:"File verification failed"})];if(pe!=="cm")return[3,7];Jt.label=1;case 1:Jt.trys.push([1,5,,6]),Je=[],ct=function(){var Rr,Or,It,Sr;return jt(this,function(Yr){switch(Yr.label){case 0:return Ze+=Q,Dt+=Q=4,Rr=lt.subarray(Ze,Ze+Q),Ze+=Q,Q=Rr.reduce(function(xr,Tn,Cn){return xr+(Tn<<8*(Rr.length-Cn-1))},0),Dt+=Q,Or=lt.subarray(Ze,Ze+Q),It=(It=kt.root.lookup("easemob.pb.Meta")).decode(Or),[4,Tt.Z.call(kt,It,0,!0,!0)];case 1:return Sr=Yr.sent(),Je.push(Sr),[2]}})},kt=this,Jt.label=2;case 2:return Dt<lt.length-1?[5,ct()]:[3,4];case 3:return Jt.sent(),[3,2];case 4:return[2,et(Je)];case 5:return mt=Jt.sent(),Me({type:E.E.PARSE_FILE_ERROR,message:"Parse file failed",data:mt}),[3,6];case 6:return[3,8];case 7:return[2,Me({type:E.E.PARSE_FILE_ERROR,message:"File verification failed"})];case 8:return[2]}})},new(($e=void 0)||($e=Promise))(function(lt,Ze){function Dt(pe){try{Te(ye.next(pe))}catch(Ue){Ze(Ue)}}function Q(pe){try{Te(ye.throw(pe))}catch(Ue){Ze(Ue)}}function Te(pe){var Ue;pe.done?lt(pe.value):(Ue=pe.value,Ue instanceof $e?Ue:new $e(function(xe){xe(Ue)})).then(Dt,Q)}Te((ye=ye.apply(Ge,he||[])).next())});var Ge,he,$e,ye};if(rt){var te=ht.global.getFileSystemManager(),Re=Nt.tempFilePath;te.readFile({filePath:Re,success:w,fail:yr})}else if(Nt instanceof Blob){var re=new FileReader;re.readAsArrayBuffer(Nt),re.onerror=yr,re.onload=w}},xt=function(Nt){Me({type:E.E.WEBIM_DOWNLOADFILE_ERROR,message:"Download failed, please try again",data:Nt})};rt?ht.global.downloadFile({url:Xe,success:Ct,fail:xt}):S.P6.download.call(le,{url:Xe,headers:{Accept:"application/json"},onFileDownloadComplete:Ct,onFileDownloadError:xt,secret:X,accessToken:le.context.accessToken})})},ae.prototype.stopHeartBeat=function(){clearInterval(this.heartBeatID)},ae.prototype.clear=function(){this.restTotal=0,this.restIndex=0,this.hostIndex=0,this.hostTotal=0},ae.prototype.heartBeat=function(){},ae.prototype.renewToken=function(Ae){var le=this;return this.isOpened()?this.getTokenExpireTimestamp(Ae).then(function(Xe){var X=Xe.expire_timestamp,et=Date.now();return le.expirationTime=X,le.expiresIn=X-et,le.token=Ae,le.context.accessToken=Ae,le.clearTokenTimeout(),le.tokenExpireTimeCountDown(le.expiresIn),{status:!0,token:Ae,expire:X}}):Promise.reject({status:!1})},ae.prototype.clearTokenTimeout=function(){C.kg.info("clearTokenTimeout"),this.tokenWillExpireTimer&&clearTimeout(this.tokenWillExpireTimer),this.tokenExpiredTimer&&clearTimeout(this.tokenExpiredTimer),this.tokenWillExpireTimer=null,this.tokenExpiredTimer=null},ae.prototype.tokenExpireTimeCountDown=function(Ae){var le=this;C.kg.info("tokenExpireTimeCountDown",Ae),Ae>Math.pow(2,31)-1&&(Ae=Math.pow(2,31)-1),this.tokenWillExpireTimer=setTimeout(function(){var Xe;le.onTokenWillExpire&&le.onTokenWillExpire(),(Xe=le.eventHandler)===null||Xe===void 0||Xe.dispatch("onTokenWillExpire"),C.kg.info("onTokenWillExpire",Math.floor(Ae/2))},Ae/2),this.tokenExpiredTimer=setTimeout(function(){var Xe;C.kg.info("onTokenExpired",0),le.onTokenExpired&&le.onTokenExpired(),(Xe=le.eventHandler)===null||Xe===void 0||Xe.dispatch("onTokenExpired"),le.close()},Ae)},ae.prototype.compareTokenExpireTime=function(Ae,le){var Xe,X=Number(le)-Number(Ae);C.kg.debug("compareTokenExpireTime",X),X<=this.expiresIn/2&&X>0?(this.onTokenWillExpire&&this.onTokenWillExpire(),(Xe=this.eventHandler)===null||Xe===void 0||Xe.dispatch("onTokenWillExpire"),C.kg.info("onTokenWillExpire",X)):X<=0&&(this.closeByTokenExpired(),C.kg.info("closeByTokenExpired",X))},ae.prototype.closeByTokenExpired=function(){var Ae;C.kg.info("closed By TokenExpired"),this.onTokenExpired&&this.onTokenExpired(),(Ae=this.eventHandler)===null||Ae===void 0||Ae.dispatch("onTokenExpired"),this.close()},ae.prototype.rejectMessage=function(){var Ae=this,le=Object.keys(this._msgHash);if(le.length>0){var Xe=v.Z.create({type:E.E.MESSAGE_WEBSOCKET_DISCONNECTED,message:"websocket disconnected"});le.forEach(function(X){var et,Me,He;!((et=Ae.unMSyncSendMsgMap)===null||et===void 0)&&et.has(X)||(Ae._msgHash[X].reject instanceof Function&&Ae._msgHash[X].reject(Xe),(He=(Me=Ae._localCache)===null||Me===void 0?void 0:Me.getInstance())===null||He===void 0||He.updateLocalMessage(X,{serverMsgId:X,status:Ye.r.FAIL}),Ae._msgHash[X].fail instanceof Function&&Ae._msgHash[X].fail(Xe),delete Ae._msgHash[X])})}},ae.prototype.resetConnState=function(){this.mSync.stopHeartBeat(),this.times=1,this.autoReconnectNumTotal=0,this.hostIndex=0},ae.prototype.reconnect=function(){var Ae,le=this;C.kg.debug("socket reconnect readyState",this.sock.readyState),this.sock.readyState!==ir.CONNECTING&&this.sock.readyState!==ir.OPEN&&(C.kg.info("reconnect: time",this.times),C.kg.info("reconnect sock.readyState: ",this.sock.readyState),this.reconnecting===!1&&(this.reconnecting=!0),(Ae=this.eventHandler)===null||Ae===void 0||Ae.dispatch("onReconnecting"),this.rejectMessage(),this.isHttpDNS&&(this.hostIndex<this.socketHost.length-1?this.hostIndex++:this.hostIndex=this.socketHost.length-1),setTimeout(function(){le.sock.readyState!==ir.OPEN&&(C.kg.info("login sock.readyState: ",le.sock.readyState),le.sock.close(),St.call(le,{access_token:le.context.accessToken}),le.times++)},500*this.times),this.autoReconnectNumTotal++)},ae.prototype.send=function(Ae){return Promise.resolve(null)},ae.prototype.setLoginInfoCustomExt=function(Ae){if(C.kg.debug("setLoginInfoCustomExt","params:",Ae),Ae){if(typeof Ae!="string")throw new Error("ext must be a string");if(Ae.length>1024)throw new Error("ext length must be less than 1024")}this.loginInfoCustomExt=Ae},ae._getSock=function(){},ae}();function er(ae,Ae){var le=this,Xe=Ae.rpt,X=Ae.isRetry,et=ae.promise,Me=this.apiUrl+"/"+this.orgName+"/"+this.appName+"/users",He={requestName:F.c.RESISTER,requestUrl:Me},Qe=ae.error||pr;if(!this.orgName&&!this.appName){var ht=v.Z.create({type:E.E.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR,message:"signup error"});Qe(ht)}var rt={headers:{"Content-type":"application/json"},url:Me,dataType:"json",data:JSON.stringify({username:ae.username,password:ae.password,nickname:ae.nickname||""}),success:function(Ct){ae.success&&ae.success(Ct);var xt=bt(bt({},Ct),{type:E.E.REQUEST_SUCCESS});et.resolve&&et.resolve(xt);var Nt=Ct.extraInfo,yr=Nt.httpCode,w=Nt.elapse;Xe({isEndApi:!0,isRetry:X,data:bt(bt({},{requestElapse:w,isSuccess:1,code:yr}),He)})},error:function(Ct){var xt=Ct.extraInfo,Nt=xt.elapse,yr=xt.httpCode,w=xt.errDesc;return Xe({isRetry:X,data:bt(bt({},{requestElapse:Nt,isSuccess:0,code:yr,codeDesc:w}),He)}),le.isHttpDNS&&le.restIndex+1<le.restTotal?(le.restIndex++,At.call(le),er.call(le,ae,{rpt:Xe,isRetry:X}),Promise.reject(Ct)):(Xe({data:{isLastApi:1,isSuccess:0}}),le.clear(),et.reject&&et.reject(Ct),Qe(Ct))}};return S.P6.ajax(rt).catch(function(Ct){et.reject&&et.reject(Ct)})}function yt(ae,Ae){var le,Xe=this;if(!Wt.call(this,ae))if(C.kg.debug("socket readyState",(le=this.sock)===null||le===void 0?void 0:le.readyState),this.isOpened())C.kg.debug("socket is already opened");else{var X=Ae.rpt,et=Ae.isRetry;Zt.call(this,ae),this.user=ae.user;var Me=ae.promise,He=this.context.appName,Qe=this.context.orgName,ht=this.apiUrl+"/"+Qe+"/"+He+"/token";if(ae.accessToken)C.kg.debug("login with accessToken"),this.grantType="accessToken",this.token=ae.accessToken,this.context.accessToken=ae.accessToken,this.context.restTokenData=ae.accessToken,Me.resolve({accessToken:ae.accessToken}),St.call(this,ae,X),C.kg.initReport({report:this._reportLogs,reportInterval:this._reportInterval,connection:this});else if(ae.agoraToken)C.kg.debug("login with agoraToken"),this.grantType="agoraToken",this.token=ae.agoraToken,this.context.accessToken=ae.agoraToken,this.context.restTokenData=ae.agoraToken,Me.resolve({accessToken:ae.agoraToken}),St.call(this,ae,X),C.kg.initReport({report:this._reportLogs,reportInterval:this._reportInterval,connection:this});else{C.kg.debug("login with password"),this.grantType="password";var rt={grant_type:"password",username:ae.user,password:ae.pwd,timestamp:+new Date},Ct=JSON.stringify(rt),xt={headers:{"Content-type":"application/json"},url:ht,dataType:"json",data:Ct,success:function(Nt){C.kg.debug("get token success"),typeof ae.success=="function"&&ae.success(Nt),Xe.token=Nt.access_token,Xe.context.restTokenData=Nt.access_token,Xe.context.accessToken=Nt.access_token,Xe.expiresIn=Nt.expires_in,Me.resolve({accessToken:Nt.access_token,duration:Nt.expires_in});var yr=Nt.extraInfo,w=yr.httpCode,te=yr.elapse,Re={requestName:F.c.LOGIN_BY_PWD,requestElapse:te,requestUrl:ht,isSuccess:1,code:w};X({isRetry:et,data:Re}),St.call(Xe,Nt,X),C.kg.initReport({report:Xe._reportLogs,reportInterval:Xe._reportInterval,connection:Xe})},error:function(Nt){var yr,w=Nt.extraInfo,te=w.elapse,Re=w.httpCode,re=w.errDesc,Ee={requestName:F.c.LOGIN_BY_PWD,requestElapse:te,requestUrl:ht,isSuccess:0,code:Re,codeDesc:re};if(X({isRetry:et,data:Ee}),Xe.isHttpDNS&&Xe.restIndex+1<Xe.restTotal)return Xe.restIndex++,At.call(Xe),void yt.call(Xe,ae,{rpt:X,isRetry:!0});X({data:{isLastApi:1,isSuccess:0}}),Xe.clear(),Nt.error&&Nt.error_description?(yr=v.Z.create({type:E.E.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,message:Nt.error_description,data:Nt}),Xe.onError&&Xe.onError(yr)):(yr=v.Z.create({type:E.E.WEBIM_CONNCTION_OPEN_ERROR,message:Nt.error_description,data:Nt}),Xe.onError&&Xe.onError(yr)),typeof ae.error=="function"&&ae.error(yr),Me.reject(yr)},version:this.version};C.kg.debug("start get token"),S.P6.ajax(xt).catch(function(Nt){console.warn(Nt)})}C.kg.debug("grantType",this.grantType),S.P6.listenNetwork(Xt.bind(this),Ir.bind(this)),S.P6.listenBrowserVisibility(function(){C.kg.debug("visibility true")},function(){C.kg.debug("visibility false")})}}function Xt(){var ae;C.kg.debug("online"),this.onOnline&&this.onOnline(),(ae=this.eventHandler)===null||ae===void 0||ae.dispatch("onOnline"),this.sock&&this.sock.readyState!==1&&(C.kg.debug("sock.readyState:",this.sock.readyState),this.logOut||this.reconnecting||this.reconnect())}function Ir(){var ae,Ae;C.kg.debug("offline"),(ae=this.sock)===null||ae===void 0||ae.close(),this.onOffline&&this.onOffline(),(Ae=this.eventHandler)===null||Ae===void 0||Ae.dispatch("onOffline")}function St(ae,Ae){var le=this,Xe=this._getSock();this.sock=Xe,C.kg.debug("start connect ws");var X=function(){var He;C.kg.debug("websocket onOpen"),Ae&&Ae({data:{isLastApi:1,isSuccess:1,accessChannel:(He=le.socketHost[le.hostIndex])===null||He===void 0?void 0:He.channel}});var Qe=S.P6.flow([le.mSync.generateProvision,le.mSync.base64transform])();try{Xe.send(Qe)}catch(rt){var ht=v.Z.create({type:E.E.SDK_RUNTIME_ERROR,message:"send message error",data:rt});le.onError&&le.onError(ht)}},et=function(He){setTimeout(function(){var Qe,ht,rt,Ct,xt,Nt,yr;if(C.kg.debug("websocket onClose",He),Lt.platform!=="zfb"&&Lt.platform!=="dd"||(le.sock.readyState=ir.CLOSED),le.logOut)le.clear(),le.resetConnState(),(ht=(Qe=le?._localCache)===null||Qe===void 0?void 0:Qe.getInstance())===null||ht===void 0||ht.close(),le.onClosed&&le.onClosed(),(rt=le.eventHandler)===null||rt===void 0||rt.dispatch("onDisconnected",le.disconnectedReason);else if(le.autoReconnectNumTotal<le.autoReconnectNumMax){le.reconnect();var w={type:E.E.WEBIM_CONNCTION_DISCONNECTED,message:"websocket has been disconnected"};le.onError&&le.onError(w),le.autoReconnectNumTotal%le.refreshDNSIntervals==0&&Lt.platform==="web"&&le.isHttpDNS&&(C.kg.debug("refresh dns config when websocket close"),Kt.call(le,"refresh",{},{}))}else(Ct=le.unMSyncSendMsgMap)===null||Ct===void 0||Ct.clear(),le.rejectMessage(),w={type:E.E.WEBIM_CONNCTION_DISCONNECTED,message:"websocket has been disconnected"},le.disconnectedReason=v.Z.create({type:E.E.WEBIM_CONNCTION_DISCONNECTED,message:"reconnection failed"}),le.onError&&le.onError(w),(Nt=(xt=le?._localCache)===null||xt===void 0?void 0:xt.getInstance())===null||Nt===void 0||Nt.close(),le.onClosed&&le.onClosed(),(yr=le.eventHandler)===null||yr===void 0||yr.dispatch("onDisconnected",le.disconnectedReason),le.resetConnState(),le.reconnecting=!1,C.kg.debug("reconnect fail")},0)},Me=function(He){var Qe=le.mSync,ht=Qe.decodeMSync,rt=Qe.distributeMSync;S.P6.flow([ht,rt])(He)};Lt.platform==="web"?(Xe.onopen=X,Xe.onclose=et,Xe.onmessage=Me):(Xe.onOpen(X),Xe.onMessage(Me),Xe.onClose(et),typeof window<"u"&&window.WebSocket||Xe.onError(function(He){var Qe,ht,rt,Ct,xt;if(C.kg.debug("mini program sock on error",He),le.sock.readyState!==ir.CLOSED&&(le.sock=bt(bt({},le.sock),{close:le.sock.close,send:le.sock.send,readyState:ir.CLOSED})),le.onError&&le.onError({type:E.E.WEBIM_CONNECTION_ERROR,message:"on socket error",data:He}),!le.logOut)if(le.autoReconnectNumTotal<le.autoReconnectNumMax)C.kg.debug("sock.onError reconnect",le.autoReconnectNumTotal,le.autoReconnectNumMax),le.reconnect(),le.autoReconnectNumTotal%le.refreshDNSIntervals==0&&Lt.platform==="web"&&le.isHttpDNS&&(C.kg.debug("refresh dns config when websocket error"),Kt.call(le,"refresh",{},{}));else{var Nt={type:E.E.WEBIM_CONNCTION_DISCONNECTED,message:"websocket has been disconnected"};le.disconnectedReason=v.Z.create({type:E.E.WEBIM_CONNCTION_DISCONNECTED,message:"reconnection failed"}),(Qe=le.unMSyncSendMsgMap)===null||Qe===void 0||Qe.clear(),le.rejectMessage(),le.onError&&le.onError(Nt),(rt=(ht=le?._localCache)===null||ht===void 0?void 0:ht.getInstance())===null||rt===void 0||rt.close(),le.onClosed&&le.onClosed(),(Ct=le.eventHandler)===null||Ct===void 0||Ct.dispatch("onDisconnected",le.disconnectedReason),le.resetConnState(),le.reconnecting=!1,C.kg.debug("reconnect fail")}Ae&&Ae({data:{isLastApi:1,isSuccess:0,accessChannel:(xt=le.socketHost[le.hostIndex])===null||xt===void 0?void 0:xt.channel}})}))}function Wt(ae){if(Pt(ae)!=="object"||ae===null)return v.Z.create({type:E.E.WEBIM_CONNCTION_OPEN_ERROR,message:"the param is illegal"});if(!ae.user||typeof ae.user!="string"){var Ae=v.Z.create({type:E.E.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR,message:"the user is empty or type is not string"});return C.kg.debug("open params error",Ae),Ae}return!("agoraToken"in ae)||ae.agoraToken&&typeof ae.agoraToken=="string"?!("accessToken"in ae)||ae.accessToken&&typeof ae.accessToken=="string"?"accessToken"in ae||"agoraToken"in ae||ae.pwd?void 0:(Ae=v.Z.create({type:E.E.WEBIM_CONNCTION_OPEN_ERROR,message:"the accessToken or pwd is illegal"}),C.kg.debug("open params error",Ae),Ae):(Ae=v.Z.create({type:E.E.WEBIM_CONNCTION_OPEN_ERROR,message:"the accessToken is illegal"}),C.kg.debug("open params error",Ae),Ae):(Ae=v.Z.create({type:E.E.WEBIM_CONNCTION_OPEN_ERROR,message:"the agoraToken is illegal"}),C.kg.debug("open params error",Ae),console.warn("agoraToken is deprecated, please use accessToken instead"),Ae)}function Zt(ae){this.context.jid={appKey:this.appKey,name:ae.user,domain:this.domain,clientResource:this.clientResource},this.context.root=this.root,this.context.userId=ae.user,this.context.appKey=this.appKey,this.context.appName=this.appName,this.context.orgName=this.orgName}function Kt(ae,Ae,le){var Xe=this,X=le.rpt,et=le.isRetry,Me=this.dnsIndex<this.dnsTotal?this.dnsIndex:0,He=this.dnsArr[Me]+"/easemob/server.json";C.kg.debug("call getHttpDNS: "+this.dnsIndex);var Qe={url:He,dataType:"json",type:"GET",data:{app_key:encodeURIComponent(this.appKey)},success:function(ht){C.kg.debug("getHttpDNS success");var rt=ht.extraInfo,Ct=rt.elapse,xt=rt.httpCode,Nt={requestUrl:He,requestName:F.c.GET_DNS,requestElapse:Ct,isSuccess:1,code:xt};Xe._reportLogs=ht.enableReportLogs==="true",Xe._reportInterval=Number(ht.reportInterval||3e5),ht?.enableDataReport==="true"?(Xe.dataReport.setIsCollectDt(!0),Xe.dataReport.setIsReportDt(!0)):(Xe.dataReport.setIsReportDt(!1),Xe.dataReport.setIsCollectDt(!1)),ht?.uploadinparts_enable==="false"&&(Xe.uploadPartEnable=!1),X&&X({isRetry:et,data:Nt});var yr=ht.rest.hosts,w=Xe.https?"https":"http";if(C.kg.info("httpType: "+w),!yr){var te=v.Z.create({type:E.E.SERVER_GET_DNSLIST_FAILED,message:"DNS hosts resolution failed",data:ht.rest});Ae.error&&Ae.error(te),Ae.promise.reject&&Ae.promise.reject(te)}for(var Re=yr.filter(function(ye){if(ye.protocol===w)return ye}),re=0;re<Re.length;re++)if(Re[re].protocol===w){var Ee=Re[re];Re.splice(re,1),Re.unshift(Ee)}Xe.restHosts=Re,Xe.restTotal=Re.length;var Ge=ht["msync-ws"].hosts;if(!Ge){var he=v.Z.create({type:E.E.SERVER_GET_DNSLIST_FAILED,message:"DNS msync-ws resolution failed",data:ht["msync-ws"]});Ae.error&&Ae.error(he),Ae.promise.reject&&Ae.promise.reject(he)}var $e=Ge.filter(function(ye){return ye.protocol===w&&ye});Xe.socketHost=$e,Xe.hostTotal=$e.length,At.call(Xe),ae!=="refresh"&&(ae==="login"?yt.call(Xe,Ae,{rpt:X}):er.call(Xe,Ae,{rpt:X}))},error:function(ht){var rt=ht.extraInfo,Ct=rt.elapse,xt=rt.httpCode,Nt=rt.errDesc,yr={requestUrl:He,requestName:F.c.GET_DNS,isSuccess:0,code:xt,codeDesc:Nt,requestElapse:Ct};if(X&&X({isRetry:et,data:yr}),C.kg.debug("getHttpDNS fail: "+Xe.dnsIndex),Xe.dnsIndex++,Xe.dnsIndex<Xe.dnsTotal)Kt.call(Xe,ae,Ae,{rpt:X,isRetry:!0});else if(ae==="login"||ae==="signup"){var w=v.Z.create({type:E.E.SERVER_GET_DNSLIST_FAILED,message:"get DNS failed",data:ht});Ae.error&&Ae.error(w),Ae.promise.reject&&Ae.promise.reject(w)}}};return S.P6.ajax(Qe).catch(function(ht){console.warn(ht)})}function At(){var ae,Ae;if(this.restIndex>this.restTotal)return C.kg.debug("restIndex > restTotal"),"";var le="",Xe=this.restHosts[this.restIndex],X=Xe.domain,et=Xe.ip,Me=Xe.port,He=this.https?"https:":"http:";return et&&typeof window<"u"&&((ae=window?.location)===null||ae===void 0?void 0:ae.protocol)==="http:"?le=He+"//"+et+":"+Me:(le=He+"//"+X,Me&&Me!=="80"&&Me!=="443"&&(le+=":".concat(Me)),typeof window>"u"||window.location||(le="https://"+X),typeof window<"u"&&window.location&&((Ae=window.location)===null||Ae===void 0?void 0:Ae.protocol)==="file:"&&(le="https://"+X)),typeof window>"u"&&(le=He+"//"+X),this.apiUrl=le,le}var vt=fe(2449);p().util.Long=T(),p().configure();var zt=p().Root.fromJSON({nested:{easemob:{nested:{pb:{nested:{MessageBody:{fields:{type:{type:"Type",id:1},from:{type:"JID",id:2},to:{type:"JID",id:3},contents:{rule:"repeated",type:"Content",id:4},ext:{rule:"repeated",type:"KeyValue",id:5},ackMessageId:{type:"uint64",id:6},msgConfig:{type:"MessageConfig",id:7},ackContent:{type:"string",id:8},meta:{type:"string",id:9},editMessageId:{type:"uint64",id:11}},nested:{Content:{fields:{type:{type:"Type",id:1},text:{type:"string",id:2},latitude:{type:"double",id:3},longitude:{type:"double",id:4},address:{type:"string",id:5},displayName:{type:"string",id:6},remotePath:{type:"string",id:7},secretKey:{type:"string",id:8},fileLength:{type:"int32",id:9},action:{type:"string",id:10},params:{rule:"repeated",type:"KeyValue",id:11},duration:{type:"int32",id:12},size:{type:"Size",id:13},thumbnailRemotePath:{type:"string",id:14},thumbnailSecretKey:{type:"string",id:15},thumbnailDisplayName:{type:"string",id:16},thumbnailFileLength:{type:"int32",id:17},thumbnailSize:{type:"Size",id:18},customEvent:{type:"string",id:19},customExts:{rule:"repeated",type:"KeyValue",id:20},buildingName:{type:"string",id:21},subType:{type:"SubType",id:22},title:{type:"string",id:23},summary:{type:"string",id:24},combineLevel:{type:"int32",id:25}},nested:{Type:{values:{TEXT:0,IMAGE:1,VIDEO:2,LOCATION:3,VOICE:4,FILE:5,COMMAND:6,CUSTOM:7,COMBINE:8}},Size:{fields:{width:{type:"double",id:1},height:{type:"double",id:2}}},SubType:{values:{COMBINE:0}}}},Type:{values:{NORMAL:0,CHAT:1,GROUPCHAT:2,CHATROOM:3,READ_ACK:4,DELIVER_ACK:5,RECALL:6,CHANNEL_ACK:7,EDIT:8}},MessageConfig:{fields:{allowGroupAck:{type:"bool",id:1}}}}},KeyValue:{oneofs:{value:{oneof:["varintValue","floatValue","doubleValue","stringValue"]}},fields:{key:{type:"string",id:1},type:{type:"ValueType",id:2},varintValue:{type:"int64",id:3},floatValue:{type:"float",id:4},doubleValue:{type:"double",id:5},stringValue:{type:"string",id:6}},nested:{ValueType:{values:{BOOL:1,INT:2,UINT:3,LLINT:4,FLOAT:5,DOUBLE:6,STRING:7,JSON_STRING:8}}}},JID:{fields:{appKey:{type:"string",id:1},name:{type:"string",id:2},domain:{type:"string",id:3},clientResource:{type:"string",id:4}}},ConferenceBody:{fields:{sessionId:{type:"string",id:1},operation:{type:"Operation",id:2},conferenceId:{type:"string",id:3},type:{type:"Type",id:4},content:{type:"string",id:5},network:{type:"string",id:6},version:{type:"string",id:7},identity:{type:"Identity",id:8},duration:{type:"string",id:9},peerName:{type:"string",id:10},endReason:{type:"EndReason",id:11},status:{type:"Status",id:12},isDirect:{type:"bool",id:13},controlType:{type:"StreamControlType",id:14},routeFlag:{type:"int32",id:15},routeKey:{type:"string",id:16}},nested:{Status:{fields:{errorCode:{type:"int32",id:1}}},Operation:{values:{JOIN:0,INITIATE:1,ACCEPT_INITIATE:2,ANSWER:3,TERMINATE:4,REMOVE:5,STREAM_CONTROL:6,MEDIA_REQUEST:7}},Type:{values:{VOICE:0,VIDEO:1}},Identity:{values:{CALLER:0,CALLEE:1}},EndReason:{values:{HANGUP:0,NORESPONSE:1,REJECT:2,BUSY:3,FAIL:4,UNSUPPORTED:5,OFFLINE:6}},StreamControlType:{values:{PAUSE_VOICE:0,RESUME_VOICE:1,PAUSE_VIDEO:2,RESUME_VIDEO:3}}}},MSync:{fields:{version:{type:"Version",id:1,options:{default:"MSYNC_V1"}},guid:{type:"JID",id:2},auth:{type:"string",id:3},compressAlgorimth:{type:"uint32",id:4},crypto:{type:"uint32",id:5},userAgent:{type:"string",id:6},pov:{type:"uint64",id:7},command:{type:"Command",id:8},deviceId:{type:"uint32",id:10},encryptType:{rule:"repeated",type:"EncryptType",id:11,options:{packed:!1}},encryptKey:{type:"string",id:12},payload:{type:"bytes",id:9}},nested:{Version:{values:{MSYNC_V1:0,MSYNC_V2:1}},Command:{values:{SYNC:0,UNREAD:1,NOTICE:2,PROVISION:3}}}},EncryptType:{values:{ENCRYPT_NONE:0,ENCRYPT_AES_128_CBC:1,ENCRYPT_AES_256_CBC:2}},CommSyncUL:{fields:{meta:{type:"Meta",id:1},key:{type:"uint64",id:2},queue:{type:"JID",id:3},isRoam:{type:"bool",id:4},lastFullRoamKey:{type:"uint64",id:5}}},CommSyncDL:{fields:{status:{type:"Status",id:1},metaId:{type:"uint64",id:2},serverId:{type:"uint64",id:3},metas:{rule:"repeated",type:"Meta",id:4},nextKey:{type:"uint64",id:5},queue:{type:"JID",id:6},isLast:{type:"bool",id:7},timestamp:{type:"uint64",id:8},isRoam:{type:"bool",id:9}}},CommNotice:{fields:{queue:{type:"JID",id:1}}},CommUnreadUL:{fields:{}},CommUnreadDL:{fields:{status:{type:"Status",id:1},unread:{rule:"repeated",type:"MetaQueue",id:2},timestamp:{type:"uint64",id:3}}},MetaQueue:{fields:{queue:{type:"JID",id:1},n:{type:"uint32",id:2}}},Meta:{fields:{id:{type:"uint64",id:1},from:{type:"JID",id:2},to:{type:"JID",id:3},timestamp:{type:"uint64",id:4},ns:{type:"NameSpace",id:5},payload:{type:"bytes",id:6},routetype:{type:"RouteType",id:7},ext:{rule:"repeated",type:"KeyValue",id:8},meta:{type:"bytes",id:9},directedUsers:{rule:"repeated",type:"string",id:10}},nested:{NameSpace:{values:{STATISTIC:0,CHAT:1,MUC:2,ROSTER:3,CONFERENCE:4,NOTIFY:5,QUERY:6}},RouteType:{values:{ROUTE_ALL:0,ROUTE_ONLINE:1,ROUTE_DIRECT:2}}}},Status:{fields:{errorCode:{type:"ErrorCode",id:1},reason:{type:"string",id:2},redirectInfo:{rule:"repeated",type:"RedirectInfo",id:3}},nested:{ErrorCode:{values:{OK:0,FAIL:1,UNAUTHORIZED:2,MISSING_PARAMETER:3,WRONG_PARAMETER:4,REDIRECT:5,TOKEN_EXPIRED:6,PERMISSION_DENIED:7,NO_ROUTE:8,UNKNOWN_COMMAND:9,PB_PARSER_ERROR:10,BIND_ANOTHER_DEVICE:11,IM_FORBIDDEN:12,TOO_MANY_DEVICES:13,PLATFORM_LIMIT:14,USER_MUTED:15,ENCRYPT_DISABLE:16,ENCRYPT_ENABLE:17,DECRYPT_FAILURE:18,PERMISSION_DENIED_EXTERNAL:19}}}},RedirectInfo:{fields:{host:{type:"string",id:1},port:{type:"uint32",id:2}}},Provision:{fields:{osType:{type:"OsType",id:1},version:{type:"string",id:2},networkType:{type:"NetworkType",id:3},appSign:{type:"string",id:4},compressType:{rule:"repeated",type:"CompressType",id:5,options:{packed:!1}},encryptType:{rule:"repeated",type:"EncryptType",id:6,options:{packed:!1}},encryptKey:{type:"string",id:7},status:{type:"Status",id:8},deviceUuid:{type:"string",id:9},isManualLogin:{type:"bool",id:10},password:{type:"string",id:11},deviceName:{type:"string",id:12},resource:{type:"string",id:13},auth:{type:"string",id:14},serviceId:{type:"string",id:16},actionVersion:{type:"string",id:17},authToken:{type:"string",id:18},sessionId:{type:"string",id:20},reason:{type:"string",id:21}},nested:{OsType:{values:{OS_IOS:0,OS_ANDROID:1,OS_LINUX:2,OS_OSX:3,OS_WIN:4,OS_OTHER:16}},NetworkType:{values:{NETWORK_NONE:0,NETWORK_WIFI:1,NETWORK_4G:2,NETWORK_3G:3,NETWORK_2G:4,NETWORK_WIRE:5}},CompressType:{values:{COMPRESS_NONE:0,COMPRESS_ZLIB:1}}}},MUCBody:{fields:{mucId:{type:"JID",id:1},operation:{type:"Operation",id:2},from:{type:"JID",id:3},to:{rule:"repeated",type:"JID",id:4},setting:{type:"Setting",id:5},reason:{type:"string",id:6},isChatroom:{type:"bool",id:7},status:{type:"Status",id:8},isThread:{type:"bool",id:9},mucParentId:{type:"JID",id:10},mucName:{type:"string",id:11},eventInfo:{type:"EventInfo",id:12},mucMemberCount:{type:"int32",id:13},ext:{type:"string",id:14},leaveOtherRooms:{type:"bool",id:15}},nested:{Operation:{values:{CREATE:0,DESTROY:1,JOIN:2,LEAVE:3,APPLY:4,APPLY_ACCEPT:5,APPLY_DECLINE:6,INVITE:7,INVITE_ACCEPT:8,INVITE_DECLINE:9,KICK:10,GET_BLACKLIST:11,BAN:12,ALLOW:13,UPDATE:14,BLOCK:15,UNBLOCK:16,PRESENCE:17,ABSENCE:18,DIRECT_JOINED:19,ASSIGN_OWNER:20,ADD_ADMIN:21,REMOVE_ADMIN:22,ADD_MUTE:23,REMOVE_MUTE:24,UPDATE_ANNOUNCEMENT:25,DELETE_ANNOUNCEMENT:26,UPLOAD_FILE:27,DELETE_FILE:28,ADD_USER_WHITE_LIST:29,REMOVE_USER_WHITE_LIST:30,BAN_GROUP:31,REMOVE_BAN_GROUP:32,THREAD_CREATE:33,THREAD_DESTROY:34,THREAD_JOIN:35,THREAD_LEAVE:36,THREAD_KICK:37,THREAD_UPDATE:38,THREAD_PRESENCE:39,THREAD_ABSENCE:40,DISABLE_GROUP:41,ABLE_GROUP:42,SET_METADATA:43,DELETE_METADATA:44,GROUP_MEMBER_METADATA_UPDATE:45}},Setting:{fields:{name:{type:"string",id:1},desc:{type:"string",id:2},type:{type:"Type",id:3},maxUsers:{type:"int32",id:4},owner:{type:"string",id:5}},nested:{Type:{values:{PRIVATE_OWNER_INVITE:0,PRIVATE_MEMBER_INVITE:1,PUBLIC_JOIN_APPROVAL:2,PUBLIC_JOIN_OPEN:3,PUBLIC_ANONYMOUS:4}}}},Status:{fields:{errorCode:{type:"ErrorCode",id:1},description:{type:"string",id:2}},nested:{ErrorCode:{values:{OK:0,PERMISSION_DENIED:1,WRONG_PARAMETER:2,MUC_NOT_EXIST:3,USER_NOT_EXIST:4,UNKNOWN:5}}}},EventInfo:{fields:{eventType:{type:"EventType",id:1,options:{default:"EVENT_NONE"}},ext:{type:"string",id:2}},nested:{EventType:{values:{EVENT_NONE:0,CIRCLE_CHANNEL:1}}}}}},RosterBody:{fields:{operation:{type:"Operation",id:1},status:{type:"Status",id:2},from:{type:"JID",id:3},to:{rule:"repeated",type:"JID",id:4},reason:{type:"string",id:5},rosterVer:{type:"string",id:6},biDirection:{type:"bool",id:7}},nested:{Operation:{values:{GET_ROSTER:0,GET_BLACKLIST:1,ADD:2,REMOVE:3,ACCEPT:4,DECLINE:5,BAN:6,ALLOW:7,REMOTE_ACCEPT:8,REMOTE_DECLINE:9}},Status:{fields:{errorCode:{type:"ErrorCode",id:1},description:{type:"string",id:2}},nested:{ErrorCode:{values:{OK:0,USER_NOT_EXIST:1,USER_ALREADY_FRIEND:2,USER_ALREADY_BLACKLIST:3}}}}}},StatisticsBody:{fields:{operation:{type:"Operation",id:1},os:{type:"OsType",id:2},version:{type:"string",id:3},network:{type:"NetworkType",id:4},imTime:{type:"uint32",id:5},chatTime:{type:"uint32",id:6},location:{type:"string",id:7},reason:{type:"string",id:10}},nested:{Operation:{values:{INFORMATION:0,USER_REMOVED:1,USER_LOGIN_ANOTHER_DEVICE:2,USER_KICKED_BY_CHANGE_PASSWORD:3,USER_KICKED_BY_OTHER_DEVICE:4}},OsType:{values:{OS_IOS:0,OS_ANDROID:1,OS_LINUX:2,OS_OSX:3,OS_WIN:4,OS_OTHER:16}},NetworkType:{values:{NETWORK_NONE:0,NETWORK_WIFI:1,NETWORK_4G:2,NETWORK_3G:3,NETWORK_2G:4,NETWORK_WIRE:5}}}}}}}}}});Ar.prototype.root=zt;var vr=C.kg.getLogger("defaultLogger");vr.setConfig({useCache:!1,maxCache:3145728,color:"",background:""}),vr.enableAll(),Ar.prototype._getSock=function(){if(this.isHttpDNS){var ae=this.socketHost[this.hostIndex];if(!ae)throw this.times=1,this.autoReconnectNumTotal=0,this.hostIndex=0,this.onClosed&&this.onClosed(),new Error("No connected domain name when get websocket.");var Ae=ae.domain,le=ae.ip,Xe="",X=ae.port;Xe=Ae||le,X&&X!=="80"&&X!=="443"&&(Xe+=":"+X),Xe&&(this.url="//"+Xe+"/ws");var et=this.https?"https:":"http:";this.url=et+this.url}return new(j())(this.url,null,{timeout:3e4})},Ar.prototype.getUniqueId=S.P6.getUniqueId;var or={connection:Ar,message:vt.Message,utils:S.P6,logger:vr,statusCode:E.E};typeof window<"u"&&(window.WebIM=or);var mr=or}(),We}()})}(lO)),lO.exports}var cW=sW();const h3=pO(cW),lW="a61.chat.agora.io",uW="611374477",dW="1580634",hW="007eJxTYLCu2bKr6afPBKv4uw8Pc6s/Od5TH/nT6L5ActzvydGzeAQVGEzNDY2SkszNLJMS00wsDE0szA0sjZOSkw1STIyMzcyNX7zpzPjxqzNDU2QWCyMDKwMjAxMDiM/AAAAAaSI1",pW=()=>{const[G,me]=ot.useState(!1),[be,de]=ot.useState(""),[fe,We]=ot.useState(!1);return{registerUser:ot.useCallback(async j=>{try{me(!0),de(""),We(!1);const c={username:j,password:j+"123"},p=`https://${lW}/${uW}/${dW}/users`,f=await fetch(p,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${hW}`},body:JSON.stringify([c])});if(!f.ok){const v=await f.json().catch(()=>({}));throw new Error(v.error||`HTTP error! status: ${f.status}`)}const T=await f.json();return console.log("User registration response:",T),We(!0),!0}catch(c){console.error("Error during registration:",c);const p=c instanceof Error?c.message:"Registration failed";throw de(p),We(!1),c}finally{me(!1)}},[]),isLoading:G,error:be,status:fe}},fW="a61.chat.agora.io",mW="611374477",EW="1580634",_W="007eJxTYLCu2bKr6afPBKv4uw8Pc6s/Od5TH/nT6L5ActzvydGzeAQVGEzNDY2SkszNLJMS00wsDE0szA0sjZOSkw1STIyMzcyNX7zpzPjxqzNDU2QWCyMDKwMjAxMDiM/AAAAAaSI1",gW=()=>{const[G,me]=ot.useState(!1),[be,de]=ot.useState(!1);return{getUserStatus:ot.useCallback(async We=>{try{me(!0),de(!1);const O=`https://${fW}/${mW}/${EW}/users/${We}/status`,c=(await fetch(O,{headers:{Authorization:`Bearer ${_W}`}})).status===200;return de(c),c}catch(O){throw console.error("Error during user status:",O),de(!1),O}finally{me(!1)}},[]),isLoading:G,userExists:be}},vW="http://localhost:3001/api";async function TW(G){try{const me=await fetch(`${vW}/generate-token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAccount:G})});if(!me.ok)throw new Error(`HTTP error! status: ${me.status}`);const be=await me.json();return be.success?be.token:(console.error("Token generation failed:",be.error),null)}catch(me){return console.error("Error generating token:",me),null}}const yW=()=>{const[G,me]=ot.useState(!1),[be]=ot.useState("5712bb769baf481487093bcc0d423673"),[de]=ot.useState("Test"),[fe]=ot.useState("007eJxTYGhcbf93/4qb8k4LIs2ZV7qXPpHhEdrQldn7frNe9vWzwpMUGEzNDY2SkszNLJMS00wsDE0szA0sjZOSkw1STIyMzcyNV7/tzGgIZGRoyCxiYIRCEJ+FISS1uISBAQA3JR8X"),[We,O]=ot.useState(!0),[j,c]=ot.useState(!0),[p,f]=ot.useState(!1),[T,v]=ot.useState(!1),S=ot.useRef(!1),[y,E]=ot.useState(null),[N,C]=ot.useState(null),[U,M]=ot.useState(!1),[x,P]=ot.useState(""),[z,Z]=ot.useState(""),[I,Y]=ot.useState(""),[F,oe]=ot.useState(!1),[W,ne]=ot.useState(!1),[ee,H]=ot.useState([]),[q,ve]=ot.useState(!1),[Le,Oe]=ot.useState(null),[ge,je]=ot.useState(!1),Ne=ot.useRef(null),Be="611374477#1580634",Ye=hh(),pt=ot.useCallback(async()=>{M(!0),E(null);try{const ae=await Z3({checkCamera:!0,checkMicrophone:!0});C(ae),(ae.cameraPermission==="denied"||!ae.hasCamera)&&c(!1),(ae.microphonePermission==="denied"||!ae.hasMicrophone)&&O(!1);const Ae=Q3(ae);Ae&&E(Ae)}catch(ae){console.error("Device permission check failed:",ae),E("Failed to check device permissions. Please refresh the page and try again.")}finally{M(!1)}},[]);ot.useEffect(()=>{pt()},[pt]),ot.useEffect(()=>{const ae=document.querySelector(".chat-messages");ae&&(ae.scrollTop=ae.scrollHeight)},[ee]);const dt=ot.useCallback(async()=>{try{Ne.current=await new h3.connection({appKey:Be}),Ne.current.addEventHandler("connection&message",{onConnected:()=>{oe(!0)},onDisconnected:()=>{oe(!1),ne(!1)},onTextMessage:ae=>{if(ae.chatType==="singleChat"){const Ae={id:ae.id||Date.now().toString(),from:ae.from||"Unknown",to:ae.to||x||"",message:ae.msg||"",timestamp:new Date,isOwn:!1};H(le=>[...le,Ae])}},onTokenWillExpire:()=>{Oe("Token is about to expire")},onTokenExpired:()=>{Oe("The token has expired")},onError:ae=>{Oe("Connection error occurred"),console.error("Agora connection error:",ae)}})}catch(ae){Oe("Failed to initialize connection"),console.error("Connection initialization error:",ae)}},[x]);ot.useEffect(()=>(dt(),()=>{Ne.current&&Ne.current.removeEventHandler("connection&message")}),[dt]);const{registerUser:Ie,status:we}=pW(),{getUserStatus:ft}=gW(),qe=ot.useCallback(async()=>{try{const ae=await TW(x);if(ae)return ae;throw new Error("Failed to generate token")}catch{throw new Error("Token generation failed")}},[x]),it=ot.useCallback(async()=>{try{return await Ie(x),we}catch{throw new Error("User registration failed")}},[x,Ie,we]),Tt=ot.useCallback(async()=>{if(!x.trim()){Oe("Please enter a valid user ID");return}ve(!0),Oe(null);try{if(await ft(x)){if(Ne.current){const Ae=await qe();await Ne.current.open({user:x,accessToken:Ae}),ne(!0)}}else if(await it()&&Ne.current){const le=await qe();await Ne.current.open({user:x,accessToken:le}),ne(!0)}else throw new Error("User registration failed")}catch(ae){const Ae=ae instanceof Error?ae.message:"Login failed";Oe(Ae)}finally{ve(!1)}},[x,ft,qe,it]),Pt=ot.useCallback(()=>{if(!I.trim()||!Ne.current)return;const ae={chatType:"singleChat",type:"txt",to:z,msg:I},Ae=h3.message.create(ae),le={id:Date.now().toString(),from:x,to:z,message:I,timestamp:new Date,isOwn:!0};H(Xe=>[...Xe,le]),Y(""),Ne.current.send(Ae).then(Xe=>{H(X=>X.map(et=>et.id===le.id?{...et,id:Xe.localMsgId}:et))}).catch(Xe=>{Oe("Failed to send message"),console.error("Send message error:",Xe),H(X=>X.filter(et=>et.id!==le.id))})},[I,z,x]),bt=ot.useCallback(()=>{Oe(null)},[]),{localMicrophoneTrack:jt,error:Lt}=IO(We&&N?.microphonePermission!=="denied"&&N?.hasMicrophone!==!1),{localCameraTrack:Gt,error:pr}=F3(j&&N?.cameraPermission!=="denied"&&N?.hasCamera!==!1),{screenTrack:ir}=H3(p,{},"disable"),Ar=AO();ot.useEffect(()=>{if(ir){const ae=()=>{console.log("Screen sharing track ended"),f(!1),S.current=!1};if(ir.getMediaStreamTrack){const Ae=ir.getMediaStreamTrack();Ae&&Ae.addEventListener("ended",ae)}return()=>{if(ir.getMediaStreamTrack){const Ae=ir.getMediaStreamTrack();Ae&&Ae.removeEventListener("ended",ae)}}}},[ir]),ot.useEffect(()=>{const ae=()=>{p&&document.visibilityState==="visible"&&(ir||(f(!1),S.current=!1))},Ae=()=>{p&&(f(!1),S.current=!1)};return document.addEventListener("visibilitychange",ae),window.addEventListener("beforeunload",Ae),()=>{document.removeEventListener("visibilitychange",ae),window.removeEventListener("beforeunload",Ae)}},[p,ir]),ot.useEffect(()=>{Lt&&(console.error("Microphone track error:",Lt),E("Failed to access microphone. Please check your device permissions."),O(!1))},[Lt]),ot.useEffect(()=>{pr&&(console.error("Camera track error:",pr),E("Failed to access camera. Please check your device permissions."),c(!1))},[pr]),RO({appid:be,channel:de,token:fe||null},G);const er=[jt,Gt].filter(Boolean);p&&ir&&er.push(ir),CO(er);const yt=ot.useCallback(()=>{N?.microphonePermission!=="denied"&&N?.hasMicrophone!==!1&&O(ae=>!ae)},[N]),Xt=ot.useCallback(()=>{N?.cameraPermission!=="denied"&&N?.hasCamera!==!1&&c(ae=>!ae)},[N]),Ir=()=>me(ae=>!ae),St=()=>me(!0),Wt=ot.useCallback(async()=>{try{navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&(await navigator.mediaDevices.getDisplayMedia({video:!0})).getTracks().forEach(Ae=>Ae.stop())}catch{console.log("Screen sharing force stop completed or no active streams")}},[]),Zt=ot.useCallback(async()=>{try{if(p){if(console.log("Stopping screen sharing from UI"),S.current=!1,ir)try{if(ir.getMediaStreamTrack){const ae=ir.getMediaStreamTrack();ae&&ae.stop()}ir.close&&ir.close()}catch(ae){console.warn("Error stopping screen track:",ae)}await Wt(),f(!1),v(!1)}else console.log("Starting screen sharing from UI"),v(!0),f(!0),S.current=!0,setTimeout(()=>{v(!1)},1e3)}catch(ae){console.error("Screen sharing toggle failed:",ae),f(!1),S.current=!1,v(!1)}},[p,ir,Wt]);return{calling:G,isConnected:Ye,micOn:We,cameraOn:j,screenSharing:p,isScreenSharingLoading:T,appId:be,channel:de,remoteUsers:Ar,deviceError:y,deviceInfo:N,isCheckingDevices:U,userId:x,receptor:z,singleMessage:I,isChatConnected:F,isChatLoggedIn:W,messages:ee,isChatLoading:q,chatError:Le,showChat:ge,localMicrophoneTrack:jt,localCameraTrack:Gt,screenTrack:ir,toggleMic:yt,toggleCamera:Xt,toggleScreenShare:Zt,toggleCall:Ir,joinChannel:St,clearDeviceError:()=>{E(null)},retryDeviceCheck:()=>{pt()},continueWithoutCamera:()=>{E(null),c(!1),N&&C({...N,hasCamera:!1,cameraPermission:"denied"})},simulateNoCamera:()=>{E("Camera not available. Video will be disabled."),c(!1),N&&C({...N,hasCamera:!1,cameraPermission:"denied"})},simulateNoMicrophone:()=>{E("Microphone not available. Audio will be disabled."),O(!1),N&&C({...N,hasMicrophone:!1,microphonePermission:"denied"})},simulateNoDevices:()=>{E("No camera or microphone found. Please check your device permissions and try again."),c(!1),O(!1),N&&C({...N,hasCamera:!1,hasMicrophone:!1,cameraPermission:"denied",microphonePermission:"denied"})},resetDevices:()=>{E(null),c(!0),O(!0),pt()},setUserId:P,setReceptor:Z,setSingleMessage:Y,handleChatLogin:Tt,handleSendMessage:Pt,clearChatError:bt,setShowChat:je}},SW=({appId:G,channel:me,onJoin:be,userId:de,receptor:fe,onUserIdChange:We,onReceptorChange:O,onChatLogin:j,isChatLoading:c})=>st.jsx("div",{className:"flex justify-center items-center min-h-[60vh]",children:st.jsxs("div",{className:"bg-white p-10 rounded-2xl shadow-lg w-full max-w-md",children:[st.jsx("h2",{className:"text-2xl font-semibold text-slate-800 mb-8 text-center",children:"Join Video Call"}),st.jsxs("div",{className:"mb-6",children:[st.jsx("h3",{className:"text-lg font-medium text-slate-700 mb-4",children:"Chat Setup"}),st.jsxs("div",{className:"space-y-4",children:[st.jsxs("div",{children:[st.jsx("label",{htmlFor:"userId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Your User ID"}),st.jsx("input",{id:"userId",type:"text",value:de,onChange:p=>We(p.target.value),placeholder:"Enter your user ID",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),st.jsxs("div",{children:[st.jsx("label",{htmlFor:"receptor",className:"block text-sm font-medium text-gray-700 mb-1",children:"Chat With (Receptor)"}),st.jsx("input",{id:"receptor",type:"text",value:fe,onChange:p=>O(p.target.value),placeholder:"Enter receptor name",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),st.jsx("button",{onClick:j,disabled:!de.trim()||c,className:`w-full py-2 px-4 text-sm font-medium rounded-md transition-all duration-200 ${!de.trim()||c?"bg-gray-400 text-white cursor-not-allowed opacity-60":"bg-green-500 text-white hover:bg-green-600"}`,children:c?"Connecting...":"📱 Setup Chat"})]})]}),st.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[st.jsx("h3",{className:"text-lg font-medium text-slate-700 mb-4",children:"Video Call"}),st.jsx("button",{className:`w-full py-4 px-6 text-lg font-medium rounded-lg transition-all duration-200 flex items-center justify-center gap-2 ${!G||!me?"bg-gray-400 text-white cursor-not-allowed opacity-60":"bg-blue-500 text-white hover:bg-blue-600"}`,disabled:!G||!me,onClick:()=>{be()},children:st.jsx("span",{children:"🚀 Join Video Call"})})]})]})}),RW=({micOn:G,calling:me,onToggleMic:be,onToggleCall:de})=>st.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4",children:st.jsxs("div",{className:"flex justify-center items-center gap-4 max-w-md mx-auto",children:[st.jsx("button",{className:`w-12 h-12 rounded-full transition-all duration-200 flex items-center justify-center ${G?"bg-gray-200 hover:bg-gray-300 text-gray-700":"bg-red-500 hover:bg-red-600 text-white"}`,onClick:be,title:G?"Mute microphone":"Unmute microphone",children:G?st.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z",clipRule:"evenodd"})}):st.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z",clipRule:"evenodd"})})}),st.jsx("button",{className:"w-14 h-14 rounded-full bg-red-500 hover:bg-red-600 text-white transition-all duration-200 flex items-center justify-center",onClick:de,title:me?"End call":"Start call",children:me?st.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})}):st.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{d:"M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"})})})]})}),CW=({remoteUsers:G,localUser:me})=>{const be=me?[me,...G]:G;return be.length===0?st.jsx("div",{className:"flex-1 flex items-center justify-center",children:st.jsxs("div",{className:"text-center",children:[st.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-full mx-auto mb-4 flex items-center justify-center",children:st.jsx("svg",{className:"w-12 h-12 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-6-3a2 2 0 11-4 0 2 2 0 014 0zm-2 4a5 5 0 00-4.546 2.916A5.986 5.986 0 0010 16a5.986 5.986 0 004.546-2.084A5 5 0 0010 11z",clipRule:"evenodd"})})}),st.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-2",children:"Waiting for participants..."}),st.jsx("p",{className:"text-gray-600",children:"Share the channel name with others to start the audio call"})]})}):st.jsxs("div",{className:"flex-1 flex items-center justify-center p-8",children:[st.jsx("div",{className:"hidden",children:G.map(de=>st.jsx(PO,{user:de},de.uid))}),st.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 max-w-4xl w-full",children:be.map((de,fe)=>{const We=de.hasAudio||de.audioTrack&&de.audioTrack.enabled,O=!de.uid||de.uid==="local";return st.jsxs("div",{className:"text-center",children:[st.jsxs("div",{className:"relative",children:[st.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full mx-auto mb-3 flex items-center justify-center text-white text-2xl font-bold",children:O?"ME":de.uid.toString().slice(-2).toUpperCase()}),st.jsx("div",{className:`absolute -bottom-1 -right-1 w-6 h-6 rounded-full flex items-center justify-center ${We?"bg-green-500":"bg-red-500"}`,children:We?st.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z",clipRule:"evenodd"})}):st.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z",clipRule:"evenodd"})})})]}),st.jsx("p",{className:"text-sm font-medium text-gray-700",children:O?"You":`User ${de.uid}`}),st.jsx("p",{className:"text-xs text-gray-500 mt-1",children:We?"Speaking":"Muted"})]},de.uid||`local-${fe}`)})})]})},$3=({error:G,isCheckingDevices:me,onClose:be,onRetry:de,onContinueWithoutCamera:fe,showContinueOption:We=!1})=>G?st.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:st.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 animate-in fade-in duration-200",children:[st.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[st.jsxs("div",{className:"flex items-center space-x-3",children:[st.jsx("div",{className:"w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center",children:st.jsx("svg",{className:"w-5 h-5 text-orange-600",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),st.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Device Error"})]}),st.jsx("button",{onClick:be,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close device error popup",children:st.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:st.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),st.jsxs("div",{className:"p-6",children:[st.jsx("p",{className:"text-gray-700 leading-relaxed mb-4",children:G}),st.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4",children:[st.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Troubleshooting Tips:"}),st.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[st.jsx("li",{children:"• Make sure your camera/microphone is connected and working"}),st.jsx("li",{children:"• Check browser permissions for camera and microphone access"}),st.jsx("li",{children:"• Try refreshing the page and allowing permissions when prompted"}),st.jsx("li",{children:"• Ensure you're using HTTPS or localhost (required for media access)"})]})]})]}),st.jsxs("div",{className:"flex justify-end space-x-3 p-6 border-t border-gray-200",children:[We&&fe&&st.jsx("button",{onClick:fe,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Continue Without Camera"}),st.jsx("button",{onClick:be,className:"px-4 py-2 text-gray-600 hover:text-gray-800 transition-colors",children:"Dismiss"}),st.jsx("button",{onClick:de,disabled:me,className:`px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center gap-2 ${me?"bg-gray-400 text-white cursor-not-allowed":"bg-blue-500 text-white hover:bg-blue-600"}`,children:me?st.jsxs(st.Fragment,{children:[st.jsx("span",{className:"animate-spin",children:"⏳"}),"Checking..."]}):st.jsxs(st.Fragment,{children:[st.jsx("span",{children:"🔄"}),"Retry"]})})]})]})}):null,p3=({remoteUsers:G})=>st.jsxs("div",{className:"bg-gray-800 rounded-lg relative overflow-hidden",children:[G.length>0?st.jsxs(st.Fragment,{children:[st.jsx(PO,{user:G[0],className:"w-full h-full object-cover"}),st.jsx("div",{className:"absolute bottom-2 left-2 text-white text-sm",children:G[0].uid})]}):st.jsx("div",{className:"w-full h-full flex items-center justify-center",children:st.jsxs("div",{className:"text-center",children:[st.jsx("div",{className:"w-32 h-32 bg-blue-500 rounded-full flex items-center justify-center mb-4",children:st.jsx("svg",{className:"w-16 h-16 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})}),st.jsx("div",{className:"text-white text-lg font-medium",children:"Waiting for participant..."}),st.jsx("div",{className:"text-gray-400 text-sm mt-2",children:"Share the channel name to invite someone"})]})}),st.jsx("div",{className:"absolute top-4 right-4",children:st.jsxs("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:[st.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z",clipRule:"evenodd"})}),st.jsx("div",{className:"absolute w-4 h-0.5 bg-white rotate-45"})]})})]}),f3=({localMicrophoneTrack:G,localCameraTrack:me,cameraOn:be,micOn:de})=>st.jsxs("div",{className:"bg-gray-800 rounded-lg relative overflow-hidden",children:[st.jsx(Y3,{audioTrack:G,cameraOn:be,micOn:de,playAudio:!1,videoTrack:me,className:"w-full h-full object-cover"}),st.jsx("div",{className:"absolute bottom-2 left-2 text-white text-sm",children:"You"}),st.jsx("div",{className:"absolute top-4 right-4",children:st.jsxs("div",{className:"w-6 h-6 bg-red-500 rounded-full flex items-center justify-center",children:[st.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z",clipRule:"evenodd"})}),st.jsx("div",{className:"absolute w-4 h-0.5 bg-white rotate-45"})]})})]}),IW=({messages:G,singleMessage:me,onMessageChange:be,onSendMessage:de,onClose:fe,isVisible:We})=>{const O=j=>{j.key==="Enter"&&!j.shiftKey&&(j.preventDefault(),de())};return We?st.jsxs("div",{className:"fixed right-0 top-0 h-full w-80 bg-white shadow-lg border-l border-gray-200 flex flex-col z-50",children:[st.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[st.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"In-call messages"}),st.jsx("button",{onClick:fe,className:"text-gray-500 hover:text-gray-700 transition-colors",children:st.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:st.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),st.jsx("div",{className:"flex-1 overflow-y-auto p-4 chat-messages",children:G.length===0?st.jsxs("div",{className:"text-center text-gray-500 mt-8",children:[st.jsx("p",{children:"No messages yet"}),st.jsx("p",{className:"text-sm",children:"Start a conversation!"})]}):st.jsx("div",{className:"space-y-3",children:G.map(j=>st.jsx("div",{className:`flex ${j.isOwn?"justify-end":"justify-start"}`,children:st.jsxs("div",{className:`max-w-xs px-3 py-2 rounded-lg ${j.isOwn?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"}`,children:[st.jsx("div",{className:"text-sm font-medium mb-1",children:j.isOwn?"You":j.from}),st.jsx("div",{className:"text-sm",children:j.message}),st.jsx("div",{className:`text-xs mt-1 ${j.isOwn?"text-blue-100":"text-gray-500"}`,children:j.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},j.id))})}),st.jsx("div",{className:"p-4 border-t border-gray-200",children:st.jsxs("div",{className:"flex items-center space-x-2",children:[st.jsx("input",{type:"text",value:me,onChange:j=>be(j.target.value),onKeyPress:O,placeholder:"Send a message",className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),st.jsx("button",{onClick:de,disabled:!me.trim(),className:`p-2 rounded-md transition-colors ${me.trim()?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:st.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:st.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]}):null},AW=({screenTrack:G})=>st.jsx("div",{className:"w-full h-full relative",children:G&&st.jsxs(st.Fragment,{children:[st.jsx(DO,{play:!0,style:{width:"100%",height:"100%",objectFit:"contain"},track:G}),st.jsx("div",{className:"absolute top-4 left-4 bg-black/70 text-white px-3 py-1 rounded-full text-sm font-medium",children:"🖥️ Screen Share"})]})}),bW=({error:G,onClose:me})=>G?st.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:st.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 animate-in fade-in duration-200",children:[st.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[st.jsxs("div",{className:"flex items-center space-x-3",children:[st.jsx("div",{className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:st.jsx("svg",{className:"w-5 h-5 text-red-600",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),st.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Error"})]}),st.jsx("button",{onClick:me,className:"text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Close error popup",children:st.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:st.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),st.jsx("div",{className:"p-6",children:st.jsx("p",{className:"text-gray-700 leading-relaxed",children:G})}),st.jsx("div",{className:"flex justify-end p-6 border-t border-gray-200",children:st.jsx("button",{onClick:me,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",children:"Close"})})]})}):null,OW=()=>{const G=LO.createClient({mode:"rtc",codec:"vp8"});return st.jsx(SO,{client:G,children:st.jsx(NW,{})})},NW=()=>{const{isConnected:G,micOn:me,cameraOn:be,screenSharing:de,isScreenSharingLoading:fe,appId:We,channel:O,remoteUsers:j,localMicrophoneTrack:c,localCameraTrack:p,screenTrack:f,deviceError:T,isCheckingDevices:v,toggleMic:S,toggleCamera:y,toggleScreenShare:E,toggleCall:N,joinChannel:C,clearDeviceError:U,retryDeviceCheck:M,continueWithoutCamera:x,userId:P,receptor:z,singleMessage:Z,isChatLoggedIn:I,messages:Y,isChatLoading:F,chatError:oe,showChat:W,setUserId:ne,setReceptor:ee,setSingleMessage:H,handleChatLogin:q,handleSendMessage:ve,clearChatError:Le,setShowChat:Oe}=yW();return st.jsxs("div",{className:"min-h-screen bg-gray-900 w-full relative",children:[G?st.jsxs("div",{className:`w-full h-screen flex flex-col ${W?"mr-80":""}`,children:[st.jsx("div",{className:"flex-1 p-4",children:de&&f?st.jsxs("div",{className:"h-full flex gap-4",children:[st.jsx("div",{className:"flex-1 bg-gray-800 rounded-lg relative overflow-hidden",children:st.jsx(AW,{screenSharing:de,screenTrack:f})}),st.jsxs("div",{className:"w-80 flex flex-col gap-4",children:[st.jsx("div",{className:"flex-1 bg-gray-800 rounded-lg relative overflow-hidden",children:st.jsx(p3,{remoteUsers:j})}),st.jsx("div",{className:"flex-1 bg-gray-800 rounded-lg relative overflow-hidden",children:st.jsx(f3,{localMicrophoneTrack:c,localCameraTrack:p,cameraOn:be,micOn:me})})]})]}):st.jsxs("div",{className:"grid grid-cols-2 gap-4 h-full",children:[st.jsx(p3,{remoteUsers:j}),st.jsx(f3,{localMicrophoneTrack:c,localCameraTrack:p,cameraOn:be,micOn:me})]})}),st.jsx("div",{className:"bg-gray-800 border-t border-gray-700 px-6 py-4",children:st.jsxs("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:[st.jsxs("div",{className:"flex items-center space-x-4",children:[st.jsx("button",{onClick:S,className:`w-12 h-12 rounded-full flex items-center justify-center transition-colors text-xl ${me?"bg-white":"bg-red-500"}`,children:me?"🎤":"🔇"}),st.jsx("button",{onClick:y,className:`w-12 h-12 rounded-lg flex items-center justify-center transition-colors text-xl ${be?"bg-white":"bg-gray-600"}`,children:be?"📹":"📷"}),st.jsx("button",{onClick:N,className:"w-12 h-12 rounded-full bg-red-500 flex items-center justify-center hover:bg-red-600 transition-colors text-xl",children:"📞"}),st.jsx("button",{onClick:E,disabled:fe,className:`w-12 h-12 rounded-full flex items-center justify-center transition-colors text-xl ${fe?"bg-gray-500 cursor-not-allowed":de?"bg-red-500 hover:bg-red-600":"bg-blue-500 hover:bg-blue-600"}`,title:fe?"Starting Screen Share...":de?"Stop Screen Sharing":"Start Screen Sharing",children:fe?"⏳":de?"⏹️":"🖥️"})]}),st.jsx("div",{className:"flex items-center space-x-4",children:st.jsx("button",{onClick:()=>Oe(!W),className:`w-12 h-12 rounded-full flex items-center justify-center transition-colors text-xl ${W?"bg-blue-500":"bg-gray-600 hover:bg-gray-500"}`,title:W?"Close Chat":"Open Chat",children:"💬"})})]})})]}):st.jsx(SW,{appId:We,channel:O,onJoin:C,userId:P,receptor:z,onUserIdChange:ne,onReceptorChange:ee,onChatLogin:q,isChatLoading:F}),st.jsx($3,{error:T,isCheckingDevices:v,onClose:U,onRetry:M,onContinueWithoutCamera:x,showContinueOption:T?.includes("Camera")||T?.includes("camera")}),st.jsx(IW,{messages:Y,singleMessage:Z,onMessageChange:H,onSendMessage:ve,onClose:()=>Oe(!1),isVisible:W&&I}),st.jsx(bW,{error:oe,onClose:Le})]})},wW=()=>{const[G,me]=ot.useState(!1),[be]=ot.useState("5712bb769baf481487093bcc0d423673"),[de]=ot.useState("Test"),[fe]=ot.useState("007eJxTYGhcbf93/4qb8k4LIs2ZV7qXPpHhEdrQldn7frNe9vWzwpMUGEzNDY2SkszNLJMS00wsDE0szA0sjZOSkw1STIyMzcyNV7/tzGgIZGRoyCxiYIRCEJ+FISS1uISBAQA3JR8X"),[We,O]=ot.useState(!0),[j,c]=ot.useState(null),[p,f]=ot.useState(null),[T,v]=ot.useState(!1),S=hh(),y=ot.useCallback(async()=>{v(!0),c(null);try{const F=await Z3({checkCamera:!1,checkMicrophone:!0});f(F),(F.microphonePermission==="denied"||!F.hasMicrophone)&&O(!1);const oe=Q3(F);oe&&c(oe)}catch(F){console.error("Device permission check failed:",F),c("Failed to check device permissions. Please refresh the page and try again.")}finally{v(!1)}},[]);ot.useEffect(()=>{y()},[y]);const{localMicrophoneTrack:E,error:N}=IO(We&&p?.microphonePermission!=="denied"&&p?.hasMicrophone!==!1),C=AO(),U=G3(C);ot.useEffect(()=>{N&&(console.error("Microphone track error:",N),c("Failed to access microphone. Please check your device permissions."),O(!1))},[N]),RO({appid:be,channel:de,token:fe||null},G),m3.useEffect(()=>{E&&E.setEnabled(We)},[E,We]);const M=[E].filter(Boolean);CO(M);const x=ot.useMemo(()=>C.map(F=>{const oe=U.audioTracks.find(W=>W.getUserId()===F.uid);return{...F,hasAudio:!!oe,audioTrack:oe}}),[C,U.audioTracks]),P=ot.useCallback(()=>{p?.microphonePermission!=="denied"&&p?.hasMicrophone!==!1&&O(F=>!F)},[p]);return{calling:G,isConnected:S,micOn:We,appId:be,channel:de,remoteUsers:x,deviceError:j,deviceInfo:p,isCheckingDevices:T,localMicrophoneTrack:E,toggleMic:P,toggleCall:()=>me(F=>!F),joinChannel:()=>me(!0),clearDeviceError:()=>{c(null)},retryDeviceCheck:()=>{y()}}},DW=()=>{const G=LO.createClient({mode:"rtc",codec:"vp8"});return st.jsx(SO,{client:G,children:st.jsx(PW,{})})},PW=()=>{const{calling:G,isConnected:me,micOn:be,appId:de,channel:fe,remoteUsers:We,deviceError:O,isCheckingDevices:j,toggleMic:c,toggleCall:p,joinChannel:f,clearDeviceError:T,retryDeviceCheck:v}=wW();return st.jsxs("div",{className:"min-h-screen bg-gray-100 w-full",children:[st.jsxs("div",{className:"text-center mb-10 pt-8",children:[st.jsx("h1",{className:"text-4xl font-bold text-slate-800 mb-2",children:"🎤 Agora Audio Call"}),st.jsx("p",{className:"text-lg text-slate-600",children:me?`Connected to channel: ${fe}`:"Join an audio call channel"}),me&&st.jsxs("p",{className:"text-sm text-slate-500 mt-2",children:['Share channel name "',fe,'" with others to join the call']})]}),me?st.jsxs("div",{className:"w-full h-screen flex flex-col",children:[st.jsx("div",{className:"flex-1 pb-24",children:st.jsx(CW,{remoteUsers:We,localUser:{uid:"local",hasAudio:be}})}),st.jsx(RW,{micOn:be,calling:G,onToggleMic:c,onToggleCall:p})]}):st.jsx("div",{className:"flex justify-center",children:st.jsx("button",{className:`py-4 px-6 text-lg font-medium rounded-lg transition-all duration-200 flex items-center justify-center gap-2 ${!de||!fe?"bg-gray-400 text-white cursor-not-allowed opacity-60":"bg-blue-500 text-white hover:bg-blue-600"}`,disabled:!de||!fe,onClick:()=>{f()},children:st.jsx("span",{children:"🚀 Join Audio Call"})})}),st.jsx($3,{error:O,isCheckingDevices:j,onClose:T,onRetry:v})]})},LW=()=>{const G=I3();return st.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:st.jsxs("div",{className:"text-center space-y-8",children:[st.jsxs("div",{className:"space-y-4",children:[st.jsx("h1",{className:"text-5xl font-bold text-gray-800 mb-2",children:"Welcome to Agora Calls"}),st.jsx("p",{className:"text-xl text-gray-600 max-w-md mx-auto",children:"Choose your preferred communication method"})]}),st.jsxs("div",{className:"flex flex-col sm:flex-row gap-6 justify-center items-center",children:[st.jsx("button",{onClick:()=>G("/video"),className:"group relative px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 min-w-[200px]",children:st.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[st.jsxs("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:[st.jsx("path",{d:"M2 6a2 2 0 012-2h6l2 2h6a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"}),st.jsx("path",{d:"M8 11a2 2 0 100-4 2 2 0 000 4z"})]}),st.jsx("span",{children:"Video Call"})]})}),st.jsx("button",{onClick:()=>G("/audio"),className:"group relative px-8 py-4 bg-gradient-to-r from-green-600 to-green-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 min-w-[200px]",children:st.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[st.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:st.jsx("path",{fillRule:"evenodd",d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z",clipRule:"evenodd"})}),st.jsx("span",{children:"Audio Call"})]})})]})]})})};function kW(){return st.jsxs(z7,{children:[st.jsx(p0,{path:"/",element:st.jsx(LW,{})}),st.jsx(p0,{path:"/video",element:st.jsx(OW,{})}),st.jsx(p0,{path:"/audio",element:st.jsx(DW,{})})]})}r7.createRoot(document.getElementById("root")).render(st.jsx(m3.StrictMode,{children:st.jsx(m9,{children:st.jsx(kW,{})})}));
